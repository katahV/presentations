// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),function(r,g,f,a,c,b,l,e,d,h,n,t){var p={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?
c.small:b<=a.medium?c.medium:b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",
large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?c.small:b<=a.medium?c.medium:
b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",
large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},
valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},k={xsmall:544,small:768,medium:992,large:1200};return function(q){function l(){var a=null!==q&&q.apply(this,arguments)||this;a._breakpointsHandles=new d;a.breakpoints=k;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}f(l,q);l.prototype.initialize=function(){this._breakpointsHandles.add([h.init(this,["breakpoints","size"],this._updateClassNames)])};l.prototype.destroy=
function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};l.prototype._updateClassNames=function(){if(this.container){var a=e.acquire(),b=e.acquire(),c=!1,d,k,q;for(d in p)k=this[d],q=p[d].getValue({viewSize:this.size,breakpoints:this.breakpoints}),k!==q&&(c=!0,this[d]=q,b.push(p[d].valueToClassName[k]),a.push(p[d].valueToClassName[q]));c&&(this._applyClassNameChanges(a,b),e.release(a),e.release(b))}};l.prototype._applyClassNameChanges=
function(a,c){var d=this.container;d&&(b.remove(d,c),b.add(d,a))};l.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in p)b.remove(a,p[c].valueToClassName[this[c]])};a([n.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var d=JSON.stringify(k,null,2);console.warn("provided breakpoints are not valid, using defaults:"+d)}a=b?a:k;this._set("breakpoints",c({},a))}}})],l.prototype,"breakpoints",
void 0);a([n.property()],l.prototype,"orientation",void 0);a([n.property()],l.prototype,"widthBreakpoint",void 0);a([n.property()],l.prototype,"heightBreakpoint",void 0);return l=a([n.subclass("esri.views.BreakpointsOwner")],l)}(n.declared(l,t))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct dojo/on ../core/Accessor ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./PopupManager ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m){var u=[0,0];return function(d){function v(){var a=d.call(this)||this;a._domHandles=new h;a._freqInfo={freq:16,time:750};a._overlayRenderTaskHandle=null;a.height=0;a.popup=new m({view:a});a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.ui=null;a.userContent=null;a.width=0;a.watch("cursor",function(b){var c=a.surface;c&&c.setAttribute("data-cursor",b)});a.watch("interacting",function(b){var c=a.surface;c&&c.setAttribute("data-interacting",
b.toString())});a._focusEvent=a._focusEvent.bind(a);a._blurEvent=a._blurEvent.bind(a);return a}f(v,d);v.prototype.initialize=function(){this.watch("ui",this._handleUIChange);this._wireUI(this.ui)};v.prototype.destroy=function(){this.ui.destroy();this.popup&&!this.popup.destroyed&&this.popup.destroy();this.container=null;this._domHandles.destroy()};Object.defineProperty(v.prototype,"container",{set:function(a){var d=this,v=this._get("container");if(v!==a){this._domHandles.remove("dom-size");this._stopMeasuring();
if(v){var e=this.surface;e&&(e.removeEventListener("focus",this._focusEvent),e.removeEventListener("blur",this._blurEvent));v.classList.remove("esri-view");this.popupManager.destroy();this._set("popupManager",null);this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null);this.overlay.destroy();this._set("overlay",null);b.destroy(this.root);this._set("root",null);b.destroy(this.userContent);this._set("userContent",null)}if(a){a.classList.add("esri-view");
v=document.createElement("div");for(v.className="esri-view-user-storage";a.hasChildNodes();)v.appendChild(a.firstChild);a.appendChild(v);v=document.createElement("div");v.className="esri-view-root";a.insertBefore(v,a.firstChild);this._set("root",v);var h=document.createElement("div");h.className="esri-view-surface";h.setAttribute("role","application");h.tabIndex=0;h.addEventListener("focus",this._focusEvent);h.addEventListener("blur",this._blurEvent);c.setSelectable(h,!1);v.appendChild(h);this._set("surface",
h);e=new q;v.appendChild(e.surface);this._set("overlay",e);e.watch("needsRender",function(a){a&&!d._overlayRenderTaskHandle?d._overlayRenderTaskHandle=n.addFrameTask({render:function(){d.overlay.render()}}):d._overlayRenderTaskHandle&&(d._overlayRenderTaskHandle.remove(),d._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._domHandles.add(t.init(this,"size",function(a){var b=a[1];h.classList.toggle("esri-view-surface--inset-outline",a[0]>=document.body.clientWidth||b>=document.body.clientHeight)}),
"dom-size");this._set("container",a);this._startMeasuring();a=new k({enabled:!0,view:this});this._set("popupManager",a)}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"focused",{get:function(){return document.activeElement===this.surface},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"size",{get:function(){return[this.width,
this.height]},enumerable:!0,configurable:!0});v.prototype.blur=function(){this.surface&&this.surface.blur()};v.prototype.focus=function(){this.surface&&this.surface.focus()};v.prototype.pageToContainer=function(a,b,c){var d=this.position;a-=d[0];b-=d[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};v.prototype.containerToPage=function(a,b,c){var d=this.position;a+=d[0];b+=d[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};v.prototype._handleUIChange=function(a,b){b&&(this._domHandles.remove("ui"),b.destroy());a&&this._wireUI(a);
this._set("ui",a)};v.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([t.init(this,"root",function(c){a.container=c?b.create("div",null,c):null}),t.init(this,"popup",function(b,c){c&&(a.remove(c,"popup"),c!==b&&c.destroy());b&&(b.view=a.view,a.add(b,{key:"popup",position:"manual"}))})],"ui"))};v.prototype._focusEvent=function(a){this.notifyChange("focused");this.emit("focus",{native:a})};v.prototype._blurEvent=function(a){this.notifyChange("focused");
this.emit("blur",{native:a})};v.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};v.prototype._startMeasuring=function(){var a=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([l(window,"resize",function(){b.freq=16;b.time=750}),n.addFrameTask({prepare:function(b){var c=a._measure(),d=a._freqInfo;d.time+=b.deltaTime;c&&(d.freq=16,a._get("resizing")||a._set("resizing",!0));d.time<d.freq||(d.time=0,a._position()||
c?d.freq=16:d.freq=Math.min(750,2*d.freq),!c&&512<=d.freq&&a._get("resizing")&&a._set("resizing",!1))}})],"measuring");this._measure();this._position()};v.prototype._measure=function(){var a=this.container,b=a?a.clientWidth:0,c=a?a.clientHeight:0;if(0===b||0===c||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var a=this.width,d=this.height;if(b===a&&c===d)return this.suspended&&this._set("suspended",!1),!1;this._set("width",b);this._set("height",
c);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:a,oldHeight:d,width:b,height:c});return!0};v.prototype._position=function(){var a=this.container,b=this.position,c=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();u[0]=a.left+c.pageXOffset;u[1]=a.top+c.pageYOffset;return b&&u[0]===b[0]&&u[1]===b[1]?!1:(this._set("position",u.slice()),!0)};a([p.property({value:null,cast:function(a){return c.byId(a)}})],v.prototype,"container",null);a([p.property({readOnly:!0,
dependsOn:["surface"]})],v.prototype,"focused",null);a([p.property({readOnly:!0})],v.prototype,"height",void 0);a([p.property({type:m})],v.prototype,"popup",void 0);a([p.property({type:k})],v.prototype,"popupManager",void 0);a([p.property({type:q})],v.prototype,"overlay",void 0);a([p.property({readOnly:!0})],v.prototype,"position",void 0);a([p.property({readOnly:!0})],v.prototype,"resizing",void 0);a([p.property({readOnly:!0})],v.prototype,"root",void 0);a([p.property({value:null,dependsOn:["width",
"height"],readOnly:!0})],v.prototype,"size",null);a([p.property({readOnly:!0})],v.prototype,"surface",void 0);a([p.property({readOnly:!0})],v.prototype,"suspended",void 0);a([p.property()],v.prototype,"ui",void 0);a([p.property({readOnly:!0})],v.prototype,"userContent",void 0);a([p.property({readOnly:!0})],v.prototype,"width",void 0);return v=a([p.subclass("esri.views.DOMContainer")],v)}(p.declared(e,d))})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),
function(r,g,f,a,c,b,l,e,d){return function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new l;a._callbacks=new Map;a._projector=d.createProjector();a._hiddenProjector=d.createProjector();return a}f(h,b);Object.defineProperty(h.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";c.setSelectable(b,!1);this._set("surface",
b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(b){b.added.map(function(b){var c=function(){return b.render()};a._callbacks.set(b,c);a._projector.append(a.surface,c)});b.removed.map(function(b){var c=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(c.domNode);a._callbacks.delete(b)})})};h.prototype.addItem=function(a){this.items.add(a)};
h.prototype.removeItem=function(a){this.items.remove(a)};h.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};h.prototype.render=function(){this._projector.renderNow()};h.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,c=this._hiddenProjector,d=null,e=function(){return d=a.render()};c.append(b,e);c.renderNow();var h={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var l=d.domNode.getBoundingClientRect();h.left=
l.left;h.top=l.top;h.right=l.right;h.bottom=l.bottom}for(c.detach(e);b.firstChild;)b.removeChild(b.firstChild);return h};h.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};a([e.property({readOnly:!0})],h.prototype,"surface",void 0);a([e.property({readOnly:!0})],h.prototype,"items",void 0);a([e.property({readOnly:!0,dependsOn:["items.length"]})],
h.prototype,"needsRender",null);return h=a([e.subclass("esri.views.overlay.ViewOverlay")],h)}(e.declared(b))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ../widgets/support/widgetUtils ./support/widget".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){function y(a,b){return void 0===b?"esri-popup__"+a:"esri-popup__"+a+"-"+b}var A=r.toUrl("./Popup/images/default-action.svg"),C={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},B=n.getLogger("esri.widgets.Popup");return function(n){function m(a){a=n.call(this)||this;a._blurContainer=!1;a._containerNode=null;a._mainContainerNode=null;a._featureMenuNode=null;a._focusContainer=!1;a._focusDockButton=!1;a._focusFeatureMenuButton=!1;a._focusFirstFeature=
!1;a._handles=new d;a._displayActionTextLimit=2;a._pointerOffsetInPx=16;a._spinner=null;a.actions=null;a.alignment="auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.features=null;a.featureNavigationEnabled=!0;a.goToOverride=null;a.highlightEnabled=null;a.location=null;a.featureWidgets=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedFeatureWidget=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=
null;a.view=null;a.viewModel=new u;a.visible=null;return a}f(m,n);m.prototype.postInitialize=function(){var a=this;this._addSelectedFeatureIndexHandle();this.own(t.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),t.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),t.watch(this,"viewModel.screenLocation",function(b,c){!!b!==!!c&&a.reposition()}),t.watch(this,"viewModel.features",function(b){return a._createFeatureWidgets(b)}),
t.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return a.reposition()}),t.watch(this,"spinnerEnabled",function(b){return a._spinnerEnabledChange(b)}),t.watch(this,"viewModel.view.size",function(b,c){return a._updateDockEnabledForViewSize(b,c)}),t.watch(this,"viewModel.view",function(b,c){return a._viewChange(b,c)}),t.watch(this,"viewModel.view.ready",function(b,c){return a._viewReadyChange(b,
c)}),t.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),t.watch(this,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return a._updateFeatureWidget()}),t.watch(this,"selectedFeatureWidget.viewModel.title",function(b){return a._setTitleFromFeatureWidget(b)}),t.watch(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return a._setContentFromFeatureWidget()}),t.on(this,"viewModel",
"trigger-action",function(b){return a._zoomToAction(b)}))};m.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();this._handles=null};Object.defineProperty(m.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,
"dockOptions",{get:function(){return this._get("dockOptions")||C},set:function(a){var b=c({},C),d=this.get("viewModel.view.breakpoints"),v={};d&&(v.width=d.xsmall,v.height=d.xsmall);a=c({},b,a);b=c({},b.breakpoint,v);v=a.breakpoint;!0===v?a.breakpoint=b:"object"===typeof v&&(a.breakpoint=c({},b,v));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?
this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",!!a)},enumerable:!0,configurable:!0});m.prototype.blur=function(){this.visible||B.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};m.prototype.clear=function(){};m.prototype.close=function(){this.visible=!1};m.prototype.focus=function(){this.visible||B.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};m.prototype.next=
function(){return null};m.prototype.open=function(a){this._handles.remove("selected-index");this.set({featureMenuOpen:a?!!a.featureMenuOpen:!1});this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};m.prototype.previous=function(){return null};m.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};m.prototype.triggerAction=function(a){return null};m.prototype.render=function(){var a=this.collapsed,b=this.collapseEnabled,c=this.dockEnabled,
d=this.actions,e=this.featureMenuOpen,k=this.featureNavigationEnabled,q=this.featureWidgets,n=this.visible,f=this.viewModel,A=f.content,m=f.featureCount,u=f.pendingPromisesCount,p=f.selectedFeatureIndex,t=f.title,f=1<m&&k,k=1<m&&e,C=b&&!k&&a,a=d&&d.length,B=f&&this._getPageText(m,p),D=this._renderContent(),g=x.isRtl(),E=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):D,ba=c?l.undock:l.dock,m=this.currentAlignment,
d=this.currentDockPosition,u=u?v.tsx("div",{key:y("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":l.loading,title:l.loading},v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,R=(r={},r["esri-icon-layer-list"]=!k,r["esri-icon-close"]=k,r),r=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",R)}),R=(ea={},ea["esri-icon-right-triangle-arrow"]=g,ea["esri-popup__pagination-previous-icon--rtl"]=
g,ea["esri-icon-left-triangle-arrow"]=!g,ea["esri-popup__pagination-previous-icon"]=!g,ea),ea=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",R)}),R=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":l.previous,title:l.previous},ea),ea=(ca={},ca["esri-icon-left-triangle-arrow"]=g,ca["esri-popup__pagination-next-icon--rtl"]=g,ca["esri-icon-right-triangle-arrow"]=
!g,ca["esri-popup__pagination-next-icon"]=!g,ca),ca=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ea)}),g=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":l.next,title:l.next},ca),ea=x.cssTransition("enter","esri-popup--feature-updated"),ca=this.id+"-feature-menu",e=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,
afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":ca,"aria-expanded":e,"aria-label":l.menu,title:l.menu},r),B=v.tsx("div",{class:"esri-popup__pagination-page-text"},B),e=f?v.tsx("div",{class:"esri-popup__navigation-buttons",enterAnimation:ea},R,B,g,u||e):null,B=this._wouldDockTo(),B=(fa={},fa["esri-icon-minimize"]=c,fa["esri-popup__icon--dock-icon"]=
!c,fa["esri-icon-dock-right"]=!c&&("top-right"===B||"bottom-right"===B),fa["esri-icon-dock-left"]=!c&&("top-left"===B||"bottom-left"===B),fa["esri-icon-maximize"]=!c&&"top-center"===B,fa["esri-icon-dock-bottom"]=!c&&"bottom-center"===B,fa),fa=v.tsx("span",{"aria-hidden":"true",class:this.classes(B,"esri-popup__icon")}),fa=this.get("dockOptions.buttonEnabled")?v.tsx("div",{role:"button","aria-label":ba,title:ba,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,
afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},fa):null,b=b&&t&&(E||a||f),ba=(da={},da["esri-popup__header-title--button"]=b,da),B=b?"button":"heading",u=b?C?l.expand:l.collapse:"",da=this.id+"-popup-title",t=t?v.tsx("h2",{class:this.classes("esri-popup__header-title",ba),key:t,enterAnimation:ea,id:da,role:B,"aria-label":u,title:u,bind:this,tabIndex:b?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,
innerHTML:t}):null,b=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")}),b=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":l.close,title:l.close},b),b=v.tsx("header",{class:"esri-popup__header"},t,v.tsx("div",{class:"esri-popup__header-buttons"},fa,b)),fa=this.id+"-popup-content",A=E&&!C?v.tsx("article",{key:A,enterAnimation:ea,id:fa,class:"esri-popup__content"},D):null,D=!C&&
("bottom-left"===m||"bottom-center"===m||"bottom-right"===m||"top-left"===d||"top-center"===d||"top-right"===d),C=!C&&("top-left"===m||"top-center"===m||"top-right"===m||"bottom-left"===d||"bottom-center"===d||"bottom-right"===d),E=k?null:v.tsx("div",{key:y("actions"),class:"esri-popup__actions"},this._renderActions()),ea=v.tsx("section",{key:y("navigation"),class:"esri-popup__navigation"},e),f=f||a?v.tsx("div",{key:y("feature-buttons"),class:"esri-popup__feature-buttons"},E,ea):null,p=this._renderFeatureMenuNode(q,
p,k,ca),q=h.substitute({total:q.length},l.selectedFeatures),ca=v.tsx("section",{key:y("menu"),class:"esri-popup__feature-menu"},v.tsx("h2",{class:"esri-popup__feature-menu-header"},q),v.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},p)),q=c?null:v.tsx("div",{key:y("pointer"),class:"esri-popup__pointer",role:"presentation"},v.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")})),
p=this.get("selectedFeature.layer.title"),a=this.get("selectedFeature.layer.id"),E=(ka={},ka["esri-popup--shadow"]=c,ka),c=(ga={},ga["esri-popup--aligned-top-center"]=n&&"top-center"===m,ga["esri-popup--aligned-bottom-center"]=n&&"bottom-center"===m,ga["esri-popup--aligned-top-left"]=n&&"top-left"===m,ga["esri-popup--aligned-bottom-left"]=n&&"bottom-left"===m,ga["esri-popup--aligned-top-right"]=n&&"top-right"===m,ga["esri-popup--aligned-bottom-right"]="bottom-right"===m,ga["esri-popup--is-docked"]=
n&&c,ga["esri-popup--shadow"]=n&&!c,ga["esri-popup--is-docked-top-left"]=n&&"top-left"===d,ga["esri-popup--is-docked-top-center"]=n&&"top-center"===d,ga["esri-popup--is-docked-top-right"]=n&&"top-right"===d,ga["esri-popup--is-docked-bottom-left"]=n&&"bottom-left"===d,ga["esri-popup--is-docked-bottom-center"]=n&&"bottom-center"===d,ga["esri-popup--is-docked-bottom-right"]=n&&"bottom-right"===d,ga["esri-popup--feature-menu-open"]=n&&k,ga),ga=D?ca:null,ka=C?ca:null,k=D?f:null,m=C?f:null,ga=v.tsx("div",
{class:this.classes("esri-popup__main-container","esri-widget",E),tabIndex:-1,role:"dialog","aria-labelledby":t?da:"","aria-describedby":A?fa:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},k,ga,b,A,m,ka);return v.tsx("div",{key:y("base"),class:this.classes("esri-popup",c),role:"presentation","data-layer-title":p,"data-layer-id":a,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},n?[ga,
q]:null);var r,ea,ca,fa,da,ka,ga};m.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};m.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};m.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};m.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===e.ESCAPE&&(a.stopPropagation(),this.featureMenuOpen=!1)};m.prototype._handleFeatureMenuItemKeyup=
function(a){var b=a.keyCode,c=this._featureMenuNode,d=this.get("features.length"),v=a.currentTarget["data-feature-index"];c&&(c=c.querySelectorAll("li"),b===e.UP_ARROW?(a.stopPropagation(),c[(v-1+d)%d].focus()):b===e.DOWN_ARROW?(a.stopPropagation(),c[(v+1+d)%d].focus()):b===e.HOME?(a.stopPropagation(),c[0].focus()):b===e.END&&(a.stopPropagation(),c[c.length-1].focus()))};m.prototype._handleMainKeyup=function(a){var b=a.keyCode;b===e.LEFT_ARROW&&(a.stopPropagation(),this.previous());b===e.RIGHT_ARROW&&
(a.stopPropagation(),this.next())};m.prototype._zoomToAction=function(a){a.action&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};m.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};m.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,c=b.location;b.waitingForResult?a.show({location:c}):a.hide()}};m.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};
m.prototype._renderAction=function(a,b,c,d){var e=this,k=t.watch(a,["id","className","title","image","visible"],function(){return e.scheduleRender()});this._handles.add(k,d);k=this.get("selectedFeature.attributes");"zoom-to"===a.id&&(a.title=l.zoom,this._handles.add(t.init(this,"view.animation.state",function(b){a.className="waiting-for-target"===b?e.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating"):e.classes("esri-popup__icon","esri-icon-zoom-in-magnifying-glass")}),d));d=
a.title;var q=a.className,n=a.image||q?a.image:A;d=d&&k?h.substitute(k,d):d;q=q&&k?h.substitute(k,q):q;k=n&&k?h.substitute(k,n):n;n=q||"esri-popup__icon";q=(f={},f["esri-popup__action-image"]=!!k,f);f=(m={},m["esri-popup__button--disabled"]=-1!==n.indexOf("esri-icon-loading-indicator"),m);c=c<=this._displayActionTextLimit?v.tsx("span",{key:y("action-text-"+b+"-"+a.uid),class:"esri-popup__action-text"},d):null;return a.visible?v.tsx("div",{key:y("action-"+b+"-"+a.uid),role:"button",tabIndex:0,title:d,
"aria-label":d,class:this.classes("esri-popup__button","esri-popup__action",f),bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},v.tsx("span",{key:y("action-icon-"+b+"-"+a.uid+"-"+n),"aria-hidden":"true",class:this.classes(n,q),styles:this._getIconStyles(k)}),c):null;var f,m};m.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var b=this.actions;if(b){var c=b.length;return b.toArray().map(function(b,d){return a._renderAction(b,
d,c,"actions")})}};m.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=t.watch(this,"viewModel.selectedFeatureIndex",function(b,c){return a._selectedFeatureIndexUpdated(b,c)});this._handles.add(b,"selected-index")};m.prototype._selectedFeatureIndexUpdated=function(a,b){var c=this.featureMenuOpen;this.featureCount&&c&&a!==b&&-1!==a&&(this.featureMenuOpen=!1)};m.prototype._updateFeatureWidget=function(){var a=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&
(a.contentEnabled=!0);this._set("selectedFeatureWidget",a)};m.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};m.prototype._createFeatureWidgets=function(a){var b=this.featureWidgets.slice(0),c=this.get("viewModel.view"),d=[];a.forEach(function(a,v){if(a){var e=null;b.some(function(c,d){c&&c.graphic===a&&(e=c,b.splice(d,1));return!!e});d[v]=e||new k({contentEnabled:!1,graphic:a,view:c})}});b.forEach(function(a){return a&&
a.destroy()});this._set("featureWidgets",d)};m.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};m.prototype._isOutsideView=function(a){var b=a.popupHeight,c=a.popupWidth,d=a.screenLocation,v=a.side;a=a.view;if(isNaN(c)||isNaN(b)||!a||!d)return!1;var e=a.padding;return"right"===v&&d.x+c/2>a.width-e.right||"left"===v&&d.x-c/2<e.left||"top"===v&&d.y-b<e.top||"bottom"===v&&d.y+b>a.height-e.bottom?!0:!1};m.prototype._determineCurrentAlignment=function(){var a=
this._pointerOffsetInPx,c=this._containerNode,d=this._mainContainerNode,v=this.viewModel,e=v.screenLocation,v=v.view;if(!e||!v||!c)return"top-center";if(!this._isScreenLocationWithinView(e,v))return this._get("currentAlignment")||"top-center";var k=d?window.getComputedStyle(d,null):null,d=k?parseInt(k.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,k=k?parseInt(k.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,h=b.getContentBox(c),c=h.w+a,h=Math.max(h.h,d,k)+a,a=this._isOutsideView({popupHeight:h,
popupWidth:c,screenLocation:e,side:"right",view:v}),d=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:e,side:"left",view:v}),k=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:e,side:"top",view:v}),e=this._isOutsideView({popupHeight:h,popupWidth:c,screenLocation:e,side:"bottom",view:v});return d?k?"bottom-right":"top-right":a?k?"bottom-left":"top-left":k?e?"top-center":"bottom-center":"top-center"};m.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?
null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};m.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};m.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};m.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};m.prototype._getCurrentDockPosition=
function(){return this.dockEnabled?this._getDockPosition():null};m.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};m.prototype._renderFeatureMenuItemNode=function(a,b,c,d){var e=b===c;d=(k={},k["esri-popup__feature-menu-item--selected"]=e,k);k=e?v.tsx("span",{key:y("feature-menu-selected-feature-"+c),title:l.selectedFeature,"aria-label":l.selectedFeature,class:"esri-icon-check-mark"}):null;a=v.tsx("span",{innerHTML:a.title||l.untitled});return v.tsx("li",{role:"menuitem",
tabIndex:-1,key:y("feature-menu-feature-"+c),class:this.classes(d,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},v.tsx("span",{class:"esri-popup__feature-menu-title"},a,k));var k};m.prototype._renderFeatureMenuNode=function(a,b,c,d){var e=this;return 1<a.length?v.tsx("ol",{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,
onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,d){return e._renderFeatureMenuItemNode(a,d,b,c)})):null};m.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),b=x.isRtl()?"top-left":"top-right";if(!a)return b;var c=a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&c<=a.xsmall?"bottom-center":b};m.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return v.tsx("div",
{key:a,innerHTML:a});if(v.isWidget(a))return v.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return v.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});if(v.isWidgetBase(a))return v.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};m.prototype._attachToNode=function(a){a.appendChild(this)};m.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,d=b.getContentBox(a);if(c=this._calculatePositionStyle(c,
d))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};m.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===b||"bottom-right"===b?a+c:a};m.prototype._calculateAlignmentPosition=function(a,b,c,d){var v=this.currentAlignment,e=this._pointerOffsetInPx;d/=2;var k=c.height-b;c=c.width-a;var h=this.view.padding;if("bottom-center"===v)return{top:b+e-h.top,left:a-d-h.left};
if("top-left"===v)return{bottom:k+e-h.bottom,right:c+e-h.right};if("bottom-left"===v)return{top:b+e-h.top,right:c+e-h.right};if("top-right"===v)return{bottom:k+e-h.bottom,left:a+e-h.left};if("bottom-right"===v)return{top:b+e-h.top,left:a+e-h.left};if("top-center"===v)return{bottom:k+e-h.bottom,left:a-d-h.left}};m.prototype._calculatePositionStyle=function(a,b){var c=this.view;if(c){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&b&&(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,
a.y,c,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};m.prototype._viewChange=function(a,b){a&&b&&(this.close(),this.clear())};m.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),this._wireUpView(a)):b&&(this.close(),this.clear())};m.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};
m.prototype._dockingThresholdCrossed=function(a,b,c){var d=a[0];a=a[1];var v=b[0];b=b[1];var e=c.width;c=c.height;return d<=e&&v>e||d>e&&v<=e||a<=c&&b>c||a>c&&b<=c};m.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=c.left+c.right,v=c.top+c.bottom,c=[],e=[];c[0]=a[0]-d;c[1]=a[1]-v;e[0]=b[0]-d;e[1]=b[1]-v;a=this.dockOptions;this._dockingThresholdCrossed(c,e,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};
m.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};m.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};m.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};m.prototype._focusFeatureMenuButtonNode=
function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};m.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};m.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};m.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&
b<=a.height;return c||a};m.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};m.prototype._getPageText=function(a,b){return h.substitute({index:b+1,total:a},l.pageText)};m.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};m.prototype._createSpinner=function(a){a&&(this._spinner=new q({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",
position:"manual"}))};m.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};m.prototype._close=function(){this.close();this.view&&this.view.focus()};m.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};m.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.featureMenuOpen=a};m.prototype._triggerAction=function(a){this.viewModel.triggerAction(a.currentTarget["data-action-index"])};
m.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a)};m.prototype._next=function(){this.next()};m.prototype._previous=function(){this.previous()};a([p.aliasOf("viewModel.actions"),v.renderable()],m.prototype,"actions",void 0);a([p.property()],m.prototype,"alignment",void 0);a([p.aliasOf("viewModel.autoCloseEnabled")],m.prototype,"autoCloseEnabled",void 0);a([p.aliasOf("viewModel.content"),v.renderable()],m.prototype,"content",
void 0);a([p.property(),v.renderable()],m.prototype,"collapsed",void 0);a([p.property(),v.renderable()],m.prototype,"collapseEnabled",void 0);a([p.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),v.renderable()],m.prototype,"currentAlignment",null);a([p.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),v.renderable()],m.prototype,"currentDockPosition",null);a([p.property(),v.renderable()],m.prototype,"dockOptions",null);a([p.property(),v.renderable()],
m.prototype,"dockEnabled",void 0);a([p.aliasOf("viewModel.featureCount"),v.renderable()],m.prototype,"featureCount",void 0);a([p.property({dependsOn:["viewModel.visible"]}),v.renderable()],m.prototype,"featureMenuOpen",null);a([p.aliasOf("viewModel.features"),v.renderable()],m.prototype,"features",void 0);a([p.property(),v.renderable()],m.prototype,"featureNavigationEnabled",void 0);a([p.aliasOf("viewModel.goToOverride")],m.prototype,"goToOverride",void 0);a([p.aliasOf("viewModel.highlightEnabled")],
m.prototype,"highlightEnabled",void 0);a([p.aliasOf("viewModel.location"),v.renderable()],m.prototype,"location",void 0);a([p.property({readOnly:!0}),v.renderable()],m.prototype,"featureWidgets",void 0);a([p.aliasOf("viewModel.promises")],m.prototype,"promises",void 0);a([p.aliasOf("viewModel.selectedFeature"),v.renderable()],m.prototype,"selectedFeature",void 0);a([p.aliasOf("viewModel.selectedFeatureIndex"),v.renderable()],m.prototype,"selectedFeatureIndex",void 0);a([p.property({readOnly:!0}),
v.renderable()],m.prototype,"selectedFeatureWidget",void 0);a([p.property()],m.prototype,"spinnerEnabled",void 0);a([p.aliasOf("viewModel.title"),v.renderable()],m.prototype,"title",void 0);a([p.aliasOf("viewModel.updateLocationEnabled")],m.prototype,"updateLocationEnabled",void 0);a([p.aliasOf("viewModel.view")],m.prototype,"view",void 0);a([p.property({type:u}),v.renderable("viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
v.vmEvent(["triggerAction","trigger-action"])],m.prototype,"viewModel",void 0);a([p.aliasOf("viewModel.visible"),v.renderable()],m.prototype,"visible",void 0);a([p.aliasOf("viewModel.clear")],m.prototype,"clear",null);a([p.aliasOf("viewModel.next")],m.prototype,"next",null);a([p.aliasOf("viewModel.previous")],m.prototype,"previous",null);a([p.aliasOf("viewModel.triggerAction")],m.prototype,"triggerAction",null);a([v.accessibleHandler()],m.prototype,"_toggleCollapsed",null);a([v.accessibleHandler()],
m.prototype,"_close",null);a([v.accessibleHandler()],m.prototype,"_toggleDockEnabled",null);a([v.accessibleHandler()],m.prototype,"_toggleFeatureMenu",null);a([v.accessibleHandler()],m.prototype,"_triggerAction",null);a([v.accessibleHandler()],m.prototype,"_selectFeature",null);a([v.accessibleHandler()],m.prototype,"_next",null);a([v.accessibleHandler()],m.prototype,"_previous",null);return m=a([p.subclass("esri.widgets.Popup")],m)}(p.declared(m))})},"esri/widgets/Feature":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/uriUtils ./support/widget".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){function q(a,b){return void 0===b?"esri-feature__"+a:"esri-feature__"+a+"-"+b}return function(h){function m(a){a=h.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new n;return a}f(m,h);m.prototype.postInitialize=function(){var a=this;this.own(e.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
m.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};m.prototype.render=function(){var a=k.tsx("div",{key:q("loading-container"),class:"esri-feature__loading-container"},k.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return k.tsx("div",{class:"esri-feature"},k.tsx("div",
{class:"esri-feature__size-container"},k.tsx("div",{class:"esri-feature__main-container"},a)))};m.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};m.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};m.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};m.prototype._cancelChartModules=function(){this._chartRequirePromise&&this._chartRequirePromise.cancel()};m.prototype._destroyChart=function(a){var b=this._chartMap.get(a);b&&(b.chart.destroy(),
b.tooltip.destroy());this._chartMap.delete(a)};m.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};m.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return k.tsx("div",{key:q("content-string"),innerHTML:a});if(k.isWidget(a))return k.tsx("div",{key:q("content-widget")},a.render());if(a instanceof HTMLElement)return k.tsx("div",{key:q("content-html-element"),
bind:a,afterCreate:this._attachToNode});if(k.isWidgetBase(a))return k.tsx("div",{key:q("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?k.tsx("div",{key:q("content-content-elements")},a.map(this._renderContentElement,this)):null};m.prototype._renderContentElement=function(a,b){switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,
b);default:return null}};m.prototype._renderAttachmentInfo=function(a){var b=a.attachmentInfo,d=a.supportsResizeAttachments,e=b.contentType;a=b.name;var h=b.url,q=d&&t.isSupportedImage(e),l=-1===h.indexOf("?")?"?":"\x26",e=q?""+h+l+"w\x3d48":t.getIconPath(e),q=(n={},n["esri-feature__attachment-item-mask--icon"]=!q,n),n=(m={},m["esri-feature__attachments-image--resizable"]=d,m);return k.tsx("li",{class:"esri-feature__attachments-item",key:b},k.tsx("a",{class:"esri-feature__attachments-item-link",href:h,
target:"_blank"},k.tsx("div",{class:this.classes(q,"esri-feature__attachment-item-mask")},k.tsx("img",{alt:a,class:this.classes(n,"esri-feature__attachments-image"),title:a,src:e}),k.tsx("span",{class:"esri-feature__attachments-image-overlay"},k.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),k.tsx("span",{class:"esri-feature__attachments-filename"},a||c.noTitle)));var n,m};m.prototype._renderAttachments=function(a,b){var d=this,v=a.displayType,
e=(b=a.attachmentInfos)&&b.length,h=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),v=(l={},l["esri-feature__attachments--list"]="preview"!==v,l["esri-feature__attachments--preview"]="preview"===v,l);return e?k.tsx("div",{key:q("attachments-element"),class:this.classes("esri-feature__attachments","esri-feature__content-element",v)},k.tsx("div",{class:"esri-feature__attachments-title"},c.attach),k.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,c){return d._renderAttachmentInfo({attachmentInfo:b,
attachmentInfoIndex:c,supportsResizeAttachments:h,contentElement:a})}))):null;var l};m.prototype._forceLTR=function(a){return"\x26lrm;"+a};m.prototype._renderFieldInfo=function(a,b){var c=this.viewModel.formattedAttributes,d=c?c.content[b]||c.global:null,v=a.fieldName,c=a.label||v,d=d?null==d[v]?"":d[v]:"";a=!(!a.format||!a.format.dateFormat);d="number"!==typeof d||a?p.autoLink(d):this._forceLTR(d);a=(e={},e["esri-feature__field-data--date"]=a,e);return k.tsx("tr",{key:q("fields-element-info-row",
b)},k.tsx("th",{key:q("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:c}),k.tsx("td",{key:q("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:d}));var e};m.prototype._renderFields=function(a,b){var d=this;return(a=a.fieldInfos)?k.tsx("div",{key:q("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},k.tsx("table",{class:"esri-table",summary:c.fieldsSummary,key:q("fields-element-table",
b)},k.tsx("tbody",{key:q("fields-element-table-body",b)},a.map(function(a){return d._renderFieldInfo(a,b)})))):null};m.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};m.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};m.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};
m.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+(d?"#":"")+d};m.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};m.prototype._setupMediaRefreshTimers=function(){var a=this;
this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})};m.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};m.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,v=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(v.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(v.sourceURL,
a)},b),this._refreshTimers.set(a,b))};m.prototype._renderMediaInfoType=function(a,b){var c=a.value,d=a.title,d=void 0===d?"":d,v=a.type,e=a.refreshInterval,h=c.sourceURL,c=c.linkURL;if("image"===v)return a=this._shouldOpenInNewTab(c)?"_self":"_blank",h=(e=e?this._mediaInfo.get(b):null)?e.sourceURL:h,b=k.tsx("img",{alt:d,key:q("media-image-"+(e?e.timestamp:0),b),src:h}),(d=c?k.tsx("a",{title:d,href:c,target:a},b):null)?d:b;if(-1!==v.indexOf("chart"))return k.tsx("div",{key:q("chart",b),bind:this,"data-media-info":a,
"data-content-element-index":b,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};m.prototype._getChartDependencies=function(a){var b=this,c=a["data-media-info"],d=a["data-content-element-index"],e=c.value,k=e.theme||"Claro",h=c.type,q=k;"string"===typeof k&&(q=k.replace(/\./g,"/"));this._cancelChartModules();this._chartRequirePromise=l.create(function(a){return r(["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip","dojox/charting/themes/"+
q],function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return a(b)})}).then(function(c){b._renderChart(a,d,h,e,c[0],c[1],c[2]);b._chartRequirePromise=null})};m.prototype._renderChart=function(a,b,c,d,e,k,h){a=new e(a,{margins:{l:4,t:4,r:4,b:4}});h&&a.setTheme(h);switch(c){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",d.chartOptions);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,
majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.chartOptions.forEach(function(a,b){a.x=b+1});a.addSeries("Series A",d.chartOptions);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",d.chartOptions);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,
majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",d.chartOptions)}c=new k(a);a.render();this._chartMap.set(b,{chart:a,tooltip:c})};m.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var c=this._renderMediaInfoType(a,b),d=a.title?k.tsx("div",{key:q("media-title",b),class:"esri-feature__media-item-title",innerHTML:a.title}):null;a=a.caption?k.tsx("div",{key:q("media-caption",b),class:"esri-feature__media-item-caption",innerHTML:a.caption}):null;return k.tsx("div",
{key:q("media-container",b),class:"esri-feature__media-item-container"},k.tsx("div",{key:q("media-item-container",b),class:"esri-feature__media-item"},c),d,a)};m.prototype._renderMediaStatsItem=function(a,b,c){c="chart"===c?this.classes("esri-feature__media-chart-icon","esri-icon-chart"):this.classes("esri-feature__media-image-icon","esri-icon-media");return k.tsx("li",{class:"esri-feature__media-image-summary"},k.tsx("span",{"aria-hidden":"true",class:c}),k.tsx("span",{class:"esri-feature__media-count",
"aria-label":a},"("+b+")"))};m.prototype._renderMediaPageButton=function(a,b){var d=(a="previous"===a)?c.previous:c.next,v=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),e=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),h=a?this.classes("esri-feature__icon",
"esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),l=a?this._previousClick:this._nextClick;return k.tsx("div",{key:q(a?"previous":"next",b),title:d,tabIndex:0,role:"button",class:v,"data-content-element-index":b,bind:this,onkeydown:l,onclick:l},k.tsx("span",{"aria-hidden":"true",class:e}),k.tsx("span",{"aria-hidden":"true",class:h}),k.tsx("span",{class:"esri-icon-font-fallback-text"},
d))};m.prototype._handleMediaKeyup=function(a){var c=a.currentTarget["data-content-element-index"],d=a.keyCode;d===b.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(c));d===b.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(c))};m.prototype._renderMedia=function(a,b){a=a.mediaInfos;var d=this._getMediaStats(a),v=d.total,e=(h={},h["esri-feature--media-pagination-visible"]=1<d.total,h),h=this._renderMediaStatsItem(c.numImages,d.images,"image"),d=this._renderMediaStatsItem(c.numCharts,d.charts,"chart"),
l=this._renderMediaPageButton("previous",b),n=this._renderMediaPageButton("next",b),m=this._activeMediaMap.get(b);isNaN(m)&&(this._activeMediaMap.set(b,0),m=0);return v?k.tsx("div",{key:q("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",e)},k.tsx("ul",{class:"esri-feature__media-summary"},h,d),k.tsx("div",{key:q("media-element-container",b),class:"esri-feature__media-container"},l,this._renderMediaInfo(a[m],
b),n)):null;var h};m.prototype._renderText=function(a,b){return a.text?k.tsx("div",{key:q("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};m.prototype._attachToNode=function(a){a.appendChild(this)};m.prototype._getMediaStats=function(a){var b=0,c=0;a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&c++});return{total:c+b,images:b,charts:c}};m.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);
var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};m.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};m.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};m.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};
a([d.aliasOf("viewModel.contentEnabled")],m.prototype,"contentEnabled",void 0);a([d.aliasOf("viewModel.graphic")],m.prototype,"graphic",void 0);a([d.aliasOf("viewModel.title")],m.prototype,"title",void 0);a([d.aliasOf("viewModel.view")],m.prototype,"view",void 0);a([d.property({type:n}),k.renderable(["viewModel.waitingForContent","viewModel.content"])],m.prototype,"viewModel",void 0);a([k.accessibleHandler()],m.prototype,"_previousClick",null);a([k.accessibleHandler()],m.prototype,"_nextClick",null);
return m=a([d.subclass("esri.widgets.Feature")],m)}(d.declared(h))})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper dojo/i18n!dojo/cldr/nls/number ../../Graphic ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/arcadeUtils ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){function y(a,b){return a&&"feature"===a.type?a.getField(b):null}function A(a){return a.replace(/[\u00A0-\u99999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var C=t.getLogger("esri.widgets.FeatureViewModel"),B=/^\s*expression\//i,D="/"+b.group+"/g",E=new d("cancelled-query","cancelled feature query"),H=e.getFormat("short-date-short-time"),F="DateFormat"+H;return function(c){function d(a){a=c.call(this)||this;a._handles=new h;a._featurePromise=
void 0;a._layerDateFields=[];a.content=null;a.contentEnabled=!0;a.formattedAttributes=null;a.title="";a.view=null;return a}f(d,c);d.prototype.destroy=function(){this._clear();this._handles.destroy();this.graphic=this.view=this._handles=null};Object.defineProperty(d.prototype,"graphic",{get:function(){return this._get("graphic")||null},set:function(a){if(a){var b=u.getSourceLayer(a);this._layerDateFields=b?this._getDateFields(b):[]}this._set("graphic",a);this._graphicChanged(a)},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"waitingForContent",{get:function(){var a=this._featurePromise;return a?!a.isFulfilled():!1},enumerable:!0,configurable:!0});d.prototype._clear=function(){this._cancelFeatureQuery();this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};d.prototype._graphicChanged=function(a){var b=this,c=this._handles;c&&(c.remove("graphic"),this._clear(),a&&(c.add(k.watch(this,["graphic.popupTemplate.title","graphic.popupTemplate.content","graphic.popupTemplate.fieldInfos",
"contentEnabled"],function(){b._graphicChanged(b.graphic)}),"graphic"),this._featurePromise=this._queryFeature().then(function(){b.notifyChange("waitingForContent")}).catch(function(a){b.notifyChange("waitingForContent");a!==E&&C.log("error","error loading template",a);throw a;}),this.notifyChange("waitingForContent")))};d.prototype._cancelFeatureQuery=function(){var a=this._featurePromise;a&&!a.isFulfilled()&&a.cancel(E)};d.prototype._compileContent=function(a,b){var c=this;if(a&&(a.nodeName||a&&
v.isWidgetBase(a)||v.isWidget(a)))return a;if("string"===typeof a)return this._compileText({type:"text",text:a}).text;if(Array.isArray(a))return a.map(function(a,d){d=(d=b&&b[d])&&d.value;var e=a.type;if("attachments"===e)return c._compileAttachments(a,d);if("fields"===e)return c._compileFields(a);if("media"===e)return c._compileMedia(a);if("text"===e)return c._compileText(a)});a&&C.warn("invalid content type.")};d.prototype._compileFields=function(a){var b=this,c=this.graphic;a=n.clone(a);var d=
c.get("popupTemplate.expressionInfos"),c=a.fieldInfos?void 0:c.get("popupTemplate.fieldInfos"),c=a.fieldInfos||n.clone(c),e=[];c&&c.forEach(function(a){var c=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)c=b._isExpressionField(c)?b._getExpressionInfo(d,c):null,a.label=c?c.title:a.label,e.push(a)});a.fieldInfos=e;return a};d.prototype._setImageValue=function(a){var b=a.value,c=a.formattedAttributes;a=a.layer;var d=b.linkURL,e=b.sourceURL;e&&(b.sourceURL=n.substitute(c,this._fixTokens(e,
a)));d&&(b.linkURL=(""+n.substitute(c,this._fixTokens(d,a))).trim())};d.prototype._compileMedia=function(a){var b=this,c=this._layerDateFields,d=this.graphic;a=n.clone(a);var e=a.mediaInfos||[],v=d.attributes,k=u.getSourceLayer(d),h=this.formattedAttributes.global,q={dateFormat:{properties:c,formatter:F}};a.mediaInfos=e.map(function(a){if(a=n.clone(a)){var c=a.value,d=a.type,e=a.title?b._processFieldsInLinks(b._fixTokens(a.title,k),v):"",l=a.caption?b._processFieldsInLinks(b._fixTokens(a.caption,
k),v):"";a.title=e?(""+n.substitute(h,e,q)).trim():"";a.caption=l?(""+n.substitute(h,l,q)).trim():"";if("image"===d)return b._setImageValue({value:c,formattedAttributes:h,layer:k}),a.value.sourceURL?a:void 0;if("pie-chart"===d||"line-chart"===d||"column-chart"===d||"bar-chart"===d)return b._setChartValue({value:c,attributes:v,formattedAttributes:h,layer:k}),a}}).filter(Boolean);return a};d.prototype._compileText=function(a){var b=this._layerDateFields,c=this.graphic;if((a=n.clone(a))&&a.text){var d=
u.getSourceLayer(c),e=c.attributes,c=this.formattedAttributes.global,b={dateFormat:{properties:b,formatter:F}},d=this._processFieldsInLinks(this._fixTokens(a.text,d),e);a.text=(""+n.substitute(c,d,b)).trim()}return a};d.prototype._compileTitle=function(){var a=this._layerDateFields,b=this.graphic,c=b.get("popupTemplate.title"),d=b.attributes,e=u.getSourceLayer(b),a={dateFormat:{properties:a,formatter:F}},v=this.formattedAttributes.global;return"function"===typeof c?c.call(null,{graphic:b}):"string"===
typeof c&&c?(b=this._processFieldsInLinks(this._fixTokens(c,e),d),(""+n.substitute(v,b,a)).trim()):""};d.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var c=b.replace(B,"").toLowerCase(),d;a.some(function(a){if(a.name.toLowerCase()===c)return d=a,!0});return d}};d.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,c,d){return(a=y(b,d))?"{"+a.name+"}":c})};d.prototype._encodeAttributes=function(a){var b=a?n.clone(a):{};Object.keys(b).forEach(function(a){var c=
b[a];"string"===typeof c&&(c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),b[a]=c)});return b};d.prototype._formatAttributesToFieldInfos=function(a,b,c){var d=this,e=n.clone(this._layerDateFields);a.forEach(function(v){var k=d._getFixedFieldName(v.fieldName,b);v.fieldName=k;c[k]=d._formatValue(c[k],{fieldInfos:a,fieldName:k,layer:b});e&&v.format&&v.format.dateFormat&&(v=e.indexOf(k),-1<v&&e.splice(v,1))})};d.prototype._getArcadeViewingMode=function(a){return a&&"local"===a.viewingMode?"localScene":
"globalScene"};d.prototype._getViewInfo=function(){var a=this.view;if(a){var b="3d"===a.type?this._getArcadeViewingMode(a):"map";return m.getViewInfo({viewingMode:b,scale:a.scale,spatialReference:a.spatialReference})}};d.prototype._formatAttributes=function(a,b,c){var d=this,e=this.graphic,v=e.attributes,k=u.getSourceLayer(e),h=v?n.clone(v):{};b&&b.forEach(function(a){var b="expression/"+a.name;a=c.get(a.name);var v=d._getViewInfo();a=m.executeFunction(a,m.createExecContext(e,v));h[b]="string"===
typeof a?A(a):a});this.addRelatedFeatureAttributes(h);a&&this._formatAttributesToFieldInfos(a,k,h);if(k){var q=k.typeIdField;v&&Object.keys(v).forEach(function(a){if(!d.isRelatedField(a)){var b=v[a];n.isDefined(b)&&(b=d._getDomainName(a,b),n.isDefined(b)?h[a]=b:a===q&&(b=d._getTypeName(),n.isDefined(b)&&(h[a]=b)))}})}return h};d.prototype._formatValue=function(a,c){var d={dateFormat:{properties:this._layerDateFields,formatter:F}},v=c.fieldName,k=this._getFieldInfo(c.fieldInfos,v),h=n.clone(k),k=c.preventPlacesFormatting;
(c=y(c.layer,v))&&"date"===c.type&&(c=h.format||{},c.dateFormat=c.dateFormat||"short-date-short-time",h.format=c);v=h&&h.format;if(!n.isDefined(a)||!h||!n.isDefined(v))return a;var q=[],h=v.hasOwnProperty("places")||v.hasOwnProperty("digitSeparator");c=v.hasOwnProperty("digitSeparator")?v.digitSeparator:!0;k=n.isDefined(v.places)&&(!k||0<v.places);h&&k&&q.push("places: "+Number(v.places));k=h?k?"NumberFormat("+q.join(",")+")":"NumberFormat":v.dateFormat?"DateFormat"+(e.getFormat(v.dateFormat)||H):
void 0;if(!k)return a;a=n.substitute({myKey:a},"{myKey:"+k+"}",d)||"";return h&&!c&&b.group?a.replace(D,""):a};d.prototype._getDomainName=function(a,b){var c=this.graphic,d=u.getSourceLayer(c);return d&&"feature"===d.type?(a=d.getFieldDomain(a,{feature:c}))&&"coded-value"===a.type?a.getName(b):null:null};d.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var c=b.toLowerCase(),d=void 0;a.some(function(a){if(a.fieldName&&a.fieldName.toLowerCase()===c)return d=a,!0});return d}};d.prototype._getTypeName=
function(){var a=this.graphic,b=u.getSourceLayer(a);if(b&&"feature"===b.type&&(a=b.getFeatureType(a)))return a.name};d.prototype._processFieldsInLinks=function(a,b){var c=this._encodeAttributes(b),d=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(d,function(a,d,e){d=(""+(d||e)).trim();return n.substitute(d&&"{"===d[0]?b:c,a)}):a};d.prototype._compileAttachments=function(a,b){a=n.clone(a);if(!b)return a;a.attachmentInfos=b;return a};d.prototype._queryAttachments=function(){var a=this.graphic,
b=u.getSourceLayer(a);return b?(b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&"feature"===b.type?b.queryFeatureAttachments(a):p.resolve([]):p.resolve([])};d.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return p.resolve();var c={};a.forEach(function(a,d){"attachments"===a.type&&(a=b._queryAttachments())&&(c[d]=a)});return Object.keys(c).length?p.eachAlways(c):p.resolve()};d.prototype._getContent=function(){var a=this.graphic;if(!this.contentEnabled)return p.resolve();
var b=a.get("popupTemplate.content"),a="function"===typeof b?b.call(null,{graphic:a}):b;return p.isThenable(a)?a:p.resolve(a)};d.prototype._queryFeature=function(){var a=this;return this._getContent().then(function(b){return a._checkForRelatedFeatures(b).then(function(){a._set("formattedAttributes",a._createFormattedAttributes(b));a._set("title",a._compileTitle());return a._queryContentElements(b).then(function(c){c=a._compileContent(b,c);a._set("content",c||null);return c})})})};d.prototype._isExpressionField=
function(a){return B.test(a)};d.prototype._createCompiledExpressionDictionary=function(a){var b=new Map;if(!a)return b;a.forEach(function(a){return b.set(a.name,m.createFunction(a.expression))});return b};d.prototype._getDateFields=function(a){return(a=a.fields)?a.filter(function(a){return"date"===a.type}).map(function(a){return a.name}):[]};d.prototype._createFormattedAttributes=function(a){var b=this,c=this.graphic,d=c.get("popupTemplate.fieldInfos"),e=c.get("popupTemplate.expressionInfos"),v=this._createCompiledExpressionDictionary(e),
k={global:this._formatAttributes(d,e,v),content:[]};Array.isArray(a)&&a.forEach(function(a,c){"fields"===a.type&&a.fieldInfos&&(k.content[c]=b._formatAttributes(a.fieldInfos,e,v))});return k};d.prototype._getAllFieldInfos=function(a){var b=[],c=this.graphic.get("popupTemplate.fieldInfos");c&&b.push.apply(b,c);if(!a||!Array.isArray(a))return b;a.forEach(function(a){b.push.apply(b,a&&a.fieldInfos)});return b};d.prototype._checkForRelatedFeatures=function(a){var b=this.graphic;a=this._getAllFieldInfos(a);
return this.queryRelatedInfos(b,a)};d.prototype._getChartOption=function(a){var c=a.value,d=a.attributes,e=a.formattedAttributes,v=a.fieldName,k=a.relatedFieldName,h=a.fieldInfos;a=u.getSourceLayer(this.graphic);var q=c.normalizeField,l=c.tooltipField,q=q?this.isRelatedField(q)?d[this.getRelatedFieldInfo(q).fieldName]:d[q]:null,c=k&&void 0!==d[k]?d[k]:void 0!==d[v]?d[v]:e[v],c="string"===typeof c&&b.group?parseFloat(c.replace(D,"")):c,n=void 0===c?null:c&&q?c/q:c,c={y:n};if(this.isRelatedField(v))return e=
this.getRelatedFieldInfo(v),v=(v=this.getRelatedFieldInfo(l))?v.fieldName:null,a=this._formatValue(n,{fieldInfos:h,fieldName:k,layer:a,preventPlacesFormatting:!!q}),k=e?e.label||e.fieldName:k,c.tooltip=(v&&void 0!==d[v]?d[v]:k)+": "+a,c;d=this._getFieldInfo(h,v);k=this._getFixedFieldName(v,a);d=d?d.label||d.fieldName:v;c.tooltip=(l&&void 0!==e[l]?e[l]:d)+": "+e[k];return c};d.prototype._getFixedFieldName=function(a,b){return(b=y(b,a))?b.name:a};d.prototype._getFixedFieldNames=function(a,b){var c=
this;return a&&a.map(function(a){return c._getFixedFieldName(a,b)})};d.prototype._setChartValue=function(a){var b=this,c=a.value,d=a.attributes,e=a.formattedAttributes;a=a.layer;var v=this.graphic,k=this.relatedInfoCount,h=c.fields,q=c.normalizeField;c.fields=this._getFixedFieldNames(h,a);q&&(c.normalizeField=this._getFixedFieldName(q,a));if(h.some(function(a){return!!(n.isDefined(e[a])||b.isRelatedField(a)&&k)})){var l=v.get("popupTemplate.fieldInfos");c.chartOptions=c.chartOptions||[];h.forEach(function(a){b.isRelatedField(a)?
c.chartOptions=c.chartOptions.concat(b._getRelatedChartInfos({fieldInfos:l,fieldName:a,formattedAttributes:e,value:c})):(a=b._getChartOption({value:c,attributes:d,formattedAttributes:e,fieldName:a,fieldInfos:l}),c.chartOptions.push(a))})}};d.prototype._getRelatedChartInfos=function(a){var b=this,c=a.fieldInfos,d=a.fieldName,e=a.formattedAttributes,v=a.value,k=[];a=this.getRelatedFieldInfo(d);var h=a.fieldName,q=this.getRelatedInfo(a.layerId);if(!q)return k;a=q.relatedFeatures;q=q.relation;if(!q||
!a)return k;q=q.cardinality;a.forEach(function(a){var q=a.attributes;q&&Object.keys(q).forEach(function(a){a===h&&k.push(b._getChartOption({value:v,attributes:q,formattedAttributes:e,fieldName:d,relatedFieldName:a,fieldInfos:c}))})});return"one-to-many"===q||"many-to-many"===q?k:[k[0]]};a([q.property({readOnly:!0})],d.prototype,"content",void 0);a([q.property()],d.prototype,"contentEnabled",void 0);a([q.property({readOnly:!0})],d.prototype,"formattedAttributes",void 0);a([q.property({type:l})],d.prototype,
"graphic",null);a([q.property({readOnly:!0})],d.prototype,"title",void 0);a([q.property()],d.prototype,"view",void 0);a([q.property({readOnly:!0})],d.prototype,"waitingForContent",null);return d=a([q.subclass("esri.widgets.FeatureViewModel")],d)}(q.declared(x))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.getSourceLayer=function(f){if(f)return f.get("sourceLayer")||f.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){var q=new Map,m=e.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(b){function e(a){a=b.call(this)||this;a.relatedInfoCount=null;a.relatedInfos=new Map;return a}f(e,b);e.prototype.destroy=function(){this.relatedInfos.clear()};e.prototype.addRelatedFeatureAttributes=function(a){var b=this;this.relatedInfos.forEach(function(c){return b._addRelatedFeatureAttribute(a,c)})};e.prototype.getRelatedFieldInfo=function(a){if(-1===a.indexOf("relationships/"))return null;
a=a.split("/").slice(1);return{layerId:a[0],fieldName:a[1]}};e.prototype.getRelatedInfo=function(a){return this.relatedInfos.get(a.toString())};e.prototype.isRelatedField=function(a){void 0===a&&(a="");return a?-1!==a.indexOf("relationships/"):!1};e.prototype.queryRelatedInfos=function(a,b){var c=this;this.relatedInfos.clear();var e=k.getSourceLayer(a);if(!e)return d.resolve();var v=b.filter(function(a){return a&&c.isRelatedField(a.fieldName)});if(!v||!v.length)return d.resolve();this._createRelatedInfos(b,
e);return this._queryLayerInfos(e,b).then(function(b){c._updateRelatedInfoLayerInfos(b);return c._queryRelatedFeatureMap(a).then(function(a){Object.keys(a).forEach(function(b){c._setRelatedFeatures(a[b],b.toString())});return a})})};e.prototype._addRelatedFeatureAttribute=function(a,b){var c=this;a&&b&&("one-to-one"===b.relation.cardinality&&b.relatedFeatures&&b.relatedFeatures.forEach(function(d){return c._addAttributesFromFeature(a,d,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(d){return c._addAttributesFromFeature(a,
d,b)}))};e.prototype._updateRelatedInfoLayerInfo=function(a,b){if(a=a.value)this.getRelatedInfo(b).layerInfo=a.data};e.prototype._updateRelatedInfoLayerInfos=function(a){var b=this;Object.keys(a).forEach(function(c){return b._updateRelatedInfoLayerInfo(a[c],c.toString())})};e.prototype._addAttributesFromFeature=function(a,b,c){var d=this;a&&b&&c&&Object.keys(b.attributes).forEach(function(e){var v=d._relatedFieldInfoToString({layerId:c.relation.id.toString(),fieldName:e});a[v]=b.attributes[e]})};
e.prototype._relatedFieldInfoToString=function(a){return a?"relationships/"+a.layerId+"/"+a.fieldName:""};e.prototype._createRelatedInfoForFieldInfo=function(a,b){var c=this.getRelatedFieldInfo(a.fieldName);if(c){var d=c.layerId,c=c.fieldName;d&&(b=this.getRelatedInfo(d)||this._createRelatedInfo(d,b))&&(b.relatedFields.push(c),a.statisticType&&(a=new p({statisticType:a.statisticType,onStatisticField:c,outStatisticFieldName:c}),b.outStatistics.push(a)))}};e.prototype._createRelatedInfos=function(a,
b){var c=this;a.forEach(function(a){return c._createRelatedInfoForFieldInfo(a,b)})};e.prototype._queryRelatedFeatureMap=function(a){var b=this,c={};this.relatedInfos.forEach(function(d,e){c[e]=b._queryRelatedLayerFeatures(a,d)});return d.eachAlways(c)};e.prototype._queryLayerInfos=function(a,b){var c=this,e={};this.relatedInfos.forEach(function(b,v){b=b.relation;if(!b)return v=new l("relation-required","A relation is required on a layer to retrieve related records."),m.error(v),d.reject(v);b=b.relatedTableId;
if(!b)return v=new l("A related table ID is required on a layer to retrieve related records."),m.error(v),d.reject(v);b=a.url+"/"+b;var k=q.get(b),h=k?k:c._queryLayerInfo(b);k||q.set(b,h);e[v]=h});return d.eachAlways(e)};e.prototype._queryLayerInfo=function(a){return c(a,{query:{f:"json"},callbackParamName:"callback"})};e.prototype._queryRelatedLayerFeatures=function(a,b){var c=k.getSourceLayer(a).layerId.toString(),e=b.layerInfo,v=b.queryTask,h=b.relation;if(c=this._getDestinationRelation(e,c)){var h=
h.keyField,q=c.keyField,c="string"===this._getDestinationFieldType(e,c)?q+"\x3d'"+a.attributes[h]+"'":q+"\x3d"+a.attributes[h];a=v.execute(new t({where:c,outFields:b.relatedFields}));b=b.outStatistics&&0<b.outStatistics.length&&e.supportsStatistics?v.execute(new t({where:c,outFields:b.relatedFields,outStatistics:b.outStatistics})):null;return d.eachAlways({features:a,statsFeatures:b?b:d.resolve()})}return d.resolve()};e.prototype._setRelatedFeatures=function(a,b){if(b=this.getRelatedInfo(b)){var c=
a.value;c&&(a=c.features,c=c.statsFeatures,a=a&&a.value,b.relatedFeatures=a?a.features:[],a=c&&c.value,b.relatedStatsFeatures=a?a.features:[])}};e.prototype._getRelation=function(a,b){if("feature"!==b.type)return null;var c=null;b.relationships.some(function(b){if(b.id===parseInt(a,10))return c=b,!0});return c};e.prototype._createRelatedInfo=function(a,b){var c=this._getRelation(a,b);if(c){b=b.url+"/"+c.relatedTableId;var d=new n({url:b}),c={url:b,queryTask:d,relation:c,relatedFields:[],outStatistics:[]};
this.relatedInfos.set(a,c);return c}};e.prototype._getDestinationRelation=function(a,b){var c;a&&a.relationships&&a.relationships.some(function(a){if(""+a.relatedTableId===b)return c=a,!0});return c};e.prototype._getDestinationFieldType=function(a,b){var c=void 0;a.fields.some(function(a){if(a.name===b.keyField)return c=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?"number":"string",!0});return c};a([h.aliasOf("relatedInfos.size")],
e.prototype,"relatedInfoCount",void 0);a([h.property()],e.prototype,"relatedInfos",void 0);return e=a([h.subclass("esri.widgets.Popup.support.RelatedFeatures")],e)}(h.declared(b))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});var f=r.toUrl("../../../themes/base/images/files/");g.isSupportedImage=function(a){a=a.toLowerCase();return"image/bmp"===a||"image/emf"===a||"image/exif"===a||"image/gif"===
a||"image/x-icon"===a||"image/jpeg"===a||"image/png"===a||"image/tiff"===a||"image/x-wmf"===a};g.getIconPath=function(a){return"text/plain"===a?f+"text-32.svg":"application/pdf"===a?f+"pdf-32.svg":"text/csv"===a?f+"csv-32.svg":"application/gpx+xml"===a?f+"gpx-32.svg":"application/x-dwf"===a?f+"cad-32.svg":"application/postscript"===a||"application/json"===a||"text/xml"===a||"model/vrml"===a?f+"code-32.svg":"application/x-zip-compressed"===a||"application/x-7z-compressed"===a||"application/x-gzip"===
a||"application/x-tar"===a||"application/x-gtar"===a||"application/x-bzip2"===a||"application/gzip"===a||"application/x-compress"===a||"application/x-apple-diskimage"===a||"application/x-rar-compressed"===a||"application/zip"===a?f+"zip-32.svg":-1!==a.indexOf("image/")?f+"image-32.svg":-1!==a.indexOf("audio/")?f+"sound-32.svg":-1!==a.indexOf("video/")?f+"video-32.svg":-1!==a.indexOf("msexcel")||-1!==a.indexOf("ms-excel")||-1!==a.indexOf("spreadsheetml")?f+"excel-32.svg":-1!==a.indexOf("msword")||
-1!==a.indexOf("ms-word")||-1!==a.indexOf("wordprocessingml")?f+"word-32.svg":-1!==a.indexOf("powerpoint")||-1!==a.indexOf("presentationml")?f+"report-32.svg":f+"generic-32.svg"}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(r,g,f,a){function c(a){var c=null;b.some(function(b){b.pattern.test(a)&&(c=b);return!!c});return c}Object.defineProperty(g,"__esModule",{value:!0});var b=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:f.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:f.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:f.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:f.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:f.openInApp,appName:"Microsoft Power Bi"}];g.autoLink=function(b){if("string"!==typeof b||!b)return b;var e=c(b);if(!e)return b;var d=b.match(e.pattern),d=a.substitute({appName:e.appName,hierPart:d&&d[2]},e.label);return b.replace(e.pattern,
"\x3ca "+(e.target?'target\x3d"'+e.target+'"':"")+'" href\x3d"$1"\x3e'+d+"\x3c/a\x3e")}})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(r,g,f,a,c,b,l,e,d,h){return function(e){function n(a){a=e.call(this)||this;a._animationDelay=500;a._animationPromise=null;a.location=
null;a.view=null;a.visible=!1;a.viewModel=new d;return a}f(n,e);n.prototype.postInitialize=function(){var a=this;this.own([b.watch(this,"visible",function(b){return a._visibleChange(b)})])};n.prototype.destroy=function(){this._cancelAnimationPromise()};n.prototype.show=function(a){var b=this,c=a.location;a=a.promise;c&&(this.viewModel.location=c);this.visible=!0;a&&a.always(function(){return b.hide()})};n.prototype.hide=function(){this.visible=!1};n.prototype.render=function(){var a=this.visible,
b=!!this.viewModel.screenLocation,a=(c={},c["esri-spinner--start"]=a&&b,c["esri-spinner--finish"]=!a&&b,c),c=this._getPositionStyles();return h.tsx("div",{class:this.classes("esri-spinner",a),styles:c});var c};n.prototype._cancelAnimationPromise=function(){this._animationPromise&&(this._animationPromise.cancel(),this._animationPromise=null)};n.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=c.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=
!1;b._animationPromise=null}))};n.prototype._getPositionStyles=function(){var a=this.viewModel,b=a.screenLocation,a=a.view;if(!a||!b)return{};a=a.padding;return{left:b.x-a.left+"px",top:b.y-a.top+"px"}};a([l.aliasOf("viewModel.location")],n.prototype,"location",void 0);a([l.aliasOf("viewModel.view")],n.prototype,"view",void 0);a([l.property(),h.renderable()],n.prototype,"visible",void 0);a([l.property({type:d}),h.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],n.prototype,
"viewModel",void 0);return n=a([l.subclass("esri.widgets.Spinner")],n)}(l.declared(e))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b,l,e,d,h){return function(b){function c(){var a=b.call(this)||this;a._anchorHandles=
new l;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([d.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),d.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}f(c,b);c.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};c.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");
this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=e.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};c.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};c.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};c.prototype._toggleWatchingViewpoint=
function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};c.prototype._setScreenLocation=function(){var a=this.location,b=this.view,c=this.screenLocationEnabled,d=this.get("view.ready"),a=c&&a&&d?b.toScreen(a):null;this._set("screenLocation",a)};a([h.property()],c.prototype,"location",void 0);a([h.property({readOnly:!0})],c.prototype,"screenLocation",void 0);a([h.property()],c.prototype,"screenLocationEnabled",void 0);a([h.property()],c.prototype,
"view",void 0);return c=a([h.subclass("esri.widgets.support.AnchorElementViewModel")],c)}(h.declared(c,b))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/webMercatorUtils ../../support/Action ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){function x(a,b){return b.allLayerViews.find(function(b){return b.layer===a})}r=new q({id:"zoom-to"});var v=new (b.ofType(q))([r]),y=d.getLogger("esri.widgets.Popup.PopupViewModel");return function(d){function m(a){a=d.call(this)||this;a._handles=new e;a._originalActions=null;a._pendingPromises=new Set;a.actions=v;a.autoCloseEnabled=!1;a.content=null;a.highlightEnabled=!0;a.title=null;a.updateLocationEnabled=!1;a.view=null;a.visible=!1;a.zoomFactor=4;return a}
f(m,d);m.prototype.initialize=function(){this._handles.add([this.on("view-change",this._autoClose),n.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),n.watch(this,"selectedFeature.popupTemplate.actions",this._getSelectedFeatureActions),n.watch(this,"selectedFeature.popupTemplate.overwriteActions",this._getSelectedFeatureActions)])};m.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(m.prototype,
"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var b=this.pendingPromisesCount,c=this.selectedFeatureIndex,d=this.promiseCount&&a.length;d&&b&&-1===c?this.selectedFeatureIndex=0:d&&-1!==c||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"location",{get:function(){return this._get("location")||
null},set:function(a){var b=this.get("location"),c=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&c&&(a=k.geographicToWebMercator(a));this._set("location",a);a!==b&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&
0===this.featureCount},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var b=this,c=this._get("promises");c&&c.forEach(function(a){a&&"function"===typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),
a.forEach(function(a){b._pendingPromises.add(a);a.then(function(c){b._updatePendingPromises(a);b._updateFeatures(c)},function(){return b._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"selectedFeature",{get:function(){var a=this.selectedFeatureIndex;if(-1===a)return null;a=this.features[a];if(!a)return null;this.updateLocationEnabled&&(this.location=this._getPointFromGeometry(a.geometry));
return a},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var b=this.featureCount;a=isNaN(a)||-1>a||!b?-1:(a+b)%b;this._set("selectedFeatureIndex",a)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});m.prototype.centerAtLocation=function(){var a=
this.location,b=this.view;return a&&b?this.callGoTo({target:{target:a,scale:b.scale}}):(a=new l("center-at-location:invalid-location-or-view","Cannot center at a location without a location and view.",{location:a,view:b}),y.error(a),h.reject(a))};m.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};m.prototype.open=function(a){this.set(c({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};m.prototype.triggerAction=
function(a){(a=this.actions.getItemAt(a))&&this.emit("trigger-action",{action:a})};m.prototype.next=function(){this.selectedFeatureIndex+=1;return this};m.prototype.previous=function(){--this.selectedFeatureIndex;return this};m.prototype.zoomToLocation=function(){var a=this,b=this.location,c=this.selectedFeature,d=this.view,e=this.zoomFactor;if(!b||!d)return c=new l("zoom-to:invalid-location-or-view","Cannot zoom to location without a location and view.",{location:b,view:d}),y.error(c),h.reject(c);
var e=d.scale/e,v=this.get("selectedFeature.geometry"),d=c&&"3d"===d.type,b=(d=v||d)?c:b,k=d&&v&&"point"===v.type&&this._isScreenSize(c);return this.callGoTo({target:{target:b,scale:k?e:void 0}}).then(function(){k&&"point"===v.type&&(a.location=v)})};m.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};m.prototype._setVisibleWhenContentExists=function(){var a=this,b=this._handles,c=this.promiseCount;
b.remove("pendingVisible");c?(c=n.init(this,"pendingPromisesCount",function(c){a.featureCount&&(a.set("visible",!0),b.remove("pendingVisible"));c||b.remove("pendingVisible")}),b.add(c,"pendingVisible")):this.set("visible",!0)};m.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};m.prototype._isScreenSize=function(a){var b=this.view;if("3d"!==b.type||"esri.Graphic"!==a.declaredClass)return!0;if((b=b.getViewForGraphic(a))&&b.whenGraphicBounds){var c=!1;b.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){c=
!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return c}return!0};m.prototype._getSelectedFeatureActions=function(){this._originalActions&&(this.actions=this._originalActions,this._originalActions=null);var a=this.actions.filter(function(a){return!a.temporary}),b=this.get("selectedFeature.popupTemplate");b&&b.overwriteActions&&(this._originalActions=a);this.actions=this._getNewActions(b,a)};m.prototype._getNewActions=
function(a,b){if(!a||!a.actions)return b;var c=a.actions;c.forEach(function(a){a.temporary=!0});return a.overwriteActions?c:b.concat(c)};m.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type||"polyline"===a.type?a.extent.center:null:null};m.prototype._centerAtLocation=function(){var a=this.location,b=this.updateLocationEnabled,c=this.get("view.extent");b&&c&&a&&!c.contains(a)&&this.centerAtLocation()};
m.prototype._highlightFeature=function(){this._handles.remove("highlight");var a=this.selectedFeature,b=this.highlightEnabled,c=this.view,d=this.visible;a&&c&&b&&d&&(b=a.layer)&&(c=x(b,c))&&"function"===typeof c.highlight&&(b=b.objectIdField,d=a.attributes,a=c.highlight(d&&d[b]||a,{}),this._handles.add(a,"highlight"))};m.prototype._updateFeatures=function(a){var b=this.features;a&&a.length&&(b.length?(a=a.filter(function(a){return-1===b.indexOf(a)}),this.features=b.concat(a)):this.features=a)};a([t.property({type:b.ofType(q)})],
m.prototype,"actions",void 0);a([t.property()],m.prototype,"autoCloseEnabled",void 0);a([t.property()],m.prototype,"content",void 0);a([t.property({readOnly:!0,dependsOn:["features"]})],m.prototype,"featureCount",null);a([t.property()],m.prototype,"features",null);a([t.property()],m.prototype,"highlightEnabled",void 0);a([t.property({type:p})],m.prototype,"location",null);a([t.property({readOnly:!0,dependsOn:["promises"]})],m.prototype,"pendingPromisesCount",null);a([t.property({readOnly:!0,dependsOn:["featureCount",
"pendingPromisesCount"]})],m.prototype,"waitingForResult",null);a([t.property({readOnly:!0,dependsOn:["promises"]})],m.prototype,"promiseCount",null);a([t.property()],m.prototype,"promises",null);a([t.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],m.prototype,"selectedFeature",null);a([t.property({value:-1})],m.prototype,"selectedFeatureIndex",null);a([t.property({readOnly:!0,dependsOn:["view.ready"]})],m.prototype,"state",null);a([t.property()],
m.prototype,"title",void 0);a([t.property()],m.prototype,"updateLocationEnabled",void 0);a([t.property()],m.prototype,"view",void 0);a([t.property()],m.prototype,"visible",void 0);a([t.property()],m.prototype,"zoomFactor",void 0);a([t.property()],m.prototype,"centerAtLocation",null);a([t.property()],m.prototype,"clear",null);a([t.property()],m.prototype,"triggerAction",null);a([t.property()],m.prototype,"next",null);a([t.property()],m.prototype,"previous",null);a([t.property()],m.prototype,"zoomToLocation",
null);return m=a([t.subclass("esri.widgets.Popup.PopupViewModel")],m)}(t.declared(m,u))})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b){return function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.goToOverride=null;a.view=null;return a}f(e,c);e.prototype.callGoTo=function(a){var b=this.view;return this.goToOverride?
this.goToOverride(b,a):b.goTo(a.target,a.options)};a([b.property()],e.prototype,"goToOverride",void 0);a([b.property()],e.prototype,"view",void 0);return e=a([b.subclass("esri.widgets.support.GoTo")],e)}(b.declared(c))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(r,g,f,a,c,b,l,e,d,h){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function n(){var a=null!==c&&c.apply(this,arguments)||this;a.tilt=new h.default;a.altitude=new l.default;a.clipDistance=new e.default;a.collision=new d.default;return a}f(n,c);a([b.property({type:h.default})],n.prototype,"tilt",void 0);a([b.property({type:l.default})],n.prototype,"altitude",void 0);a([b.property({type:e.default})],n.prototype,"clipDistance",void 0);a([b.property({type:d.default})],n.prototype,
"collision",void 0);return n=a([b.subclass("esri.views.3d.constraints.Constraints")],n)}(b.declared(c));g.Constraints=r;g.default=r})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function d(){var a=
null!==b&&b.apply(this,arguments)||this;a.min=e.AltitudeDefault.min;a.max=e.AltitudeDefault.max;return a}f(d,b);Object.defineProperty(d.prototype,"mode",{get:function(){c.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){c.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});a([l.property({type:Number})],d.prototype,"min",void 0);a([l.property({type:Number})],d.prototype,"max",void 0);return d=a([l.subclass("esri.views.3d.constraints.AltitudeConstraint")],d)}(l.declared(b));g.AltitudeConstraint=r;g.default=r})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});var h=b.getLogger("esri.views.3d.state.Constraints");r=function(b){function c(a){a=b.call(this)||this;a.collision=new t;a.distance=Infinity;a.minimumPoiDistance=4;return a}f(c,b);Object.defineProperty(c.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?h.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});c.prototype.clampAltitude=function(a){return this.altitude?d.clamp(a,this.altitude.min,this.altitude.max):a};c.prototype.clampTilt=function(a,b){if(!this.tilt)return b;a=this.tilt(a);return d.clamp(b,a.min,a.max)};c.prototype.clampDistance=function(a){return Math.min(a,this.distance)};c.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};c.prototype.createConstantMaxTilt=function(a){return function(b,c){void 0===
c&&(c=n);c.min=g.TiltDefault.min;c.max=a;return c}};c.prototype.createDefaultTiltLocal=function(){var a=d.makePiecewiseLinearFunction([[4E3,g.TiltDefault.max],[1E4,d.deg2rad(88)],[6E6,d.deg2rad(88)]]);return function(b,c){void 0===c&&(c=n);c.min=g.TiltDefault.min;c.max=a(b);return c}};c.prototype.createDefaultTiltGlobal=function(){var a=d.makePiecewiseLinearFunction([[4E3,g.TiltDefault.max],[5E4,d.deg2rad(88)],[6E6,d.deg2rad(88)],[2E7,g.TiltDefault.min]]);return function(b,c){void 0===c&&(c=n);c.min=
g.TiltDefault.min;c.max=a(b);return c}};a([l.property()],c.prototype,"altitude",null);a([l.property({readOnly:!0})],c.prototype,"collision",void 0);a([l.property()],c.prototype,"distance",void 0);a([l.property({readOnly:!0})],c.prototype,"minimumPoiDistance",void 0);a([l.property()],c.prototype,"tilt",void 0);a([l.property({constructOnly:!0})],c.prototype,"mode",void 0);return c=a([l.subclass("esri.views.3d.state.Constraints")],c)}(l.declared(c));g.Constraints=r;g.AltitudeDefault={min:-e.earthRadius,
max:4*e.earthRadius};g.TiltDefault={min:d.deg2rad(.5),max:d.deg2rad(179.5)};var n={min:0,max:0},t=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.elevationMargin=5;return a}f(c,b);a([l.property({type:Boolean})],c.prototype,"enabled",void 0);a([l.property({type:Number})],c.prototype,"elevationMargin",void 0);return c=a([l.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(l.declared(c));g.default=r})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.mode="auto";return a}f(e,c);Object.defineProperty(e.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});e.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(e.prototype,"far",{get:function(){return this._get("far")},
set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode="manual"},enumerable:!0,configurable:!0});e.prototype.castFar=function(a){return Math.max(1E-8,a)};e.prototype.autoUpdate=function(a,b){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==b&&this._set("far",b))};a([b.property({type:Number,value:1E-8})],e.prototype,"near",null);a([b.cast("near")],e.prototype,"castNear",null);a([b.property({type:Number,value:1E-8})],e.prototype,"far",
null);a([b.cast("far")],e.prototype,"castFar",null);a([b.property({type:String})],e.prototype,"mode",void 0);return e=a([b.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],e)}(b.declared(c));g.ClipDistanceConstraint=r;g.default=r})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(r,g,
f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.enabled=!0;return a}f(e,c);a([b.property()],e.prototype,"enabled",void 0);return e=a([b.subclass("esri.views.3d.constraints.CollisionConstraint")],e)}(b.declared(c));g.CollisionConstraint=r;g.default=r})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});var d=e.rad2deg(l.TiltDefault.min),h=e.rad2deg(l.TiltDefault.max);r=function(c){function l(){var a=null!==c&&c.apply(this,arguments)||this;a.mode="auto";return a}f(l,c);Object.defineProperty(l.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});l.prototype.castMax=function(a){return e.clamp(a,d,h)};l.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};a([b.property({type:String})],l.prototype,"mode",void 0);a([b.property({type:Number,value:h})],l.prototype,"max",null);a([b.cast("max")],l.prototype,"castMax",null);return l=a([b.subclass("esri.views.3d.constraints.TiltConstraint")],l)}(b.declared(c));g.TiltConstraint=r;g.default=r})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./SceneViewAtmosphere ./SceneViewBackgroundPlain ./SceneViewBackgroundTypes ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){return function(h){function p(){var a=null!==h&&h.apply(this,arguments)||this;a.atmosphere=new b.default;a.atmosphereEnabled=!0;a.starsEnabled=!0;a.background=new l({color:[0,0,0,1]});return a}f(p,h);k=p;Object.defineProperty(p.prototype,"lighting",{set:function(a){if(a)if(this.lighting)null!=a.date&&(this.lighting.date=a.date),null!=a.defaultDate&&(this.lighting.defaultDate=a.defaultDate),null!=a.displayUTCOffset&&(this.lighting.displayUTCOffset=a.displayUTCOffset),
this.lighting.directShadowsEnabled=a.directShadowsEnabled,null!=a.ambientOcclusionEnabled&&(this.lighting.ambientOcclusionEnabled=a.ambientOcclusionEnabled),null!=a.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=a.cameraTrackingEnabled);else if(a instanceof d.default)this._set("lighting",a);else if(a instanceof n){var b={directShadowsEnabled:a.directShadowsEnabled};null!=a.date&&(b.date=a.date);null!=a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);null!=a.defaultDate&&(b.defaultDate=
a.defaultDate);this._set("lighting",new d.default(b))}else this._set("lighting",new d.default(a));else this.lighting||this._set("lighting",new d.default)},enumerable:!0,configurable:!0});p.prototype.clone=function(){return new k({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:this.background?this.background.clone():this.background})};a([c.property({type:b.default,json:{read:!1}})],p.prototype,"atmosphere",
void 0);a([c.property({type:Boolean,json:{read:!1}})],p.prototype,"atmosphereEnabled",void 0);a([c.property({type:Boolean,json:{read:!1}})],p.prototype,"starsEnabled",void 0);a([c.property()],p.prototype,"lighting",null);a([c.property({types:e.backgroundTypes})],p.prototype,"background",void 0);return p=k=a([c.subclass("esri.views.3d.environment.SceneViewEnvironment")],p);var k}(c.declared(h))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}f(e,c);Object.defineProperty(e.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&this._set("quality",a)},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new this.constructor({quality:this.quality})};a([b.property({type:String,value:"low"})],e.prototype,"quality",null);return e=a([b.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
e)}(b.declared(c));g.SceneViewAtmosphere=r;g.default=r})},"esri/views/3d/environment/SceneViewBackgroundPlain":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/accessorSupport/decorators ./SceneViewBackground".split(" "),function(r,g,f,a,c,b,l){return function(e){function d(a){a=e.call(this)||this;a.type="plain";return a}f(d,e);h=d;Object.defineProperty(d.prototype,"color",{get:function(){return this.get("color")},
set:function(a){null==a?this._set("color",new c([0,0,0,0])):this._set("color",a)},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new h(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};a([b.property({type:String,readOnly:!0})],d.prototype,"type",void 0);a([b.property({type:c,value:new c([0,0,0,0])})],d.prototype,"color",null);return d=h=a([b.subclass("esri.views.3d.environment.SceneViewBackgroundPlain")],d);var h}(b.declared(l))})},
"esri/views/3d/environment/SceneViewBackground":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b,l){return function(b){function d(a){return b.call(this)||this}f(d,b);d.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=c({},a),delete a.type);return a};d.prototype.clone=function(){};a([l.property({type:String,
readOnly:!0})],d.prototype,"type",void 0);return d=a([l.subclass("esri.views.3d.environment.SceneViewBackground")],d)}(l.declared(b))})},"esri/views/3d/environment/SceneViewBackgroundTypes":function(){define(["require","exports","./SceneViewBackground","./SceneViewBackgroundPlain"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.backgroundTypes={base:f,key:"type",typeMap:{plain:a}}})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function l(a){a=c.call(this)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var b=(new Date).getFullYear(),b=new Date("March 15, "+b+" 12:00:00 UTC");a._set("defaultDate",b);a._set("date",b);return a}f(l,c);Object.defineProperty(l.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=
this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"date",{set:function(a){null!=a&&(this._set("date",new Date(a.getTime())),this.positionTimezoneInfo.autoUpdated=!1,this._emitDateWillChange())},enumerable:!0,configurable:!0});l.prototype.autoUpdate=function(a,b){var c=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;
this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())),this._emitDateWillChange());var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);c!==d&&(h.target=this,h.timezoneOffset=d,this.emit("timezone-will-change",h));if(null!=a)return b!==a.getTime()};l.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/
60+a.seconds/3600)};l.prototype._emitDateWillChange=function(){d.target=this;e.setTime(this._get("date").getTime());d.date=e;this.emit("date-will-change",d)};a([b.property({type:Boolean})],l.prototype,"cameraTrackingEnabled",void 0);a([b.property({type:Boolean})],l.prototype,"ambientOcclusionEnabled",void 0);a([b.property({type:Date})],l.prototype,"defaultDate",null);a([b.property({type:Date})],l.prototype,"date",null);return l=a([b.subclass("esri.views.3d.environment.SceneViewLighting")],l)}(b.declared(l,
c));g.SceneViewLighting=r;var e=new Date,d={target:null,date:null},h={target:null,timezoneOffset:0};g.default=r})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b){return function(c){function e(a){a=c.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}f(e,c);d=e;e.prototype.readDate=function(a,
b){return null!=b.datetime&&new Date(b.datetime)||null};e.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};e.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};e.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};e.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};e.prototype.clone=function(){return new d({date:null!=this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null})};e.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};a([b.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],e.prototype,"date",void 0);a([b.reader("date",["datetime"])],e.prototype,"readDate",null);a([b.writer("date")],e.prototype,"writeDate",null);a([b.property({type:Boolean,json:{write:{target:"directShadows"}}})],
e.prototype,"directShadowsEnabled",void 0);a([b.reader("directShadowsEnabled",["directShadows"])],e.prototype,"readDirectShadowsEnabled",null);a([b.writer("directShadowsEnabled")],e.prototype,"writedirectShadowsEnabled",null);a([b.property({type:Number,json:{write:!0}})],e.prototype,"displayUTCOffset",void 0);a([b.writer("displayUTCOffset")],e.prototype,"writeDisplayUTCOffset",null);return e=d=a([b.subclass("esri.webscene.Lighting")],e);var d}(b.declared(c))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./Lighting".split(" "),
function(r,g,f,a,c,b,l){return function(c){function d(a){a=c.call(this,a)||this;a.lighting=new l;return a}f(d,c);e=d;d.prototype.clone=function(){return new e({lighting:l.prototype.clone.call(this.lighting)})};d.sanitizeJSON=function(a){return{lighting:a.lighting?l.sanitizeJSON(a.lighting):(new l).toJSON()}};a([b.property({type:l,json:{write:!0}})],d.prototype,"lighting",void 0);return d=e=a([b.subclass("esri.webscene.Environment")],d);var e}(b.declared(c))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ./SceneViewBackgroundPlain ../lib/glMatrix ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){Object.defineProperty(g,"__esModule",{value:!0});var y=[.5773502691896258,-.5773502691896258,.5773502691896258];r=function(b){function c(a){a=b.call(this)||this;a.referencePointUpdateDelay=200;a.referencePointUpdateInterval=3E3;a.referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new l;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._viewConnected=!1;a._referencePosResetPreserveAbsoluteTime=
!1;a._referencePosUpdateTimer=null;a._referencePosWGS84=null;a._referencePosMapCoords=null;a._mainLight=new v.MainLight;a._ambientLight=new v.AmbientLight;a._moonLight=new v.FillLight;a._environmentRenderer=null;a._resetReferencePosition();return a}f(c,b);c.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(c.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)},
enumerable:!0,configurable:!0});c.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};c.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};c.prototype.connectView=function(a){this._environmentRenderer=new k({view:a});this._viewHandles.add([d.on(this.view,
"environment.lighting","date-will-change",this._lightingDateHandler.bind(this)),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),d.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),d.init(this.view,
"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};c.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)a=d.init(this,"view.state.camera",this._cameraHandler.bind(this,null),!0),this._viewHandles.add(a,"camera");else{if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=
!1;this._viewHandles.remove("camera")}};c.prototype.disconnectView=function(a){this.disposeRendering();this._viewHandles.removeAll()};c.prototype._lightingDateHandler=function(a){if(a=a.date){var b=this.view.environment.lighting;if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var c=this.view.spatialReference;if(!(c.isWGS84||c.isWebMercator||(c=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(c)))){this._requestReferencePositionUpdate(c);
return}this._preupdateTracking(a);this._referencePosWGS84&&(c=u.positionToTimezone(this._referencePosWGS84,C),b.autoUpdate(null,c),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};c.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};c.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var b=this.view.camera;if(b){var c=this.view.spatialReference;
c.isWGS84||c.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}}};c.prototype._cameraHandlerGlobal=function(a,b){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new n({spatialReference:t.WGS84}));a.spatialReference.isWebMercator?p.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,b)||this._updateLightParams(b)};c.prototype._cameraHandlerLocal=
function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};c.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};c.prototype._updateLightParams=
function(a){void 0===a&&(a=null);var b=this.view.environment.lighting;a=a||b.date;var b=this.view._stage,c;this._referencePosWGS84?(c=x.computeColorAndIntensity(a,this._referencePosWGS84),x.computeDirection(a,this._referencePosWGS84,this.view.viewingMode,c.diffuse.direction)):c={diffuse:{color:[1,1,1],intensity:.55,direction:y},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};m.vec3d.scale(c.diffuse.color,c.diffuse.intensity*Math.PI,this._mainLight.intensity);m.vec3d.negate(c.diffuse.direction,
this._mainLight.direction);m.vec3d.scale(c.ambient.color,c.ambient.intensity,this._ambientLight.intensity);m.vec3d.lerp(B,D,c.globalFactor,this._moonLight.intensity);m.vec3d.scale(this._moonLight.intensity,(1-.5*c.globalFactor)*(1-.4*c.noonFactor*(1-c.globalFactor)));m.vec3d.set(c.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:c.globalFactor,groundLightingFactor:1-c.noonFactor});this._updateRenderParamsHandler()};
c.prototype._autoUpdateTimezone=function(a,b){void 0===b&&(b=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var c=A;c.setTime((b||this.view.environment.lighting.date).getTime());a=u.positionToTimezone(a,C);var d=this.view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=a;else if(d.hours===a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1;var e=c.getUTCHours()-(a.hours-d.hours),v=c.getUTCMinutes()-(a.minutes-d.minutes),d=c.getUTCSeconds()-
(a.seconds-d.seconds);c.setUTCHours(e);c.setUTCMinutes(v);c.setUTCSeconds(d);return b?!1:this.view.environment.lighting.autoUpdate(c,a)};c.prototype._updateRenderParamsHandler=function(){var a=this.view._stage,b=!0;this._referencePosWGS84&&(b=x.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var c=this.view.environment.background;c&&c instanceof q?(c=c.color,c={type:"plain",color:[c.r/255,c.g/255,c.b/255,c.a]}):c={type:"plain",color:[0,0,0,1]};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&
b,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:c})};c.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};c.prototype._viewingModeHandler=function(){this._resetReferencePosition()};c.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};
c.prototype._requestReferencePositionUpdate=function(a,b){var c=this;void 0===b&&(b=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var d=this._referencePosUpdateQuery=e.after(this.referencePointUpdateDelay).then(function(){if(c._referencePosUpdateQuery===
d)return c._doReferencePositionUpdateQuery(function(){return c._referencePosUpdateQuery!==d})}).always(function(){c._referencePosUpdateQuery===d&&(c._referencePosUpdateQuery=null,c._referencePosUpdateTimer||c._executePendingReferencePositionUpdate(),c.notifyChange("updating"))}),v=this._referencePosUpdateTimer=e.after(this.referencePointUpdateInterval).then(function(){c._referencePosUpdateTimer===v&&(c._referencePosUpdateTimer=null,c._referencePosUpdateQuery||c._executePendingReferencePositionUpdate())});
this.notifyChange("updating")}};c.prototype._doReferencePositionUpdateQuery=function(a){var b=this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(c){if(!a()&&
!isNaN(c[0])&&!isNaN(c[1])){var d=b._referencePosMapCoords.z*b.view.mapCoordsHelper.unitInMeters;b._referencePosWGS84?(b._referencePosWGS84.x=c[0],b._referencePosWGS84.y=c[1],b._referencePosWGS84.z=d):b._referencePosWGS84=new n({x:c[0],y:c[1],z:d,spatialReference:t.WGS84});b._referencePosChanged()}})};c.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};c.prototype._referencePosChanged=
function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};c.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};c.prototype._cancelReferencePosUpdates=function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=
null};c.FIXED_LIGHT_DIRECTION=y;a([h.property({type:Boolean,dependsOn:["noReferencePositionQueries"],readOnly:!0})],c.prototype,"updating",null);a([h.property()],c.prototype,"noReferencePositionQueries",void 0);a([h.property({constructOnly:!0})],c.prototype,"view",void 0);a([h.property()],c.prototype,"_environmentRenderer",void 0);return c=a([h.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],c)}(h.declared(c,b));g.SceneViewEnvironmentManager=r;var A=new Date,C={hours:0,minutes:0,
seconds:0},B=m.vec3d.createFrom(.22,.22,.33),D=m.vec3d.createFrom(.22,.22,.22);g.default=r})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../core/watchUtils ../support/ExternalRenderer ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(r,g,f,a,c,b,l){return g.createSubclass({declaredClass:"esri.views.3d.environment.EnvironmentRenderer",properties:{view:{},viewingMode:{dependsOn:["view.viewingMode"],
get:function(){return this.get("view.viewingMode")||"global"}},atmosphereQuality:{dependsOn:["view.environment.atmosphereEnabled","view.environment.atmosphere.quality"],get:function(){return this.get("view.environment.atmosphereEnabled")?this.get("view.environment.atmosphere.quality")||"none":"none"}},starsEnabled:{dependsOn:["view.environment.starsEnabled"],get:function(){return this.get("view.environment.starsEnabled")||!1}},transparent:{dependsOn:["view.basemapTerrain.opacity","view.basemapTerrain.wireframe"],
get:function(){var a=this.get("view.basemapTerrain");return a&&a._renderer.isTransparent()}},_atmosphere:{},_stars:{},needsRender:{dependsOn:["_stars.needsRender","_atmosphere.needsRender"],get:function(){return!!(this._needsRender||this._atmosphere&&this._atmosphere.needsRender||this._stars&&this._stars.needsRender)}}},constructor:function(){this._slots=[l.POSTPROCESSING_ATMOSPHERE_OPAQUE,l.POSTPROCESSING_ATMOSPHERE_TRANSPARENT];this._stars=this._atmosphere=this._atmosphereReadyPromise=this._AtmosphereClass=
null;this._needsRender=!0;this.notifyChange("needsRender")},initialize:function(){this.view._stage.addExternalRenderer(this._slots,this);this._basemapTerrainHandle=r.when(this.view,"basemapTerrain",this._updateBasemapTerrain.bind(this))},destroy:function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._basemapTerrainHandle&&this._basemapTerrainHandle.remove();this.view&&(this.view._stage.removeExternalRenderer(this),
this.view=null)},setup:function(a){this.watch("viewingMode,atmosphereQuality,transparent,visible",this._updateAtmosphere.bind(this));this._updateAtmosphere();this.watch("starsEnabled,transparent,visible",this._updateStars.bind(this));this._updateStars();this.watch("view.basemapTerrain.loaded",function(){this._needsRender=!0;this.notifyChange("needsRender")}.bind(this))},resetNeedsRender:function(){this._atmosphere&&(this._atmosphere.resetNeedsRender?this._atmosphere.resetNeedsRender():this._atmosphere.didRender&&
(this._atmosphere.needsRender=!1,this._atmosphere.didRender=!1));this._stars&&(this._stars.resetNeedsRender?this._stars.resetNeedsRender():this._stars.didRender&&(this._stars.needsRender=!1,this._stars.didRender=!1));this.didRender&&(this.didRender=this._needsRender=!1,this.notifyChange("needsRender"))},render:function(a){if(!this.get("view.basemapTerrain.loaded")&&"global"===this.viewingMode)return!1;if(!this._stars&&!this._atmosphere)return!0;this._stars&&this._stars.render(a);this._atmosphere&&
this._atmosphere.render(a);return this._stars&&this._stars.didRender||this._atmosphere&&this._atmosphere.didRender},_updateStars:function(){var a=this._getSimpleAtmosphereSlot();this.starsEnabled&&!this._stars?(this._stars=new b({view:this.view,slot:a}),this._stars.initializeRenderContext(this.renderContext)):!this.starsEnabled&&this._stars?(this._stars.destroy(),this._stars=null):this._stars&&(this._stars.slot=a);this._needsRender=!0;this.notifyChange("needsRender")},_updateAtmosphere:function(){var a=
this._getSimpleAtmosphereSlot();this._atmosphere&&(this._atmosphere.slot=a);if(this._updateAtmosphereClass(this.renderContext)){this._needsRender=!0;this.notifyChange("needsRender");var b=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null)}.bind(this);if(this._AtmosphereClass){this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);var c=new this._AtmosphereClass({view:this.view,slot:a});c.initializeRenderContext(this.renderContext);
this._atmosphere?this._atmosphereReadyPromise=c.when(function(){b();this._atmosphereReadyPromise=null;this._atmosphere=c}.bind(this)):this._atmosphere=c;c.when(this._updateBasemapTerrain.bind(this))}else b(),this._updateBasemapTerrain()}},_updateAtmosphereClass:function(b){var d=this._AtmosphereClass;"none"===this.atmosphereQuality?this._AtmosphereClass=null:"high"===this.atmosphereQuality&&a.isSupported(b)?this._AtmosphereClass="local"===this.viewingMode?f:a:this._AtmosphereClass="local"===this.viewingMode?
f:c;return this._AtmosphereClass!==d},_getSimpleAtmosphereSlot:function(){return this.transparent&&"global"===this.viewingMode?l.POSTPROCESSING_ATMOSPHERE_TRANSPARENT:l.POSTPROCESSING_ATMOSPHERE_OPAQUE},_updateBasemapTerrain:function(){var b=this.get("view.basemapTerrain");b&&(b.velvetOverground=!(!this._AtmosphereClass||this._AtmosphereClass===a))}})})},"esri/views/3d/support/ExternalRenderer":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Promise dojo/Deferred dojo/aspect dojo/_base/lang".split(" "),
function(r,g,f,a,c,b){return r([g,f],{"-chains-":b.mixin(g._meta.chains,{setup:"after",initializeRenderContext:"after",uninitializeRenderContext:"before"}),properties:{gl:{readOnly:!0,get:function(){return this._gl}},needsRender:{value:!0},visible:{value:!0}},constructor:function(){this.didRender=!1;this.renderContext=null;this.watch("visible",function(){this.needsRender=!0}.bind(this));this._contextDfd=new a},initialize:function(){this.addResolvingPromise(this._contextDfd.promise);c.around(this,
"render",function(a){return function(){return this.isRejected()?this.didRender=!0:this.isResolved()?!this.visible||a.apply(this,arguments)?this.didRender=!0:!1:!1}.bind(this)}.bind(this));this.when(function(){this.destroyed||this.setup(this.renderContext)}.bind(this))},needsRender:!0,visible:!0,initializeRenderContext:function(a){this.renderContext=a;this._contextDfd.resolve()},uninitializeRenderContext:function(a){},setup:function(a){},render:function(a){return!1}})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){var m=a.vec2d,u=a.vec3d,x=a.mat4d,v=e.VertexAttrConstants,y=x.create();return f.createSubclass({declaredClass:"esri.views.3d.environment.PanoramicAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:n.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:m.create(),silCircleCenter:u.create(),silCircleV1:u.create(),silCircleV2:u.create()};this._textureRep=this._texture=null;this.slot=
n.BACKGROUND},initialize:function(){this._textureDfd=new g;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new d({SimpleAtmosphere:new l(t,
"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view.state.camera.viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var b=this._createGeometryData(),d=this.renderContext.rctx;this._renderer=new c(b,k.Pos3,null,d);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(r);this._program=new p(d,a.shaderSnippets.vsSimpleAtmosphere,
a.shaderSnippets.fsSimpleAtmosphere,q.Default3D,["PANORAMIC"])},render:function(a){if(a.slot!==this.slot||a.pass!==h.MATERIAL||!this._textureRep.getIsLoaded("SimpleAtmosphere"))return!1;var b=this.renderContext.rctx,c=b.gl,d=this._program;b.bindProgram(d);b.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);x.toRotationMat(a.camera.viewMatrix,y);d.setUniformMatrix4fv("view",y);d.setUniform4f("color",1,1,1,1);d.setUniform3fv("lightDirection",
a.lightingData.direction);b.setDepthTestEnabled(!0);b.setFaceCullingEnabled(!0);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);this._renderer.render(this._program);b.setDepthWriteEnabled(!0);b.setBlendingEnabled(!1);b.setDepthFunction(c.LESS);b.setFaceCullingEnabled(!1);return!0},_createGeometryData:function(){for(var a=b.createPolySphereGeometry(1,2),c=a.indices[v.POSITION],d=0;d<c.length;d+=3){var e=c[d];c[d]=c[d+2];c[d+2]=e}c=a.getVertexAttr();e=c[v.NORMAL].data;
for(d=0;d<e.length;d++)e[d]=-e[d];return{indices:a.indices,vertexAttr:c}}})})},"esri/views/3d/webgl-engine/lib/GeometryRenderer":function(){define("require exports ./DefaultVertexAttributeLocations ./Util ../materials/internal/MaterialUtil ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),function(r,g,f,a,c,b,l,e){return function(){function d(d,n,t,p){this._drawMode=4;this._count=d.indices[a.VertexAttrConstants.POSITION].length;var k=new Float32Array(this._count*
l.getStride(n)/4);t?t(d,void 0,void 0,null,n,k,0):c.fillInterleaved(d,void 0,void 0,null,n,k,0);this._rctx=p;this._vao=new e(p,f.Default3D,{geometry:n},{geometry:b.createVertex(p,35044,k)})}d.prototype.enablePointRendering=function(a){this._drawMode=a?0:4};d.prototype.render=function(a){var b=this._rctx;b.bindVAO(this._vao);l.assertCompatibleVertexAttributeLocations(this._vao,a);b.drawArrays(this._drawMode,0,this._count)};return d}()})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12}})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","../../support/geometryUtils","./gl-matrix"],function(r,g,f,a){function c(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),
new aa(b);}function b(a,b,c){return a<b?b:a>c?c:a}function l(a){return a/180*Math.PI}function e(a){return 180*a/Math.PI}function d(b,c,d){a.mat4d.multiply(c,b,m);a.mat4d.inverse(m);for(b=0;8>b;++b)a.mat4d.multiplyVec4(m,u[b],x),a.vec3d.set3(x[0]/x[3],x[1]/x[3],x[2]/x[3],d[b])}function h(a,b){f.plane.fromPoints(a[4],a[0],a[3],b[0]);f.plane.fromPoints(a[1],a[5],a[6],b[1]);f.plane.fromPoints(a[4],a[5],a[1],b[2]);f.plane.fromPoints(a[3],a[2],a[6],b[3]);f.plane.fromPoints(a[0],a[1],a[2],b[4]);f.plane.fromPoints(a[5],
a[4],a[7],b[5])}function n(a,b,c,d){var e=6378137/Math.sqrt(1-g.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),v=Math.cos(a);d[0]=(e+c)*Math.cos(b)*v;d[1]=(e*(1-g.ECCENTRICITY_SQUARED)+c)*Math.sin(a);d[2]=-(e+c)*Math.sin(b)*v}function t(a){for(var b in a)return b}function p(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function k(a,b){void 0===b&&(b=0);for(var c=0,d=0;4>d;d++)c+=a[b+d]*S[d];return c}function q(a){return a-Math.floor(a)}Object.defineProperty(g,"__esModule",{value:!0});var m=a.mat4d.create(),
u=[a.vec4d.createFrom(-1,-1,-1,1),a.vec4d.createFrom(1,-1,-1,1),a.vec4d.createFrom(1,1,-1,1),a.vec4d.createFrom(-1,1,-1,1),a.vec4d.createFrom(-1,-1,1,1),a.vec4d.createFrom(1,-1,1,1),a.vec4d.createFrom(1,1,1,1),a.vec4d.createFrom(-1,1,1,1)],x=a.vec4d.create(),v=[a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create()],y=a.vec3d.create(),A=a.vec3d.create(),C=a.vec3d.create(),B=a.vec3d.create(),D=a.vec3d.create(),E=a.vec3d.create(),
H=a.vec3d.create(),F=a.vec3d.create(),L=a.vec3d.create(),G=a.vec3d.create(),P=a.vec3d.create(),J=a.vec3d.create(),M=a.vec3d.create(),O=a.vec3d.createFrom(0,0,0),aa=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();g.AssertException=aa;g.EARTH_RADIUS=6378137;g.METER2FEET=3.28084;g.ECCENTRICITY_SQUARED=.0066943799901414;g.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",
AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};g.assert=c;g.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};g.isPowerOfTwo=function(a){return 0===(a&a-1)};g.lerp=function(a,b,c){return a+(b-a)*c};g.clamp=b;g.encodeInt16=function(a){return b(Math.round(32767*a),-32767,32767)};g.encodeNormal=function(a,b){var c=Math.abs(a[0]),d=Math.abs(a[1]),e=1/(c+d+Math.abs(a[2])),c=c*e,d=d*e,e=Math.min(a[2]*
e,0);b[0]=V(a[0])*(c-e);b[1]=V(a[1])*(d-e)};var V="function"===typeof Math.sign?Math.sign:function(a){return+(0<a)-+(0>a)||0};g.fallbackIfUndefined=function(a,b){return void 0===a?b:a};g.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};g.rgb2hex=function(a){var c=b(Math.round(255*a[0]),0,255),d=b(Math.round(255*a[1]),0,255);a=b(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(d<<8)+a).toString(16)};g.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,
8-a.length)+a};g.deg2rad=l;g.rad2deg=e;g.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};g.raySphere=function(b,c,d,e,v){d=d||O;var k=a.vec3d.subtract(b,d,y);d=a.vec3d.dot(c,c);var h=2*a.vec3d.dot(c,k);e=a.vec3d.dot(k,k)-e*e;e=h*h-4*d*e;if(0>e)return!1;k=Math.sqrt(e);e=(-h-k)/(2*d);d=(-h+k)/(2*d);if(0>e||d<e&&0<d)e=d;return 0<e?(v&&a.vec3d.add(b,a.vec3d.scale(c,e,M),v),!0):!1};g.rayTriangle3D=function(b,
c,d,e,v,k,h,q,l){void 0===l&&(l=a.vec3d.create());var m=e[h]-d[k],n=e[h+1]-d[k+1],f=e[h+2]-d[k+2];e=v[q]-d[k];h=v[q+1]-d[k+1];v=v[q+2]-d[k+2];var y=c[1]*v-h*c[2],A=c[2]*e-v*c[0],u=c[0]*h-e*c[1];q=m*y+n*A+f*u;if(-1E-5<q&&1E-5>q)return!1;q=1/q;var p=b[0]-d[k],t=b[1]-d[k+1];b=b[2]-d[k+2];l[1]=q*(p*y+t*A+b*u);if(0>l[1]||1<l[1])return!1;d=t*f-n*b;b=b*m-f*p;m=p*n-m*t;l[2]=q*(c[0]*d+c[1]*b+c[2]*m);if(0>l[2]||1<l[1]+l[2])return!1;l[0]=q*(e*d+h*b+v*m);return!0};g.rayBoxTest=function(a,b,c,d){var e,v=(c[0]-
a[0])/b[0],k=(d[0]-a[0])/b[0];v>k&&(e=v,v=k,k=e);var h=(c[1]-a[1])/b[1],q=(d[1]-a[1])/b[1];h>q&&(e=h,h=q,q=e);if(v>q||h>k)return!1;h>v&&(v=h);q<k&&(k=q);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];c>a&&(e=c,c=a,a=e);if(v>a||c>k)return!1;a<k&&(k=a);return 0>k?!1:!0};g.rayRay2D=function(b,c,d,e,v,k){void 0===k&&(k=a.vec2d.create());var h=(e[v]-d[v])*(c[0]-b[0])-(e[0]-d[0])*(c[v]-b[v]);if(0===h)return!1;d=((e[0]-d[0])*(b[v]-d[v])-(e[v]-d[v])*(b[0]-d[0]))/h;k[0]=b[0]+d*(c[0]-b[0]);k[1]=b[v]+d*(c[v]-b[v]);return!0};
g.matrixToFrustumPoints=d;g.matrixToFrustumPlanes=function(a,b,c,e){void 0===e&&(e=c,c=v);d(a,b,c);h(c,e)};g.frustumPointsToPlanes=h;g.project=function(b,d,e,v,k){k||(k=b);x[0]=b[0];x[1]=b[1];x[2]=b[2];x[3]=1;a.mat4d.multiplyVec4(d,x);2<k.length&&(k[2]=-x[2]);a.mat4d.multiplyVec4(e,x);c(0!==x[3]);k[0]=x[0]/x[3];k[1]=x[1]/x[3];k[2]=x[2]/x[3];k[0]=(.5*k[0]+.5)*v[2]+v[0];k[1]=(.5*k[1]+.5)*v[3]+v[1]};g.geodeticToGeocentricLatidude=function(a){return Math.atan((1-g.ECCENTRICITY_SQUARED)*Math.tan(a))};
g.latLon2positionWGS84Ellipsoid=n;g.pos2latLon=function(c,d){var v=a.vec3d.length(c);d[0]=Math.asin(b(c[1]/v,-1,1));d[1]=(0>c[2]?1:-1)*Math.acos(b(c[0]/(Math.cos(d[0])*v),-1,1));d[0]=e(d[0]);d[1]=e(d[1]);d[2]=v};g.pos2latLonWGS84Ellipsoid=function(a,b){var c=a[0],d=-a[2],e=a[1],v=Math.sqrt(Math.pow(6378137,2)*(1-g.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));var k=Math.atan2(6378137*e,v*a),c=Math.atan2(d,c),d=Math.atan2(e+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(v,2))/Math.pow(v,
2)),2)*v*Math.pow(Math.sin(k),3),a-6378137*g.ECCENTRICITY_SQUARED*Math.pow(Math.cos(k),3));a=a/Math.cos(d)-6378137/Math.sqrt(1-g.ECCENTRICITY_SQUARED*Math.pow(Math.sin(d),2))+g.EARTH_RADIUS;b[0]=d;b[1]=c;b[2]=a};g.computeGlobeTransformation=function(b,c,d){var e=l(b[0]);b=l(b[1]);n(e,b,c,A);a.mat4d.translate(d,A);a.mat4d.rotateY(d,.5*Math.PI+b);a.mat4d.rotateX(d,.5*Math.PI-e);return d};g.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};g.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<
16)+(a[b+3]<<24)};g.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};g.array2object=function(a,b){var c={};if(void 0!==b)for(var d=0;d<a.length;d++){var e=a[d];c[b(e)]=e}else for(b=0;b<a.length;b++)e=a[b],c[e]=e;return c};g.object2array=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};g.mergeObjects=function(a,b,c){void 0===c&&(c={});if(c!==a)for(var d in a)c[d]=a[d];if(c!==b)for(var e in b)c[e]=b[e];return c};g.subtractObjects=function(a,b){var c={},d;for(d in a)void 0===b[d]&&(c[d]=
a[d]);return c};g.intersectObjects=function(a,b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=a[d]);return c};g.getFirstObjectKey=t;g.getFirstObjectValue=function(a){return a[t(a)]};g.objectEmpty=function(a){for(var b in a)return!1;return!0};g.byteBuffer2base64image=function(a,b,d,e,v){var k=4*b;c(a.length===k*d,"buffer length must match image resolution");var h=document.createElement("canvas");h.width=b;h.height=d;var q=h.getContext("2d");b=q.getImageData(0,0,b,d);for(var l=b.data,m=0;m<d;++m)for(var n=
m*k,f=(d-1-m)*k,y=0;y<k;++y)l[n++]=a[f++];q.putImageData(b,0,0);return h.toDataURL(e,v)};g.cround=function(a){return Math.round(100*a)/100};g.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};g.setMatrixTranslation=p;g.setMatrixTranslation3=function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d};g.getMatrixTranslation=function(b,c){void 0===c&&(c=a.vec3d.create());c[0]=b[12];c[1]=b[13];c[2]=b[14];return c};g.createTranslationMatrix=function(b,c){b=a.mat4d.identity(b);p(b,c);return b};g.isTranslationMatrix=
function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};g.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};g.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};g.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};g.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};g.fovd2fovx=function(a,b,c){return 2*Math.atan(b*
Math.tan(.5*a)/Math.sqrt(b*b+c*c))};g.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};g.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};g.nextHighestPowerOfTen=function(a){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(a)))};g.lineLineDistanceSquared3D=function(c,d,e,v,k){C[0]=c[0]-e[0];C[1]=c[1]-e[1];C[2]=c[2]-e[2];B[0]=v[0]-e[0];B[1]=v[1]-e[1];B[2]=v[2]-e[2];if(1E-4>Math.abs(B[0])&&1E-4>Math.abs(B[1])&&1E-4>Math.abs(B[2]))return k.success=
!1,k;D[0]=d[0]-c[0];D[1]=d[1]-c[1];D[2]=d[2]-c[2];if(1E-4>Math.abs(D[0])&&1E-4>Math.abs(D[1])&&1E-4>Math.abs(D[2]))return k.success=!1,k;d=C[0]*B[0]+C[1]*B[1]+C[2]*B[2];v=B[0]*D[0]+B[1]*D[1]+B[2]*D[2];var h=C[0]*D[0]+C[1]*D[1]+C[2]*D[2],q=B[0]*B[0]+B[1]*B[1]+B[2]*B[2],l=(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])*q-v*v;if(1E-4>Math.abs(l))return k.success=!1,k;h=b((d*v-h*q)/l,0,1);d=b((d+v*h)/q,0,1);E[0]=c[0]+h*D[0];E[1]=c[1]+h*D[1];E[2]=c[2]+h*D[2];H[0]=e[0]+d*B[0];H[1]=e[1]+d*B[1];H[2]=e[2]+d*B[2];c=a.vec3d.dist2(E,
H);k.success=!0;k.dist2=c;k.pa=E;k.pb=H;return k};g.pointLineSegmentDistanceSquared2D=function(c,d,e){P[0]=d[0]-c[0];P[1]=d[1]-c[1];P[2]=0;J[0]=e[0]-c[0];J[1]=e[1]-c[1];J[2]=0;M[0]=e[0];M[1]=e[1];M[2]=0;d=a.vec2d.dot(J,P);e=a.vec2d.dot(P,P);d=b(d/e,0,1);G[0]=P[0]*d;G[1]=P[1]*d;F[0]=c[0]+G[0];F[1]=c[1]+G[1];a.vec2d.subtract(M,F,L);c=a.vec2d.dot(L,L);d=a.vec2d.dot(J,J);e=a.vec2d.dot(P,P);var v=a.vec2d.dot(G,G);if(v>d||v>e)c=Number.MAX_VALUE;return c};g.packFloatRGBA=function(a,c,d){void 0===d&&(d=0);
a=b(a,0,W);for(var e=0;4>e;e++)c[d+e]=Math.floor(256*q(a*N[e]))};g.unpackFloatRGBA=k;var N=[1,256,65536,16777216],S=[1/256,1/65536,1/16777216,1/4294967296],W=k(new Uint8ClampedArray([255,255,255,255]));g.inverseProjectionInfo=function(b,c,d,e,v){0===b[11]?(e[0]=2/(c*b[0]),e[1]=2/(d*b[5]),e[2]=(1+b[12])/b[0],e[3]=(1+b[13])/b[5],a.vec2d.set2(0,1,v)):(e[0]=-2/(c*b[0]),e[1]=-2/(d*b[5]),e[2]=(1-b[8])/b[0],e[3]=(1-b[9])/b[5],a.vec2d.set2(1,0,v))}})},"esri/views/3d/support/geometryUtils":function(){define(["require",
"exports","./geometryUtils/lineSegment","./geometryUtils/plane","./geometryUtils/triangle"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});g.plane=a;g.triangle=c;g.lineSegment=f})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define(["require","exports","../../lib/glMatrix","../mathUtils"],function(r,g,f,a){function c(a,b){void 0===a&&(a=f.vec3d.create());void 0===b&&(b=f.vec3d.create());return{origin:a,vector:b}}Object.defineProperty(g,"__esModule",{value:!0});
g.create=c;g.fromOriginAndVector=function(a,b,d){void 0===d&&(d=c());f.vec3d.set(a,d.origin);f.vec3d.set(b,d.vector);return d};g.distance2=function(c,e){e=f.vec3d.subtract(e,c.origin);var d=f.vec3d.dot(c.vector,e),h=f.vec3d.dot(c.vector,c.vector),d=a.clamp(d/h,0,1);c=f.vec3d.subtract(f.vec3d.scale(c.vector,d,b),e,b);return f.vec3d.dot(c,c)};var b=f.vec3d.create()})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../lib/glMatrix"],function(r,g,f){function a(a){void 0===
a&&(a=g.UP);return[a[0],a[1],a[2],a[3]]}function c(b,c,d){void 0===d&&(d=a());f.vec3d.set(c,d);d[3]=-f.vec3d.dot(c,b);return d}function b(b,e,l,p){void 0===p&&(p=a());f.vec3d.cross(e,b,d);return c(l,f.vec3d.normalize(d),p)}Object.defineProperty(g,"__esModule",{value:!0});g.create=a;g.fromValues=function(b,c,d,e,k){void 0===k&&(k=a());k[0]=b;k[1]=c;k[2]=d;k[3]=e;return k};g.fromNormalAndOffset=function(b,c,d){void 0===d&&(d=a());f.vec3d.set(b,d);d[3]=c;return d};g.fromPositionAndNormal=c;g.projectVector=
function(a,b,c){void 0===c&&(c=b);return f.vec3d.cross(a,f.vec3d.cross(b,a,e),c)};g.distance=function(a,b){return f.vec3d.dot(a,b)+a[3]};g.fromPoints=function(c,d,t,p){void 0===p&&(p=a());return b(f.vec3d.subtract(c,d,l),f.vec3d.subtract(t,d,e),c,p)};g.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};g.negate=function(a,b){void 0===b&&(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};g.fromVectorsAndPoint=b;g.intersectRay=function(a,b,c,d){var e=f.vec3d.dot(a,c);if(0===
e)return!1;a=-(f.vec3d.dot(a,b)+a[3])/e;f.vec3d.add(b,f.vec3d.scale(c,a,d),d);return!0};g.UP=[0,0,1,0];var l=f.vec3d.create(),e=f.vec3d.create(),d=f.vec3d.create()})},"esri/views/3d/support/geometryUtils/triangle":function(){define(["require","exports","../../lib/glMatrix","./lineSegment"],function(r,g,f,a){function c(a,b,c){var d=f.vec2d.dist(a,b);b=f.vec2d.dist(b,c);a=f.vec2d.dist(c,a);c=(d+b+a)/2;return Math.sqrt(c*(c-d)*(c-b)*(c-a))}Object.defineProperty(g,"__esModule",{value:!0});g.create=function(a,
b,c){void 0===a&&(a=f.vec3d.create());void 0===b&&(b=f.vec3d.create());void 0===c&&(c=f.vec3d.create());return{p0:a,p1:b,p2:c}};g.distance2=function(c,q){var k=c.p0,u=c.p1;c=c.p2;var x=f.vec3d.subtract(u,k,b),v=f.vec3d.subtract(c,u,l),y=f.vec3d.subtract(k,c,e),A=f.vec3d.subtract(q,k,d),C=f.vec3d.subtract(q,u,h),B=f.vec3d.subtract(q,c,n),g=f.vec3d.cross(x,y),E=f.vec3d.dot(f.vec3d.cross(x,g,t),A),C=f.vec3d.dot(f.vec3d.cross(v,g,t),C),B=f.vec3d.dot(f.vec3d.cross(y,g,t),B);if(0<E&&0<C&&0<B)return q=f.vec3d.dot(g,
A),q*q/f.vec3d.dot(g,g);k=a.distance2(a.fromOriginAndVector(k,x,p),q);u=a.distance2(a.fromOriginAndVector(u,v,p),q);q=a.distance2(a.fromOriginAndVector(c,y,p),q);return Math.min(k,u,q)};g.areaPoints2d=c;g.area2d=function(a){return c(a.p0,a.p1,a.p2)};var b=f.vec3d.create(),l=f.vec3d.create(),e=f.vec3d.create(),d=f.vec3d.create(),h=f.vec3d.create(),n=f.vec3d.create(),t=f.vec3d.create(),p=a.create()})},"esri/views/3d/webgl-engine/lib/gl-matrix":function(){define([],function(){var r={};(function(g,f){f(g,
!0);f(g,!1)})(r,function(g,f){var a={};(function(){if("undefined"!=typeof Float32Array){var b=new Float32Array(1),c=new Int32Array(b.buffer);a.invsqrt=function(a){b[0]=a;c[0]=1597463007-(c[0]>>1);var d=b[0];return d*(1.5-.5*a*d*d)}}else a.invsqrt=function(a){return 1/Math.sqrt(a)}})();var c=Array;"undefined"!=typeof Float32Array&&(c=f?Float32Array:Array);var b={create:function(a){var b=new c(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},createFrom:function(a,b,d){var e=new c(3);
e[0]=a;e[1]=b;e[2]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},set3:function(a,b,c,d){d[0]=a;d[1]=b;d[2]=c;return d},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];
c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},max:function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c},min:function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1];a=a[2];var e=
Math.sqrt(c*c+d*d+a*a);if(!e)return b[0]=0,b[1]=0,b[2]=0,b;if(1===e)return b[0]=c,b[1]=d,b[2]=a,b;e=1/e;b[0]=c*e;b[1]=d*e;b[2]=a*e;return b},cross:function(a,b,c){c||(c=a);var d=a[0],e=a[1];a=a[2];var v=b[0],k=b[1];b=b[2];c[0]=e*b-a*k;c[1]=a*v-d*b;c[2]=d*k-e*v;return c},length:function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},length2:function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);
var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];b=Math.sqrt(d*d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)},dist2:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}},l=null,e=new c(4);b.unproject=function(a,b,c,d,k){k||(k=a);l||(l=q.create());
var v=l;e[0]=2*(a[0]-d[0])/d[2]-1;e[1]=2*(a[1]-d[1])/d[3]-1;e[2]=2*a[2]-1;e[3]=1;q.multiply(c,b,v);if(!q.inverse(v))return null;q.multiplyVec4(v,e);if(0===e[3])return null;k[0]=e[0]/e[3];k[1]=e[1]/e[3];k[2]=e[2]/e[3];return k};var d=b.createFrom(1,0,0),h=b.createFrom(0,1,0),n=b.createFrom(0,0,1);b.rotationTo=function(a,c,e){e||(e=m.create());var v=b.dot(a,c),k=b.create();if(1<=v)m.set(u,e);else if(-.999999>v)b.cross(d,a,k),1E-6>k.length&&b.cross(h,a,k),1E-6>k.length&&b.cross(n,a,k),b.normalize(k),
m.fromAxisAngle(k,Math.PI,e);else{var v=Math.sqrt(2*(1+v)),q=1/v;b.cross(a,c,k);e[0]=k[0]*q;e[1]=k[1]*q;e[2]=k[2]*q;e[3]=.5*v;m.normalize(e)}1<e[3]?e[3]=1:-1>e[3]&&(e[3]=-1);return e};var t=b.create(),p=b.create();b.project=function(a,c,d,e){e||(e=a);b.direction(c,d,t);b.subtract(a,c,p);a=b.dot(t,p);b.scale(t,a,e);b.add(e,c,e)};b.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var k={create:function(a){var b=new c(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0;return b},createFrom:function(a,b,d,e,k,h,q,l,m){var v=new c(9);v[0]=a;v[1]=b;v[2]=d;v[3]=e;v[4]=k;v[5]=h;v[6]=q;v[7]=l;v[8]=m;return v},determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],k=a[7],v=a[8];return a[0]*(v*c-d*k)+a[1]*(-v*b+d*e)+a[2]*(k*b-c*e)},inverse:function(a,b){var c=a[0],d=a[1],e=a[2],v=a[3],h=a[4],q=a[5],l=a[6],m=a[7];a=a[8];var f=a*h-q*m,n=-a*v+q*l,y=m*v-h*l,u=c*f+d*n+e*y;if(!u)return null;u=1/u;b||(b=k.create());
b[0]=f*u;b[1]=(-a*d+e*m)*u;b[2]=(q*d-e*h)*u;b[3]=n*u;b[4]=(a*c-e*l)*u;b[5]=(-q*c+e*v)*u;b[6]=y*u;b[7]=(-m*c+d*l)*u;b[8]=(h*c-d*v)*u;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],k=a[2],v=a[3],h=a[4],q=a[5],l=a[6],m=a[7];a=a[8];var f=b[0],n=b[1],u=b[2],y=b[3],A=b[4],p=b[5],t=b[6],x=b[7];b=b[8];c[0]=f*d+n*v+u*l;c[1]=f*e+n*h+u*m;c[2]=f*k+n*q+u*a;c[3]=y*d+A*v+p*l;c[4]=y*e+A*h+p*m;c[5]=y*k+A*q+p*a;c[6]=t*d+x*v+b*l;c[7]=t*e+x*h+b*m;c[8]=t*k+x*q+b*a;return c},multiplyVec2:function(a,b,c){c||
(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[3]+a[6];c[1]=d*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=d*a[0]+e*a[3]+b*a[6];c[1]=d*a[1]+e*a[4]+b*a[7];c[2]=d*a[2]+e*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a||(a=k.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){b=
a[1];var c=a[2],d=a[5];a[1]=a[3];a[2]=a[6];a[3]=b;a[5]=a[7];a[6]=c;a[7]=d;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=q.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},q={create:function(a){var b=
new c(16);4===arguments.length?(b[0]=arguments[0],b[1]=arguments[1],b[2]=arguments[2],b[3]=arguments[3],b[4]=arguments[4],b[5]=arguments[5],b[6]=arguments[6],b[7]=arguments[7],b[8]=arguments[8],b[9]=arguments[9],b[10]=arguments[10],b[11]=arguments[11],b[12]=arguments[12],b[13]=arguments[13],b[14]=arguments[14],b[15]=arguments[15]):a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=
a[15]);return b},createFrom:function(a,b,d,e,k,h,q,l,m,f,n,u,p,t,x,g){var v=new c(16);v[0]=a;v[1]=b;v[2]=d;v[3]=e;v[4]=k;v[5]=h;v[6]=q;v[7]=l;v[8]=m;v[9]=f;v[10]=n;v[11]=u;v[12]=p;v[13]=t;v[14]=x;v[15]=g;return v},createFromMatrixRowMajor:function(a){var b=new c(16);b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},createFromMatrix:function(a){var b=new c(16);b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},setRowMajor:function(a,b){b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=
a[10];b[14]=a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=q.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],d=a[3],e=a[6],k=a[7],h=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=e;a[11]=a[14];a[12]=d;a[13]=k;a[14]=h;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];
b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],k=a[4],h=a[5],q=a[6],l=a[7],m=a[8],v=a[9],f=a[10],n=a[11],u=a[12],p=a[13],t=a[14];a=a[15];return u*v*q*e-m*p*q*e-u*h*f*e+k*p*f*e+m*h*t*e-k*v*t*e-u*v*d*l+m*p*d*l+u*c*f*l-b*p*f*l-m*c*t*l+b*v*t*l+u*h*d*n-k*p*d*n-u*c*q*n+b*p*q*n+k*c*t*n-b*h*t*n-m*h*d*a+k*v*d*a+m*c*q*a-b*v*q*a-k*c*f*a+b*h*f*a},inverse:function(a,b){b||(b=a);var c=
a[0],d=a[1],e=a[2],k=a[3],h=a[4],q=a[5],l=a[6],m=a[7],v=a[8],f=a[9],n=a[10],u=a[11],p=a[12],t=a[13],y=a[14];a=a[15];var x=c*q-d*h,g=c*l-e*h,r=c*m-k*h,X=d*l-e*q,Q=d*m-k*q,I=e*m-k*l,K=v*t-f*p,T=v*y-n*p,Y=v*a-u*p,ba=f*y-n*t,R=f*a-u*t,ha=n*a-u*y,ea=x*ha-g*R+r*ba+X*Y-Q*T+I*K;if(!ea)return null;ea=1/ea;b[0]=(q*ha-l*R+m*ba)*ea;b[1]=(-d*ha+e*R-k*ba)*ea;b[2]=(t*I-y*Q+a*X)*ea;b[3]=(-f*I+n*Q-u*X)*ea;b[4]=(-h*ha+l*Y-m*T)*ea;b[5]=(c*ha-e*Y+k*T)*ea;b[6]=(-p*I+y*r-a*g)*ea;b[7]=(v*I-n*r+u*g)*ea;b[8]=(h*R-q*Y+m*K)*
ea;b[9]=(-c*R+d*Y-k*K)*ea;b[10]=(p*Q-t*r+a*x)*ea;b[11]=(-v*Q+f*r-u*x)*ea;b[12]=(-h*ba+q*T-l*K)*ea;b[13]=(c*ba-d*T+e*K)*ea;b[14]=(-p*X+t*g-y*x)*ea;b[15]=(v*X-f*g+n*x)*ea;return b},toRotationMat:function(a,b){b||(b=q.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=k.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=
a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],d=a[1],e=a[2],h=a[4],q=a[5],l=a[6],m=a[8],f=a[9];a=a[10];var v=a*q-l*f,n=-a*h+l*m,u=f*h-q*m,p=c*v+d*n+e*u;if(!p)return null;p=1/p;b||(b=k.create());b[0]=v*p;b[1]=(-a*d+e*f)*p;b[2]=(l*d-e*q)*p;b[3]=n*p;b[4]=(a*c-e*m)*p;b[5]=(-l*c+e*h)*p;b[6]=u*p;b[7]=(-f*c+d*m)*p;b[8]=(q*c-d*h)*p;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],k=a[2],h=a[3],q=a[4],l=a[5],m=a[6],f=a[7],n=a[8],v=a[9],u=a[10],p=a[11],A=a[12],t=a[13],y=a[14];
a=a[15];var x=b[0],g=b[1],r=b[2],Q=b[3],I=b[4],K=b[5],T=b[6],Y=b[7],ba=b[8],R=b[9],ha=b[10],ea=b[11],ca=b[12],fa=b[13],da=b[14];b=b[15];c[0]=x*d+g*q+r*n+Q*A;c[1]=x*e+g*l+r*v+Q*t;c[2]=x*k+g*m+r*u+Q*y;c[3]=x*h+g*f+r*p+Q*a;c[4]=I*d+K*q+T*n+Y*A;c[5]=I*e+K*l+T*v+Y*t;c[6]=I*k+K*m+T*u+Y*y;c[7]=I*h+K*f+T*p+Y*a;c[8]=ba*d+R*q+ha*n+ea*A;c[9]=ba*e+R*l+ha*v+ea*t;c[10]=ba*k+R*m+ha*u+ea*y;c[11]=ba*h+R*f+ha*p+ea*a;c[12]=ca*d+fa*q+da*n+b*A;c[13]=ca*e+fa*l+da*v+b*t;c[14]=ca*k+fa*m+da*u+b*y;c[15]=ca*h+fa*f+da*p+b*a;
return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var d=b[0],e=b[1],k=b[2];b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*k+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*k+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*k+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*k+a[15]*b;return c},translate:function(a,b,c){var d=b[0],e=b[1];b=b[2];var k,h,q,l,m,f,n,v,u,p,t,A;if(!c||a===c)return a[12]=
a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;k=a[0];h=a[1];q=a[2];l=a[3];m=a[4];f=a[5];n=a[6];v=a[7];u=a[8];p=a[9];t=a[10];A=a[11];c[0]=k;c[1]=h;c[2]=q;c[3]=l;c[4]=m;c[5]=f;c[6]=n;c[7]=v;c[8]=u;c[9]=p;c[10]=t;c[11]=A;c[12]=k*d+m*e+u*b+a[12];c[13]=h*d+f*e+p*b+a[13];c[14]=q*d+n*e+t*b+a[14];c[15]=l*d+v*e+A*b+a[15];return c},scale:function(a,b,c){var d=b[0],e=b[1];b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=
d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,b,c,d){var e=c[0],k=c[1];c=c[2];var h=
Math.sqrt(e*e+k*k+c*c),q,l,m,f,n,v,u,p,t,A,y,C,x,g,r,I,K,T,Y,ba;if(!h)return null;1!==h&&(h=1/h,e*=h,k*=h,c*=h);q=Math.sin(b);l=Math.cos(b);m=1-l;b=a[0];h=a[1];f=a[2];n=a[3];v=a[4];u=a[5];p=a[6];t=a[7];A=a[8];y=a[9];C=a[10];x=a[11];g=e*e*m+l;r=k*e*m+c*q;I=c*e*m-k*q;K=e*k*m-c*q;T=k*k*m+l;Y=c*k*m+e*q;ba=e*c*m+k*q;e=k*c*m-e*q;k=c*c*m+l;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*g+v*r+A*I;d[1]=h*g+u*r+y*I;d[2]=f*g+p*r+C*I;d[3]=n*g+t*r+x*I;d[4]=b*K+v*T+A*Y;d[5]=h*K+u*T+y*Y;d[6]=
f*K+p*T+C*Y;d[7]=n*K+t*T+x*Y;d[8]=b*ba+v*e+A*k;d[9]=h*ba+u*e+y*k;d[10]=f*ba+p*e+C*k;d[11]=n*ba+t*e+x*k;return d},rotateX:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[4],k=a[5],h=a[6],q=a[7],l=a[8],m=a[9],f=a[10],n=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+l*d;c[5]=k*b+m*d;c[6]=h*b+f*d;c[7]=q*b+n*d;c[8]=e*-d+l*b;c[9]=k*-d+m*b;c[10]=h*-d+f*b;c[11]=q*-d+n*b;return c},rotateY:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);
var e=a[0],k=a[1],h=a[2],q=a[3],l=a[8],m=a[9],f=a[10],n=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+l*-d;c[1]=k*b+m*-d;c[2]=h*b+f*-d;c[3]=q*b+n*-d;c[8]=e*d+l*b;c[9]=k*d+m*b;c[10]=h*d+f*b;c[11]=q*d+n*b;return c},rotateZ:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],k=a[1],h=a[2],q=a[3],l=a[4],m=a[5],f=a[6],n=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):
c=a;c[0]=e*b+l*d;c[1]=k*b+m*d;c[2]=h*b+f*d;c[3]=q*b+n*d;c[4]=e*-d+l*b;c[5]=k*-d+m*b;c[6]=h*-d+f*b;c[7]=q*-d+n*b;return c},frustum:function(a,b,c,d,e,k,h){h||(h=q.create());var l=b-a,m=d-c,f=k-e;h[0]=2*e/l;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/m;h[6]=0;h[7]=0;h[8]=(b+a)/l;h[9]=(d+c)/m;h[10]=-(k+e)/f;h[11]=-1;h[12]=0;h[13]=0;h[14]=-(k*e*2)/f;h[15]=0;return h},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return q.frustum(-b,b,-a,a,c,d,e)},ortho:function(a,b,c,d,e,k,h){h||(h=q.create());
var l=b-a,m=d-c,f=k-e;h[0]=2/l;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2/m;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=-2/f;h[11]=0;h[12]=-(a+b)/l;h[13]=-(d+c)/m;h[14]=-(k+e)/f;h[15]=1;return h},lookAt:function(a,b,c,d){d||(d=q.create());var e,k,h,l,m,f,n,u,v=a[0],p=a[1];a=a[2];h=c[0];l=c[1];k=c[2];n=b[0];c=b[1];e=b[2];if(v===n&&p===c&&a===e)return q.identity(d);b=v-n;c=p-c;n=a-e;u=1/Math.sqrt(b*b+c*c+n*n);b*=u;c*=u;n*=u;e=l*n-k*c;k=k*b-h*n;h=h*c-l*b;(u=Math.sqrt(e*e+k*k+h*h))?(u=1/u,e*=u,k*=u,h*=u):h=k=e=0;l=c*h-
n*k;m=n*e-b*h;f=b*k-c*e;(u=Math.sqrt(l*l+m*m+f*f))?(u=1/u,l*=u,m*=u,f*=u):f=m=l=0;d[0]=e;d[1]=l;d[2]=b;d[3]=0;d[4]=k;d[5]=m;d[6]=c;d[7]=0;d[8]=h;d[9]=f;d[10]=n;d[11]=0;d[12]=-(e*v+k*p+h*a);d[13]=-(l*v+m*p+f*a);d[14]=-(b*v+c*p+n*a);d[15]=1;return d},fromRotationTranslation:function(a,b,c){c||(c=q.create());var d=a[0],e=a[1],k=a[2],h=a[3],l=d+d,m=e+e,f=k+k;a=d*l;var n=d*m,d=d*f,u=e*m,e=e*f,k=k*f,l=h*l,m=h*m,h=h*f;c[0]=1-(u+k);c[1]=n+h;c[2]=d-m;c[3]=0;c[4]=n-h;c[5]=1-(a+k);c[6]=e+l;c[7]=0;c[8]=d+m;c[9]=
e-l;c[10]=1-(a+u);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},m={create:function(a){var b=new c(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,d,e){var k=new c(4);k[0]=a;k[1]=b;k[2]=d;k[3]=e;return k},set:function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=m.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},u=m.identity();m.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};m.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};m.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],k=a[3],c=(c=c*c+d*d+e*e+k*k)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=
-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};m.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};m.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};m.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2];a=a[3];var k=Math.sqrt(c*c+d*d+e*e+a*a);if(0===k)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;k=1/k;b[0]=c*k;b[1]=d*k;b[2]=e*k;b[3]=a*k;return b};m.add=function(a,
b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};m.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],k=a[2];a=a[3];var h=b[0],q=b[1],l=b[2];b=b[3];c[0]=d*b+a*h+e*l-k*q;c[1]=e*b+a*q+k*h-d*l;c[2]=k*b+a*l+d*q-e*h;c[3]=a*b-d*h-e*q-k*l;return c};m.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],k=b[2];b=a[0];var h=a[1],q=a[2];a=a[3];var l=a*d+h*k-q*e,m=a*e+q*d-b*k,f=a*k+b*e-h*d,d=-b*d-h*e-q*k;c[0]=l*a+
d*-b+m*-q-f*-h;c[1]=m*a+d*-h+f*-b-l*-q;c[2]=f*a+d*-q+l*-h-m*-b;return c};m.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};m.toMat3=function(a,b){b||(b=k.create());var c=a[0],d=a[1],e=a[2],h=a[3],q=c+c,l=d+d,m=e+e;a=c*q;var f=c*l,c=c*m,n=d*l,d=d*m,e=e*m,q=h*q,l=h*l,h=h*m;b[0]=1-(n+e);b[1]=f+h;b[2]=c-l;b[3]=f-h;b[4]=1-(a+e);b[5]=d+q;b[6]=c+l;b[7]=d-q;b[8]=1-(a+n);return b};m.toMat4=function(a,b){b||(b=q.create());
var c=a[0],d=a[1],e=a[2],k=a[3],h=c+c,l=d+d,m=e+e;a=c*h;var f=c*l,c=c*m,n=d*l,d=d*m,e=e*m,h=k*h,l=k*l,k=k*m;b[0]=1-(n+e);b[1]=f+k;b[2]=c-l;b[3]=0;b[4]=f-k;b[5]=1-(a+e);b[6]=d+h;b[7]=0;b[8]=c+l;b[9]=d-h;b[10]=1-(a+n);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};m.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],k,h;if(1<=Math.abs(e))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;k=Math.acos(e);h=Math.sqrt(1-e*e);if(.001>Math.abs(h))return d[0]=.5*a[0]+
.5*b[0],d[1]=.5*a[1]+.5*b[1],d[2]=.5*a[2]+.5*b[2],d[3]=.5*a[3]+.5*b[3],d;e=Math.sin((1-c)*k)/h;c=Math.sin(c*k)/h;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};m.fromRotationMatrix=function(a,b){b||(b=m.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=.5*d,d=.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=m.fromRotationMatrix.s_iNext=m.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var e=d[c],k=
d[e];d=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*k+k]+1);b[c]=.5*d;d=.5/d;b[3]=(a[3*k+e]-a[3*e+k])*d;b[e]=(a[3*e+c]+a[3*c+e])*d;b[k]=(a[3*k+c]+a[3*c+k])*d}return b};k.toQuat4=m.fromRotationMatrix;(function(){var a=k.create();m.fromAxes=function(b,c,d,e){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=b[0];a[5]=b[1];a[8]=b[2];return m.fromRotationMatrix(a,e)}})();m.identity=function(a){a||(a=m.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};m.fromAngleAxis=function(a,b,c){c||(c=m.create());
a*=.5;var d=Math.sin(a);c[3]=Math.cos(a);c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};m.toAngleAxis=function(b,c){c||(c=b);var d=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<d?(c[3]=2*Math.acos(b[3]),d=a.invsqrt(d),c[0]=b[0]*d,c[1]=b[1]*d,c[2]=b[2]*d):(c[3]=0,c[0]=1,c[1]=0,c[2]=0);return c};m.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var x={create:function(a){var b=new c(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,d,e){var k=new c(4);
k[0]=a;k[1]=b;k[2]=d;k[3]=e;return k},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=x.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b)return b=a[1],a[1]=a[2],a[2]=b,a;b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2];a=a[3];var k=c*a-e*d;if(!k)return null;k=1/k;b[0]=a*k;b[1]=-d*k;b[2]=-e*k;b[3]=c*k;return b},
multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],k=a[2];a=a[3];c[0]=d*b[0]+e*b[2];c[1]=d*b[1]+e*b[3];c[2]=k*b[0]+a*b[2];c[3]=k*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],e=a[1],k=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*h;c[1]=d*-h+e*b;c[2]=k*b+a*h;c[3]=k*-h+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=a[1],e=a[2],k=a[3],h=b[0];b=b[1];c[0]=a[0]*h;c[1]=
d*b;c[2]=e*h;c[3]=k*b;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};f=f?"":"d";g["glMath"+f]=a;g["vec2"+f]={create:function(a){var b=new c(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},createFrom:function(a,b){var d=new c(2);d[0]=a;d[1]=b;return d},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},
divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},dist2:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},set2:function(a,b,c){c[0]=a;c[1]=b;return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),
b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0];a=a[1]-b[1];b=d*d+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+
a[0]+", "+a[1]+"]"}};g["vec3"+f]=b;g["vec4"+f]={create:function(a){var b=new c(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},createFrom:function(a,b,d,e){var k=new c(4);k[0]=a;k[1]=b;k[2]=d;k[3]=e;return k},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=
a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},set4:function(a,b,c,d,e){e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];
b[3]=-a[3];return b},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};g["mat2"+f]=x;g["mat3"+f]=k;g["mat4"+f]=q;g["quat4"+f]=m});return r})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../geometry/support/aaBoundingBox ../../lib/ComponentUtils ../../lib/gl-matrix ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e){function d(a,b,c,d,e,k){if(void 0===e||3!==k)for(e=0;e<k;++e)c[d+e]=a[b+e];else{var h=a[b],l=a[b+1];a=a[b+2];c[d]=e[0]*h+e[4]*l+e[8]*a+e[12];c[d+1]=e[1]*h+e[5]*l+e[9]*a+e[13];c[d+2]=e[2]*h+e[6]*l+e[10]*a+e[14]}return k}function h(a,b,c,d,e,k){for(var h=a.length,l=0;l<h;++l){for(var q=c*a[l],m=0;m<c;++m)d[e+m]=b[q+m];e+=k}}function n(a,b,c,d,e,k){d=new Uint8Array(d);e*=4;k*=4;var h=a.length;if(4===c)for(c=0;c<h;++c){var l=4*a[c];d[e]=b[l];d[e+1]=b[l+1];d[e+2]=b[l+2];d[e+3]=
b[l+3];e+=k}else if(3===c)for(c=0;c<h;++c)l=3*a[c],d[e]=b[l],d[e+1]=b[l+1],d[e+2]=b[l+2],d[e+3]=255,e+=k}function t(a,b,c,d,e){var k=q(b,c,C);f.setMin(y,a.getBBMin());f.setMax(y,a.getBBMax());if(m(y,b,k,d)){var k=a.getPrimitiveIndices(),h=a.getIndices(),l=a.getPosition(),n=k?k.length:h.length/3;if(1E4<n&&(a=a.getChildren(),void 0!==a)){for(k=0;8>k;++k)void 0!==a[k]&&t(a[k],b,c,d,e);return}p(b,c,0,n,h,l,k,e)}}function p(a,b,c,d,e,h,l,q){var m=h.data,f=h.offsetIdx;h=h.strideIdx;var n=a[0],u=a[1];a=
a[2];var p=b[0]-n,t=b[1]-u;for(b=b[2]-a;c<d;c++){var v=l?l[c]:c,A=f+h*e[3*v],C=f+h*e[3*v+1],x=f+h*e[3*v+2],g=m[A],y=m[A+1],E=m[A+2],A=m[C]-g,F=m[C+1]-y,C=m[C+2]-E,H=m[x]-g,L=m[x+1]-y,x=m[x+2]-E,r=t*x-L*b,G=b*H-x*p,P=p*L-H*t,J=A*r+F*G+C*P,g=n-g,O=u-y,w=a-E,y=O*C-F*w,E=w*A-C*g,M=g*F-A*O;if(J>B){r=g*r+O*G+w*P;if(0>r||r>J)continue;G=p*y+t*E+b*M;if(0>G||r+G>J)continue}else if(J<-B){r=g*r+O*G+w*P;if(0<r||r<J)continue;G=p*y+t*E+b*M;if(0<G||r+G<J)continue}else continue;J=(H*y+L*E+x*M)/J;0<=J&&(A=k(A,F,C,
H,L,x,D),q(J,A,v))}}function k(a,b,d,e,k,h,l){c.vec3d.set3(a,b,d,E);c.vec3d.set3(e,k,h,H);return c.vec3d.normalize(c.vec3d.cross(E,H,l))}function q(a,b,d){return c.vec3d.set3(1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]),d)}function m(a,b,c,d){var e=(a[0]-d-b[0])*c[0],k=(a[3]+d-b[0])*c[0],h=Math.min(e,k),e=Math.max(e,k),k=(a[1]-d-b[1])*c[1],l=(a[4]+d-b[1])*c[1],h=Math.max(h,Math.min(k,l)),e=Math.min(e,Math.max(k,l));if(h>e)return!1;k=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];h=Math.max(h,Math.min(k,a));
e=Math.min(e,Math.max(k,a));return h<=e}function u(a,b){b=b?u(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=x(d));null==d&&c in b||(b[c]=d)}return b}function x(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(g,"__esModule",{value:!0});var v=c.mat4d.create(),y=f.create(),A=l.VertexAttrConstants;g.IDENTITY=c.mat4d.identity();g.fill=d;g.fillColor=function(a,b,c,d,e){for(var k=0;k<e;++k)c[d+k]=a[b+k];return e};g.fillInterleaved=function(a,b,c,d,k,l,q,m){for(var f=
e.getStride(k)/4,u=0;u<k.length;u++){var p=k[u],t=q+p.offset/4,p=p.name,v=a.vertexAttr[p];if(null!=v&&(null==m||null!=m[p]))switch(p){case "uv0":h(a.indices[p],v.data,v.size,l,t,f);break;case "region":for(var p=a.indices[p],C=v.data,x=v.size,v=f,g=new Uint16Array(l.buffer),t=2*t,v=2*v,y=p.length,B=0;B<y;++B){for(var D=x*p[B],E=0;E<x;++E)g[t+E]=C[D+E];t+=v}break;case "color":if(d&&d.color)if(p=a.indices[p],C=v.data,x=d.color,B=v.size,v=f,g=new Uint8Array(l.buffer),t*=4,v*=4,y=p.length,4===B)for(B=
0;B<y;++B)D=4*p[B],g[t]=C[D]*x[0],g[t+1]=C[D+1]*x[1],g[t+2]=C[D+2]*x[2],g[t+3]=C[D+3]*x[3],t+=v;else{if(3===B)for(E=255*x[3],B=0;B<y;++B)D=3*p[B],g[t]=C[D]*x[0],g[t+1]=C[D+1]*x[1],g[t+2]=C[D+2]*x[2],g[t+3]=E,t+=v}else n(a.indices[p],v.data,v.size,l.buffer,t,f);break;case "symbolColor":n(a.indices[p],v.data,v.size,l.buffer,t,f);break;default:if(x=p===A.POSITION?b:p===A.NORMAL?c:void 0,void 0!==x&&3===v.size)for(p=a.indices[p],C=v.data,v=l,g=f,y=p.length,B=0;B<y;++B){var F=3*p[B],D=C[F],E=C[F+1],F=
C[F+2];v[t]=x[0]*D+x[4]*E+x[8]*F+x[12];v[t+1]=x[1]*D+x[5]*E+x[9]*F+x[13];v[t+2]=x[2]*D+x[6]*E+x[10]*F+x[14];t+=g}else h(a.indices[p],v.data,v.size,l,t,f)}}};g.triangleVertexArrayToWireframeLines=function(a,b,c,e){for(c=Math.floor(c/3)-1;0<=c;c--){var k=b+3*c*e,h=b+6*c*e+5*e;d(a,k,a,h,null,e);h-=e;d(a,k+e,a,h,null,e);h-=e;d(a,k+e,a,h,null,e);h-=e;d(a,k+2*e,a,h,null,e);h-=e;d(a,k+2*e,a,h,null,e);h-=e;d(a,k,a,h,null,e)}};g.intersectTriangleGeometry=function(b,c,d,e,k,h,n){l.assert("triangle"===b.data.primitiveType);
c=c.componentVisibilities;e=e.tolerance;if(1<b.getComponentCount()){d=q(k,h,C);var u=b.getBoundingInfo();f.setMin(y,u.getBBMin());f.setMax(y,u.getBBMax());if(m(y,k,d,e))for(var v=b.data,u=b.getComponentCount(),x=v.getIndices(A.POSITION),g=v.getAttribute(A.POSITION),v=v.componentOffsets,B=0;B<u;B++)if(a.getVisibility(c,B)){var D=b.getComponentAABB(B,y);m(D,k,d,e)&&p(k,h,v[B]/3,v[B+1]/3,x,g,void 0,n)}}else a.getVisibility(c,0)&&t(b.getBoundingInfo(),k,h,e,n)};var C=c.vec3d.create(),B=Math.pow(2,-52),
D=c.vec3d.create();g.intersectTriangles=p;var E=c.vec3d.create(),H=c.vec3d.create();g.computeNormal=k;g.intersectAabbInvDir=m;g.transformToWorld=function(a,b,d){return c.vec4d.set4(a[0]-b[0],a[1]-b[1],a[2]-b[2],1,d)};g.transformToView=function(a,b,d,e){c.mat4d.translate(d,b,v);d=v;return c.mat4d.multiplyVec4(d,a,e)};g.transformToProjection=function(a,b,d,e){e[0]=a[0]+d[0];e[1]=a[1]+d[1];e[2]=a[2]+d[2];e[3]=a[3];return c.mat4d.multiplyVec4(b,e)};g.transformToNDC=function(a,b){return c.vec4d.scale(a,
1/Math.abs(a[3]),b)};g.applyScreenSizePerspectiveScale=function(a,c,d,e,k){return b.scale(a,e,d,k)};g.verticalOffsetAtDistance=function(a,c,d,e,k){var h=d.screenLength||0;k&&(h=b.scale(h,e,c,k));return l.clamp(h*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*c,d.minWorldLength||0,null!=d.maxWorldLength?d.maxWorldLength:Infinity)};g.aquireIfNotUndefined=function(a,b,c){if(void 0!==a)return b.aquire(a,c)};g.releaseIfNotUndefined=function(a,b){void 0!==a&&b.release(a)};var F=c.mat4.create();g.bindView=function(a,
b,d){c.mat4d.translate(b,a,F);d.setUniform3fv("localOrigin",a);d.setUniformMatrix4fv("view",F)};g.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};g.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY;b=b.viewport[3];var e=void 0;void 0===e&&(e=L);e.screenLength=a.screenLength;e.perDistance=Math.tan(.5*d)/(.5*b);e.minWorldLength=a.minWorldLength;e.maxWorldLength=a.maxWorldLength;a=e;c.setUniform4f("verticalOffset",a.screenLength,a.perDistance,a.minWorldLength,
a.maxWorldLength)}};g.bindScreenSizePerspective=function(a,b,c){void 0===c&&(c="screenSizePerspectiveAlignment");if(a){var d=a.parameters;b.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};g.copyParameters=u;g.updateParameters=function(a,b){var c=!1,d;for(d in b){var e=b[d];void 0!==e&&(c=!0,Array.isArray(e)?a[d]=e.slice():a[d]=e)}return c};g.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var L={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require",
"exports","../../../../core/arrayUtils"],function(r,g,f){function a(a,b){if(null!=a){var c=a.isVisibleBit,d=a.data,e=8*d.BYTES_PER_ELEMENT;return b<d.length*e?p(c,d,b,e):!a.isVisibleBit}return!0}function c(a){return null===a.component?-1:a.component}function b(b,c,d,e,k){a(c,e)&&l(b,c,d,d[e],d[e+1]-1,k)}function l(a,b,c,d,e,k){c=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var h=b?b.options:null;c>=d||(c+1===d&&h===k?b.range[1]=e:a.push({range:[d,e],options:k}))}function e(a){void 0===a&&(a=!0);
return{isVisibleBit:!a,data:new Uint32Array(0)}}function d(a,b){return n(a,b,!0)}function h(a,b){return n(a,b,!1)}function n(a,b,c){var d=!1;a=a||q;d=a.isVisibleBit;a=a.data;b=k(b);var e=8*a.BYTES_PER_ELEMENT,h=a.length*e;c=c===d;if(0===a.length||0===b)d=!c;else if(h<b&&!c)d=!0;else{for(var l=m[e],h=m[0],f=0;f<a.length-1;f++)if(d=!c&&a[f]!==l||c&&a[f]!==h)return d;d=a.length-1;b=m[(b-1)%e+1];d=!c&&(a[d]&b)!==b||c&&(a[d]&b)!==h}return d}function t(a){return 0<a.length}function p(a,b,c,d){var e=c/d|
0;return 0!==(b[e]&1<<c-e*d)===a}function k(a){return Math.max(0,a.length-1)}Object.defineProperty(g,"__esModule",{value:!0});g.updateVisibility=function(a,b,c,d){if(c<k(b)){null==a&&(a=e());var h=a.isVisibleBit,l=a.data,q=8*l.BYTES_PER_ELEMENT,m=c/q|0,f=c-q*m;b=(k(b)-1)/q|0;var n=l;d=d===h;c<n.length*q||!d||(c=Math.max(m+1,Math.ceil(1.5*n.length)),c=Math.min(c,b+1),l=new Uint32Array(c),l.set(n));m<l.length&&(l[m]=l[m]&~(1<<f)|(d?1:0)<<f);a.data=l}return a};g.getVisibility=a;g.hideAllComponents=function(a){if(null==
a)a=e(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};g.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};g.generateVisibleIndexRanges=function(a,b){var c;if(a)if(t(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var d=a.isVisibleBit,e=a.data,h=8*e.BYTES_PER_ELEMENT,l=e.length*h,q=k(b),m=!1,f=0;f<l&&f<q;f++){var n=p(d,e,f,h);if(n!==m){var u=b[f];n?c.push([u,
0]):(m=c[c.length-1],m[1]=u-1);m=n}}a=!a.isVisibleBit;q>l&&a&&!m?c.push([b[l],b[q]-1]):m&&(m=c[c.length-1],m[1]=b[a?q:Math.min(q,l)]-1)}else c=[],c=a.isVisibleBit?c:null;else c=null;return c};g.addHighlight=function(a,b,d,e){a=a||[];b={component:b,options:d,id:e};a.push(b);b=c(b);for(d=a.length-1;0<d&&b<c(a[d-1]);)e=[a[d],a[d-1]],a[d-1]=e[0],a[d]=e[1],--d;return a};g.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};g.generateHighlightedIndexRanges=
function(a,c,d){if(c){if(t(d)){for(var e=d[0],q=d[d.length-1]-1,m=[],f=!h(a,d),n=0;n<c.length;++n){var p=c[n].options,u=c[n].component;if(null!==u)b(m,a,d,u,p);else if(f)l(m,a,d,e,q,p);else for(u=0;u<k(d);++u)b(m,a,d,u,p)}return 0<m.length?m:null}var f=!a||!a.isVisibleBit;return f?c.map(function(a){return{range:null,options:a.options}}):null}return null};g.defaultVisibilities=e;g.isAllVisible=function(a,b){return!h(a,b)};g.isAllHidden=function(a,b){return!d(a,b)};g.hasVisible=d;g.hasHidden=h;var q=
e();g.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};g.hasComponent=function(a,b){return b<k(a)};g.hasComponents=t;var m=[];for(r=0;65>r;r++)m.push(Math.pow(2,r)-1);g.componentCount=k;g.componentFind=function(a,b){a=f.binaryIndexOf(a,b,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","./Util"],function(r,g,f){function a(a){return Math.abs(a*a*a)}function c(b,c,d,e){void 0===e&&(e=n);var k=d.parameters;
d=d.paddingPixelsOverride;e.scale=Math.min(k.divisor/(c-k.offset),1);e.factor=a(b);e.minPixelSize=k.minPixelSize;e.paddingPixels=d;return e}function b(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/a)}function l(a,c){return Math.max(f.lerp(a*c.scale,a,c.factor),b(a,c))}function e(a,b,d){a=c(a,b,d);a.minPixelSize=0;a.paddingPixels=0;return l(1,a)}Object.defineProperty(g,"__esModule",{value:!0});g.getSettings=function(a){return new d(a,g.defaultDescription)};g.getLabelSettings=
function(a){var b=g.defaultDescription.curvatureDependent;return new d(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:h.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:h.curvatureDependent.max.scaleFallOffFactor}},scaleStart:g.defaultDescription.scaleStart,scaleFallOffRange:g.defaultDescription.scaleFallOffRange,minPixelSize:h.minPixelSize})};g.perspectiveFactor=a;g.scaleFactor=
c;g.applyScaleFactor=l;g.applyScaleFactorVec2=function(a,c,d){void 0===d&&(d=[0,0]);var e=Math.min(Math.max(c.scale,b(a[1],c)/a[1]),1);d[0]=f.lerp(a[0]*e,a[0],c.factor);d[1]=f.lerp(a[1]*e,a[1],c.factor);return d};g.precomputeScale=e;g.precomputeScaleFactor=function(a,b,c,d){d.scale=e(a,b,c);d.factor=0;d.minPixelSize=c.parameters.minPixelSize;d.paddingPixels=c.paddingPixelsOverride;return d};g.applyPrecomputedScaleFactorVec2=function(a,c,d){void 0===d&&(d=[0,0]);c=Math.min(Math.max(c.scale,b(a[1],
c)/a[1]),1);d[0]=a[0]*c;d[1]=a[1]*c;return d};g.scale=function(a,b,d,e){return l(a,c(b,d,e))};var d=function(){function a(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=
this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};
a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,c=c.minPixelSize,k=a.fovY,h=a.distance,l=this.calculateCurvatureDependentParameters(a),q=this.coverageCompensation(a,l),m=l.tiltAngle,l=l.scaleFallOffFactor,h=Math.sin(m)*h,m=.5*Math.PI-m-k*(.5-d*q),d=h/Math.cos(m),e=(d-h/Math.cos(m+k*e*q)*l)/(1-l);b.camera.fovY=
a.fovY;b.camera.distance=a.distance;b.offset=e;b.divisor=d-e;b.minPixelSize=c;return b};a.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=t);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=t);var c=this.description.curvatureDependent;a=1+a.distance/p;var d=[c.min.curvature,c.max.curvature],
e=d[0];a=f.clamp((Math.sqrt(a*a-1)-e)/(d[1]-e),0,1);d=[c.min,c.max];c=d[0];d=d[1];b.tiltAngle=f.lerp(c.tiltAngle,d.tiltAngle,a);b.scaleFallOffFactor=f.lerp(c.scaleFallOffFactor,d.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=p*p;b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*p;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/
e)-Math.asin(p/(e/Math.sin(b)))+.5*d)/d};return a}();g.defaultDescription={curvatureDependent:{min:{curvature:f.deg2rad(10),tiltAngle:f.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:f.deg2rad(70),tiltAngle:f.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var h={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};g.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=
a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var n={scale:0,factor:0,minPixelSize:0,paddingPixels:0},t={tiltAngle:0,scaleFallOffFactor:0},p=6378137})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error"],function(r,g,f,a){return function(){function c(){}c.vertexCount=function(a,l){return a.vertexBuffers[l].size/c.getStride(a.layout[l])};c.getStride=function(a){return a[0].stride};c.getBytesPerElement=function(a){switch(a){case 5126:return 4;
case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}};c.addDescriptor=function(a,l,e,d,h,f){var b=c.getBytesPerElement(d);if(0<a.length){var n=a[0].stride,k=n+b*e;a.forEach(function(a){return a.stride=k});a.push({name:l,count:e,type:d,offset:n,stride:k,normalized:h,divisor:f})}else a.push({name:l,count:e,type:d,offset:0,stride:b*e,normalized:h,divisor:f})};c.assertCompatibleVertexAttributeLocations=
function(a,c){(a=a.locations===c.locations)||console.error("VertexAttributeLocations are incompatible");return a};c.hasAttribute=function(a,c){for(var b=0;b<a.length;b++)if(a[b].name===c)return!0;return!1};c.findAttribute=function(a,c){for(var b=0;b<a.length;b++)if(a[b].name===c)return a[b];return null};c.copyFramebufferToTexture=function(a,c,e,d,h){void 0===h&&(h=0);var b=a.getBoundFramebufferObject(),l=a.getBoundTexture(0);a.bindFramebuffer(c);a.bindTexture(e,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,
h,e.descriptor.pixelFormat,d[0],d[1],d[2],d[3],0);a.gl.flush();a.bindFramebuffer(b);a.bindTexture(l,0)};c.assert=function(b,c){if(!b)throw new a(c);};c.setBaseInstanceOffset=function(a,c){var b={},d;for(d in a)b[d]=a[d].map(function(a){return a.divisor?f({},a,{baseInstance:c}):a});return b};c.bindVertexBufferLayout=function(a,c,e,d,h){var b=a.gl,l=a.capabilities.instancing;a.bindBuffer(e);d.forEach(function(a){var d=c[a.name],e=(h?h:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===d&&console.error("There is no location for vertex attribute '"+
a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count)b.vertexAttribPointer(d,a.count,a.type,a.normalized,a.stride,a.offset+e),b.enableVertexAttribArray(d),a.divisor&&0<a.divisor&&l&&l.vertexAttribDivisor(d,a.divisor);else if(9===a.count)for(var m=0;3>m;m++)b.vertexAttribPointer(d+m,3,a.type,a.normalized,a.stride,a.offset+12*m+e),b.enableVertexAttribArray(d+m),a.divisor&&0<a.divisor&&l&&l.vertexAttribDivisor(d+
m,a.divisor);else if(16===a.count)for(m=0;4>m;m++)b.vertexAttribPointer(d+m,4,a.type,a.normalized,a.stride,a.offset+16*m+e),b.enableVertexAttribArray(d+m),a.divisor&&0<a.divisor&&l&&l.vertexAttribDivisor(d+m,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};c.unbindVertexBufferLayout=function(a,c,e,d){var b=a.gl;a.bindBuffer(e);d.forEach(function(a){var d=c[a.name];if(4>=a.count)b.disableVertexAttribArray(d);else if(9===a.count)for(a=0;3>a;a++)b.disableVertexAttribArray(d+
a);else if(16===a.count)for(a=0;4>a;a++)b.disableVertexAttribArray(d+a);else console.error("Unsupported vertex attribute element count: "+a.count)});a.unbindBuffer(34962)};return c}()})},"esri/views/webgl/BufferObject":function(){define(["require","exports","dojo/has"],function(r,g,f){return function(){function a(c,b,l,e,d){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=c;this._bufferType=b;this._usage=l;this._id=a._nextId++;
this._glName=this._context.gl.createBuffer();e&&this.setData(e,d)}a.createIndex=function(c,b,l,e){return new a(c,34963,b,l,e)};a.createVertex=function(c,b,l){return new a(c,34962,b,l)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},
enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};a.prototype.setData=function(a,b){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&b)switch(this._indexType=b,this._size=a,b){case 5123:a*=2;break;case 5125:a*=4}}else b=a.byteLength,a instanceof Uint16Array&&(b/=2,this._indexType=5123),a instanceof Uint32Array&&
(b/=4,this._indexType=5125),this._size=b,ArrayBuffer.isView(a)&&(a=a.buffer);b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(b)}};a.prototype.setSubData=function(a,b,l,e){void 0===b&&(b=0);void 0===l&&(l=0);if(a){(0>b||b>=this._size)&&console.error("offset is out of range!");var c=b,h=l,f=e,t=a.byteLength;a instanceof Uint16Array&&(t/=2,c*=2,h*=2,f*=2);a instanceof Uint32Array&&
(t/=4,c*=4,h*=4,f*=4);void 0===e&&(e=t-1);l>=e&&console.error("end must be bigger than start!");b+l-e>this._size&&console.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);l=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;l.bufferSubData(this._bufferType,c,a.slice(h,f));this._context.bindVAO(b)}};a._nextId=0;return a}()})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports",
"dojo/has","./Util"],function(r,g,f,a){return function(){function c(a,l,e,d,h){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=a;this._layout=e;this._buffers=d;this._locations=l;h&&(this._indexBuffer=h);this._id=c._nextId++}Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,c){return b+a._buffers[c].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});c.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var c in this._buffers)this._buffers[c].dispose(),delete this._buffers[c];
this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};c.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var c=a.createVertexArray();a.bindVertexArray(c);this._bindLayout();a.bindVertexArray(null);this._glName=c}this._initialized=!0}};c.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};c.prototype._bindLayout=
function(){var b=this._buffers,c=!!this._context.capabilities.vao,e=this._layout,d=this._indexBuffer;b||console.error("Vertex buffer dictionary is empty!");var h=this._context.gl,f;for(f in b){var t=b[f];t||console.error("Vertex buffer is uninitialized!");var p=e[f];p||console.error("Vertex element descriptor is empty!");a.bindVertexBufferLayout(this._context,this._locations,t,p)}d&&(c?h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,d.glName):this._context.bindBuffer(d))};c.prototype.unbind=function(){this.initialize();
var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};c.prototype._unbindLayout=function(){var b=this._buffers,c=this._layout;b||console.error("Vertex buffer dictionary is empty!");for(var e in b){var d=b[e];d||console.error("Vertex buffer is uninitialized!");a.unbindVertexBufferLayout(this._context,this._locations,d,c[e])}(b=this._indexBuffer)&&this._context.unbindBuffer(b.bufferType)};c._nextId=0;return c}()})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./gl-matrix ./Util".split(" "),
function(r,g,f,a,c,b,l){function e(a,c,d,e,k){if(Math.abs(b.vec3.dot(c,a))>k)return!1;b.vec3.cross(a,c,d);b.vec3.normalize(d);b.vec3.cross(d,a,e);b.vec3.normalize(e);return!0}var d=l.VertexAttrConstants,h=a.Vec3Compact,n;(function(a){for(var b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],e=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],k=[0,0,1,0,1,1,0,1],h=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],l=Array(36),m=0;6>
m;m++)for(var q=0;6>q;q++)l[6*m+q]=m;for(var f=Array(36),m=0;6>m;m++)f[6*m+0]=0,f[6*m+1]=1,f[6*m+2]=2,f[6*m+3]=2,f[6*m+4]=3,f[6*m+5]=0;a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=new Float32Array(24),q=0;8>q;q++)m[3*q]=b[q][0]*a[0],m[3*q+1]=b[q][1]*a[1],m[3*q+2]=b[q][2]*a[2];a={};a[d.POSITION]=new Uint32Array(h);a[d.NORMAL]=new Uint32Array(l);a[d.UV0]=new Uint32Array(f);q={};q[d.POSITION]={size:3,data:m};q[d.NORMAL]={size:3,data:new Float32Array(e)};q[d.UV0]={size:2,data:new Float32Array(k)};
return new c(q,a)}})(n||(n={}));var t;(function(a){var b=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],e=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],k=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],h=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var l=new Float32Array(18),m=0;6>m;m++)l[3*m]=b[m][0]*a[0],l[3*m+1]=b[m][1]*a[1],l[3*m+2]=b[m][2]*a[2];a={};a[d.POSITION]=new Uint32Array(k);a[d.NORMAL]=
new Uint32Array(h);m={};m[d.POSITION]={size:3,data:l};m[d.NORMAL]={size:3,data:new Float32Array(e)};return new c(m,a)}})(t||(t={}));var p;(function(a){var e=b.vec3.createFrom(-.5,0,-.5),k=b.vec3.createFrom(.5,0,-.5),h=b.vec3.createFrom(0,0,.5),l=b.vec3.createFrom(0,.5,0),m=b.vec3.create(),q=b.vec3.create(),f=b.vec3.create(),n=b.vec3.create(),p=b.vec3.create();b.vec3.subtract(e,l,m);b.vec3.subtract(e,k,q);b.vec3.cross(m,q,f);b.vec3.normalize(f,f);b.vec3.subtract(k,l,m);b.vec3.subtract(k,h,q);b.vec3.cross(m,
q,n);b.vec3.normalize(n,n);b.vec3.subtract(h,l,m);b.vec3.subtract(h,e,q);b.vec3.cross(m,q,p);b.vec3.normalize(p,p);var u=[e,k,h,l],t=[0,-1,0,f[0],f[1],f[2],n[0],n[1],n[2],p[0],p[1],p[2]],x=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var b=new Float32Array(12),e=0;4>e;e++)b[3*e]=u[e][0]*a[0],b[3*e+1]=u[e][1]*a[1],b[3*e+2]=u[e][2]*a[2];a={};a[d.POSITION]=new Uint32Array(x);a[d.NORMAL]=new Uint32Array(g);e={};e[d.POSITION]={size:3,
data:b};e[d.NORMAL]={size:3,data:new Float32Array(t)};return new c(e,a)}})(p||(p={}));var k;(function(k){k.createBoxGeometry=n.createGeometry;k.createDiamondGeometry=t.createGeometry;k.createTetrahedronGeometry=p.createGeometry;k.createSphereGeometry=function(a,b,e,k,h,m,q){a=a||50;k=void 0!==k?k:-Math.PI;h=void 0!==h?h:2*Math.PI;m=void 0!==m?m:.5*-Math.PI;q=void 0!==q?q:Math.PI;var f=Math.max(3,Math.floor(b)||8),n=Math.max(2,Math.floor(e)||6),p=(f+1)*(n+1);e=new Float32Array(3*p);b=new Float32Array(3*
p);for(var p=new Float32Array(2*p),u=[],t=0,v=0;v<=n;v++){for(var A=[],C=v/n,g=m+C*q,x=Math.cos(g),y=0;y<=f;y++){var B=y/f,D=k+B*h,E=Math.cos(D)*x,r=Math.sin(g),D=-Math.sin(D)*x;e[3*t]=E*a;e[3*t+1]=r*a;e[3*t+2]=D*a;b[3*t]=E;b[3*t+1]=r;b[3*t+2]=D;p[2*t]=B;p[2*t+1]=C;A.push(t);++t}u.push(A)}a=new Uint32Array(2*f*(n-1)*3);for(v=t=0;v<n;v++)for(y=0;y<f;y++)k=u[v][y],h=u[v][y+1],m=u[v+1][y+1],q=u[v+1][y],0===v?(a[t++]=k,a[t++]=m,a[t++]=q):v===n-1?(a[t++]=k,a[t++]=h,a[t++]=m):(a[t++]=k,a[t++]=h,a[t++]=
m,a[t++]=m,a[t++]=q,a[t++]=k);l.assert(t===a.length);f={};f[d.POSITION]=a;f[d.NORMAL]=a;f[d.UV0]=a;n={};n[d.POSITION]={size:3,data:e};n[d.NORMAL]={size:3,data:b};n[d.UV0]={size:2,data:p};return new c(n,f)};k.createPolySphereGeometry=function(a,b,e){function k(b,c){b>c&&(c=[c,b],b=c[0],c=c[1]);var d=b.toString()+"."+c.toString();if(q[d])return q[d];var e=l.length;l.length+=3;h.add(l,3*b,l,3*c,l,e);h.scale(l,e,a/h.length(l,e));e/=3;return q[d]=e}var l;e?(l=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],e=
new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(e=a*(1+Math.sqrt(5))/2,l=[-a,e,0,a,e,0,-a,-e,0,a,-e,0,0,-a,e,0,a,e,0,-a,-e,0,a,-e,e,0,-a,e,0,a,-e,0,-a,-e,0,a],e=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var m=0;m<l.length;m+=3)h.scale(l,m,a/h.length(l,m));for(var q={},m=0;m<b;m++){for(var f=e.length,n=new Uint32Array(4*f),p=0;p<f;p+=3){var u=e[p],t=e[p+1],v=e[p+2],A=
k(u,t),g=k(t,v),x=k(v,u),y=4*p;n[y]=u;n[y+1]=A;n[y+2]=x;n[y+3]=t;n[y+4]=g;n[y+5]=A;n[y+6]=v;n[y+7]=x;n[y+8]=g;n[y+9]=A;n[y+10]=g;n[y+11]=x}e=n;q={}}b=new Float32Array(l);for(m=0;m<b.length;m+=3)h.normalize(b,m);m={};m[d.POSITION]=e;m[d.NORMAL]=e;e={};e[d.POSITION]={size:3,data:new Float32Array(l)};e[d.NORMAL]={size:3,data:b};return new c(e,m)};k.createPointGeometry=function(a,b,e,k,h,l,m){b=b?new Float32Array([b[0],b[1],b[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,
0,1]);l=l?new Float32Array(l):new Float32Array([0,0]);var q=e?new Uint8Array([255*e[0],255*e[1],255*e[2],3<e.length?255*e[3]:255]):new Uint8Array([255,255,255,255]),f=null!=k&&2===k.length?new Float32Array(k):new Float32Array([1,1]);k=new Uint32Array([0]);e={};e[d.POSITION]=k;e[d.NORMAL]=k;e[d.UV0]=k;e[d.COLOR]=k;e[d.SIZE]=k;var n={};n[d.POSITION]={size:3,data:b};n[d.NORMAL]={size:3,data:a};n[d.UV0]={size:l.length,data:l};n[d.COLOR]={size:4,data:q};n[d.SIZE]={size:2,data:f};null!=h&&(h=new Float32Array([h[0],
h[1],h[2],h[3]]),e[d.AUXPOS1]=k,n[d.AUXPOS1]={size:4,data:h});null!=m&&(m=new Float32Array([m[0],m[1],m[2],m[3]]),e[d.AUXPOS2]=k,n[d.AUXPOS2]={size:4,data:m});return new c(n,e,c.DefaultOffsets,"point")};k.createPointArrayGeometry=function(a,b){for(var e=new Float32Array(3*a.length),k=new Float32Array(b?3*a.length:3),h=new Uint32Array(a.length),l=new Uint32Array(a.length),m=0;m<a.length;m++)e[3*m]=a[m][0],e[3*m+1]=a[m][1],e[3*m+2]=a[m][2],b&&(k[3*m]=b[m][0],k[3*m+1]=b[m][1],k[3*m+2]=b[m][2]),h[m]=
m,l[m]=0;b||(k[0]=0,k[1]=1,k[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;m={};m[d.POSITION]=h;m[d.NORMAL]=b?h:l;m[d.UV0]=l;b={};b[d.POSITION]={size:3,data:e};b[d.NORMAL]={size:3,data:k};b[d.UV0]={size:2,data:a};return new c(b,m,c.DefaultOffsets,"point")};k.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),b=new Uint32Array([0,1,2]),e=new Float32Array([0,1,0]),k=new Uint32Array([0,0,0]),h=new Float32Array([0,0]),l=new Uint32Array([0,0,0]),m={};m[d.POSITION]=b;m[d.NORMAL]=
k;m[d.UV0]=l;b={};b[d.POSITION]={size:3,data:a};b[d.NORMAL]={size:3,data:e};b[d.UV0]={size:2,data:h};return new c(b,m)};k.createSquareGeometry=function(a){var b=new Float32Array(12);if(a)for(var e=0;4>e;e++)for(var k=0;3>k;k++)b[3*e+k]=a[e][k];else b[0]=-1,b[1]=-1,b[2]=0,b[3]=1,b[4]=-1,b[5]=0,b[6]=1,b[7]=1,b[8]=0,b[9]=-1,b[10]=1,b[11]=0;var h=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var l=new Uint32Array([0,0,0,0,0,0]),e=new Float32Array([0,0,1,0,1,1,0,1]),k=new Uint8Array([255,
255,255,255]),m={};m[d.POSITION]=h;m[d.NORMAL]=l;m[d.UV0]=h;m[d.COLOR]=l;h={};h[d.POSITION]={size:3,data:b};h[d.NORMAL]={size:3,data:a};h[d.UV0]={size:2,data:e};h[d.COLOR]={size:4,data:k};return new c(h,m)};k.createConeGeometry=function(a,e,k,h){var l=0,m=b.vec3.createFrom(0,l,0),q=b.vec3.createFrom(0,l+a,0),f=b.vec3.createFrom(0,-1,0),n=b.vec3.createFrom(0,1,0);h&&(l=a,q=b.vec3.createFrom(0,0,0),m=b.vec3.createFrom(0,l,0),f=b.vec3.createFrom(0,1,0),n=b.vec3.createFrom(0,-1,0));m=[q,m];f=[f,n];n=
k+2;q=Math.sqrt(a*a+e*e);if(h)for(h=k-1;0<=h;h--)p=2*Math.PI/k*h,u=b.vec3.createFrom(Math.cos(p)*e,l,Math.sin(p)*e),m.push(u),p=b.vec3.createFrom(a*Math.cos(p)/q,-e/q,a*Math.sin(p)/q),f.push(p);else for(h=0;h<k;h++){var p=2*Math.PI/k*h,u=b.vec3.createFrom(Math.cos(p)*e,l,Math.sin(p)*e);m.push(u);p=b.vec3.createFrom(a*Math.cos(p)/q,e/q,a*Math.sin(p)/q);f.push(p)}a=new Uint32Array(6*(k+2));k=new Uint32Array(6*(k+2));l=e=0;for(h=3;h<m.length;h++)a[e++]=1,a[e++]=h-1,a[e++]=h,k[l++]=0,k[l++]=0,k[l++]=
0;a[e++]=m.length-1;a[e++]=2;a[e++]=1;k[l++]=0;k[l++]=0;k[l++]=0;for(h=3;h<m.length;h++)a[e++]=h,a[e++]=h-1,a[e++]=0,k[l++]=h,k[l++]=h-1,k[l++]=1;a[e++]=0;a[e++]=2;a[e++]=m.length-1;k[l++]=1;k[l++]=2;k[l++]=f.length-1;e=new Float32Array(3*n);for(h=0;h<n;h++)e[3*h]=m[h][0],e[3*h+1]=m[h][1],e[3*h+2]=m[h][2];m=new Float32Array(3*n);for(h=0;h<n;h++)m[3*h]=f[h][0],m[3*h+1]=f[h][1],m[3*h+2]=f[h][2];f={};f[d.POSITION]=a;f[d.NORMAL]=k;n={};n[d.POSITION]={size:3,data:e};n[d.NORMAL]={size:3,data:m};return new c(n,
f)};k.createCylinderGeometry=function(a,e,k,h,l,m){h=h?b.vec3.create(h):b.vec3.createFrom(1,0,0);l=l?b.vec3.create(l):b.vec3.createFrom(0,0,0);m=void 0===m?!0:m;var q=b.vec3.create();b.vec3.normalize(h,q);h=b.vec3.create();b.vec3.scale(q,Math.abs(a),h);var f=b.vec3.create();b.vec3.scale(h,-.5,f);b.vec3.add(f,l);var n=b.vec3.createFrom(0,1,0);.2>Math.abs(1-b.vec3.dot(q,n))&&b.vec3.set3(0,0,1,n);var p=b.vec3.create();b.vec3.cross(q,n,p);b.vec3.normalize(p);b.vec3.cross(p,q,n);var u=2*k+(m?2:0),t=k+
(m?2:0);a=new Float32Array(3*u);l=new Float32Array(3*t);var v=new Float32Array(2*u),C=new Uint32Array(3*k*(m?4:2)),A=new Uint32Array(3*k*(m?4:2));m&&(a[3*(u-2)+0]=f[0],a[3*(u-2)+1]=f[1],a[3*(u-2)+2]=f[2],v[2*(u-2)]=0,v[2*(u-2)+1]=0,a[3*(u-1)+0]=a[3*(u-2)+0]+h[0],a[3*(u-1)+1]=a[3*(u-2)+1]+h[1],a[3*(u-1)+2]=a[3*(u-2)+2]+h[2],v[2*(u-1)]=1,v[2*(u-1)+1]=1,l[3*(t-2)+0]=-q[0],l[3*(t-2)+1]=-q[1],l[3*(t-2)+2]=-q[2],l[3*(t-1)+0]=q[0],l[3*(t-1)+1]=q[1],l[3*(t-1)+2]=q[2]);for(var q=function(a,b,c){C[a]=b;A[a]=
c},g=0,x=b.vec3.create(),y=b.vec3.create(),B=0;B<k;B++){var D=2*Math.PI/k*B;b.vec3.scale(n,Math.sin(D),x);b.vec3.scale(p,Math.cos(D),y);b.vec3.add(x,y);l[3*B+0]=x[0];l[3*B+1]=x[1];l[3*B+2]=x[2];b.vec3.scale(x,e);b.vec3.add(x,f);a[3*B+0]=x[0];a[3*B+1]=x[1];a[3*B+2]=x[2];v[2*B+0]=B/k;v[2*B+1]=0;a[3*(B+k)+0]=a[3*B+0]+h[0];a[3*(B+k)+1]=a[3*B+1]+h[1];a[3*(B+k)+2]=a[3*B+2]+h[2];v[2*(B+k)+0]=B/k;v[2*B+1]=1;D=(B+1)%k;q(g++,B,B);q(g++,B+k,B);q(g++,D,D);q(g++,D,D);q(g++,B+k,B);q(g++,D+k,D)}if(m){for(B=0;B<
k;B++)D=(B+1)%k,q(g++,u-2,t-2),q(g++,B,t-2),q(g++,D,t-2);for(B=0;B<k;B++)D=(B+1)%k,q(g++,B+k,t-1),q(g++,u-1,t-1),q(g++,D+k,t-1)}e={};e[d.POSITION]=C;e[d.NORMAL]=A;e[d.UV0]=C;k={};k[d.POSITION]={size:3,data:a};k[d.NORMAL]={size:3,data:l};k[d.UV0]={size:2,data:v};return new c(k,e)};k.createTubeGeometry=function(a,b,c,d,e){c=c||10;d=null!=d?d:!0;l.assert(1<a.length);for(var h=[],m=[],q=0;q<c;q++){h.push([0,-q-1,-((q+1)%c)-1]);var f=q/c*2*Math.PI;m.push([Math.cos(f)*b,Math.sin(f)*b])}return k.createPathExtrusionGeometry(m,
a,[[0,0,0]],h,d,e)};k.createPathExtrusionGeometry=function(a,k,h,l,m,n){var p=a.length,u=new Float32Array(k.length*p*3+(6*h.length||0)),t=new Float32Array(k.length*p+(2*h.length||0)),v=new Float32Array(k.length*p*3+(h?6:0)),g=(k.length-1)*p*6+6*l.length,C=new Uint32Array(g),g=new Uint32Array(g),x=0,A=0,B=0,y=0,D=0,r=b.vec3.create(),S=b.vec3.create(),W=b.vec3.create(),X=b.vec3.create(),Q=b.vec3.create(),I=b.vec3.create(),K=b.vec3.create(),T=b.vec3.create(),Y=b.vec3.create(),ba=b.vec3.create(),R=b.vec3.create(),
ha=b.vec3.create(),ea=b.vec3.create(),ca=f.plane.create();b.vec3.set3(0,1,0,Y);b.vec3.subtract(k[1],k[0],S);b.vec3.normalize(S);m?(b.vec3.add(k[0],n,T),b.vec3.normalize(T,W)):b.vec3.set3(0,0,1,W);var fa=q;e(S,W,Q,W,fa)||e(S,Y,Q,W,fa)||e(S,Y,Q,W,fa);b.vec3.set(W,X);b.vec3.set(Q,ha);for(var da=0;da<h.length;da++)b.vec3.scale(Q,h[da][0],I),b.vec3.scale(W,h[da][2],T),b.vec3.add(I,T),b.vec3.add(I,k[0]),u[x++]=I[0],u[x++]=I[1],u[x++]=I[2],t[B++]=0;v[A++]=-S[0];v[A++]=-S[1];v[A++]=-S[2];for(da=0;da<l.length;da++)C[y++]=
0<l[da][0]?l[da][0]:-l[da][0]-1+h.length,C[y++]=0<l[da][1]?l[da][1]:-l[da][1]-1+h.length,C[y++]=0<l[da][2]?l[da][2]:-l[da][2]-1+h.length,g[D++]=0,g[D++]=0,g[D++]=0;for(var fa=h.length,da=h.length-1,ga=0;ga<k.length;ga++){var ka=!1;if(0<ga){b.vec3.set(S,r);ga<k.length-1?(b.vec3.subtract(k[ga+1],k[ga],S),b.vec3.normalize(S)):ka=!0;b.vec3.add(r,S,ba);b.vec3.normalize(ba);b.vec3.add(k[ga-1],X,R);f.plane.fromPositionAndNormal(k[ga],ba,ca);if(f.plane.intersectRay(ca,R,r,T))b.vec3.subtract(T,k[ga]),b.vec3.normalize(T,
W),b.vec3.cross(ba,W,Q),b.vec3.normalize(Q);else{var U=ba,la=ha,sa=Y,ia=Q,w=W,qa=q;e(U,X,ia,w,qa)||e(U,la,ia,w,qa)||e(U,sa,ia,w,qa)}b.vec3.set(W,X);b.vec3.set(Q,ha)}m&&(b.vec3.add(k[ga],n,T),b.vec3.normalize(T,ea));for(U=0;U<p;U++)if(b.vec3.scale(Q,a[U][0],I),b.vec3.scale(W,a[U][1],T),b.vec3.add(I,T),b.vec3.normalize(I,K),v[A++]=K[0],v[A++]=K[1],v[A++]=K[2],m?t[B++]=b.vec3.dot(I,ea):t[B++]=I[2],b.vec3.add(I,k[ga]),u[x++]=I[0],u[x++]=I[1],u[x++]=I[2],!ka)for(la=(U+1)%p,C[y++]=fa+U,C[y++]=fa+p+U,C[y++]=
fa+la,C[y++]=fa+la,C[y++]=fa+p+U,C[y++]=fa+p+la,la=0;6>la;la++)g[D++]=C[y-6+la]-da;fa+=p}a=k[k.length-1];for(da=0;da<h.length;da++)b.vec3.scale(Q,h[da][0],I),b.vec3.scale(W,h[da][1],T),b.vec3.add(I,T),b.vec3.add(I,a),u[x++]=I[0],u[x++]=I[1],u[x++]=I[2],t[B++]=0;h=A/3;v[A++]=S[0];v[A++]=S[1];v[A++]=S[2];p=fa-p;for(da=0;da<l.length;da++)C[y++]=0<=l[da][0]?fa+l[da][0]:-l[da][0]-1+p,C[y++]=0<=l[da][2]?fa+l[da][2]:-l[da][2]-1+p,C[y++]=0<=l[da][1]?fa+l[da][1]:-l[da][1]-1+p,g[D++]=h,g[D++]=h,g[D++]=h;l=
{};l[d.POSITION]=C;l[d.NORMAL]=g;C={};C[d.POSITION]={size:3,data:u};C.zOffset={size:1,data:t};C[d.NORMAL]={size:3,data:v};return new c(C,l)};k.createPolylineGeometry=function(a,b){l.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");l.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");l.assert(void 0===b||b.length===a.length,"createPolylineGeometry: need same number of points and normals");l.assert(void 0===b||3===b[0].length,"createPolylineGeometry(): malformed normal");
for(var e=new Float32Array(3*a.length),k=new Uint32Array(2*(a.length-1)),h=0,m=0,q=0;q<a.length;q++){for(var f=0;3>f;f++)e[h++]=a[q][f];0<q&&(k[m++]=q-1,k[m++]=q)}h={};m={};h[d.POSITION]=k;m[d.POSITION]={size:3,data:e};if(b){for(var e=new Float32Array(3*b.length),n=0,q=0;q<a.length;q++)for(f=0;3>f;f++)e[n++]=b[q][f];h[d.NORMAL]=k;m[d.NORMAL]={size:3,data:e}}return new c(m,h,c.DefaultOffsets,"line")};k.addVertexColors=function(a,b){var e=b||[1,1,1,1];b=new Uint8Array(4);b[0]=255*e[0];b[1]=255*e[1];
b[2]=255*e[2];b[3]=255*(3<e.length?e[3]:1);var e={},k=a.getVertexAttr(),h;for(h in k)e[h]=k[h];e[d.COLOR]={size:4,data:b};b={};for(h in a.indices)b[h]=a.indices[h];b[d.COLOR]=new Uint32Array(b[d.POSITION].length);return a=new c(e,b,a.componentOffsets,a.primitiveType)};k.addNormals=function(c){var e=c.getVertexAttr();c=c.indices;for(var k=a.Vec3Compact.subtract,h=new Float32Array(c.position.length/3*3),l=e.position.data,q=0,f=c.position,n=new Uint32Array(f.length),p=0;p<f.length;p+=3){k(l,3*f[p],l,
3*f[p+2],u,0);k(l,3*f[p],l,3*f[p+1],m,0);b.vec3d.cross(m,u);b.vec3d.normalize(m);var t=q/3;h[q++]=m[0];h[q++]=m[1];h[q++]=m[2];n[p]=t;n[p+1]=t;n[p+2]=t}e[d.NORMAL]={size:3,data:h,offsetIdx:0,strideIdx:3};c[d.NORMAL]=n};k.cgToGIS=function(a){var b=a.getVertexAttr();a=b.position.data;if(b=b.normal.data)for(var c=0;c<b.length;c+=3){var d=b[c+1];b[c+1]=-b[c+2];b[c+2]=d}if(a)for(c=0;c<a.length;c+=3)d=a[c+1],a[c+1]=-a[c+2],a[c+2]=d}})(k||(k={}));var q=.99619469809,m=b.vec3.create(),u=b.vec3.create();return k})},
"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(r,g,f,a,c){return function(){function b(l,e,d,h){void 0===e&&(e=b.DefaultIndices);void 0===d&&(d=b.DefaultOffsets);void 0===h&&(h="triangle");this.preinterleaved=!1;var n={},t;for(t in l){var p=l[t],k=p.size;n[t]={data:p.data,size:k,offsetIdx:0,strideIdx:k}}if(e===b.DefaultIndices){e=c.getFirstObjectValue(n);l=a.generateDefaultIndexArray(e.data.length/e.size);
e={};for(var q in n)e[q]=l}this._id=a.getNewId();this._vertexAttributes=n;this._indices=e;this._componentOffsets=f.createOffsets(d);this._primitiveType=h}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){return c.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});b.prototype.getVertexAttr=function(){return this.vertexAttributes};b.prototype.toRenderData=function(){return{id:this._id.toString(),
preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};b.prototype.getIndices=function(a){return this._indices[a]};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*this._indices.color.length);return a};b.DefaultIndices=
{};b.DefaultOffsets=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});var f=1,a=null;g.generateDefaultIndexArray=function(b){if(b>f||null==a){for(;b>f;)f*=2;a=new Uint32Array(f);for(var c=0;c<f;c++)a[c]=c}return new Uint32Array(a.buffer,0,b)};var c=0;g.getNewId=function(){return c++}})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/Logger ../../../3d/support/imageUtils ./DDSUtil ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){function k(b,c,d,e,k,l,f){f=!1!==f;a.requestImage(c).then(function(a){h.assert(1<=a.width&&1<=a.height);d.samplingMode=f?9987:9729;d.hasMipmap=f;!f&&33071===d.wrapMode||h.isPowerOfTwo(a.width)&&h.isPowerOfTwo(a.height)?(d.width=a.width,d.height=a.height,a=new t(b,d,a)):a=q(b,a,d,e,k);b.bindTexture(a);l(a)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;m.error("Failed to load image from uri",b,a);l(null)})}function q(a,c,d,k,
l){var m=h.nextHighestPowerOfTwo(c.width),q=h.nextHighestPowerOfTwo(c.height);h.assert(m!==c.width||q!==c.height);d.width=m;d.height=q;var f=new t(a,d),v=n.createWithAttachments(a,f,{colorTarget:0,depthStencilTarget:0});c=new t(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!d.flipped,maxAnisotropy:8,preMultiplyAlpha:d.preMultiplyAlpha},c);a.bindFramebuffer(v);void 0===l&&(l=a.getViewport(),l=[l.x,l.y,l.width,l.height]);a.setViewport(0,0,m,q);k=k.get("texOnly");
m=u.identity();a.bindProgram(k);k.setUniformMatrix4fv("model",m);k.setUniformMatrix4fv("view",m);k.setUniformMatrix4fv("proj",m);k.setUniform4f("color",1,1,1,1);k.setUniform1i("tex",0);k=e.createQuadVAO(a,b.Pos3Tex);a.bindTexture(c,0);a.bindVAO(k);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!1);a.drawArrays(5,0,p.vertexCount(k,"geometry"));a.setDepthTestEnabled(!0);a.bindFramebuffer(null);a.setViewport(l[0],l[1],l[2],l[3]);k.dispose(!0);c.dispose();a.bindFramebuffer(null);v.detachColorTexture();
v.dispose();d.hasMipmap&&f.generateMipmap();return f}var m=f.getLogger("esri.views.3d.webgl-engine.lib.Texture"),u=l.mat4d;return function(){function a(b,c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequiredMB=a.estimateTexMemRequiredMB(this.data,
this.params)}a.estimateTexMemRequiredMB=function(a,b){return null==a?0:a instanceof ArrayBuffer||a instanceof Uint8Array?a.byteLength/1E6:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*4/1E6:(b.mipmap?4/3:1)*b.width*b.height*4/1E6||0};a.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=function(){return"string"===typeof this.data};
a.prototype.getWidth=function(){return this.params.width};a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=function(b,d,e,l,m){var f=this.data;d.flipped=!this.params.noUnpackFlip;d.samplingMode=this.params.mipmap?9987:9729;d.hasMipmap=this.params.mipmap;d.wrapMode=this.params.wrapClamp?33071:10497;d.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof f)k(b,f,d,e,l,m,this.params.mipmap);else{if(f instanceof Image||f instanceof ImageData||
f instanceof HTMLCanvasElement)this.params.width=f.width,this.params.height=f.height,!this.params.mipmap&&this.params.wrapClamp||h.isPowerOfTwo(f.width)&&h.isPowerOfTwo(f.height)?(d.width=f.width,d.height=f.height,d=new t(b,d,f)):d=q(b,f,d,e,l);else if(f instanceof ArrayBuffer&&this.params.encoding===a.DDS_ENCODING)d=c.createDDSTexture(b,d,f,this.params.mipmap);else if(f instanceof Uint8Array&&this.params.encoding===a.DDS_ENCODING)d=c.createDDSTexture(b,d,f.buffer,this.params.mipmap);else if(f instanceof
Uint8Array)h.assert(0<this.params.width&&0<this.params.height),d.pixelFormat=1===this.params.components?6409:6408,d.width=this.params.width,d.height=this.params.height,d=new t(b,d,f);else{if(null!==f)throw console.warn("Unsupported image data"),Error("Unsupported image data");d=new t(b,d,null)}b.bindTexture(d);m(d)}this.data=void 0};a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=
function(b){void 0===b&&(b="emptyTexture");return new a(new Uint8Array([0,0,0,0]),b,{width:1,height:1,wrapClamp:!0})};a.idGen=new d;a.DDS_ENCODING="image/vnd-ms.dds";return a}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.dataURItoBlob=function(a){var c=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(c.length),l=new Uint8Array(b),e=0;e<
c.length;e++)l[e]=c.charCodeAt(e);return new Blob([b],{type:a})};g.requestImage=function(a){return f(a,{responseType:"image",allowImageDataAccess:!0}).then(function(a){return a.data})}})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(r,g,f){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(g,"__esModule",{value:!0});var c=a("DXT1"),b=a("DXT3"),l=a("DXT5");
g.createDDSTexture=function(a,d,h,n){var e=new Int32Array(h,0,31);if(542327876!==e[0])return console.error("Invalid magic number in DDS header"),null;if(!(e[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var p=e[21],k;switch(p){case c:p=8;k=33776;break;case b:p=16;k=33778;break;case l:p=16;k=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(p&255,p>>8&255,p>>16&255,p>>24&255)),null}var q=1;e[2]&131072&&!1!==n&&(q=Math.max(1,
e[7]));n=e[4];var m=e[3],u=e[1]+4,g,v;d.samplingMode=1<q?9987:9729;d.hasMipmap=1<q;d.width=e[4];d.height=e[3];d=new f(a,d);a.bindTexture(d);for(e=0;;++e){e<q&&(v=Math.floor((n+3)/4)*Math.floor((m+3)/4)*p,g=new Uint8Array(h,u,v));a.gl.compressedTexImage2D(a.gl.TEXTURE_2D,e,k,n,m,0,g);u+=v;if(1===n&&1===m||1===q)break;n=Math.max(1,n>>1);m=Math.max(1,m>>1)}return d}})},"esri/views/webgl/Texture":function(){define(["require","exports","dojo/has"],function(r,g,f){return function(){function a(c,b,l){this._glName=
this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=c;this._desc={pixelFormat:b.pixelFormat,internalFormat:b.internalFormat,dataType:b.dataType,target:b.target?b.target:3553,samplingMode:b.samplingMode?b.samplingMode:9729,wrapMode:b.wrapMode?b.wrapMode:10497,maxAnisotropy:b.maxAnisotropy,flipped:void 0!==b.flipped?b.flipped:!1,hasMipmap:void 0!==b.hasMipmap?b.hasMipmap:!1,level:void 0!==b.level?b.level:0,unpackAlignment:b.unpackAlignment?
b.unpackAlignment:4,width:b.width,height:b.height,preMultiplyAlpha:void 0!==b.preMultiplyAlpha?b.preMultiplyAlpha:!1};this._id=++a._nextId;this.setData(l)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});a.prototype.dispose=
function(){var a=this;if(this._context){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};a.prototype.resize=function(a,b){var c=this._desc;if(c.width!==a||c.height!==b)c.width=a,c.height=b,this.setData(null)};a.prototype.setData=function(c){var b=this._context.gl;this._glName||(this._glName=b.createTexture());void 0===c&&(c=null);null===c&&(this._desc.width=this._desc.width||
4,this._desc.height=this._desc.height||4);var l=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var e=this._desc;a._validateTexture(e);b.pixelStorei(b.UNPACK_ALIGNMENT,e.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,e.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.preMultiplyAlpha);if(c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement)e.width&&e.height&&console.assert(c.width===e.width&&c.height===
e.height),b.texImage2D(b.TEXTURE_2D,e.level,e.internalFormat?e.internalFormat:e.pixelFormat,e.pixelFormat,e.dataType,c),void 0===this._desc.width&&(this._desc.width=c.width),void 0===this._desc.height&&(this._desc.height=c.height);else{null!=e.width&&null!=e.height||console.error("Width and height must be specified!");var d=e.internalFormat?e.internalFormat:e.pixelFormat,h=e.pixelFormat;b.DEPTH24_STENCIL8&&d===b.DEPTH_STENCIL&&(d=b.DEPTH24_STENCIL8);b.texImage2D(b.TEXTURE_2D,e.level,d,e.width,e.height,
0,h,e.dataType,c)}e.hasMipmap&&this.generateMipmap();a._applySamplingMode(b,this._desc);a._applyWrapMode(b,this._desc);a._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(l,0)};a.prototype.updateData=function(a,b,l,e,d,h){h||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var c=this._context.gl,f=this._desc,p=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>
b||0>l||e>f.width||d>f.height||b+e>f.width||l+d>f.height)&&console.error("An attempt to update out of bounds of the texture!");h instanceof ImageData||h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement?(console.assert(h.width===e&&h.height===d),c.texSubImage2D(c.TEXTURE_2D,a,b,l,f.pixelFormat,f.dataType,h)):c.texSubImage2D(c.TEXTURE_2D,a,b,l,e,d,f.pixelFormat,f.dataType,h);this._context.bindTexture(p,0)};a.prototype.generateMipmap=function(){var c=this._desc;
c.hasMipmap||(c.hasMipmap=!0,a._validateTexture(c));9729===c.samplingMode?(this._samplingModeDirty=!0,c.samplingMode=9985):9728===c.samplingMode&&(this._samplingModeDirty=!0,c.samplingMode=9984);c=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var b=this._context.gl;b.generateMipmap(b.TEXTURE_2D);this._context.bindTexture(c,0)};a.prototype.setSamplingMode=function(c){c!==this._desc.samplingMode&&(this._desc.samplingMode=c,a._validateTexture(this._desc),this._samplingModeDirty=
!0)};a.prototype.setWrapMode=function(c){c!==this._desc.wrapMode&&(this._desc.wrapMode=c,a._validateTexture(this._desc),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var c=this._context.gl,b=this._desc;this._samplingModeDirty&&(a._applySamplingMode(c,b),this._samplingModeDirty=!1);this._wrapModeDirty&&(a._applyWrapMode(c,b),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._isPowerOfTwo=function(a){return 0===
(a&a-1)};a._validateTexture=function(c){(0>c.width||0>c.height)&&console.error("Negative dimension parameters are not allowed!");a._isPowerOfTwo(c.width)&&a._isPowerOfTwo(c.height)||(33071!==c.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),c.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=function(a,b){var c=b.samplingMode;if(9985===c||9987===c)c=9729;else if(9984===c||9986===c)c=9728;a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.samplingMode)};a._applyWrapMode=function(a,b){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)};a._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var c=a.capabilities.textureFilterAnisotropic;c&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require",
"exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];g.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];g.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];g.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,
normalized:!1}];g.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});g.createQuadVAO=function(b,d){void 0===
d&&(d=a.Pos2);var e=d===a.Pos3Tex?new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]):new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new l(b,f.Default3D,{geometry:d},{geometry:c.createVertex(b,35044,e)})};g.createEmptyTexture=function(a,c){void 0===c&&(c=4);return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c})};g.createColorTexture=function(a,c,h){void 0===h&&(h=4);for(var d=new Uint8Array(h*h*4),e=0;e<d.length;e+=4)d[e+0]=255*c[0],d[e+1]=255*
c[1],d[e+2]=255*c[2],d[e+3]=255*c[3];return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:h,height:h},d)}})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(r,g){return function(){function f(){this._count=0}f.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return f}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","dojo/has","./Texture"],function(r,g,f,a){return function(){function c(b,
l,e,d){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=b;this._desc={colorTarget:l.colorTarget,depthStencilTarget:l.depthStencilTarget,width:l.width,height:l.height,multisampled:l.multisampled};this._id=c._nextId++;e&&(b=void 0,e instanceof a?(this._colorAttachment=e,b=e.descriptor):(b=e,this._colorAttachment=new a(this._context,b)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),
c._validateTextureDimensions(b,this._desc));d&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),e=void 0,d instanceof a?(this._depthStencilTexture=d,e=this._depthStencilTexture.descriptor):(e=d,this._depthStencilTexture=new a(this._context,e)),c._validateTextureDimensions(e,this._desc))}c.create=function(a,l){return new c(a,l)};c.createWithAttachments=function(a,l,
e,d){return new c(a,e,l,d)};Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof a?this._colorAttachment:null},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),
this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context=null)};c.prototype.attachColorTexture=function(a){if(a){c._validateTextureDimensions(a.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a.glName,0)}this._colorAttachment=a}};c.prototype.detachColorTexture=function(){var b=void 0;if(this._colorAttachment instanceof
a){b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null,0)}this._colorAttachment=null}return b};c.prototype.attachDepthStencilTexture=function(a){if(a){var b=a.descriptor;34041!==b.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==b.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");c._validateTextureDimensions(b,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),b=this._context.gl,b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,a.glName,0));this._depthStencilTexture=
a}};c.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};c.prototype.copyToTexture=function(a,c,e,d,h,f,t){(0>a||0>c||0>h||0>f)&&console.error("Offsets cannot be negative!");(0>=e||0>=d)&&console.error("Copy width and height must be greater than zero!");
var b=this._desc,k=t.descriptor;3553!==t.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+e>b.width||c+d>b.height||h+e>k.width||f+d>k.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");b=this._context;b.bindTexture(t);b.bindFramebuffer(this);b.gl.copyTexSubImage2D(3553,0,h,f,a,c,e,d)};c.prototype.readPixels=function(a,c,e,d,h,f,t){(0>=e||0>=d)&&console.error("Copy width and height must be greater than zero!");t||
console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,c,e,d,h,f,t)};c.prototype.resize=function(b,l){var e=this._desc;if(e.width!==b||e.height!==l)if(this._initialized)e.width=b,e.height=l,this._colorAttachment instanceof a?(d=this._colorAttachment,e=d.descriptor,e.width=b,e.height=l,this._colorAttachment.dispose(),this._colorAttachment=new a(this._context,e),c._validateTextureDimensions(d.descriptor,this._desc)):this._colorAttachment&&
this._disposeColorAttachment(),null!=this._depthStencilTexture?(e=this._depthStencilTexture.descriptor,e.width=b,e.height=l,this._depthStencilTexture.dispose(),this._depthStencilTexture=new a(this._context,e)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{e.width=b;e.height=l;if(this._colorAttachment instanceof a){var d=this._colorAttachment;d.resize(b,
l)}this._depthStencilTexture&&this._depthStencilTexture.resize(b,l)}};c.prototype.initialize=function(){if(this._initialized)return!1;var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);var c=b.createFramebuffer(),e=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,c);if(!this._colorAttachment)if(0===e.colorTarget)this._colorAttachment=new a(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height});else{var d=b.createRenderbuffer();
b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,b.RGBA4,e.width,e.height);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,d);this._colorAttachment=d}this._colorAttachment instanceof a&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(e.depthStencilTarget){case 1:case 3:d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);var h=1===e.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT;
b.renderbufferStorage(b.RENDERBUFFER,1===e.depthStencilTarget?b.DEPTH_COMPONENT16:b.DEPTH_STENCIL,e.width,e.height);b.framebufferRenderbuffer(b.FRAMEBUFFER,h,b.RENDERBUFFER,d);this._depthAttachment=d;break;case 2:d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,b.STENCIL_INDEX8,e.width,e.height);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,d);this._stencilAttachment=d;break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||
console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new a(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");
this._glName=c;return this._initialized=!0};c.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof a){var b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null,0)}b.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(b=this._colorAttachment,c=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),c.framebufferRenderbuffer(c.FRAMEBUFFER,
c.COLOR_ATTACHMENT0,c.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(b));this._colorAttachment=null};c.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,null)}a.deleteRenderbuffer(this._depthAttachment);this._depthAttachment=
null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,null)),a.deleteRenderbuffer(this._stencilAttachment),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a=this._context.gl,a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=
null)};c._validateTextureDimensions=function(a,c){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==c.width&&0<=c.width&&void 0!==c.height&&0<=c.height?c.width===a.width&&c.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(c.width=a.width,c.height=a.height)};c._nextId=0;return c}()})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger",
"./Util","../../../webgl/Texture"],function(r,g,f,a,c){var b=f.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),l=function(){function b(a){this._glTexture=null;this._refCount=0;this._glTexture=a}b.prototype.incRefCnt=function(){++this._refCount};b.prototype.decRefCnt=function(){--this._refCount;a.assert(0<=this._refCount)};b.prototype.getRefCnt=function(){return this._refCount};b.prototype.setGLTexture=function(a){this._glTexture=a};b.prototype.getGLTexture=function(){return this._glTexture};
return b}();return function(){function e(a,b,c,e){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=b;this.getViewportToRestore=c;this._rctx=e;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=e.capabilities.textureFilterAnisotropic)?e.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=
new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}e.prototype.resetNeedsRender=function(){this._needsRender=!1};e.prototype.needsRender=function(){return this._needsRender};e.prototype.aquire=function(d,e,f){var h=this,n=this.id2textureRef[d];if(null==n){var k=this.textures[d];
a.assert(void 0!==k);k.setUnloadFunc(this._unload.bind(this));e=!0===e;var q=this._createGLTextureDescription(k),n=new l(null);a.assert(null==this.id2textureRef[d]);this.id2textureRef[d]=n;if(k.initializeThroughRender)d=k.initializeThroughRender(this._rctx,q),n.setGLTexture(d),f&&f(n);else if(k.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(d,q,f):this._queue.push([d,q,f]);else try{k.initializeThroughUpload(this._rctx,q,this._programRepository,this.getViewportToRestore(),
function(a){n.setGLTexture(a);h._needsRender=!0;f&&f(n)})}catch(m){b.error("#aquire","Error loading texture: "+m.toString())}null==n.getGLTexture()&&n.setGLTexture(e?new c(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new c(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));this._needsRender=!0}n.incRefCnt();return n};e.prototype.release=function(b){b=this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),a.assert(0<=b.getRefCnt()))};e.prototype.getLoadingCount=
function(){return Object.keys(this.loading).length};e.prototype.getIsLoaded=function(a){if(null==this.id2textureRef[a]||void 0!==this.loading[a])return!1;for(var b=0;b<this._queue.length;++b)if(this._queue[b][0]===a)return!1;return!0};e.prototype.addTextureListener=function(b){a.assert(-1===this.listeners.indexOf(b));this.listeners.push(b)};e.prototype.removeTextureListener=function(b){b=this.listeners.indexOf(b);a.assert(-1!==b);this.listeners.splice(b,1)};e.prototype.getTexture=function(a){return this.textures[a]};
e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};e.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&((b=b.getGLTexture())&&b.dispose(),delete this.id2textureRef[a]);this.next(a)};e.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}};e.prototype.next=function(a){if(a in
this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(d){d(a,b,c)});this.processQueue()}};e.prototype._loadImage=function(b,c,e){var d=this;a.assert(null==this.loading[b]);this.loading[b]=!0;var h=this.textures[b];a.assert(void 0!==h);setTimeout(function(){var a=d.id2textureRef[b];a&&a.getRefCnt()&&h.initializeThroughUpload(d._rctx,c,d._programRepository,d.getViewportToRestore(),function(c){d.next(b);d._needsRender=!0;
a&&a.getRefCnt()&&(a.setGLTexture(c),e&&e(a))})},0)};e.prototype.processQueue=function(){for(var a=[],b=0;b<this._queue.length;++b){var c=this._queue[b][0],e=this.id2textureRef[c];void 0!==e&&(0===e.getRefCnt()?(e.getGLTexture().dispose(),delete this.id2textureRef[c]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};
return e}()})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require","exports"],function(r,g){var f;r=f||(f={});r[r.MATERIAL=0]="MATERIAL";r[r.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";r[r.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";r[r.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";r[r.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";r[r.MAX_PASS=5]="MAX_PASS";return f})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(r,g){var f;r=f||(f={});r[r.BACKGROUND=
0]="BACKGROUND";r[r.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";r[r.STENCIL_MATERIAL=2]="STENCIL_MATERIAL";r[r.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";r[r.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";r[r.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";r[r.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";r[r.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";r[r.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";r[r.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";r[r.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";r[r.POSTPROCESSING_ATMOSPHERE_OPAQUE=
11]="POSTPROCESSING_ATMOSPHERE_OPAQUE";r[r.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT";r[r.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL";r[r.HUDMATERIAL1=14]="HUDMATERIAL1";r[r.HUDMATERIAL2=15]="HUDMATERIAL2";r[r.LINE_CALLOUTS=16]="LINE_CALLOUTS";r[r.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";r[r.MAX_SLOTS=18]="MAX_SLOTS";return f})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define([],function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/webgl/Program":function(){define(["require","exports","dojo/has","./ShaderTranspiler"],function(r,g,f,a){return function(){function c(a,l,e,d,h){void 0===h&&(h={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};
this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===l.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=l;this._fragmentShaderSource=e;if(Array.isArray(h))for(a=0;a<h.length;a++)this._defines[h[a]]="1";else this._defines=h;this._id=c._nextId++;this._locations=d}Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});c.prototype.getDefine=function(a){return this._defines[a]};c.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};c.prototype.initialize=
function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,c=a.createProgram();a.attachShader(c,this._vShader);a.attachShader(c,this._fShader);for(var e in this._locations)a.bindAttribLocation(c,this._locations[e],e);a.linkProgram(c);a.getProgramParameter(c,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(c,
a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(c));this._glName=c;this._initialized=!0}};c.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};c.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};c.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&
(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};c.prototype.setUniform1i=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c!==b)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),c),this._nameToUniform1[a]=c};c.prototype.setUniform1f=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c!==b)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),
c),this._nameToUniform1[a]=c};c.prototype.setUniform1fv=function(a,f){var b=this._nameToUniform2[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(a),f),void 0===b?this._nameToUniform2[a]=new Float32Array(f):b.set(f))};c.prototype.setUniform2f=function(a,c,e){var b=this._nameToUniform2[a];if(void 0===b||c!==b[0]||e!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),c,e),void 0===b?this._nameToUniform2[a]=
new Float32Array([c,e]):(b[0]=c,b[1]=e)};c.prototype.setUniform2fv=function(a,f){var b=this._nameToUniform2[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(a),f),void 0===b?this._nameToUniform2[a]=new Float32Array(f):b.set(f))};c.prototype.setUniform3f=function(a,c,e,d){var b=this._nameToUniform3[a];if(void 0===b||c!==b[0]||e!==b[1]||d!==b[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),
c,e,d),void 0===b?this._nameToUniform3[a]=new Float32Array([c,e,d]):(b[0]=c,b[1]=e,b[2]=d)};c.prototype.setUniform3fv=function(a,f){var b=this._nameToUniform3[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(a),f),void 0===b?this._nameToUniform3[a]=new Float32Array(f):b.set(f))};c.prototype.setUniform4f=function(a,c,e,d,h){var b=this._nameToUniform4[a];if(void 0===b||c!==b[0]||e!==b[1]||d!==b[2]||h!==b[3])this._context.bindProgram(this),
this._context.gl.uniform4f(this.getUniformLocation(a),c,e,d,h),void 0===b?this._nameToUniform4[a]=new Float32Array([c,e,d,h]):(b[0]=c,b[1]=e,b[2]=d,b[3]=h)};c.prototype.setUniform4fv=function(a,f){var b=this._nameToUniform4[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(a),f),void 0===b?this._nameToUniform4[a]=new Float32Array(f):b.set(f))};c.prototype.setUniformMatrix3fv=function(a,f,e){void 0===e&&(e=!1);var b=this._nameToUniformMatrix3[a];
void 0!==b&&(9===b.length?c._matrix3Equal(b,f):c._arraysEqual(f,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(a),e,f),void 0===b?this._nameToUniformMatrix3[a]=new Float32Array(f):b.set(f))};c.prototype.setUniformMatrix4fv=function(a,f,e){void 0===e&&(e=!1);var b=this._nameToUniformMatrix4[a];void 0!==b&&(16===b.length?c._matrix4Equal(b,f):c._arraysEqual(f,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(a),
e,f),void 0===b?this._nameToUniformMatrix4[a]=new Float32Array(f):b.set(f))};c._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};c.prototype._addLineNumbers=function(a){var b=2;return a.replace(/\n/g,function(){return"\n"+c._padToThree(b++)+":"})};c.prototype._loadShader=function(b){var c=35633===b,e=c?this._vertexShaderSource:this._fragmentShaderSource,d;d="";for(var h in this._defines)d+="#define "+h+" "+this._defines[h]+"\n";d+=e;"webgl2"===this._context.contextVersion&&
(d=a.transpileShader(d,c?"vertex":"fragment"));c=this._context.gl;b=c.createShader(b);c.shaderSource(b,d);c.compileShader(b);c.getShaderParameter(b,c.COMPILE_STATUS)||(console.error(c.getShaderInfoLog(b)),console.error(this._addLineNumbers(d)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(e)));return b};c._matrix4Equal=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&
a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};c._matrix3Equal=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]};c._arraysEqual=function(a,c){if(a.length!==c.length)return!1;for(var b=0;b<a.length;++b)if(a[b]!==c[b])return!1;return!0};c._nextId=0;return c}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3",
"./lib/glsl-tokenizer/string"],function(r,g,f,a){function c(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function b(a,c,e,f){f=f||e;for(var d=0;d<a.length;d++){var k=a[d];if("ident"===k.type&&k.data===e)return f in c?c[f]++:c[f]=0,b(a,c,f+"_"+c[f],f)}return e}function l(a,b,c){void 0===c&&(c="afterVersion");var d={data:"\n",type:"whitespace"},e=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},k=function(a){for(var b=-1,d=0,e=-1,k=0;k<a.length;k++){var h=a[k];"preprocessor"===
h.type&&(h.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:h.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===c||"afterPrecision"===c)&&"preprocessor"===h.type&&/^#version/.test(h.data)&&(e=Math.max(e,k));if("afterPrecision"===c&&"keyword"===h.type&&"precision"===h.data){a:{for(h=k;h<a.length;h++){var f=a[h];if("operator"===f.type&&";"===f.data)break a}h=null}if(null===h)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,h)}b<e&&0===d&&(b=k)}return b+1}(a);e(k-1)&&a.splice(k++,
0,d);for(var h=0;h<b.length;h++){var f=b[h];a.splice(k++,0,f)}e(k-1)&&e(k)&&a.splice(k,0,d)}Object.defineProperty(g,"__esModule",{value:!0});var e=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];g.transpileShader=function(d,h){d=a(d);var n;a:{n="100";var t="300 es";void 0===n&&(n="100");void 0===t&&(t="300 es");for(var p=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,k=0;k<d.length;k++){var q=d[k];if("preprocessor"===q.type){var m=p.exec(q.data);
if(m)if(p=m[1].replace(/\s\s+/g," "),p===t){n=p;break a}else if(p===n){q.data="#version "+t;break a}else throw Error("unknown glsl version: "+p);}}d.splice(0,0,{type:"preprocessor",data:"#version "+t},{type:"whitespace",data:"\n"});n=null}if("300 es"===n)throw Error("shader is already glsl 300 es");p=q=null;k={};m={};for(n=0;n<d.length;++n)switch(t=d[n],t.type){case "keyword":"vertex"===h&&"attribute"===t.data?t.data="in":"varying"===t.data&&(t.data="vertex"===h?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(t.data.trim())&&
(t.data=t.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===h&&"gl_FragColor"===t.data){if(!q){var q=b(d,k,"fragColor"),u=void 0;void 0===u&&(u="lowp");l(d,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:q},{type:"operator",data:";"}],"afterPrecision")}t.data=q}else"fragment"===h&&"gl_FragDepthEXT"===t.data&&(p||(p=b(d,k,"gl_FragDepth")),t.data=p);break;case "ident":if(0<=
f.indexOf(t.data)){if(u="vertex"===h)a:{for(u=n-1;0<=u;u--){var g=d[u];if("whitespace"!==g.type&&"block-comment"!==g.type)if("keyword"===g.type){if("attribute"===g.data||"in"===g.data){u=!0;break a}}else break}u=!1}if(u)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");t.data in m||(m[t.data]=b(d,k,t.data));t.data=m[t.data]}}for(n=d.length-1;0<=n;--n)t=d[n],"preprocessor"===t.type&&((h=t.data.match(/\#extension\s+(.*)\:/))&&h[1]&&0<=e.indexOf(h[1].trim())&&
(h=d[n+1],d.splice(n,h&&"whitespace"===h.type?2:1)),(h=t.data.match(/\#ifdef\s+(.*)/))&&h[1]&&0<=e.indexOf(h[1].trim())&&(t.data="#if 1"),(h=t.data.match(/\#ifndef\s+(.*)/))&&h[1]&&0<=e.indexOf(h[1].trim())&&(t.data="#if 0"));return c(d)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(r,g){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(r){"use strict;";return function(g){var f=r(),a=[],a=a.concat(f(g));return a=a.concat(f(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(r,g,f){"use strict;";var a="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function c(b){b.length&&x.push({type:a[k],
data:b,position:A,line:v,column:y})}function b(){u=u.length?[]:u;if("/"===m&&"*"===q)return A=p+t-1,k=0,m=q,t+1;if("/"===m&&"/"===q)return A=p+t-1,k=1,m=q,t+1;if("#"===q)return k=2,A=p+t,t;if(/\s/.test(q))return k=9,A=p+t,t;C=/\d/.test(q);B=/[^\w_]/.test(q);A=p+t;k=C?4:B?3:9999;return t}function l(){if(("\r"===q||"\n"===q)&&"\\"!==m)return c(u.join("")),k=999,t;u.push(q);m=q;return t+1}function e(){if("."===m&&/\d/.test(q))return k=5,t;if("/"===m&&"*"===q)return k=0,t;if("/"===m&&"/"===q)return k=
1,t;if("."===q&&u.length){for(;d(u););k=5;return t}if(";"===q||")"===q||"("===q){if(u.length)for(;d(u););c(q);k=999;return t+1}var a=2===u.length&&"\x3d"!==q;if(/[\w_\d\s]/.test(q)||a){for(;d(u););k=999;return t}u.push(q);m=q;return t+1}function d(a){var b=0,d,e;do{d=g.indexOf(a.slice(0,a.length+b).join(""));e=g[d];if(-1===d){if(0<b--+a.length)continue;e=a.slice(0,1).join("")}c(e);A+=e.length;u=u.slice(e.length);return u.length}while(1)}function h(){if("."===q||/[eE]/.test(q))return u.push(q),k=5,
m=q,t+1;if("x"===q&&1===u.length&&"0"===u[0])return k=11,u.push(q),m=q,t+1;if(/[^\d]/.test(q))return c(u.join("")),k=999,t;u.push(q);m=q;return t+1}function n(){"f"===q&&(u.push(q),m=q,t+=1);if(/[eE]/.test(q)||"-"===q&&/[eE]/.test(m))return u.push(q),m=q,t+1;if(/[^\d]/.test(q))return c(u.join("")),k=999,t;u.push(q);m=q;return t+1}var t=0,p=0,k=999,q,m,u=[],x=[],v=1,y=0,A=0,C=!1,B=!1,D="",E;return function(a){x=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;t=0;D+=a;for(E=D.length;q=D[t],t<
E;){a=t;switch(k){case 0:"/"===q&&"*"===m?(u.push(q),c(u.join("")),k=999):(u.push(q),m=q);t+=1;break;case 1:t=l();break;case 2:t=l();break;case 3:t=e();break;case 4:t=h();break;case 11:/[^a-fA-F0-9]/.test(q)?(c(u.join("")),k=999):(u.push(q),m=q,t+=1);break;case 5:t=n();break;case 9999:if(/[^\d\w_]/.test(q)){var d=u.join("");k=-1<r.indexOf(d)?8:-1<f.indexOf(d)?7:6;c(u.join(""));k=999}else u.push(q),m=q,t+=1;break;case 9:/[^\s]/g.test(q)?(c(u.join("")),k=999):(u.push(q),m=q,t+=1);break;case 999:t=b()}if(a!==
t)switch(D[a]){case "\n":y=0;++v;break;default:++y}}p+=t;D=D.slice(t);return x}u.length&&c(u.join(""));k=10;c("(eof)");return x}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/3d/environment/RealisticAtmosphere":function(){define("dojo/text!./materials/RealisticAtmosphereMaterial.xml ../../../core/watchUtils ../../../core/Handles ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/OffscreenRenderingHelper ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){var q=n.earthRadius,m=c.vec3d,u=c.vec2d,x=c.vec4d;c=.02*Math.PI;n=.004*Math.PI;var v=m.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),y=m.create(v);m.scale(y,c);m.add(y,m.createFrom(n,n,n));var A=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5;a=a.createSubclass({declaredClass:"esri.views.3d.environment.RealisticAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._handles=
new f;this._lowerElevationBoundRadius=0;this._earthRadius=q;this._renderer=this._skyProgram=this._hazeProgram=null;this._renderData={texDepth:u.create(),v3CameraPos:m.create(),v3CameraUp:m.create(),v3CameraRight:m.create(),v3CameraDir:m.create(),halfSizeNearPlane:u.create(),v2CameraCenterOffset:u.create(),v4SphereComp:x.create(),v4AtmosParams1:x.create(),v4AtmosParams2:x.create(),v4AtmosParams3:x.create(),v3InvWavelength:v,v3InvWavelengthScaled:y,v4Radii:x.create(),fScale:0,fScaleDepth:.25,fLowerAlphaBlendBound:0,
fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:.05,fOneOverScaleDepthBlue:20,fScaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,fMiePhaseCoefficients:A,showTest:0,nearFar:u.create()};this._updateRadius(q);this._hazeSlot=d.POSTPROCESSING_ATMOSPHERE_TRANSPARENT},destroy:function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null)},setup:function(a){var c=
l.createSquareGeometry([[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]]).toRenderData(),d=this.renderContext.rctx;this._renderer=new b(c,p.Pos3Tex,null,d);c=this._update.bind(this);this._handles.add(g.init(this,"view.state.camera",c,!0));var c=this._updateElevation.bind(this),e=function(){this._updateElevation({tile:this.view.basemapTerrain.rootTiles[0]})}.bind(this),h=this._updateVisibleElevationBounds.bind(this);this._handles.add(g.on(this,"view.basemapTerrain","elevation-change",c,e));this._handles.add(g.on(this,
"view.basemapTerrain","elevation-bounds-change",h,h));a.shaderSnippets.fsRealisticAtmosphere||a.shaderSnippets._parse(r);this._hazeProgram=new t(d,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,k.Default3D,["HAZE"]);this._skyProgram=new t(d,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,k.Default3D)},render:function(a){var b=!1;if(a.slot!==this._hazeSlot&&a.slot!==this.slot||a.pass!==e.MATERIAL)return b;a.slot===this.slot&&(this._renderSky(a),
b=!0);a.slot===this._hazeSlot&&(this._renderHaze(a),b=!0);return b},_renderSky:function(a){var b=this.renderContext.rctx,c=b.gl,d=this._skyProgram;b.bindProgram(d);b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);b.setDepthFunction(c.LEQUAL);b.setDepthTestEnabled(!0);d.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(d,a)},_renderHaze:function(a){var b=this.renderContext.rctx,c=b.gl,d=a.offscreenRenderingHelper,e=this._hazeProgram;
b.bindProgram(e);b.setBlendFunctionSeparate(c.ONE,c.ONE_MINUS_SRC_COLOR,c.ZERO,c.ONE);d.detachDepthTextureFromBuffer();b.setDepthTestEnabled(!1);c=d.getDepthTexture();b.bindTexture(c,0);e.setUniform1i("tDepth",0);this._renderCommon(e,a);d.restoreDepthTextureToBuffer()},_renderCommon:function(a,b){var c=this.renderContext.rctx,d=c.gl;a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",
b.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);a.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);
a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);a.setUniform1f("showTest",this._renderData.showTest);c.setBlendingEnabled(!0);c.setDepthWriteEnabled(!1);this._renderer.render(a);c.setDepthFunction(d.LESS);c.setDepthTestEnabled(!1);c.setDepthWriteEnabled(!0);c.setBlendingEnabled(!1);c.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA)},
_setEnableTestImage:function(a){this._renderData.showTest=a?1:0;this.needsRender=!0},_adjustRadiusForTesselation:function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)},_normalizeRadius:function(a){a=this._adjustRadiusForTesselation(a);return Math.max(q-1E4,Math.min(a,q))},_updateElevation:function(a){0===a.tile.lij[0]&&(a=this._adjustRadiusForTesselation(q+a.tile.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))},
_updateVisibleElevationBounds:function(){var a=this._adjustRadiusForTesselation(q+this.view.basemapTerrain.getElevationBounds()[0]);return 0>this._earthRadius||a<this._earthRadius?this._updateRadius(a):!1},_updateRadius:function(a){this._earthRadius=a;var b=a*a,c=a/10*10.25,d=c*c,e=1/(c-a),k=e/.25,h=e/.05,f=.3*(c-a)+a,m=1/(c-f),q=this._renderData;x.set4(e,.25,k,4,q.v4AtmosParams1);x.set4(-.99999,.05,h,20,q.v4AtmosParams2);x.set4(-.99999*-.99999,A,f,m,q.v4AtmosParams3);x.set4(a,b,c,d,q.v4Radii);q.fScale=
e;q.fLowerAlphaBlendBound=f;q.fScaleOverScaleDepth=k;q.fScaleOverScaleDepthBlue=h;this._update();return!0},_update:function(a){if(a=a||this.get("view.state.camera"))m.negate(a.viewForward,this._renderData.v3CameraDir),m.set(a.viewUp,this._renderData.v3CameraUp),m.set(a.viewRight,this._renderData.v3CameraRight),this._renderData.fCameraHeight=m.length(a.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight,this._renderData.fC=this._renderData.fCameraHeight2-
this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=x.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),m.set(a.eye,this._renderData.v3CameraPos),u.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane),u.set2((a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/
a.fullHeight-.5,this._renderData.v2CameraCenterOffset),u.set2(a.near,a.far,this._renderData.nearFar),this.needsRender=!0}});a.isSupported=function(a){return h.supportsDepthTexture(a.rctx)};return a})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports dojo/text!../materials/internal/offscreen.xml ./DefaultVertexAttributeLocations ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h){var n={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},p=[0,0,0,0],k=[0,0,0,1];return function(){function q(a,b){this._intermediateTexture=this._hudVisibilityTexture=null;this._enabled=!1;this._height=this._width=0;this._background={type:"plain",color:[0,0,0,1]};this._programRep=a;this._rctx=b;this._height=this._width=null}Object.defineProperty(q.prototype,
"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});q.prototype.enable=function(){if(!this.getEnableState()){var a=this._rctx;this._enabled=!0;this.framebuffer=l.createWithAttachments(a,n,{colorTarget:0,depthStencilTarget:a.capabilities.depthTexture?4:3});this.quadVAO=c.createQuadVAO(a)}};q.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),
this.quadVAO.dispose(!0),this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};q.prototype.setEnableState=function(a){a?this.enable():this.disable()};Object.defineProperty(q.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});q.prototype.getEnableState=function(){return this._enabled};q.prototype.getColorTexture=function(){return this.framebuffer.colorTexture};q.prototype.getDepthTexture=function(){return q.supportsDepthTexture(this._rctx)?
this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null};q.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture};q.supportsDepthTexture=function(a){return a.capabilities.depthTexture};q.prototype.initializeFrame=function(a){b.assert(this.getEnableState());var c=this._rctx,d=c.gl;a=a.fullViewport;this._width=a[2];this._height=a[3];this.framebuffer.resize(this._width,this._height);c.bindFramebuffer(this.framebuffer);c.setClearStencil(0);a=this._background.color;
c.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);c.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT)};q.prototype.renderSeparateColor=function(a,b,c){void 0===c&&(c=p);var d=this._rctx,e=d.gl;a.resize(this._width,this._height);var k=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(a);d.bindFramebuffer(this.framebuffer);d.setClearColor(c[0],c[1],c[2],Math.max(1E-13,c[3]));d.clear(e.COLOR_BUFFER_BIT);b();e.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(k)};
q.prototype.renderSeparateAndComposite=function(a,b,c){void 0===b&&(b=p);void 0===c&&(c="none");this._intermediateTexture||(this._intermediateTexture=new d(this._rctx,n));this.renderSeparateColor(this._intermediateTexture,a,b);this.composite(this._intermediateTexture,this.framebuffer,c)};q.prototype.renderHUDVisibility=function(a){this._hudVisibilityTexture||(this._hudVisibilityTexture=new d(this._rctx,t));this.renderSeparateColor(this._hudVisibilityTexture,a,k)};q.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
q.prototype.getFramebuffer=function(){return this.framebuffer};q.prototype.detachDepthTextureFromBuffer=function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()};q.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};q.prototype.composite=function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=null);void 0===
c&&(c="none");var d=this._rctx,e=this._programRep.get("offscreenProgram");d.bindFramebuffer(b);d.setDepthTestEnabled(!1);d.bindProgram(e);e.setUniform1i("tex",1);d.bindTexture(a,1);d.setBlendFunction(1,771);switch(c){case "none":e.setUniform1f("uToPremultiplied",0);d.setBlendingEnabled(!1);break;case "alpha":e.setUniform1f("uToPremultiplied",1);d.setBlendingEnabled(!0);break;case "premultiplied-alpha":e.setUniform1f("uToPremultiplied",0),d.setBlendingEnabled(!0)}d.bindVAO(this.quadVAO);d.drawArrays(5,
0,h.vertexCount(this.quadVAO,"geometry"));d.setDepthTestEnabled(!0);d.setBlendingEnabled(!1)};q.loadShaders=function(b,c,d){b._parse(f);b=new e(d,b.vsOffscreenRenderer,b.fsOffscreenRenderer,a.Default3D);c.add("offscreenProgram",b)};return q}()})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../../../core/watchUtils ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){var m=p.earthRadius,u=c.vec3d,x=c.vec2d,v=c.mat4d,y=e.VertexAttrConstants,A=(m-1E4)/m,C=(m+3E5)/m,B=-1E4/3E5,D=1-B;return a.createSubclass({declaredClass:"esri.views.3d.environment.SimpleAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:n.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:x.create(),silCircleCenter:u.create(),silCircleV1:u.create(),silCircleV2:u.create()};this._textureRep=
this._texture=null},initialize:function(){this._textureDfd=new g;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._currentViewChangedHandle&&(this._currentViewChangedHandle.remove(),this._currentViewChangedHandle=null);this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),
this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new d({SimpleAtmosphere:new l(t,"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view.state.camera.viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var c=this._createRibbonGeometryData();this._renderer=new b(c,[{name:"position",count:3,
type:5126,offset:0,stride:12,normalized:!1}],null,a.rctx);this._currentViewChangedHandle=f.init(this,"view.state.camera",this._update.bind(this),!0);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(r);this._program=new k(a.rctx,a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,q.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==h.MATERIAL)return!1;var b=this.renderContext.rctx,c=b.gl,d=this._program;b.bindProgram(d);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);
d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",this._renderData.silCircleV1);d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);b.bindTexture(this._texture,0);d.setUniform1i("tex",0);d.setUniform3fv("lightDirection",a.lightingData.direction);b.setDepthTestEnabled(!0);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);
b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);this._renderer.render(d);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(c.LESS);return!0},_update:function(a){var b=u.create(),c=u.create(),d=u.create(),k=this.view.renderCoordsHelper.getAltitude(a.eye);u.scale(a.eye,(m+50)/u.length(a.eye),d);this._computeSilhouetteCircle(d,a.center,a.up,m);u.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,b);u.scale(b,C,c);var d=this._computeScreenRimWidth(d,
a.up,b,c),h=0,f=1,q=1;50>k?(h=.001953125,f=.1015625):500>k?(q=(k-50)/450,h=.001953125*(1-q)+.001953125*q,f=.1015625*(1-q)+.21875*q):5E3>k?(q=(k-500)/4500,h=.001953125*(1-q)+.001953125*q,f=.21875*(1-q)+.51171875*q):5E4>k&&(q=(k-5E3)/45E3,h=.001953125*(1-q)+.001953125*q,f=.51171875*(1-q)+.4140625*q);k=B+h*D;q=B+d*f*D;50<u.length(a.eye)-m&&(this._computeSilhouetteCircle(a.eye,a.center,a.up,m),u.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,b),u.scale(b,C,c),a=this._computeScreenRimWidth(a.eye,
a.up,b,c),a=e.clamp((a-1.5)/(d-1.5),0,1),k=B+a*h*D,q=B+e.lerp(1,d*f,a)*D);x.set2(k,q,this._renderData.texV);this.needsRender=!0},_computeSilhouetteCircle:function(a,b,c,d){var e=u.length(a),k=d*Math.sqrt(e*e-d*d)/e,h=this._renderData.silCircleV1,f=this._renderData.silCircleV2;u.scale(a,Math.sqrt(d*d-k*k)/e,this._renderData.silCircleCenter);u.cross(a,b,h);1>u.length2(h)&&u.cross(a,c,h);u.scale(h,k/u.length(h));u.cross(h,a,f);u.scale(f,k/u.length(f));return k},_computeScreenRimWidth:function(a,b,c,
d){var k=v.create();v.lookAt(a,c,b,k);a=this.view.state.camera;e.project(c,k,a.projectionMatrix,a.viewport);e.project(d,k,a.projectionMatrix,a.viewport);return u.dist(c,d)/a.height},_createRibbonGeometryData:function(){for(var a=new Float32Array(768),b=new Uint32Array(768),c=0;128>c;c++){var d=6*c;a[d+0]=c;a[d+1]=A;a[d+2]=0;a[d+3]=c;a[d+4]=C;a[d+5]=1;var e=2*c,k=127===c?0:e+2;b[d+0]=e;b[d+1]=e+1;b[d+2]=k+1;b[d+3]=k+1;b[d+4]=k;b[d+5]=e}c={};c[y.POSITION]=b;b={};b[y.POSITION]={size:3,data:a};return{indices:c,
vertexAttr:b}}})})},"esri/views/3d/environment/Stars":function(){define("dojo/text!./materials/StarMaterial.xml require ../../../request ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Error ../../../core/Logger ../lib/glMatrix ../support/ExternalRenderer ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){var x=e.mat4d;e=e.mat3d;var v=n.VertexAttrConstants,y="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),A=l.getLogger("esri.views.3d.environment.Stars"),C=e.toMat4(e.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),B=e.toMat4(e.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,
0,.39778850739794974,.9174771405229186)),D=null;return d.createSubclass({properties:{view:{},numBinaryFloats:{value:2},numBinaryUInt8:{value:1},bytesPerStar:{value:9},needsRender:{value:!1},slot:{value:k.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={model:x.identity()};this.slot=k.BACKGROUND;this._vertexBufferLayout=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:20,
normalized:!1},{name:"size",count:1,type:5126,offset:16,stride:20,normalized:!1}]},initialize:function(){this._loadDataPromise=this._loadBrightStarCatalogue();this.addResolvingPromise(this._loadDataPromise)},destroy:function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null)},setup:function(b){this._numStars=this._starData.byteLength/this.bytesPerStar;
var c=new Float32Array(this._starData,0,this._numStars*this.numBinaryFloats),d=new Uint8Array(this._starData,this._numStars*this.numBinaryFloats*4,this._numStars*this.numBinaryUInt8),c=this._createStarGeometryData(c,d);this._renderer=new h(c,this._vertexBufferLayout,this._fillInterleaved,b.rctx);this._renderer.enablePointRendering(!0);this._dateHandle=a.init(this,"view.environment.lighting.date",this._update.bind(this));b.shaderSnippets.vertexShaderStar||b.shaderSnippets._parse(r);this._program=new q(b.rctx,
b.shaderSnippets.vertexShaderStar,b.shaderSnippets.fragmentShaderStar,m.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==p.MATERIAL)return!1;var b=this.renderContext.rctx,c=b.gl,d=this._program;b.bindProgram(d);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniform4fv("viewport",a.camera.fullViewport);d.setUniformMatrix4fv("model",this._renderData.model);b.setDepthTestEnabled(!0);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);
b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);b.setDepthWriteEnabled(!1);this._renderer.render(d);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(c.LESS);return!0},_fillInterleaved:function(a,b,c,d,e,k,h){var f=u.getStride(e);c=f/4;var q=t.fill,m=a.indices[v.POSITION],l=a.vertexAttr[v.POSITION].data;d=h+u.findAttribute(e,"position").offset/4;for(var n=0;n<m.length;++n){var p=3*m[n];q(l,p,k,d,b,3);d+=c}b=a.indices[v.COLOR];m=a.vertexAttr[v.COLOR].data;
d=h+u.findAttribute(e,"color").offset;l=new Uint8Array(k.buffer);for(n=0;n<b.length;++n)p=4*b[n],q(m,p,l,d,null,4),d+=f;f=a.indices[v.SIZE];a=a.vertexAttr[v.SIZE].data;d=h+u.findAttribute(e,"size").offset/4;for(n=0;n<f.length;++n)k[d]=a[f[n]],d+=c},_computeDayDuration:function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(a-b)/(c-b)},_update:function(a){if(a){var b=a.getHours()/12,c=a.getMinutes()/60*(2/24),d=a.getSeconds()/60*(2/1440),b=(b+c+d-
.9972222)%2;a=2*this._computeDayDuration(a);c=x.create(B);x.rotateZ(c,-a*Math.PI);x.multiply(C,c,c);x.rotateZ(c,-b*Math.PI);this._renderData.model=c;this.needsRender=!0}},_hexToRGB:function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},_unpackUint8Attributes:function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]},_createStarGeometryData:function(a,b){for(var c=new Float32Array(3*
this._numStars),d=new Uint8Array(4*this._numStars),e=new Float32Array(this._numStars),k=new Uint32Array(this._numStars),h=0;h<this._numStars;h++){var f=2*h,q=3*h,m=4*h,l=a[f+0],f=a[f+1];c[q+0]=-Math.cos(l)*Math.sin(f);c[q+1]=-Math.sin(l)*Math.sin(f);c[q+2]=-Math.cos(f);q=this._unpackUint8Attributes(b[h]);l=this._hexToRGB(y[q[1]]);d[m+0]=255*l[0];d[m+1]=255*l[1];d[m+2]=255*l[2];d[m+3]=255;e[h]=q[0];k[h]=h}a={};a[v.POSITION]=k;a[v.NORMAL]=k;a[v.UV0]=k;a[v.COLOR]=k;a[v.SIZE]=k;k={};k[v.POSITION]={size:3,
data:c};k[v.COLOR]={size:4,data:d};k[v.SIZE]={size:1,data:e};return{indices:a,vertexAttr:k}},_verifyStartData:function(a){if(!a)throw new b("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new b("stars:invalid-data","Failed to create stars because star catalogue data is invalid");},_loadBrightStarCatalogue:function(){return D?(this._starData=D,c.resolve()):f(g.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",
failOk:!0}).then(function(a){a=a.data;this._verifyStartData(a);this._starData=D=a}.bind(this)).catch(function(a){a&&"cancel"!==a.dojoType&&A.error("loadBrightStarCatalogue",a.message);throw a;})}})})},"esri/views/3d/support/sunUtils":function(){define(["./mathUtils","../lib/glMatrix","../lib/SunCalc"],function(r,g,f){var a=g.vec3d,c=g.mat4d,b=r.lerp,l=c.identity(),e={azimuth:0,altitude:0},d={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},
global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:Math.PI/3,altitude:Math.PI/3}}},h={ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0,direction:a.create()}},n={settings:d,computeDirection:function(b,d,h,m){m||(m=a.create());var k=c.identity(l);if("global"===h)f.getPosition(b,0,0,e),a.set3(0,0,-1,m),c.rotateX(k,-e.azimuth),c.rotateY(k,-e.altitude);else{var q=n.settings.planarDirection;h=q.globalAngles;
q=(Math.abs(d.z)-q.localAltitude)/(q.globalAltitude-q.localAltitude);q=r.clamp(q,0,1);1>q?(f.getPosition(b,d.y,d.x,e),e.azimuth=(1-q)*e.azimuth+q*h.azimuth,e.altitude=(1-q)*e.altitude+q*h.altitude):(e.azimuth=h.azimuth,e.altitude=h.altitude);a.set3(0,-1,0,m);c.rotateZ(k,-e.azimuth);c.rotateX(k,-e.altitude)}c.multiplyVec3(k,m);return m},computeShadowsEnabled:function(a,b){return"global"===b?!0:Math.abs(a.z)<n.settings.planarDirection.localAltitude},computeColorAndIntensity:function(c,e){var k,m,l,
p=e.z;m=n.settings;a.set3(1,1,1,h.ambient.color);h.ambient.intensity=m.global.ambient;a.set3(1,1,1,h.diffuse.color);h.diffuse.intensity=m.global.diffuse;p=(Math.abs(p)-m.local.altitude)/(m.global.altitude-m.local.altitude);p=r.clamp(p,0,1);h.globalFactor=p;e=f.getTimes(c,e.y,e.x);if(1>p){m=c.valueOf();var g,y;e.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(g=m-36E5*(c.getHours()+48)-6E4*c.getMinutes(),y=g+432E6):e.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(g=m-2,y=m-1):(g=e.sunrise.valueOf(),
y=e.sunset.valueOf());var A=y-g;l=g+A/2;var C=A/4;k=l-C;var C=l+C,B=.06*A,A=g-B/2;g+=B/2;var D=y-B/2,E=y+B/2;y=d.local;var H=[.01,y.ambientAtNight],F=[.8,.8,1],L=[.01,.01,.01],G=[y.diffuseAtTwilight,y.ambientAtTwilight],P=[1,.75,.75],J=[.8,.8,1],M=[.9*y.diffuseAtNoon,y.ambientAtNoon],O=[1,.98,.98],aa=[.98,.98,1],V=[y.diffuseAtNoon,y.ambientAtNoon],N=[1,1,1],S=[1,1,1];y=[0,0];var W=[0,0],B=[0,0];m<A||m>E?(y=H,W=L,B=F):m<g?(B=g-A,y=t(m-A,B,H,G),W=t(m-A,B,L,P),B=t(m-A,B,F,J)):m<k?(B=k-g,y=t(m-g,B,G,
M),W=t(m-g,B,P,O),B=t(m-g,B,J,aa)):m<l?(B=l-k,y=t(m-k,B,M,V),W=t(m-k,B,O,N),B=t(m-k,B,aa,S)):m<C?(B=C-l,y=t(m-l,B,V,M),W=t(m-l,B,N,O),B=t(m-l,B,S,aa)):m<D?(B=D-C,y=t(m-C,B,M,G),W=t(m-C,B,O,P),B=t(m-C,B,aa,J)):m<E&&(B=E-D,y=t(m-D,B,G,H),W=t(m-D,B,P,L),B=t(m-D,B,J,F));m=y[0];l=W;k=y[1];a.lerp(B,h.ambient.color,p,h.ambient.color);h.ambient.intensity=b(k,h.ambient.intensity,p);a.lerp(l,h.diffuse.color,p,h.diffuse.color);h.diffuse.intensity=b(m,h.diffuse.intensity,p)}p=c.valueOf();e.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?
(c=p-36E5*(c.getHours()+48)-6E4*c.getMinutes(),e=c+432E6):e.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(c=p-2,e=p-1):(c=e.sunrise.valueOf(),e=e.sunset.valueOf());c=1-r.clamp(Math.abs(p-(c+(e-c)/2))/432E5,0,1);h.noonFactor=c;return h}},t=function(a,b,c,d){for(var e=[],k=0;k<c.length;k++)e[k]=(d[k]-c[k])*a/b+c[k];return e};return n})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function r(a){return new Date(864E5*(a+.5-2440588))}function g(a,b){return q(n(a)*t(v)-p(b)*n(v),t(a))}
function f(a,b){return k(n(b)*t(v)+t(b)*n(v)*n(a))}function a(a,b,c){return q(n(a),t(a)*n(b)-p(c)*t(b))}function c(a,b,c){return k(n(b)*n(c)+t(b)*t(c)*t(a))}function b(a){return u*(1.9148*n(a)+.02*n(2*a)+3E-4*n(3*a))}function l(a,c){a=u*(357.5291+.98560028*a);var d=b(a);a=a+d+102.9372*u+h;c||(c={dec:0,ra:0});c.dec=f(a,0);c.ra=g(a,0);return c}function e(a,b,c){return 2451545+a+.0053*n(b)-.0069*n(2*c)}function d(a){var b=u*(134.963+13.064993*a),c=u*(93.272+13.22935*a);a=u*(218.316+13.176396*a)+6.289*
u*n(b);c=5.128*u*n(c);b=385001-20905*t(b);return{ra:g(a,c),dec:f(a,c),dist:b}}var h=Math.PI,n=Math.sin,t=Math.cos,p=Math.tan,k=Math.asin,q=Math.atan2,m=Math.acos,u=h/180,x={dec:0,ra:0},v=23.4397*u,y={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(b,d,e,k){e=u*-e;d*=u;var h=b.valueOf()/864E5-.5+2440588-2451545;b=l(h,x);e=u*(280.16+360.9856235*h)-e-b.ra;k||(k={azimuth:0,altitude:0});k.azimuth=a(e,d,b.dec);k.altitude=c(e,d,b.dec);return k}},A=[[-.83,"sunrise","sunset"]];
y.addTime=function(a,b,c){A.push([a,b,c])};y.getTimes=function(a,c,d){function k(a){var b=l,c=x;a=m((n(a)-n(b)*n(c))/(t(b)*t(c)));return e(9E-4+(a+q)/(2*h)+p,g,v)}var q=u*-d,l=u*c,p=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-q/(2*h));a=9E-4+(0+q)/(2*h)+p;var g=u*(357.5291+.98560028*a);c=b(g);var v=g+c+102.9372*u+h,x=f(v,0);a=e(a,g,v);c={solarNoon:r(a),nadir:r(a-.5),polarException:y.POLAR_EXCEPTION.NORMAL};var C,B,D,V;d=0;for(C=A.length;d<C;d+=1)B=A[d],D=k(B[0]*u),V=a-(D-a),c[B[1]]=r(V),
c[B[2]]=r(D);c.polarException=function(a){a=(n(a)-n(l)*n(x))/(t(l)*t(x));return-1>a?y.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?y.POLAR_EXCEPTION.POLAR_NIGHT:y.POLAR_EXCEPTION.NORMAL}(A[0][0]*u);return c};y.getMoonPosition=function(b,e,k){k=u*-k;e*=u;var h=b.valueOf()/864E5-.5+2440588-2451545;b=d(h);k=u*(280.16+360.9856235*h)-k-b.ra;h=c(k,e,b.dec);h+=.017*u/p(h+10.26*u/(h+5.1*u));return{azimuth:a(k,e,b.dec),altitude:h,distance:b.dist}};y.getMoonFraction=function(a){var b=a.valueOf()/864E5-.5+2440588-2451545;
a=l(b);b=d(b);a=m(n(a.dec)*n(b.dec)+t(a.dec)*t(b.dec)*t(a.ra-b.ra));a=q(149598E3*n(a),b.dist-149598E3*t(a));return(1+t(a))/2};return y})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/glMatrix"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});var a=f.vec3d;r=function(){return function(c,b,f){void 0===c&&(c=a.create());void 0===b&&(b=a.createFrom(.57735,.57735,.57735));void 0===f&&(f=!0);this.intensity=c;this.direction=b;this.castShadows=
f}}();g.MainLight=r;r=function(){return function(c,b){void 0===c&&(c=a.create());void 0===b&&(b=a.createFrom(.57735,.57735,.57735));this.intensity=a.create();this.direction=a.create();this.intensity=c;this.direction=b}}();g.FillLight=r;r=function(){return function(c){void 0===c&&(c=a.create());this.intensity=c}}();g.AmbientLight=r;r=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();g.SphericalHarmonicsLight=r})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B){r=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a._handles=new b;return a}f(g,c);g.prototype.initialize=function(){var a=this;this.viewEvents=new C.ViewEvents(this.view);this._handles.add([l.whenNot(this.view,"ready",function(){return a._disconnect()}),l.when(this.view,"ready",function(){return a._connect()})])};g.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(g.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});g.prototype._disconnect=
function(){this.viewEvents.disconnect();this._source&&(this._source.destroy(),this._source=null);this._inputManager&&(this._inputManager.destroy(),this._inputManager=null)};g.prototype._connect=function(){var a=this.view;this._source=new y.BrowserEventSource(this.view.surface);var b=new A.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new B.PreventContextMenu]);this._modeDragPan=new q.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new h.DragRotate(a,
"secondary","center");this._modeDragZoom=new n.DragZoom(a,"tertiary");b.installHandlers("navigation",[new m.PointerDownCancelAnimation(a),new d.DoubleClickZoom(a),new t.GamepadNavigation(a),new p.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new k.MouseWheelZoom(a),new x.SingleKeyResetTilt(a,"p"),new u.SingleKeyResetHeading(a,"n"),new h.DragRotate(a,"primary","eye",["b"]),new h.DragRotate(a,"secondary","center",["b"]),new q.PinchAndPanNavigation(a,
"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new v.TwoFingerTilt(a)]);this.viewEvents.connect(b);this._updateMode()};g.prototype._updateMode=function(){var a=this.primaryDragAction,a=D.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};a([e.property()],g.prototype,"view",void 0);a([e.property({value:"pan"})],
g.prototype,"primaryDragAction",null);a([e.property({value:"default"})],g.prototype,"mode",null);a([e.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],g.prototype,"latestPointerType",void 0);a([e.property()],g.prototype,"_inputManager",void 0);return g=a([e.subclass("esri.views.3d.input.SceneInputManager")],g)}(e.declared(c));var D=new Map;g=new Map;c=new Map;g.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});g.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});
c.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});c.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});D.set("default",g);D.set("pro",c);return r})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(d){function h(a,c){var e=d.call(this,!0)||this;e.view=a;e.pickingHelper=new b.PickingHelper(a);e.registerIncoming("double-click",c,function(a){return e.handleDoubleClick(a)});return e}f(h,d);h.prototype.handleDoubleClick=function(b){var d=b.data;if(e.eventMatchesPointerAction(d,"primary")){var h=this.view.state.isGlobal?new a.ZoomStepController(this.view,this.pickingHelper,"animation"):new c.ZoomStepController(this.view,
this.pickingHelper,"animation");this.view.state.switchCameraController(h);h.zoomStep(Math.log(.5)/Math.log(.6),[d.x,this.view.height-d.y]);b.stopPropagation()}};return h}(l.InputHandler);g.DoubleClickZoom=r})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(r,g,f,a,c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function h(a,d,k){d=b.call(this,a.state,d,"interaction"===k?null:void 0)||this;d.view=a;d.mode=k;d.zoomLocation=c.vec3d.create();d.tmpCamera=new e;d.panAxis=c.vec3d.create();d.tmpViewDir=c.vec3d.create();d.targetOnSphere=c.vec3d.create();d.tmpCenter=c.vec3d.create();d.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new e,interactionDirection:null};d.sphere={center:c.vec3d.create(),
radius:0};return d}f(h,b);Object.defineProperty(h.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});h.prototype.zoomStep=function(a,b){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.pickingHelper.pickPointInScreen(b,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.pickingHelper.pickRaySegment(this.tmpCamera.eye,
this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:c.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};h.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:d.outExpo}};h.prototype.updateCamera=function(b,d,e,h){this.sphere.radius=
c.vec3d.length(e);c.vec3d.subtract(b.center,b.eye,this.tmpViewDir);var k=c.vec3d.length(this.tmpViewDir),f=k*d;1>=d&&4>f&&(f=4,d=f/k);1E-6>Math.abs(k-f)||(k=c.vec3d.length(b.center),this.sphere.radius!==k&&c.vec3d.scale(b.center,(this.sphere.radius+d*(k-this.sphere.radius))/k),c.vec3d.scale(this.tmpViewDir,-d),c.vec3d.add(b.center,this.tmpViewDir,b.eye),a.applyAll(this.view,b,this.constraintOptions),1E-12<c.vec3d.dist2(e,b.center)&&l.intersectSphereFromScreenPoint(this.sphere,b,h,this.targetOnSphere)&&
(d=l.rotationAndAxisFromPoints(e,this.targetOnSphere,this.panAxis),l.applyRotation(b,this.sphere.center,this.panAxis,d)),a.applySurfaceCollision(this.view,b))};return h}(b.PointToPointAnimationController);g.ZoomStepController=r})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../lib/glMatrix ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){Object.defineProperty(g,"__esModule",{value:!0});g.applyTilt=h.apply;g.tiltError=h.error;g.applyAltitude=n.apply;g.altitudeError=n.error;g.applyDistance=t.apply;g.distanceError=t.error;g.applySurfaceCollision=p.apply;g.applyAll=function(c,d,e,h){void 0===e&&(e=q);void 0===h&&(h=d);var f=!1;h!==d&&h.copyFrom(d);h.markViewDirty();h.computeUp(c.state.mode);for(d=0;d<m;d++){for(var l=0,n=0,p=k;n<p.length;n++){var u=p[n];if(a.hasConstraintType(e.selection,u.type)){var t=
Math.abs(u.error(c,h,e));u.apply(c,h,e)&&(f=!0,l+=t)}}if(0===l)break}d=a.hasConstraintType(e.selection,8);e=4===e.interactionType?1:0;d&&b.apply(c,h,e)&&(f=!0);f&&h.computeUp(c.state.mode);return f};g.pixelDistanceToInteractionFactor=function(a,b){a="number"===typeof a?a:e.vec2d.dist(a,b);return d.inOutCubic(Math.min(1,a/150))};var k=[{type:1,error:function(a,b,c){return l.error(a,b,c)*b.distance},apply:l.apply},{type:2,error:f.error,apply:f.apply},{type:4,error:c.error,apply:c.apply}],q={selection:15,
interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null},m=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ./common ../../lib/glMatrix ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(r,g,f,a,c,b){function l(a,c,e){void 0===e&&(e=f.defaultApplyOptions);var k;k=a.state.constraints.altitude;k=a.state.isGlobal&&k?2===e.interactionType&&f.hasConstraintType(e.selection,1)?!1:!0:!1;if(!k)return 0;var h=
a.state.constraints.altitude;k=d;k.min=h.min;k.max=h.max;var q=e.interactionType;if(0!==q){var h=k.min,n=k.max,p=e.interactionStartCamera;e=e.interactionFactor;var q=2===q||1===q,t=l(a,p),p=0===t?0:a.renderCoordsHelper.getAltitude(p.eye);k.min=h;k.max=n;f.adjustRangeForInteraction(t,p,q,e,.05*p,k)}a=a.renderCoordsHelper.getAltitude(c.eye);a=b.clamp(a,k.min,k.max)-a;return 1E-6>=Math.abs(a)?0:a}function e(b,c,d,e){b.renderCoordsHelper.worldUpAtPosition(c.eye,e);a.vec3d.scale(e,d);return e}Object.defineProperty(g,
"__esModule",{value:!0});g.apply=function(d,k,q,m){void 0===q&&(q=f.defaultApplyOptions);void 0===m&&(m=k);m!==k&&m.copyFrom(k);var p=l(d,k,q);if(0===p)return!1;var g=d.renderCoordsHelper,v=g.getAltitude(k.eye)+p;d=f.interactionDirectionTowardsConstraintMinimization(d,k,q.interactionDirection,e(d,k,b.sign(p),n),h);q=a.vec3d.set(k.viewForward,t);g.intersectManifold(k.eye,d,v,m.eye)||g.setAltitude(v,m.eye);c.closestPointOnRay(k.eye,q,k.center,k.center);m.markViewDirty();return!0};g.error=l;var d={min:0,
max:0},h=a.vec3d.create(),n=a.vec3d.create(),t=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.hasConstraintType=function(a,b){return 0!==(a&b)};g.adjustRangeForInteraction=function(a,b,f,e,d,h){0!==a&&(f?(h.min=Math.min(h.min,b),h.max=Math.max(h.max,b)):null!=e?(h.min-=Math.max(0,(b-h.min)*(1-e)),h.max+=Math.max(0,(b-h.max)*
(1-e))):d&&(h.min-=Math.max(0,b-h.min-d),h.max+=Math.max(0,b-h.max-d)))};g.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};g.interactionDirectionTowardsConstraintMinimization=function(c,b,l,e,d){l||(l=b.viewForward);f.vec3d.set(l,d);f.vec3d.scale(d,a.sign(f.vec3d.dot(l,e)));return d}})},"esri/views/3d/support/intersectionUtils":function(){define(["../lib/glMatrix"],function(r){function g(b,c,d,h){h.clip[0]=0;h.clip[1]=d?
h.len:Number.MAX_VALUE;for(d=0;d<b.length;d++){var e;var f=b[d],l=c;e=h;var k=a.dot(f,e.dir),l=-a.dot(l,f)-f[3];0>l&&0<=k?e=!1:-1E-6<k&&1E-6>k?e=0<l:!(0>l||0>k)||0>l&&0>k?(l/=k,0<k?l<e.clip[1]&&(e.clip[1]=l):l>e.clip[0]&&(e.clip[0]=l),e=e.clip[0]<=e.clip[1]):e=!0;if(!e)return!1}return!0}function f(b,e,d,h){b?(d&&h&&(c.len=a.dist(e,d)),a.set(b,c.dir)):h?(c.len=a.dist(e,d),a.scale(a.subtract(d,e,c.dir),1/c.len)):a.normalize(a.subtract(d,e,c.dir));return c}var a=r.vec3d;r=r.vec2d;var c={dir:a.create(),
len:0,clip:r.create()},b={planeSphere:function(a,b,c){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<c},frustumSphere:function(a,c,d){for(var e=0;6>e;e++)if(!b.planeSphere(a[e],c,d))return!1;return!0},frustumRay:function(a,b,c,h){c=f(h,b,c,!1);return g(a,b,null,c)},frustumPoint:function(b,c){for(var d=0;6>d;d++){var e=b[d];if(0>-a.dot(c,e)-e[3])return!1}return!0},frustumLineSegment:function(a,b,c,h){h=f(h,b,c,!0);return g(a,b,c,h)},closestPointOnRay:function(b,c,d,h){d=a.dot(c,a.subtract(d,b,h));a.add(b,
a.scale(c,d,h),h);return h}};return b})},"esri/views/3d/camera/constraintUtils/distance":function(){define(["require","exports","./common","../../lib/glMatrix","../../webgl-engine/lib/Util"],function(r,g,f,a,c){function b(c,d,e){void 0===e&&(e=f.defaultApplyOptions);if(!c.state.isLocal)return 0;var k=c.state.constraints.distance;if(!c.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===k)return 0;l.min=0;l.max=k;var k=l,h=e.interactionType;if(0!==h){var n=k.min,p=k.max,t=e.interactionStartCamera;
e=e.interactionFactor;var h=1===h||4===h,g=b(c,t),t=0===g?0:a.vec3d.dist(t.eye,c.pointsOfInterest.surfaceOrigin.renderLocation);k.min=n;k.max=p;f.adjustRangeForInteraction(g,t,h,e,.05*t,k)}c=a.vec3d.dist(d.eye,c.pointsOfInterest.surfaceOrigin.renderLocation);c=l.max-c;return-1E-6<=c?0:c}Object.defineProperty(g,"__esModule",{value:!0});g.error=b;g.apply=function(l,p,k,q){void 0===k&&(k=f.defaultApplyOptions);void 0===q&&(q=p);q!==p&&q.copyFrom(p);var m=b(l,p,k);if(0===m)return!1;var u=l.pointsOfInterest.surfaceOrigin,
m=a.vec3d.dist(p.eye,l.pointsOfInterest.surfaceOrigin.renderLocation)+m,t=a.vec3d.set(p.eye,e);k=f.interactionDirectionTowardsConstraintMinimization(l,p,k.interactionDirection,a.vec3d.direction(l.pointsOfInterest.surfaceOrigin.renderLocation,p.eye,n),h);return c.raySphere(p.eye,k,u.renderLocation,m,q.eye)?(p=a.vec3d.subtract(q.eye,t,d),a.vec3d.add(q.center,p),q.markViewDirty(),p=l.renderCoordsHelper.getAltitude(q.center),l.renderCoordsHelper.intersectManifold(q.eye,q.viewForward,p,q.center),q.markViewDirty(),
!0):!1};var l={min:0,max:0},e=a.vec3d.create(),d=a.vec3d.create(),h=a.vec3d.create(),n=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../intersectionUtils","../../lib/glMatrix"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.apply=function(b,l,e,d){void 0===e&&(e=0);void 0===d&&(d=l);var h=b.state.constraints;l!==d&&d.copyFrom(l);if(!h.collision.enabled)return!1;var n=f.surfaceElevationBelowEye(b,l);l=b.renderCoordsHelper.getAltitude(l.eye);
h=h.collision.elevationMargin;if(l-n>=h)return!1;a.vec3d.subtract(d.center,d.eye,c);b.renderCoordsHelper.setAltitude(n+h,d.eye);1===e&&a.vec3d.add(d.eye,c,d.center);d.markViewDirty();return!0};var c=a.vec3d.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../lib/glMatrix ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(r,g,f,a,c,b,l){function e(a,e,h,f){void 0===f&&(f=c.vec3d.create());
var k=d[a.viewingMode];k||(k=new l(a.viewingMode),k.enableBackfacesTerrain=!a.state.isGlobal,k.enableInvisibleTerrain=!0,d[a.viewingMode]=k);a._stage.pickRay(e,h,null,null,null,null,k);if((k=k.getMinResult())&&k.getIntersectionPoint(f))return f;k=c.vec3d.direction(h,e,p);if(!a.renderCoordsHelper.intersectManifold(e,k,0,f))if("global"===a.viewingMode){a=f;var k=c.vec3d.dot(e,e),q=b.earthRadius*b.earthRadius,k=k>q?Math.sqrt(k-q)/3:1;c.vec3d.subtract(h,e,a);c.vec3d.scale(a,k/c.vec3d.length(a),a);c.vec3d.add(a,
e)}else h!==f&&c.vec3d.set(h,f);return f}Object.defineProperty(g,"__esModule",{value:!0});g.eyeWithinExtent=function(b,c,d,e){return b.renderCoordsHelper.fromRenderCoords(c.eye,h,e)&&a.containsPoint(d,h)};g.surfaceElevationBelowEye=function(a,b){return a.renderCoordsHelper.fromRenderCoords(b.eye,t,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(t)||0:0};g.cameraOnContentAlongViewDirection=function(a,b,d,h){var k=a.state.camera.copy();b&&(k.eye=b);d&&(k.center=d);h&&(k.up=h);e(a,k.eye,
k.center,n);d=a.state.constraints;h=d.minimumPoiDistance;c.vec3d.dist2(k.eye,n)<h&&(b=d.collision.enabled,c.vec3d.set(k.viewForward,p),c.vec3d.scale(p,h),b?c.vec3d.subtract(n,p,k.eye):c.vec3d.add(k.eye,p,n),a=a.renderCoordsHelper,h=a.getAltitude(k.eye),d=d.collision.elevationMargin,b&&h<d&&(c.vec3d.subtract(n,k.eye,p),a.setAltitude(d,k.eye),c.vec3d.add(k.eye,p,n)));k.center=n;return k};g.contentAlongViewDirection=e;var d={},h=c.vec3d.create(),n=c.vec3d.create(),t=new f,p=c.vec3d.create()})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports dojo/has ./gl-matrix ./Object3D ./PerformanceTimer".split(" "),
function(r,g,f,a,c,b){var l=a.vec3d.create(),e=a.vec3d.create();r=function(){function b(b,c,e,f,m,l,n,g){void 0===g&&(g=!1);this.dir=a.vec3d.create();this.normalDir=null;this.minResult=new d;this.maxResult=new d;this.transform=a.mat4d.create();this._transformInverse=new h({value:this.transform},a.mat4d.inverse,a.mat4d.create);this._transformInverseTranspose=new h(this._transformInverse,a.mat4d.transpose,a.mat4d.create);this._transformTranspose=new h({value:this.transform},a.mat4d.transpose,a.mat4d.create);
this._transformInverseRotation=new h({value:this.transform},a.mat4d.toInverseMat3,a.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=b||"global";this.intersectObject=this.intersectObject.bind(this);this.init(c,e,f,m,l,n,g)}b.prototype.init=function(b,c,d,e,h,f,l){c&&d&&a.vec3d.subtract(d,c,this.dir);this.minResult.init(c,d);this.maxResult.init(c,d);this.numObjectsTested=
0;this.point=e;this.camera=h;this.isSelection=l;this.layers=b;this.p0=c;this.p1=d;this.hudResults=[];null==f&&(f=1E-5);this.tolerance=f;if(this.layers)for(b=0;b<this.layers.length;++b)if(c=this.layers[b],d=c.getSpatialQueryAccelerator?c.getSpatialQueryAccelerator():void 0)d.forEachAlongRay(this.p0,this.dir,this.intersectObject);else for(c=c.getObjects(),d=0;d<c.length;++d)this.intersectObject(c[d])};Object.defineProperty(b.prototype,"transformInverse",{get:function(){return this._transformInverse.value},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});b.prototype.getDirection=
function(){this.normalDir||(this.normalDir=a.vec3d.create(),a.vec3d.normalize(this.dir,this.normalDir));return this.normalDir};b.prototype.intersectObject=function(b){var c=this;this.numObjectsTested++;for(var k=b.id,h=b.getGeometryRecords(),f=b.objectTransformation,n,t=0;t<h.length;t++){var g=h[t],y=g.geometry,A=g.materials,C=g.instanceParameters;C.hidden||(n=y.id,a.mat4d.set(f,this.transform),a.mat4d.multiply(this.transform,g.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),
this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),a.mat4d.multiplyVec3(this.transformInverse,this.p0,l),a.mat4d.multiplyVec3(this.transformInverse,this.p1,e),A[0].intersect(y,C,this.transform,this,l,e,function(a,e,h,f,q,m){0<=a&&(q?(q=new d,q.init(c.p0,c.p1),q.set(b,k,a,e,f,m,n,h),c.hudResults.push(q)):((null==c.minResult.priority||f>=c.minResult.priority)&&(null==c.minResult.dist||a<c.minResult.dist)&&c.minResult.set(b,k,a,e,f,null,n,h),(null==c.maxResult.priority||
f>=c.maxResult.priority)&&(null==c.maxResult.dist||a>c.maxResult.dist)&&c.maxResult.set(b,k,a,e,f,null,n,h)))},g.customTransformation))}};b.prototype.getMinResult=function(){return this.minResult};b.prototype.getMaxResult=function(){return this.maxResult};b.prototype.getHudResults=function(){return this.hudResults};b.DEFAULT_TOLERANCE=1E-5;return b}();var d=function(){function b(b,c){this.normal=a.vec3d.create();this.init(b,c)}b.prototype.getIntersectionPoint=function(b){if(null==this.dist)return!1;
a.vec3d.lerp(this.p0,this.p1,this.dist,b);return!0};b.prototype.set=function(b,d,e,h,f,l,n,g){this.dist=e;a.vec3d.set(h,this.normal);this.targetType=b?b instanceof c?"StageObject":"StagePoint":"None";this.target=b;this.name=d;this.priority=f;this.center=l?a.vec3d.create(l):null;this.geometryId=n;this.triangleNr=g};b.prototype.copyFrom=function(b){this.p0=b.p0;this.p1=b.p1;this.dist=b.dist;this.targetType=b.targetType;this.target=b.target;this.name=b.name;this.priority=b.priority;this.center=b.center?
a.vec3d.create(b.center):null;this.geometryId=b.geometryId;this.triangleNr=b.triangleNr;this.intersector=b.intersector;a.vec3d.set(b.normal,this.normal)};b.prototype.setIntersector=function(a){this.intersector=a};b.prototype.init=function(a,b){this.dist=void 0;this.targetType="None";this.priority=this.name=this.target=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="stage";this.p0=a;this.p1=b};return b}(),h=function(){function a(a,b,c){this.original=a;this.update=b;this.dirty=
!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}();return r})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ./ComponentUtils ./GeometryRecord ./gl-matrix ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),function(r,g,f,a,c,b,l,e,d){var h=
d.assert,n=c.mat4d,t=c.vec3d,p=n.identity();r=function(){function c(a){void 0===a&&(a={});this._bvObjectSpace=new k;this._bvWorldSpace=new k;this._bvDirty=!0;this._hasVolatileTransformation=!1;this.id=c._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=n.identity();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations)}c.prototype._initializeGeometryRecords=function(b,c,d){if(Array.isArray(b)){h(c.length===
b.length,"Object3D: materials don't match geometries");h(d.length===b.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(b.length);this.geometries=b.slice();for(var e=0;e<b.length;e++)h(Array.isArray(c[e]),"Object3D: materials parameter must be array of array"),this.geometryRecords[e]=new a(b[e],c[e].slice(),n.create(d[e]),{});this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(c.prototype,"parentLayer",{get:function(){return this._parentLayer},
set:function(a){h(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});c.prototype.getParentLayer=function(){return this.parentLayer};c.prototype.addParentLayer=function(a){this.parentLayer=a};c.prototype.removeParentLayer=function(a){this.parentLayer=null};c.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};c.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);h(-1<a,
"Object3D.getFirstGeometryIndex: geometry not found");return a};c.prototype.findGeometryRecords=function(a){for(var b=[],c=0;c<this.geometries.length;c++)this.geometries[c]===a&&b.push(this.geometryRecords[c]);return b};c.prototype.getGeometryRecord=function(a){h(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};c.prototype.getGeometryRecords=function(){return this.geometryRecords};c.prototype.addGeometry=function(b,c,d,e,k,
f){void 0===d&&(d=p);h(Array.isArray(c),"Object3D.addGeometry: materials must be array");this.geometries.push(b);b=new a(b,c.slice(),n.create(d),e||{},k,f);this.geometryRecords.push(b);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",b);this._invalidateBoundingVolume();return b};c.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};c.prototype.removeGeometry=function(a){var b=this.geometryRecords.splice(a,
1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();return b};c.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};c.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};c.prototype.areAllComponentsHidden=
function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=c.instanceParameters.componentVisibilities,c=c.geometry.getData().componentOffsets;if(!f.isAllHidden(d,c))return!1}return!0};c.prototype.areAllComponentsVisible=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=c.instanceParameters.componentVisibilities,c=c.geometry.getData().componentOffsets;if(!f.isAllVisible(d,c))return!1}return!0};c.prototype.hasComponents=function(){for(var a=!1,b=0;b<this.geometries.length&&
!(a=this.geometries[b].getData(),a=f.hasComponents(a.componentOffsets));b++);return a};c.prototype.setComponentVisibility=function(a,b,c){var d=a.instanceParameters.componentVisibilities,e=a.geometry.getData().componentOffsets;b=f.updateVisibility(d,e,b,c);a.instanceParameters.componentVisibilities=b;this._notifyDirty("visibilityChanged",a)};c.prototype.setHidden=function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};c.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};
c.prototype.getComponentVisibility=function(a,b){return f.getVisibility(a.instanceParameters.componentVisibilities,b)};c.prototype.hideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=f.hideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged")};c.prototype.unhideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=f.unhideAllComponents(c.instanceParameters.componentVisibilities);
c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged")};c.prototype._setComponentHighlight=function(a,b,c,d){b=f.addHighlight(a.instanceParameters.componentHighlights,b,c,d);a.instanceParameters.componentHighlights=b};c.prototype.setComponentHighlight=function(a,c,d){var e=b.generateHighlightId();this._setComponentHighlight(a,c,d,e);this._notifyDirty("componentHighlightChanged");return e};c.prototype.highlightAllComponents=function(a){for(var c=b.generateHighlightId(),
d=0,e=this.geometryRecords;d<e.length;d++)this._setComponentHighlight(e[d],null,a,c);this._notifyDirty("componentHighlightChanged");return c};c.prototype.removeHighlights=function(a){for(var b=0,c=this.geometryRecords;b<c.length;b++){var d=c[b].instanceParameters,e=f.removeHighlight(d.componentHighlights,a);d.componentHighlights=e}this._notifyDirty("componentHighlightChanged")};c.prototype.getComponentFromTriangleNr=function(a,b){h(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");
a=this.geometryRecords[a].geometry.getData().componentOffsets;return f.componentFind(a,3*b)};c.prototype.setGeometryTransformation=function(b,c){h(0<=b&&b<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[b];c=new a(d.geometry,d.materials,n.create(c),d.instanceParameters);this.geometryRecords[b]=c;this._notifyDirty("objGeometryReplaced",[d,c]);this._invalidateBoundingVolume()};c.prototype.getObjectTransformation=function(){return n.create(this.objectTransformation)};
c.prototype.setObjectTransformation=function(a){n.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};c.prototype.getCombinedStaticTransformation=function(a,b){b=b||n.create();n.multiply(this.objectTransformation,a.getStaticTransformation(),b);return b};c.prototype.getCombinedShaderTransformation=function(a,b){b=b||n.create();n.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};c.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};
c.prototype.getCastShadow=function(){return this.castShadow};c.prototype.setCastShadow=function(a){this.castShadow=a};c.prototype.getMetadata=function(){return this.metadata};c.prototype.getName=function(){return this.name};c.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};c.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};c.prototype.getCenter=function(a){this._validateBoundingVolume();
return a?this._bvObjectSpace.center:this._bvWorldSpace.center};c.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};c.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],c=this.geometryRecords[a],b=b.getBoundingInfo();this._calculateTransformedBoundingVolume(b,
this._bvObjectSpace,c.getShaderTransformation());this._calculateTransformedBoundingVolume(b,this._bvWorldSpace,this.getCombinedShaderTransformation(c))}t.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);t.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var c=t.create(),d=t.create(),e=this._getScaleFactor(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],k=this.geometryRecords[a].getShaderTransformation(),
h=this._getScaleFactor(k),b=b.getBoundingInfo();n.multiplyVec3(k,b.getCenter(),c);k=t.dist(c,this._bvObjectSpace.center);b=b.getBSRadius()*h;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,k+b);n.multiplyVec3(this.objectTransformation,c,d);h=t.dist(d,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+b*e)}this._bvDirty=!1}};c.prototype._calculateTransformedBoundingVolume=function(a,b,c){var d=a.getBBMin();a=a.getBBMax();var e=t.create(d),
k=t.create(a);n.multiplyVec3(c,e);n.multiplyVec3(c,k);for(var h=0;3>h;++h)b.bbMin[h]=Math.min(b.bbMin[h],e[h],k[h]),b.bbMax[h]=Math.max(b.bbMax[h],e[h],k[h]);for(h=0;3>h;++h){t.set(d,e);t.set(a,k);e[h]=a[h];k[h]=d[h];n.multiplyVec3(c,e);n.multiplyVec3(c,k);for(var f=0;3>f;++f)b.bbMin[f]=Math.min(b.bbMin[f],e[f],k[f]),b.bbMax[f]=Math.max(b.bbMax[f],e[f],k[f])}};c.prototype._getScaleFactor=function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*
a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))};c.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace)};c.prototype._notifyDirty=function(a,b,c,d){this._parentLayer&&(c=c||e.OBJECT,this._parentLayer.notifyDirty(a,b,c,d||this))};c._idGen=new l;return c}();var k=function(){function a(){this.bbMin=t.create();this.bbMax=t.create();this.center=t.create();this.bsRadius=0}a.prototype.init=function(){t.set3(Number.MAX_VALUE,
Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);t.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax);t.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return r})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(r,g,f){return function(){function a(c,b,f,e,d,h){this.id=a._idGen.gen(c.id);this.geometry=c;this.materials=
b;this.transformation=f;this.instanceParameters=e;this.origin=d;this.customTransformation=h}a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation};a._idGen=new f;return a}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});
var a=new f;g.generateHighlightId=function(){return a.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(r,g){return function(){function f(){}f.LAYER="layers";f.OBJECT="objects";f.GEOMETRY="geometries";f.MATERIAL="materials";f.TEXTURE="textures";return f}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Performance"],function(r,g,f){return function(){function a(a){this._filterSampleIndex=
0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=function(){this._tsStart=f.now()};a.prototype.stop=function(){this._lastTime=f.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=
(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=function(){for(var a=0,b=0;b<this._filterSamples.length;b++)a+=this._filterSamples[b];return a/this._filterSamples.length};a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};return a}()})},"esri/views/3d/webgl-engine/lib/Performance":function(){define(["require",
"exports","../../../../core/now"],function(r,g,f){return{now:f}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ./common ../../lib/glMatrix ../../state/utils/viewUtils ../../support/earthUtils ../../support/mathUtils".split(" "),function(r,g,f,a,c,b,l){function e(a,b,h,n){void 0===h&&(h=f.defaultApplyOptions);void 0===n&&(n=f.defaultApplyOptions);if(3===h.interactionType||!a.state.constraints.tilt)return 0;var k=c.viewAngle(a.renderCoordsHelper,b.center,b.eye);b=
a.state.constraints.tilt(b.distance,p);if(0!==h.interactionType){var q=h.interactionStartCamera,m=h.interactionFactor,u=b.min,g=b.max,B=e(a,q,f.defaultApplyOptions,h),D=0===B?0:c.viewAngle(a.renderCoordsHelper,q.center,q.eye);b.min=u;b.max=g;2===h.interactionType?(f.hasConstraintType(h.selection,2)&&d(a,q,b),f.adjustRangeForInteraction(B,D,!0,m,t,b)):f.adjustRangeForInteraction(B,D,!1,m,t,b)}2===n.interactionType&&f.hasConstraintType(n.selection,2)&&d(a,n.interactionStartCamera,b);a=l.clamp(k,b.min,
b.max);k-=a;return 1E-6>=Math.abs(k)?0:k}function d(c,d,e){if(!c.state.isLocal){var k=c.state.constraints;if(k.altitude){c=a.vec3d.length2(d.center);var h=Math.sqrt(c);d=d.distance;var f=k.altitude.min+b.earthRadius,k=k.altitude.max+b.earthRadius,f=(f*f-d*d-c)/(-2*h*d);e.min=Math.max(e.min,Math.min(Math.PI-l.acos((k*k-d*d-c)/(-2*h*d)),e.max));e.max=Math.min(e.max,Math.PI-l.acos(f))}}}Object.defineProperty(g,"__esModule",{value:!0});g.apply=function(b,c,d,l){void 0===d&&(d=f.defaultApplyOptions);void 0===
l&&(l=c);c!==l&&l.copyFrom(c);b=e(b,c,d);if(0===b)return!1;a.mat4d.identity(n);a.mat4d.rotate(n,-b,c.viewRight);a.vec3d.subtract(c.center,c.eye,h);a.mat4d.multiplyVec3(n,h);a.vec3d.subtract(c.center,h,l.eye);a.mat4d.multiplyVec3(n,l.up);l.markViewDirty();return!0};g.error=e;var h=a.vec3d.create(),n=a.mat4d.create(),t=l.deg2rad(5),p={min:0,max:0}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(r,g,f,a){Object.defineProperty(g,
"__esModule",{value:!0});g.viewAngle=function(l,e,d){l.worldUpAtPosition(e,c);f.vec3d.subtract(d,e,b);l=f.vec3d.length(b);return 0===l?0:a.acos(f.vec3d.dot(b,c)/l)};var c=f.vec3d.create(),b=f.vec3d.create()})},"esri/views/animation/easing":function(){define(["require","exports"],function(r,g){function f(a){return a}function a(a){var b=2*(a-Math.sqrt((a-1)*a)),c=b/2/a;return function(d){return d<c?a*d*d:b*d-b+1}}function c(a,c){return function(b){return b<c?c*a(b/c):1-a((1-b)/(1-c))*(1-c)}}Object.defineProperty(g,
"__esModule",{value:!0});g.linear=f;g.inQuad=function(a){return a*a};g.outQuad=function(a){return 1-g.inQuad(1-a)};g.inOutQuad=function(a){return.5>a?g.inQuad(2*a)/2:(g.outQuad(2*(a-.5))+1)/2};g.inCubic=function(a){return a*a*a};g.outCubic=function(a){return 1-g.inCubic(1-a)};g.inOutCubic=function(a){return.5>a?g.inCubic(2*a)/2:(g.outCubic(2*(a-.5))+1)/2};g.inQuart=function(a){return a*a*a*a};g.outQuart=function(a){return 1-g.inQuart(1-a)};g.inOutQuart=function(a){return.5>a?g.inQuart(2*a)/2:(g.outQuart(2*
(a-.5))+1)/2};g.inQuint=function(a){return a*a*a*a*a};g.outQuint=function(a){return 1-g.inQuint(1-a)};g.inOutQuint=function(a){return.5>a?g.inQuint(2*a)/2:(g.outQuint(2*(a-.5))+1)/2};g.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};g.outSine=function(a){return 1-g.inSine(1-a)};g.inOutSine=function(a){return.5>a?g.inSine(2*a)/2:(g.outSine(2*(a-.5))+1)/2};g.inExpo=function(a){return Math.pow(2,10*(a-1))};g.outExpo=function(a){return 1-g.inExpo(1-a)};g.inOutExpo=function(a){return.5>a?g.inExpo(2*
a)/2:(g.outExpo(2*(a-.5))+1)/2};g.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};g.outCirc=function(a){return 1-g.inCirc(1-a)};g.inOutCirc=function(a){return.5>a?g.inCirc(2*a)/2:(g.outCirc(2*(a-.5))+1)/2};g.inCoastQuad=c(a(1),1);g.outCoastQuad=c(a(1),0);g.inOutCoastQuad=c(a(1),.5);g.inCoastCubic=c(a(2),1);g.outCoastCubic=c(a(2),0);g.inOutCoastCubic=c(a(2),.5);g.inCoastQuart=c(a(3),1);g.outCoastQuart=c(a(3),0);g.inOutCoastQuart=c(a(3),.5);g.inCoastQuint=c(a(4),1);g.outCoastQuint=c(a(4),0);g.inOutCoastQuint=
c(a(4),.5);g.named={linear:f,"in-quad":g.inQuad,"out-quad":g.outQuad,"in-out-quad":g.inOutQuad,"in-cubic":g.inCubic,"out-cubic":g.outCubic,"in-out-cubic":g.inOutCubic,"in-quart":g.inQuart,"out-quart":g.outQuart,"in-out-quart":g.inOutQuart,"in-quint":g.inQuint,"out-quint":g.outQuint,"in-out-quint":g.inOutQuint,"in-sine":g.inSine,"out-sine":g.outSine,"in-out-sine":g.inOutSine,"in-expo":g.inExpo,"out-expo":g.outExpo,"in-out-expo":g.inOutExpo,"in-circ":g.inCirc,"out-circ":g.outCirc,"in-out-circ":g.inOutCirc}})},
"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../animation/pointToPoint/Animation ../../lib/glMatrix ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function c(c,d,e){e=b.call(this,e)||this;e.viewState=c;e.pickingHelper=d;e.hasTarget=!1;e.animation=new a.default(e.viewState.mode);return e}f(c,b);c.prototype.begin=
function(a,b){this.hasTarget=!0;b=this.animationSettings(b);e.copyFrom(this.viewState.camera);this.pickingHelper.pickRaySegment(e.eye,e.center,d)&&(e.center=d);this.animation.update(e,a,b);this.animation.finished&&this.finish()};c.prototype.finish=function(){this.animation.currentTime=this.animation.time;b.prototype.finish.call(this)};Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});c.prototype.stepController=
function(a,c){b.prototype.stepController.call(this,a,c);this.hasTarget&&this.animation.step(a,c)};c.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);b.prototype.onControllerEnd.call(this,a)};c.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},
speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return c}(b.AnimationController);g.PointToPointAnimationController=r;var e=new l,d=c.vec3d.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Camera ../../lib/glMatrix ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});
var e=c.vec3d,d=e.create();r=function(){function c(b){this.currentTime=0;this.animation=new l.Animation(function(){return new a.default(b)});this._current=new a.default(b)}Object.defineProperty(c.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});c.prototype.update=function(a,b,c){var k=this.animation.definition.source,
h=this.animation.definition.target,f=e.subtract(b.center,a.center,d),l=e.length(f);1E-5<=l?(f[0]/=l,f[1]/=l,f[2]/=l):(f[0]=0,f[1]=1,f[0]=0);e.set(f,k.lookAtDirection);e.set(f,h.lookAtDirection);k.copyFromRenderCamera(a);h.copyFromRenderCamera(b);this._current.copyFrom(k);this.animation.update(k,h,c);this.currentTime=0;a.almostEquals(b,5E-4,!0)&&(this.currentTime=this.animation.time)};c.prototype.cameraAt=function(a,c){a=this.animation.cameraAt(a,this._current);c||(c=new b);a.copyToRenderCamera(c);
return c};c.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return c}();g.Animation=r;g.default=r})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});var c=a.angle,b=a.lerp,l=a.slerp,e=f.vec3d,d=f.mat3d,h=e.create(),n=e.create(),
t=e.create(),p=e.create(),k=e.create(),q=e.create(),m=e.createFrom(0,0,1),u=e.createFrom(0,1,0),x=e.createFrom(1,0,0),v=d.create();r=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=e.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=e.create(u)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.pixelsPerRotateAtZoom=
function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=e.length(this.center),k=e.length(a.center),d=(d+k)/2;b.pan=c(this.center,a.center)*d}else b.pan=e.dist(this.center,a.center);d=Math.abs(a.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);b.rotate=Math.max(d,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};a.prototype.interpolate=
function(a,c,d){"global"===this.viewingMode?l(a.center,c.center,d.pan,this.center):e.lerp(a.center,c.center,d.pan,this.center);this.distance=b(a.distance,c.distance,d.zoom);this.pitch=b(a.pitch,c.pitch,d.rotate);a=a.yaw;c=c.yaw;Math.abs(c-a)>=Math.PI&&(a+=2*(a<c?1:-1)*Math.PI);this.yaw=b(a,c,d.rotate)};a.prototype.copyFrom=function(a){e.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;e.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);
this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,v);e.set(a.center,this.center);d.multiplyVec3(b,e.subtract(a.center,a.eye,p));d.multiplyVec3(b,a.up,k);this.distance=e.length(p);p[0]/=this.distance;p[1]/=this.distance;p[2]/=this.distance;this.pitch=this._eyeUpToPitch(p,k);this.yaw=this._eyeUpToYaw(p,k);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=function(a){this.fov=a.fov;
this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,v);d.transpose(b);this._axisAngleVec3(x,this.pitch-Math.PI/2,u,p);this._axisAngleVec3(m,this.yaw,p);this._axisAngleVec3(x,this.pitch-Math.PI/2,m,k);this._axisAngleVec3(m,this.yaw,k);e.scale(p,this.distance);d.multiplyVec3(b,p);d.multiplyVec3(b,k);a.center=this.center;a.eye=e.subtract(this.center,p,p);a.up=k};a.prototype._axisAngleVec3=function(a,b,c,d){void 0===d&&(d=c);
var k=Math.cos(b);b=Math.sin(b);e.scale(c,k,h);e.scale(e.cross(a,c,n),b);e.scale(a,(1-k)*e.dot(a,c),t);return e.add(e.add(h,n,d),t,d)};a.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,t);e.normalize(e.cross(this.lookAtDirection,t,h));0===h[0]&&0===h[1]&&0===h[2]&&e.set(x,h);e.normalize(e.cross(t,h,n));b||(b=d.create());b[0]=h[0];b[1]=n[0];b[2]=t[0];b[3]=h[1];b[4]=n[1];b[5]=t[1];b[6]=h[2];b[7]=n[2];b[8]=t[2];return b};a.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?
e.set(m,b):e.normalize(a,b)};a.prototype._eyeUpToPitch=function(a,b){return Math.PI-c(m,a)};a.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(e.set(b,q),0<a[2]&&e.scale(q,-1)):e.set(a,q);return c(x,e.normalize(e.cross(q,m,n)),m)};return a}();g.default=r})},"esri/views/3d/webgl-engine/lib/Camera":function(){define(["require","exports","../../support/geometryUtils","./gl-matrix","./Util"],function(r,g,f,a,c){function b(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+e*
e+a*a}function l(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function e(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}r=function(){function p(b,c,d){this._viewUp=a.vec3d.create();this._viewForward=a.vec3d.create();this._viewRight=a.vec3d.create();this._viewport=a.vec4d.create();this._padding=a.vec4d.create();this._fov=55/180*Math.PI;this._near=0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=a.mat4d.create();this._projectionDirty=!0;this._projectionMatrix=a.mat4d.create();
this._viewProjectionDirty=!0;this._viewProjectionMatrix=a.mat4d.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=a.mat4d.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[f.plane.create(),f.plane.create(),f.plane.create(),f.plane.create(),f.plane.create(),f.plane.create()];this._fullViewport=null;this.aboveGround=!0;this._eye=a.vec3d.create(b);this._center=a.vec3d.create(c);this._up=void 0!==d?a.vec3d.create(d):a.vec3d.create([0,0,1]);this._padding=a.vec4d.create()}
Object.defineProperty(p.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,
"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(b){a.mat4d.set(b,this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},
enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==
a&&(this._far=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumPlanesDirty=
this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumPlanesDirty=
this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+
this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=a.vec4d.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];
this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"padding",{get:function(){return this._padding},set:function(b){if(this._padding[0]!==b[0]||this._padding[1]!==b[1]||this._padding[2]!==b[2]||this._padding[3]!==b[3])this._viewport[0]+=b[3]-this._padding[3],this._viewport[1]+=
b[2]-this._padding[2],this._viewport[2]-=b[1]+b[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=b[0]+b[2]-(this._padding[0]+this._padding[2]),a.vec4d.set(b,this._padding),this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(a.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1);
return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var b=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),e=d*this.aspect;a.mat4d.frustum(-e*(1+2*this._padding[3]/b),e*(1+2*this._padding[1]/b),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(b){a.mat4d.set(b,this._projectionMatrix);
this._projectionDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fovX",{get:function(){return c.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=c.fovx2fovd(a,this.width,this.height);this._frustumPlanesDirty=
this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fovY",{get:function(){return c.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=c.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"distance",{get:function(){return a.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0});
Object.defineProperty(p.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"frustumPlanes",{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||
this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=a.mat4d.create()),a.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),a.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});p.prototype.copyFrom=function(b){a.vec3d.set(b._eye,
this._eye);a.vec3d.set(b._center,this._center);a.vec3d.set(b._up,this._up);a.vec4d.set(b._viewport,this._viewport);a.vec4d.set(b._padding,this._padding);this._near=b._near;this._far=b._far;this._fov=b._fov;this.aboveGround=b.aboveGround;b._viewDirty?this._viewDirty=!0:(a.mat4d.set(b._viewMatrix,this._viewMatrix),a.vec3d.set(b._viewRight,this._viewRight),a.vec3d.set(b._viewUp,this._viewUp),a.vec3d.set(b._viewForward,this._viewForward),this._viewDirty=!1);b._projectionDirty?this._projectionDirty=!0:
(a.mat4d.set(b._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;b._frustumPlanesDirty?this._frustumPlanesDirty=!0:(b.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);b._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?a.mat4d.set(b._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=a.mat4d.create(b._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1);b._fullViewport?this._fullViewport?a.vec4d.set(b._fullViewport,this._fullViewport):this._fullViewport=a.vec4d.create(b._fullViewport):this._fullViewport=null;return this};p.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};p.prototype.copy=function(){var a=new p;a.copyFrom(this);return a};p.prototype.equivalent=function(a){return l(this._eye,a._eye)&&l(this._center,a._center)&&l(this._up,a._up)&&e(this._viewport,a._viewport)&&e(this._padding,a._padding)&&this._near===
a._near&&this._far===a._far&&this._fov===a._fov};p.prototype.almostEquals=function(c,d,e){void 0===e&&(e=!1);d=a.vec3d.dist(this._eye,this._center)*(d||5E-4);d*=d;e?(a.vec3d.direction(c._center,c._eye,n),a.vec3d.direction(this._center,this._eye,t),e=1E-10):(a.vec3d.set(c._center,n),a.vec3d.set(this._center,t),e=d);return a.vec3d.dist2(c._eye,this._eye)<d&&a.vec3d.dist2(n,t)<e&&.001>Math.abs(c._fov-this._fov)&&.5>b(c._padding,this._padding)&&.5>b(c._viewport,this._viewport)};p.prototype.markViewDirty=
function(){this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0};p.prototype.computePixelSizeAt=function(b){return this.computePixelSizeAtDist(a.vec3d.dist(b,this._eye))};p.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};p.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};p.prototype.copyFrustumPlanes=function(b){if(!b){b=Array(6);for(var c=0;6>c;++c)b[c]=a.vec4d.create()}for(var d=
this.frustumPlanes,c=0;6>c;c++)a.vec4d.set(d[c],b[c]);return b};p.prototype.computeFrustumPoints=function(b){if(!b){b=Array(8);for(var d=0;8>d;++d)b[d]=a.vec3d.create()}c.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,b);return b};p.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],b[2]+c[1]+c[3],b[3]+c[0]+c[2])};p.prototype.applyProjection=function(b,e,h){void 0===h&&(h=!1);b!==d&&a.vec3d.set(b,d);d[3]=1;h&&(e[2]=-d[2]);a.mat4d.multiplyVec4(this.projectionMatrix,
d);a.vec3d.scale(d,1/Math.abs(d[3]));b=this.fullViewport;e[0]=c.lerp(0,b[0]+b[2],.5+.5*d[0]);e[1]=c.lerp(0,b[1]+b[3],.5+.5*d[1]);h||(e[2]=.5*(d[2]+1));return e};p.prototype.projectPoint=function(b,e){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=1;a.mat4d.multiplyVec4(this.viewProjectionMatrix,d);a.vec3d.scale(d,1/Math.abs(d[3]));b=this.fullViewport;e[0]=c.lerp(0,b[0]+b[2],.5+.5*d[0]);e[1]=c.lerp(0,b[1]+b[3],.5+.5*d[1]);e[2]=.5*(d[2]+1);return e};p.prototype.unprojectPoint=function(b,c,e){void 0===e&&(e=!1);
if(e)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;a.mat4d.multiply(this.projectionMatrix,this.viewMatrix,h);if(!a.mat4d.inverse(h))return null;e=this.fullViewport;d[0]=2*(b[0]-e[0])/e[2]-1;d[1]=2*(b[1]-e[1])/e[3]-1;d[2]=2*b[2]-1;d[3]=1;a.mat4d.multiplyVec4(h,d);if(0===d[3])return null;c[0]=d[0]/d[3];c[1]=d[1]/d[3];c[2]=d[2]/d[3];return c};p.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};p.prototype.computeUpGlobal=
function(){a.vec3d.subtract(this.center,this.eye,n);var b=a.vec3d.length(this.center);1>b?(a.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(a.vec3d.dot(n,this.center))>.9999*a.vec3d.length(n)*b||(a.vec3d.cross(n,this.center,this.up),a.vec3d.cross(this.up,n,this.up),a.vec3d.normalize(this.up),this.markViewDirty())};p.prototype.computeUpLocal=function(){a.vec3d.direction(this.center,this.eye,n);.9999>=Math.abs(n[2])&&(a.vec3d.scale(n,n[2]),a.vec3d.set3(-n[0],-n[1],1-n[2],this.up),a.vec3d.normalize(this.up),
this.markViewDirty())};p.prototype._compareAndSetView=function(b,c){l(b,c)||(a.vec3d.set(b,c),this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0)};p.prototype._computeFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=f.plane.create()}c.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,a);return a};p.prototype._ensureViewClean=function(){this._viewDirty&&(a.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),a.vec3d.set3(-this._viewMatrix[2],
-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),a.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),a.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return p}();var d=a.vec4d.create(),h=a.mat4d.create(),n=a.vec3d.create(),t=a.vec3d.create();return r})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});var l={zoom:0,pan:0,rotate:0};r=function(){function e(c){this.createCamera=c;this.time=0;this.definition=new a.Definition(c);this.path=new b.Path}e.prototype.update=function(a,b,c){this.definition.update(a,b,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};e.prototype.cameraAt=function(a,b){b||(b=this.createCamera());a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,
a,1E3*this.time):1<=this.time?this.normalizedEasing(f.inOutCoastQuad,a):this.normalizedEasing(f.outExpo,a);a=this.path.interpolateComponentsAt(a,l);b.interpolate(this.definition.source,this.definition.target,a);return b};e.prototype.normalizedEasing=function(a,b,c){c=a(0);var d=a(1);return(a(b)-c)/(d-c)};e.prototype._applyTimeSettings=function(a,b){var d=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=d);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:
c.defaultSettings.minDuration/d,a),null!=b.maxDuration?b.maxDuration:c.defaultSettings.maxDuration/d)};return e}();g.Animation=r;g.default=r})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:f.defaultSettings.desiredScreenFlow};this.source=a();this.target=
a()}a.prototype.clone=function(){var c=new a(this.createCamera);c.copyFrom(this);return c};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,b,l){this.source!==a&&this.source.copyFrom(a);this.target!==b&&this.target.copyFrom(b);this.settings.desiredScreenFlow=null!=l.desiredScreenFlow?l.desiredScreenFlow:f.defaultSettings.desiredScreenFlow;this.compared=this.source.compareTo(this.target,this.compared);this.desiredPixelFlow=this.settings.desiredScreenFlow*
this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<
this.compared.rotate},enumerable:!0,configurable:!0});return a}();g.Definition=r;g.default=r})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(r,
g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function d(a,d){var e=c.call(this)||this;e._preallocSegments=[new b.default,new b.default,new b.default];e.update(a,d);return e}f(d,c);d.prototype.update=function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=l.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,
b.apex)}};d.prototype.segmentInterpolateComponentsAt=function(b,c,d){d=b.interpolateComponentsAt(c,d);b===this._ascensionSegment?d.zoom=a.outQuad(d.zoom):b===this._descensionSegment&&(d.zoom=a.inQuad(d.zoom));return d};d.prototype._updateWithApex=function(a,b){var c=this._preallocSegments,d=c[0],e=c[1],c=c[2],h=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-h,null!=b.ascensionFactor?b.descensionFactor:.5);var f=1-h-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();
d.definition.compared.targetZoom=a;d.definition.compared.pan=this.definition.compared.pan*h;d.definition.compared.rotate=this.definition.compared.rotate*h;d.update();this._ascensionSegment=d;this.segments.push(d);0<f&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=a,e.definition.compared.targetZoom=a,e.definition.compared.pan=this.definition.compared.pan*f,e.definition.compared.rotate=
this.definition.compared.rotate*f,e.update(),this.segments.push(e));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};d.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return d}(c.default);
g.Path=r;g.default=r})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(){this.segments=[]}Object.defineProperty(f.prototype,"time",{get:function(){return this.segments.reduce(function(a,c){return a+c.time},0)},enumerable:!0,configurable:!0});f.prototype.interpolateComponentsAt=function(a,c){a=Math.min(Math.max(a,0),1);a*=this.time;for(var b=0,f=0,e=this.definition,d=0;d<this.segments.length;d++){var h=
this.segments[d],n=h.definition;if(a<=h.time||d===this.segments.length-1)return c=this.segmentInterpolateComponentsAt(h,a/h.time,c),c.pan=e.hasPan?(b+n.compared.pan*c.pan)/e.compared.pan:1,c.rotate=e.hasRotate?(f+n.compared.rotate*c.rotate)/e.compared.rotate:1,a=c.zoom*(n.compared.targetZoom-n.compared.sourceZoom)+n.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,c.zoom=e.hasZoom?(a-b)/(f-b):1,c;a-=h.time;
b+=n.compared.pan;f+=n.compared.rotate}};f.prototype.segmentInterpolateComponentsAt=function(a,c,b){return a.interpolateComponentsAt(c,b)};return f}();g.Path=r;g.default=r})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a){a&&this.update(a)}f.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};f.prototype._updatePrecomputedVariables=function(){var a=this.definition,c=a.compared,b=c.sourceZoom,f=c.targetZoom;this._sl=b>f?1:-1;this._panPixelsAtSource=c.pan*a.source.pixelsPerPanAtZoom(b);a=(a.source.pixelsPerRotateAtZoom(b)+a.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=c.rotate*a};f.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,c=this.definition.compared.targetZoom,b=this.definition.hasZoom,f=this.definition.hasPan,e=this.definition.hasRotate,
d,h;d=f&&b?(c/a-1)/(-1/(this._sl*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource):0;h=b&&e?Math.log(a/c)/Math.LN2*this._sl*this.definition.halfWindowSize/this._rotatePixels:0;this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;b&&f&&e?(c=d+h+d*h,this._zoomPixelFlow=d*h/c*a,this._panPixelFlow=h/c*a,this._rotatePixelFlow=d/c*a):b&&f?(c=1+d,this._zoomPixelFlow=d/c*a,this._panPixelFlow=1/c*a):b&&e?(c=1+h,this._zoomPixelFlow=h/c*a,this._rotatePixelFlow=
1/c*a):f&&e?(d=this._panPixelsAtSource/this._rotatePixels,c=1+d,this._panPixelFlow=d/c*a,this._rotatePixelFlow=1/c*a):f?this._panPixelFlow=a:b?this._zoomPixelFlow=a:e&&(this._rotatePixelFlow=a);this.time=e?this.rotateTime:b?this.zoomTime:f?this.panTime:0};Object.defineProperty(f.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._sl*this.definition.halfWindowSize/this._zoomPixelFlow:0},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._sl*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});f.prototype._interpolateComponentsZoom=function(a){if(this.definition.hasZoom){var c=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(c*Math.pow(c/b,-a)-c)/(b-c)}return a};f.prototype._interpolateComponentsPan=function(a){if(this.definition.hasPan&&this.definition.hasZoom){var c=-1/(this._sl*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*
(Math.pow(2,c*a*this.time)-1)/(c*Math.LN2)}return a};f.prototype._interpolateComponentsRotate=function(a){return a};f.prototype.interpolateComponentsAt=function(a,c){a=Math.min(Math.max(a,0),1);var b=this._interpolateComponentsZoom(a),f=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);c?(c.zoom=b,c.pan=f,c.rotate=a):c={zoom:b,pan:f,rotate:a};return c};return f}();g.Segment=r;g.default=r})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports",
"./functions"],function(r,g,f){function a(a,b){var c=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<c?null!=b.maximumDistance?c+(b.maximumDistance-c)/2:1.5*c:b.maximumDistance?Math.min(b.maximumDistance,a):a}Object.defineProperty(g,"__esModule",{value:!0});g.optimalDistance=function(c,b){var l=a(c,b),e={ascensionFactor:null!=b.ascensionFactor?b.ascensionFactor:.5,descensionFactor:null!=b.descensionFactor?b.descensionFactor:
.5},d=0===e.ascensionFactor,h=0===e.descensionFactor,n=d?f.tAscensionZoomOnly:f.tAscensionZoomPan,t=d?f.dtAscensionZoomOnly:f.dtAscensionZoomPan,p=d?f.ddtAscensionZoomOnly:f.ddtAscensionZoomPan,k=h?f.tDescensionZoomOnly:f.tDescensionZoomPan,q=h?f.dtDescensionZoomOnly:f.dtDescensionZoomPan,m=h?f.ddtDescensionZoomOnly:f.ddtDescensionZoomPan,d=function(a){return n(c,e,a)+f.tPanion(c,e,a)+k(c,e,a)},h=function(a){return t(c,e,a)+f.dtPanion(c,e,a)+q(c,e,a)},u=function(a){return p(c,e,a)+f.ddtPanion(c,e,
a)+m(c,e,a)},g=d(l),v=f.tBaseLine(c),y=b.maximumIterations||20,A=null!=b.maximumDistance?b.maximumDistance:Infinity;for(b=0;b<y;b++){var C=(h(l)+1E-6)/u(l);if(isNaN(C)||l>=A&&0>C){if(!isFinite(A))return null;l=A;g=d(l);break}l-=C;if(l<c.compared.sourceZoom||l<c.compared.targetZoom)return null;C=d(l);if(.005>=Math.abs(C-g)/g)break;g=C}return g>.7*v?null:l<c.compared.sourceZoom||l<c.compared.targetZoom?null:l}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],
function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.tAscensionZoomPan=function(f,a,c){var b=f.halfWindowPanAtZoom(c-f.compared.sourceZoom);return-f.halfWindowSize*(a.ascensionFactor*Math.LN2*f.compared.pan+b)*Math.log(f.compared.sourceZoom/c)/(f.desiredPixelFlow*Math.LN2*b)};g.dtAscensionZoomPan=function(f,a,c){var b=1/c,l=Math.log(f.compared.sourceZoom*b),e=1/f.desiredPixelFlow,d=1/Math.LN2;c-=f.compared.sourceZoom;var h=1/c;a=(a.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(c))/
f.halfWindowPanAtZoom(1);return f.halfWindowSize*b*e*d*h*a-f.halfWindowSize*l*e*d*h+f.halfWindowSize*l*e*d*a/(c*c)};g.ddtAscensionZoomPan=function(f,a,c){var b=c-f.compared.sourceZoom,l=1/b,e=1/c,d=Math.log(f.compared.sourceZoom*e);a=(a.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(b))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*l*(-2*l*e*a+2*l*d+2*e-2*d*a/(b*b)-a/(c*c))/(f.desiredPixelFlow*Math.LN2)};g.tAscensionZoomOnly=function(f,a,c){return-f.halfWindowSize*Math.log(f.compared.sourceZoom/
c)/(f.desiredPixelFlow*Math.LN2)};g.dtAscensionZoomOnly=function(f,a,c){return f.halfWindowSize/(c*f.desiredPixelFlow*Math.LN2)};g.ddtAscensionZoomOnly=function(f,a,c){return-f.halfWindowSize/(c*c*f.desiredPixelFlow*Math.LN2)};g.tPanion=function(f,a,c){return-f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(c))};g.dtPanion=function(f,a,c){return f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*
f.halfWindowPanAtZoom(c*c))};g.ddtPanion=function(f,a,c){return-2*f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(c*c*c))};g.tDescensionZoomPan=function(f,a,c){return f.halfWindowSize*(-f.halfWindowPanAtZoom(c)-a.descensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))*Math.log(c/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*f.halfWindowPanAtZoom(-c+f.compared.targetZoom))};g.dtDescensionZoomPan=
function(f,a,c){var b=Math.log(c/f.compared.targetZoom),l=1/f.desiredPixelFlow,e=1/Math.LN2,d=-c+f.compared.targetZoom,h=1/d;a=(-f.halfWindowPanAtZoom(c)-a.descensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return-f.halfWindowSize*b*l*e*h+f.halfWindowSize*b*l*e*a/(d*d)+f.halfWindowSize*l*e*h*a/c};g.ddtDescensionZoomPan=function(f,a,c){var b=c-f.compared.targetZoom,l=1/b,e=1/c,d=Math.log(c/f.compared.targetZoom);a=(f.halfWindowPanAtZoom(c)+
a.descensionFactor*Math.LN2*f.compared.pan-f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*l*(-2*l*e*a-2*l*d+2*e+2*d*a/(b*b)-a/(c*c))/(f.desiredPixelFlow*Math.LN2)};g.tDescensionZoomOnly=function(f,a,c){return f.halfWindowSize*Math.log(c/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2)};g.dtDescensionZoomOnly=function(f,a,c){return f.halfWindowSize/(c*f.desiredPixelFlow*Math.LN2)};g.ddtDescensionZoomOnly=function(f,a,c){return-f.halfWindowSize/(c*
c*f.desiredPixelFlow*Math.LN2)};g.tBaseLine=function(f){var a=Math.LN2*f.compared.pan,c=f.halfWindowPanAtZoom(f.compared.sourceZoom-f.compared.targetZoom),b=f.halfWindowSize*Math.log(f.compared.sourceZoom/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*c);return f.compared.sourceZoom<=f.compared.targetZoom?b*(a-c):b*(a+c)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],
function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function l(c){void 0===c&&(c=new a);var d=b.call(this)||this;d.viewAnimation=c;return d}f(l,b);Object.defineProperty(l.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&this._asyncResult.reject();this._asyncResult=a;if(this.state===c.State.Finished||this.state===c.State.Stopped)this._asyncResult=
null,this.state===c.State.Finished?a.resolve():a.reject()},enumerable:!0,configurable:!0});l.prototype.onControllerStart=function(a){var c=this;b.prototype.onControllerStart.call(this,a);this.viewAnimation&&this.viewAnimation.always(function(){c.updateStateFromViewAnimation()})};l.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==c.State.Ready&&this.state!==c.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===a.State.STOPPED&&
(this.state=c.State.Stopped))};l.prototype.onControllerEnd=function(a){this.viewAnimation&&(this.viewAnimation.done||(this.state===c.State.Finished?this.viewAnimation.finish():this.state===c.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===c.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());b.prototype.onControllerEnd.call(this,a)};l.prototype.finish=function(){this.finishController()};return l}(c.CameraController);g.AnimationController=r})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});var l;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";a.Finished="finished"})(l=g.State||(g.State={}));r=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.state=l.Ready;return a}f(d,c);Object.defineProperty(d.prototype,"active",{get:function(){return this.state===l.Running},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!1},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});d.prototype.stopController=function(){return this.canStop?(this.state=l.Stopped,!0):!1};d.prototype.finishController=function(){this.state=l.Finished};d.prototype.onControllerStart=function(a){this.state=l.Running};d.prototype.onControllerEnd=function(a){};d.prototype.stepController=function(a,b){};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return!1},
enumerable:!0,configurable:!0});a([b.property({readOnly:!0,dependsOn:["state"]})],d.prototype,"active",null);a([b.property()],d.prototype,"state",void 0);return d=a([b.subclass()],d)}(b.declared(c));g.CameraController=r})},"esri/views/3d/state/utils/navigationUtils":function(){define(["require","exports","../../lib/glMatrix","./primitiveIntersectionUtils","../../support/mathUtils"],function(r,g,f,a,c){function b(b,c,d,e,k){void 0===k&&(k=!1);var f=B;a.createRay(c,d,f,k);return a.intersectSphere(b,
f,e)?!0:(h(b,f,e),!1)}function l(b,c,d,e){var h=B;a.createRay(c,d,h,!0);return a.intersectSphere(b,h,e)}function e(a,b,d){f.vec3d.cross(a,b,d);a=f.vec3d.dot(a,b)/(f.vec3d.length(a)*f.vec3d.length(b));return-c.acos(a)}function d(a,b,c,d){var e=x;f.mat4d.identity(e);f.mat4d.rotate(e,d,c);f.vec3d.subtract(a.eye,b);f.mat4d.multiplyVec3(e,a.eye,a.eye);f.vec3d.add(a.eye,b);f.vec3d.subtract(a.center,b);f.mat4d.multiplyVec3(e,a.center,a.center);f.vec3d.add(a.center,b);f.mat4d.multiplyVec3(e,a.up,a.up);a.markViewDirty()}
function h(a,b,d){var e=y,h=A,k=u;f.vec3d.subtract(b.origin,a.center,h);f.vec3d.cross(h,b.direction,e);f.vec3d.cross(e,h,d);f.vec3d.scale(d,1/f.vec3d.length(d)*a.radius);a=-c.asin(a.radius/f.vec3d.length(b.origin));f.mat4d.identity(k);f.mat4d.rotate(k,a,e);f.mat4d.multiplyVec3(k,d)}function n(a,b){f.vec3d.set3(0,0,0,b);for(var c=0;c<a.length;c++)f.vec3d.add(b,a[c]);f.vec3d.scale(b,1/a.length)}Object.defineProperty(g,"__esModule",{value:!0});g.Earth={center:f.vec3d.create(),radius:6378137};g.normalizeCoordinate=
function(a,b,c){c[0]=b[0]/a.fullWidth;c[1]=b[1]/a.fullHeight;return c};g.sphereOrSilhouettePointFromScreenPoint=b;g.intersectSphereFromScreenPoint=l;g.rotationAndAxisFromPoints=e;g.rotationFromPointsAroundAxis=function(a,b,c){var d=y,e=A,h=C;f.vec3d.set(a,e);f.vec3d.set(b,h);a=f.vec3d.dot(e,c);b=f.vec3d.dot(h,c);f.vec3d.scale(c,a,d);f.vec3d.subtract(e,d);f.vec3d.normalize(e);f.vec3d.scale(c,b,d);f.vec3d.subtract(h,d);f.vec3d.normalize(h);a=f.vec3d.dot(e,h);f.vec3d.cross(c,e,d);c=f.vec3d.dot(h,d);
return Math.atan2(c,a)};g.setPlane=function(a,b,c){f.vec3d.set(b,c.normal);c.d=-f.vec3d.dot(b,a)};g.setPlaneD=function(a,b){b.d=-f.vec3d.dot(b.normal,a)};g.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};g.applyRotation=d;g.closestPointOnSphereSilhouette=h;g.intersectPlaneFromScreenPoint=function(b,c,d,e){var h=B;a.createRay(c,d,h);return a.intersectPlane(b,h,e)};g.applyZoomToPoint=function(a,b,c,d){var e=v;c=1-c;f.vec3d.subtract(b,a.eye,e);
var h=f.vec3d.length(e),k=h*(1-c);0<=c&&k<d&&(k=d,c=-(k-h)/h);1E-6>Math.abs(h-k)||(f.vec3d.scale(e,c),f.vec3d.add(a.eye,e),f.vec3d.lerp(a.center,b,c))};g.applyZoomOnSphere=function(a,b,c){f.vec2d.set2(b.padding[3]+b.width/2,b.padding[2]+b.height/2,t);l(a,b,t,b.center);f.vec3d.subtract(b.center,b.eye,v);a=f.vec3d.length(v);1E-6>Math.abs(a-a*c)||(f.vec3d.scale(v,c),f.vec3d.subtract(b.center,v,b.eye),b.markViewDirty())};var t=f.vec2d.create();g.navPointToScreenPoint=function(a,b,c){f.vec2d.set2(b.x,
a.fullHeight-b.y,c)};g.centroidOnSphere=function(a,b,c){n(b,c);f.vec3d.normalize(c);f.vec3d.scale(c,a)};g.centroid=n;var p;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(p=g.PanMode||(g.PanMode={}));g.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};g.pickPointAndInitSphere=function(a,c,d,e){var h=f.vec3d.create(),k={center:f.vec3d.create(),radius:0},q=!0;a.pickPointInScreen(d,h)?k.radius=f.vec3d.length(h):(k.radius=f.vec3d.length(c.center),k.radius<.9*g.Earth.radius&&
(k.radius=g.Earth.radius),k.radius=Math.max(f.vec3d.length(c.center),.9*g.Earth.radius),e?b(k,c,d,h):q=l(k,c,d,h));return{sphere:k,scenePickPoint:q?h:null}};g.decidePanMode=function(a,b,c){if(f.vec3d.length(a.eye)-g.Earth.radius<g.VerticalPanTresholds.Elevation){if(b.radius>f.vec3d.length(a.eye))return p.Vertical;f.vec3d.normalize(f.vec3d.subtract(a.eye,c,k));return Math.abs(.5*Math.PI-Math.acos(f.vec3d.dot(c,k)/f.vec3d.length(c)))<g.VerticalPanTresholds.Angle?p.Vertical:p.Horizontal}return p.Horizontal};
var k=f.vec3d.create();g.applyPanPlanar=function(a,b,c){f.vec3d.subtract(c,b,q);f.vec3d.subtract(a.eye,q);f.vec3d.subtract(a.center,q);a.markViewDirty()};var q=f.vec3d.create();g.applyPanSpherical=function(a,b,c,h){c=e(c,h,m);d(b,a.center,m,c)};var m=f.vec3d.create(),u=f.mat4d.create(),x=f.mat4d.create(),v=f.vec3d.create(),y=f.vec3d.create(),A=f.vec3d.create(),C=f.vec3d.create(),B={origin:f.vec3d.create(),direction:f.vec3d.create()}})},"esri/views/3d/state/utils/primitiveIntersectionUtils":function(){define(["require",
"exports","../../lib/glMatrix"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.createRay=function(b,c,e,d){void 0===d&&(d=!1);f.vec3d.set3(c[0],c[1],0,a);d?f.vec3d.set(b.eye,e.origin):f.vec3d.unproject(a,b.viewMatrix,b.projectionMatrix,b.fullViewport,e.origin);a[2]=1;f.vec3d.unproject(a,b.viewMatrix,b.projectionMatrix,b.fullViewport,e.direction);f.vec3d.subtract(e.direction,e.origin,e.direction);f.vec3d.normalize(e.direction)};g.intersectSphere=function(a,l,e){var b=f.vec3d.subtract(l.origin,
a.center,c),h=f.vec3d.dot(l.direction,l.direction),n=2*f.vec3d.dot(l.direction,b);a=f.vec3d.dot(b,b)-a.radius*a.radius;a=n*n-4*h*a;if(0>a)return!1;b=Math.sqrt(a);a=(-n-b)/(2*h);h=(-n+b)/(2*h);if(0>a||h<a&&0<h)a=h;return 0<a?(f.vec3d.add(l.origin,f.vec3d.scale(l.direction,a,e),e),!0):!1};g.intersectPlane=function(a,c,e){var b=f.vec3d.dot(a.normal,c.direction);if(0===b)return!1;a=-(f.vec3d.dot(a.normal,c.origin)+a.d)/b;if(0>a)return!1;f.vec3d.add(c.origin,f.vec3d.scale(c.direction,a,e),e);return!0};
var a=f.vec3d.create(),c=f.vec3d.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function d(a,d,e){d=b.call(this,a.state,d,"interaction"===e?null:void 0)||
this;d.view=a;d.mode=e;d.zoomLocation=c.vec3d.create();d.tmpCamera=new l;d.tmpRayDir=c.vec3d.create();d.tmpCenter=c.vec3d.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new l,interactionDirection:null};return d}f(d,b);Object.defineProperty(d.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});d.prototype.zoomStep=function(a,b){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;
this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);this.tmpCamera.copyFrom(d.camera);0<a?(this.pickingHelper.pickPointInScreen(b,this.zoomLocation)||this.pickingHelper.pickFreePointInScreen(b,this.zoomLocation),this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:c.vec3d.set(this.tmpCamera.center,
this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};d.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:e.outExpo}};d.prototype.updateCamera=function(b,d,e,h){c.vec3d.subtract(e,b.eye,this.tmpRayDir);h=c.vec3d.length(this.tmpRayDir);var k=h*d;1>=d&&4>k&&(k=4,d=k/h);1E-6>Math.abs(h-k)||(c.vec3d.scale(this.tmpRayDir,d),c.vec3d.subtract(e,this.tmpRayDir,b.eye),c.vec3d.lerp(b.center,e,1-d),a.applyAll(this.view,this.tmpCamera,
this.constraintOptions))};return d}(b.PointToPointAnimationController);g.ZoomStepController=r})},"esri/views/3d/state/helpers/PickingHelper":function(){define(["require","exports","../../camera/intersectionUtils","../../lib/glMatrix","../../webgl-engine/lib/Selector"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function b(b){this.view=b;this.tmpR0=a.vec3d.create();this.tmpR1=a.vec3d.create();this.tmpSelector=new c(this.view.viewingMode)}b.prototype.pickPointInScreen=
function(a,b){return this.pickedIntersectionPoint(this.pickInScreen(a,!1),b)};b.prototype.pickFreePointFromSegment=function(b,c,d){a.vec3d.set(b,this.tmpR0);a.vec3d.set(c,this.tmpR1);a.vec3d.subtract(this.tmpR1,this.tmpR0);a.vec3d.normalize(this.tmpR1);var e=this.view.dataExtent;b=Math.max(e.xmax-e.xmin,e.ymax-e.ymin,8*Math.max(e.xmax-e.xmin,e.ymax-e.ymin));c=this.view.state.camera;var l=Math.max(0,e.xmin-c.eye[0],c.eye[0]-e.xmax),e=Math.max(0,e.ymin-c.eye[1],c.eye[1]-e.ymax),l=Math.sqrt(l*l+e*e),
e=this.view.renderCoordsHelper.getAltitude(c.eye);c=f.surfaceElevationBelowEye(this.view,c);c=b/Math.max(1,Math.pow(Math.max(0,Math.log(b/(Math.abs(e-c)+Number.MIN_VALUE))),2));c=Math.max(c,Math.min(l,b));a.vec3d.scale(this.tmpR1,c);a.vec3d.add(this.tmpR0,this.tmpR1,d)};b.prototype.pickFreePointInScreen=function(a,b){this.view._pickRayWithBeginPoint(a,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,this.tmpR1,b)};b.prototype.pickRaySegment=
function(a,b,c){return this.pickedIntersectionPoint(this.view._pickRay(a,b,null,null,null,null,this.tmpSelector),c)};b.prototype.pickInScreen=function(b,c){this.view._pickRayWithBeginPoint(b,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);c&&a.vec3d.set(this.view.state.camera.eye,this.tmpR0);return this.view._pickRay(this.tmpR0,this.tmpR1,b,b,null,null,this.tmpSelector)};b.prototype.pickedIntersectionPoint=function(a,b){return a?a.getMinResult().getIntersectionPoint(b):!1};return b}();
g.PickingHelper=r})},"esri/views/input/InputHandler":function(){define(["require","exports","../../core/Logger","./EventMatch"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});var c=f.getLogger("esri.views.input.InputHandler");r=function(){function e(a){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._hasSideEffects=a}Object.defineProperty(e.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=
[];for(var a in this._incoming)for(var b=0,c=this._incoming[a];b<c.length;b++)this._incomingEventMatches.push(c[b].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||
(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});e.prototype.onInstall=function(a){var b=this;this._manager?c.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return b._handleEvent(a)}),a.setUninstallCallback(function(){return b._onUninstall()}),
this._manager=a)};e.prototype.onUninstall=function(){};e.prototype.registerIncoming=function(c,e,f){var d=this;"function"===typeof e?(f=e,e=[]):e=e||[];c="string"===typeof c?new a.EventMatch(c,e):c;var h=function(){d._incomingEventTypes=null;d._incomingEventMatches=null};e=function(a){var b=d._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),h(),d._manager&&d._manager.updateDependencies())};f=new b(c,f,{onPause:e,onRemove:e,onResume:function(a){var b=d._incoming[a.match.eventType];b&&
-1===b.indexOf(a)&&(b.push(a),h(),d._manager&&d._manager.updateDependencies())}});e=this._incoming[c.eventType];e||(e=[],this._incoming[c.eventType]=e);e.push(f);h();this._manager&&this._manager.updateDependencies();return f};e.prototype.registerOutgoing=function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var c=new l(a,{onEmit:function(a,c,d,e){b._manager.emit(a.eventType,c,d,e)},onRemove:function(a){delete b._outgoing[a.eventType];
b._manager.updateDependencies()}});this._outgoing[a]=c;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();return c};e.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};e.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)};e.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):c.error("This InputHandler is not registered with an InputManager")};e.prototype._handleEvent=function(a){var b=
this._incoming[a.type];if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.match.matches(a)&&(d.callback(a),a.shouldStopPropagation()))break}};return e}();g.InputHandler=r;var b=function(){function a(a,b,c){this.match=a;this._callback=b;this._handler=c}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,"callback",{get:function(){return this._callback},
enumerable:!0,configurable:!0});return a}(),l=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=function(a,b,c){if(!this._removed)this._handler.onEmit(this,a,b,c)};a.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a,c){void 0===c&&(c=[]);this.eventType=a;this.keyModifiers=
c}f.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;for(var c=0,b=this.keyModifiers;c<b.length;c++)if(!a.has(b[c]))return!1;return!0};return f}();g.EventMatch=r})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.eventMatchesPointerAction=function(f,a){switch(a){case "primary":return"touch"===f.pointerType||0===f.button;case "secondary":return"touch"!==
f.pointerType&&2===f.button;case "tertiary":return"touch"!==f.pointerType&&1===f.button}};g.eventMatchesMousePointerAction=function(f,a){if("touch"===f.pointerType)return!1;switch(a){case "primary":return 0===f.button;case "secondary":return 2===f.button;case "tertiary":return 1===f.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function d(a,d,e,f){var h=b.call(this,!0)||this;h.view=a;h.pointerAction=d;h.pivotPoint=e;h.pickingHelper=new c.PickingHelper(a);h.registerIncoming("drag",f,function(a){return h.handleDrag(a)});return h}f(d,b);d.prototype.handleDrag=function(b){var c=b.data;if(!(1<c.pointers.size)&&l.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=[c.center.x,this.view.height-c.center.y];switch(c.action){case "start":this.cameraController=
new a.RotateController(this.view,this.pickingHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return d}(b.InputHandler);g.DragRotate=r})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/glMatrix ../../state/Constraints ./InteractiveController ../../state/utils/navigationUtils ../../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});r=function(h){function l(a,b,d){var e=h.call(this)||this;e.view=a;e.pickingHelper=b;e.pivot=d;e.lastPoint=c.vec2d.create();e.tmpWorldUp=c.vec3d.create();e.tmpViewDir=c.vec3d.create();e.tmpRotCurPoint=c.vec2d.create();e.tmpTransf=c.mat4d.create();e.tmpAxis=c.vec3d.create();e.pivotPos=c.vec3d.create();e.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};
e.rotScale="center"===d?3:1.5;return e}f(l,h);l.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":c.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.selection=0;break;case "center":this.pickingHelper.pickRaySegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.pickingHelper.pickFreePointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos):c.vec3d.set(this.beginCamera.center,
this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;e.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};l.prototype.update=function(b){if(this.active){var c;switch(this.pivot){case "eye":c=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,c=this.currentCamera.eye}this.applyRotation(this.currentCamera,b,c,this.pivotPos);
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}};l.prototype.end=function(){this.active&&this.finishController()};l.prototype.applyRotation=function(a,h,k,f){this.view.renderCoordsHelper.worldUpAtPosition(f,this.tmpWorldUp);e.normalizeCoordinate(a,h,this.tmpRotCurPoint);h=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var l=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;c.vec3d.subtract(k,f,this.tmpViewDir);var q=c.vec3d.length(this.tmpViewDir),q=d.acos(c.vec3d.dot(this.tmpViewDir,
this.tmpWorldUp)/q);if("eye"===this.pivot){var n=.5*Math.PI-q,p=.495*Math.PI;h=n-Math.max(-p,Math.min(p,n+-.5*h))}h=d.clamp(h+q,b.TiltDefault.min,b.TiltDefault.max)-q;c.mat4d.identity(this.tmpTransf);c.vec3d.cross(a.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(l=-l);c.mat4d.rotate(this.tmpTransf,l,this.tmpWorldUp);c.mat4d.rotate(this.tmpTransf,h,this.tmpAxis);c.mat4d.multiplyVec3(this.tmpTransf,this.tmpViewDir);c.vec3d.add(f,this.tmpViewDir,k);c.mat4d.multiplyVec3(this.tmpTransf,a.up);
c.vec2d.set(this.tmpRotCurPoint,this.lastPoint);a.markViewDirty()};return l}(l.InteractiveController);g.RotateController=r})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.beginCamera=new c;b.currentCamera=new c;
return b}f(b,a);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,c){a.prototype.stepController.call(this,b,c);c.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(c)};b.prototype.onControllerStart=function(b){a.prototype.onControllerStart.call(this,b);this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};b.prototype.onControllerEnd=function(b){b.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,
b)};return b}(a.CameraController);g.InteractiveController=r})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(d){function h(a,c,e){var h=d.call(this,
!0)||this;h.view=a;h.pointerAction=c;h.pickingHelper=new b.PickingHelper(a);h.registerIncoming("drag",e,function(a){return h.handleDrag(a)});return h}f(h,d);h.prototype.handleDrag=function(b){var d=b.data;if(!(1<d.pointers.size)&&e.eventMatchesMousePointerAction(b.data,this.pointerAction)){var h=[d.center.x,this.view.height-d.center.y];switch(d.action){case "start":this.cameraController=this.view.state.isGlobal?new a.ZoomController(this.view,this.pickingHelper):new c.ZoomController(this.view,this.pickingHelper);
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(h);break;case "update":this.cameraController.update(h);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return h}(l.InputHandler);g.DragZoom=r})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils".split(" "),
function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function d(a,d){var e=b.call(this)||this;e.view=a;e.pickingHelper=d;e.pickPoint=c.vec3d.create();e.tmpP0=c.vec3d.create();e.panAxis=c.vec3d.create();e.tmpRayDir=c.vec3d.create();e.targetOnSphere=c.vec3d.create();e.dragBeginPoint=c.vec2d.create();e.normalizedAnchorPoint=c.vec2d.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};e.sphere=
{center:c.vec3d.create(),radius:0};e.hasPickPoint=!1;return e}f(d,b);d.prototype.begin=function(a){this.active&&(c.vec2d.set(a,this.dragBeginPoint),l.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=l.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};d.prototype.update=function(b){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;c.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var d=c.vec3d.length(this.tmpRayDir);l.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var e=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),h=d*Math.pow(2,e),k=this.view.state.constraints.minimumPoiDistance;0>e&&h<k&&(h=k);1E-6>Math.abs(d-h)||(this.hasPickPoint&&h<d&&(e=1-(1-h/d)*(1-this.sphere.radius/
c.vec3d.length(this.currentCamera.center)),c.vec3d.scale(this.currentCamera.center,e)),c.vec3d.scale(this.tmpRayDir,-h/d),c.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(l.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),b=l.rotationAndAxisFromPoints(this.pickPoint,
this.targetOnSphere,this.panAxis),l.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,b)),a.applySurfaceCollision(this.view,this.currentCamera))}};d.prototype.end=function(){this.active&&this.finishController()};return d}(b.InteractiveController);g.ZoomController=r})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function d(a,d){var e=b.call(this)||this;e.view=a;e.pickingHelper=d;e.tmpP=c.vec3d.create();e.tmpN=c.vec3d.create();e.tmpP0=c.vec3d.create();e.tmpPoi=c.vec3d.create();e.tmpRayDir=c.vec3d.create();e.dragBeginPoint=c.vec2d.create();e.normalizedAnchorPoint=c.vec2d.create();e.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:c.vec3d.create()};e.plane=
{normal:c.vec3d.create(),d:0};return e}f(d,b);d.prototype.begin=function(a){this.active&&(c.vec2d.set(a,this.dragBeginPoint),l.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.pickingHelper.pickPointInScreen(a,this.tmpP)||this.pickingHelper.pickFreePointInScreen(a,this.tmpP),c.vec3d.normalize(c.vec3d.subtract(this.beginCamera.eye,this.beginCamera.center,this.tmpN)),0>this.tmpN[1]&&c.vec3d.negate(this.tmpN),l.setPlane(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};d.prototype.update=function(b){if(this.active){l.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||c.vec3d.set(this.currentCamera.center,this.tmpPoi);l.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var d=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);c.vec2d.set(this.tmpP0,this.normalizedAnchorPoint);c.vec3d.subtract(this.tmpPoi,this.currentCamera.eye,this.tmpRayDir);var h=c.vec3d.length(this.tmpRayDir),k=h*(1-d);c.vec3d.set(this.tmpRayDir,
this.constraintOptions.interactionDirection);c.vec3d.scale(this.constraintOptions.interactionDirection,e.sign(d)/h);var f=this.view.state.constraints.minimumPoiDistance;0<=d&&k<f&&(k=f,d=-(k-h)/h);1E-6>Math.abs(h-k)||(c.vec3d.scale(this.tmpRayDir,d),c.vec3d.add(this.currentCamera.eye,this.tmpRayDir),c.vec3d.lerp(this.currentCamera.center,this.tmpPoi,d),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],
this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions))}};d.prototype.end=function(){this.active&&this.finishController()};return d}(b.InteractiveController);g.ZoomController=r})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../3d/state/controllers/GamepadController",
"../../../input/InputHandler"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function c(c){var d=b.call(this,!0)||this;d.view=c;d._gamepadController=null;d.view.gamepad.enabled&&(d._gamepadController=new a.GamepadController(d.view),d.view.state.switchCameraController(d._gamepadController));d.view.gamepad.watch("isIdle",function(b){b?d._gamepadController&&d._gamepadController.finishController():d._gamepadController&&d._gamepadController.active||(d._gamepadController=
new a.GamepadController(d.view),d.view.state.switchCameraController(d._gamepadController))});return d}f(c,b);return c}(c.InputHandler);g.GamepadNavigation=r})},"esri/views/3d/state/controllers/GamepadController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/glMatrix ../Constraints ./CameraController ../../support/mathUtils".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});var d=c.vec3d.create(),
h=c.vec3d.create(),n=c.vec3d.create(),t=c.vec3d.create(),p=c.vec3d.create(),k=c.vec3d.create(),q=c.mat4d.create(),m=c.mat4d.create(),u={translation:[0,0,0],heading:0,tilt:0};r=function(l){function g(a){var b=l.call(this)||this;b.view=a;return b}f(g,l);Object.defineProperty(g.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});g.prototype.stepController=function(f,g){l.prototype.stepController.call(this,f,g);this.view.gamepad.updateTransformation(u);if(0!==u.translation[0]||
0!==u.translation[1]||0!==u.translation[2]||0!==u.heading||0!==u.tilt){c.mat4d.identity(q);c.mat4d.identity(m);f=g.eye;var v=g.center,A=g.viewUp,x=g.viewRight,y=g.viewForward;this.view.renderCoordsHelper.worldUpAtPosition(f,h);var r=this.view.renderCoordsHelper.getAltitude(f);if("local"===this.view.viewingMode){r=Math.pow(Math.min(Math.max(r,1),1E4),2);c.vec3d.set3(y[0],y[1],0,d);c.vec3d.normalize(d);c.vec3d.scale(x,u.translation[0]*r*1E-5,n);switch(this.view.gamepad.mode){case "hover":c.vec3d.scale(d,
-u.translation[1]*r*1E-5,t);break;case "flight":c.vec3d.scale(y,-u.translation[1]*r*1E-5,t)}c.vec3d.scale(h,u.translation[2]*r*1E-5,p);c.vec3d.add(n,t,k);c.vec3d.add(k,p);c.mat4d.translate(q,k);c.mat4d.rotate(m,.04*-u.heading,h);r=.04*u.tilt;y=Math.acos(c.vec3d.dot(h,y));y-r>b.TiltDefault.min&&y-r<e.deg2rad(this.view.constraints.tilt.max)&&c.mat4d.rotate(m,r,x)}else if("global"===this.view.viewingMode){r=Math.pow(Math.min(Math.max(r,1),1E4),2);c.vec3d.cross(x,f,d);c.vec3d.normalize(d);c.vec3d.negate(d);
c.mat4d.rotate(q,u.translation[0]*r*1E-11,d);switch(this.view.gamepad.mode){case "hover":c.mat4d.rotate(q,u.translation[1]*r*1E-11,x);break;case "flight":c.vec3d.scale(y,-u.translation[1]*r*1E-4,t),c.mat4d.translate(q,t)}c.vec3d.scale(h,u.translation[2]*r*1E-5);c.mat4d.translate(q,h);c.mat4d.rotate(m,.04*-u.heading,f);r=.04*u.tilt;y=Math.acos(c.vec3d.dot(h,y));y-r>b.TiltDefault.min&&y-r<e.deg2rad(this.view.constraints.tilt.max)&&c.mat4d.rotate(m,r,x)}c.vec3d.subtract(v,f);c.vec3d.subtract(A,f);c.mat4d.multiplyVec3(m,
v);c.mat4d.multiplyVec3(m,A);c.vec3d.add(v,f);c.vec3d.add(A,f);c.mat4d.multiplyVec3(q,f,g.eye);c.mat4d.multiplyVec3(q,v,g.center);c.mat4d.multiplyVec3(q,A,g.up);a.applyAll(this.view,g,{selection:8,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null})}};return g}(l.CameraController);g.GamepadController=r})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/global/PanContinuousController",
"../../../input/InputHandler"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function c(c,d,h){var e=b.call(this,!0)||this;e.view=c;e.keyToDirection=(f={},f[d.left]=a.Direction.LEFT,f[d.right]=a.Direction.RIGHT,f[d.forward]=a.Direction.FORWARD,f[d.backward]=a.Direction.BACKWARD,f[d.up]=a.Direction.UP,f[d.down]=a.Direction.DOWN,f);c.state.isGlobal&&(e.registerIncoming("key-down",h,function(a){return e.handleKeyDown(a)}),e.registerIncoming("key-up",h,function(a){return e.handleKeyUp(a)}));
return e;var f}f(c,b);c.prototype.handleKeyDown=function(b){if(!b.data.repeat){var c=this.keyToDirection[b.data.key];null!=c&&(this.cameraController&&this.cameraController.active||(this.cameraController=new a.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(b,c,!0))}};c.prototype.handleKeyUp=function(a){var b=this.keyToDirection[a.data.key];null!=b&&this.cameraController&&this.cameraController.active&&this.handleKey(a,
b,!1)};c.prototype.handleKey=function(a,b,c){c?this.cameraController.addDirection(b):this.cameraController.removeDirection(b);a.stopPropagation()};return c}(c.InputHandler);g.KeyPan=r})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,
"__esModule",{value:!0});g.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};var d=c.vec3d,h=c.mat4d;r=function(b){function c(a){var c=b.call(this)||this;c.view=a;c.directionStatus=0;c.direction=d.create();c.tmpAxis=d.create();c.radiusChange=0;c.velocity=0;c.tmpP1=d.create();c.tmpTransf=h.create();return c}f(c,b);Object.defineProperty(c.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});c.prototype.addDirection=function(a){0===this.directionStatus&&d.set3(0,
0,0,this.direction);this.directionStatus&a||(this.directionStatus|=a,a&(g.Direction.LEFT|g.Direction.RIGHT|g.Direction.FORWARD|g.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),d.add(this.direction,this.tmpAxis)):(a=this.directionStatus&(g.Direction.UP|g.Direction.DOWN),this.radiusChange=a===g.Direction.UP?1:a===g.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};c.prototype.removeDirection=function(a){this.directionStatus&=~a;0===this.directionStatus&&this.active?this.finishController():
a&(g.Direction.LEFT|g.Direction.RIGHT|g.Direction.FORWARD|g.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),d.subtract(this.direction,this.tmpAxis),.01>d.length(this.direction)&&d.set3(0,0,0,this.direction)):(a=this.directionStatus&(g.Direction.UP|g.Direction.DOWN),this.radiusChange=a===g.Direction.UP?1:a===g.Direction.DOWN?-1:0)};c.prototype.stepController=function(c,e){b.prototype.stepController.call(this,c,e);c*=this.velocity;var k=!1;if(0<Math.abs(this.radiusChange)){var k=1+c*this.radiusChange,
f=e.viewForward,l=d.normalize(e.center,this.tmpP1);(-.999<d.dot(f,l)||0>this.radiusChange)&&d.scale(e.center,k);d.scale(e.eye,k);this.velocity=this.computePanVelocity();k=!0}.01<d.length2(this.direction)&&(h.identity(this.tmpTransf),h.rotate(this.tmpTransf,c,this.direction),h.multiplyVec3(this.tmpTransf,e.eye),h.multiplyVec3(this.tmpTransf,e.center),h.multiplyVec3(this.tmpTransf,e.up),k=!0);k&&a.applyAll(this.view,e,{selection:14,interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,
interactionDirection:null})};c.prototype.computePanAxis=function(a,b){var c=this.view.state.camera;d.subtract(c.center,c.eye,b);d.cross(b,c.up);if(a===g.Direction.LEFT||a===g.Direction.RIGHT)d.normalize(b),d.cross(b,c.center);a!==g.Direction.RIGHT&&a!==g.Direction.FORWARD||d.negate(b);d.normalize(b)};c.prototype.computePanVelocity=function(){var a=.5*Math.abs(d.length(this.view.state.camera.eye)-l.earthRadius),a=e.clamp(a,1,2*l.earthRadius);return e.acos(1-a*a/(2*l.earthRadius*l.earthRadius))};return c}(b.CameraController);
g.PanContinuousController=r})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../state/helpers/PickingHelper ../../../input/InputHandler".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(e){function d(a,c){var d=e.call(this,!0)||this;d.view=a;d.pickingHelper=new b.PickingHelper(a);
d.registerIncoming("mouse-wheel",c,function(a){return d.handleMouseWheel(a)});return d}f(d,e);d.prototype.handleMouseWheel=function(b){var d=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new a.ZoomStepController(this.view,this.pickingHelper,"interaction"):new c.ZoomStepController(this.view,this.pickingHelper,"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*d.deltaY,[d.x,
this.view.height-d.y]);b.stopPropagation()};return d}(l.InputHandler);g.MouseWheelZoom=r})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});
r=function(d){function h(a,c,e){var h=d.call(this,!0)||this;h.view=a;h.pointerAction=c;h.lastEndTimestamp=0;h.lastTimestamp=0;h.pickingHelper=new b.PickingHelper(a);h.registerIncoming("drag",e,function(a){return h.handleDrag(a)});return h}f(h,d);h.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||e.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;
this.controller&&this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};h.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};h.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};h.prototype.createController=function(){return this.view.state.isGlobal?new a.PinchAndPanController(this.view,this.pickingHelper):new c.PinchAndPanController(this.view,this.pickingHelper)};return h}(l.InputHandler);g.PinchAndPanNavigation=r})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/glMatrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){Object.defineProperty(g,"__esModule",{value:!0});r=function(l){function g(a,d){var e=l.call(this)||this;e.view=a;e.pickingHelper=d;e.smoothRotation=new c.ExponentialFalloff(.05);e.rotationAxis=b.vec3d.create();e.panningPlane={normal:b.vec3d.create(),d:0};e.smoothScaling=new c.ExponentialFalloff(.05);e.zoomCenterScreen=b.vec2d.create();e.zoomMomentumEstimator=new v.ZoomMomentumEstimator;e.rotationMomentumEstimator=new x.RotationMomentumEstimator;e.panSphericalMomentumEstimator=
new u.PanSphericalMomentumEstimator;e.panPlanarMomentumEstimator=new m.PanPlanarMomentumEstimator;e.adjustedSphere={center:b.vec3d.create(),radius:0};e.tmp2d=b.vec2d.create();e.tmp3d=b.vec3d.create();e.beginScreenPoint=b.vec2d.create();e.beginScenePoint=b.vec3d.create();e.screenPickPoint=b.vec2d.create();e.panMode=k.PanMode.Horizontal;e.tmpInteractionDirection=b.vec3d.create();e.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new q,interactionDirection:null};
return e}f(g,l);g.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();p.navPointToScreenPoint(this.currentCamera,a.center,this.screenPickPoint);b.vec2d.set(this.screenPickPoint,this.beginScreenPoint);var c=p.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;b.vec3d.set(this.scenePickPoint,this.beginScenePoint);
this.panMode=p.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);if(this.panMode===k.PanMode.Vertical){b.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);b.vec3d.normalize(this.panningPlane.normal);b.vec3d.negate(this.panningPlane.normal);p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);c=b.vec3d.create();b.vec3d.set3(this.screenPickPoint[0],this.currentCamera.fullHeight,0,c);var d=b.vec3d.create(),e=b.vec3d.length(this.beginCamera.eye);this.adjustedSphere.radius=
e<this.sphere.radius?e-100:this.sphere.radius;p.sphereOrSilhouettePointFromScreenPoint(this.adjustedSphere,this.beginCamera,c,d);this.beginCamera.projectPoint(d,c);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*c[1]);this.pickingHelper.pickPointInScreen(this.screenPickPoint,this.scenePickPoint)&&p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,
this.tmp2d,this.beginScenePoint)}this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};g.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===k.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};g.prototype.end=function(a){a.pointers.size===this.pointerCount&&
this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===k.PanMode.Horizontal?new t.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new n.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new h.RotationMomentumController(this.view,a,this.sphere.center,this.rotationAxis);if(this.panMode===k.PanMode.Horizontal){if(a=
this.panSphericalMomentumEstimator.evaluateMomentum())return new d.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new e.PanPlanarMomentumController(this.view,a);return null};g.prototype.zoomSpherical=function(b){var c=this.beginRadius/b.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(b.radius,40),120);this.smoothScaling.update(c);p.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);p.navPointToScreenPoint(this.currentCamera,
b.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(b.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.panningSpherical=function(b){p.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);p.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.tmp2d,
this.tmp3d);p.applyPanSpherical(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d);this.panSphericalMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.screenPickPoint,this.tmp2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.rotateSpherical=function(c){b.vec3d.normalize(this.scenePickPoint,this.rotationAxis);var d=this.smoothRotation.value,
e=p.normalizeRotationDelta(c.angle-d),d=d+e;this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,40),120);this.smoothRotation.update(d);e=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(e,.001*c.timestamp);p.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,e);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};
g.prototype.panningPlanar=function(b){p.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(p.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*b.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginScreenPoint,this.tmp2d),this.constraintOptions.interactionDirection=
this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};g.prototype.zoomPlanar=function(b){var c=this.beginRadius/b.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(b.radius,40),120);this.smoothScaling.update(c);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*b.timestamp);p.applyZoomToPoint(this.currentCamera,this.beginScenePoint,
this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(b.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.rotatePlanar=function(c){b.vec3d.set(this.beginScenePoint,this.rotationAxis);var d=this.smoothRotation.value,e=c.angle-d,e=p.normalizeRotationDelta(e);this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,
40),120);this.smoothRotation.update(d+e);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*c.timestamp);p.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,d);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};return g}(l.InteractiveController);g.PinchAndPanController=r})},"esri/views/3d/input/util":function(){define(["require",
"exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a){this._gain=a}f.prototype.reset=function(a){this._value=a};Object.defineProperty(f.prototype,"gain",{set:function(a){this._gain=a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});f.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};
return f}();g.ExponentialFalloff=r})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/glMatrix","./MomentumController"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function c(c,d){c=b.call(this,c,4)||this;c.momentum=d;c.tmpPan=a.vec3d.create();return c}f(c,b);c.prototype.momentumStep=function(b,c){b=this.momentum.value(b);a.vec3d.scale(this.momentum.direction,
b,this.tmpPan);a.vec3d.subtract(c.eye,this.tmpPan);a.vec3d.subtract(c.center,this.tmpPan);c.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return c}(c.MomentumController);g.PanPlanarMomentumController=r})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(r,g,f,a,c,b){Object.defineProperty(g,
"__esModule",{value:!0});r=function(c){function e(a,e){e=c.call(this)||this;e.view=a;e.beginCamera=new b;e.elapsedTimeSec=0;e.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new b,interactionDirection:null};return e}f(e,c);Object.defineProperty(e.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera=
this.beginCamera;c.prototype.onControllerStart.call(this,a)};e.prototype.stepController=function(b,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=b;this.momentumStep(this.elapsedTimeSec,c);a.applyAll(this.view,c,this.constraintOptions)};return e}(c.AnimationController);g.MomentumController=r})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./MomentumController","../../utils/navigationUtils"],
function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});var b=[0,0,0];r=function(a){function e(b,c){b=a.call(this,b,4)||this;b.momentum=c;return b}f(e,a);e.prototype.momentumStep=function(a,e){a=this.momentum.value(a);c.applyRotation(e,b,this.momentum.axis,a)};return e}(a.MomentumController);g.PanSphericalMomentumController=r})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function e(b,e,f,l){b=c.call(this,b,2)||this;b.momentum=e;b.axis=a.vec3d.create();b.center=a.vec3d.create();a.vec3d.set(l,b.axis);a.vec3d.set(f,b.center);return b}f(e,c);e.prototype.momentumStep=function(a,c){a=this.momentum.value(a);b.applyRotation(c,this.center,this.axis,a)};return e}(c.MomentumController);g.RotationMomentumController=r})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function e(b,e,f){b=c.call(this,b,1)||this;b.momentum=e;b.zoomCenter=a.vec3d.create();a.vec3d.set(f,b.zoomCenter);b.constraintOptions.interactionDirection=a.vec3d.create();return b}f(e,c);e.prototype.momentumStep=function(c,e){a.vec3d.set(e.eye,this.constraintOptions.interactionDirection);c=this.momentum.valueDelta(0,c);b.applyZoomToPoint(e,this.zoomCenter,c,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=
a.vec3d.direction(this.constraintOptions.interactionDirection,e.eye)};return e}(c.MomentumController);g.ZoomPlanarMomentumController=r})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function d(a,
d,e,f,k){a=b.call(this,a,1)||this;a.momentum=d;a.screenCenter=c.vec2d.create();a.sceneCenter=c.vec3d.create();a.tmpSceneCenter=c.vec3d.create();a.tmpZoomAxis=c.vec3d.create();a.sphere={center:c.vec3d.create(),radius:0};c.vec2d.set(e,a.screenCenter);c.vec3d.set(f,a.sceneCenter);a.sphere.radius=k;return a}f(d,b);d.prototype.momentumStep=function(b,c){b=this.momentum.valueDelta(0,b);l.applyZoomOnSphere(this.sphere,c,b);this.constraintOptions.interactionType=1;a.applyAll(this.view,c,this.constraintOptions);
l.sphereOrSilhouettePointFromScreenPoint(this.sphere,c,this.screenCenter,this.tmpSceneCenter);b=l.rotationAndAxisFromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxis);l.applyRotation(c,this.sphere.center,this.tmpZoomAxis,b);this.constraintOptions.interactionType=4};return d}(b.MomentumController);g.ZoomSphericalMomentumController=r})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/glMatrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});var l=function(a){function b(b,c,d,e,k){b=a.call(this,b,c,d)||this;b.sceneVelocity=e;b.direction=k;return b}f(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return b}(b.Momentum);g.PanPlanarMomentum=l;r=function(){function b(b,e,f){void 0===b&&(b=300);void 0===e&&(e=12);void 0===f&&(f=.84);this.minimumInitialVelocity=b;this.stopVelocity=e;this.friction=f;this.time=
new c.FilteredFiniteDifference(.6);this.screen=[new c.FilteredFiniteDifference(.4),new c.FilteredFiniteDifference(.4)];this.scene=[new c.FilteredFiniteDifference(.6),new c.FilteredFiniteDifference(.6),new c.FilteredFiniteDifference(.6)];this.tmpDirection=a.vec3d.create()}b.prototype.add=function(a,b,c){this.time.hasLastValue&&.015>this.time.computeDelta(c)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(c))};
b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(b,
c,e){a.vec3d.set3(this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta,this.tmpDirection);var d=a.vec3d.length(this.tmpDirection);0<d&&a.vec3d.scale(this.tmpDirection,1/d);return new l(b,c,e,d/this.time.filteredDelta,this.tmpDirection)};return b}();g.PanPlanarMomentumEstimator=r})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a){this.gain=
a}f.prototype.update=function(a){if(this.hasLastValue){var c=this.computeDelta(a);this.updateDelta(c)}this.lastValue=a};f.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(f.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});f.prototype.computeDelta=function(a){return a-
this.lastValue};f.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return f}();g.FilteredFiniteDifference=r})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,b,f){this._initialVelocity=a;this._stopVelocity=b;this._friction=f;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,b){var c=this.value(a);return this.value(a+
b)-c};a.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var c=1-this.friction;return a*(Math.pow(c,b)-1)/Math.log(c)};return a}();g.Momentum=r})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/glMatrix ../../views/3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});
var d=function(a){function b(b,c,d,e,h){b=a.call(this,b,c,d)||this;b.angularVelocity=e;b.axis=h;return b}f(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity,b)};return b}(e.Momentum);g.PanSphericalMomentum=d;r=function(){function e(c,d,e){void 0===c&&(c=300);void 0===d&&(d=12);void 0===e&&(e=.84);this.minimumInitialVelocity=c;this.stopVelocity=d;this.friction=e;this.tmpAxis=a.vec3d.create();this.time=new b.FilteredFiniteDifference(.3);this.screen=
[new b.FilteredFiniteDifference(.4),new b.FilteredFiniteDifference(.4)];this.angle=new l.FilteredValue(.6);this.axis=a.vec3d.create();this.lastScene=a.vec3d.create()}e.prototype.add=function(b,d,e){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;var k=c.rotationAndAxisFromPoints(this.lastScene,d,this.tmpAxis);1E-5>a.vec3d.length2(this.tmpAxis)?k=0:a.vec3d.normalize(this.tmpAxis,this.axis);this.angle.update(k);a.vec3d.set(d,this.lastScene)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);
this.time.update(e)};e.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle.reset();this.time.reset()};e.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};e.prototype.createMomentum=function(a,b,c){return new d(a,b,
c,this.angle.filteredValue/this.time.filteredDelta,this.axis)};return e}();g.PanSphericalMomentumEstimator=r})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a){this.gain=a}f.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*a:a};f.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(f.prototype,
"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return f}();g.FilteredValue=r})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b,c,d,h){void 0===b&&(b=3);void 0===c&&(c=.01);void 0===d&&(d=.95);void 0===h&&(h=12);return a.call(this,b,c,d,h)||this}f(b,
a);b.prototype.add=function(b,c){if(this.value.hasLastValue){var d=this.value.lastValue;for(b-=d;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=d+b}a.prototype.add.call(this,b,c)};return b}(a.MomentumEstimator);g.RotationMomentumEstimator=r})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});
r=function(){function f(a,b,f,l){void 0===a&&(a=2.5);void 0===b&&(b=.01);void 0===f&&(f=.95);void 0===l&&(l=12);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=f;this.maxVelocity=l;this.value=new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}f.prototype.add=function(a,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(a);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(b);
this.value.update(a)};f.prototype.reset=function(){this.value.reset();this.time.reset()};f.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var b=this.value.filteredDelta/this.time.filteredDelta,b=a.clamp(b,-this.maxVelocity,this.maxVelocity);return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};f.prototype.createMomentum=function(a,c,f){return new b.Momentum(a,c,f)};return f}();g.MomentumEstimator=r})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){function b(b,c,e){return a.call(this,b,c,e)||this}f(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,c){var d=a.prototype.value.call(this,b);b=a.prototype.value.call(this,b+c);return Math.exp(b-d)};return b}(a.Momentum);g.ZoomMomentum=b;r=function(a){function c(b,
c,e,f){void 0===b&&(b=2.5);void 0===c&&(c=.01);void 0===e&&(e=.95);void 0===f&&(f=12);return a.call(this,b,c,e,f)||this}f(c,a);c.prototype.add=function(b,c){a.prototype.add.call(this,Math.log(b),c)};c.prototype.createMomentum=function(a,c,e){return new b(a,c,e)};return c}(c.MomentumEstimator);g.ZoomMomentumEstimator=r})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/glMatrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){Object.defineProperty(g,"__esModule",{value:!0});var m;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(m=g.PanMode||(g.PanMode={}));var u=b.vec3d.createFrom(0,0,1),x=16/180*Math.PI;r=function(l){function g(a,d){var e=l.call(this)||this;e.view=a;e.pickingHelper=d;e.rotationValueSmooth=new c.ExponentialFalloff(.05);e.scalingValueSmooth=new c.ExponentialFalloff(.05);e.planeHorizontal={normal:b.vec3d.create(),d:0};e.planeVertical={normal:b.vec3d.create(),
d:0};e.rotationMomentumEstimator=new k.RotationMomentumEstimator;e.panMomentumEstimator=new p.PanPlanarMomentumEstimator(300,12,.9);e.zoomMomentumEstimator=new q.ZoomMomentumEstimator;e.beginCenter=b.vec3d.create();e.tmpPoints=[];e.beginCenterScreen=b.vec2d.create();e.tmpCentroid3d=b.vec3d.create();e.tmpCentroid2d=b.vec2d.create();e.tmp2d=b.vec2d.create();e.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new t,interactionDirection:null};return e}f(g,l);
g.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();n.navPointToScreenPoint(this.beginCamera,a.center,this.beginCenterScreen);this.planeHorizontal.d=0;b.vec3d.set(u,this.planeHorizontal.normal);var c=b.vec3d.create();this.pickingHelper.pickPointInScreen(this.beginCenterScreen,c)||this.pickingHelper.pickFreePointInScreen(this.beginCenterScreen,c);var d=b.vec3d.create();
b.vec3d.negate(this.beginCamera.viewForward,d);var e=b.vec3d.create();b.vec3d.set(u,e);var f=b.vec3d.dot(d,e);this.panMode=Math.asin(0>f?-f:f)>=x?m.Horizontal:m.Vertical;n.setPlaneD(c,this.planeHorizontal);0>b.vec3d.dot(this.planeHorizontal.normal,this.beginCamera.eye)+this.planeHorizontal.d&&(b.vec3d.negate(this.planeHorizontal.normal),this.planeHorizontal.d*=-1);this.panMode===m.Vertical?(b.vec3d.scale(e,f),b.vec3d.subtract(d,e,this.planeVertical.normal),b.vec3d.normalize(this.planeVertical.normal),
n.setPlaneD(c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);n.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};g.prototype.update=function(b){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<b.pointers.size,d=this.panMode===m.Horizontal?this.planeHorizontal:this.planeVertical,
e=this.beginCenter;if(c){var f=this.beginRadius/b.radius,k=.001875*Math.min(Math.max(b.radius,40),120);this.scalingValueSmooth.gain=k;this.scalingValueSmooth.update(f);n.applyZoomToPoint(this.currentCamera,e,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(Math.abs(b.radius-this.beginRadius));
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(b.pointers,d,this.currentCamera,this.tmpPoints);n.centroid(this.tmpPoints,this.tmpCentroid3d);n.navPointToScreenPoint(this.currentCamera,b.center,this.tmpCentroid2d);n.applyPanPlanar(this.currentCamera,e,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal.normal,d=this.rotationValueSmooth.value,f=n.normalizeRotationDelta(b.angle-d),k=.00125*Math.min(Math.max(b.radius,40),120),this.rotationValueSmooth.gain=k,this.rotationValueSmooth.update(d+f),k=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(k,.001*b.timestamp),n.applyRotation(this.currentCamera,e,c,k),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
a.pixelDistanceToInteractionFactor(Math.abs(b.radius*k)),a.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};g.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new h.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new d.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal.normal):
(a=this.panMomentumEstimator.evaluateMomentum())?new e.PanPlanarMomentumController(this.view,a):null};g.prototype.computePlanePoints=function(a,c,d,e){e.length=a.size;var f=this.tmp2d,k=0;a.forEach(function(a){n.navPointToScreenPoint(d,a,f);void 0===e[k]&&(e[k]=b.vec3d.create());n.intersectPlaneFromScreenPoint(c,d,f,e[k]);k+=1});return e};return g}(l.InteractiveController);g.PinchAndPanController=r})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports",
"../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b,c){var d=a.call(this,!0)||this;d.view=b;d.registerIncoming("pointer-down",c,function(a){return d.view.state.stopActiveCameraController()});return d}f(b,a);return b}(a.InputHandler);g.PointerDownCancelAnimation=r})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b,c,d){d=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",c,d)||this;d.view=b;d.key=c;return d}f(b,a);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(a.SingleKey);g.SingleKeyResetHeading=r})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(r,
g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b,c,d){var e=a.call(this,!0)||this;e.key=c;e.registerIncoming("key-down",d,function(a){return e._handleKeyDown(a)});return e}f(b,a);b.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return b}(a.InputHandler);g.SingleKey=r})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b,c,d){d=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",c,d)||this;d.view=b;d.key=c;return d}f(b,a);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(a.SingleKey);g.SingleKeyResetTilt=r})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../state/helpers/PickingHelper ../../../input/InputHandler".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function e(a,e){void 0===e&&(e=!1);var d=b.call(this,!0)||this;d.view=a;d.invert=e;d.pickingHelper=new c.PickingHelper(a);d.registerIncoming("vertical-two-finger-drag",function(a){return d.handleTwoFinger(a)});return d}f(e,b);e.prototype.handleTwoFinger=function(b){var c=[0,-b.data.delta*(this.invert?-1:1)];switch(b.data.action){case "begin":this.cameraController=new a.RotateController(this.view,this.pickingHelper,
"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController.update(c);break;case "end":this.cameraController.end(),this.cameraController=null}};return e}(b.InputHandler);g.TwoFingerTilt=r})},"esri/views/input/BrowserEventSource":function(){define(["require","exports","dojo/sniff","../../core/libs/pep/pep","./keys"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});var b=f("trident"),l=f("edge"),
e=f("chrome"),d=f("ff"),h=f("safari");r=function(){function f(b){this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=b;a.applyLocal(b);b.getAttribute("tabindex")||b.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=b.style.touchAction;b.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault)}f.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",
this._preventAltKeyDefault)};Object.defineProperty(f.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(n[c],this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&n[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(n[a],c);b._active[a]=c}})},
enumerable:!0,configurable:!0});f.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};f.prototype._updateNormalizedPointerLikeEvent=function(a,b){var c=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(c.left);b.y=a.clientY-Math.round(c.top);return b};f.prototype._handleKey=function(a,b){var d=c.eventKey(b);
d&&"key-up"===a&&this._keyDownState.delete(d);b={native:b,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};f.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});this._callback(a,b)};f.prototype._handlePointerPreventDefault=function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,
button:b.button,buttons:b.buttons});b.preventDefault();this._callback(a,c)};f.prototype._handleMouseWheel=function(a,c){c.preventDefault();var f=c.deltaY;switch(c.deltaMode){case 0:if(b||l)f=f/document.documentElement.clientHeight*600;break;case 1:f*=30;break;case 2:f*=900}b||l?f*=.7:e||h?f*=.6:d&&(f*=1.375);var k=Math.abs(f);100<k&&(f=f/k*200/(1+Math.exp(-.02*(k-100))));c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,deltaY:f});this._callback(a,c)};f.prototype._handlePointerCaptureLost=
function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};f.prototype._handleDefault=function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};f.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};return f}();g.BrowserEventSource=r;var n={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture",
"context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave"}})},"esri/core/libs/pep/pep":function(){define(function(){function r(a,b){b=b||Object.create(null);var c=document.createEvent("Event");c.initEvent(a,b.bubbles||!1,b.cancelable||!1);a=2;for(var d;a<h.length;a++)d=h[a],c[d]=b[d]||n[a];c.buttons=b.buttons||0;a=0;a=b.pressure?b.pressure:c.buttons?.5:0;c.x=c.clientX;c.y=c.clientY;c.pointerId=b.pointerId||0;c.width=b.width||0;c.height=b.height||0;c.pressure=a;c.tiltX=
b.tiltX||0;c.tiltY=b.tiltY||0;c.pointerType=b.pointerType||"";c.hwTimestamp=b.hwTimestamp||0;c.isPrimary=b.isPrimary||!1;return c}function g(){this.array=[];this.size=0}function f(a,b,c,d){this.addCallback=a.bind(d);this.removeCallback=b.bind(d);this.changedCallback=c.bind(d);B&&(this.observer=new B(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+c(a)}function c(a){return'[touch-action\x3d"'+a+'"]'}function b(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}
function l(){if(F){E.forEach(function(d){String(d)===d?(H+=c(d)+b(d)+"\n",L&&(H+=a(d)+b(d)+"\n")):(H+=d.selectors.map(c)+b(d.rule)+"\n",L&&(H+=d.selectors.map(a)+b(d.rule)+"\n"))});var d=document.createElement("style");d.textContent=H;document.head.appendChild(d)}}function e(a){if(!u.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function d(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var h="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),
n=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],t=window.Map&&window.Map.prototype.forEach?Map:g;g.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var p=
"bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),k=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],q={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},m="undefined"!==typeof SVGElementInstance,u={pointermap:new t,eventMap:Object.create(null),
captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b.events;c&&(c.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,
a)},contains:function(a,b){try{return a.contains(b)}catch(ha){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",
a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&this.eventMap[b])&&b(a);a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,
this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new r(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},fireEvent:function(a,b){a=this.makeEvent(a,b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),c,d=0;d<p.length;d++)c=p[d],b[c]=a[c]||k[d],m&&("target"===c||"relatedTarget"===c)&&b[c]instanceof
SVGElementInstance&&(b[c]=b[c].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in q))return b},propagate:function(a,b,c){for(var d=a.target,e=[];!d.contains(a.relatedTarget)&&d!==document;)e.push(d),d=d.parentNode;c&&e.reverse();e.forEach(function(c){a.target=c;b.call(this,a)},this)},setCapture:function(a,b){this.captureInfo[a]&&this.releaseCapture(a);
this.captureInfo[a]=b;var c=new r("gotpointercapture");c.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)},releaseCapture:function(a){var b=this.captureInfo[a];if(b){var c=new r("lostpointercapture");c.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",
this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};u.boundHandler=u.eventHandler.bind(u);var x={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=
a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,c){if(a){var d=a.elementFromPoint(b,c),e;for(e=this.targetingShadow(d);e;){if(a=e.elementFromPoint(b,c))return d=this.targetingShadow(a),this.searchRoot(d,b,c)||a;e=this.olderShadow(e)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==
Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,c=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,c)||(a=document);return this.searchRoot(a,b,c)}},v=Array.prototype.forEach.call.bind(Array.prototype.forEach),y=Array.prototype.map.call.bind(Array.prototype.map),A=Array.prototype.slice.call.bind(Array.prototype.slice),C=Array.prototype.filter.call.bind(Array.prototype.filter),B=window.MutationObserver||window.WebKitMutationObserver,D={subtree:!0,childList:!0,
attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};f.prototype={watchSubtree:function(a){this.observer&&x.canTarget(a)&&this.observer.observe(a,D)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){v(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},
addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(A(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=y(a,this.findElements,this);b.push(C(a,this.isElement));return b.reduce(this.concatLists,[])},
mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],H="",F=window.PointerEvent||window.MSPointerEvent,L=!window.ShadowDOMPolyfill&&
document.head.createShadowRoot,G=u.pointermap,P=[1,4,2,8,16],J=!1;try{J=1===(new MouseEvent("test",{buttons:1})).buttons}catch(ba){}var M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){u.listen(a,this.events)},unregister:function(a){u.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,e=b.length,f;d<e&&(f=b[d]);d++){var k=Math.abs(a-f.y);
if(25>=Math.abs(c-f.x)&&25>=k)return!0}},prepareEvent:function(a){var b=u.cloneEvent(a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,b){var c=G.get(this.POINTER_ID);a.buttons=0!==b.which&&c?c.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=G.get(this.POINTER_ID),c=this.prepareEvent(a);J||(c.buttons=P[c.button],
b&&(c.buttons|=b.buttons),a.buttons=c.buttons);G.set(this.POINTER_ID,a);b&&0!==b.buttons?u.move(c):u.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);J||this.prepareButtonsForMove(b,a);b.button=-1;G.set(this.POINTER_ID,a);u.move(b)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=G.get(this.POINTER_ID),c=this.prepareEvent(a);if(!J){var d=P[c.button];c.buttons=b?b.buttons&~d:0;a.buttons=c.buttons}G.set(this.POINTER_ID,a);c.buttons&=
~P[c.button];0===c.buttons?u.up(c):u.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);J||this.prepareButtonsForMove(b,a);b.button=-1;G.set(this.POINTER_ID,a);u.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);J||this.prepareButtonsForMove(b,a);b.button=-1;u.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);u.cancel(a);this.deactivateMouse()},deactivateMouse:function(){G.delete(this.POINTER_ID)}},
O=u.captureInfo,aa=x.findTarget.bind(x),V=x.allShadows.bind(x),N=u.pointermap,S,W={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){S.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);c&&(a._scrollType=c,u.listen(a,this.events),V(a).forEach(function(a){a._scrollType=c;u.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;u.unlisten(a,this.events);V(a).forEach(function(a){a._scrollType=
void 0;u.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);b=this.touchActionToScrollType(b);d&&b?(a._scrollType=d,V(a).forEach(function(a){a._scrollType=d},this)):b?this.elementRemoved(a):d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===
b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===N.size||1===N.size&&N.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=
function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,c=u.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=O[d]||aa(c);c.bubbles=!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(b.type);c.width=a.radiusX||a.webkitRadiusX||
0;c.height=a.radiusY||a.webkitRadiusY||0;c.pressure=a.force||a.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(a);c.pointerType=this.POINTER_TYPE;c.altKey=b.altKey;c.ctrlKey=b.ctrlKey;c.metaKey=b.metaKey;c.shiftKey=b.shiftKey;var e=this;c.preventDefault=function(){e.scrolling=!1;e.firstXY=null;b.preventDefault()};return c},processTouches:function(a,b){var c=a.changedTouches;this.currentTouchEvent=a;a=0;for(var d;a<c.length;a++)d=c[a],b.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var b;
b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var c="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+c]-this.firstXY[c])}this.firstXY=null;return b}},findTouch:function(a,b){for(var c=0,d=a.length,e;c<d&&(e=a[c]);c++)if(e.identifier===b)return!0},vacuumTouches:function(a){var b=a.touches;if(N.size>=b.length){var c=[];N.forEach(function(a,d){1===d||this.findTouch(b,d-2)||c.push(a.out)},this);c.forEach(this.cancelOut,
this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){N.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});u.enterOver(a);u.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=N.get(a.pointerId);
if(b){var c=b.out,d=b.outTarget;u.move(a);c&&d!==a.target&&(c.relatedTarget=a.target,a.relatedTarget=d,c.target=d,a.target?(u.leaveOut(c),u.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(u.up(a),u.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){u.cancel(a);u.leaveOut(a);
this.cleanUpPointer(a)},cleanUpPointer:function(a){N.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=M.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};S=new f(W.elementAdded,W.elementRemoved,W.elementChanged,W);var X=u.pointermap,Q=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,I={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),
register:function(a){u.listen(a,this.events)},unregister:function(a){u.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;Q&&(b=u.cloneEvent(a),b.pointerType=this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){X.delete(a)},MSPointerDown:function(a){X.set(a.pointerId,a);a=this.prepareEvent(a);u.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);u.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);u.up(b);this.cleanup(a.pointerId)},
MSPointerOut:function(a){a=this.prepareEvent(a);u.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);u.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);u.cancel(b);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=u.makeEvent("lostpointercapture",a);u.dispatchEvent(a)},MSGotPointerCapture:function(a){a=u.makeEvent("gotpointercapture",a);u.dispatchEvent(a)}},K,T;window.navigator.msPointerEnabled?(K=function(a){e(a);d(this);0!==u.pointermap.get(a).buttons&&
this.msSetPointerCapture(a)},T=function(a){e(a);this.msReleasePointerCapture(a)}):(K=function(a){e(a);d(this);0!==u.pointermap.get(a).buttons&&u.setCapture(a,this)},T=function(a){e(a);u.releaseCapture(a,this)});var Y=window.PointerEvent||window.MSPointerEvent;return{dispatcher:u,Installer:f,PointerEvent:r,PointerMap:t,targetFinding:x,applyGlobal:function(){l();window.PointerEvent||(window.PointerEvent=r,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),u.registerSource("ms",I)):(u.registerSource("mouse",M),void 0!==window.ontouchstart&&u.registerSource("touch",W)),u.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:K},releasePointerCapture:{value:T}})},applyLocal:function(a){Y||(window.PointerEvent||(window.navigator.msPointerEnabled?u.registerSource("ms",I):(u.registerSource("mouse",M),void 0!==window.ontouchstart&&u.registerSource("touch",
W)),u.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=K.bind(a),a.releasePointerCapture=T.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/sniff"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.primaryKey=f("mac")?"Meta":"Ctrl";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",
37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(r=48;58>r;r++)a[r]=String.fromCharCode(r);for(r=1;25>r;r++)a[111+r]="F"+r;for(r=65;91>r;r++)a[r]=[String.fromCharCode(r+32),String.fromCharCode(r)];var c={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};g.eventKey=function(b){if(void 0!==b.key)return c[b.key]||b.key;var f=a[b.keyCode];return Array.isArray(f)?b.shiftKey?f[1]:f[0]:f};g.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},
"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),function(r,g,f,a,c,b,l,e,d,h,n){Object.defineProperty(g,"__esModule",{value:!0});var t=b.getLogger("esri.views.input.InputManager");r=function(b){function c(a,c){a=b.call(this)||this;a._pointerCaptures=new Map;
a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=d.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}f(c,b);c.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=h.defaults.map(function(a){return new a}));return{}};c.prototype.destroy=function(){for(var a=
0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a])};c.prototype.installHandlers=function(a,b){var c=this;if(this._nameToGroup[a])t.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)t.error("Can't register a group of zero handlers");else{var d={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=d;a=function(a){var b=
d.handlers[a];e._handlers.push(b);b.handler.onInstall({updateDependencies:function(){c.updateDependencies()},emit:function(a,d,e,f){c._emitInputEvent(b.priorityIndex,a,d,e,f)},setPointerCapture:function(a,e){c._setPointerCapture(d,b,a,e)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=a}})};var e=this;for(b=d.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};c.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=
!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):t.error("There is no InputHandler group registered under the name `"+a+"`")};c.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};c.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var c=this._handlers.length-1;0<=c;c--){var e=this._handlers[c];e.priorityIndex=
c;this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(c=this._handlersPriority.length-1;0<=c;c--){e=this._handlersPriority[c];e.priorityIndex=c;var f=e.handler.hasSideEffects;if(!f)for(var k=0,h=e.handler.outgoingEventTypes;k<h.length;k++)if(a.has(h[k])){f=!0;break}if(f)for(k=0,h=e.handler.incomingEventMatches;k<h.length;k++){var l=h[k];a.add(l.eventType);for(var q=0,l=l.keyModifiers;q<l.length;q++){var n=l[q];d.isSystemModifier(n)||b.add(n)}}e.active=
f}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};c.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};c.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,
b);this._emitInputEventFromSource(a,b,b.native.timestamp)};c.prototype._updateKeyModifiers=function(a,b){var c=this;if(b){var d=!1,e=function(){if(!d){var a=new Set;c._activeKeyModifiers.forEach(function(b){a.add(b)});c._activeKeyModifiers=a;d=!0}},f=function(a,b){b&&!c._activeKeyModifiers.has(a)?(e(),c._activeKeyModifiers.add(a)):!b&&c._activeKeyModifiers.has(a)&&(e(),c._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var k=b.key;this._keyModifiers.has(k)&&f(k,"key-down"===a)}a=b.native;
f("Alt",!(!a||!a.altKey));f("Ctrl",!(!a||!a.ctrlKey));f("Shift",!(!a||!a.shiftKey));f("Meta",!(!a||!a.metaKey));f("Primary",this._activeKeyModifiers.has(this.primaryKey))}};c.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new n.LatestPointerType(function(b){return a._setLatestPointerType(b)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};c.prototype._setPointerCapture=
function(a,b,c,d){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(c.pointerId)||new Set;this._pointerCaptures.set(c.pointerId,b);d?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(c,!1)))};c.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};
c.prototype._emitInputEventFromSource=function(a,b,c){this._emitInputEvent(0,a,b,c)};c.prototype._emitInputEvent=function(a,b,c,d,e){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:l();b=new p(b,c,d,e||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):this._doNewPropagation(a,b)};c.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,
timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var c=[];a.addedEvents=[];for(var d=0;d<b.length;d++){var e=b[d];a.currentHandler.active&&a.currentHandler.eventCallback(e);e.shouldStopPropagation()||c.push(e)}a.events=c.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};c.prototype._compareHandlerPriority=
function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var c=0,d=a.handler.incomingEventMatches;c<d.length;c++)for(var e=d[c],f=function(a){if(e.eventType!==a.eventType)return"continue";var b=e.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});if(b.length===e.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:e.keyModifiers.length>a.keyModifiers.length?-1:1}},k=0,h=b.handler.incomingEventMatches;k<h.length;k++){var l=
f(h[k]);if("object"===typeof l)return l.value}return a.priorityIndex>b.priorityIndex?-1:1};c.prototype._sortHandlersPriority=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=0;e<b.length&&0<=this._compareHandlerPriority(d,b[e]);)e++;b.splice(e,0,d)}return b};a([e.property({readOnly:!0})],c.prototype,"latestPointerType",void 0);return c=a([e.subclass("esri.views.input.InputManager")],c)}(e.declared(c));g.InputManager=r;var p=function(){function a(a,b,c,d){this.type=a;this.data=b;this.timestamp=
c;this.modifiers=d;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});g.defaults=[a.PointerClickHoldAndDrag,
c.SingleAndDoubleClick,f.Drag,b.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(r,g,f,a,c){function b(a){var b=[];a.forEach(function(a){b.push(a.event)});return c.fitCircleLSQ(b)}function l(a){var c=b(a),e=0;a.forEach(function(a){for(var b=d(a,c),b=b-a.lastAngle;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=a.lastAngle+b;a.lastAngle=b;e+=b-a.initialAngle});
e/=a.size||1;return{angle:e,radius:c.radius,center:c.center}}function e(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});return b}function d(a,b){a=a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function c(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",
b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));return b}f(c,a);c.prototype.createPayload=function(a,b,c,d){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:d,pointers:e(this.activePointerMap),pointer:b,angle:c.angle,radius:c.radius,center:c.center}};c.prototype.addPointer=function(a){var c=a.native.pointerId,e=l(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};
this.activePointerMap.set(c,a);c=d(a,b(this.activePointerMap));a.initialAngle=c;a.lastAngle=c;this.updatePointerAngles(e)};c.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};c.prototype.removePointer=function(a){var b=l(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(b)};c.prototype.updatePointerAngles=function(a){var b=l(this.activePointerMap);this.activePointerMap.forEach(function(c){c.initialAngle=
d(c,b)-a;c.lastAngle=d(c,b)-a})};c.prototype.emitEvent=function(a,b,c){var d=l(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};c.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,c=a.timestamp;this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,c),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};
c.prototype.handlePointerDrag=function(a){var b=a.data,c=b.currentEvent,d=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),this.emitEvent("update",c,d)):(this.addPointer(c),this.emitEvent("added",c,d)):(this.updatePointer(c),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",c,d))}};return c}(a.InputHandler);
g.Drag=r;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(g.Button||(g.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.manhattanDistance=function(f,a){return Math.abs(a.x-f.x)+Math.abs(a.y-f.y)};g.euclideanDistance=function(f,a){var c=a.x-f.x;f=a.y-f.y;return Math.sqrt(c*c+f*f)};g.fitCircleLSQ=
function(f,a){a?(a.radius=0,a.center.x=0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===f.length)return a;if(1===f.length)return a.center.x=f[0].x,a.center.y=f[0].y,a;if(2===f.length){var c=f[0];f=f[1];var b=[f.x-c.x,f.y-c.y],l=b[0],b=b[1];a.radius=Math.sqrt(l*l+b*b)/2;a.center.x=(c.x+f.x)/2;a.center.y=(c.y+f.y)/2;return a}for(var e=0,d=0,h=0;h<f.length;h++)e+=f[h].x,d+=f[h].y;for(var e=e/f.length,d=d/f.length,n=f.map(function(a){return a.x-e}),t=f.map(function(a){return a.y-d}),p=c=a=0,k=0,q=
l=0,h=b=0;h<n.length;h++){var m=n[h],u=t[h],g=m*m,v=u*u;a+=g;c+=v;p+=m*u;k+=g*m;l+=v*u;q+=m*v;b+=u*g}h=a;n=p;t=c;k=.5*(k+q);l=.5*(l+b);b=h*t-p*n;q=(k*t-l*n)/b;l=(h*l-p*k)/b;return{radius:Math.sqrt(q*q+l*l+(a+c)/f.length),center:{x:q+e,y:l+d}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});g.DefaultParameters=
{maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};r=function(a){function b(b,c,f,l){void 0===b&&(b=g.DefaultParameters.maximumClickDelay);void 0===c&&(c=g.DefaultParameters.movementUntilMouseDrag);void 0===f&&(f=g.DefaultParameters.movementUntilTouchDrag);void 0===l&&(l=g.DefaultParameters.holdDelay);var d=a.call(this,!1)||this;d.maximumClickDelay=b;d.movementUntilMouseDrag=c;d.movementUntilTouchDrag=f;d.holdDelay=l;d._pointerState=new Map;d._pointerDrag=d.registerOutgoing("pointer-drag");
d._immediateClick=d.registerOutgoing("immediate-click");d._pointerHold=d.registerOutgoing("hold");d.registerIncoming("pointer-down",d._handlePointerDown.bind(d));d.registerIncoming("pointer-up",d._handlePointerUpOrLost.bind(d));d.registerIncoming("pointer-capture-lost",d._handlePointerUpOrLost.bind(d));d._moveHandle=d.registerIncoming("pointer-move",d._handlePointerMove.bind(d));d._moveHandle.pause();return d}f(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.holdTimeout&&
(clearTimeout(a.holdTimeout),a.holdTimeout=0)});a.prototype.onUninstall.call(this)};b.prototype._handlePointerDown=function(a){var b=this,c=a.data,e=c.native.pointerId,f=0;0===this._pointerState.size&&(f=setTimeout(function(){var c=b._pointerState.get(e);c&&(c.isDragging||(b._pointerHold.emit(c.previousEvent,void 0,a.modifiers),c.holdEmitted=!0),c.holdTimeout=0)},this.holdDelay));f={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:f,modifiers:new Set};
this._pointerState.set(e,f);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};b.prototype._createPointerDragData=function(a,b,c){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,currentEvent:c}};b.prototype._handlePointerMove=function(a){var b=a.data,e=this._pointerState.get(b.native.pointerId);e&&(e.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",e,b),void 0,e.modifiers):c.euclideanDistance(b,
e.startEvent)>("touch"===b.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(a),e.previousEvent=b)};b.prototype.startDragging=function(a){var b=this,c=a.data,e=c.native.pointerId;this._pointerState.forEach(function(d){0!==d.holdTimeout&&(clearTimeout(d.holdTimeout),d.holdTimeout=0);d.isDragging||(d.modifiers=a.modifiers,d.isDragging=!0,e===d.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",d,c)):b._pointerDrag.emit(b._createPointerDragData("start",
d,d.previousEvent),a.timestamp))})};b.prototype._handlePointerUpOrLost=function(a){var b=a.data,c=b.native.pointerId,e=this._pointerState.get(c);e&&(0!==e.holdTimeout&&clearTimeout(e.holdTimeout),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",e,b),void 0,e.modifiers):e.downButton===b.native.button&&a.timestamp-e.startTimestamp<=this.maximumClickDelay&&!e.holdEmitted&&this._immediateClick.emit(b),this._pointerState.delete(c),this.stopCapturingPointer(b.native),0===this._pointerState.size&&
this._moveHandle.pause())};return b}(a.InputHandler);g.PointerClickHoldAndDrag=r})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});g.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};r=function(a){function b(b,c,f,l){void 0===b&&(b=
g.DefaultParameters.maximumDoubleClickDelay);void 0===c&&(c=g.DefaultParameters.maximumDoubleClickDistance);void 0===f&&(f=g.DefaultParameters.maximumDoubleTouchDelay);void 0===l&&(l=g.DefaultParameters.maximumDoubleTouchDistance);var d=a.call(this,!1)||this;d.maximumDoubleClickDelay=b;d.maximumDoubleClickDistance=c;d.maximumDoubleTouchDelay=f;d.maximumDoubleTouchDistance=l;d._pointerState=new Map;d._click=d.registerOutgoing("click");d._doubleClick=d.registerOutgoing("double-click");d.registerIncoming("immediate-click",
d._handleImmediateClick.bind(d));return d}f(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.doubleClickTimeout&&(clearTimeout(a.doubleClickTimeout),a.doubleClickTimeout=0)})};b.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};b.prototype._handleImmediateClick=function(a){var b=a.data,e=this._pointerId(b),f=this._pointerState.get(e);if(f){clearTimeout(f.doubleClickTimeout);f.doubleClickTimeout=
0;var l="touch"===b.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;c.manhattanDistance(f.event.data,b)>l?(this._doubleClickTimeoutExceeded(e),this._startClick(a)):(this._doubleClick.emit(b,void 0,f.event.modifiers),this._pointerState.delete(e))}else this._startClick(a)};b.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},"touch"===
a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)})};b.prototype._doubleClickTimeoutExceeded=function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimeout=0;this._pointerState.delete(a)};return b}(a.InputHandler);g.SingleAndDoubleClick=r})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],
function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(b){function c(c,d){void 0===c&&(c=20);void 0===d&&(d=40);var e=b.call(this,!1)||this;e._threshold=c;e._maxDelta=d;e.state="ready";e.emittedArtificalEnd2=!1;e._vertical=e.registerOutgoing("vertical-two-finger-drag");e._artificalDrag=e.registerOutgoing("drag");e.dragEventSeparator=new a.DragEventSeparator({start:function(a,b){return e.observeStart(a,b)},update:function(a,b,c){return e.observeUpdate(a,b,c)},end:function(a,
b){return e.observeEnd(a,b)}});e.registerIncoming("drag",function(a){return e.dragEventSeparator.handle(a)});return e}f(c,b);Object.defineProperty(c.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});c.prototype.observeStart=function(a,b){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,
pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),b.stopPropagation());this.state=2===a?"ready":"failed"};c.prototype.observeUpdate=function(a,b,c){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,c.data)?this.checkVerticalThresholdReached(b.data,c.data)&&(this.state="active",this.emittedArtificalEnd2=
!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};c.prototype.observeEnd=function(a,b){"active"===this.state&&
(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",b.stopPropagation())};c.prototype.checkMovementWithinLimits=function(a,b){var c=-Infinity,d=Infinity,e=-Infinity,f=Infinity;b.pointers.forEach(function(a){c=Math.max(c,a.x);d=Math.min(d,a.x);e=Math.max(e,a.y);f=Math.min(f,a.y)});var k=-Infinity,l=Infinity,m=-Infinity,u=Infinity;a.pointers.forEach(function(a){k=Math.max(k,a.x);l=Math.min(l,a.x);m=Math.max(m,a.y);u=Math.min(u,a.y)});return Math.abs(a.center.x-
b.center.x)<this._threshold&&Math.abs(k-l-(c-d))<=this._maxDelta&&Math.abs(m-u-(e-f))<=this._maxDelta};c.prototype.checkVerticalThresholdReached=function(a,b){var c=Math.abs(a.center.y-b.center.y);a.pointers.forEach(function(a,d){d=b.pointers.get(d);c=Math.min(c,Math.abs(a.y-d.y))});return c>=this._threshold};return c}(c.InputHandler);g.VerticalTwoFingerDrag=r})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});
r=function(){function f(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}f.prototype.handle=function(a){var c=a.data,b=c.pointers.size;switch(c.action){case "start":this.currentCount=b;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);
break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};f.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,a,this.startEvent)};f.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};f.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);
this.startEvent=null};return f}();g.DragEventSeparator=r})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b){var c=a.call(this,!0)||this;c._onChange=b;c._value="mouse";c.registerIncoming("pointer-down",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler=c.registerIncoming("pointer-move",
function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler.pause();return c}f(b,a);b.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():this._moveHandler.pause(),this._value=a,this._onChange(a))};return b}(a.InputHandler);g.LatestPointerType=r})},"esri/views/input/ViewEvents":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry/ScreenPoint ../3d/support/mathUtils ./InputHandler".split(" "),function(r,
g,f,a,c,b){function l(a){return!!d[a]}function e(a){for(var b=0;b<a.length;b++)if(!l(a[b]))return!1;return!0}Object.defineProperty(g,"__esModule",{value:!0});var d={click:!0,"double-click":!0,"immediate-click":!0,hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"pointer-drag":!0,"mouse-wheel":!0,"pointer-enter":!0,"pointer-leave":!0},h;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(h||(h={}));r=function(){function a(a){this.handlers=
new Map;this.counter=0;this.handlerCounts=new Map;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,c){return b.inputManager.installHandlers(c,[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,c){return a.inputManager.uninstallHandlers(c)});this.inputManager=null};a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=
null};a.prototype.register=function(a,b,c){var d=this,f=Array.isArray(a)?a:a.split(",");if(!e(f))return f.some(l)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;a=Array.isArray(b)?b:[];c=Array.isArray(b)?c:b;var k=this.createUniqueGroupName();b=new n(this.view,f,a,c);this.handlers.set(k,b);for(c=0;c<f.length;c++){a=f[c];var h=this.handlerCounts.get(a)||0;this.handlerCounts.set(a,h+1)}this.inputManager&&this.inputManager.installHandlers(k,
[b]);return{remove:function(){return d.removeHandler(k,f)}}};a.prototype.hasHandler=function(a){return!!this.handlerCounts.get(a)};a.prototype.removeHandler=function(a,b){if(this.handlers.has(a)){this.handlers.delete(a);for(var c=0;c<b.length;c++){var d=b[c],e=this.handlerCounts.get(d);void 0===e?console.error("Trying to remove handler for event that has no handlers registered: ",d):1===e?this.handlerCounts.delete(d):this.handlerCounts.set(d,e-1)}}this.inputManager&&this.inputManager.uninstallHandlers(a)};
a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();g.ViewEvents=r;var n=function(b){function d(a,c,d,e){var f=b.call(this,!0)||this;f.view=a;for(a=0;a<c.length;a++)switch(c[a]){case "click":f.registerIncoming("click",d,function(a){return e(f.wrapClick(a))});break;case "double-click":f.registerIncoming("double-click",d,function(a){return e(f.wrapDoubleClick(a))});break;case "immediate-click":f.registerIncoming("immediate-click",d,function(a){return e(f.wrapImmediateClick(a))});
break;case "hold":f.registerIncoming("hold",d,function(a){return e(f.wrapHold(a))});break;case "drag":f.registerIncoming("drag",d,function(a){return e(f.wrapDrag(a))});break;case "key-down":f.registerIncoming("key-down",d,function(a){return e(f.wrapKeyDown(a))});break;case "key-up":f.registerIncoming("key-up",d,function(a){return e(f.wrapKeyUp(a))});break;case "pointer-down":f.registerIncoming("pointer-down",d,function(a){return e(f.wrapPointer(a,"pointer-down"))});break;case "pointer-move":f.registerIncoming("pointer-move",
d,function(a){return e(f.wrapPointer(a,"pointer-move"))});break;case "pointer-up":f.registerIncoming("pointer-up",d,function(a){return e(f.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":f.registerIncoming("pointer-drag",d,function(a){return e(f.wrapPointerDrag(a))});break;case "mouse-wheel":f.registerIncoming("mouse-wheel",d,function(a){return e(f.wrapMouseWheel(a))});break;case "pointer-enter":f.registerIncoming("pointer-enter",d,function(a){return e(f.wrapPointer(a,"pointer-enter"))});
break;case "pointer-leave":f.registerIncoming("pointer-leave",d,function(a){return e(f.wrapPointer(a,"pointer-leave"))})}return f}f(d,b);d.prototype.wrapClick=function(b){var c=b.data,d=c.x,e=c.y;return{type:"click",pointerType:c.pointerType,button:c.button,buttons:c.buttons,x:d,y:e,native:c.native,timestamp:b.timestamp,screenPoint:new a(d,e),mapPoint:this.view.toMap(d,e),stopPropagation:function(){return b.stopPropagation()}}};d.prototype.wrapDoubleClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"double-click",
pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapImmediateClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"immediate-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapHold=
function(a){var b=a.data,c=b.x,d=b.y;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapDrag=function(a){var b=a.data,d=b.center,e=d.x,d=d.y,f=b.action,k=b.pointerType,h=b.button;"start"===f&&(this.latestDragStart=b);var l=b.pointer.native,n=a.timestamp;return{type:"drag",action:f,x:e,y:d,origin:{x:this.latestDragStart.center.x,
y:this.latestDragStart.center.y},pointerType:k,button:h,buttons:b.buttons,radius:b.radius,angle:c.rad2deg(b.angle),native:l,timestamp:n,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapKeyUp=function(a){var b=a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,
stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapPointer=function(a,b){var c=a.data,d=c.native;return{type:b,x:c.x,y:c.y,pointerId:d.pointerId,pointerType:d.pointerType,button:c.button,buttons:c.buttons,native:d,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent,c=a.data.startEvent.native;return{type:"pointer-drag",x:b.x,y:b.y,pointerId:c.pointerId,pointerType:c.pointerType,button:a.data.startEvent.button,
buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};return d}(b.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports",
"../../../core/tsSupport/extendsHelper","../InputHandler"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(){var b=a.call(this,!0)||this;b.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return b}f(b,a);return b}(a.InputHandler);g.PreventContextMenu=r;g.default=r})},"esri/views/3d/layers/GraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./graphics/Graphics3DGraphicLikeLayerView ../../layers/GraphicsView".split(" "),
function(r,g,f,a,c,b,l,e){return function(d){function e(a){a=d.call(this)||this;a.graphics3d=null;a.supportsDraping=!0;a.overlayUpdating=!1;a.mockLayerId="__sceneView.graphics-"+Date.now().toString(16);return a}f(e,d);e.prototype.initialize=function(){this.graphics3d=new l({owner:this,layer:{id:this.mockLayerId,uid:this.mockLayerId}});this.graphics3d.setup()};e.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this.graphics3d=null)};Object.defineProperty(e.prototype,"updating",
{get:function(){return!(this.graphics3d&&!this.graphics3d.updating&&!this.overlayUpdating)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"graphics3DGraphicsKeys",
{get:function(){return this.graphics3d.graphicsCore.graphics3DGraphicsKeys},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});e.prototype.getRenderingInfo=function(a){return{symbol:a.symbol||null}};e.prototype.getGraphicsFromStageObject=function(a,b){return this.graphics3d.getGraphicsFromStageObject(a,b)};e.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.whenGraphicBounds(a,
b)};e.prototype.queryGraphics=function(){return c.resolve(this.loadedGraphics)};a([b.property({aliasOf:"view.graphics"})],e.prototype,"graphics",void 0);a([b.property({aliasOf:"graphics"})],e.prototype,"loadedGraphics",void 0);a([b.property({readOnly:!0,dependsOn:["graphics3d.updating","overlayUpdating"]})],e.prototype,"updating",null);a([b.property({constructOnly:!0})],e.prototype,"view",void 0);a([b.property()],e.prototype,"graphics3d",void 0);a([b.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],
e.prototype,"hasDraped",void 0);a([b.property({type:Boolean})],e.prototype,"supportsDraping",void 0);a([b.property({type:Boolean})],e.prototype,"overlayUpdating",void 0);a([b.property()],e.prototype,"drawingOrder",null);return e=a([b.subclass("esri.views.3d.layers.GraphicsView3D")],e)}(b.declared(e))})},"esri/views/3d/layers/graphics/Graphics3DGraphicLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x){return function(b){function g(a){a=b.call(this)||this;a.graphicsCore=null;a.elevationAlignment=new q;a.handles=new l;a.suspendResumeExtent=null;return a}f(g,b);g.prototype.normalizeCtorArgs=function(a){var b=null;a.scaleVisibilityEnabled&&(b=new m);var d=new k({owner:a.owner,layer:a.layer,basemapTerrain:a.owner.view.basemapTerrain});return c({},a,{graphicsCore:d,scaleVisibility:b})};g.prototype.initialize=function(){var a=this;this._set("spatialIndex",
new u({spatialReference:this.owner.view.spatialReference}));this.scaleVisibility&&"minScale"in this.layer&&this.handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.idleClients=[this.scaleVisibility,this.elevationAlignment,this.graphicsCore]};g.prototype.setup=function(){var a=this;this.elevationAlignment.setup(this.owner,function(b,c,d){return a.spatialIndex.queryGraphicUIDsInExtent(b,c,d)},this.graphicsCore,this.view.elevationProvider);
this.scaleVisibility&&"minScale"in this.layer&&this.scaleVisibility.setup(this.owner,this.layer,function(b,c,d){return a.spatialIndex.queryGraphicUIDsInExtent(b,c,d)},this.graphicsCore,this.owner.view.basemapTerrain);this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,spatialIndex:this.spatialIndex,scaleVisibility:this.scaleVisibility});this.handles.add(this.view.watch("clippingArea",function(){return a.updateClippingExtent()}));this.updateClippingExtent();this.setupSuspendResumeExtent();
this.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this.needsIdleUpdate,idleFrame:this.idleUpdate})};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view.resourceController.deregisterIdleFrameWorker(this);this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.graphicsCore&&(this.graphicsCore.destroy(),
this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null))};Object.defineProperty(g.prototype,"suspended",{get:function(){return!(!this.scaleVisibility||!this.scaleVisibility.suspended)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});g.prototype.getGraphicsFromStageObject=
function(a,b){var c=this,d=a.getMetadata().graphicId,f=null;this.owner.loadedGraphics&&this.owner.loadedGraphics.some(function(a){return a.uid===d?(f=t.hydrateGraphic(a,c.layer instanceof n?c.layer:null),!0):!1});return e.create(function(a,b){null!==f?a(f):b()})};g.prototype.whenGraphicBounds=function(a,b){return this.spatialIndex?this.graphicsCore?this.graphicsCore.whenGraphicBounds(a,b):e.reject():e.reject()};g.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=
b[a];if(c&&c.needsIdleUpdate())return!0}return!1};g.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];d&&d.idleUpdate(a)}};g.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};g.prototype.setupSuspendResumeExtent=function(){var a=this;this.scaleVisibility&&d.init(this.graphicsCore,"computedExtent",function(b){a.suspendResumeExtent=x.enlargeExtent(b,
a.suspendResumeExtent,p.SUSPEND_RESUME_EXTENT_OPTIMISM);a.scaleVisibility.setExtent(a.suspendResumeExtent)},!0)};a([h.property({constructOnly:!0})],g.prototype,"owner",void 0);a([h.property({constructOnly:!0})],g.prototype,"layer",void 0);a([h.property({readOnly:!0,aliasOf:"owner.view"})],g.prototype,"view",void 0);a([h.property({constructOnly:!0})],g.prototype,"graphicsCore",void 0);a([h.property({readOnly:!0})],g.prototype,"spatialIndex",void 0);a([h.property({constructOnly:!0})],g.prototype,"scaleVisibility",
void 0);a([h.property({readOnly:!0})],g.prototype,"elevationAlignment",void 0);a([h.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],g.prototype,"suspended",null);a([h.property({readOnly:!0,dependsOn:["graphicsCore.updating","scaleVisibility.updating"]})],g.prototype,"updating",null);return g=a([h.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],g)}(h.declared(b))})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(r,
g){Object.defineProperty(g,"__esModule",{value:!0});g.defaultIconElevationOffset=1;g.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../symbols/support/symbolConversion ../../../../symbols/support/unitConversionUtils ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DOwner ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ../../lib/glMatrix ../../support/mathUtils ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../webgl-engine/lib/Layer".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J,M,O,aa,V,N,S,W,X,Q,I){function K(a){(a=a.elevationInfo&&a.elevationInfo.unit)&&!F.supportsUnit(a)&&R.warn("elevationInfo.unit","'"+a+"' is not a valid unit")}r=V.vec3d;var T=new e.Point,Y=r.create(),ba=y.create(),R=q.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),ha;(function(a){a[a.ADD=0]="ADD";a[a.REMOVE=1]="REMOVE"})(ha||(ha={}));n=function(q){function m(a){a=q.call(this)||this;a.propertiesPool=new W.PropertiesPool({computedExtent:e.Extent},
a);a.computedExtent=null;a.symbolCreationContext=new J.Graphics3DSymbolCreationContext;a.graphics={};a.stageLayer=null;a.stage=null;a.graphicsDrapedIds={};a.graphicsBySymbol={};a.graphicsKeys=[];a.symbols={};a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Map;a.lastFastUpdate=null;a.tilingSchemeHandle=null;a.handles=new k;a.viewSR=null;a.elevationAlignment=null;a.scaleVisibility=null;a.spatialIndex=null;a.labeling=null;a.highlights=null;a.elevationQueryService=null;a.elevationQueryView=
null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=[];a.pendingAdds=new Set;a.pendingRemoves=new Set;a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicTransformFunc=null;return a}f(m,q);n=m;Object.defineProperty(m.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||
this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});m.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference};m.prototype.setup=function(a){var b=this;this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",a.scaleVisibility);this._set("spatialIndex",a.spatialIndex);this._set("labeling",a.labeling);this._set("highlights",a.highlights);var c=this.owner.view;this.elevationQueryService=new L.ElevationQuery(this.viewSR,function(){return c.map.ground},
{maximumAutoTileRequests:4});this.elevationQueryView=new L.ElevationQueryView(this.viewSR,c.basemapTerrain);this.initializeStage(c,this.layer.uid);this.symbolCreationContext.sharedResources=c.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=c.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=
c.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=c.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=n.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=c.elevationProvider;K(this.layer);a=G.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=
G.createContext(a,this.viewSR,R);c.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=x.when(this.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(b.symbolCreationContext.overlaySR)||(b.symbolCreationContext.overlaySR=b.basemapTerrain.spatialReference,b.recreateAllGraphics())});this.handles.add(this.owner.watch("suspended",function(){return b.suspendedChange()}));
this.handles.add(this.owner.watch("layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",function(){var a=c.screenSizePerspectiveEnabled&&b.layer.screenSizePerspectiveEnabled;a!==b.symbolCreationContext.screenSizePerspectiveEnabled&&(b.symbolCreationContext.screenSizePerspectiveEnabled=a,b.recreateAllGraphics())}));this.handles.add(x.on(this.owner,"loadedGraphics","change",function(a){return b.graphicsCollectionChanged(a)},
function(){b.clearSymbolsAndGraphics();b.graphicsCollectionChanged({added:b.owner.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)};m.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(X.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.tilingSchemeHandle&&
(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.handles.destroy();this.viewSR=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),
this.propertiesPool=null)};m.prototype.clear=function(){for(var a in this.graphics)this.graphics[a].destroy();this.spatialIndex&&this.spatialIndex.clear();this.graphics={};this.graphicsKeys=null;for(var b in this.symbols)(a=this.symbols[b])&&a.destroy();this.graphicsWaitingForSymbol.forEach(function(a){a.reject()});this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.graphicsWaitingForSymbol.clear();this.pendingUpdates=[];this.pendingAdds.clear();this.pendingRemoves.clear();
this._set("hasDraped",!1);this.notifyChange("updating")};m.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new I(b,{isPickable:!this.owner.suspended},b);this.stage.add(X.ModelContentType.LAYER,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};m.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set,c;for(c in this.symbols){var d=this.symbols[c];d&&d.setDrawOrder(a,b)}0<b.size&&this.stage.getDrapedTextureRenderer().updateRenderOrder(b)};
m.prototype.suspendedChange=function(){!0===this.owner.suspended?(this.stageLayer.isPickable=!1,this.hideAllGraphics()):!1===this.owner.suspended&&(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility())};Object.defineProperty(m.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0});m.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};Object.defineProperty(m.prototype,"graphics3DGraphicsKeys",{get:function(){null===this.graphicsKeys&&
(this.graphicsKeys=Object.keys(this.graphics));return this.graphicsKeys},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0});m.prototype.updateLabelingInfo=function(){return this.labeling&&this.labeling.updateLabelingInfo()};Object.defineProperty(m.prototype,"symbolUpdateType",{get:function(){if(0<this.pendingUpdates.length)return"unknown";var a=0,b=0,c;for(c in this.symbols){var d=
this.symbols[c];if(d){d=d.getFastUpdateStatus();if(0<d.loading)return"unknown";b+=d.fast;a+=d.slow}}return 0<=b&&0===a?"fast":0<=a&&0===b?"slow":"mixed"},enumerable:!0,configurable:!0});m.prototype.needsIdleUpdate=function(){return 0<this.pendingUpdates.length?!0:!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate};m.prototype.idleUpdate=function(a){var b=this.needsIdleUpdate();this._applyPendingUpdates(a);!a.done()&&this.lastFastUpdate&&(this.labeling&&this.labeling.updateLabelingInfo(),
this.lastFastUpdate=null);a=this.needsIdleUpdate();b!==a&&this.notifyChange("updating")};m.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return u.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||(b=new l,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};m.prototype.boundsForGraphics3DGraphic=function(a,d){return b(this,void 0,void 0,function(){var b,e,f,k,h,l,m,q,n,p,u;return c(this,function(c){switch(c.label){case 0:return b=this.owner.view.spatialReference,
e=this.owner.view.renderSpatialReference,f=this.owner.view.basemapTerrain.spatialReference,k=function(a,c,d){return S.bufferToBuffer(a,e,c,a,b,c,d)},h=function(a,c,d){return S.bufferToBuffer(a,f,c,a,b,c,d)},l=d&&d.useViewElevation?this.elevationQueryView:this.elevationQueryService,m=null,l&&(m={service:d&&d.useViewElevation?this.elevationQueryView:this.elevationQueryService,minDemResolution:d&&d.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}),[4,a.getProjectedBoundingBox(k,
h,m)];case 1:q=c.sent();if(!q)return[2,null];n=q.boundingBox;q.requiresDrapedElevation&&(p=this.symbolCreationContext.elevationProvider)&&(y.center(n,Y),T.x=Y[0],T.y=Y[1],T.z=void 0,T.spatialReference=b,u=p.getElevation(T)||0,n[2]=Math.min(n[2],u),n[5]=Math.max(n[5],u));return[2,{boundingBox:n,screenSpaceObjects:q.screenSpaceObjects}]}})})};m.prototype.whenGraphicBounds=function(a,b){var c=this;return x.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,
d=c.owner.loadedGraphics.find(function(c){return c===a||b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]?!0:!1});if(d)return c.whenGraphics3DGraphic(d);throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};m.prototype.graphicsCollectionChanged=function(a){this.add(a.added);this.remove(a.removed)};m.prototype.graphicUpdateHandler=function(a){if("visible"===a.property){var b=this.graphics[a.graphic.uid];
b&&b.setVisibilityFlag(0,a.newValue)&&this.labeling&&(this.lastFastUpdate=performance.now(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};m.prototype.beginGraphicUpdate=function(a,b){this.graphicsWaitingForSymbol.set(a.uid,b);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};m.prototype.endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&
this.notifyChange("updating"));this._get("symbolsUpdating")&&0===this.graphicsWaitingForSymbol.size&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))};m.prototype.expandComputedExtent=function(a){var b=a.spatialReference;B.computeAABB(a,ba);a=this.viewSR;var c=n.tmpVec;!b.equals(a)&&S.xyzToVector(ba[0],ba[1],0,b,c,a)&&(ba[0]=c[0],ba[1]=c[1],S.xyzToVector(ba[3],ba[4],0,b,c,a),ba[3]=c[0],ba[4]=c[1]);if(N.isFinite(ba[0])&&N.isFinite(ba[3])&&N.isFinite(ba[1])&&N.isFinite(ba[4])){var b=
this.computedExtent,c=null,d=N.isFinite(ba[2])&&N.isFinite(ba[5]),e=d&&(!b||null==b.zmin||ba[2]<b.zmin),d=d&&(!b||null==b.zmax||ba[5]>b.zmax);if(b){if(ba[0]<b.xmin||ba[1]<b.ymin||ba[3]>b.xmax||ba[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),c.xmin=Math.min(ba[0],b.xmin),c.ymin=Math.min(ba[1],b.ymin),c.xmax=Math.max(ba[3],b.xmax),c.ymax=Math.max(ba[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=ba[0],c.ymin=ba[1],c.xmax=ba[3],c.ymax=ba[4],c.spatialReference=
a;c&&(e&&(c.zmin=ba[2]),d&&(c.zmax=ba[5]),this._set("computedExtent",c))}};m.prototype.updateHasDraped=function(){var a=!1,b;for(b in this.graphicsDrapedIds)if(this.graphicsDrapedIds.hasOwnProperty(b)){a=!0;break}this._set("hasDraped",a)};m.prototype.elevationInfoChange=function(){K(this.layer);var a=G.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=G.createContext(a,this.viewSR,R);this.labelsEnabled&&this.labeling.elevationInfoChange();
this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var b in this.graphicsBySymbol){var c=this.symbols[b],a=this.graphicsBySymbol[b];if(c&&c.layerPropertyChanged("elevationInfo",a))for(var d in a){var e=a[d],c=e.graphic,e=e._labelGraphics;this.elevationAlignment&&this.elevationAlignment.markGraphicElevationDirty(c.uid);for(var f=0;f<e.length;f++){var k=e[f];k.graphics3DSymbolLayer.updateGraphicElevationContext(c,k)}}else this._recreateSymbol(b)}};
m.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.labeling&&this.labeling.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};m.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();this._set("computedExtent",null);this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&
this.add(this.owner.loadedGraphics.toArray())};m.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],c=[],d=[],e;for(e in b){var f=b[e];f.isDraped()&&delete this.graphicsDrapedIds[e];this.spatialIndex&&c.push(f);d.push(f.graphic);f.destroy();delete this.graphics[e];this.graphicsKeys=null}0<c.length&&this.spatialIndex.removeMany(c);this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();this.add(d)};m.prototype.add=function(a){a=this.graphicTransformFunc?
this.graphicTransformFunc(a):a;this._add(a)};m.prototype._add=function(a){if(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme&&!(1>a.length)){for(var b=0;b<a.length;++b){var c=a[b].uid;this.pendingAdds.has(c)?ea.add(c):this.pendingAdds.add(c)}0<ea.size&&(this.pendingUpdates=this.pendingUpdates.filter(function(a){return a.type===ha.REMOVE||!ea.has(a.graphic.uid)}),ea.clear());for(b=0;b<a.length;++b)this.pendingUpdates.push({type:ha.ADD,graphic:a[b]});this.notifyChange("updating")}};
m.prototype.remove=function(a){if(!(1>a.length)){for(var b=[],c=0;c<a.length;++c){var d=a[c],e=d.uid,f=this.pendingAdds.has(e),k=this.pendingRemoves.has(e);f&&k?(this.pendingAdds.delete(e),ea.add(e),b.push(d)):f?(this.pendingAdds.delete(e),ea.add(e)):k||(this.pendingRemoves.add(e),b.push(d))}0<ea.size&&(this.pendingUpdates=this.pendingUpdates.filter(function(a){return!ea.has(a.graphic.uid)}),ea.clear());for(c=0;c<b.length;++c)this.pendingUpdates.push({type:ha.REMOVE,graphic:b[c]});this.notifyChange("updating")}};
m.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;for(var c=[],d=0;!a.done()&&d<this.pendingUpdates.length;){var e=this.pendingUpdates[d],f=e.graphic;++d;switch(e.type){case ha.ADD:this.pendingAdds.delete(f.uid);(e=this._startAddGraphic(f))&&ca.push(e);break;case ha.REMOVE:this.pendingRemoves.delete(f.uid),e=this._removeGraphic(f),this.spatialIndex&&e&&c.push(e)}1E3<ca.length&&(ca.forEach(function(a){return b._finishAddGraphic(a)}),ca.clear())}0!==
d&&(ca.forEach(function(a){return b._finishAddGraphic(a)}),ca.clear(),0<c.length&&this.spatialIndex.removeMany(c),this.pendingUpdates=this.pendingUpdates.slice(d),this.updateHasDraped(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty(),this.notifyChange("updating"))};m.prototype._startAddGraphic=function(a){var b=a.geometry;if(b){var c=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(a);if(c&&c.symbol){var d=this.getOrCreateGraphics3DSymbol(c.symbol,c.renderer);if(d)return c=
{graphic:a,renderingInfo:c,layer:this.layer},this.expandComputedExtent(b),this.beginGraphicUpdate(a,d),{symbolPromise:d,context:c}}else this.symbolWarningLogged||(this.symbolWarningLogged=!0,R.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render"))}else this.geometryWarningLogged||(this.geometryWarningLogged=!0,R.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render"));this.graphicsWithoutSymbol[a.uid]=a};m.prototype._finishAddGraphic=function(a){var b=
this;a.symbolPromise.then(function(){var c=a.context.graphic;b.createGraphics3DGraphic(a.symbolPromise,a.context);b.endGraphicUpdate(c);b.labeling&&(b.lastFastUpdate=performance.now(),b.owner.view.deconflictor.setDirty(),b.owner.view.labeler.setDirty())},function(){b.endGraphicUpdate(a.context.graphic)})};m.prototype._removeGraphic=function(a){var b=a.uid;if(a=this.graphics[b]){a.isDraped()&&delete this.graphicsDrapedIds[b];var c=a.graphics3DSymbol.symbol.id;a.destroy();delete this.graphics[b];delete this.graphicsBySymbol[c][b];
delete this.graphicsWithoutSymbol[b];this.graphicsKeys=null;this.labeling&&this.labeling.removeGraphic(a)}else(b=this.graphicsWaitingForSymbol.get(b))&&b.reject();return a};m.prototype.hasLabelingContext=function(a){if(a instanceof h.LabelSymbol3D||a instanceof h.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};m.prototype.hasValidSymbolCreationContext=function(a){return a instanceof h.LabelSymbol3D&&!this.hasLabelingContext(a)?
(R.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};m.prototype.createGraphics3DSymbol=function(a,b){if(!this.hasValidSymbolCreationContext(a))return null;a=H.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var c=void 0;b&&b.backgroundFillSymbol&&(b=H.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&(c=b.symbol.symbolLayers));return M.make(a.symbol,this.symbolCreationContext,c)}a.error&&R.error(a.error.message);return null};
m.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,d=this.symbols[a.id];void 0===d&&(d=a instanceof h.WebStyleSymbol?new O(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols[a.id]=d);return d};m.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;if(!this.symbols[a.symbol.id])this.add([c]);else if(!this.graphics[c.uid]){b=a.createGraphics3DGraphic(b);this.graphics[c.uid]=b;this.graphicsKeys=null;this.graphicsBySymbol[a.symbol.id]||
(this.graphicsBySymbol[a.symbol.id]={});this.graphicsBySymbol[a.symbol.id][c.uid]=b;b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.graphicsDrapedIds[c.uid]=!0,this._set("hasDraped",!0));b.centroid=null;"point"!==c.geometry.type&&b instanceof P&&(b.centroid=aa.computeCentroid(c.geometry),b.centroid&&aa.convertPointSR(b.centroid,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.spatialIndex&&this.spatialIndex.add(b);this.labeling&&this.labeling.addGraphic(b);
a&&this.scaleVisibility.updateGraphicScaleVisibility(b);b.setVisibilityFlag(0,!!c.visible&&!this.owner.suspended);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);this.highlights&&this.highlights.graphicCreated(b)}};m.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var c=D.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;c&&("complete"===
c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()))}};m.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":break;case "defaultSymbol":break;case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};m.prototype.applySymbolSetDiff=function(a,b,c,d){a=a||[];b=b||[];d=[];for(var e=0;e<b.length;e++){var f=
b[e],k=this.graphicsBySymbol[f.id],h;for(h in k){var l=k[h],m=l.graphic,q=this.layer instanceof C?this.layer:null;if(f!==c.defaultSymbol||c.getSymbol(B.hydrateGraphic(m,q))!==c.defaultSymbol)l.isDraped()&&delete this.graphicsDrapedIds[h],a.length||c.defaultSymbol?d.push(m):this.graphicsWithoutSymbol[h]=m,l.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[h]),delete k[h],delete this.graphics[h],this.graphicsKeys=null}if(void 0===k||0===Object.keys(k).length)delete this.graphicsBySymbol[f.id],
(k=this.symbols[f.id])&&k.destroy(),delete this.symbols[f.id]}if(a.length||d.length){for(h in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[h]);this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};m.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],k=e?e.removed.map(function(a){return a.symbol}):
[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),k.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&k.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&k.push(b.defaultSymbol);this.applySymbolSetDiff(f,k,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};m.prototype.calculateUnchangedSymbolMapping=function(a,b,c){if(b instanceof d.UniqueValueRenderer&&c instanceof d.UniqueValueRenderer)if(!a){if(c&&
c.defaultSymbol)return[{oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id}]}else if("partial"===a.type){var e=a.diff;a=e.defaultSymbol;var e=e.uniqueValueInfos,f=void 0,f=e?e.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):c.uniqueValueInfos.map(function(a,c){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[c].symbol.id}});!a&&c.defaultSymbol&&f.push({oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id});return f}return[]};m.prototype.updateUnchangedSymbolMappings=
function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)if(c=a[d],b=c.oldId,c=c.newId,b&&b!==c){var e=this.graphicsBySymbol[b];delete this.graphicsBySymbol[b];void 0!==e&&(this.graphicsBySymbol[c]=e);e=this.symbols[b];delete this.symbols[b];void 0!==e&&(this.symbols[c]=e,e.symbol.id=c)}};m.prototype.applyRendererDiff=function(a,b,c){if(this.diffHasSymbolChange(a))return!1;if(b instanceof d.UniqueValueRenderer&&c instanceof d.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,
b,c)&&0===Object.keys(a.diff).length)return!0;for(var e in this.graphicsBySymbol)if((c=this.symbols[e])&&!c.applyRendererDiff(a,b,this.graphicsBySymbol[e]))return!1;return!0};m.prototype.opacityChange=function(){for(var a in this.graphicsBySymbol){var b=this.symbols[a];b&&b.layerPropertyChanged("opacity")}};m.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,d=A.create();S.extentToBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=[d[0],d[1],-Infinity,
d[2],d[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!t.equals(this.symbolCreationContext.clippingExtent,c)};m.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.owner.loadedGraphics){var c=!1;this.owner.loadedGraphics.forEach(function(d){var e=b.getGraphics3DGraphicById(d.uid);e&&a(e,d)&&(c=!0)});c&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};m.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,
c){c=b.setVisibilityFlag(0,c.visible);var d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b));return c||d})};m.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};m.prototype.validateRenderer=function(a){(a=E.validateTo3D(a))&&R.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};m.prototype.volatileGraphicsUpdated=function(){this.labelsEnabled&&
(this.lastFastUpdate=performance.now());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};m.createLocalOriginFactory=function(){return new Q(5E6,16)};m.prototype.snapshotInternals=function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),
graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedIds:Object.keys(this.graphicsDrapedIds).sort(),pendingUpdates:this.pendingUpdates}};m.tmpVec=V.vec3d.create();a([v.property({readOnly:!0})],m.prototype,"computedExtent",void 0);a([v.property({readOnly:!0})],m.prototype,"elevationAlignment",void 0);a([v.property({readOnly:!0})],m.prototype,"scaleVisibility",void 0);a([v.property({readOnly:!0})],m.prototype,"spatialIndex",void 0);a([v.property({readOnly:!0})],m.prototype,
"labeling",void 0);a([v.property({readOnly:!0})],m.prototype,"highlights",void 0);a([v.property({constructOnly:!0})],m.prototype,"elevationFeatureExpressionEnabled",void 0);a([v.property({constructOnly:!0})],m.prototype,"owner",void 0);a([v.property({constructOnly:!0})],m.prototype,"layer",void 0);a([v.property({constructOnly:!0})],m.prototype,"basemapTerrain",void 0);a([v.property({readOnly:!0})],m.prototype,"hasDraped",void 0);a([v.property({constructOnly:!0})],m.prototype,"graphicTransformFunc",
void 0);a([v.property({readOnly:!0})],m.prototype,"symbolsUpdating",void 0);a([v.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating"]})],m.prototype,"updating",null);return m=n=a([v.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],m);var n}(v.declared(n));var ea=new Set,ca=new m;return n})},"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(r,g){function f(b){return function(c){return a([b,c])}}function a(a){if(b)throw new TypeError("Generator is already executing.");
for(;c;)try{if(b=1,l&&(e=l[a[0]&2?"return":a[0]?"throw":"next"])&&!(e=e.call(l,a[1])).done)return e;if(l=0,e)a=[0,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;l=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=
e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();continue}}a=g.call(r,c)}catch(n){a=[6,n],l=0}finally{b=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},b,l,e,d;return d={next:f(0),"throw":f(1),"return":f(2)},"function"===typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d}})},"esri/core/tsSupport/awaiterHelper":function(){define(["dojo/Deferred","dojo/when"],function(r,g){return function(f,
a,c,b){function l(a){try{d(b.next(a))}catch(t){h.reject(t)}}function e(a){try{d(b["throw"](a))}catch(t){h.reject(t)}}function d(a){a.done?g(a.value).then(h.resolve,h.reject):g(a.value).then(l,e)}var h=new r;d((b=b.apply(f,a||[])).next());return h.promise}})},"esri/core/PooledArray":function(){define(["require","exports","./arrayUtils","./HeapSort"],function(r,g,f,a){return function(){function c(a,c){this.length=0;this.data=[];this._allocator=null;a&&(this.data=Array(a));if(c&&a){for(var b=0;b<a;b++)this.data[b]=
c(b);this._allocator=c}}c.prototype.toArray=function(){return this.data.slice(0,this.length)};c.prototype.clear=function(){if(!this._allocator)for(var a=0;a<this.length;a++)this.data[a]=null;this.length=0};c.prototype.equal=function(a){return f.equals(this.data,a.data)};c.prototype.push=function(a){this.data.length===this.length&&this._grow(2*(this.length+1));return this.data[this.length++]=a};c.prototype.pushArray=function(a){var b=this.length+a.length;b>=this.data.length&&this._grow(Math.max(2*
this.length,b));for(b=0;b<a.length;b++)this.data[this.length++]=a[b];return this.back()};c.prototype.pushNew=function(){this.data.length===this.length&&this._grow(2*(this.length+1));++this.length;return this.back()};c.prototype.pushAny=function(a){return void 0===a?this.pushNew():Array.isArray(a)?this.pushArray(a):this.push(a)};c.prototype.pop=function(){if(0!==this.length){var a=this.data[--this.length];this._allocator||(this.data[this.length]=null);return a}};c.prototype.removeMany=function(a){var b=
this,c=[];this.data=this.data.filter(function(d,e){if(e>=b.length)return!1;if(0>a.indexOf(d))return!0;c.push(d);return!1});this.length=this.data.length;return c};c.prototype.removeUnordered=function(a){a=f.removeUnordered(this.data,a,this.length);void 0!==a&&(--this.length,this._allocator||(this.data[this.length]=null));return a};c.prototype.removeUnorderedMany=function(a){a=f.removeUnorderedMany(this.data,a,this.length);if(!this._allocator)for(var b=this.length-a.length;b<this.length;++b)this.data[b]=
null;this.length-=a.length;return a};c.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]};c.prototype.swap=function(a,c){if(!(a>=this.length||c>=this.length)){b=[this.data[c],this.data[a]];this.data[a]=b[0];this.data[c]=b[1];var b}};c.prototype.sort=function(b){a.sort(this.data,0,this.length,b)};c.prototype.some=function(a,c){for(var b=0;b<this.length;++b)if(a.call(c,this.data[b],b,this.data))return!0;return!1};c.prototype.find=function(a,c){for(var b=0;b<this.length;++b){var d=
this.data[b];if(a.call(c,d,b,this.data))return d}};c.prototype.filter=function(a,f,e){e=e||new c;for(var b=0;b<this.length;++b)a.call(f,this.data[b],b,this.data)&&e.push(this.data[b]);return e};c.prototype.forEach=function(a,c){for(var b=0;b<this.length;++b)a.call(c,this.data[b],b,this.data)};c.prototype._grow=function(a){for(var b=this._allocator?this._allocator:function(){return null};this.data.length<a;)this.data.push(b(this.data.length))};return c}()})},"esri/core/HeapSort":function(){define([],
function(){function r(f,a,c,b){for(var l=a,e=c>>>1,d=f[l-1];a<=e;){a=l<<1;a<c&&0>b(f[a-1],f[a])&&++a;var h=f[a-1];if(0>=b(h,d))break;f[l-1]=h;l=a}f[l-1]=d}function g(f,a){return f<a?-1:f>a?1:0}return{sort:function(f,a,c,b){void 0===a&&(a=0);void 0===c&&(c=f.length);void 0===b&&(b=g);for(var l=c>>>1;l>a;l--)r(f,l,c,b);for(var e=a+1,l=c-1;l>a;l--)c=f[a],f[a]=f[l],f[l]=c,r(f,e,l,b);return f}}})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],
function(r,g,f,a){function c(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var c=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var d=[];c.forEach(function(a,b){0!==b&&a===c[b-1]||d.push(a)});return new f("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function b(b){var d=b.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),
e=a.to3D(b.defaultSymbol);e.error&&d.unshift(e.error);return c(b,d)}function l(b){var d=b.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),e=a.to3D(b.defaultSymbol);e.error&&d.unshift(e.error);return c(b,d)}Object.defineProperty(g,"__esModule",{value:!0});g.validateTo3D=function(e){return e?"simple"===e.type?c(e,a.to3D(e.symbol).error):"unique-value"===e.type?b(e):"class-breaks"===e.type?l(e):new f("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(e.type||e.declaredClass)+"'",{renderer:e}):null}})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.supportsUnit=function(a){return null!=f.meterIn[a]};g.getMetersPerUnit=function(a){return 1/(f.meterIn[a]||1)}})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper dojo/Deferred dojo/_base/lang ../../../../geometry ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(r,g,f,a,c,b,l,e,d,h){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function b(a,b){this.spatialReference=a;this.elevationProvider=b;this.point=new e.Point;this.point.spatialReference=a}b.prototype.queryElevation=function(b,c){return a(this,void 0,void 0,function(){return f(this,function(a){this.point.x=b;this.point.y=c;return[2,d.resolve(this.elevationProvider&&this.elevationProvider.getElevation(this.point)||0)]})})};return b}();g.ElevationQueryView=r;r=function(){function d(a,
b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=l.mixin({},c,{ignoreInvisibleLayers:!0})}d.prototype.queryElevation=function(c,d,e){void 0===e&&(e=0);return a(this,void 0,void 0,function(){var a;return f(this,function(f){a=new b;this._queries.push({x:c,y:d,minDemResolution:e,result:a});this._scheduleDoQuery();return[2,a.promise]})})};d.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(h.schedule(function(){return a._doQuery()}),
this._isScheduled=!0)};d.prototype._doQuery=function(){return a(this,void 0,void 0,function(){var a,b,d,h,l,n,g,v,y;return f(this,function(f){switch(f.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});d=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);h=new e.Multipoint({points:b,spatialReference:this.spatialReference});l=this._getElevationQueryProvider();if(!l)return a.forEach(function(a,b){return a.result.reject()}),
[2];g=c({},this._queryOptions,{minDemResolution:d});f.label=1;case 1:return f.trys.push([1,3,,4]),[4,l.queryElevation(h,g)];case 2:return n=f.sent(),[3,4];case 3:return v=f.sent(),a.forEach(function(a){return a.result.reject(v)}),[2];case 4:return y=n.geometry.points,a.forEach(function(a,b){return a.result.resolve(y[b][2])}),[2]}})})};return d}();g.ElevationQuery=r})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../support/arcadeUtils"],
function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.createContext=function(a,c,b){var l=null;a=a&&a.expression;"string"===typeof a&&(l="0"===a?0:null,null!=l?l={cachedResult:l}:(l=f.createSyntaxTree(a),f.dependsOnView(l)?(null!=b&&b.error("Expressions containing '$view' are not supported on ElevationInfo"),l={cachedResult:0}):l={arcade:{func:f.createFunction(l),context:f.createExecContext(null,{sr:c})}}));return l};g.createFeature=function(a,c){return f.createFeature(a.attributes,a.geometry,
c)};g.setContextFeature=function(a,c){null!=a&&null==a.cachedResult&&f.updateExecContext(a.arcade.context,c)};g.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var c=a.arcade,c=f.executeFunction(c.func,c.context);"number"!==typeof c&&(c=a.cachedResult=0);return c}return 0};g.extractExpressionInfo=function(a,c){void 0===c&&(c=!1);var b=(a=a&&a.featureExpressionInfo)&&a.expression;c||"0"===b||(a=null);return a};g.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){var t=new b(Array,function(a){return l.set(a,l.ZERO)},null,10,5),p=e.create();return function(){function b(a,b,c,d){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var e=Array(2),f=0;f<e.length;f++)e[f]=Array(3);this._visibilityFlags=e;this.extent=this._featureExpressionFeature=null;this.graphics3DSymbol=b;this.graphic=a;this._graphics=c;this._featureExpressionFeature=h.createFeature(a,d)}b.prototype.initialize=function(a,b){var c=
this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,b);d.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);
a.initialize(b,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.areVisibilityFlagsSet=function(a,b,c){void 0===c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];a=!0;for(var d=0;d<c.length;d++)if(d!==b){var e=
c[d];a=a&&(null==e||!0===e)}return a};b.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=0;b<=a;b++)for(var c=this._visibilityFlags[b],d=0;d<c.length;d++){var e=c[d];if(null!==e&&!1===e)return!1}return!0};b.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});
var f=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};b.prototype.computeExtent=function(a){if(!this.extent){this.extent=e.create();var b=this.graphic.geometry,c=b.spatialReference;d.computeAABR(b,this.extent);if(!c.equals(a)&&!n.boundingRectToBoundingRect(this.extent,
c,this.extent,a))return this.extent=null,!1}return!0};b.prototype.getProjectedBoundingBox=function(b,d,k,h){return a(this,void 0,void 0,function(){var m=this;return f(this,function(q){switch(q.label){case 0:return h||(h={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),h.boundingBox?l.empty(h.boundingBox):h.boundingBox=l.empty(),h.requiresDrapedElevation=!1,[4,c.forEach(this._graphics,function(c){return a(m,void 0,void 0,function(){var a,e,m;return f(this,function(f){switch(f.label){case 0:if(!c)return[2];
a="draped"===c.type?d:b;e=t.acquire();return[4,c.getProjectedBoundingBox(a,k,e,h.screenSpaceObjects)];case 1:return m=f.sent(),isFinite(m[2])&&isFinite(m[5])||(h.requiresDrapedElevation=!0),m&&l.expand(h.boundingBox,e),t.release(e),[2]}})})})];case 1:return q.sent(),l.allFinite(h.boundingBox)||e.allFinite(l.toRect(h.boundingBox,p))?[2,h]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&"object3d"===c.type&&c.needsElevationUpdates)return!0}a=
0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(d){"object3d"===d.type&&d.alignWithElevation(a,b,c._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};b.prototype.forEachGraphicList=
function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/core/asyncUtils":function(){define(["require","exports","./tsSupport/generatorHelper",
"./tsSupport/awaiterHelper","./promiseUtils"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});g.forEach=function(b,l,e){return a(this,void 0,void 0,function(){return f(this,function(a){switch(a.label){case 0:return[4,c.eachAlways(b.map(function(a,b){return l.apply(e,[a,b])}))];case 1:return a.sent(),[2]}})})};g.map=function(b,l,e){return a(this,void 0,void 0,function(){var a;return f(this,function(d){switch(d.label){case 0:return[4,c.eachAlways(b.map(function(a,b){return l.apply(e,
[a,b])}))];case 1:return a=d.sent(),[2,a.map(function(a){return a.value})]}})})};g.maybe=function(b){return a(this,void 0,void 0,function(){return f(this,function(a){return[2,b.then(function(a){return{ok:!0,value:a}}).catch(function(a){return{ok:!1,error:a}})]})})};g.assertMaybe=function(a){if(!0===a.ok)return a.value;throw a.error;}})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){return function(){this.featureExpressionInfoContext=
this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0}}();g.Graphics3DSymbolCreationContext=r})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(r,
g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.make=function(c,b,l){var e;switch(c.type){case "point-3d":e=f;break;default:e=a}return new e(c,b,l)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(r,g,f,a,c){return function(b){function c(c,d,f){c=b.call(this,c,d,f)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&(c.calloutSymbolLayer=
a.make(c.symbol,d));return c}f(c,b);c.prototype.destroy=function(){b.prototype.destroy.call(this)};c.prototype.createGraphics3DGraphic=function(a,c,f){c=b.prototype.createGraphics3DGraphic.call(this,a,f);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&c.addAuxiliaryGraphic(a);return c};c.prototype.layerPropertyChanged=function(a,c){var d=this;return b.prototype.layerPropertyChanged.call(this,a,c)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(a,c,function(a){var b=
0;for(a=a._auxiliaryGraphics;b<a.length;b++){var c=a[b];if(c.graphics3DSymbolLayer===d.calloutSymbolLayer)return c}}):!0:!1};c.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};return c}(c)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require",
"exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});var b=f.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");g.make=function(c,d){if(!a.isCalloutSupport(c))return b.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+c.type+"' does not support callouts"),null;if(!c.callout)return null;var e=l[c.callout.type];return e?new e(c,
d):(b.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+c.callout.type),null)};var l={line:c}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){var m=k.VertexAttrConstants;r=function(d){function k(a,b){a=d.call(this,a,null,b,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}f(k,d);k.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(n.ModelContentType.MATERIAL,this._material.id),this._material=null)};k.prototype._prepareResources=function(){var a=this._getStageIdHint();this._createMaterialsAndAddToStage(this._context.stage,
a);this.resolve()};k.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(k.prototype,"materialParameters",{get:function(){var b=this.symbolContainer,d=b.callout,e=a.toUnitRGBA(d.color);e[3]*=this._getLayerOpacity();var f=c.pt2px(d.size||0),k=null;if(b.verticalOffset)var k=b.verticalOffset,h=k.minWorldLength,l=k.maxWorldLength,k={screenLength:c.pt2px(k.screenLength),
minWorldLength:h||0,maxWorldLength:null!=l?l:Infinity};d=d.border&&d.border.color?a.toUnitRGBA(d.border.color):null;h="object"===b.symbolLayers.getItemAt(0).type;return{color:e,size:f,verticalOffset:k,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:d,occlusionTest:!h,shaderPolygonOffset:h?0:void 0,depthHUDAlignStart:"label-3d"===b.type}},enumerable:!0,configurable:!0});
k.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new q(this.materialParameters,b+"_lineCallout_common");a.add(n.ModelContentType.MATERIAL,this._material)};k.prototype._defaultElevationInfoNoZ=function(){return y};k.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var c=this.getGraphicElevationContext(a,b.elevationOffset||0),d=b.symbol,e="on-the-ground"===
this._elevationContext.mode&&!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==d.type&&e)return null;d=h.computeCentroid(a.geometry);return null==d?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)};k.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,c)}return!1};k.prototype.layerOpacityChanged=function(a,b){this._material.setParameterValues(this.materialParameters);
return!0};k.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;for(var e in a)c=a[e],(d=b(c))&&this.updateGraphicElevationContext(c.graphic,d);return!0};k.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=d.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};k.prototype.updateGraphicElevationContext=
function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=e.needsElevationUpdates2D(a.mode)};k.prototype.createVertexData=function(a){var b=a.translation;a=a.centerOffset;if(!b&&!a)return u;b=b?{size:3,data:[b[0],b[1],b[2]]}:u[m.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:u[m.AUXPOS1];return c={},c[m.POSITION]=b,c[m.NORMAL]=u[m.NORMAL],c[m.AUXPOS1]=a,c;var c};k.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),
d=q.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new q(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,e));return{material:e,isUnique:!1}}e=new q(c,b+"_lineCallout_unique");return{material:e,isUnique:!0}};k.prototype._createAs3DShape=function(a,c,d,f,k,h){a=new p(this.createVertexData(f),v,p.DefaultOffsets,"point");a=[new t(a,k)];var m=this.getOrCreateMaterial(f,
k);k=e.createStageObjectForPoint.call(this,c,a,[[m.material]],null,null,d,k,this._context.layer.uid,h,!0);if(null===k)return null;h=new l(this,k.object,a,m.isUnique?[m.material]:null,null,b.perObjectElevationAligner,d);h.metadata={elevationOffset:f.elevationOffset||0};h.alignedTerrainElevation=k.terrainElevation;h.needsElevationUpdates=e.needsElevationUpdates2D(d.mode);e.extendPointGraphicElevationContext(h,c,this._context.elevationProvider);return h};return k}(d);var u=(x={},x[m.POSITION]={size:3,
data:[0,0,0]},x[m.NORMAL]={size:3,data:[0,0,1]},x[m.AUXPOS1]={size:4,data:[0,0,0,1]},x),x=new Uint32Array([0]),v=(A={},A[m.POSITION]=x,A[m.NORMAL]=x,A[m.AUXPOS1]=x,A),y={mode:"relative-to-ground",offset:0},x,A;return r})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../lib/glMatrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),function(r,
g,f,a,c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});var h=d.VertexAttrConstants;r=b.vec3d;var n=new f,t=r.create(),p=r.create(),k=r.create(),q={verticalDistanceToGround:0,terrainElevation:0};g.perVertexElevationAligner=function(b,c,d,e){n.spatialReference=d.spatialReference;for(var f=b.getGeometryRecords(),m=f.length,u="absolute-height"!==c.mode,v=0,x=0;x<m;x++){var E=f[x].geometry,r=f[x].getShaderTransformation(),F=E.getData();p[0]=r[12];p[1]=r[13];p[2]=r[14];E.invalidateBoundingInfo();
for(var r=F.getVertexAttr(),F=r[h.POSITION],E=F.data,r=r.mapPos.data,F=F.size,L=E.length/F,G=0,P=0,J=!1,M=0,O=0;O<L;O++){n.x=r[P++];n.y=r[P++];n.z=r[P++];k[0]=E[G];k[1]=E[G+1];k[2]=E[G+2];var aa=a.computeElevation(d,n,c,e,u?q:null);u&&(M+=q.terrainElevation);t[0]=E[G]+p[0];t[1]=E[G+1]+p[1];t[2]=E[G+2]+p[2];e.setAltitude(aa,t);E[G]=t[0]-p[0];E[G+1]=t[1]-p[1];E[G+2]=t[2]-p[2];if(l.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)J=!0;else if(aa=g.updateThresholdInMeters/e.unitInMeters,Math.abs(k[0]-E[G])>=
aa||Math.abs(k[1]-E[G+1])>=aa||Math.abs(k[2]-E[G+2])>=aa)J=!0;G+=F}v+=M/L;J&&b.geometryVertexAttrsUpdated(x)}return v/m};g.perObjectElevationAligner=function(b,d,f,k,h){var m=d.centerPointInElevationSR,n=0;h=0;if(b.metadata.usesVerticalDistanceToGround)n=a.computeElevation(f,m,d,k,q),c.updateVertexAttributeAuxpos1w(b,q.verticalDistanceToGround),h=q.terrainElevation;else{var p="absolute-height"!==d.mode,n=a.computeElevation(f,m,d,k,p?q:null);p&&(h=q.terrainElevation)}d=b.getObjectTransformation();
f=[d[12],d[13],d[14]];l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(t[0]=m.x,t[1]=m.y,t[2]=n,e.computeLinearTransformation(m.spatialReference,t,d,k.spatialReference)&&b.setObjectTransformation(d)):k.setAltitudeOfTransformation(n,d);k=g.updateThresholdInMeters/k.unitInMeters;(Math.abs(d[12]-f[0])>=k||Math.abs(d[13]-f[1])>=k||Math.abs(d[14]-f[2])>=k)&&b.setObjectTransformation(d);return h};g.updateThresholdInMeters=.01;g.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ../../../../symbols/callouts/calloutUtils ./graphicUtils ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(r,g,f,a,c,b,l,e,d,h){function n(a,b,c,d,e){var f=0,k=b.z||0,h=0,h=c.mode;d=c.calculateOffsetRenderUnits(d);c=c.featureExpressionInfoContext;"on-the-ground"===h?(f=h=a.getElevation(b,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=h)):"relative-to-ground"===h?(h=a.getElevation(b,"ground")||0,f=d,null==c&&(f+=k),e&&(e.verticalDistanceToGround=f,e.terrainElevation=h),f+=h):"relative-to-scene"===h?(h=a.getElevation(b,"scene")||0,f=d,e&&(e.verticalDistanceToGround=f,e.terrainElevation=
h),f+=h):"absolute-height"===h&&(f=d,null==c&&(f+=k),e&&(h=a.getElevation(b,"ground")||0,e.verticalDistanceToGround=f-h,e.terrainElevation=h));return f}function t(b,c){b=a.pathsToTriangulationInfo(b,c);return{vertexData:b.position,polygons:b.polygons,outlines:b.outlines}}function p(a,b,c,d,e){b*=3;d*=3;for(var f=0;f<e;++f)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function k(a,b,c,e,f,k,h){return d.bufferToBuffer(a,c,b,e,k,f,h)}function q(a,b,c){d.pointToVector(a,b,c)}function m(a,b){return!(a[0]>
b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}function u(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(g,"__esModule",{value:!0});r=e.mat4d;var x=e.vec3d.create(),v=r.identity(),y=c.makeDehydratedPoint(0,0,0,null);g.createStageObjectForPoint=function(a,b,c,e,f,k,p,u,g,t,y){var C=b?b.length:0,B=this._context.clippingExtent;q(a,x,this._context.elevationProvider.spatialReference);if(B&&!m(x,B))return null;q(a,x,this._context.renderSpatialReference);B=this._context.localOriginFactory.getOrigin(x);
p=new h({castShadow:!1,metadata:{layerUid:u,graphicId:g,usesVerticalDistanceToGround:!!t},idHint:p});for(u=0;u<C;u++)p.addGeometry(b[u],c[u],e?e[u]:v,f,B,y);b=this._context.renderSpatialReference;e=this._context.elevationProvider;f=this._context.renderCoordsHelper;c=0;var D;p.metadata.usesVerticalDistanceToGround?(c=n(e,a,k,f,A),l.updateVertexAttributeAuxpos1w(p,A.verticalDistanceToGround),D=A.terrainElevation):(y="absolute-height"!==k.mode,c=n(e,a,k,f,y?A:null),y&&(D=A.terrainElevation));k=p.getObjectTransformation();
x[0]=a.x;x[1]=a.y;x[2]=c;d.computeLinearTransformation(a.spatialReference,x,k,b)?p.setObjectTransformation(k):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:p,terrainElevation:D}};g.extendPointGraphicElevationContext=function(a,b,d){a=a.elevationContext;d=d.spatialReference;q(b,x,d);a.centerPointInElevationSR=c.makeDehydratedPoint(x[0],x[1],c.hasZ(b)?x[2]:0,d)};g.placePointOnGeometry=function(a){if("point"===a.type)return a;if("polygon"===a.type||"extent"===
a.type)return l.computeCentroid(a);if("polyline"===a.type){var b=a.paths[0];if(!b||0===b.length)return null;b=f.getPointOnPath(b,f.getPathLength(b)/2);return c.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}return"mesh"===a.type?a.extent.center:null};g.computeElevation=n;g.getSingleSizeDriver=function(a,b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};g.copyPathData=t;g.copyVertices=p;g.chooseOrigin=function(a,b,c,d){b=Math.floor(b+(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};
g.subtractCoordinates=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};g.setZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]=d,b+=3};g.offsetZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]+=d,b+=3};g.scaleZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]*=d,b+=3};g.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var e=0;e<c;++e)d.push([a[b++],a[b++],a[b++]]);return d};g.reproject=k;g.reprojectPoint=q;g.getGeometryVertexData3D=function(a,b,c,d,
e,f,h){var l=e.spatialReference;a=t(a,b);b=a.vertexData;var m=b.length/3,q=new Float64Array(b.length),n=!0;c.equals(l)?p(b,0,q,0,b.length):n=k(b,0,c,q,0,l,m);var u=c=0,g=h.mode,v=0,A=0,x=0;f=h.calculateOffsetRenderUnits(f);h=h.featureExpressionInfoContext;y.spatialReference=e.spatialReference;c*=3;for(var u=3*u,C=0;C<m;++C)y.x=q[c+0],y.y=q[c+1],y.z=q[c+2],"on-the-ground"===g?(A=v=e.getElevation(y)||0,x+=v):"relative-to-ground"===g?(v=e.getElevation(y)||0,A=v+f,null==h&&(A+=y.z),x+=v):"relative-to-scene"===
g?(v=e.getElevation(y,"scene")||0,A=v+f,x+=v):"absolute-height"===g&&(A=f,null==h&&(A+=y.z)),b[u+0]=q[c+0],b[u+1]=q[c+1],b[u+2]=A,c+=3,u+=3;e=x/m;l.equals(d)||k(b,0,l,b,0,d,m);return{geometryData:a,vertexData:b,eleVertexData:q,terrainElevation:e,projectionSuccess:n}};g.getGeometryVertexDataDraped=function(a,b,c){a=t(a,!1);var e=a.vertexData,f=e.length/3,k=!0;b.equals(c)||(k=d.bufferToBuffer(e,b,0,e,c,0,f));return{geometryData:a,vertexData:e,projectionSuccess:k}};g.computeBoundingBox=function(a,b,
c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var e=0;e<c;++e){var f=a[b++],k=a[b++],h=a[b++];f<d[0]&&(d[0]=f);k<d[1]&&(d[1]=k);h<d[2]&&(d[2]=h);f>d[3]&&(d[3]=f);k>d[4]&&(d[4]=k);h>d[5]&&(d[5]=h)}return d};g.pointInBox2D=m;g.boxesIntersect2D=u;g.boundingBoxClipped=function(a,b){return b?!u(a,b):!1};g.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};g.needsElevationUpdates3D=
function(a){return"absolute-height"!==a};g.needsOffsetAdjustment=function(a,d,e,f){if(!1===d.needsOffsetAdjustment||!1===d.supportsOffsetAdjustment||"on-the-ground"===a.mode)return!1;if(0===a.meterUnitOffset){if(!0===d.needsOffsetAdjustment)return!0;if(b.isCalloutSupport(f)&&f.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!c.hasZ(e)||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var A={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures ../../lib/glMatrix ../../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){function t(a){var b=a.paths[0];if(!b||0===b.length)return null;b=l.getPointOnPath(b,l.getPathLength(b)/2);return d.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}function p(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!p(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(g,"__esModule",{value:!0});var k=[1,1,1];g.computeCentroid=function(a){if("point"===a.type)return a;if(d.isHydratedGeometry(a))switch(a.type){case "extent":return a.center;
case "polygon":return a.centroid;case "polyline":return t(a);case "mesh":return a.extent.center}else switch(a.type){case "extent":var c=n.isFinite(a.zmin);return d.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);case "polygon":return c=b.ringsCentroid(a.rings,d.hasZ(a)),d.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference);case "polyline":return t(a)}};g.convertPointSR=function(a,b){var c=a.spatialReference;c.isWebMercator&&b.isWGS84?(e.xyToLngLat(a.x,
a.y,q),a.x=q[0],a.y=q[1],a.spatialReference=f.SpatialReference.WGS84):b.isWebMercator&&c.isWGS84&&(e.lngLatToXY(a.x,a.y,q),a.x=q[0],a.y=q[1],a.spatialReference=f.SpatialReference.WebMercator)};g.enlargeExtent=function(a,b,d){if(a){b||(b=c.create());var e=.5*a.width*(d-1);d=.5*a.height*(d-1);a.width<1E-7*a.height?e+=d/20:a.height<1E-7*a.width&&(d+=e/20);h.vec4d.set4(a.xmin-e,a.ymin-d,a.xmax+e,a.ymax+d,b);return b}return null};g.updateVertexAttributeAuxpos1w=function(a,b){for(var c=0;c<a.geometries.length;++c){var d=
a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};g.mixinColorAndOpacity=function(a,b){var c=[1,1,1,1];null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);null!==b&&void 0!==b?c[3]=b:null!=a&&3<a.length&&(c[3]=a[3]);return c};g.overrideColor=function(a,b,c,d,e,f){void 0===f&&(f=[0,0,0,0]);for(var k=0;3>k;++k)f[k]=a&&null!=a[k]?a[k]:c&&null!=c[k]?c[k]:e[k];f[3]=null!=b?b:null!=d?d:e[3];return f};g.computeObjectScale=function(a,b,c,d){void 0===a&&(a=
k);void 0===d&&(d=1);var e=Array(3);if(null==b||null==c)e[0]=1,e[1]=1,e[2]=1;else{for(var f=void 0,h=0,l=2;0<=l;l--){var q=a[l],m=void 0,n=null!=q,p=0===l&&!f&&!n,u=c[l];"symbolValue"===q||p?m=0!==u?b[l]/u:1:n&&"proportional"!==q&&isFinite(q)&&(m=0!==u?q/u:1);null!=m&&(f=e[l]=m,h=Math.max(h,Math.abs(m)))}for(l=2;0<=l;l--)null==e[l]?e[l]=f:0===e[l]&&(e[l]=.001*h)}for(l=2;0<=l;l--)e[l]/=d;return e};g.computeSizeWithResourceSize=function(a,b){var c=b.width,d=b.depth,e=b.height;b=b.isPrimitive?10:1;if(null==
c&&null==e&&null==d)return[b*a[0],b*a[1],b*a[2]];for(var c=[c,d,e],f,d=0;3>d;d++)if(e=c[d],null!=e){f=e/a[d];break}for(d=0;3>d;d++)null==c[d]&&(c[d]=a[d]*f);return c};g.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return p(a)?null:"Symbol sizes may not be negative values"};g.computeObjectRotation=function(a,b,c,d){void 0===d&&(d=h.mat4d.identity());a=a||0;b=b||0;c=c||0;0!==a&&h.mat4d.rotateZ(d,-a/180*Math.PI,d);0!==b&&h.mat4d.rotateX(d,b/180*Math.PI,d);0!==
c&&h.mat4d.rotateY(d,c/180*Math.PI,d);return d};g.demResolutionForBoundingBox=function(b,c){return null!=c.minDemResolution?c.minDemResolution:a.isPoint(b)?c.minDemResolutionForPoints:.01*a.maximumDimension(b)};var q=[0,0]})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b){return new (function(c){function e(){var a=
null!==c&&c.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;a.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=
!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.ELEVATION_UPDATE_PROFILE_EXTENT_MERGING=!1;return a}f(e,c);a([b.property()],e.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([b.property()],e.prototype,"SCENEVIEW_LOCKING_LOG",void 0);a([b.property()],e.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([b.property()],e.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([b.property()],e.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",
void 0);a([b.property()],e.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);a([b.property()],e.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([b.property()],e.prototype,"LABELS_SHOW_BORDER",void 0);a([b.property()],e.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([b.property()],e.prototype,"OVERLAY_SHOW_CENTER",void 0);a([b.property()],e.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);a([b.property()],e.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0);a([b.property()],
e.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);a([b.property()],e.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);a([b.property()],e.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);a([b.property()],e.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);a([b.property()],e.prototype,"ELEVATION_UPDATE_PROFILE_EXTENT_MERGING",void 0);return e=a([b.subclass()],e)}(b.declared(c)))})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/glMatrix ../../webgl-engine/Stage".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){r=h.vec3d;var t=h.mat4d,p=[0,0,0];h=function(){function f(a,b,c,d,k,h,l,q){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=d;this.uniqueGeometries=c;this.uniqueTextures=k;this.stageObject=b;this.elevationAligner=h;this.elevationContext=new e(l);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=q?q:f.VisibilityModes.HIDE_FACERANGE}f.prototype.initialize=
function(a,b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(n.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(n.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(n.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(n.ModelContentType.OBJECT,this.stageObject)};f.prototype.setVisibility=function(a){if(null!=
this.stage)return this._visible!==a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===f.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};f.prototype.destroy=function(){var a=
this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(n.ModelContentType.MATERIAL,this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(n.ModelContentType.GEOMETRY,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(n.ModelContentType.TEXTURE,this.uniqueTextures[b].id)}a.remove(n.ModelContentType.OBJECT,this.stageObject.id);this._addedToStage&&
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};f.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(l.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this.stageObject,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};f.prototype.getBSRadius=
function(){return this.stageObject.getBSRadius()};f.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};f.prototype.getBoundingBoxObjectSpace=function(a){var c=this.stageObject;a||(a=b.create());b.setMin(a,c.getBBMin(!0));b.setMax(a,c.getBBMax(!0));return a};f.prototype.getProjectedBoundingBox=function(e,f,h,l){return c(this,void 0,void 0,function(){var c,n,u,g,v,A,y,x,r;return a(this,function(a){switch(a.label){case 0:c=this.getBoundingBoxObjectSpace(h);n=m;u=b.isPoint(c)?
1:n.length;for(g=0;g<u;g++)v=n[g],q[0]=c[v[0]],q[1]=c[v[1]],q[2]=c[v[2]],t.multiplyVec3(this.stageObject.objectTransformation,q),k[3*g+0]=q[0],k[3*g+1]=q[1],k[3*g+2]=q[2];if(!e(k,0,u))return[2,null];b.empty(c);A=null;this.calculateRelativeScreenBounds&&(A=this.calculateRelativeScreenBounds());for(g=0;g<3*u;g+=3){for(y=0;3>y;y++)c[y]=Math.min(c[y],k[g+y]),c[y+3]=Math.max(c[y+3],k[g+y]);A&&l.push({location:k.slice(g,g+3),screenSpaceBoundingRect:A})}if(!f)return[3,5];b.center(c,p);if("absolute-height"===
this.elevationContext.mode)return[3,5];x=void 0;r=d.demResolutionForBoundingBox(c,f);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,f.service.queryElevation(p[0],p[1],r)];case 2:return x=a.sent(),[3,4];case 3:return a.sent(),x=null,[3,4];case 4:null!=x&&b.offset(c,0,0,-this.alignedTerrainElevation+x),a.label=5;case 5:return[2,c]}})})};f.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};f.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};
return f}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(h||(h={}));var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=r.create(),m=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return h})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(r,g,f,a){return function(a){function b(b){b=
a.call(this,b)||this;b.centerPointInElevationSR=null;return b}f(b,a);return b}(a)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(r,g,f,a){return function(){function c(a){a?this.set(a):this.setDefaults()}Object.defineProperty(c.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});c.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=f.getMetersPerUnit(a)};c.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};c.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=
a.featureExpressionInfoContext;this.hasOffsetAdjustment=a.hasOffsetAdjustment;this.setUnit(a.unit)};c.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};c.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};c.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};c.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};c.prototype.mixinApi=
function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};c.prototype.calculateOffsetRenderUnits=function(b){var c=this._meterUnitOffset,e=this.featureExpressionInfoContext;null!=e&&(c+=a.execute(e)*this._metersPerElevationInfoUnit);return c/b.unitInMeters+this._renderUnitOffset};return c}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ./lib/gl-matrix ./lib/ModelContentType ./lib/Selector ./lib/Util ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),
function(r,g,f,a,c,b,l,e,d){r=f.vec2d;g=f.vec2;var h=f.vec3d;f=function(){function f(a,b,f){this._intersectTolerance=c.DEFAULT_TOLERANCE;this._viewContent=[];this._externalIntersectionHandlers=[];this.container=b;this.viewingMode=a;this.model=new e;this.view=new d(b,this,this.model.getDirtySet(),f);this._validateHUDSelector=new c(this.viewingMode);this._validateHUDSelector.enableHUDSelection=!1;this.view.setLighting({lights:[new l.MainLight(h.createFrom(.7,.7,.7)),new l.AmbientLight(h.createFrom(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})}f.prototype.setNeedsRender=function(){this.view.setNeedsRender()};f.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};f.prototype.beginMod=function(){f.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()};f.prototype.endMod=function(a){void 0===a&&(a=!1);f.DebugSettings.fineGrainedContentValidation&&!a&&this.model.validateContent()};f.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&
b.addParentStage(this)};f.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};f.prototype.notifyDirty=function(a,b,c,d){this.model.notifyDirty(a,b,c,d)};f.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){f.DebugSettings.endFrameContentValidation&&this.model.validateContent();f.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));
var c=a.commitLayers(this._viewContent);(0<c[0].length+c[1].length+c[2].length||b)&&this.view.modify(c[0],c[1],c[2],b);f.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+c[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.view.setNeedsRender()}};f.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||
c)&&this.view.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.view.setNeedsRender()};f.prototype.get=function(a,b){return this.model.get(a,b)};f.prototype.getAll=function(a){return this.model.getAll(a)};f.prototype.addTextureListener=function(a){this.view.addTextureListener(a)};f.prototype.removeTextureListener=function(a){this.view.removeTextureListener(a)};f.prototype.getContainer=function(){return this.container};f.prototype.getCamera=function(){return this.view.getCamera()};f.prototype.setCamera=
function(a){this.view.setCamera(a)};f.prototype.getViewParams=function(a){return this.view.getViewParams(a)};f.prototype.setViewParams=function(a){this.view.setViewParams(a)};f.prototype.getLayers=function(){return this.model.getAll(a.LAYER)};f.prototype.setLighting=function(a){this.view.setLighting(a)};f.prototype.getCanvas=function(){return this.view.getCanvas()};f.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};f.prototype.getRenderParams=function(){return this.view.getRenderParams()};
f.prototype.has=function(a){return this.view.has(a)};f.prototype.getViewContent=function(){return this._viewContent.slice(0)};f.prototype.setViewContent=function(a){var c=b.array2object(this._viewContent),d=b.array2object(a),e=b.subtractObjects(d,c),c=b.subtractObjects(c,d);this.processDirty();d=this.model.getDirtySet();e=d.getResidentRenderGeometriesFilteredByLayers(b.object2array(e));c=d.getResidentRenderGeometriesFilteredByLayers(b.object2array(c));this.view.modify(e,c,[]);this._viewContent=a.slice(0)};
f.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};f.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],
c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.view.modify([],a,[])};f.prototype.getViewFrustumObjects=function(){return this.view.getFrustumObjects()};f.prototype.getLocalOrigin=function(a,b,c){return this.model.getOrigin(a,b,c)};f.prototype.getFrameTask=function(){return this.view.getFrameTask()};f.prototype.requestScreenCapture=function(a,b){this.view.requestScreenCapture(a,b)};f.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()};f.prototype.getTextureLoaded=
function(a){return this.view.getTextureLoaded(a)};f.prototype.addExternalRenderer=function(a,b){"function"===typeof b.intersect&&this._externalIntersectionHandlers.push(b);return this.view.addExternalRenderer(a,b)};f.prototype.removeExternalRenderer=function(a){var b=this._externalIntersectionHandlers.indexOf(a);-1<b&&this._externalIntersectionHandlers.splice(b,1);return this.view.removeExternalRenderer(a)};f.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};f.prototype.getRenderStats=
function(){return this.view.getCombinedStats()};f.prototype.getRenderStatString=function(a){var b=this.getRenderStats(),c="";if(a){var c=c+"\x3ctable\x3e",d;for(d in b)c+="\x3ctr\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[d])+"\x3c/td\x3e\x3c/tr\x3e";c+="\x3c/table\x3e"}else for(d in b)c+=d+": "+b[d]+"\n";return c};f.prototype.pick=function(a,b,c,d){var e=h.create(),f=h.create();this.view.getPickRay(a,e,f);return this.pickRay(e,f,a,a,b,c,d)};f.prototype.pickRayWithBeginPoint=
function(a,b,c,d,e){this.view.pickRayWithBeginPoint(a,b,c,d,e)};f.prototype.pickRay=function(a,b,d,f,k,l,g){f=this.view.getCamera();d||(d=n,f.projectPoint(b,d));var q;if(k){q=Array(k.length);for(var m=0;m<q.length;m++)q[m]=this.model.get(e.ContentType.LAYER,k[m])}else{q=[];k=this.getViewContent();for(var u=this.model.getAll(e.ContentType.LAYER),m=0;m<k.length;m++){var v=u[k[m]];v&&v.isPickable&&q.push(v)}}g?g.init(q,a,b,d,f,this._intersectTolerance,l):g=new c(this.viewingMode,q,a,b,d,f,this._intersectTolerance,
l);for(m=0;m<this._externalIntersectionHandlers.length;m++)this._externalIntersectionHandlers[m].intersect(g,a,b,d);if(g.getHudResults().length){m=g.getHudResults();m.sort(function(a,b){return b.dist-a.dist});b=m[m.length-1];k=t;f.projectPoint(b.center,k);k[0]=Math.round(k[0]);k[1]=Math.round(k[1]);u=p;this.view.getPickRay(k,a,u);d=h.dist(b.center,a)/h.dist(a,u)*.99;this._validateHUDSelector.init(q,a,u,k,f,this._intersectTolerance,l);for(m=0;m<this._externalIntersectionHandlers.length;m++)this._externalIntersectionHandlers[m].intersect(this._validateHUDSelector,
a,u,k);a=this._validateHUDSelector.getMinResult();(null==a.dist||d<=a.dist)&&g.getMinResult().copyFrom(b)}return g};f.prototype.getIntersectTolerance=function(){return this._intersectTolerance};f.prototype.setIntersectTolerance=function(a){void 0===a&&(a=1E-5);this._intersectTolerance=a};f.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()};f.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1};f.ModelContentType=a;return f}();
var n=r.create(),t=g.create(),p=h.create();return f})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../lib/gl-matrix ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(r,g,f,a,c,b,l,e){var d=e.assert,h=a.vec3d,n=a.mat4d,t=e.logWithBase;return function(){function a(){this.dirtySet=new b(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var a in c)this.content[c[a]]={}}a.prototype.getAll=function(a){a=
this.content[a];d(void 0!==a);return a};a.prototype.get=function(a,b){return this.getAll(a)[b]};a.prototype.add=function(a,b){var e=this.content[a];d(void 0!==e);var f=b.id;d(null==e[f],"Model/Stage already contains object to be added");e[f]=b;a===c.LAYER&&this.notifyDirty(a,b,"layerAdded")};a.prototype.remove=function(a,b){var e=this.content[a];d(void 0!==e);var f=e[b];d(void 0!==f,"Model/Stage doesn't contain object to be removed");delete e[b];a===c.TEXTURE&&f.unload();a===c.LAYER&&this.notifyDirty(a,
f,"layerRemoved");return f};a.prototype.getDirtySet=function(){return this.dirtySet};a.prototype.notifyDirty=function(a,b,c,d){this.dirtySet.handleUpdate(b,c,d)};a.prototype.getOrigin=function(a,b,c){void 0===c&&(c=10);var d=0;b=b*c/1E4;1<b&&(d=Math.ceil(t(b,2)));b=1E4*Math.pow(2,d);c=Math.round(a[0]/b);var e=Math.round(a[1]/b);a=Math.round(a[2]/b);var d=d+"_"+c+"_"+e+"_"+a,f=this._id2origin[d];null==f&&(f={vec3:h.createFrom(c*b,e*b,a*b),id:d},this._id2origin[d]=f);return f};a.prototype.getGeometryRenderGeometries=
function(a,b,c){var d=a.id,e=b.geometry,f=e.getData(),h=!!e.singleUse,k=b.materials,m=b.instanceParameters,q=a.getCombinedStaticTransformation(b),p=n.maxScale(q),g=b.origin,e=e.getBoundingInfo(),t=b.id,r=this._uniqueIdx++;a=new l(f,e,k[0],q,b.customTransformation,p,a.getCastShadow(),h,d,t,r);a.origin=g||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=m;c.push(a)};a.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(c.transformation)};
a.prototype.formatDebugInfo=function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var d in c)a=c[d],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";for(d in c)a=c[d],b[0]+=f.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};a.prototype.validateContent=function(){var a=
this.getAll(c.OBJECT),b;for(b in a)this.validateObject(a[b]);var a=this.getAll(c.LAYER),d;for(d in a)this.validateLayer(a[d]);d=this.getAll(c.MATERIAL);for(var e in d)this.validateMaterial(d[e])};a.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var e=a[b];d(null!=this.get(c.GEOMETRY,e.geometry.id));d(1===e.materials.length,"object materials do not match geometry groups");d(null!=this.get(c.MATERIAL,e.materials[0].id))}};a.prototype.validateLayer=function(a){a=
a.getObjects();for(var b=0;b<a.length;++b){var e=this.get(c.OBJECT,a[b].id);d(null!=e)}};a.prototype.validateMaterial=function(a){a=a.getAllTextureIds();for(var b=0;b<a.length;++b){var e=this.get(c.TEXTURE,a[b]);d(null!=e)}};a.ContentType=c;return a}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","../../../../core/arrayUtils","./ModelContentType","./Util"],function(r,g,f,a,c){return function(){function b(a){this._residentGeomRecords=new Map;this._dirtyGeomRecords=
new Map;this._dirtyMaterials=new Set;this._model=a}Object.defineProperty(b.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});b.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:null};b.prototype.clearDirtyMaterials=
function(){this._dirtyMaterials.clear()};b.prototype.hasDirtyGeometryRecords=function(){var a=!1;this._dirtyGeomRecords.forEach(function(b){a||b.forEach(function(b){b&&0<b.size&&(a=!0)})});return a};b.prototype.handleUpdate=function(a,b,d){c.assert(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](a,d)};b.prototype.shaderTransformationChanged=function(b){var c=this;(b=this._residentGeomRecords.get(b.id))&&b.forEach(function(b,e){(e=c._model.content[a.OBJECT][e])&&e.hasVolativeTransformation()&&
b.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};b.prototype.commit=function(){return this.commitLayers(f.keysOfMap(this._dirtyGeomRecords))};b.prototype.commitLayers=function(b){for(var e=this,d=[],f=[],l=[],g=function(h){var k=b[h];h=p._dirtyGeomRecords.get(k);if(!h)return"continue";h.forEach(function(b,h){var n=e._ensureGeomRecord(k,h);b.forEach(function(b,k){var m=b[0],q=b[1];b=b[2];var p=q&2&&b&1;if(q&4||p){var g=n.get(k);g?f.push.apply(f,g[1]):
4===q&&c.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");g&&n.delete(k)}if(q&1||p){var u=[m,[]],g=e._model.get(a.OBJECT,h);e._model.getGeometryRenderGeometries(g,m,u[1]);d.push.apply(d,u[1]);n.set(k,u)}if(q&2&&!p)if(g=n.get(k)){k=g[1];q=k.length;if(b&16)for(g=e._model.get(a.OBJECT,h),p=0;p<q;p++)u=k[p],e._model.updateRenderGeometryTransformation(g,m,u);for(p=0;p<q;p++)u=k[p],l.push({renderGeometry:u,updateType:b})}else c.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")});
0===n.size&&e._residentGeomRecords.get(k).delete(h)});0===p._residentGeomRecords.get(k).size&&p._residentGeomRecords.delete(k);p._dirtyGeomRecords.delete(k)},p=this,k=0;k<b.length;k++)g(k);return[d,f,l]};b.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(f.keysOfMap(this._residentGeomRecords))};b.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],c=0;c<a.length;c++){var f=this._residentGeomRecords.get(a[c]);f&&f.forEach(function(a){a.forEach(function(a){b.push.apply(b,
a[1])})})}return b};b.prototype.visibilityChanged=function(a,b,c){if(null!=b)this._componentPropertyChanged(a,b,c,2);else{b=0;for(var d=a.getGeometryRecords();b<d.length;b++)this._componentPropertyChanged(a,d[b],c,2)}};b.prototype.componentHighlightChanged=function(a,b,c){if(null!=b)this._componentPropertyChanged(a,b,c,32);else{b=0;for(var d=a.getGeometryRecords();b<d.length;b++)this._componentPropertyChanged(a,d[b],c,32)}};b.prototype.vertexAttrsUpdated=function(a,b,c){this._updateOrCreateDirtyRecord(a,
b,c,2,0,0,2,5,4)};b.prototype.matChanged=function(a){this._dirtyMaterials.add(a.id);if(this.onMaterialChanged)this.onMaterialChanged(a)};b.prototype.layerAdded=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectAdded(a,b[c])};b.prototype.layerRemoved=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectRemoved(a,b[c])};b.prototype.layObjectAdded=function(a,b){a=a.id;for(var c=b.getGeometryRecords(),e=0;e<c.length;e++)this.objGeometryAdded(b,c[e],a)};b.prototype.layObjectRemoved=
function(a,b){a=a.id;for(var c=b.getGeometryRecords(),e=0;e<c.length;e++)this.objGeometryRemoved(b,c[e],a)};b.prototype.layObjectReplaced=function(a,b){this.layObjectRemoved(a,b[0]);this.layObjectAdded(a,b[1])};b.prototype.objDirty=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(d){c._updateOrCreateDirtyRecord(a,d[0],b,2,0,2,0,5,1)})};b.prototype.objTransformation=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,
a.id).forEach(function(d){c._updateOrCreateDirtyRecord(a,d[0],b,2,0,0,2,5,16)})};b.prototype.objGeometryAdded=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,1,4,0,0,0)};b.prototype.objGeometryRemoved=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,4,1,2,0,0)};b.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,b[1])};b.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};b.prototype._componentPropertyChanged=
function(a,b,c,f){this._updateOrCreateDirtyRecord(a,b,c,2,0,0,2,5,f)};b.prototype._updateOrCreateDirtyRecord=function(a,b,d,f,n,g,p,k,q){d=d||this._getParentLayerId(a);var e=b.id;a=this._ensureDirtyRecord(d,a.id);(d=a.get(e))?(b=d[1],b&n?a.delete(e):b&g?(d[1]=f,d[2]=q):b&p?d[2]|=q:b&k||c.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(e,[b,f,q])};b.prototype._ensureGeomRecord=function(a,b){var c=this._residentGeomRecords.get(a);c||(c=new Map,this._residentGeomRecords.set(a,
c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};b.prototype._ensureDirtyRecord=function(a,b){var c=this._dirtyGeomRecords.get(a);c||(c=new Map,this._dirtyGeomRecords.set(a,c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};b.prototype._getParentLayerId=function(a){return a.parentLayer.id};b.prototype.formatDebugInfo=function(a){if(a)return"";var b=["ADD","UPD",void 0,"REM"],c="";this._dirtyGeomRecords.forEach(function(a,d){a.forEach(function(a,e){0<c.length&&(c+="\n");c+=d+"."+e;var f=[];a.forEach(function(a){var b=
a[1];f[b]||(f[b]=[]);f[b].push(a[0].geometry.id)});for(a=0;a<f.length;a++)if(f[a])for(c+=" "+b[a-1]+": ",e=0;e<f[a].length;e++)c+=f[a][e]+", "})});return c};return b}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","./gl-matrix"],function(r,g,f){var a=f.vec3d,c=f.mat4d;return function(){function b(b,c,d,f,n,g,p,k,q,m,u){this.shaderTransformationDirty=!0;this.data=b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=c;this.material=
d;this.origin=null;this.center=a.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=n;f&&this.updateTransformation(f,g);this.castShadow=p;this.singleUse=k;this.name=q;this.uniqueName=m;this.idx=u;this.canBeMerged=!0;this.instanceParameters={}}b.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,this.center)};b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=
!0};b.prototype.getBoundingSphere=function(a,b,d){b=b||c.maxScale(a);c.multiplyVec3(a,this.boundingInfo.getCenter(),d);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=c.create()),
c.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return b}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/Logger ../../../../core/sniff ../lib/DrapedRenderer ../lib/gl-matrix ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/ProgramRepository ../lib/RenderOccludedHelper ../lib/ShaderSnippets ../lib/SSAOHelperObscurance ../lib/tracer ../lighting/Lightsources ../materials/repository ./Model ./Viewport ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C){var B=b.vec3d,D=b.vec4d,E=f.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function b(a,b,d,f){var h=this;this._backgroundColor=D.createFrom(1,1,1,1);this._lightDirection=B.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._screenCaptureQueue=[];this._container=a;this._stage=b;this._initializeContext(f);this._initializeShaders(f);this._textureRep=new e(b.getAll(x.ContentType.TEXTURE),
this._programRepository,function(){return h._viewport.getCamera().viewport},this._rctx);this._materialRep=new l(this._textureRep,this._programRepository);this._viewport=new v(this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,d);this._initializeFrameTask()}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},
enumerable:!0,configurable:!0});b.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){q.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=!0,a._viewport.render(a._lightDirection,null))},postRender:function(){q.end()},update:function(){a._performScreenCaptures();
a.resetNeedsRender()}}};b.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};b.prototype._initializeContext=function(b){this._canvas=b.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var c=A.createContextOrErrorHTML(this._canvas,{alpha:b.alpha||!1,premultipliedAlpha:!0,
antialias:!1,depth:!0,stencil:null==b.stencil?!0:b.stencil},b.renderContext);this._gl=q.instrumentContext(c);this._rctx=new C(this._gl,{disabledExtensions:b.deactivatedWebGLExtensions});!b.alpha&&this._rctx.contextAttributes.alpha&&E.error("WebGL context has alpha channel even though no alpha channel was requested");11<=a("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};b.prototype._initializeShaders=function(a){this._shaderSnippets=new p({fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",
vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:"global"===a.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n"});this._programRepository=new n;u.initializeShaders(this._shaderSnippets,this._programRepository,this._rctx);d.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);t.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);k.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);h.loadShaders(this._shaderSnippets,
this._programRepository,this._rctx)};b.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._gl=this._canvas=this._container=null};b.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};b.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=
!0};b.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};b.prototype.getFrameTask=function(){return this._frameTask};b.prototype.setLighting=function(a){B.set3(0,0,0,this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof
m.MainLight){B.negate(d.direction,this._lightDirection);break}}this._viewport.setLighting(a);this._needsRender=!0};b.prototype.getEdgeView=function(){return this._viewport.getEdgeView()};b.prototype.getMainLightDirection=function(){return this._lightDirection};b.prototype.getViewParams=function(a){var b=this._viewport.getViewParams(a);if(!a||a.backgroundColor)b.backgroundColor=this._backgroundColor;return b};b.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=
a.backgroundColor);this._viewport.setViewParams(a)};b.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};b.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(b.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});
b.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"standardDerivatives"===a?!!this._rctx.capabilities.standardDerivatives:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:"instancedRendering"===a?!!this._rctx.capabilities.instancing:!1};b.prototype.getFrustumObjects=function(){return this._viewport.getFrustumObjects()};b.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)};b.prototype.setCamera=function(a){this._viewport.setCamera(a)};
b.prototype.getCamera=function(){return this._viewport.getCamera()};b.prototype.getPickRay=function(a,b,c){this._viewport.getPickRay(a,b,c)};b.prototype.pickRayWithBeginPoint=function(a,b,c,d,e){this._viewport.pickRayWithBeginPoint(a,b,c,d,e)};b.prototype.getCanvas=function(){return this._canvas};b.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer};b.prototype.requestScreenCapture=function(a,b){this._screenCaptureQueue.push({settings:a||{},callback:b});this._needsRender=!0};
b.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()};b.prototype.getTextureLoaded=function(a){return this._textureRep.getIsLoaded(a)};b.prototype.addTextureListener=function(a){this._textureRep.addTextureListener(a)};b.prototype.removeTextureListener=function(a){this._textureRep.removeTextureListener(a)};b.prototype.addExternalRenderer=function(a,b){return this._viewport.addExternalRenderer(a,b)?(b.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,shaderSnippets:this._shaderSnippets,
programRep:this._programRepository,textureRep:this._textureRep}),!0):!1};b.prototype.removeExternalRenderer=function(a){return this._viewport.removeExternalRenderer(a)?(a.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0):!1};b.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var a=0;a<this._screenCaptureQueue.length;a++){var b=this._screenCaptureQueue[a],c=0,d=0,e=this._canvas.width,f=this._canvas.height,h=this._canvas.width,k=this._canvas.height,
l=b.settings.area;l&&(c=l.x,d=l.y,e=l.width,f=l.height);void 0!==b.settings.width&&void 0!==b.settings.height?(l=b.settings.width/b.settings.height,f*l<e?(l*=f,c+=Math.floor((e-l)/2),e=Math.floor(l)):(l=e/l,d+=Math.floor((f-l)/2),f=Math.floor(l)),h=b.settings.width,k=b.settings.height):(h=e,k=f);var n=this._canvas,l=null;if(0!==c||0!==d||e!==this._canvas.width||f!==this._canvas.height||h!==this._canvas.width||k!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=document.createElement("canvas"));
this._resizeCanvas.width=h;this._resizeCanvas.height=k;var q=this._resizeCanvas.getContext("2d"),l=new Uint8Array(e*f*4);this._gl.readPixels(c,this._canvas.height-(d+f),e,f,6408,5121,l);c=q.getImageData(0,0,h,k);y.resampleHermite(l,e,f,c.data,h,k,!0);q.putImageData(c,0,0);n=this._resizeCanvas;q=null}e={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[b.settings.format?b.settings.format.toLowerCase():"png"];f=1;void 0!==b.settings.quality&&(f=b.settings.quality/100);e={dataURL:n.toDataURL(e,f),
x:0,y:0,width:h,height:k};b.settings.returnByteBuffer&&(e.data=l);b.callback(e)}this._screenCaptureQueue=[]}};return b}()})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../support/debugFlags ./Camera ./ComponentUtils ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./HighlightUtils ./Renderer ./RenderPass ./Util ../lighting/Lightsources ../materials/internal/TexOnlyGLMaterial ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){var x=l.vec3d,v=l.vec4d,y=l.mat4d;r=function(){function a(a,b,c,d,e,f){var k=this;this._renderTargets={};this._clearColor=v.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=b;this._programRep=c;this._modelDirtySet=f;this._modelDirtySet.onMaterialChanged=function(a){return k.materialChanged(a)};this._renderer=new h(c,d,e,this._rctx,!0);this._renderer.onHasHighlightsChanged=function(a){if(k.onHasHighlightsChanged)k.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new p.AmbientLight(x.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}a.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};a.prototype.createRenderTarget=function(a){for(var b=a,c=0;this._renderTargets[b];)b=a+"_"+ ++c;this._renderTargets[b]=q.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,
hasMipmap:!0,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return b};a.prototype.disposeRenderTarget=function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};a.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};a.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[]);
if(this.onContentChanged)this.onContentChanged()};a.prototype.removeRenderGeometries=function(a){this._renderer.modify([],a);if(this.onContentChanged)this.onContentChanged()};a.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};a.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};
a.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};a.prototype.addRenderGeometryHighlight=function(a,b){var e=a.instanceParameters,f=d.generateHighlightId();e.componentHighlights=c.addHighlight(e.componentHighlights,null,b,f);this.updateRenderGeometries([a],32);return f};a.prototype.removeRenderGeometryHighlight=function(a,b){var d=a.instanceParameters;d.componentHighlights=c.removeHighlight(d.componentHighlights,b);this.updateRenderGeometries([a],
32)};a.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!f.OVERLAY_DRAW_TEST_TEXTURE};a.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});a.prototype.draw=function(a,b){return this.drawPass(n.MATERIAL,a,b)};a.prototype.drawHighlights=
function(a,b){return this.drawPass(n.MATERIAL_HIGHLIGHT,a,b)};a.prototype.drawPass=function(a,b,c){if(this.isEmpty()||a===n.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;this.processDirtyMaterials();if(!c.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;b=this._renderTargets[b];if(!b)return!1;var d=this._rctx,e=d.gl,h=c.width,k=c.height;if(b.width!==h||b.height!==k)b.resize(h,k),b.colorTexture.setSamplingMode(9729);C.near=1;C.far=1E4;d.bindFramebuffer(b);
d.setDepthTestEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);d.setClearColor.apply(d,this._clearColor);d.clear(e.COLOR_BUFFER_BIT);this._renderer.setPixelRatio(c.pixelRatio||1);for(e=0;e<c.views.length;e++){var l=c.views[e];C.viewport=l.viewport;y.ortho(0,l.extent[2]-l.extent[0],0,l.extent[3]-l.extent[1],C.near,C.far,C.projectionMatrix);y.identity(C.viewMatrix);y.translate(C.viewMatrix,[-l.extent[0],-l.extent[1],0]);C.setGLViewport(this._rctx);f.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(h,
k,A[c.index%A.length]);this._renderer.renderGeometryPass(a,C)}d.setDepthTestEnabled(!0);d.setBlendFunctionSeparate(770,771,1,771);d.bindFramebuffer(null);d.setViewport(0,0,this._canvas.width,this._canvas.height);b.colorTexture.generateMipmap();return!0};a.prototype._drawTestTexture=function(a,c,d){var f=this._rctx,h=f.gl;if(!this._testPatternMat){for(var l=new Uint8Array(a*c*4),n=0,q=0;q<c;q++)for(var p=0;p<a;p++){var g=Math.floor(p/10),t=Math.floor(q/10);2>g||2>t||10*g>a-20||10*t>c-20?(l[n++]=255,
l[n++]=255,l[n++]=255,l[n++]=255):(l[n++]=255,l[n++]=255,l[n++]=255,g&1&&t&1?l[n++]=p&1^q&1?0:255:l[n++]=g&1^t&1?0:128)}a=new m(f,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:c},l);this._testPatternMat=new k(this._programRep,a,[1,1,1,1],!0,h.ALWAYS);this._testPatternBindParams={proj:y.identity(),view:y.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0};this._quadVAO=e.createQuadVAO(f,b.Pos3Tex)}this._testPatternMat.setColor([d[0],
d[1],d[2],1]);this._testPatternMat.bind(f,this._testPatternBindParams);this._testPatternMat.bindView(f,this._testPatternBindParams);f.bindVAO(this._quadVAO);f.drawArrays(5,0,u.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(f)};a.prototype.getOrigin=function(a,b){var c=0;b=10*b/1E4;1<b&&(c=Math.ceil(t.logWithBase(b,2)));b=1E4*Math.pow(2,c);var d=Math.round(a[0]/b),e=Math.round(a[1]/b);a=Math.round(a[2]/b);var c=c+"_"+d+"_"+e+"_"+a,f=this._id2origin[c];null==f&&(f={vec3:x.createFrom(d*
b,e*b,a*b),id:c},this._id2origin[c]=f);return f};a.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};return a}();var A=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],C=new a;return r})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ./ComponentUtils ./DefaultVertexAttributeLocations ./ExternalRendererContainer ./Float32ArrayList ./FxaaRenderPass ./gl-matrix ./HighlightTextureHelper ./InstanceBufferData ./IntervalUtilities ./LinearDepthTextureHelper ./NormalTextureHelper ./RenderContext ./RenderPass ./RenderSlot ./SmaaRenderPass ./StencilRenderingHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/BufferObject ../../../webgl/Profiling ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F){function L(a){return a.instanceParameters.hidden?[]:f.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)}function G(a,b,c){var d=a.origin.vec3;v.setMatrixTranslation3(W,-d[0],-d[1],-d[2]);M.multiply(W,a.transformation,b);M.inverse(b,c);M.transpose(c)}function P(a,b,c){for(var d in a){var e=a[d];b(d,e);for(var f in e.origin2data)c(f,e.origin2data[f])}}function J(a){return!1===a.preinterleaved?v.getFirstObjectValue(a.indices).length:
a.indexCount}r=e.vec2d;var M=e.mat4d,O=M.identity();e=function(){function e(a,b,e,f,h){this._lighting=new A.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._externalRenderers=new c;this._renderContext=new k;this._isRendering=!1;this._highlights=[];this._pixelRatio=1;this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new aa;this._edgeView=null;this.ssaoEnabled=this._edgeViewLoaded=!1;
this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};this._programRep=a;this._materialRep=b;this._orderedRendering=h;this._rctx=f;this._fxaaPass=new l(f);this._smaaPass=new u(f);this._renderContext.rctx=f;this._renderContext.lightingData=this._lighting.getOld();f.setDepthTestEnabled(!0);f.setFaceCullingEnabled(!0);f.setBlendingEnabled(!1);f.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,
framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null};this._linearDepthTextureHelper=new t(f);this._normalTextureHelper=new p(f);this._highlightTextureHelper=new d(f);this._stencilRenderingHelper=new x(f);this._initializeFramebufferTexture()}e.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new E(this._rctx,{target:3553,pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});
this._framebuffer={format:a,texture:b}};e.prototype.dispose=function(){var a=this,b=function(b){a._releaseMaterials(b)},c=function(a,b){if(b.type===N.Preinterleaved)for(var c in b.instances)b.instances[c].vao.dispose(!0);else b.vao.dispose(!0)};P(this._mat2DataMerged,b,c);P(this._mat2DataInstanced,b,c);P(this._mat2DataPreinterleaved,b,c);this._mat2DataPreinterleaved=this._mat2DataInstanced=this._mat2DataMerged=null;this._framebuffer.texture.dispose();this._framebuffer.texture=null;this._linearDepthTextureHelper.getEnableState()&&
this._linearDepthTextureHelper.disable();this._normalTextureHelper.getEnableState()&&this._normalTextureHelper.disable();this._highlightTextureHelper.getEnableState()&&this._highlightTextureHelper.setEnableState(!1);this._stencilRenderingHelper.getEnableState()&&this._stencilRenderingHelper.setEnableState(!1);this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null)};Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===
this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"edgeView",{get:function(){var a=this;this._edgeViewLoaded||(this._edgeViewLoaded=!0,y.EdgeView.isSupported(this._rctx)&&(this._edgeView=new y.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){a._needsRender=!0}}),this._edgeView.initialize()));return this._edgeView},enumerable:!0,configurable:!0});e.prototype.setLighting=function(a){this._lighting.set(a)};
e.prototype.setPixelRatio=function(a){this._pixelRatio=a;this._needsRender=!0};e.prototype.getPixelRatio=function(){return this._pixelRatio};e.prototype.addExternalRenderer=function(a,b){this._externalRenderers.addRenderer(a,b);return!0};e.prototype.removeExternalRenderer=function(a){this._externalRenderers.removeRenderer(a);return!0};e.prototype.getExternalRenderers=function(){return this._externalRenderers};e.prototype.resetNeedsRender=function(){this._needsRender=!1;this._externalRenderers.resetNeedsRender()};
e.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()};e.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;var b=function(){},c=function(b,c){if(c.type===N.Preinterleaved)for(var d in c.instances)b=c.instances[d].vao.size,a._stats.VBOallocatedSize+=b/4,a._stats.VBOusedSize+=b/4,a._stats.VBOoptimalSize+=b/4;else a._stats.VBOallocatedSize+=c.buffer.getArray().length,a._stats.VBOusedSize+=
c.buffer.getSize(),a._stats.VBOoptimalSize+=c.optimalCount};P(this._mat2DataMerged,b,c);P(this._mat2DataInstanced,b,c);P(this._mat2DataPreinterleaved,b,c);this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};e.prototype._addHighlight=function(a){var b=this._getInstance(a);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),
this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};e.prototype._removeHighlight=function(a){var b=this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(e.prototype,"hasHighlights",
{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});e.prototype._renderHUDVisibility=function(a){var b=this,c=C.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.getEnableState();c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){b._renderInternalSlot(m.OCCLUSION_PIXELS,a)})};e.prototype.renderGeometrySlotsPt1=function(a){this._externalRenderers.render(m.INTERNAL_MATERIAL,a);this._renderInternalSlot(m.STENCIL_MATERIAL,
a);this._externalRenderers.render(m.OPAQUE_TERRAIN,a);this._renderInternalSlot(m.OPAQUE_MATERIAL,a);this._externalRenderers.render(m.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._externalRenderers.render(m.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext);this._renderInternalSlot(m.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(m.LINE_CALLOUTS,this._renderContext));this._externalRenderers.render(m.TRANSPARENT_EXTERNAL,
a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};e.prototype.renderGeometrySlotsPt2=function(a){this._externalRenderers.render(m.TRANSPARENT_TERRAIN,a)};e.prototype.renderGeometrySlots=function(a){this.renderGeometrySlotsPt1(a);this.renderGeometrySlotsPt2(a)};e.prototype._renderHighlights=function(a,b,c){var d=!!c&&c.getEnableState()&&(this.hasHighlights||this._externalRenderers.needsHighlight());this._highlightTextureHelper.setEnableState(d);if(d){d=null;c.profilingCallback&&(d=D.startMeasurement(this._renderContext.rctx));
this._highlightTextureHelper.setupFBOs(a);this._highlightTextureHelper.prepareHighlightPass();this.renderGeometryPass(q.MATERIAL_HIGHLIGHT,a,null,null);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this._renderInternalSlot(m.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(m.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(m.HUDMATERIAL2,this._renderContext);this._highlightTextureHelper.finish(b);var e=this._highlightTextureHelper.getHighlightFBO();c.render(a,b,e);
null!==d&&c.profilingCallback&&d.stop(function(a){c.profilingCallback&&c.profilingCallback(a)})}};e.prototype._needsRenderOccluded=function(a){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b][0];if(c&&c.renderOccluded&&c.beginSlot(a)&&c.isVisible())return!0}return!1};e.prototype._renderOccluded=function(a,b,c){if(b&&c&&c.getEnableState()){var d=this._needsRenderOccluded(m.OPAQUE_MATERIAL)||this._needsRenderOccluded(m.TRANSPARENT_MATERIAL);d!==b.getEnableState()&&b.setEnableState(d);
d&&(d=this._renderContext,b.setupFBOs(a),b.prepareColorPass(),d.pass=q.MATERIAL,d.renderOccludedOnly=!0,this._renderInternalSlot(m.OPAQUE_MATERIAL,d),this._renderInternalSlot(m.TRANSPARENT_MATERIAL,d),d.renderOccludedOnly=!1,b.finish(c.getFramebuffer()),b.apply())}};e.prototype._renderUnordered=function(a,b,c,d){var e=this,f=this._rctx;this._isRendering=!0;this._stats.reset();this._updateGlobalUniforms(a.projectionMatrix);this._renderContext.pass=q.MATERIAL;this._renderContext.camera=a;this._renderContext.pixelRatio=
this._pixelRatio;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=d.ssao;this._renderContext.offscreenRenderingHelper=d.offscreenRendering;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.highlight=this._highlightTextureHelper.getHighlightFBO();this._renderContext.options=this.renderOptions;d.offscreenRendering.setEnableState(!0);
d.offscreenRendering.initializeFrame(a);this._externalRenderers.render(m.BACKGROUND,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this.edgeView.shouldRender()&&(b=null,this._edgeView.profilingCallback&&(b=D.startMeasurement(this._renderContext.rctx)),d.offscreenRendering.renderSeparateAndComposite(function(){e._edgeView.render(e._bindParameters)},void 0,"alpha"),b&&b.stop(function(a){e._edgeView&&e._edgeView.profilingCallback&&e._edgeView.profilingCallback(a)}));
this.renderGeometrySlotsPt2(this._renderContext);this._externalRenderers.render(m.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,this._renderContext);this._externalRenderers.render(m.POSTPROCESSING_EXTERNAL,this._renderContext);this.renderOptions.earlyOcclusionPixelDraw||(this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(m.LINE_CALLOUTS,this._renderContext));this._renderOccluded(a,d.renderOccluded,d.offscreenRendering);b=this.renderOptions.antialiasing;"smaa"===b&&this._smaaPass.loadResources(function(){e._needsRender=
!0});"smaa"===b&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:d.offscreenRendering.getColorTexture()},null)):"fxaa"===b&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:d.offscreenRendering.getColorTexture()},null)):(d.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable());f.bindFramebuffer(null);this._renderContext.framebufferTex=d.offscreenRendering.getColorTexture();this._renderInternalSlot(m.LINE_CALLOUTS_HUD_DEPTH,
this._renderContext);this._renderInternalSlot(m.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(m.HUDMATERIAL2,this._renderContext);this._renderHighlights(a,c,d.highlight);this._isRendering=!1};e.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights(this._highlights)};e.prototype._renderGeometryPassOrderedMaterial=function(a){for(var b=null,c=0;c<this._renderOrder.length;c++){var d=this._renderOrder[c][1];if(d.instanced){var e=d.instanced||d.merged,f=
e[a.pass];f&&f.isVisible()&&(this._renderInternalInstanced(e,f,this._bindParameters,Infinity),b=null)}d.merged&&(e=d.merged,(f=e[a.pass])&&f.isVisible()&&(d=f.getProgram(),d!==b&&(d.setUniformMatrix4fv("model",O),d.hasUniform("modelNormal")&&d.setUniformMatrix4fv("modelNormal",O)),b=d,this._renderInternalMerged(e,f,this._bindParameters,Infinity)))}};e.prototype._renderGeometryPassOrdered=function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;
this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;S[0]=b.near;S[1]=b.far;this._bindParameters.nearFar=S;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=a.pixelRatio;a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)};e.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,
b)};e.prototype.render=function(a,b,c){this._orderedRendering?this._renderOrdered(q.MATERIAL,a):this._renderUnordered(a,c.shadowMap,b,c)};e.prototype.renderAuxiliaryBuffers=function(a,b,c){var d=c.ssao;c=c.shadowMap;var e=this.ssaoEnabled||this._externalRenderers.needsLinearDepth();this._linearDepthTextureHelper.setEnableState(e);e&&(this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(q.MATERIAL_DEPTH,a,c,d),this._linearDepthTextureHelper.finish(b));
this._normalTextureHelper.setEnableState(this.ssaoEnabled);this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(a),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(q.MATERIAL_NORMAL,a,c,d),this._normalTextureHelper.finish(b));this.ssaoEnabled&&d.computeSSAO(a,b,this._linearDepthTextureHelper.getDepthFBO(),this._normalTextureHelper.getNormalFBO());d.bindAll(this._programRep)};e.prototype.renderGeometryPass=function(a,b,c,d){this._isRendering=!0;this._updateGlobalUniforms(b.projectionMatrix);
this._renderContext.pass=a;this._renderContext.camera=b;this._renderContext.pixelRatio=this._pixelRatio;this._renderContext.shadowMap=c;this._renderContext.ssaoHelper=d;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);this._isRendering=!1};e.prototype._renderGeometryPassUnordered=
function(a){this.renderGeometrySlots(a)};e.prototype._renderInternalHighlights=function(a,b){void 0===b&&(b=null);for(var c=0;c<a.length;++c){var d=a[c],e=d.matData[q.MATERIAL_HIGHLIGHT];e&&(null===b||e.beginSlot(b))&&e.isVisible()&&this._renderInternalHighlight(d,this._bindParameters,q.MATERIAL_HIGHLIGHT)}};e.prototype._renderInternalSlotOccluded=function(a,b){for(var c in this._mat2DataInstanced){var d=this._mat2DataInstanced[c],e=d[b.pass];e&&e.renderOccluded&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalInstanced(d,
e,this._bindParameters,a)}};e.prototype._renderInternalSlotMaterial=function(a,b){for(var c in this._mat2DataInstanced){var d=this._mat2DataInstanced[c],e=d[b.pass];e&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalInstanced(d,e,this._bindParameters,a)}for(var d=this._programRep.getProgramsUsingUniform("model"),e=this._programRep.getProgramsUsingUniform("modelNormal"),f=0;f<d.length;f++){var h=d[f];h.setUniformMatrix4fv("model",O);-1<e.indexOf(h)&&h.setUniformMatrix4fv("modelNormal",O)}for(c in this._mat2DataMerged)d=
this._mat2DataMerged[c],(e=d[b.pass])&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalMerged(d,e,this._bindParameters,a);for(c in this._mat2DataPreinterleaved)d=this._mat2DataPreinterleaved[c],(e=d[b.pass])&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalPreinterleaved(d,e,this._bindParameters,a);a===m.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish()};e.prototype._renderInternalSlotHighlights=function(a,b){this._renderInternalHighlights(this._highlights,a)};e.prototype._renderInternalSlot=
function(a,b){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;S[0]=b.camera.near;S[1]=b.camera.far;var c=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=S;this._bindParameters.lightingData=b.lightingData;this._bindParameters.viewport=b.camera.fullViewport;
this._bindParameters.framebufferTex=c?c.getColorTexture():null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.getEnableState();this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.getEnableState();this._bindParameters.pixelRatio=b.pixelRatio;this._bindParameters.hudVisibilityTexture=c?c.getHUDVisibilityTexture():null;b.isHighlightPass?this._renderInternalSlotHighlights(a,b):b.renderOccludedOnly?this._renderInternalSlotOccluded(a,
b):this._renderInternalSlotMaterial(a,b)};e.prototype._renderInternalInstanced=function(a,b,c,d){var e=this._rctx,f=e.gl,h=!1,k=b.getDrawMode(e),l=e.capabilities.instancing,n;for(n in a.origin2data){var q=a.origin2data[n];c.origin=q.origin;d===m.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());var p=!1;if(b.instanced)for(var g in q.perGeometryDataInfo){var u=q.perGeometryDataInfo[g];h||(b.bind(e,c),h=!0);e.bindVAO(u.vao);var t=
b.getProgram();H.assertCompatibleVertexAttributeLocations(u.vao,t);p||(b.bindView(e,c),p=!0);var t=u.to-u.from,v=u.refCount;k===f.TRIANGLES&&(this._stats.trianglesRendered+=v*t/3);l.drawArraysInstanced(k,u.from,t,v);this._stats.drawCallsAngleInstanced++;this._stats.instancesDrawnAngle+=v}else{var u=q.instances,A;for(A in u)t=u[A],v=t.displayedIndexRange,v&&0===v.length||(h||(b.bind(e,c),h=!0),p||(e.bindVAO(q.vao),b.bindView(e,c),p=!0),b.bindInstance(e,t),this._stats.drawCallsInstanced++,k===f.TRIANGLES&&
(this._stats.trianglesRendered+=(t.to-t.from)/3),v?this._drawArraysFaceRange(v,t.from,k):e.drawArrays(k,t.from,t.to-t.from))}}e.bindVAO(null);h&&b.release(e,c)};e.prototype._renderInternalHighlight=function(a,b,c){var d=this._rctx,e=d.gl;c=a.matData[c];var f=c.getDrawMode(d),h=a.instance,k=h.highlightedIndexRange,l=this._renderContext.offscreenRenderingHelper,l=(l?l.getDepthTexture():null)||this._getFallbackDepthTexture(),n=c.getProgram(),q=d.capabilities.instancing;b.origin=a.originData.origin;if(c.instanced&&
a.type===N.Instanced)for(a=a.instancedVAO,c.bind(d,b),d.bindVAO(a),H.assertCompatibleVertexAttributeLocations(a,n),c.bindView(d,b),a=0;a<k.length;a++){var m=k[a],p=m.range?m.range[0]+h.from:h.from,m=m.range?m.range[1]-m.range[0]+1:h.to-h.from;d.bindTexture(l,5);n.setUniform1i("depthTex",5);n.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);q.drawArraysInstanced(f,p,m,1);f===e.TRIANGLES&&(this._stats.trianglesRendered+=1*m/3);this._stats.drawCallsHighlight++}else if(a.type===
N.Instanced&&c.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{c.bind(d,b);c.bindView(d,b);q=null;switch(a.type){case N.Merged:p=a.originData;d.bindVAO(p.vao);n.setUniformMatrix4fv("model",O);break;case N.Instanced:p=a.originData;d.bindVAO(p.vao);c.bindInstance(d,h);break;case N.Preinterleaved:p=a.originData,a=p.instances[a.uniqueName].vao,d.bindVAO(a),c.bindInstance(d,h),q=a.indexBuffer&&a.indexBuffer.indexType}for(a=0;a<k.length;a++){m=k[a];p=m.range?m.range[0]+
h.from:h.from;m=m.range?m.range[1]-m.range[0]+1:h.to-h.from;d.bindTexture(l,5);c.getProgram().setUniform1i("depthTex",5);n.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);if(q){var g=H.getBytesPerElement(q);d.drawElements(f,m,q,p*g)}else d.drawArrays(f,p,m);f===e.TRIANGLES&&(this._stats.trianglesRendered+=m/3);this._stats.drawCallsHighlight++}}d.bindVAO(null);c.release(d,b)};e.prototype._drawArraysFaceRange=function(a,b,c){for(var d=
this._rctx,e=0;e<a.length;e++){var f=a[e];d.drawArrays(c,f[0]+b,f[1]-f[0]+1)}this._stats.drawCallsFragmented+=a.length-1};e.prototype._drawElementsFaceRange=function(a,b,c,d){for(var e=this._rctx,f=H.getBytesPerElement(d),h=0;h<a.length;h++){var k=a[h];e.drawElements(c,k[1]-k[0]+1,d,(k[0]+b)*f)}this._stats.drawCallsFragmented+=a.length-1};e.prototype._renderInternalMerged=function(a,b,c,d){var e=this._rctx,f=e.gl,h=!1,k;for(k in a.origin2data){var l=a.origin2data[k];c.origin=l.origin;d===m.STENCIL_MATERIAL&&
(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());if(!l.displayedIndexRange||0!==l.displayedIndexRange.length){h||(b.bind(e,c),h=!0);var n=b.getProgram();e.bindVAO(l.vao);H.assertCompatibleVertexAttributeLocations(l.vao,n);b.bindView(e,c);this._stats.drawCallsMerged++;n=b.getDrawMode(e);n===f.TRIANGLES&&(this._stats.trianglesRendered+=l.vao.vertexBuffers.geometry.size/3);l.displayedIndexRange?this._drawArraysFaceRange(l.displayedIndexRange,0,
n):e.drawArrays(n,0,H.vertexCount(l.vao,"geometry"))}}h&&b.release(e,c)};e.prototype._renderInternalPreinterleaved=function(a,b,c,d){var e=this._rctx,f=e.gl,h=!1,k=b.getDrawMode(e),l;for(l in a.origin2data){var n=a.origin2data[l];c.origin=n.origin;var q=!1;d===m.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());for(var p in n.instances){var g=n.instances[p],u=g.instance,t=g.vao,g=u.displayedIndexRange;if(!g||0!==g.length){h||
(b.bind(e,c),h=!0);var v=b.getProgram();H.assertCompatibleVertexAttributeLocations(t,v);e.bindVAO(t);q||(b.bindView(e,c),q=!0);b.bindInstance(e,u);this._stats.drawCallsPreinterleaved++;k===f.TRIANGLES&&(this._stats.trianglesRendered+=(u.to-u.from)/3);t=t.indexBuffer&&t.indexBuffer.indexType;g?t?this._drawElementsFaceRange(g,u.from,k,t):this._drawArraysFaceRange(g,u.from,k):t?(g=H.getBytesPerElement(t),e.drawElements(k,u.to-u.from,t,u.from*g)):e.drawArrays(k,u.from,u.to-u.from)}}}e.bindVAO(null);h&&
b.release(e,c)};e.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};e.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,
b=Object.keys(this._mat2DataInstanced).length,c=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+a+"/"+b+"/"+c);var d=0;P(this._mat2DataMerged,function(){},function(a,b){d+=Object.keys(b.instances).length});var e=0;P(this._mat2DataInstanced,function(){},function(a,b){e+=Object.keys(b.instances).length});var f=0;P(this._mat2DataPreinterleaved,function(){},function(a,b){f+=Object.keys(b.instances).length});console.log("number of instances (merged/instanced/preinterleaved): "+
d+"/"+e+"/"+f)};e.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var b=this._mat2DataInstanced[a],c;for(c in b.origin2data)if(!v.objectEmpty(b.origin2data[c].instances))return!1}for(a in this._mat2DataMerged)for(c in b=this._mat2DataMerged[a],b.origin2data)if(!v.objectEmpty(b.origin2data[c].instances))return!1;for(a in this._mat2DataPreinterleaved)for(c in b=this._mat2DataPreinterleaved[a],b.origin2data)if(!v.objectEmpty(b.origin2data[c].instances))return!1;return!0};e.prototype.modify=
function(a,b,c,d){this._isRendering&&console.warn("Renderer.modify called while rendering");var e=[],f=[],h=[];this._classifyRenderGeometry(a,e,f,h);a=[];var k=[],l=[];this._classifyRenderGeometry(b,a,k,l);var n={};c&&this._performUpdates(c,n);c=[];this._modifyMerged(e,a,c,n);this._modifyInstanced(f,k,c);this._modifyPreinterleaved(h,l,c);this._updateMergedFaceranges(n);this._releaseMaterials(c);e=this._highlights.length;if(b&&0<b.length&&0<e&&(this._highlights=this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===
a.uniqueName})}),e!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);this._updateHighlightVAOs();d&&this._modifyMaterials(d);this._needsRender=!0};e.prototype._classifyRenderGeometry=function(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if(1<=J(f.data))switch(this._getType(f)){case N.Merged:b.push(f);break;case N.Instanced:c.push(f);break;case N.Preinterleaved:d.push(f)}}};e.prototype._performUpdates=function(a,b){for(var c=0;c<a.length;c++){var d=
a[c],e=d.updateType,d=d.renderGeometry,f=this._getType(d)===N.Merged;if(1<=J(d.data)){e&2&&this._updateFaceranges(d,b);if(e&32){var h=this._getInstance(d);h&&this._updateHighlightFaceranges(d,h.instance)}e&4||f&&e&16?this._updateVertexAttributes(d,!f):!f&&e&16&&this._updateInstanceTransformation(d)}}};e.prototype._updateFaceranges=function(a,b){var c=a.material.id,d=a.origin.id,e=this._getType(a),f;if(e===N.Preinterleaved){var h=this._getOriginData(e,c,d);f=h.instances[a.uniqueName].instance}else h=
this._getOriginData(e,c,d),(f=h.instances[a.uniqueName])&&e===N.Merged&&(b[this._modifiedMergedFacerangesKey(c,d)]=h);f&&(f.displayedIndexRange=L(a),this._updateHighlightFaceranges(a,f))};e.prototype._updateHighlightFaceranges=function(a,b){if(b){var c=b.highlightedIndexRange,d;d=a.instanceParameters.hidden?[]:f.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets);(b.highlightedIndexRange=d)&&!c?this._addHighlight(a):
!d&&c&&this._removeHighlight(a)}};e.prototype._updateMergedFaceranges=function(a){for(var b in a){var c=a[b];c.displayedIndexRange=[];var d=c.instances,e=!0,f;for(f in d){var h=d[f];h.displayedIndexRange?(c.displayedIndexRange.push.apply(c.displayedIndexRange,n.offsetIntervals(h.displayedIndexRange,h.from)),e=!1):c.displayedIndexRange.push([h.from,h.to-1])}c.displayedIndexRange=e?null:n.mergeIntervals(c.displayedIndexRange)}};e.prototype._updateVertexAttributes=function(a,b){var c=a.material,d=c.id,
e=a.origin.id,f=H.getStride(c.getVertexBufferLayout())/4,h=this._getType(a);if(h===N.Preinterleaved)console.error("Updating Preinterleaved geometry not supported");else{var h=this._getOriginData(h,d,e),d=h.instances[a.uniqueName],e=h.buffer.getArray(),h=h.vao,k,l;b||(G(a,X,Q),k=X,l=Q);c.fillInterleaved(a.data,k,l,a.instanceParameters,e,d.from*f);v.assert(d.from+c.getOutputAmount(J(a.data))/f===d.to,"material VBO layout has changed");h.vertexBuffers.geometry.setSubData(e,d.from*f*4,d.from*f*4,d.to*
f*4)}};e.prototype._updateInstanceTransformation=function(a){var b=this._getType(a),c=a.material.id,d=a.origin.id;b===N.Preinterleaved?(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName].instance,G(a,d.transformation,d.transformationNormal)):(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName],b=b.perGeometryDataInfo[a.data.id],c=b.instanceBufferData,G(a,d.transformation,d.transformationNormal),c&&(a=c.getSlot(a.idx),c.fill(a,0,d.transformation),c.fill(a,16,d.transformationNormal),a=4*
c.getOffset(a),d=H.getStride(b.vao.layout.instance),b.vao.vertexBuffers.instance.setSubData(c.getArray(),a,a,a+d)))};e.prototype._modifyMerged=function(c,d,e,f){var h=this._rctx,k=N.Merged;c=this._compMatToDelta(c,d,k);d=this._mat2DataMerged;for(var l in c){var n=c[l],q;for(q in n){var m=n[q],p=m.optimalCount,g=m.material,u=g.getVertexBufferLayout(),t=H.getStride(u)/4,A=d[l];if(null==A){v.assert(0<p);var y=g.renderPriority,A=this._initializeMatData(g);d[l]=A;this._orderedRendering&&this._insertIntoRenderOrder(A,
y,"merged")}y=A.origin2data[q];null==y&&(v.assert(0<p),y={type:k,instances:{},vao:new F(h,a.Default3D,{geometry:u},{geometry:B.createVertex(h,35044)}),buffer:new b(p),optimalCount:0,origin:m.origin},A.origin2data[q]=y);if(0<p){var u=y.buffer.getSize(),x=y.buffer.getArray(),A=p<m.sparseCount/2,C=y.buffer.resize(A?p:m.sparseCount),D=m.toRemove;if(A||C){for(var u=0,r=y.buffer.getArray(),A=0;A<D.length;++A)C=y.instances[D[A].uniqueName],y.optimalCount-=(C.to-C.from)*t,delete y.instances[D[A].uniqueName];
var A={},E;for(E in y.instances)C=y.instances[E],v.assert(null==A[C.from]),A[C.from]=C;for(var K in A){var C=A[K],T=C.from*t,I=C.to*t;r.set(x.subarray(T,I),u);C.from=u/t;u+=I-T;C.to=u/t}v.assert(u===y.optimalCount)}else for(A=0;A<D.length;++A)C=D[A].uniqueName,v.assert(void 0!==y.instances[C]),T=y.instances[C].from*t,I=y.instances[C].to*t,y.buffer.erase(T,I),delete y.instances[C],y.optimalCount-=I-T;v.setMatrixTranslation3(W,-m.origin[0],-m.origin[1],-m.origin[2]);x=m.toAdd;m=!1;for(A=0;A<x.length;++A)D=
x[A],T=D.data,M.multiply(W,D.transformation,X),M.inverse(X,Q),M.transpose(Q),C=u,g.fillInterleaved(T,X,Q,D.instanceParameters,y.buffer.getArray(),u),T=g.getOutputAmount(J(T)),r=C+T,v.assert(null==y.instances[D.uniqueName]),I=L(D),C=new V(D.name,C/t,r/t,I,void 0,void 0,D.idx),y.instances[D.uniqueName]=C,this._updateHighlightFaceranges(D,C),I&&(m=!0),y.optimalCount+=T,u+=T;v.assert(y.optimalCount===p);p=new Float32Array(y.buffer.getArray().buffer,0,y.buffer.getSize());y.vao.vertexBuffers.geometry.setData(p);
if(m||y.displayedIndexRange)f[this._modifiedMergedFacerangesKey(l,q)]=y}else v.assert(0===p),y.vao.dispose(!0),y.vao=null,delete A.origin2data[q],0===Object.keys(A.origin2data).length&&(e.push(l),delete d[l],this._orderedRendering&&this._removeFromRenderOrder(A,"merged"))}}};e.prototype._modifyInstanced=function(c,d,e){var f=this._rctx,k=N.Instanced;c=this._compMatToDelta(c,d,k);d=this._mat2DataInstanced;for(var l in c){var n=c[l],m;for(m in n){var p=n[m];if(0===p.optimalCount)p=d[l],p.origin2data[m].vao.dispose(!0),
delete p.origin2data[m],0===Object.keys(p.origin2data).length&&(e.push(l),delete d[l],this._orderedRendering&&this._removeFromRenderOrder(p,"instanced"));else{var g=p.material,u=d[l];if(null==u){var t=g.renderPriority,u=this._initializeMatData(g);d[l]=u;this._orderedRendering&&this._insertIntoRenderOrder(u,t,"instanced")}var A=g.getVertexBufferLayout(),y=u[q.MATERIAL].instanced?g.getInstanceBufferLayout():void 0,x=y&&H.findAttribute(y,"instanceColor"),C=y&&H.findAttribute(y,"instanceFeatureAttribute"),
D=H.getStride(A)/4,t=u.origin2data[m];null==t&&(t={type:k,instances:{},vao:new F(f,a.Default3D,{geometry:A},{geometry:B.createVertex(f,35044)}),buffer:new b(p.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:p.origin},u.origin2data[m]=t);var u=t.buffer.getSize(),r=t.buffer.getArray(),E=p.optimalCount<p.sparseCount/2,K=t.buffer.resize(E?p.optimalCount:p.sparseCount),T;for(T in p.perGeometryDelta){var I=t.perGeometryDataInfo[T];if(I&&I.instanceBufferData){var Y=p.perGeometryDelta[T].removeCount;
0<Y&&I.instanceBufferData.prepareFree(Y)}}var Q=p.toRemove;if(E||K){for(E=0;E<Q.length;++E){K=Q[E];delete t.instances[K.uniqueName];T=K.data.id;var O=I=t.perGeometryDataInfo[T];0===--O.refCount&&null==p.dataId2refCount[T]?(t.optimalCount-=(O.to-O.from)*D,delete t.perGeometryDataInfo[T]):I.instanceBufferData&&I.instanceBufferData.free(K.idx)}var u=0,E=t.buffer.getArray(),K={},G;for(G in t.perGeometryDataInfo)O=t.perGeometryDataInfo[G],v.assert(null==K[O.from]),K[O.from]=O;for(var P in K)O=K[P],Y=O.from*
D,I=O.to*D,E.set(r.subarray(Y,I),u),O.from=u/D,u+=I-Y,O.to=u/D;for(var aa in t.instances)Y=t.instances[aa],Y.from=t.perGeometryDataInfo[Y.dataId].from,Y.to=t.perGeometryDataInfo[Y.dataId].to}else for(E=0;E<Q.length;++E)K=Q[E],delete t.instances[K.uniqueName],T=K.data.id,I=t.perGeometryDataInfo[T],0===--I.refCount&&null==p.dataId2refCount[T]?(Y=I.from*D,I=I.to*D,t.buffer.erase(Y,I),t.optimalCount-=I-Y,delete t.perGeometryDataInfo[T]):I.instanceBufferData&&I.instanceBufferData.free(K.idx);v.setMatrixTranslation3(W,
-p.origin[0],-p.origin[1],-p.origin[2]);for(T in p.perGeometryDelta)(I=t.perGeometryDataInfo[T])&&I.instanceBufferData&&(E=p.perGeometryDelta[T].addCount,0<E&&I.instanceBufferData.prepareAllocate(E));r=p.toAdd;for(E=0;E<r.length;++E)if(K=r[E],Y=K.data,T=Y.id,I=t.perGeometryDataInfo[T],null==I?(g.fillInterleaved(Y,void 0,void 0,void 0,t.buffer.getArray(),u),Q=g.getOutputAmount(J(Y)),Y=u/D,u+=Q,I=u/D,t.optimalCount+=Q,I={refCount:1,from:Y,to:I,vao:null,instanceBufferData:null},y&&(Y=H.getStride(y)/
4,I.vao=new F(f,a.Default3D,{geometry:A,instance:y},{geometry:t.vao.vertexBuffers.geometry,instance:B.createVertex(f,35044)}),I.instanceBufferData=new h(Y,p.perGeometryDelta[T].addCount)),t.perGeometryDataInfo[T]=I):++I.refCount,v.assert(I.from*D<=t.buffer.getSize()&&I.to*D<=t.buffer.getSize()),Y=M.create(),M.multiply(W,K.transformation,Y),Q=L(K),Y=new V(K.name,I.from,I.to,Q,Y,K.instanceParameters,K.idx,T),t.instances[K.uniqueName]=Y,this._updateHighlightFaceranges(K,Y),I=I.instanceBufferData)Q=I.allocate(K.idx),
I.fill(Q,0,Y.transformation),I.fill(Q,16,Y.transformationNormal),x&&I.fill(Q,x.offset/4,K.instanceParameters.color),C&&I.fill(Q,C.offset/4,K.instanceParameters.featureAttribute);v.assert(t.optimalCount===p.optimalCount);g=new Float32Array(t.buffer.getArray().buffer,0,t.buffer.getSize());t.vao.vertexBuffers.geometry.setData(g);for(T in t.perGeometryDataInfo)if(A=t.perGeometryDataInfo[T],A.vao&&(g=A.vao.vertexBuffers.instance))y=p.perGeometryDelta[T],0<y.addCount+y.removeCount&&(A=A.instanceBufferData.compact(),
g.setData(A))}}}};e.prototype._modifyPreinterleaved=function(b,c,d){for(var e=this._rctx,f=N.Preinterleaved,h=this._mat2DataPreinterleaved,k=0;k<b.length;k++){var l=b[k],n=l.material,m=n.id,q=l.origin.id,p=l.origin.vec3,g=h[m];null==g&&(g=this._initializeMatData(n),h[m]=g);m=g.origin2data[q];null==m&&(m={type:f,origin:p,count:0,instances:{}},g.origin2data[q]=m);v.setMatrixTranslation3(W,-p[0],-p[1],-p[2]);g=M.create();M.multiply(W,l.transformation,g);p=L(l);q=l.data;q.preinterleaved?null==q.vertexData?
v.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available."):(g=new V(l.name,0,q.indexCount,p,g,l.instanceParameters,l.idx,q.id),p=q.indexData?B.createIndex(e,35044,q.indexData):null,n=n.getVertexBufferLayout(),n=new F(e,a.Default3D,{geometry:n},{geometry:B.createVertex(e,35044)},p),n.vertexBuffers.geometry.setData(q.vertexData),q.vertexData=null,m.count+=1,m.instances[l.uniqueName]={instance:g,vao:n},this._updateHighlightFaceranges(l,g)):v.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(b=
0;b<c.length;b++)l=c[b],p=l.origin,n=l.material,m=n.id,q=p.id,l=l.uniqueName,g=h[m],e=g.origin2data[q],e.instances[l].vao.dispose(),delete e.instances[l],--e.count,0===e.count&&delete g.origin2data[q],0===Object.keys(g.origin2data).length&&(d.push(m),delete h[m])};e.prototype._compMatToDelta=function(a,b,c){var d={};this._updateMatToDelta(a,!0,c,d);this._updateMatToDelta(b,!1,c,d);return d};e.prototype._updateMatToDelta=function(a,b,c,d){c=c===N.Instanced;for(var e=0;e<a.length;e++){var f=a[e],h=
f.origin,k=f.material,l=k.id,n=c?this._mat2DataInstanced[l]:this._mat2DataMerged[l],n=n&&n.origin2data[h.id],m=d[l];null==m&&(m={},d[l]=m);l=m[h.id];if(null==l){l={optimalCount:null==n?0:n.optimalCount,sparseCount:null==n?0:n.buffer.getSize(),material:k,toAdd:[],toRemove:[],perGeometryDelta:null,origin:h.vec3};if(c){var q={};if(void 0!==n)for(var p in n.perGeometryDataInfo)q[p]=n.perGeometryDataInfo[p].refCount;l.dataId2refCount=q;l.perGeometryDelta={}}m[h.id]=l}h=k.getOutputAmount(J(f.data));c?(k=
f.data.id,n=l.perGeometryDelta[k],n||(n={addCount:0,removeCount:0},l.perGeometryDelta[k]=n),b?(n.addCount++,null==l.dataId2refCount[k]&&(l.dataId2refCount[k]=0),1===++l.dataId2refCount[k]&&(l.optimalCount+=h,l.sparseCount+=h),l.toAdd.push(f)):(n.removeCount++,0===--l.dataId2refCount[k]&&(delete l.dataId2refCount[k],l.optimalCount-=h),l.toRemove.push(f))):b?(l.optimalCount+=h,l.sparseCount+=h,l.toAdd.push(f)):(l.optimalCount-=h,l.toRemove.push(f))}};e.prototype._getType=function(a){if(a.data.preinterleaved)return N.Preinterleaved;
var b=!1,c=J(a.data),b=(b=(b=b||!1===a.material.canBeMerged)||a.material.instanced)||!0===a.material.renderOccluded;a.singleUse||(b=b||c>this._threshold);return b?N.Instanced:N.Merged};e.prototype._getTargetMat2Data=function(a){switch(a){case N.Merged:return this._mat2DataMerged;case N.Instanced:return this._mat2DataInstanced;case N.Preinterleaved:return this._mat2DataPreinterleaved}};e.prototype._getOriginData=function(a,b,c){return this._getTargetMat2Data(a)[b].origin2data[c]};e.prototype._modifiedMergedFacerangesKey=
function(a,b){return a+"_"+b};e.prototype._insertIntoRenderOrder=function(a,b,c){for(var d=a[q.MATERIAL].materialId,e=this._renderOrder.length,f=0;f<e&&this._renderOrder[f][0]>=b;){var h=this._renderOrder[f][1];if(h.id===d){v.assert(!h[c],"matData for type already exists");h[c]=a;return}f++}d={id:d,instanced:null,merged:null};d[c]=a;this._renderOrder.splice(f,0,[b,d])};e.prototype._removeFromRenderOrder=function(a,b){var c=a[q.MATERIAL].materialId;for(a=0;this._renderOrder[a][1].id!==c;)a++;c=this._renderOrder[a][1];
c[b]=null;c.instanced||c.merged||this._renderOrder.splice(a,1)};e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[q.MATERIAL].renderPriority;b=b.matData[q.MATERIAL].renderPriority;return a>b?-1:b>a?1:0})};e.prototype._updateRenderOrder=function(a,b){for(var c=b.length,d=0;d<c&&b[d][1].id!==a;)d++;if(d<c){a=b[d][1];a=(a.merged||a.instanced)[q.MATERIAL].renderPriority;var e=b[d][0];if(a!==b[d][0])for(b[d][0]=a,e=a>e?-1:1,d+=e;-1<d&&d<c&&e*b[d][0]>e*
a;){var f=b[d];b[d]=b[d-e];b[d-e]=f;d+=e}}};e.prototype._modifyMaterials=function(a){var b=this;a.forEach(function(a){b._materialRep.updateMaterialParameters(a)})};e.prototype.modifyRenderOrder=function(a){var b=this;this._orderedRendering&&(a.forEach(function(a){b._updateRenderOrder(a,b._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)};e.prototype._initializeMatData=function(a){var b={origin2data:{}};b[q.MATERIAL]=this._materialRep.aquire(a);b[q.MATERIAL_DEPTH_SHADOWMAP]=
this._materialRep.aquireDepthShadowMap(a);b[q.MATERIAL_NORMAL]=this._materialRep.aquireNormal(a);b[q.MATERIAL_DEPTH]=this._materialRep.aquireDepth(a);b[q.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(a);return b};e.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);
else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};e.prototype._getInstance=function(a){var b=a.uniqueName,c=a.material.id,d=this._getType(a),c=this._getTargetMat2Data(d)[c];if(!c)return null;a=c.origin2data[a.origin.id];if(!a)return null;var e;return(e=a.type===N.Preinterleaved?a.instances[b].instance:a.instances[b])?{type:d,uniqueName:b,instance:e,matData:c,originData:a,
instancedVAO:null,instancedVAOBaseInstance:null}:null};e.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,c=a.instance,d=a.originData;if(a.type===N.Instanced&&d.perGeometryDataInfo){var d=d.perGeometryDataInfo[c.dataId],e=d.instanceBufferData;e&&(d=d.vao,c=e.getSlot(c.idx),a.instancedVAOBaseInstance!==c&&(e=H.setBaseInstanceOffset(d.layout,c),a.instancedVAO=new F(b,d.locations,e,d.vertexBuffers,d.indexBuffer),a.instancedVAOBaseInstance=c))}};e.prototype._updateHighlightVAOs=function(){for(var a=
0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};e.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new E(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return e}();var aa=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=
this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),V=function(){return function(a,b,c,d,e,f,h,k){this.name=a;this.from=b;this.to=c;this.displayedIndexRange=d;this.transformation=e;this.instanceParameters=f;this.idx=h;this.dataId=k;null!=e&&(this.transformationNormal=M.create(),M.set(e,this.transformationNormal),M.inverse(this.transformationNormal,
this.transformationNormal),M.transpose(this.transformationNormal,this.transformationNormal))}}(),N;(function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"})(N||(N={}));var S=r.create(),W=M.identity(),X=M.create(),Q=M.create();return e})},"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":function(){define(["require","exports","./RenderSlot"],function(r,g,f){return function(){function a(){this.renderersChanged=!1;this.renderers=[];this.slots=
[];for(var a=0;a<f.MAX_SLOTS;++a)this.slots[a]=[]}a.prototype.addRenderer=function(a,b){this.renderers.push(b);for(var c=0;c<a.length;++c)this.slots[a[c]].push(b);this.renderersChanged=!0};a.prototype.removeRenderer=function(a){this.renderers=this.renderers.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});this.renderersChanged=!0};a.prototype.render=function(a,b){b.slot=a;var c=0;for(a=this.slots[a];c<a.length;c++){var e=
a[c];e.render(b)&&(e.didRender=!0)}};a.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsRender)return!0;return!1};a.prototype.needsHighlight=function(){for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsHighlight)return!0;return!1};a.prototype.needsLinearDepth=function(){for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsLinearDepth)return!0;return!1};a.prototype.resetNeedsRender=function(){this.renderersChanged=
!1;for(var a=0,b=this.renderers;a<b.length;a++){var f=b[a];f.resetNeedsRender?f.resetNeedsRender():f.didRender&&(f.needsRender=!1,f.didRender=!1)}};return a}()})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","./Util"],function(r,g,f){return function(){function a(a){null==a?a=16:65536>a&&(a=f.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,b){void 0===b&&(b=!1);this.size=a;var c;if(this.size>this.array.length){for(a=
this.array.length||1;a<this.size;)a*=2;c=new Float32Array(a);b&&c.set(this.array);this.array=c;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(c=2*this.size;a>=c;)a=Math.floor(a/2);c=new Float32Array(a);b&&c.set(this.array.subarray(0,a));this.array=c;return!0}return!1};a.prototype.append=function(a){var b=this.size;this.resize(this.size+a.length,!0);this.array.set(a,b)};a.prototype.erase=function(a,b){for(;a<b;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};
a.prototype.getSize=function(){return this.size};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define(["require","exports","../../../webgl/BufferObject","../../../webgl/Program","../../../webgl/VertexArrayObject"],function(r,g,f,a,c){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.enable=function(){if(!this.isEnabled){var b=
this.rctx;this.program=new a(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var e=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new f(b,34962,35044,e)});this.isEnabled=!0}};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);c.bindFramebuffer(b);var e=0,f=0;null!=b?(e=b.descriptor.width,f=b.descriptor.height):
(e=c.gl.canvas.width,f=c.gl.canvas.height);c.bindProgram(this.program);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/e,1/f);c.setFaceCullingEnabled(!1);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(r,g,f,a){return function(){function c(a){this._rctx=a;this.height=this.width=this.viewportToRestore=
this.fbo2=this.fbo=null}c.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};c.prototype.getEnableState=function(){return null!==this.fbo};c.prototype.getHighlightFBO=function(){return this.fbo};c.prototype.getBlurFBO=function(){return this.fbo2};c.prototype.enable=function(){f.assert(!this.getEnableState());this.fbo=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,
depthStencilTarget:1})};c.prototype.disable=function(){f.assert(this.getEnableState());this.fbo.dispose();this.fbo=null};c.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};c.prototype.prepareHighlightPass=function(){f.assert(this.getEnableState());var a=this._rctx,c=a.gl;this.fbo.resize(this.width,this.height);a.bindFramebuffer(this.fbo);a.setClearColor(0,0,0,
0);a.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};c.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return c}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","./Util"],function(r,g,f){return function(){function a(a,b){null==b&&(b=4);var c=f.nextHighestPowerOfTwo(b*a);this.array=new Float32Array(c);this.zeroItem=
new Float32Array(a);this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(b)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var b;b=0<this.emptySlotsIdx?
this.emptySlots[--this.emptySlotsIdx]:this.endSlot++;this.id2slot[a]=b;this.slot2id[b]=a;return b};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=function(){return this.array};a.prototype.fill=function(a,b,f){this.array.set(f,a*this.perInstanceDataSize+b)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-
b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,b=this.emptySlots[this.emptySlotsIdx],f=a*this.perInstanceDataSize,e=b*this.perInstanceDataSize;this.array.set(this.array.subarray(f,f+this.perInstanceDataSize),e);this.array.set(this.zeroItem,f);f=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[b]=f;this.id2slot[f]=b;this.endSlot--}}this._resizeArray(this.endSlot*
this.perInstanceDataSize);this.emptySlots.length=0;return this.array};a.prototype._resizeArray=function(a){var b;if(a>this.array.length){for(b=this.array.length||1;b<a;)b*=2;a=new Float32Array(b);a.set(this.array);this.array=a}else if(a<=this.array.length/2){b=this.array.length;for(a*=2;b>=a;)b/=2;a=new Float32Array(b);a.set(this.array.subarray(0,b));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(r,g){return function(){function f(){}
f.copyIntervals=function(a){for(var c=[],b=0;b<a.length;b++){var f=a[b];c.push([f[0],f[1]])}return c};f.convertFaceToIndexRange=function(a,c){for(var b=0;b<a.length;b++){var f=a[b];f[0]*=c;f[1]=f[1]*c+(c-1)}};f.sortIntervals=function(a){return a.sort(function(a,b){return a[0]===b[0]?a[1]>b[1]?1:a[1]<b[1]?-1:0:a[0]>b[0]?1:a[0]<b[0]?-1:0})};f.intersectIntervals=function(a,c){if(0>=a.length)return[];for(var b=[],f=0;f<a.length;f++){var e=a[f];e[1]<c[0]||e[0]>c[1]||(e=[e[0],e[1]],e[0]<c[0]&&(e[0]=c[0]),
e[1]>c[1]&&(e[1]=c[1]),b.push(e))}return b};f.mergeIntervals=function(a){if(0>=a.length)return[];var c=[];a=this.sortIntervals(a);c.push(a[0]);for(var b=1;b<a.length;b++){var f=c[c.length-1];f[1]+1<a[b][0]?c.push(a[b]):f[1]<a[b][1]&&(f[1]=a[b][1],c.pop(),c.push(f))}return c};f.invertIntervals=function(a,c){for(var b=[],f=0,e=0;e<a.length;e++){var d=a[e];d[0]>f&&b.push([f,d[0]-1]);f=d[1]+1}f<=c&&b.push([f,c]);return b};f.offsetIntervals=function(a,c){for(var b=[],f=0;f<a.length;f++){var e=a[f];b.push([e[0]+
c,e[1]+c])}return b};return f}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(r,g,f,a){return function(){function c(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}c.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};c.prototype.getEnableState=function(){return void 0!==this._depthFBO};c.prototype.getDepthFBO=
function(){return this._depthFBO};c.prototype.enable=function(){f.assert(!this.getEnableState());this._depthFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})};c.prototype.disable=function(){f.assert(this.getEnableState());this._depthFBO.dispose();this._depthFBO=void 0};c.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=
a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};c.prototype.prepareDepthPass=function(){f.assert(this.getEnableState());var a=this._rctx,c=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearStencil(0);a.setClearColor(0,0,0,0);a.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);a.setBlendingEnabled(!1)};c.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],
this.viewportToRestore[2],this.viewportToRestore[3])};return c}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(r,g,f,a){return function(){function c(a){this.rctx=a;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}c.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};c.prototype.getEnableState=function(){return void 0!==this.normalFBO};
c.prototype.getNormalFBO=function(){return this.normalFBO};c.prototype.enable=function(){f.assert(!this.getEnableState());this.normalFBO=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};c.prototype.disable=function(){f.assert(this.getEnableState());this.normalFBO.dispose();this.normalFBO=void 0};c.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=
a=a.viewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,this.height)};c.prototype.prepareNormalPass=function(){f.assert(this.getEnableState());var a=this.rctx,c=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};c.prototype.finish=function(a){var b=this.rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],
this.viewportToRestore[3])};return c}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderPass","./RenderSlot"],function(r,g,f,a){return function(){function c(){this.camera=null;this.pixelRatio=1;this.normals=this.lightingData=this.highlight=this.depth=null;this.pass=f.MATERIAL;this.shadowMap=null;this.slot=a.BACKGROUND;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=
!1}Object.defineProperty(c.prototype,"isHighlightPass",{get:function(){return this.pass===f.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return c}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(r,g,f,a,c,b,l,e){var d=null;return function(){function h(a){this.isEnabled=
this._isLoadingResources=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}h.prototype.loadResources=function(a){var b=this;return d?!0:(this._isLoadingResources=!0,r(["./SmaaRenderPassData"],function(c){d=c;b._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(h.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});h.prototype.enable=
function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var f=this.rctx;this.programEdgeDetect=new b(f,d.edgeDetectShader.vertex,d.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new b(f,d.blendWeightShader.vertex,d.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new b(f,d.blurShader.vertex,d.blurShader.fragment,this.vertexAttributeLocations);var h=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new e(f,this.vertexAttributeLocations,
{geometry:this.vertexBufferLayout},{geometry:new a(f,34962,35044,h)});this.tmpFramebufferEdges=c.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=c.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(d.areaTexture,
9729,6407);this.textureSearch=this.loadTextureFromBase64(d.searchTexure,9728,6409);return this.isEnabled=!0};h.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),
this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};h.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;null!=b?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setFaceCullingEnabled(!0);c.setCullFace(1029);c.setFrontFace(2305);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!1);c.setViewport(0,0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);
c.setClearColor(0,0,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(this.textureSearch,
1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);
c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3);c.setDepthTestEnabled(!0)};h.prototype.loadTextureFromBase64=function(a,b,c){var d=new l(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);f.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a)});return d};return h}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util"],function(r,
g,f){return function(){function a(a){this._enabled=!1;this._rctx=a}a.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};a.prototype.getIsSupported=function(){return!!this._rctx.contextAttributes.stencil};a.prototype.setEnableState=function(a){a?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.prepareStencilWritePass=function(){f.assert(this.getEnableState());
var a=this._rctx;a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.getEnableState()){var a=this._rctx;a.setStencilFunction(519,0,0);a.setStencilOp(7680,7680,7680)}};a.prototype.enableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(517,1,255)};a.prototype.disableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(519,0,0)};return a}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/requireUtils ../../../../../core/workers ../../../lib/glMatrix ../../../support/buffer/BufferView ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../RegularGridLocalOriginFactory ../Util ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject module".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E){Object.defineProperty(g,"__esModule",{value:!0});var H=function(){function g(a,b,c){this.rctx=a;this.programRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new t.LocalOriginManager(new k(1E4));this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new v;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=d.vec3d.create();this.tmpCameraPosition=
d.vec3d.create();this.componentColorManager=new m.BufferManager(this.rctx,2)}g.isSupported=function(a){return!!a.capabilities.instancing};g.loadShaders=function(a,b,c){y.EdgeRenderer.loadShaders(a,b,c)};g.prototype.initialize=function(){var a=this;e.open(l.getAbsMid("./EdgeProcessingWorker",r,E),{client:this}).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=u.VertexLayout.createBuffer(4),c=0;4>c;c++)b.sideness.set(c,0,0===c||3===c?0:1),b.sideness.set(c,1,0===c||1===c?0:1);this.verticesBufferObject=
B.createVertex(this.rctx,35044,b.buffer)};g.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};g.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage/1048576};Object.defineProperty(g.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});g.prototype.shouldRender=
function(){return 0<this.renderers.size};g.prototype.addObject=function(b,d,e){return a(this,void 0,void 0,function(){var a,f,h,k,l,n,m;return c(this,function(c){switch(c.label){case 0:if(this.hasObject(b))return[2];a=[];h={loaded:new Promise(function(a){return f=a}),renderables:[]};this.perObjectData.set(b,h);if(e&&e.mergeGeometries&&1<b.geometries.length&&this.canMergeGeometries(b))a.push(this.addObjectMergedGeometries(b,h,d));else for(k=0;k<b.geometries.length;k++)l=b.geometries[k],n=b.geometryRecords[k],
m=n.materials[0],m.supportsEdges&&(l.data instanceof p?a.push(this.addGeometryPreinterleaved(b,h,l,l.data,n,d)):a.push(this.addGeometryNonPreinterleaved(b,h,l,l.data,n,d[0])));return[4,Promise.all(a)];case 1:return c.sent(),this.callbacks.setNeedsRender(),f(),[2]}})})};g.prototype.hasObject=function(a){return this.perObjectData.has(a)};g.prototype.updateAllComponentOpacities=function(b,d){return a(this,void 0,void 0,function(){var a,e;return c(this,function(c){switch(c.label){case 0:return(a=this.perObjectData.get(b))?
[4,a.loaded]:[2];case 1:return c.sent(),e=d instanceof Array?function(a){return d[a]}:function(a){return d},a.renderables.forEach(function(a){for(var b=a.components.meta.length,c=0;c<b;c++){var d=e(c),f=a.components.meta[c],h=f.index;f.material.opacity=d;a.components.buffer.textureBuffer.setDataElement(h,1,3,255*d)}a.allTransparent=C.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};g.prototype.updateAllComponentMaterials=function(b,d){return a(this,void 0,void 0,
function(){var a=this,e;return c(this,function(c){switch(c.label){case 0:return(e=this.perObjectData.get(b))?[4,e.loaded]:[2];case 1:return c.sent(),e.renderables.forEach(function(b){var c=C.determineRequiresUberRenderer(d),e=y.EdgeRenderer.getKey(c,d[0].type);if(e!==b.rendererKey){var f=a.renderers.get(b.rendererKey),c=a.aquireRenderer(c,d[0].type);f.removeRenderable(b);f.refCount.decrement();b.rendererKey=e;c.addRenderable(b)}for(e=0;e<d.length;e++)b.components.meta[e].material=d[e];a.updateComponentBuffer(b.components);
b.allTransparent=C.determineAllTransparent(b.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};g.prototype.updateObjectVisibility=function(b,d){return a(this,void 0,void 0,function(){var a;return c(this,function(c){switch(c.label){case 0:return(a=this.perObjectData.get(b))?[4,a.loaded]:[2];case 1:return c.sent(),a.renderables.forEach(function(a){a.visible=d}),this.callbacks.setNeedsRender(),[2]}})})};g.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),
c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};g.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};g.prototype.createSolidEdgeMaterial=function(a){return f({},F,a,{type:"solid"})};g.prototype.createSketchEdgeMaterial=function(a){return f({},L,a,{type:"sketch"})};g.prototype.render=function(a){var b=this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===
a.refCount.value&&(b.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var c=a.view,d=0,e=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++})});var f={distanceFalloffFactor:d/e*40,minimumEdgeLength:C.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5)},h=this.rctx.capabilities.blendMinMax;h?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,
h.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1));this.rctx.setDepthTestEnabled(!0);this.rctx.setDepthFunction(515);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(c){b.renderRegularEdges(c,a,f);b.renderSilhouetteEdges(c,a,f)});this.rctx.setDepthWriteEnabled(!0);this.rctx.setDepthFunction(513);this.rctx.setBlendEquationSeparate(32774,32774);this.rctx.setBlendFunctionSeparate(1,
0,1,1);a.view=c};g.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=d.vec3d.set3(c[12],c[13],c[14],this.tmpModelPosition),b.origin=this.localOrigins.aquire(a));n.applyToModelMatrix(b.origin.vec3,c);return c};g.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,f=q.clamp(Math.round(d.size*y.LINE_WIDTH_FRACTION_FACTOR),0,
255),h=q.clamp(d.extensionLength,-y.EXTENSION_LENGTH_OFFSET,255-y.EXTENSION_LENGTH_OFFSET)+y.EXTENSION_LENGTH_OFFSET,k="solid"===d.type?0:1,l=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,h,k,l)}};g.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=c.aquireIndex();b.push({index:f,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);
return a};g.prototype.extractEdges=function(a,b,c){return this.worker.process({data:b,originalIndices:c,writerSettings:a},this.workerThread)};g.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new D(this.rctx,u.EdgeShaderAttributeLocations,{vertices:u.glVertexLayout,instances:x.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:B.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<
a.silhouette.lodInfo.lengths.length&&(c=new D(this.rctx,u.EdgeShaderAttributeLocations,{vertices:u.glVertexLayout,instances:x.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:B.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};g.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),
a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};g.prototype.addGeometryNonPreinterleaved=function(b,e,f,h,k,l){return a(this,void 0,void 0,function(){var a,f,n,m;return c(this,function(c){switch(c.label){case 0:return a=h.getAttribute("position"),f=this.computeModelTransformWithLocalOrigin(b,k,d.mat4d.create()),n=k.origin,m={position:a,indices:C.cloneIndices(h.getIndices("position")),modelTransform:f,origin:n},[4,this.addNonPreinterleaved(b,e,m,l)];case 1:return c.sent(),[2]}})})};g.prototype.addNonPreinterleaved=
function(b,d,e,f){return a(this,void 0,void 0,function(){var a,b,h,k,l,n,m,q,p,g,t,v,A,y,x;return c(this,function(c){switch(c.label){case 0:a=this.aquireRenderer(!1,f.type);b=e.modelTransform;h=e.origin;k=e.indices;l=e.position;n=l.data.length/l.strideIdx;m=u.EdgeInputBufferLayout.createBuffer(n);for(q=0;q<n;q++)m.position.set(q,0,l.data[l.offsetIdx+q*l.strideIdx+0]),m.position.set(q,1,l.data[l.offsetIdx+q*l.strideIdx+1]),m.position.set(q,2,l.data[l.offsetIdx+q*l.strideIdx+2]);p=this.createComponentBuffers([f]);
C.fillComponenBufferIndices(p.meta,[0,m.componentIndex.count],m.componentIndex);return[4,this.extractEdges(a.writerSettings,m,k)];case 1:return g=c.sent(),t=this.createEdgeResources(g),v=t.regular,A=t.silhouette,y=(v?v.vao.size:0)+(A?A.vao.size:0),x={regular:v,silhouette:A,transform:{modelMatrix:b,origin:h},statistics:{gpuMemoryUsage:y,averageEdgeLength:g.averageEdgeLength},components:p,visible:!0,allTransparent:C.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:a.key},d.renderables.push(x),
a.addRenderable(x),this.gpuMemoryUsage+=y,[2]}})})};g.prototype.addGeometryPreinterleaved=function(b,e,f,k,l,n){return a(this,void 0,void 0,function(){var a,f,m,q,p,g,t,v,A,y,x,B,D,r,E,F,H;return c(this,function(c){switch(c.label){case 0:a=k.getAttribute("position");if(!(a&&a.data instanceof Float32Array))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];f=n[0];m=C.determineRequiresUberRenderer(n);q=this.aquireRenderer(m,f.type);p=this.computeModelTransformWithLocalOrigin(b,
l,d.mat4d.create());g=l.origin;t=C.cloneIndices(k.getIndices("position"));v=new h.BufferViewVec3f(a.data.buffer,4*a.offsetIdx,4*a.strideIdx);A=u.EdgeInputBufferLayout.createBuffer(v.count);for(y=0;y<v.count;y++)A.position.set(y,0,v.get(y,0)),A.position.set(y,1,v.get(y,1)),A.position.set(y,2,v.get(y,2));x=this.createComponentBuffers(n);C.fillComponenBufferIndices(x.meta,k.componentOffsets,A.componentIndex,t);return[4,this.extractEdges(q.writerSettings,A,t)];case 1:return B=c.sent(),D=this.createEdgeResources(B),
r=D.regular,E=D.silhouette,F=(r?r.vao.size:0)+(E?E.vao.size:0),H={regular:r,silhouette:E,transform:{modelMatrix:p,origin:g},statistics:{gpuMemoryUsage:F,averageEdgeLength:B.averageEdgeLength},components:x,visible:!b.isHidden(l),allTransparent:C.determineAllTransparent(x.meta),distanceToCamera:0,rendererKey:q.key},e.renderables.push(H),q.addRenderable(H),this.gpuMemoryUsage+=F,[2]}})})};g.prototype.canMergeGeometries=function(a){for(var c=null,d=null,e=0;e<a.geometries.length;e++){var f=a.geometryRecords[e];
if(f.materials[0].supportsEdges){if(a.geometries[e].data instanceof p)return!1;if(!c)c=f.transformation;else if(!b.equals(c,f.transformation))return!1;if(!d&&f.origin)d=f;else if(d&&f.origin&&d.origin.id!==f.origin.id)return!1}}return!0};g.prototype.addObjectMergedGeometries=function(b,e,f){return a(this,void 0,void 0,function(){var a,h,k,l,n,m,q,p,g,u,t,v,A,y,x,C,B,D,r,E,F;return c(this,function(c){switch(c.label){case 0:a=new Map;h=0;l=k=null;for(n=0;n<b.geometries.length;n++)if(m=b.geometries[n],
q=b.geometryRecords[n],p=q.materials[0],p.supportsEdges&&(!l&&q.origin&&(l=q),g=m.data.getIndices("position"),h+=g?g.length:0,g&&null==k||k===Uint16Array))k=g instanceof Uint16Array?Uint16Array:Uint32Array;u=h?new k(h):null;t=[];for(n=v=0;n<b.geometries.length;n++)if(m=b.geometries[n],A=b.geometryRecords[n],p=A.materials[0],p.supportsEdges){y=m.data.getAttribute("position");g=m.data.getIndices("position");x=a.get(y.data);if(null==x){x=t.length/3;for(C=y.offsetIdx;C<y.data.length;C+=y.strideIdx)t.push(y.data[C+
0]),t.push(y.data[C+1]),t.push(y.data[C+2]);a.set(y.data,x)}if(g)for(B=0;B<g.length;B++)u[v++]=x+g[B]}D=l||b.geometryRecords[0];r=this.computeModelTransformWithLocalOrigin(b,D,d.mat4d.create());E=D.origin;for(n=0;n<b.geometryRecords.length;n++)b.geometryRecords[n].origin=E;F={position:{data:t,offsetIdx:0,strideIdx:3},indices:u,modelTransform:r,origin:E};return[4,this.addNonPreinterleaved(b,e,F,f[0])];case 1:return c.sent(),[2]}})})};g.prototype.aquireRenderer=function(a,b){var c=y.EdgeRenderer.getKey(a,
b),d=this.renderers.get(c);this.strokesTexture||(this.strokesTexture=A.generateStrokesTexture(this.rctx));d||(d=new y.EdgeRenderer(this.rctx,this.programRepository,{type:b,strokesTexture:this.strokesTexture,uber:a}),this.renderers.set(c,d));d.refCount.increment();return d};g.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;
for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};g.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;d.vec3d.set3(a[3],a[7],a[11],this.tmpCameraPosition);this.perObjectData.forEach(function(a,c){var e=d.vec3d.dist(c.getCenter(),b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=e})})};g.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&
e.regular&&!e.allTransparent){var f=C.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}})};g.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette&&!e.allTransparent){var f=C.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);
a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}})};return g}();g.EdgeView=H;var F={color:d.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1},L={color:d.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1}})},"esri/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(r,g,f){function a(c,b){if(Array.isArray(b)){var l=new f;c(b,function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];l.resolve(a)});return l.promise}return a(c,
[b]).then(function(a){return a[0]})}Object.defineProperty(g,"__esModule",{value:!0});g.when=a;g.getAbsMid=function(a,b,f){return b.toAbsMid?b.toAbsMid(a):f.id.replace(/\/[^\/]*$/gi,"/")+a}})},"esri/core/workers":function(){define(["require","exports","./workers/workers"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});for(var a in f)g.hasOwnProperty(a)||(g[a]=f[a])})},"esri/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(r,g,f,a,c,b,l,e,d){function h(){if(m)return m;for(var b=n+t,c=[],e=function(a){var b=d.create(a).then(function(b){return q[a]=b});c.push(b)},f=0;f<b;f++)e(f);return m=a(c).then(function(){})}Object.defineProperty(g,"__esModule",{value:!0});g.Connection=l;g.RemoteClient=e;(l=f("host-browser")?navigator.hardwareConcurrency:0)||(l=f("safari")&&f("mac")||f("trident")?8:2);var n=f("esri-workers-debug")?1:Math.max(1,Math.ceil(l/2)),t=f("esri-workers-debug")?1:Math.max(1,Math.floor(l/2)),p=c.getLogger("esri.core.workers"),
k=0,q=[];g.initialize=function(){h()};g.open=function(a,c,d){void 0===c&&(c={});if(Array.isArray(a))return new g.Connection(a.map(function(a){return new g.RemoteClient(a,c.client)}));if("string"!==typeof a){p.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var e=a;a=c;c={client:e,strategy:d?"dedicated":"distributed"}}var f=c.strategy||"distributed";return"local"===f?b.create(function(b){r([a],function(a){b(g.RemoteClient.connect(a))})}).then(function(a){return new g.Connection([new g.RemoteClient(a,
c.client)])}):h().then(function(){if("dedicated"===f){var d=n+k++;k%=t;return q[d].open(a).then(function(a){return new g.Connection([new g.RemoteClient(a,c.client)])})}return b.all(q.map(function(b){return b.open(a)})).then(function(a){return new g.Connection(a.map(function(a){return new g.RemoteClient(a,c.client)}))})})};g.terminate=function(){for(var a=0;a<q.length;a++)q[a]&&q[a].terminate();q.length=0};var m})},"esri/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],
function(r,g,f){return function(){function a(a){this._clientIdx=0;this._clients=a}a.prototype.broadcast=function(a,b,f){for(var c=[],d=0,h=this._clients;d<h.length;d++)c.push(h[d].invoke(a,b,f));return c};a.prototype.close=function(){for(var a=0,b=this._clients;a<b.length;a++)b[a].close();this._clients=[]};a.prototype.invoke=function(a,b,l,e){var c=e&&e.client;if(!this._clients||!this._clients.length)return f.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(a){return a.isBusy()?
!1:(c=a,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);a=c.invoke(a,b,l);e&&(e.client=c);return a};a.prototype.openPorts=function(){return f.all(this._clients.map(function(a){return a.openPort()}))};return a}()})},"esri/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(r,g,f,a,c,b){function l(a,b){a["delete"](b)}var e=b.MessageType.CLOSE,d=b.MessageType.CANCEL,h=b.MessageType.INVOKE,
n=b.MessageType.RESPONSE,t=b.MessageType.OPEN_PORT,p=function(){function a(a){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=[];this._invoke=a;this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a){a.type===b.MessageType.CANCEL?this._cancelledJobIds.add(a.jobId):(this._invokeMessages.push(a),null===this._timer&&(this._timer=setTimeout(this._process,0)))};a.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=
null};a.prototype._process=function(){this._timer=null;for(var a=0,b=this._invokeMessages;a<b.length;a++){var c=b[a];this._cancelledJobIds.has(c.jobId)||this._invoke(c)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return a}();return function(){function k(a,b,c){this._outJobs=new Map;this._inJobs=new Map;this._queue=new p(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=b;this._port=a;this._port.addEventListener("message",this._onMessage);this._port.start();
this._channel=c}k.connect=function(a){var b=new MessageChannel;a="function"===typeof a?new a:"default"in a&&"function"===typeof a.default?new a.default:a;a.remoteClient=new k(b.port1,a,b);return b.port2};k.prototype.close=function(){this._post({type:e});this._close()};k.prototype.isBusy=function(){return 0<this._outJobs.size};k.prototype.invoke=function(a,c,e){var k=this,n=b.newJobId(),m=new f(function(){l(k._outJobs,n);k._post({type:d,jobId:n})});this._outJobs.set(n,m);this._post({type:h,jobId:n,
methodName:a},c,e);return m.promise};k.prototype.openPort=function(){var a=this,c=b.newJobId(),e=new f(function(){l(a._outJobs,c);a._post({type:d,jobId:c})});this._outJobs.set(c,e);this._post({type:t,jobId:c});return e.promise};k.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(a){a.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=
null};k.prototype._onMessage=function(a){if(a=b.receiveMessage(a))switch(a.type){case n:this._onResponse(a);break;case h:this._queue.push(a);break;case d:this._onCancel(a);break;case e:this._close();break;case t:this._onOpenPort(a)}};k.prototype._onCancel=function(a){var b=this._inJobs,c=a.jobId,d=b.get(c);this._queue.push(a);d&&(l(b,c),d.cancel())};k.prototype._onInvoke=function(a){var d=this,e=a.methodName,f=a.jobId;a=a.data;var h=this._inJobs,k=this._client,q=k[e],p;try{if(!q&&e&&-1!==e.indexOf("."))for(var g=
e.split("."),t=0;t<g.length-1;t++)k=k[g[t]],q=k[g[t+1]];if("function"!==typeof q)throw new TypeError(e+" is not a function");p=q.call(k,a,this)}catch(E){this._post({type:n,jobId:f,error:b.toInvokeError(E)});return}c.isThenable(p)?(h.set(f,p),p.then(function(a){h.has(f)&&(l(h,f),d._post({type:n,jobId:f},a))}).catch(function(a){h.has(f)&&(l(h,f),a&&"cancel"===a.dojoType||d._post({type:n,jobId:f,error:b.toInvokeError(a||{message:"Error encountered at method "+e})}))})):this._post({type:n,jobId:f},p)};
k.prototype._onOpenPort=function(a){var b=new MessageChannel;new k(b.port1,this._client);this._post({type:n,jobId:a.jobId},b.port2,[b.port2])};k.prototype._onResponse=function(b){var c=b.jobId,d=b.error;b=b.data;var e=this._outJobs;if(e.has(c)){var f=e.get(c);l(e,c);d?f.reject(a.fromJSON(JSON.parse(d))):f.resolve(b)}};k.prototype._post=function(a,c,d){return b.postMessage(this._port,a,c,d)};return k}()})},"esri/core/workers/utils":function(){define(["require","exports","dojo/has"],function(r,g,f){function a(a){return a&&
"object"===typeof a&&("result"in a||"transferList"in a)}Object.defineProperty(g,"__esModule",{value:!0});(function(a){a[a.HANDSHAKE=0]="HANDSHAKE";a[a.CONFIGURE=1]="CONFIGURE";a[a.CONFIGURED=2]="CONFIGURED";a[a.OPEN=3]="OPEN";a[a.OPENED=4]="OPENED";a[a.RESPONSE=5]="RESPONSE";a[a.INVOKE=6]="INVOKE";a[a.CANCEL=7]="CANCEL";a[a.CLOSE=8]="CLOSE";a[a.OPEN_PORT=9]="OPEN_PORT"})(g.MessageType||(g.MessageType={}));var c=0;g.newJobId=function(){return c++};g.isTranferableResult=a;g.toInvokeError=function(a){return a?
a.toJSON?JSON.stringify(a):JSON.stringify({name:a.name,message:a.message,details:a.details,stack:a.stack}):null};g.postMessage=function(b,c,e,d){2===arguments.length||void 0===e&&void 0===d?b.postMessage(c):(f("esri-workers-supports-transfer-arraybuffer")||(d?(d=d.filter(function(a){return!(a instanceof ArrayBuffer)}),d.length||(d=null)):a(e)&&e.transferList&&(e.transferList=e.transferList.filter(function(a){return!(a instanceof ArrayBuffer)}),e.transferList.length||(e.transferList=null))),d?(c.data=
e,b.postMessage(c,d)):a(e)?(c.data=e.result,e.transferList?b.postMessage(c,e.transferList):b.postMessage(c)):(c.data=e,b.postMessage(c)))};g.receiveMessage=function(a){return a?(a=a.data)?"string"===typeof a?JSON.parse(a):a:null:null}})},"esri/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(r,g,f,a,c,b,l,e,d){var h=b.getLogger("esri.core.workers"),n=e.MessageType.CANCEL,t=e.MessageType.INVOKE,
p=e.MessageType.OPEN,k=e.MessageType.OPENED,q=e.MessageType.RESPONSE;return function(){function b(a,b){this._outJobs=new Map;this._inJobs=new Map;this.worker=a;this.id=b;a.addEventListener("message",this._onMessage.bind(this));a.addEventListener("error",function(a){a.preventDefault();h.error(a)})}b.create=function(a){return d.createWorker().then(function(c){return new b(c,a)})};b.prototype.terminate=function(){this.worker.terminate()};b.prototype.open=function(a){var b=this,c=e.newJobId(),d=new f(function(a){b._outJobs["delete"](c);
b._post({type:n,jobId:c})});this._outJobs.set(c,d);this._post({type:p,jobId:c,modulePath:a});return d.promise};b.prototype._onMessage=function(a){if(a=e.receiveMessage(a))switch(a.type){case k:case q:this._onResponse(a);break;case n:this._onCancel(a);break;case t:this._onInvoke(a)}};b.prototype._onCancel=function(a){(a=this._inJobs.get(a.jobId))&&a.cancel()};b.prototype._onInvoke=function(b){var c=this,d=b.methodName,f=b.jobId;b=b.data;var h=this._inJobs,k=a.workerMessages[d],n;try{if("function"!==
typeof k)throw new TypeError(d+" is not a function");n=k.call(null,b)}catch(D){this._post({type:q,jobId:f,error:e.toInvokeError(D)});return}l.isThenable(n)?(h.set(f,n),n.then(function(a){h["delete"](f);c._post({type:q,jobId:f},a)}).catch(function(a){h["delete"](f);a||(a={message:"Error encountered at method"+d});a.dojoType&&"cancel"===a.dojoType||c._post({type:q,jobId:f,error:e.toInvokeError(a)})})):this._post({type:q,jobId:f},n)};b.prototype._onResponse=function(a){var b=a.jobId,d=a.error;a=a.data;
var e=this._outJobs.get(b);e&&(this._outJobs["delete"](b),d?e.reject(c.fromJSON(JSON.parse(d))):e.resolve(a))};b.prototype._post=function(a,b,c){return e.postMessage(this.worker,a,b,c)};return b}()})},"esri/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(r,g,f,a,c,b,l,e,d,h,n,t,p){function k(){return B?B:B=
e.create(function(a){var b=new MessageChannel,c=b.port1,e=b.port2,f=function(b){d.add("esri-workers-supports-transfer-arraybuffer",Number(null!=b.data));c.removeEventListener("message",f);c.close();e.close();d("esri-workers-supports-transfer-arraybuffer")||x.warn("This browser doesn't support ArrayBuffer transfer.");a()};c.addEventListener("message",f);c.start();e.start();b=new ArrayBuffer(0);e.postMessage(b,[b])})}function q(b){return k().then(function(){return e.create(function(e){function h(l){if(l=
t.receiveMessage(l))switch(l.type){case C:l=b;var m=c.workers.loaderUrl||n.DEFAULT_LOADER_URL,q;null!=c["default"]?(q=f({},c),delete q["default"],q=JSON.parse(JSON.stringify(q))):q=JSON.parse(JSON.stringify(c));var p=c.workers.loaderConfig,p=n.default({baseUrl:p.baseUrl,locale:a.locale,has:f({"esri-cors":1,"dojo-test-sniff":0,"config-deferredInstrumentation":0,"host-webworker":1,"events-keypress-typed":0,"esri-workers-supports-transfer-arraybuffer":d("esri-workers-supports-transfer-arraybuffer")},
p.has),map:f({},p.map),paths:f({},p.paths),packages:p.packages||[]});l.postMessage({type:A,configure:{esriConfig:q,loaderUrl:m,loaderConfig:p}});break;case y:b.removeEventListener("message",h),b.removeEventListener("error",k),e(b)}}function k(a){a.preventDefault();b.removeEventListener("message",h);b.removeEventListener("error",k);x.warn("Failed to create Worker. Fallback to execute module in main thread",a);b=new p;b.addEventListener("message",h);b.addEventListener("error",k)}b.addEventListener("message",
h);b.addEventListener("error",k)})})}Object.defineProperty(g,"__esModule",{value:!0});var m=h.normalize(r.toUrl("./worker.js")),u=!h.hasSameOrigin(m,location.href),x=l.getLogger("esri.core.workers"),v=null,y=t.MessageType.CONFIGURED,A=t.MessageType.CONFIGURE,C=t.MessageType.HANDSHAKE,B=null;g.createWorker=function(){if(!d("esri-workers"))return q(new p);if(!u){var a=void 0;try{a=new Worker(m)}catch(E){x.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new p}return q(a)}v||
(v=b(m,{responseType:"text"}));return v.then(function(a){return new Worker(URL.createObjectURL(new Blob([a.data],{type:"text/javascript"})))}).catch(function(a){x.warn("Failed to create Worker. Fallback to execute module in main thread",a);return new p}).then(function(a){return q(a)})}})},"esri/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});a=a("esri-built")?
"dojo/dojo-lite.js":"dojo/dojo.js";g.DEFAULT_LOADER_URL=c.makeAbsolute(c.removeQueryParameters(r.toUrl(a)));g.DEFAULT_CONFIG={baseUrl:function(){var a=c.removeQueryParameters(r.toUrl("dojo/x.js"));return c.makeAbsolute(a.slice(0,a.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",
main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};g.default=function(a){var b={async:a.async,isDebug:a.isDebug,locale:a.locale,baseUrl:a.baseUrl,has:f({},a.has),map:f({},a.map),packages:a.packages&&a.packages.concat()||[],paths:f({},a.paths)};a.hasOwnProperty("async")||
(b.async=!0);a.hasOwnProperty("isDebug")||(b.isDebug=!1);a.baseUrl||(b.baseUrl=g.DEFAULT_CONFIG.baseUrl);g.DEFAULT_CONFIG.packages.forEach(function(a){a:{for(var d=b.packages,e=0;e<d.length;e++)if(d[e].name===a.name)break a;a=f({},a);e=c.removeQueryParameters(r.toUrl(a.name+"/x.js"));e=e.slice(0,e.length-5);a.location=c.makeAbsolute(e);d.push(a)}});a=b.map=b.map||{};for(var e=0,d=Object.keys(g.DEFAULT_CONFIG.map);e<d.length;e++){var h=d[e];a[h]||(a[h]=g.DEFAULT_CONFIG.map[h])}return b}})},"esri/core/workers/WorkerFallback":function(){define(["require",
"exports","dojo/has","../global","./utils"],function(r,g,f,a,c){var b=function(){return function(){var a=this,b=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(c){a[c]=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b[c].apply(b,a)}})}}(),l=a.MutationObserver||a.WebKitMutationObserver,e=function(){var b;if(a.process&&a.process.nextTick)b=function(b){a.process.nextTick(b)};else if(a.Promise)b=function(b){a.Promise.resolve().then(b)};
else if(l){var c=[],e=document.createElement("div");(new l(function(){for(;0<c.length;)c.shift()()})).observe(e,{attributes:!0});b=function(a){c.push(a);e.setAttribute("queueStatus","1")}}return b}();return function(){function a(){this._dispatcher=new b;this._isInitialized=!1;this._workerPostMessage({type:c.MessageType.HANDSHAKE})}a.prototype.terminate=function(){};Object.defineProperty(a.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&
this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,configurable:!0});a.prototype.postMessage=function(a,b){var c=this;e(function(){c._workerMessageHandler(new MessageEvent("message",
{data:a}))})};a.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};a.prototype.addEventListener=function(a,b,c){this._dispatcher.addEventListener(a,b,c)};a.prototype.removeEventListener=function(a,b,c){this._dispatcher.removeEventListener(a,b,c)};a.prototype._workerPostMessage=function(a,b){var c=this;e(function(){c.dispatchEvent(new MessageEvent("message",{data:a}))})};a.prototype._workerMessageHandler=function(a){var b=this;if(a=c.receiveMessage(a)){var d=a.jobId;switch(a.type){case c.MessageType.CONFIGURE:this._isInitialized||
this._workerPostMessage({type:c.MessageType.CONFIGURED});break;case c.MessageType.OPEN:r(["esri/core/workers/RemoteClient",a.modulePath],function(a,e){a=a.connect(e);b._workerPostMessage({type:c.MessageType.OPENED,jobId:d,data:a})})}}};return a}()})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Single ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(r,g,f,a,
c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});r=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}f(b,a);b.ElementType="f32";return b}(b.BufferViewSingle);g.BufferViewFloat=r;r=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}f(b,a);b.ElementType="f32";return b}(l.BufferViewVec2);g.BufferViewVec2f=r;r=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}f(b,
a);b.ElementType="f32";return b}(e.BufferViewVec3);g.BufferViewVec3f=r;r=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}f(b,a);b.ElementType="f32";return b}(d.BufferViewVec4);g.BufferViewVec4f=r;a=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}f(b,a);b.ElementType="f32";return b}(a.BufferViewMat3);g.BufferViewMat3f=a;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||
this}f(b,a);b.ElementType="f32";return b}(c.BufferViewMat4);g.BufferViewMat4f=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,b,c,d)||this}f(b,a);b.ElementType="f64";return b}(b.BufferViewSingle);g.BufferViewFloat64=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,b,c,d)||this}f(b,a);b.ElementType="f64";return b}(l.BufferViewVec2);g.BufferViewVec2f64=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,
b,c,d)||this}f(b,a);b.ElementType="f64";return b}(e.BufferViewVec3);g.BufferViewVec3f64=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,b,c,d)||this}f(b,a);b.ElementType="f64";return b}(d.BufferViewVec4);g.BufferViewVec4f64=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,b,c,d)||this}f(b,a);b.ElementType="u8";return b}(b.BufferViewSingle);g.BufferViewUint8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,
b,c,d)||this}f(b,a);b.ElementType="u8";return b}(l.BufferViewVec2);g.BufferViewVec2u8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,b,c,d)||this}f(b,a);b.ElementType="u8";return b}(e.BufferViewVec3);g.BufferViewVec3u8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,b,c,d)||this}f(b,a);b.ElementType="u8";return b}(d.BufferViewVec4);g.BufferViewVec4u8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint16Array,
b,c,d)||this}f(b,a);b.ElementType="u16";return b}(b.BufferViewSingle);g.BufferViewUint16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint16Array,b,c,d)||this}f(b,a);b.ElementType="u16";return b}(l.BufferViewVec2);g.BufferViewVec2u16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint16Array,b,c,d)||this}f(b,a);b.ElementType="u16";return b}(e.BufferViewVec3);g.BufferViewVec3u16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Uint16Array,b,c,d)||this}f(b,a);b.ElementType="u16";return b}(d.BufferViewVec4);g.BufferViewVec4u16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint32Array,b,c,d)||this}f(b,a);b.ElementType="u32";return b}(b.BufferViewSingle);g.BufferViewUint32=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint32Array,b,c,d)||this}f(b,a);b.ElementType="u32";return b}(l.BufferViewVec2);g.BufferViewVec2u32=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Uint32Array,b,c,d)||this}f(b,a);b.ElementType="u32";return b}(e.BufferViewVec3);g.BufferViewVec3u32=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint32Array,b,c,d)||this}f(b,a);b.ElementType="u32";return b}(d.BufferViewVec4);g.BufferViewVec4u32=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int8Array,b,c,d)||this}f(b,a);b.ElementType="i8";return b}(b.BufferViewSingle);g.BufferViewInt8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int8Array,b,c,d)||this}f(b,a);b.ElementType="i8";return b}(l.BufferViewVec2);g.BufferViewVec2i8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int8Array,b,c,d)||this}f(b,a);b.ElementType="i8";return b}(e.BufferViewVec3);g.BufferViewVec3i8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int8Array,b,c,d)||this}f(b,a);b.ElementType="i8";return b}(d.BufferViewVec4);g.BufferViewVec4i8=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int16Array,b,c,d)||this}f(b,a);b.ElementType="i16";return b}(b.BufferViewSingle);g.BufferViewInt16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int16Array,b,c,d)||this}f(b,a);b.ElementType="i16";return b}(l.BufferViewVec2);g.BufferViewVec2i16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int16Array,b,c,d)||this}f(b,a);b.ElementType="i16";return b}(e.BufferViewVec3);g.BufferViewVec3i16=c;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int16Array,b,c,d)||this}f(b,a);b.ElementType="i16";return b}(d.BufferViewVec4);g.BufferViewVec4i16=c;b=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int32Array,b,c,d)||this}f(b,a);b.ElementType="i32";return b}(b.BufferViewSingle);g.BufferViewInt32=b;l=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int32Array,b,c,d)||this}f(b,a);b.ElementType="i32";return b}(l.BufferViewVec2);g.BufferViewVec2i32=l;e=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int32Array,b,c,d)||this}f(b,a);b.ElementType="i32";return b}(e.BufferViewVec3);g.BufferViewVec3i32=e;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int32Array,b,c,d)||this}f(b,a);b.ElementType="i32";return b}(d.BufferViewVec4);g.BufferViewVec4i32=d})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a,c,b,f){void 0===b&&(b=0);a=this.TypedArrayConstructor=
a;void 0===f&&(f=9*a.BYTES_PER_ELEMENT);this.data=new a(c,0===c.byteLength?0:b);this.elementStride=f/a.BYTES_PER_ELEMENT}f.prototype.getMat=function(a,c){a*=this.elementStride;for(var b=0;9>b;b++)c[b]=this.data[a+b];return c};f.prototype.setMat=function(a,c){a*=this.elementStride;for(var b=0;9>b;b++)this.data[a+b]=c[b]};f.prototype.get=function(a,c){return this.data[a*this.elementStride+c]};f.prototype.set=function(a,c,b){this.data[a*this.elementStride+c]=b};Object.defineProperty(f.prototype,"count",
{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});f.ElementCount=
9;return f}();g.BufferViewMat3=r})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a,c,b,f){void 0===b&&(b=0);a=this.TypedArrayConstructor=a;void 0===f&&(f=16*a.BYTES_PER_ELEMENT);this.data=new a(c,0===c.byteLength?0:b);this.elementStride=f/a.BYTES_PER_ELEMENT}f.prototype.getMat=function(a,c){a*=this.elementStride;for(var b=0;16>b;b++)c[b]=this.data[a+b];return c};f.prototype.setMat=
function(a,c){a*=this.elementStride;for(var b=0;16>b;b++)this.data[a+b]=c[b]};f.prototype.get=function(a,c){return this.data[a*this.elementStride+c]};f.prototype.set=function(a,c,b){this.data[a*this.elementStride+c]=b};Object.defineProperty(f.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});f.ElementCount=16;return f}();g.BufferViewMat4=r})},"esri/views/3d/support/buffer/internals/Single":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a,c,b,f){void 0===b&&(b=0);a=this.TypedArrayConstructor=
a;void 0===f&&(f=a.BYTES_PER_ELEMENT);this.data=new a(c,0===c.byteLength?0:b);this.elementStride=f/a.BYTES_PER_ELEMENT}f.prototype.get=function(a){return this.data[a*this.elementStride]};f.prototype.set=function(a,c){this.data[a*this.elementStride]=c};Object.defineProperty(f.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});f.ElementCount=1;return f}();g.BufferViewSingle=r})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../lib/glMatrix"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});
r=function(){function a(a,b,f,e){void 0===f&&(f=0);a=this.TypedArrayConstructor=a;void 0===e&&(e=2*a.BYTES_PER_ELEMENT);this.data=new a(b,0===b.byteLength?0:f);this.elementStride=e/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return f.vec2d.set2(this.data[a*this.elementStride],this.data[a*this.elementStride+1],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+
b]};a.prototype.set=function(a,b,f){this.data[a*this.elementStride+b]=f};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*
this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=2;return a}();g.BufferViewVec2=r})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../lib/glMatrix"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,b,f,e){void 0===f&&(f=0);a=this.TypedArrayConstructor=a;void 0===e&&(e=3*a.BYTES_PER_ELEMENT);this.data=new a(b,0===b.byteLength?0:f);this.elementStride=e/a.BYTES_PER_ELEMENT}
a.prototype.getVec=function(a,b){return f.vec3d.set3(this.data[a*this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1];this.data[a*this.elementStride+2]=b[2]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,f){this.data[a*this.elementStride+b]=f};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/
this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=3;return a}();g.BufferViewVec3=r})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require",
"exports","../../../lib/glMatrix"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,b,f,e){void 0===f&&(f=0);a=this.TypedArrayConstructor=a;void 0===e&&(e=4*a.BYTES_PER_ELEMENT);this.data=new a(b,0===b.byteLength?0:f);this.elementStride=e/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return f.vec4d.set4(this.data[a*this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],this.data[a*this.elementStride+3],b)};a.prototype.setVec=
function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1];this.data[a*this.elementStride+2]=b[2];this.data[a*this.elementStride+3]=b[3]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,f){this.data[a*this.elementStride+b]=f};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=4;return a}();g.BufferViewVec4=r})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",
{value:!0});g.applyToModelMatrix=function(f,a){var c=-f[0],b=-f[1];f=-f[2];var l=a[3],e=a[7],d=a[11],h=a[15];a[0]+=l*c;a[1]+=l*b;a[2]+=l*f;a[4]+=e*c;a[5]+=e*b;a[6]+=e*f;a[8]+=d*c;a[9]+=d*b;a[10]+=d*f;a[12]+=h*c;a[13]+=h*b;a[14]+=h*f};g.applyToViewMatrix=function(f,a){var c=f[0],b=f[1];f=f[2];a[12]+=c*a[0]+b*a[4]+f*a[8];a[13]+=c*a[1]+b*a[5]+f*a[9];a[14]+=c*a[2]+b*a[6]+f*a[10];a[14]+=c*a[3]+b*a[7]+f*a[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports",
"./gl-matrix","./localOriginHelper"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function c(a){this.factory=a;this.originData=new Map}c.prototype.aquire=function(a){return this.register(this.factory.getOrigin(a))};c.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,{refCount:1,viewMatrix:f.mat4d.identity(),origin:a});return a};c.prototype.release=function(a){var b=this.originData.get(a.id);
b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};c.prototype.updateViewMatrices=function(b){this.originData.forEach(function(c){f.mat4d.set(b,c.viewMatrix);a.applyToViewMatrix(c.origin.vec3,c.viewMatrix)})};c.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return c}();g.LocalOriginManager=r})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],
function(r,g,f,a,c){function b(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}return function(){function l(e,d,h,n,g){void 0===h&&(h=null);void 0===n&&(n=l.DefaultOffsets);void 0===g&&(g=l.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var p=c.getStride(d)/
4,p=e.length/p;(this._hasDefaultIndices=g===l.DefaultIndices)&&(g=a.generateDefaultIndexArray(p));for(var p={},k=0;k<d.length;k++){var q=d[k],m=new (b(q.type))(e.buffer),u=c.getBytesPerElement(q.type);p[q.name]={data:m,size:q.count,offsetIdx:q.offset/u,strideIdx:q.stride/u}}h&&(this._positionData=h,p.position={data:h.data,size:3,offsetIdx:0,strideIdx:3});this._id=a.getNewId();this._vertexData=e;this._vertexAttributes=p;this._layout=d;this._indexData=g;this._componentOffsets=f.createOffsets(n);this._gpuMemoryUsage=
e.byteLength+(this._hasDefaultIndices?0:g.byteLength)}Object.defineProperty(l.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});l.prototype.toRenderData=function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?
null:this._indexData,indexCount:this._indexData.length,vertexData:this._vertexData,layout:this._layout};this._indexData=this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return a};l.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};l.prototype.getAttribute=function(a){return this._vertexAttributes[a]};l.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};l.DefaultOffsets=
new Uint32Array(0);l.DefaultIndices=new Uint32Array(0);return l}()})},"esri/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":function(){define(["require","exports"],function(r,g){return function(){function f(a){this._gridSize=a;this._origins={}}f.prototype.getOrigin=function(a){var c=this._gridSize,b=Math.round(a[0]/c),l=Math.round(a[1]/c);a=Math.round(a[2]/c);var c=""+f.ORIGIN_PREFIX+b+"/"+l+"/"+a,e=this._origins[c];if(!e){var e=this._gridSize,d=f.OFFSET,e={id:c,vec3:[b*e+d,l*e+d,a*e+d]};
this._origins[c]=e}return e};f.ORIGIN_PREFIX="rg_";f.OFFSET=1.11;return f}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):
!0})};a.prototype.getBuffer=function(a){for(var b=0,c=this.buffers;b<c.length;b++){var e=c[b];if(e.availableCount>=a)return e}if(a>f.MAX_INDEX_COUNT)return null;a=new f.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(a);return a};a.prototype.updateTextures=function(){for(var a=0,b=this.buffers;a<b.length;a++)b[a].textureBuffer.updateTexture()};return a}();g.BufferManager=r})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require",
"exports","./SimpleIndexManager","./TextureBackedBuffer"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.MAX_INDEX_COUNT=65536;r=function(){function c(b,c){void 0===c&&(c=1);this.textureBuffer=new a.TextureBackedBuffer(b,c);this.indexManager=new f.SimpleIndexManager(g.MAX_INDEX_COUNT)}c.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(c.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});c.prototype.aquireIndex=function(){var a=this.indexManager.aquire();this.textureBuffer.resizeToFit(a);return a};c.prototype.releaseIndex=function(a){this.indexManager.release(a)};return c}();g.ManagedTextureBackedBuffer=r})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],
function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(f.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});f.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};f.prototype.release=function(a){this.recycledIndices.push(a)};return f}();g.SimpleIndexManager=r})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function c(b,c){void 0===c&&(c=1);this.rctx=b;this.fieldCount=c;this.textureWidth=4096;this.dirty=
!0;this.texture=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new f.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}c.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};c.prototype.setData=function(a,c,e,d,f,n){a=a*this.fieldCount+c;this.dirty=!0;this.data.set(a,0,e);this.data.set(a,1,d);this.data.set(a,2,f);this.data.set(a,3,n)};c.prototype.setDataElement=
function(a,c,e,d){a=a*this.fieldCount+c;this.dirty=!0;this.data.set(a,e,d)};c.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new f.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};c.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};c.prototype.bind=function(a,c){this.rctx.bindTexture(this.texture,c.unit);a.setUniform1i(c.texName,c.unit);a.setUniform2f(c.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return c}();g.TextureBackedBuffer=r})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});
g.EdgeInputBufferLayout=a.newLayout().vec3f("position").u16("componentIndex").u16("_padding");g.VertexLayout=a.newLayout().vec2u8("sideness");g.glVertexLayout=f.glLayout(g.VertexLayout,{prefixA:!0});g.CommonInstancesLayout=a.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});g.RegularEdgeInstancesLayout=g.CommonInstancesLayout.clone().vec3f("normal");
g.SilhouetteEdgeInstancesLayout=g.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");g.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});var a={divisor:0,prefixA:!1};
g.glLayout=function(b,l){void 0===l&&(l={});l=f({},a,l);var e=b.stride;return b.fieldNames.filter(function(a){a=b.fields.get(a).optional;return!(a&&a.glPadding)}).map(function(a){var d=b.fields.get(a),f=d.constructor.ElementCount,g;g=c[d.constructor.ElementType];if(!g)throw Error("BufferType not supported in WebGL");var p=d.offset,d=d.optional&&!!d.optional.glNormalized;return{name:l.prefixA?"a"+a[0].toUpperCase()+a.substr(1):a,stride:e,count:f,type:g,offset:p,normalized:d,divisor:l.divisor}})};var c=
{u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});var a=function(){function a(a,b){this.layout=a;this.buffer="number"===typeof b?new ArrayBuffer(b*a.stride):b;b=0;for(var c=a.fieldNames;b<c.length;b++){var e=c[b],f=a.fields.get(e);this[e]=new f.constructor(this.buffer,f.offset,this.stride)}}Object.defineProperty(a.prototype,
"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});a.prototype.slice=function(b,c){return new a(this.layout,this.buffer.slice(b*this.stride,c*this.stride))};return a}(),c=function(){function b(){this.stride=0;this.fields=new Map;this.fieldNames=[]}b.prototype.vec2f=function(a,b){this.fields.set(a,{size:8,constructor:f.BufferViewVec2f,
offset:this.stride,optional:b});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.vec3f=function(a,b){this.fields.set(a,{size:12,constructor:f.BufferViewVec3f,offset:this.stride,optional:b});this.stride+=12;this.fieldNames.push(a);return this};b.prototype.vec4f=function(a,b){this.fields.set(a,{size:16,constructor:f.BufferViewVec4f,offset:this.stride,optional:b});this.stride+=16;this.fieldNames.push(a);return this};b.prototype.mat3f=function(a,b){this.fields.set(a,{size:36,constructor:f.BufferViewMat3f,
offset:this.stride,optional:b});this.stride+=36;this.fieldNames.push(a);return this};b.prototype.mat4f=function(a,b){this.fields.set(a,{size:64,constructor:f.BufferViewMat4f,offset:this.stride,optional:b});this.stride+=64;this.fieldNames.push(a);return this};b.prototype.vec4u8=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:f.BufferViewVec4u8});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.u8=function(a,b){this.fields.set(a,{offset:this.stride,size:1,
optional:b,constructor:f.BufferViewUint8});this.stride+=1;this.fieldNames.push(a);return this};b.prototype.u16=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:f.BufferViewUint16});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.i8=function(a,b){this.fields.set(a,{offset:this.stride,size:1,optional:b,constructor:f.BufferViewInt8});this.stride+=1;this.fieldNames.push(a);return this};b.prototype.vec2i8=function(a,b){this.fields.set(a,{offset:this.stride,
size:2,optional:b,constructor:f.BufferViewVec2i8});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.vec2i16=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:f.BufferViewVec2i16});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.vec2u8=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:f.BufferViewVec2u8});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.vec4u16=function(a,b){this.fields.set(a,
{offset:this.stride,size:8,optional:b,constructor:f.BufferViewVec4u16});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.u32=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:f.BufferViewUint32});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.createBuffer=function(b){return new a(this,b)};b.prototype.createView=function(b){return new a(this,b)};b.prototype.clone=function(){var a=new b;a.stride=this.stride;a.fields=new Map;this.fields.forEach(function(b,
c){return a.fields.set(c,b)});a.fieldNames=this.fieldNames.slice();a.BufferType=this.BufferType;return a};return b}();g.InterleavedLayout=c;g.newLayout=function(){return new c}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",
{value:!0});var e=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,c){var e=d;e[0]=c.position0[0];e[1]=c.position0[1];e[2]=c.position0[2];e[3]=c.position1[0];e[4]=c.position1[1];e[5]=c.position1[2];n[0]=5381;for(e=0;e<h.length;e++)n[0]=31*n[0]+h[e];t.reseed(n[0]);var e=t.randomRangeInt(0,255),f=t.randomRangeInt(0,this.settings.variants-1),k=t.randomFloat(),k=-(1-Math.min(k/.7,1))+Math.max(0,k-.7)/(1-.7),k=255*(Math.pow(Math.abs(k),1.2)*
(0>k?-1:1)*.5+.5);a.position0.setVec(b,c.position0);a.position1.setVec(b,c.position1);a.componentIndex.set(b,c.componentIndex);a.variantOffset.set(b,e);a.variantStroke.set(b,f);a.variantExtension.set(b,k)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();g.CommonBufferWriter=e;var d=new Float32Array(6),h=new Uint32Array(d.buffer),n=new Uint32Array(1),t=new (function(){function a(a){void 0===a&&(a=1);this.seed=a}a.prototype.randomFloat=function(){return this.step()/a.LARGE_PRIME};a.prototype.randomRangeInt=
function(a,b){b-=a;return Math.round(a+this.randomFloat()*b)};a.prototype.reseed=function(a){this.seed=a};a.prototype.step=function(){return this.seed=this.seed*a.SMALL_PRIME%a.LARGE_PRIME};a.LARGE_PRIME=2147483647;a.SMALL_PRIME=16807;return a}());r=function(){function a(){this.commonWriter=new e}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return l.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,d){this.commonWriter.write(a,
b,d);d=c.vec3d.normalize(c.vec3d.add(d.faceNormal0,d.faceNormal1,p));a.normal.setVec(b,d)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=l.RegularEdgeInstancesLayout;a.glLayout=b.glLayout(l.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();g.RegularEdgeBufferWriter=r;r=function(){function a(){this.commonWriter=new e}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return l.SilhouetteEdgeInstancesLayout.createBuffer(a)};
a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=l.SilhouetteEdgeInstancesLayout;a.glLayout=b.glLayout(l.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();g.SilhouetteEdgeBufferWriter=r;var p=c.vec3d.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../support/meshProcessing ../../../support/buffer/typedArrayUtil ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(r,g,f,a,c,b,l,e,d,h){return function(){function n(){this.regularWriter=new d.RegularEdgeBufferWriter;this.silhouetteWriter=new d.SilhouetteEdgeBufferWriter}n.prototype.process=function(b,c){return f(this,void 0,void 0,function(){var d,e,f;return a(this,function(a){switch(a.label){case 0:if(!c)return[3,2];d=[];e=this.packInput(b,d);this.wrappedWork;return[4,c.invoke("wrappedWork",e,d)];case 1:return f=a.sent(),[2,this.unpackOutput(f)];case 2:return[2,this.work(b)]}})})};n.prototype.wrappedWork=
function(b){return f(this,void 0,void 0,function(){var c,d,e,f;return a(this,function(a){c=this.unpackInput(b);d=this.work(c);e=[];this.packInputTransferables(c,e);f=this.packOutput(d,e);return[2,{result:f,transferList:e}]})})};n.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return h.extractEdges(b,this.regularWriter,this.silhouetteWriter)};n.prototype.packInputTransferables=
function(a,b){b.push(a.data.buffer);a.originalIndices&&b.push(a.originalIndices.buffer)};n.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=a.originalIndices instanceof Uint32Array?"Uint32Array":"Uint16Array");return b};n.prototype.unpackInput=function(a){return{data:e.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings}};n.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:l.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:l.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};n.prototype.unpackOutput=function(a){return{regular:{instancesData:l.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:l.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};n.prototype.extractEdgeInformation=function(a,
b){a=c.deduplicate(a.buffer,a.stride/4);b=this.selectIndexData(a.indices,b);var d=c.computeNeighbors(b,a.uniqueCount);return{faces:b,neighbors:d,vertices:e.EdgeInputBufferLayout.createView(a.buffer)}};n.prototype.selectIndexData=function(a,c){if(c){c=b.slice(c);for(var d=0;d<c.length;d++)c[d]=a[c[d]];return c}return a};return n}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports","../webgl-engine/lib/Util"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});
g.computeNeighbors=function(a,b){for(var c=a.length/3,e=new Uint32Array(b+1),d=new Uint32Array(b+1),f=function(a,b){a<b?e[a+1]++:d[b+1]++},n=0;n<c;n++){var g=a[3*n],p=a[3*n+1],k=a[3*n+2];f(g,p);f(p,k);f(k,g)}for(n=p=g=0;n<b;n++)k=e[n+1],f=d[n+1],e[n+1]=g,d[n+1]=p,g+=k,p+=f;for(var q=new Uint32Array(6*c),m=e[b],f=function(a,b,c){if(a<b){var f=e[a+1]++;q[2*f]=b;q[2*f+1]=c}else f=d[b+1]++,q[2*m+2*f]=a,q[2*m+2*f+1]=c},n=0;n<c;n++)g=a[3*n],p=a[3*n+1],k=a[3*n+2],f(g,p,n),f(p,k,n),f(k,g,n);g=function(a,
b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=q[c+2*b],e=q[c+2*b+1],f=b-1;for(f;0<=f&&q[c+2*f]>d;f--)q[c+2*f+2]=q[c+2*f],q[c+2*f+3]=q[c+2*f+1];q[c+2*f+2]=d;q[c+2*f+3]=e}};for(n=0;n<b;n++)g(e[n],e[n+1]),g(m+d[n],m+d[n+1]);for(var u=new Int32Array(3*c),x=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},c=function(a,b){a=x(a,b);u[3*b+a]=-1},g=function(a,b,c,d){a=x(a,b);u[3*b+a]=d;c=x(c,d);u[3*d+c]=b},n=0;n<b;n++){for(var p=e[n],k=e[n+1],f=d[n],v=d[n+1];p<k&&f<v;){var y=q[2*p],A=q[2*m+
2*f];y===A?(g(n,q[2*p+1],A,q[2*m+2*f+1]),p++,f++):y<A?(c(n,q[2*p+1]),p++):(c(A,q[2*m+2*f+1]),f++)}for(;p<k;)c(n,q[2*p+1]),p++;for(;f<v;)A=q[2*m+2*f],c(A,q[2*m+2*f+1]),f++}return u};var a=null;g.deduplicate=function(c,b,l,e,d){void 0===l&&(l=0);void 0===e&&(e=0);void 0===d&&(d=c.byteLength/(4*b));c=new Uint32Array(c,e,d*b);e=new Uint32Array(d);var h=Math.floor(1.1*d)+1;if(null==a||a.length<2*h)a=new Uint32Array(f.nextHighestPowerOfTwo(2*h));for(var n=0;n<2*h;n++)a[n]=0;for(var g=0,p=0!==l?Math.ceil(7.84*
1.96/(l*l)*l*(1-l)):d,n=0;n<d;n++){if(n===p){var k=1-g/n;if(k+1.96*Math.sqrt(k*(1-k)/n)<l)return null;p*=2}for(var k=n*b,q,m=q=0;m<b;m++)q=c[k+m]+q|0,q=q+(q<<11)+(q>>>2)|0;q>>>=0;for(var m=q%h,u=g;0!==a[2*m+1];){if(a[2*m]===q){var x=a[2*m+1]-1,v=x*b;a:{for(var y=0;y<b;y++)if(c[k+y]!==c[v+y]){v=!1;break a}v=!0}if(v){u=e[x];break}}m++;m>=h&&(m-=h)}u===g&&(a[2*m]=q,a[2*m+1]=n+1,g++);e[n]=u}if(0!==l&&1-g/d<l)return null;l=new Uint32Array(b*g);for(n=g=0;n<d;n++)if(e[n]===g){h=c;p=n*b;k=l;q=g*b;m=b;for(u=
0;u<m;u++)k[q+u]=h[p+u];g++}return{buffer:l.buffer,indices:e,uniqueCount:g}}})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.forEach=function(f,a){if(f.forEach)f.forEach(a);else for(var c=0;c<f.length;c++)a(f[c],c,f)};g.slice=function(f,a,c){if(f.slice)return f.slice(a,c);void 0===a?a=0:(0>a&&(a+=f.length),a=Math.min(f.length,Math.max(0,a)));void 0===c?c=f.length:(0>c&&(c+=f.length),c=Math.min(f.length,
Math.max(0,c)));c=Math.max(0,c-a);for(var b=new f.constructor(c),l=0;l<c;l++)b[l]=f[a+l];return b}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(r,g,f,a,c){function b(a){var b=[];a.fields.forEach(function(a,c){var d=a.constructor;a=f({},a,{constructor:d.ElementType+"_"+d.ElementCount});b.push([c,a])});return{stride:a.stride,fields:b,fieldNames:a.fieldNames}}function l(a){var b=
c.newLayout();b.stride=a.stride;b.fieldNames=a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],f({},a[1],{constructor:e.get(a[1].constructor)}))});return b}Object.defineProperty(g,"__esModule",{value:!0});g.packInterleavedBuffer=function(a,c){c.push(a.buffer);return{buffer:a.buffer,layout:b(a.layout)}};g.unpackInterleavedBuffer=function(a){return l(a.layout).createView(a.buffer)};g.packLayout=b;g.unpackLayout=l;r=[a.BufferViewFloat,a.BufferViewVec2f,a.BufferViewVec3f,a.BufferViewVec4f,
a.BufferViewMat4f,a.BufferViewFloat64,a.BufferViewVec2f64,a.BufferViewVec3f64,a.BufferViewVec4f64,a.BufferViewUint8,a.BufferViewVec2u8,a.BufferViewVec3u8,a.BufferViewVec4u8,a.BufferViewUint16,a.BufferViewVec2u16,a.BufferViewVec3u16,a.BufferViewVec4u16,a.BufferViewUint32,a.BufferViewVec2u32,a.BufferViewVec3u32,a.BufferViewVec4u32,a.BufferViewInt8,a.BufferViewVec2i8,a.BufferViewVec3i8,a.BufferViewVec4i8,a.BufferViewInt16,a.BufferViewVec2i16,a.BufferViewVec3i16,a.BufferViewVec4i16,a.BufferViewInt32,
a.BufferViewVec2i32,a.BufferViewVec3i32,a.BufferViewVec4i32];var e=new Map;r.forEach(function(a){return e.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../lib/glMatrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(r,g,f,a,c,b){function l(b,c){var d=Math.acos(b.cosAngle),e=h.fwd,f=h.ortho;a.vec3d.normalize(a.vec3d.direction(b.position0,
b.position1,e));b=0<a.vec3d.dot(a.vec3d.cross(b.faceNormal0,b.faceNormal1,f),e)?-1:1;return d*b>c}function e(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],h=a[3*e+1],l=a[3*e+2],n=c[3*e+0],g=c[3*e+1],p=c[3*e+2],d=d+(-1===f||n<g?1:0),d=d+(-1===h||g<p?1:0),d=d+(-1===l||p<n?1:0);for(var d=new Int32Array(4*d),t=0,e=0;e<b;e++){f=a[3*e+0];h=a[3*e+1];l=a[3*e+2];n=c[3*e+0];g=c[3*e+1];p=c[3*e+2];if(-1===f||n<g)d[t++]=n,d[t++]=g,d[t++]=e,d[t++]=f;if(-1===h||g<p)d[t++]=
g,d[t++]=p,d[t++]=e,d[t++]=h;if(-1===l||p<n)d[t++]=p,d[t++]=n,d[t++]=e,d[t++]=l}return d}function d(b){var c=b.faces.length/3,d=b.vertices.position;b=b.faces;for(var e=n.v0,f=n.v1,h=n.v2,l=new Float32Array(3*c),g=0;g<c;g++){var p=b[3*g+1],t=b[3*g+2];d.getVec(b[3*g+0],e);d.getVec(p,f);d.getVec(t,h);a.vec3d.subtract(f,e);a.vec3d.subtract(h,e);a.vec3d.normalize(a.vec3d.cross(f,h,e));l[3*g+0]=e[0];l[3*g+1]=e[1];l[3*g+2]=e[2]}return l}Object.defineProperty(g,"__esModule",{value:!0});g.extractEdges=function(n,
k,q,m){void 0===m&&(m=t);var g=n.vertices.position,p=n.vertices.componentIndex,v=c.deg2rad(m.anglePlanar);m=c.deg2rad(m.angleSignificantEdge);var y=Math.cos(m),A=Math.cos(v),C=h.edge,B=C.position0,D=C.position1,r=C.faceNormal0,H=C.faceNormal1,F=d(n),L=e(n),G=L.length/4;n=k.allocate(G);m=0;var P=q.allocate(G),J=0,M=0,O=0,aa=f.range(0,G),V=new Float32Array(G);b.forEach(V,function(b,c,d){g.getVec(L[4*c+0],B);g.getVec(L[4*c+1],D);d[c]=a.vec3d.dist(B,D)});aa.sort(function(a,b){return V[b]-V[a]});for(var N=
[],S=[],W=0;W<G;W++){var X=aa[W],Q=V[X],I=L[4*X+0],K=L[4*X+1],T=L[4*X+2],X=L[4*X+3],Y=-1===X;g.getVec(I,B);g.getVec(K,D);if(Y)a.vec3d.set3(F[3*T+0],F[3*T+1],F[3*T+2],r),a.vec3d.set(r,H),C.componentIndex=p.get(I),C.cosAngle=a.vec3d.dot(r,H);else if(a.vec3d.set3(F[3*T+0],F[3*T+1],F[3*T+2],r),a.vec3d.set3(F[3*X+0],F[3*X+1],F[3*X+2],H),C.componentIndex=p.get(I),C.cosAngle=a.vec3d.dot(r,H),C.cosAngle>A)continue;M+=Q;O++;Y||C.cosAngle<y?(k.write(n,m++,C),N.push(Q)):l(C,v)&&(q.write(P,J++,C),S.push(Q))}p=
new Float32Array(N.reverse());v=new Float32Array(S.reverse());return{regular:{instancesData:k.trim(n,m),lodInfo:{lengths:p}},silhouette:{instancesData:q.trim(P,J),lodInfo:{lengths:v}},averageEdgeLength:M/O}};var h={edge:{position0:a.vec3d.create(),position1:a.vec3d.create(),faceNormal0:a.vec3d.create(),faceNormal1:a.vec3d.create(),componentIndex:0,cosAngle:0},ortho:a.vec3d.create(),fwd:a.vec3d.create()},n={v0:a.vec3d.create(),v1:a.vec3d.create(),v2:a.vec3d.create()},t={anglePlanar:4,angleSignificantEdge:35}})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper dojo/text!./EdgeRenderer.xml dojo/text!./EdgeRendererUtils.xml ../../../lib/glMatrix ../../../support/mathUtils ../ShaderVariations ./bufferLayouts".split(" "),function(r,g,f,a,c,b,l,e,d,h){Object.defineProperty(g,"__esModule",{value:!0});g.LINE_WIDTH_FRACTION_FACTOR=8;g.EXTENSION_LENGTH_OFFSET=128;var n={type:"solid",
uber:!0,strokesTexture:null},t=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();r=function(){function a(b,c,d){this.rctx=b;this.programRepository=c;this.refCount=new t;this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=l.mat3d.create();this.settings=
f({},n,d);this.key=a.getKey(this.settings.uber,this.settings.type);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}a.prototype.dispose=function(){for(var a in this.programs){var b=this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};a.prototype.addRenderable=function(a){this.renderables.add(a)};a.prototype.removeRenderable=function(a){this.renderables.delete(a)};a.prototype.forEachRenderable=function(a){this.renderables.forEach(a)};
a.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};a.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};a.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);
a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3])};a.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};a.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,b,c)};a.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);a=this.rctx;a.bindVAO(c);a.capabilities.instancing.drawArraysInstanced(6,0,4,e)};a.prototype.setUniforms=function(a,b,c){b.components.buffer.textureBuffer.bind(a,
g.componentDataBindParameters);a.setUniformMatrix4fv("uView",c.view);a.setUniformMatrix4fv("uModel",b.transform.modelMatrix);var d=c.viewInvTransp,e=l.mat4d.toMat3(d,this.tmpViewToWorldNormalMatrix);a.setUniform3f("uCameraPosition",d[3],d[7],d[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",e);(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.fovY/2)/(c.viewport[3]/2));a.setUniform3fv("uLocalOrigin",b.transform.origin.vec3)};
a.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",e.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};a.prototype.getDefines=function(a){return[a.silhouette,
!!this.rctx.capabilities.blendMinMax,"solid"===this.settings.type&&!this.settings.uber,"sketch"===this.settings.type&&!this.settings.uber,this.settings.uber]};a.prototype.createPrograms=function(){var a=this.programRepository.getShaderVariationsProgram(p,this.getDefines({silhouette:!1}),void 0,void 0,h.EdgeShaderAttributeLocations),b=this.programRepository.getShaderVariationsProgram(p,this.getDefines({silhouette:!0}),void 0,void 0,h.EdgeShaderAttributeLocations);this.programRepository.increaseRefCount(a);
this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};a.loadShaders=function(a,e,f){a.EdgeRendererUtils_readComponentColor||a._parse(b);a.fsRibbonEdge||a._parse(c);e.getShaderVariations(p)||(a=new d("ribbonEdge",["vsRibbonEdge","fsRibbonEdge"],null,e,a,f),a.addDefine("Silhouette","SILHOUETTE"),a.addDefine("AntiAliasing","ANTIALIASING"),a.addDefine("Solid","SOLID"),a.addDefine("Sketch","SKETCH"),a.addDefine("Uber","UBER"),e.addShaderVariations(p,a))};a.getKey=function(a,
b){return a?"edges-uber":"edges-t:"+b};return a}();g.EdgeRenderer=r;var p="edge-shader-variations";g.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/lib/ShaderVariations":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang ./DefaultVertexAttributeLocations ./Util ../../../webgl/Program".split(" "),function(r,g,f,a,c,b,l){return function(){function e(a,c,e,f,l,k){this.variables=
[];this.sealed=!1;this.programCache={};b.assert(2===c.length,"you must specify shader snippet prefixes for vertex and fragment shaders");this.programNamePrefix=a;this.shaderSnippetPrefixes=c;this.baseDefines=e;this.programRep=f;this.snippets=l;this.rctx=k;this.baseDefines=e?e.slice():[]}e.prototype.addDefine=function(a,c,e,f){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");b.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",
a],shaderNameSuffixes:f||a,defineStr:c,affectsShaderTypes:e||[!0,!0]})};e.prototype.addBinaryShaderSnippetSuffix=function(a,c,e){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");b.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",c],affectsShaderTypes:e||[!0,!0]})};e.prototype.addNaryShaderSnippetSuffix=function(a,c){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");
var d=a.map(function(a){b.assert(null!=a.value,"value must always be specified");return a.value});this.variables.push({values:d,programNameSuffixes:a.map(function(a,b){return null!=a.programNameSuffix?a.programNameSuffix:d[b]}),shaderSnippetSuffixes:a.map(function(a,b){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:d[b]}),affectsShaderTypes:c||[!0,!0]})};e.prototype.getShaderVariation=function(c){b.assert(c.length===this.variables.length,"you must specify a value for each variable");for(var d=
this.programNamePrefix,e=a.clone(this.shaderSnippetPrefixes),f=a.clone(this.shaderSnippetPrefixes),l=a.clone(this.baseDefines),k=0;k<this.variables.length;k++){var q=this.variables[k],m=c[k],g=void 0;q.values?(g=q.values.indexOf(m.toString()),b.assert(0<=g,"invalid value "+m+" for variable "+k)):g=m?1:0;d+=q.programNameSuffixes[g];for(m=0;2>m;m++)q.affectsShaderTypes[m]&&(q.shaderSnippetSuffixes&&(e[m]+=q.shaderSnippetSuffixes[g],f[m]+=q.shaderSnippetSuffixes[g]),q.defineStr&&g&&(l.push(q.defineStr),
f[m]+=q.shaderNameSuffixes))}return{programName:d,shaderSnippetNames:e,shaderNames:f,defines:l}};e.prototype.getProgram=function(a,e,f,g){void 0===e&&(e=this.snippets);void 0===f&&(f=this.rctx);void 0===g&&(g=c.Default3D);this.sealed=!0;var d=a.reduce(function(a,b){return a+b.toString()},"");if(this.programCache[d])return this.programCache[d];a=this.getShaderVariation(a);var h=this.programRep.get(a.programName);if(h)return h;var n=a.shaderSnippetNames[0],h=e[n];b.assert(null!=h,"shader snippet '"+
n+"' does not exist");n=a.shaderSnippetNames[1];e=e[n];b.assert(null!=e,"shader snippet '"+n+"' does not exist");h=new l(f,h,e,g,a.defines);this.programCache[d]=h;this.programRep.add(a.programName,h);return h};return e}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(r,g,f,a,c,b){function l(a,b){if(!a)return null;var c=a.length/
2,f=e*c,c=Array(c),h=0;b=1===b;for(var l=0;l<a.length;l+=2){var n=(a[l]+a[l+1])/2;b?c[h++]=Math.min(f,1-(1-n)*d):c[h++]=Math.min(f,n*d)}return c}Object.defineProperty(g,"__esModule",{value:!0});g.generateStrokesTexture=function(d){for(var e=g.strokesDefinition.resolution,f=e/2,h=new Uint8Array(4*e*e),k=4*e*f,f=g.strokesDefinition.amplitude,q=2*f,m=4*e,u=a.log2(e)+1,x=g.strokesDefinition.strokes.length,v=(u-1)*x*m,y=0,A=g.strokesDefinition.strokes;y<A.length;y++){for(var C=A[y],B=C.distance,C=C.pressure,
D=v,r=0;r<u;r++){0!==r&&(B=l(B,0),C=l(C,1));for(var H=0;H<g.strokesDefinition.resolution;H++){var F=C?C[H%C.length]:1;c.packFloatRGBA((B?B[H%B.length]/q:0)+.5,h,D);c.packFloatRGBA(F,h,D+k);D+=4}D-=m*(x+1)}v+=m}d=new b(d,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:e,height:e,wrapMode:10497},h);return{resolution:e,texture:d,normalizationScale:q,amplitude:f,variants:x}};var e=.1,d=.5;g.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027991235688,-1.594268415096517,
-1.596740643806469,-1.5976679728477297,-1.5970259306269106,-1.5947944427616212,-1.5909580456510128,-1.5855060672849923,-1.5784327725018774,-1.5697374703378317,-1.5594245815955472,-1.5475036652859266,-1.5339894031555872,-1.5189015420946324,-1.5022647948121302,-1.4841086997598487,-1.4644674418662662,-1.443379636201339,-1.4208880772168437,-1.3970394566870576,-1.3718840539005264,-1.3454754020176614,-1.31786993480387,-1.2891266181687413,-1.259306571084691,-1.2284726805216848,-1.196689215018011,-1.1640214414122776,
-1.1305352490921607,-1.0962967858759636,-1.061372109339947,-1.0258268570454823,-.9897259387137642,-.9531332529517094,-.9161114306605677,-.8787214576260004,-.8410204788393585,-.803060010098783,-.7648870468625999,-.7265454318212421,-.6880770750418989,-.649522992174277,-.6109241372829213,-.572322017477558,-.5337590863625672,-.4952789222004345,-.4569262044415659,-.41874650884196013,-.38078594675272903,-.34309067834082485,-.30570633253011525,-.268677397934166,-.2320474055305054,-.19585972891609604,-.16015689324715854,
-.12497955695924257,-.09036557033032289,-.05634915662597839,-.022960253244980855,.00977595831390543,.04183931440662281,.07321471408428615,.103891948334216,.13386532576823695,.16313311695608534,.19169684900122042,.2195604902324355,.24672957167545562,.273210296934857,.29900873903753966,.3241309358038472,.34858339725123033,.3723725480501697,.3955042008247177,.41798331171278036,.4398140400768037,.4610001197892589,.48154553378219733,.5014554670105654,.520737374573999,.5393996751359046,.5574481666329886,
.5748849822938961,.5917078843738445,.607908224258889,.6234704532612182,.638373265149942,.6525908805645694,.6660943673419576,.6788529651097385,.6908353835056792,.7020110442320467,.7123512380262834,.7218301687574044,.730425858499404,.7381208898401702,.7449029650711544,.7507652664169401,.7557066071627573,.7597313703719578,.7628492396891565,.7650747337418934,.7664263652084876,.7669251132887921,.7665932987488279,.7654537295407741,.7635288510288761,.7608399452285014,.7574064304774212,.7532453101365993,
.7483708146791838,.7427948326919765,.7365298888984911,.7295911699109773,.7219972284356054,.7137705855505673,.7049382388003643,.6955320361940037,.6855888776595419,.6751507090311942,.6642642793051688,.6529806396692176,.6413543725453564,.6294425503209286,.6173034361958704,.6049949531484181,.5925729608436382,.5800896980771107,.567594644770809,.5551357359992465,.542759035590784,.5305082943391005,.5184245246196352,.5065455978944834,.4949058714282891,.48353585027814583,.47246189026488106,.4617059471856656,
.4512853769943307,.4412127910640701,.43149596996600315,.4221378384569797,.4131365035823046,.4044853569760968,.3961732415964735,.3881846822779339,.38050017863222474,.37309655799454944,.36594738530659077,.3590234260630175,.3522931577345846,.3457233244279979,.33927952895855207,.33292685600278127,.32663051957017186,.3203565276889312,.314072356943078,.3077476122974597,.3013539142129721,.2948635191794201,.2882490516565742,.2814836507528359,.2745411005179009,.2673960896529596,.26002629753002793,.2524138228716638,
.2445430436385685,.23639897709792368,.22796625647714575,.21922830681761074,.2101667315558826,.20076092104236976,.19098788441082304,.18082229738607758,.17023675090208357,.1592021788697291,.14768843810306231,.13566500926427894,.12310178468202204,.10996987743732733,.09624162965474536,.0818899928692044,.06688938810187617,.051216880316905966,.034853262002224716,.017783998988630367,0,-.018501819904772066,-.03771820219003186,-.05763944387332054,-.07824953193343498,-.09952650164025612,-.1214429970516776,
-.1439670023601307,-.1670627043163111,-.1906914389736748,-.2148126708250454,-.2393849493459721,-.2643667872687056,-.28971740676583524,-.31539730421699397,-.3413685913572543,-.3675950802403448,-.3940420913509099,-.4206759780016984,-.44746337536828795,-.47437019855091195,-.5013605519783985,-.5283980386251079,-.5554493702432541,-.5824854584146961,-.6094821865113433,-.636422531130353,-.6632971456797984,-.6901033219010093,-.7168438159023116,-.7435256413451841,-.7701588581100152,-.796755383827922,-.8233278549369919,
-.8498885521317477,-.8764479146149211,-.9030123947333928,-.929583357175636,-.9561564946373301,-.9827214549909352,-1.0092616878048748,-1.0357545136285453,-1.0621714116990197,-1.0884785132678467,-1.114637278975259,-1.1406053300824173,-1.166337395435892,-1.1917863293306992,-1.21690415049172,-1.24164304968492,-1.265956313381077,-1.289799113677184,-1.313129118874023,-1.3359063278910481,-1.3580903690561739,-1.379638761144344,-1.4005065044497944,-1.420645780703642,-1.4400057524421421,-1.4585325000004528,
-1.4761691327539952,-1.4928561076176665,-1.5085317820671946,-1.5231332210963882,-1.536597267714361,-1.5488618750850334,-1.5598676854878804,-1.5695596445747722,-1.5778877195009673,-1.5848076459917178],pressure:[-.013652803495719068,-.002066288730103949,.010252922849648294,.02327683045767759,.036969773686857055,.05129016530607211,.06619270137135636,.08163067380683275,.09755800476548782,.11393070360555568,.13070710584344558,.14784767075128968,.16531678374566372,.18308267499239117,.20111552806564825,
.21938590376011013,.23786270580981705,.25651249734297,.27530058102716026,.29419207009147486,.31315284985603487,.3321509392312345,.3511597080903527,.37015927958163597,.38913389308657464,.40806901014000774,.42694984772691735,.4457621007598809,.4644938747368744,.4831356047321538,.501676576066914,.5201027633868887,.5383960141103917,.5565336932861022,.5744884186608714,.5922285817557749,.6097193143247441,.6269240707193985,.6438070102174226,.6603351869821189,.6764801376712912,.6922195079080313,.7075380892659873,
.7224279282271802,.7368894776922876,.7509300831100625,.764560639933245,.7777927113173451,.7906354237494465,.8030940103510671,.8151705188197416,.8268655015272238,.8381794912882574,.8491141699750582,.8596754149863047,.8698749080630305,.879727822648025,.8892491693962798,.8984516992113625,.9073463819155894,.9159441570111699,.9242563802382581,.9322918186172422,.9400547316037731,.9475440459655884,.9547525929567902,.9616662700770026,.9682641759317194,.9745197216256867,.9804024663380088,.9858802035765014,
.9909210558144125,.9954955775572555,.9995782941008169,.9968520242750458,.9938125791368158,.9913148072439756,.9893645790261856,.9879642566585797,.9871144643405708,.9868159649151572,.9870698566708189,.9878764183069929,.9892340265176259,.9911379768178017,.9935791943097029,.9965413798133597,1,.9960746773875165,.9917142952815687,.9869505590807581,.9818155978348967,.9763435622681739,.9705702411865171,.9645293160251334,.9582499737552566,.9517559067392001,.9450648183572414,.9381880641422669,.9311311564226871,
.9238951551155432,.9164786262013249,.908879876977109,.9010991516142104,.893140145175843,.8850115328027544,.8767279784707639,.8683102803996328,.8597866132713552,.8511911456097885,.8425608524513096,.8339326504138904,.8253397092139866,.8168096926213239,.8083655232991218,.800027149591237,.7918128948638588,.7837403416084541,.7758294776283017,.7681044915548694,.7605916325396778,.75331570511632,.7462980927574314,.7395573250078249,.7331108840043088,.7269756758354649,.7211650232592782,.7156867085040379,.710541979408712,
.7057246008116352,.7012199041124323,.6970048187119476,.6930488896464915,.6893160469797057,.6857668511218866,.6823608387618032,.6790585882653783,.6758232049392975,.6726205851033425,.6694192352454421,.6661920920373833,.6629164542952777,.6595721004123046,.6561397160841818,.6525988588374646,.6489272679833178,.6451019327840435,.6411001458932791,.636900441618931,.632483928436008,.6278374716665853,.6229550554575056,.6178350998800677,.6124775156398994,.606882181041225,.601049603297127,.5949827855326093,.588687079124074,
.5821667728672024,.5754232230133904,.5684541190318941,.5612531292355858,.5538096329652015,.5461092354398507,.5381347247943831,.5298676931944406,.5212910881666897,.5123914152922485,.5031602428257658,.4935957406970741,.4837036283358277,.4734971934910317,.4629983533104258,.4522360503992898,.4412428211842194,.4300518260797894,.41869365968893346,.40719481128615187,.3955782930145856,.3838652537427588,.37207638248508246,.3602330089145642,.34836008629415416,.33648774160241013,.3246489093003745,.3128756285658121,
.30119690355794837,.289639144979561,.27822788952424926,.26698822101787567,.2559417460173815,.24510466154435506,.23448692258414527,.2240914779203822,.21391343655830175,.20394021319000344,.19415265604000687,.18452691578941294,.17503677331106648,.16565604505124598,.15636067979718904,.14713024298704935,.13794814427526347,.1288013825451222,.11968225335217952,.11058813051331562,.10151939755293027,.09247767642844174,.0834639592748112,.07447842905441382,.06552164071601496,.056595637855946124,.047705173575309456,
.03885904803711515,.030073016391106266,.021370857427886802,.012781400797966302,.0043353037063796895,-.003936731031404683,-.012003527443781525,-.019831776500530918,-.027386514431050557,-.034635202724934366,-.041550183631979376,-.04810964843779608,-.05429809698503263,-.06010666003108134,-.06553255706587802,-.0705776675712122,-.07524653524920444,-.07954415721704566,-.08347397819672109,-.08703641537119244,-.09022727106400463,-.09303666451968429,-.0954488285925088,-.0974408119126875,-.09898380883479185,
-.10004629761884543,-.10059686023516212,-.1006078301566693,-.10005701547409984,-.098926903123159,-.09720286631032726,-.09487179459068784,-.09192119436765855,-.08833603238818721,-.08409693480716207,-.07918232672519832,-.07357194089134067,-.0672488016756927,-.060198669012042405,-.05240824604755545,-.04386473481180575,-.03455893176088232,-.024487260419034484]},{distance:[-3.462592566668337,-3.4713131119835636,-3.476683299034174,-3.4786393631896804,-3.4771269138643026,-3.472101486155567,-3.46352902485557,
-3.4513862935895507,-3.4356612026996114,-3.416353050486043,-3.3934726735293634,-3.3670425030234408,-3.3370965253326155,-3.303680146319861,-3.2668499603532215,-3.226673426258105,-3.183228453816534,-3.1366029056950406,-3.0868940208850963,-3.034207766840044,-2.978658128468756,-2.920366342979931,-2.8594600902461993,-2.796072648862051,-2.7303420283955653,-2.6624100884768205,-2.592421655325438,-2.5205236460998086,-2.446864211058802,-2.371591902974652,-2.2948548825376216,-2.216800167666762,-2.1375729337060587,
-2.057315870463475,-1.976168600964485,-1.8942675081702807,-1.8117498730623547,-1.7287572161085087,-1.6454321246621044,-1.5619146242705673,-1.4783390232333034,-1.3948313044746512,-1.3115071117300983,-1.2284703512718416,-1.1458124065938557,-1.0636119421503423,-.9819352537208352,-.9008371074241168,-.8203619968565198,-.740545738231263,-.6614173166335027,-.5830009603095108,-.5053201536558152,-.42840301611061626,-.35228403711532597,-.27700468445034354,-.2026136732891355,-.12916688056323,-.05672689487855931,
.014637798333204666,.0848539854674979,.1538452230460119,.22153362653598574,.2878418942334515,.3526954937366904,.4160249217503238,.47776793252708893,.5378716174306124,.5962942091991157,.6530063855492854,.7079903100879954,.7612374578771739,.8127484199551427,.8625323327932679,.9106054142132263,.956988596340349,1.0017042917926147,1.044772378028914,1.0862055346443595,1.1260043964506963,1.1641583357330818,1.200651750320219,1.2354648908652228,1.2685731664788094,1.2999444750254727,1.3295390143024783,1.3573116032803845,
1.383214184837652,1.4071983201275544,1.429217604854966,1.4492299466641954,1.4671996517917067,1.4830992776757883,1.4969112160632134,1.50862897820681,1.518258160062492,1.5258170711592731,1.5313370163173765,1.534862224966743,1.5364494288125679,1.5361670953016855,1.5340943287803546,1.5303190294439313,1.5249346052008494,1.518037549875019,1.50972555915859,1.500095565837309,1.4892417496955246,1.4772536000183933,1.4642141136170026,1.4501982166817995,1.4352727824420386,1.4195023061375855,1.4029522453886623,
1.3856892412775372,1.3677811011325898,1.3492966539707631,1.330305488125958,1.3108775859631834,1.2910828740068814,1.2709907081898577,1.2506693133359024,1.230185193678646,1.2096025275968296,1.1889825553333822,1.1683829638549592,1.1478572688200348,1.1274543193095994,1.1072188243179695,1.0871919484052759,1.0674112304625125,1.0479104711390734,1.0287196456975911,1.0098648436132622,.9913682355744222,.973248067809303,.9555186828768591,.938190565235987,.9212704090676027,.9047612049913156,.8886623415158668,
.8729697163151,.857675851753255,.8427700085188765,.8282382907878292,.814063736043722,.800226382555814,.7867033075651855,.7734686294700523,.7604934677372213,.7477458549006228,.7351905958366518,.7227890705217739,.7104989776675827,.6982740179745348,.6860635172256813,.6738119910295985,.6614586914751301,.6489387618702289,.6361870568855714,.6231394834207515,.6097333614343126,.5959077323566597,.5816032781140725,.5667579474701463,.5513030306802382,.5351648128015638,.5182678024638898,.5005381740191606,.48190669622031335,
.46231108163386025,.44169773161021464,.4200228756249107,.3972531253309737,.37336548239704626,.34834685497860307,.32219315044171193,.2949080217827449,.2665013521709394,.23698749845191647,.20638158090877656,.17469439023634203,.1419309199020249,.10809000510189604,.07316427963927064,.037140464951616714,0,-.038279988581202185,-.07772538783451854,-.11836349617297603,-.16022115711816087,-.20332268500381812,-.24768765547176264,-.29332865025638144,-.34024906106441377,-.38844107004837447,-.4378839331326283,
-.4885426960110415,-.5403674698703984,-.5932933839279269,-.6472413141696345,-.702119462124376,-.7578258244703334,-.8142515546165815,-.8712851725097688,-.928817530633469,-.9867473947480195,-1.0449871703125482,-1.1034629554184638,-1.162109038254449,-1.2208678007939096,-1.2796910850779342,-1.338543471720733,-1.3974030107761037,-1.456259372566095,-1.5151117442437583,-1.5739666595870592,-1.6328358298221053,-1.6917340348028953,-1.7506771253903235,-1.8096801558604252,-1.8687546002797146,-1.9279040939676002,
-1.9871223579741617,-2.046392143671902,-2.1056845205993575,-2.164958512916196,-2.224161088757068,-2.2832274998744135,-2.3420819611275188,-2.4006386505354556,-2.458803000847759,-2.516473243149497,-2.5735421523214788,-2.6298989337842675,-2.685431181543531,-2.740026829871633,-2.793576015769441,-2.845972763804907,-2.897115121095081,-2.9468996805166263,-2.9952184834973297,-3.041959086352694,-3.0870049082840847,-3.1302357490009496,-3.171528465148712,-3.210757789116758,-3.247797270109032,-3.2825203156876404,
-3.314801312267283,-3.3445168049908487,-3.371546720650133,-3.395775621264229,-3.4170939066346944,-3.435398611043112,-3.450594190461658],pressure:[.871834236111815,.8715115943607685,.871293378083797,.8711812923957116,.8711768576117437,.871281399939463,.8714960430497538,.8718217006159437,.8722590699007462,.8728086264598227,.8734706200186286,.8742450715660192,.8751317716940517,.8761302801987869,.8772399269419401,.8784598139582155,.879788818778385,.8812255989238886,.8827685975152354,.8844160499240004,
.8861659913869906,.8880162654913748,.8899645334314239,.8920082839311094,.8941448437222541,.8963713884652721,.8986849539987807,.9010824478054809,.9035606605846174,.906116277825919,.9087458912860601,.9114460102761723,.914213072677601,.9170434556126981,.9199334857077609,.9228794459150624,.925877545091854,.9289238954986521,.9320145475512317,.9351455283108312,.9383128753327317,.9415126650544423,.944741035229507,.9479942012296135,.9512684663327446,.954560226376967,.9578659693792052,.9611822708899462,.9645057859751348,
.9678332387851791,.9711614106901154,.9744871272305236,.977807226084858,.9811185118313797,.9844177491795763,.987701668257312,.9909669734039454,.9942103551958992,.9974285053563566,.9993818658827355,.9962240104683779,.9931011218244213,.990016313368313,.9869725968943145,.9839728615009442,.9810198537611465,.9781161598435557,.9752641902897734,.9724661681326118,.9697241245031298,.9670399623045829,.9644155449711644,.9618526896523284,.9593531494144041,.9569186021324421,.9545506462060754,.952250802956343,.9500205252769925,
.9478612118227594,.9457742239916946,.9437608697897029,.9418223558568659,.9399597755154718,.938174107330027,.9364662261103961,.9348369034760047,.9332867960327919,.931816432263157,.9304261985745108,.9291163245596573,.927886867728648,.9267376981798869,.925668483870066,.9246786773005324,.9237675045463732,.9229339576013624,.9221767909884881,.9214945234883705,.9208854456679342,.9203476336559231,.9198789693218412,.9194771668260543,.919139823986267,.9188645298792583,.9186489282118706,.9184907517331281,.9183878558758506,
.9183382506202048,.91834012888416,.9183918898162108,.9184921555001823,.9186397665242874,.9188337142782823,.919073093064924,.9193570807202365,.9196849187239581,.9200558917198253,.920469307581891,.9209244791927892,.921420709059903,.9219572777829739,.9225334372033425,.9231484088169267,.9238013877307696,.9244915521011706,.9252180776280114,.9259801563150198,.926777012452934,.9276078716697126,.9284719225630117,.9293683084114313,.9302961219335297,.9312544007472087,.9322421235954589,.9332582074060128,.9343015052543022,
.9353708053010653,.9364648307777483,.9375822410942694,.9387216341444621,.9398815498843326,.9410604752568473,.9422568505340596,.9434690771427016,.9446955270326998,.9459345536391915,.9471845044773916,.9484437353959507,.9497106264982165,.9509835997220568,.9522611380477126,.9535418062796435,.9548242733227341,.9561073358458173,.9573899431965831,.9586712234019973,.9599505100577904,.9612273689133237,.9625015813627825,.963773057351251,.9650418127081243,.9663079709286564,.9675717648439268,.9688335409192678,
.9700937999232571,.9713532370289999,.9726127460550008,.9738733959887111,.9751363965405901,.9764030676253236,.97767481351419,.9789531017788509,.9802394468714374,.9815353979457189,.9828425303278677,.9841624398984965,.9854967395528761,.9868470568634483,.9882150320752711,.9896023163194213,.9910105880020115,.9924415817709282,.9938970785854679,.995378883519806,.9968888000813068,.9984286015590882,1,.9983953865043533,.9967560674668703,.9950807137847713,.9933681908057693,.9916175898113505,.9898282570358621,
.9879998193413863,.9861322056842137,.9842256635412732,.9822807695168851,.9802984334249301,.9782798952421976,.9762267144581553,.9741407515066197,.972024141156466,.9698792579604256,.9677086741100017,.9655151103150585,.9633013806108703,.9610703322832524,.9588247841205518,.9565674993587813,.9543011924791718,.9520285024173022,.9497519580887165,.9474739346671261,.9451966238326696,.9429220202383759,.9406519133553765,.938387884469769,.9361313089512805,.9338833636598072,.9316450390980296,.9294171567231094,
.9272004378739687,.9249956490155912,.92280366321938,.9206254883906718,.9184622913279329,.9163154167629839,.9141864005322624,.9120769763110825,.9099890756677292,.9079248215428105,.9058865156101068,.9038766203057887,.9018977366014569,.8999525788230769,.8980439479659654,.8961747050134444,.8943477457269553,.892565978274629,.8908323181594907,.8891497425360271,.8875213208230689,.8859502129563058,.8844396643822112,.8829929980034826,.8816136021169632,.8803049134030133,.8790703941127365,.8779135027585978,
.8768376578426378,.875846194447947,.8749423138621228,.8741290267897693,.8734091051938624,.872785112798977,.8722594235127223]},{distance:[.3933552257428068,.43437452465856996,.4773788692579104,.5223414015353443,.5692312304189657,.618013485653534,.6686493946073739,.7210963721422228,.7753081294186119,.8312348009863277,.8888230863341238,.9480163933388273,1.0087549635785544,1.070976032104439,1.134614019695953,1.1996007045820207,1.2658653994975633,1.3333351347495896,1.401934843014041,1.471587593611842,
1.542214783055139,1.6137362409892861,1.6860703488052495,1.7591341954827024,1.8328437756062708,1.9071142418205786,1.9818601659320363,2.056995718429604,2.1324347883054062,2.2080911557133693,2.283878704504947,2.359711594948785,2.435504412205094,2.5111723134795945,2.5866311684817687,2.661797725499663,2.7365899869517953,2.8109275297663614,2.8847314927179895,2.957924520058434,3.0304307183756944,3.102175615178953,3.173086139943647,3.2430906886347395,3.3121191638438976,3.3801030482239267,3.446975566908614,
3.512671881507448,3.577129322413205,3.640287633602672,3.702089192237006,3.7624791819875103,3.8214055760764567,3.8788189480393966,3.9346724577466268,3.98892185846162,4.041525512383402,4.092444541790277,4.14164297400471,4.18908777299634,4.2347488081587095,4.278598813611672,4.320613386667867,4.36077095823507,4.3990527487137845,4.435442713009883,4.469927480548321,4.502496325322826,4.533141158060902,4.561856570213739,4.588640617825309,4.613495815484216,4.636428933422032,4.657450591867212,4.67657485711849,
4.693818832550329,4.709202230686097,4.722746985614565,4.73447691086524,4.744417353127302,4.752594798125507,4.759036446724258,4.7637699145191705,4.766823074188295,4.768224053370366,4.768001041049424,4.766182001112551,4.7627944816408405,4.757865536860793,4.751421775019992,4.743489484180039,4.734094740390427,4.723263512001326,4.711021862139898,4.697396224030768,4.682413655901833,4.666102076969173,4.648490493553767,4.629609196986266,4.609489937915397,4.5881660687506365,4.565672633356261,4.542046115069386,
4.517323367842021,4.491541172229191,4.464736162670258,4.436944720570446,4.408202891417675,4.378546228584692,4.348009634977146,4.316627273910055,4.284432598295973,4.251458799703119,4.217739103026686,4.183306823568128,4.148195379518386,4.112438255773398,4.07606890829298,4.039120615749747,4.0016263078978795,3.9636184188770316,3.9251288953336587,3.886189218972625,3.8468303367837082,3.8070825492239684,3.7669754090560605,3.7265376786886364,3.685797269051906,3.644781109834785,3.603515020704514,3.562023641329258,
3.5203304102779747,3.4784575814524628,3.436426267520675,3.3942565002028533,3.351967296921825,3.30957673899292,3.2671020599634204,3.2245597395229133,3.181965589689356,3.139334812548969,3.0966820815377423,3.0540216437933063,3.011367390202148,2.968732918820066,2.9261315923371587,2.883576585514273,2.8410809707692843,2.798657749368987,2.7563197882575063,2.714079760942052,2.671950118377891,2.629943096400877,2.5880707737865354,2.5463451371422345,2.5047780645606386,2.4633812521962777,2.4221661939995247,2.3811439999112265,
2.340324853211415,2.2997177772614115,2.259330532862547,2.219169522828555,2.1792397372718337,2.139544927015206,2.1000879751918453,2.0608715623483147,2.021898122116582,1.983169419612611,1.9446861545721466,1.906447623439739,1.8684515050789705,1.8306936652707264,1.7931680400595305,1.7558666553321867,1.718779726217078,1.6818958433370716,1.6452022196903469,1.6086849593716979,1.572329325300399,1.5361198595504617,1.500040371301915,1.4640741364171168,1.4282041503962677,1.3924134177072984,1.3566853997953738,
1.3210044748918999,1.285356297127997,1.2497281000426046,1.2141089923382955,1.1784902890508464,1.1428658055380845,1.1072321226643176,1.0715888218747722,1.0359386914484447,1.0002879347597522,.9646463688758622,.9290275990084274,.8934491551494461,.8579325775575892,.8225034543610095,.787191409158382,.7520300347002251,.7170567615513141,.6823126448106551,.6478421262504552,.6136927762241124,.5799149660972598,.5465614289890222,.5136867294264627,.48134679869987784,.44959855964066064,.4184996588719767,.3881079655288362,
.3584809417575725,.32967508070821294,.3017454364886203,.2747452671486039,.2487257506264422,.2237356860685198,.1998212172109155,.17702636909737146,.15539475052991447,.13497004481428254,.115796040776317,.09791665348925926,.08137592289411488,.06621799794377159,.052487100680897125,.040227453695063975,.029483157261865678,.020298007734427692,.01271526932319178,.006777387549195435,.0025256694473898555,0,-7.615011464547905E-4,2.77189529201749E-4,.0031497532229529668,.00788741668268722,.014519275843860147,
.02307248084282687,.033572198867366065,.04604154733120902,.06050149265681526,.07697070313651233,.09546536181828058,.11599896802128828,.13858217488030755,.16322279202233236,.18992581227180683,.2186933549951502,.24952457579998288,.2824155485292126,.3173589462346742,.35434377610511314],pressure:[.9524853593959461,.9523648918230723,.9522805769597263,.9522329564362415,.9522225264220369,.9522497357630574,.9523149842116313,.9524186207560146,.9525609420566308,.9527421909957347,.9529625553469002,.9532221665703826,
.9535210987400149,.9538593676068827,.9542369298045759,.9546536822003405,.9551094613959596,.9556040433816643,.9561371433458439,.9567084156427548,.9573174539198603,.9579637914058401,.9586469013597139,.9593661976809167,.9601210356795542,.9609107130054584,.9617344707340498,.9625914946064171,.9634809164204213,.9644018155690507,.9653532207216837,.9663341116433578,.967343421146611,.9683800371699506,.9694428049765154,.9705305294660357,.9716419775927693,.9727758808816872,.9739309380348248,.9751058176193755,
.9762991608288223,.9775095843081372,.9787356830338758,.9799760332398096,.9812291953786144,.9824937171100367,.9837681363059155,.9850509840624264,.9863407877099509,.9876360738110517,.9889353711371484,.9902372136146458,.9915401432314633,.9928427128951425,.9941434892339815,.9954410553329454,.9967340133964329,.9980209873303509,.9993006252363332,.9994283981886392,.998167379353515,.996917583581189,.9956802430286146,.9944565547238778,.9932476787245854,.9920547364014036,.9908788088500562,.989720935434559,
.988582112463937,.9874632906177662,.9863653473768857,.9852890516644223,.9842350685956096,.9832039709430214,.9821962503350153,.9812123280625784,.9802525653862009,.9793172732471648,.9784067213008749,.9775211462033999,.976660759096055,.9758257522464672,.9750163048179632,.9742325877521548,.9734747677621237,.9727430104455033,.9720374825379074,.9713583533374598,.9707057953405609,.9700799841374155,.9694810976231927,.9689093145869546,.9683648127456629,.9678477662946423,.9673583430488581,.9668967012512736,
.9664629861254285,.96605732624927,.9656798298262174,.9653305809275304,.9650096357773367,.9647170192034088,.9644527288228434,.964216759798029,.9640091109242328,.9638297787174527,.9636787513586992,.9635560028386094,.9634614873788835,.9633951341992762,.963356842690756,.9633464780470674,.9633638673984226,.9634087964825163,.9634810068796007,.9635801938300746,.9637060046450094,.963858037712333,.9640358420940875,.9642389177033056,.9644667160426779,.9647186414813214,.9649940530406411,.9652922666555132,.9656125578728111,
.9659541649456463,.9663162922785903,.9666981141765697,.9670987788480676,.967517412611684,.967953124254002,.9684050094860288,.9688721554452149,.9693536451901738,.9698485621356996,.9703559943764953,.970875038849152,.9714048052833503,.9719444198949748,.9724930287758291,.9730498009369042,.9736139309647011,.9741846412529147,.9747611837748806,.9753428413655513,.9759289284854336,.9765187914428727,.9771118080553287,.9777073867348657,.9783049649879584,.9789040073249199,.9795040025797737,.9801044606472022,
.9807049086493154,.9813048865513506,.9819039422520307,.9825016261811166,.9830974858262163,.9836910770680067,.9842820031443522,.9848699277466963,.985454578004594,.9860357470096717,.9866132959047512,.987187155610992,.9877573442479997,.9883240262181364,.9888875239449235,.9894483006307654,.9900069422665342,.9905641396937168,.9911206708720982,.9916773834943398,.9922351780767128,.9927949916428513,.9933577821048614,.993924513433615,.9944961416977163,.9950736020385642,.9956577966372719,.9962495837180045,
.9968497676216556,.9974590899737338,.9980782219609143,.9987077577219455,.9993482088504887,1,.9993365344260858,.9986611525218715,.9979737060929291,.997274140870579,.9965624957652077,.9958389012016878,.9951035765839763,.9943568269396987,.9935990387989919,.9928306753651425,.9920522710376367,.9912644253511633,.9904677963968934,.9896630937950048,.9888510712899236,.98803251904209,.9872082556922112,.9863791202758857,.9855459640681411,.9847096424387481,.9838710068001206,.9830308967300934,.9821901323518404,
.981349507052568,.9805097806213343,.9796716728843351,.9788358579131947,.9780029588781608,.9771735436135739,.976348120957537,.97552713792132,.9747109777367069,.9738999588212262,.9730943351067793,.9722943164728569,.9715001194688352,.9707119854075215,.9699301862563937,.9691550302422414,.9683868671770177,.9676260934251592,.9668731564337241,.966128558748374,.9653928614404692,.9646666868734038,.9639507207397628,.9632457133049637,.9625524797977629,.9618718998933735,.9612049162409535,.9605525319939114,.9599158073088128,
.9592958547866702,.9586938338390447,.9581109439706533,.9575484169800431,.957007508090319,.9564894860328438,.9559956221182228,.9555271783406434,.9550853945737163,.9546714749282261,.9542865733545755,.9539317785850523,.9536080985232646,.9533164442051589,.9530576215853,.9528323706066483,.9526413945346008]},{distance:[2.8560644308226597,2.8614997508595765,2.8643294594294755,2.86450356109541,2.862008146281921,2.8568648476517233,2.8491264950919812,2.838869827138857,2.826186719175311,2.8111756086196404,2.7939352824284938,
2.7745614862415713,2.753142449770011,2.7297564297257124,2.704471270164786,2.677345380423331,2.648442150089751,2.6178428444099904,2.5856470428853884,2.551964233618427,2.5169047641828874,2.480573349049914,2.4430507819440894,2.404386516570751,2.3646268216297543,2.323833552080375,2.2820805078123816,2.2394318873912376,2.195918425444102,2.1515370123697655,2.106281408607926,2.060164113657677,2.013217640755274,1.9654847293268123,1.9170267712069975,1.8679306006957035,1.818308145492662,1.7682925293494824,1.7180308969003244,
1.6676758123452025,1.6173766995298204,1.5672693249947929,1.5174645197681444,1.4680378656104918,1.4190279693157035,1.3704456328725523,1.3222839223882223,1.2745270820025065,1.2271699091765824,1.1802326247707324,1.1337605120559613,1.0878117097729887,1.0424422677593745,.9976935708487168,.953570264387985,.9100306470593948,.8670154724472756,.8244760655198339,.7823803440771101,.7406981915352291,.6993821762996189,.6583646913181194,.6175830464848575,.5769938480095997,.5365666903585229,.4962759254542597,.45611604504656733,
.4161118636776271,.3763209866993942,.33683233726902917,.2977610525027472,.2592405474652324,.22141292706446314,.1844196814258532,.14839490866259997,.1134615495183593,.07972674388851964,.04727941518889911,.016190075888108613,-.013487826060324393,-.04170428692028216,-.06840178044754408,-.09351537767920659,-.11698195515161758,-.13875299446840406,-.15880158251960408,-.17713786050602054,-.1938134932380251,-.20889069787032555,-.2224208632650302,-.234445846583472,-.24501748218725106,-.25421974294006056,-.26216777106440614,
-.26897617078893177,-.2747364971931219,-.2795156764676421,-.28336580436934944,-.2863160195565806,-.2883662997544507,-.28948900682686673,-.28963412998173155,-.2887376416123262,-.2867320212517912,-.2835560996177613,-.27916640035604545,-.2735491490443851,-.26673118335197654,-.25878209613303427,-.24980526575083628,-.23992773916414745,-.22929027875635932,-.2180237129522593,-.20623107935659513,-.1939867706012155,-.18134769023218178,-.16836628249620444,-.15510063795114082,-.14163633129797804,-.12809658817543124,
-.11461436665419011,-.10130542006449494,-.08826371731677884,-.0755777331982792,-.06335156536949671,-.05170975006275569,-.040774183538394126,-.030651285402015116,-.02143598269547109,-.013216968806927909,-.006060588017567259,0,.004968016326124314,.008882343516085411,.011812996119536567,.01385364136096734,.015112632932548609,.01570424078163213,.01574224489576803,.015336355071221774,.014587553871059589,.01358546658502724,.012407760457125105,.011120975597209926,.009794809074016086,.00851489742568412,.0073831619476902866,
.006509330650806389,.006001838719928543,.005961308259655462,.006462256141948508,.007545693515685903,.009247322683843207,.0116163727740497,.014712044491975051,.018582070440270382,.02323897807592945,.02865984316440029,.03481674483058317,.04169771647127751,.04930770799729989,.05765873023500978,.06677823145568285,.07671585579089468,.0875430777595474,.0993487327650111,.11222979051298276,.12628238699388872,.1415939294269959,.15823327180846714,.1762401280787107,.1956154428807213,.21632033818387275,.23828593867869552,
.26142407438444804,.2856368026868932,.31083636262730896,.3369605917391425,.36397307689581204,.39185142202622414,.4205727393711982,.4501014685287925,.48036765555074834,.5112576570436238,.5426432103118382,.5744097756169078,.6064627407946312,.6387129350560252,.6710574479257616,.7033768278369623,.7355601941910207,.7675195983294981,.7991836605372695,.8304892494469853,.8613967415970881,.8919000505580563,.9220289122172148,.9518471931048539,.9814473726810193,1.0109421061108785,1.0404543747639483,1.0701079474327067,
1.1000203540951194,1.1302988598948578,1.161035552632911,1.1923046530627164,1.2241620446388237,1.2566463457741277,1.289792260849803,1.3236412857524262,1.3582413381158205,1.3936373133566835,1.4298580664420566,1.4669092127788055,1.504757502569063,1.5433261994429686,1.5825259262468503,1.622275948570878,1.66250281090742,1.7031207915470945,1.7440097517301705,1.7850168279230965,1.8259899368580674,1.866800922122028,1.9073473331525033,1.9475428134610786,1.9873254017678872,2.0266638954485785,2.0655564477095254,
2.1040254488852765,2.142109542012551,2.179854169448166,2.2173021000204747,2.2544819929832887,2.2913962479700665,2.328009917049388,2.3642483480982976,2.400005906431454,2.4351558106206412,2.4695597732155092,2.5030913082291173,2.5356532187727643,2.567178056974928,2.5976165513706504,2.626924140608808,2.6550504144416376,2.681916808663375,2.707405960489011,2.7313891420282825,2.7537527087650213,2.774402190568013,2.7932455165681715,2.8101714212988256,2.8250444529034158,2.837729578161447,2.848106220051333],
pressure:[.22758130116862207,.23641115181858363,.2457835612200191,.25568405778938175,.2660947011327197,.27699425441929315,.28835845138604643,.3001603491429581,.3123707530215847,.32495869556137236,.33789194870029327,.35113754657772933,.3646622962014471,.378433254580231,.39241815365221144,.40658575820262066,.42090614662939485,.435350909490393,.4498932064934833,.4645072003195414,.47916795267141243,.4938522094044896,.5085389287632488,.5232094045225001,.5378470245449792,.5524367625519526,.5669645576379636,
.5814170744263012,.5957815464262128,.610045105468505,.62419422973965,.638214456781108,.6520903629466516,.6658057689100223,.6793441023328798,.6926888082212518,.7058234286515942,.7187316623871369,.731397765611296,.7438067885931959,.7559446136840249,.7677985712388965,.7793585086672485,.7906168589301561,.8015688265050271,.8122126973344495,.8225496927119403,.8325833777790875,.8423187676520298,.8517613382734284,.8609161651515884,.8697873842286249,.8783782467040462,.8866917321711552,.8947311817945376,.9025010027745886,
.9100071481603877,.9172563483279927,.9242552019103307,.9310098076960656,.9375253802051697,.9438058399307616,.9498534139405639,.9556682761002977,.9612482641406424,.9665888597006143,.9716833186615578,.9765227738184257,.9810964144321358,.9853917417160882,.9893947459455503,.9930900967837073,.9964616220403174,.9994928489739154,.9978324582195615,.9955297897910936,.9936134347243334,.9920960993253182,.9909886174068052,.9902997489987724,.9900357740762062,.9901999045209469,.9907921671560744,.9918100465557763,
.9932488918616252,.9951012662754996,.9973563851909852,1,.9969852981288974,.9936194509422136,.989924138960263,.9859223189640357,.9816378043163267,.977094302224346,.972314553636354,.9673197364980097,.9621291485827672,.9567601437267883,.9512282655128805,.9455475055681867,.9397306080312107,.9337893456320565,.9277347497163575,.9215773274660196,.9153270579862695,.9089939827395331,.9025893306933883,.8961257143714396,.8896174991557152,.8830813338166401,.876536241687053,.8700031470613417,.8635036031357413,
.8570586320273859,.8506879596411493,.8444095668211216,.8382396505633218,.8321929973822371,.8262836674672414,.8205258058962612,.8149342070582876,.8095236047901837,.8043077939352021,.7992992641562489,.7945087892558137,.7899449645929484,.7856137307893425,.7815179277894848,.7776570013591859,.7740269678172935,.7706204628369206,.767426759650097,.7644318717548502,.7616187530849249,.7589675917572937,.7564561882097883,.7540604036250681,.7517546604030216,.749512473431318,.7473069892626959,.7451115101708486,
.7428999814276012,.7406474228954183,.7383302899176003,.7359267531795669,.7334168923181024,.7307827438127945,.728007721454366,.7250764947210521,.7219757518920117,.7186947019324126,.715225166997948,.7115613061596804,.7076990682769553,.7036355287237236,.6993686030833257,.6948968406364173,.6902187031702492,.68533206504112,.6802341471769273,.6749215590577106,.6693905048066344,.6636371436676758,.6576579956333475,.6514500134680296,.6450105923436813,.6383378157263438,.6314306497676363,.624289005477031,.6169143758903433,
.6093109213147438,.6014855484933526,.593448101332241,.5852116694319309,.5767924342081764,.5682090632174606,.5594817957555978,.5506314269844952,.5416784140135055,.5326422985437242,.5235417183641499,.514394972608655,.5052206031342796,.49603804397022233,.4868680436629015,.47773183764739835,.4686501792817972,.45964291193647033,.4507285257320317,.4419236907995958,.43324280362562884,.4246975765845038,.4162967086803826,.40804582437845305,.3999475685226953,.39200167999525504,.3842051491855991,.3765524672426941,
.369035958508088,.3616461826189006,.35437238836208695,.34720299784581954,.34012609726986676,.33312990977608725,.3262032266780832,.3193357758083114,.3125185096484825,.30574381608865564,.29900594492865973,.2923016263471,.2856302277904059,.2789931597323081,.2723935251036449,.2658368326471603,.2593316270720295,.2528896777382207,.24652575029046364,.2402570563685824,.2341025367646017,.22808247516869296,.2222181498781115,.21653082171334836,.2110406403538847,.2057660139095665,.20072333178003365,.1959269406043911,
.1913893162588991,.18712135856117063,.1831327297752552,.17943216161051545,.17602766673084536,.1729266094941153,.1701356678981596,.16766146147383743,.1655117130067718,.16369547828554254,.16222354587955357,.16110899463015216,.1603673080312128,.16001591989098762,.16007295745124983,.1605560924083782,.16148178255716406,.16286482548790515,.1647183181463303,.16705402441828698,.16988304947819866,.17321663730255477,.1770667176623928,.1814451752887224,.1863629471309658,.1918296287764818,.19785303354404749,
.20443870490765126,.21158945787027628,.2193049378183628]},{distance:[-2.313177144900883,-2.319106687248084,-2.321898606688899,-2.321543548601703,-2.318119703983057,-2.3117481204430526,-2.3025439059131254,-2.290620413506076,-2.2760925622462347,-2.2590473496012007,-2.239549866753811,-2.2176745030762994,-2.1935518043679525,-2.1673245656650275,-2.1390720683241886,-2.1088596992635544,-2.0767257009295648,-2.042681183917055,-2.006775589513758,-1.9691163719368967,-1.9298548076510706,-1.8891476373983662,-1.8471370585313096,
-1.803972672566274,-1.759793594587741,-1.7146769471493424,-1.6686438360904985,-1.6217126359466656,-1.5739580157402793,-1.5254699141607309,-1.4762576944001742,-1.426289915629172,-1.3755050442976826,-1.3238437141258967,-1.2713137279994098,-1.2180067991658348,-1.16408281458258,-1.109724024081557,-1.0550878211013577,-1.0003115888683816,-.945515599405417,-.8907784764234987,-.8361536714145171,-.7817098430754913,-.7275789338699303,-.6739060404135797,-.6207670691287788,-.56821255544108,-.5162500614813923,
-.464841861340064,-.4139709955812283,-.36366865714272256,-.31400676759765944,-.2650609768735178,-.2168919406394043,-.16957017506718353,-.12316049827799247,-.0776639182045833,-.03301706252725989,.010858351628355578,.05399873697975588,.09643469244336744,.13827921998453352,.17967872485588887,.22079294960760865,.26176266947521065,.3026501126641563,.3434234771922813,.38397115478661625,.4241461272622733,.46381546212868896,.5028571854348849,.541156560538768,.5786350231638568,.6152437483117099,.6509321804989667,
.6856010743754137,.7191464695077563,.7515356863358233,.7827579850023947,.8128359566215839,.8418216581256437,.8697296011272821,.896515662961916,.9220878470724678,.9463434746557884,.969190416069498,.9905265513806192,1.0102591023340588,1.0283575724058587,1.0448491582916863,1.0597667670475424,1.0730911710559907,1.0847930561289008,1.0949296988440584,1.1036058056110278,1.11096316427546,1.117148479539679,1.122248187006184,1.1262710600787982,1.1291607295640416,1.1308385496649007,1.1312509675210884,1.130364138921492,
1.1281608477886886,1.1246649782394968,1.1199246767079296,1.1139713662337891,1.1067708991921361,1.0982728434891478,1.0884920095260286,1.0774647670824813,1.0652703978621016,1.0520356347728403,1.0378688142757768,1.0228325889063756,1.0069525690036987,.9902563352183413,.9727917666006667,.954601042531672,.935734842977306,.9163088977579796,.8965028003995967,.8765086049118815,.856471957607142,.8365259449435263,.8168770249198365,.797754172916328,.7793907094168475,.7619945340373147,.7456888828645998,.7304970573523206,
.7163568913496545,.7031653388805712,.6908271679523799,.6792506736583477,.6683442575273071,.6580458188156999,.6483166483765264,.6391101401533232,.6303248571754656,.6218483726020065,.6136329773777209,.6056460177816285,.5978831153536566,.5903681382052515,.5830877372445178,.5759716782077635,.5689070626140134,.5617767323521006,.5544793404731763,.5469074832457324,.5389656866172414,.530622023999594,.5219022673010385,.5128367426370297,.5034014588042532,.4935592834233484,.483355287525737,.4728754056636246,
.4622351458962455,.4515471350902791,.4408559354059114,.43012113384689865,.41923292122154954,.4080573856984029,.3964822491138029,.3844116291348685,.3717634232488918,.3584941536910544,.3445828068705932,.329990774836904,.31461410272900925,.29833394333853236,.281099225220087,.2628831540061167,.24370112993907678,.22361337058968345,.20265915510252785,.18082972592498714,.15807598715569715,.13434576456209713,.10960277123933593,.08380197743286555,.05690537349622171,.028940264604492727,0,-.02980536238281961,
-.0604057285092946,-.09173483117382941,-.12364196087697654,-.1559409426049736,-.1884302087655646,-.2209251410767611,-.2533177180345503,-.2855920961658521,-.3178105141411862,-.35006910689399273,-.3824496150950435,-.41502404893517164,-.4478584337588635,-.4809836693126961,-.5144017931172299,-.5481173185145441,-.5821841014014015,-.6166613121387987,-.6515374251251902,-.686779583066993,-.7223222643910404,-.7580712399892848,-.7939707055658709,-.830024517572342,-.8662856012368101,-.9028189440367692,-.939680561074704,
-.9769382377154178,-1.0146524018263483,-1.0528233835526855,-1.0913961939493269,-1.1303126830980907,-1.1695695246992122,-1.209175547359248,-1.2490532811014115,-1.2890776026092914,-1.3290860393322688,-1.3689108995684527,-1.4084444302482204,-1.4476561883007544,-1.4865805060800055,-1.525273615552634,-1.5637659861650226,-1.6020666433037403,-1.6401659218660776,-1.6780111527003356,-1.7155236913670693,-1.7526401166128311,-1.7893613118446212,-1.8257034341824423,-1.861616663402517,-1.897029181213743,-1.931826134665012,
-1.9658454320607581,-1.9989439443761423,-2.0310251642308415,-2.062030952352614,-2.0919029286977313,-2.1205645619061606,-2.1479475970247526,-2.1739782949084976,-2.1985213301791005,-2.221381429416309,-2.2423552281462547,-2.2612905909296925,-2.2780529463828847,-2.2924379868179363,-2.304221445155564],pressure:[.9681096288164897,.9742494502173141,.9804645025847687,.9867488940436538,.993096544947534,.9995011972321934,.9940435756147578,.9875443579902411,.9810078810427305,.9744410109971542,.9678507369673401,
.9612441582880007,.9546284714005091,.9480109563288335,.941398962783987,.9347998959372039,.9282212019037509,.9216703529808111,.9151548326842419,.9086821206301863,.9022596773085065,.8958949287958053,.8895952514563863,.8833679566798996,.8772202757045902,.8711593445750301,.8651921892829744,.8593257111395084,.8535666724259935,.8479216823704221,.8423971834947168,.8369994383772082,.8317345168730474,.8266082838336319,.8216263873642717,.8167942476572956,.8121170464356109,.8075997170393957,.8032469351861216,
.7990631104315057,.7950523783562806,.7912185935008418,.7875653230669512,.7840958414026898,.780813125283835,.7777198500017691,.7748183862649384,.7721107979177761,.769598840477915,.7672839604894378,.7651672956868782,.7632496759616995,.7615316251200553,.7600133634177982,.7586948108559435,.7575755912171576,.7566550368213073,.7559321939756987,.7554058290933746,.7550744354507185,.7549362405536425,.7549892140798452,.7552310763629762,.7556593073830986,.7562711562265445,.7570636509771671,.7580336090000648,
.7591776475781259,.7604921948611868,.7619734927155537,.7636174477378619,.765419432821604,.767374328874214,.7694766062782569,.7717204041767212,.7740996069504947,.7766079173428428,.7792389257477135,.7819861752414323,.7848432220001662,.787803690807859,.7908613254206227,.7940100336133356,.7972439267920322,.8005573541112065,.8039449310881056,.8074015627561901,.8109224614470163,.8145031593336931,.8181395159096919,.821827720614072,.8255642908481133,.8293460656589232,.8331701953928174,.8370341276452415,.8409355898547186,
.8448725689058837,.8488432881211303,.8528461820318414,.8568798693286509,.8609431243957466,.8650348475566986,.8691539963202733,.8732994131412112,.8774697496607818,.881663454194402,.8858787628455445,.8901136930504803,.8943660396680921,.8986333737166519,.9029130438460905,.9072021806196484,.9114977036625755,.9157963317175211,.9200945956261883,.9243888542345571,.9286753131943698,.9329500466065986,.9372090214232248,.9414481244920019,.9456631920950533,.9498500417964295,.9540045063764356,.9581224695920225,
.9621999034632887,.9662329067467105,.970217744216695,.9741508863391151,.9780290488843338,.9818492319935996,.9856087581823766,.9893053087379217,.9929369579470293,.9965022045740723,1,.9965702275695045,.9932085534133771,.9899145416954277,.9866872365070574,.9835251590732669,.980426311602952,.9773881882154583,.9744077933172235,.9714816677352489,.9686059228384759,.9657762827943909,.9629881350169847,.9602365887643541,.9575165417406846,.9548227544491703,.9521499319308134,.9494928124103001,.9468462622557036,
.9442053765450845,.9415655844217368,.9389227583124214,.9362733259811099,.9336143810619182,.9309436483553176,.928259210257543,.9255594460227784,.9228430515545426,.9201090577744532,.9173568467824763,.9145861654888253,.911797119775643,.9089901205885936,.9061658728272043,.9033253899290532,.9004700056194803,.8976013821523906,.8947215150484106,.8918327343645052,.8889377025558651,.8860394090164089,.8831411614085758,.8802465739162115,.8773595525762494,.8744842778655701,.8716251847388482,.8687869403313756,
.8659744195577272,.8631926788526936,.8604469283150746,.8577425025276537,.8550848303378515,.8524794038931274,.8499317472329972,.8474473847454953,.8450318097998382,.8426904538688607,.8404286564542911,.838251636125007,.8361644629728966,.8341720327827264,.8322790432013383,.8304899721774935,.8288090589266526,.827240287654859,.8257873742527055,.8244537561440728,.8232425854450374,.8221567255561318,.8211987512761636,.8203709524882562,.8196753414289208,.8191136635091028,.8186874116126149,.8183978437525851,
.8182460039209508,.8182327459201177,.818358759920186,.8186246014402307,.8190307224085416,.8195775039151432,.8202652902309213,.8210944236319118,.8220652795353844,.8231783014268874,.824434035034987,.8258331590870936,.8273764169952684,.8290643972207132,.830897481292878,.8328758551059271,.8349995222942113,.8372683189271672,.8396819291745853,.8422399015609614,.8449416654008144,.8477865469860104,.8507737850819423,.8539025452822856,.8571719327724605,.8605810030600912,.864128770246904,.8678142124406337,.8716362739375824,
.8755938638462646,.8796858508697518,.8839110540184263,.8882682290853012,.8927560507821377,.8973730905054884,.9021177897765967,.9069884294767939,.9119830950795634,.9170996381606424,.9223356345472383,.9276883395453966,.9331546407595647,.9387310090892051,.9444134485706571,.9501974741041836,.9560782559048621,.9620507337684383]},{distance:[4.729258114627096,4.81721410543827,4.903701879871016,4.988596967987977,5.071775831373199,5.153116282120162,5.232497897920279,5.309802427861525,5.384914183912712,5.457720413665675,
5.528111650694693,5.595982039812716,5.661229635490148,5.723756672682931,5.783469810223489,5.840280347701822,5.894104417359511,5.944863152910576,5.992482827461534,6.036894881310337,6.078036021495521,6.115848464058741,6.150280126342077,6.18128474287317,6.208821909574009,6.232857070453914,6.2533614619108695,6.270311974873581,6.28369102140004,6.293486531664964,6.299691988536658,6.302306474991639,6.301334722288538,6.296787144953868,6.288679847618035,6.277034554610267,6.2618780627561055,6.243241723311314,
6.221161512210006,6.195678080635436,6.166836712515966,6.134687331537211,6.099284555642696,6.060687577156098,6.018960073964148,5.97417016383302,5.926390304527281,5.875697128341374,5.822171210564463,5.765896775588079,5.7069613475961845,5.645455347496691,5.58147143511699,5.515103669597928,5.446447090523786,5.3755974348902695,5.302650937321167,5.227704366611922,5.1508551002338985,5.072201116428859,4.991840996901632,4.909873945227835,4.826399818817658,4.741519170257459,4.655333294376134,4.5679443016815675,
4.479455188557763,4.389969863769709,4.299593138552639,4.208430583502336,4.11658672147794,4.024162651032419,3.9312561635589365,3.8379622103914866,3.744373271405144,3.6505796193469866,3.5566694787266453,3.462729082597362,3.368842635056362,3.275092211459258,3.181558008212983,3.0883189295886115,2.995452728543323,2.90303588710083,2.81114330832097,2.7198484197873154,2.629223500997777,2.539339934365423,2.4502683643074508,2.3620787728074406,2.274840482073957,2.1886220412691926,2.103491081824401,2.0195142662212993,
1.9367572373082353,1.8552845440728332,1.7751595331790981,1.6964441943643624,1.6191989474181554,1.5434823590684679,1.469350780115029,1.3968578936535248,1.3260536944214834,1.2569820908316864,1.1896796778685998,1.1241754176159398,1.0604904841571319,.998638044415241,.9386231878816549,.8804430222964235,.8240868409295223,.7695365029692054,.7167674964177655,.6657497285594434,.6164479454402345,.5688221187513092,.5228278137936337,.47841654436737535,.4355361258557915,.394131042796376,.3541428752123439,.3155109386408155,
.2781729415730334,.24206554218699416,.2071248995640751,.17328722648088135,.14048934333813534,.1086692458226608,.07776679111898765,.047724412535618654,.018487746589299192,-.009993789561686839,-.03776645469417339,-.06487168065949334,-.09134561856782586,-.1172187422134785,-.142515516367129,-.16725413672713696,-.19144634726217458,-.21509733944761944,-.23820573656338784,-.2607636648523073,-.2827569120032729,-.3041651721827421,-.32496237573637465,-.3451171007488192,-.36459307281374453,-.3833498301504781,
-.40134336947644655,-.4185266982952216,-.4348504822278949,-.45026380910010566,-.46471505962821436,-.47815286444250393,-.49052712555483247,-.5017901346258569,-.5118976933918038,-.5208100772097657,-.5284918467538935,-.5349098330945132,-.5400327303154322,-.5438312940409356,-.5462785366658105,-.54734996132792,-.5470242345260194,-.5452841990720723,-.5421183200621602,-.5375208933679412,-.5314915708381553,-.5240347845572755,-.5151590939630104,-.5048766830557021,-.4932028074793502,-.48015518444767036,-.4657534276997408,
-.4500185435211552,-.43297249273789706,-.41463781917730813,-.39503734163348714,-.3741939114292556,-.35213044008007,-.3288701274357795,-.30443629086120794,-.2788520832478998,-.25214015514310617,-.2243221104240849,-.19541795620511593,-.16544566948844341,-.1344207895137446,-.10235603247423164,-.06926093236399389,-.03514151355666595,0,.036165458586993715,.07336101308372633,.11159725285456723,.15088926207112774,.19125658642516363,.2327231012157025,.27531677329958626,.31906931147002027,.3640157024638775,
.41019363294777733,.45764280140774094,.5064041277434974,.5565188723917691,.608027680795109,.6609695926732817,.7153814348850465,.7712975916987603,.8287493752888722,.8877641872872131,.9483645481554586,1.0105675985055877,1.0743848884212222,1.139822157633311,1.2068790936608695,1.275549078429044,1.345818935615478,1.417668636832925,1.4910710783865855,1.565993253273585,1.6423993771629677,1.7202519117005521,1.7995117829725493,1.880138546685111,1.9620904885041437,2.0453246433371732,2.1297967197681635,2.2154609203378905,
2.3022696554241,2.3901731582452177,2.47911902894199,2.569051866905899,2.6599130037447454,2.7516401272007984,2.8441670113910655,2.9374233731424937,3.031334763017865,3.1258226356710623,3.220805072202248,3.316197202942048,3.4119112355231564,3.5078564300702606,3.6039390386167005,3.7000622179919738,3.796125930803327,3.892026854100815,3.9876583432342563,4.082910609014068,4.177670915013242,4.271823679970262,4.365250583587868,4.457830767396848,4.549441521953752,4.639958891512052],pressure:[.30942253421510024,
.3083816678266442,.30765316881890026,.3072417169973548,.3071515993751791,.3073866940802903,.3079504550609371,.3088458976525895,.3100755850667105,.3116416158595279,.3135456124361189,.3157887106420707,.3183715504916309,.3212942680776518,.3245564887047885,.3281573212833122,.33209535401660195,.33636865141087013,.3409747526310085,.345910671221591,.35117289620711367,.3567573945804622,.36265961518343914,.36887449397794814,.3753964607011734,.3822194468928166,.38933689527719806,.3967417704778081,.40442657103675606,
.41238334270650157,.4206036929763308,.4290788067912401,.4377994634162814,.446756054394989,.45593860254630203,.46533678194041417,.4749399387902682,.48473711319196267,.4947170616441906,.5048682802739722,.5151790286934281,.5256373544101391,.5362311177117867,.5469480169442669,.557775614101328,.5687013606429921,.5797126234596004,.5907967108982677,.6019408987688202,.6131324562469586,.6243586715933935,.6356068776090471,.6468644767481018,.6581189658126839,.6693579601552836,.6805692173176168,.6917406600375262,
.7028603985586679,.7139167521811103,.7248982699945883,.7357937507399719,.7465922617484927,.7572831569124251,.7678560936452041,.778301048793356,.7886083334671019,.7987686067610464,.8087728883409481,.8186125698771796,.8282794350253877,.8377658538135384,.847065028379203,.856170955079212,.8650783391615138,.8737825114014883,.8822793478394245,.8905651936141138,.8986367917670406,.9064912177640506,.9141258203487554,.9215381692063367,.9287260097799743,.9356872254468349,.9424198071283498,.9489218302822717,
.9551914391033761,.9612268376472763,.9670262874889967,.9725881114358985,.9779107027343232,.9829925391415955,.9878322011804921,.9924283938522156,.9967799710564522,.9991140380468067,.9952544014996716,.9916416565868879,.9882760821842185,.9851576721089708,.982286110121293,.9796607471700592,.9772805809377485,.9751441732985892,.9732493956882049,.9715933421918648,.9701723533808442,.9689820489732719,.9680173667309089,.9672726071809427,.9667414836883004,.9664171773477658,.9662923961168177,.966359437570059,
.9666102546246161,.9670365235631522,.9676297136671133,.9683811577674781,.9692821230233026,.9703238812494444,.9714977781335421,.9727953007080785,.974208142475511,.975728265622357,.9773479598009767,.9790598970048183,.9808571821132597,.9827333987350511,.9846826500339061,.9866995942751737,.9887794748879829,.9909181448920049,.9931120855913771,.9953584194896969,.9976549174288267,1,.9976072666819149,.9951671807115392,.9926794194693838,.9901430598467869,.9875566033981651,.9849180061768639,.982224712992318,
.9794736958113358,.9766614960148283,.9737842702128625,.9708378393151689,.9678177405507098,.9647192821282056,.9615376002291268,.958267718025144,.9549046064129116,.9514432461599265,.9478786911556282,.9442061324615656,.9404209628530024,.9365188415415605,.9324957587642306,.9283480988094415,.9240726527097894,.9196665513078475,.9151272731279052,.9104526782918482,.9056410395930752,.9006910701627266,.8956019469952673,.8903732747486188,.8850049013754094,.8794968923299016,.8738495981481251,.8680637173814533,
.8621403517823784,.8560810529700551,.8498878599453961,.8435633269755931,.8371105415237607,.8305331320586534,.8238352657398547,.81702163613312,.8100974412664346,.8030683524875875,.7959404747265391,.7887202988985468,.7814146473050471,.7740306129969933,.766575494158175,.7590567246427484,.7514818018607097,.7438582132465448,.7361933625692394,.7284944973459423,.7207686386068315,.7130225142253805,.7052624969767693,.6974945484184134,.6897241696014821,.6819563595221028,.6741955821071343,.6664457424035847,
.6587101725047521,.6509916276019088,.6432922923998985,.6356137979805134,.6279572490411219,.6203232612799757,.6127120085461168,.605123279222987,.5975565411728263,.5900110144356863,.5824857507542867,.5749797188856807,.567491894564315,.5600213538999352,.552567368928969,.5451295039904716,.5377077115680508,.5303024262278366,.5229146552896635,.5155460648940957,.508199060171405,.5008768582794982,.493583549571753,.48632398408343047,.4791033944708174,.47192729817789647,.4648015015188349,.45773210193087643,
.45072548757534125,.44378833426106523,.43692759969864725,.43015051512582625,.42346457437358653,.4168775204688139,.41039732989205147,.4040321946278993,.3977905021606213,.39168081357849227,.38571183995730196,.37989241719632094,.3742314794790955,.36873803152689844,.3634211198049222,.3582898028306635,.35335312072099123,.3486200640995367,.3440995424699296,.33980035214357307,.3357311437937298,.3319003896912891,.3283163506623159,.32498704279388146,.32192020390336507,.31912325977779554,.31660329019141187,
.31436700569462617,.3124207875792264,.310770712213289]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils"],function(r,g,f){function a(a,b){var c=f.binaryIndexOf(a,b,!0);return-1===c?b<a[0]?0:a.length:c}Object.defineProperty(g,"__esModule",{value:!0});g.determineRequiresUberRenderer=function(a){if(0===a.length)return!1;for(var b=a[0].type,c=0;c<a.length;c++)if(b!==a[c].type)return!0;return!1};g.determineAllTransparent=function(a){if(0===
a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b].material;if(0<c.size*c.color[3]*c.opacity)return!1}return!0};g.cloneIndices=function(a){if(Uint16Array.from)return a instanceof Uint16Array?Uint16Array.from(a):Uint32Array.from(a);for(var b=a instanceof Uint16Array?new Uint16Array(a.length):new Uint32Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b};g.estimateLengthAtDistance=function(a,b,f,e){return e/a*f*2*Math.tan(.5*b)};g.findLowerBoundIndex=a;g.computeEdgeCount=function(c,b,f){return c.length-
a(c,b*f.minimumEdgeLength)};g.fillComponenBufferIndices=function(a,b,f,e){for(var c=0;c<a.length;c++){var h=a[c].index,l=b[c],g=b[c+1];if(e)for(;l<g;l++)f.set(e[l],h);else for(;l<g;l++)f.set(l,h)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../lib/glMatrix","./SphericalHarmonics"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});var c=f.vec3d,b=f.vec4d,l=c.create();r=function(){function e(){this._renderLighting={main:{intensity:c.create(),
direction:c.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=c.create();this._oldSpecular=b.create();this._oldDiffuse=b.create();this._oldAmbient=b.create()}e.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);
a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",
b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],
b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};e.prototype.set=function(b){this._info=b;a.combineLights(b.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);c.negate(this._renderLighting.main.direction,this._oldDirection);b=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*
b;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*b;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*b;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*b;this._oldDiffuse[3]=1;b=c.set(this._oldDiffuse,l);c.scale(b,.4*this._info.globalFactor);c.add(this._oldAmbient,b)};Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});e.prototype.getOld=function(){return{ambient:this._oldAmbient,
diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return e}();g.SceneLighting=r})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../lib/glMatrix ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),function(r,g,f,a,c,b){function l(a){return(a+1)*(a+1)}function e(b){return a.clamp(Math.floor(Math.sqrt(b)-1),0,2)}function d(a,b,c){var d=a[0],e=a[1];a=a[2];c=c||[];c.length=l(b);0<=b&&(c[0]=
.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*e);2<=b&&(c[4]=1.09254843059*d*e,c[5]=1.09254843059*e*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-e*e));return c}function h(a,b){a=l(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function n(a,b){for(var f=e(b.r.length),k=0;k<a.length;k++){var h=a[k];p.negate(h.direction,v);d(v,f,u);c.elementwiseProduct(u,y);c.scalarProduct(u,
h.intensity[0],x);c.add(b.r,x);c.scalarProduct(u,h.intensity[1],x);c.add(b.g,x);c.scalarProduct(u,h.intensity[2],x);c.add(b.b,x)}return b}function t(a,b){d(v,0,u);for(var c=0;c<a.length;c++){var e=a[c];b.r[0]+=u[0]*y[0]*e.intensity[0]*4*Math.PI;b.g[0]+=u[0]*y[0]*e.intensity[1]*4*Math.PI;b.b[0]+=u[0]*y[0]*e.intensity[2]*4*Math.PI}return b}Object.defineProperty(g,"__esModule",{value:!0});var p=f.vec3d;g.numberOfCoefficients=l;g.numberOfCoefficientsInBand=function(a){return 2*a+1};g.orderFromNumberOfCoefficients=
e;g.computeCoefficients=d;g.initSHCoefficients=h;g.projectFillLights=n;g.projectAmbientLights=t;g.combineLights=function(a,d,e,f){h(d,f.sh);p.set3(0,0,0,e.intensity);var l=!1,g=k,u=q;d=m;g.length=0;u.length=0;for(var v=d.length=0;v<a.length;v++){var A=a[v];A instanceof b.MainLight&&!l?(p.set(A.direction,e.direction),e.intensity[0]=A.intensity[0],e.intensity[1]=A.intensity[1],e.intensity[2]=A.intensity[2],e.castShadows=A.castShadows,l=!0):A instanceof b.MainLight||A instanceof b.FillLight?g.push(A):
A instanceof b.AmbientLight?u.push(A):A instanceof b.SphericalHarmonicsLight&&d.push(A)}n(g,f.sh);t(u,f.sh);for(a=0;a<d.length;a++)A=d[a],c.add(f.sh.r,A.sh.r),c.add(f.sh.g,A.sh.g),c.add(f.sh.b,A.sh.b)};var k=[],q=[],m=[],u=[0],x=[0],v=p.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.dotProduct=function(f,
a){for(var c=0,b=0;b<f.length;b++)c+=f[b]*a[b];return c};g.elementwiseProduct=function(f,a,c){c=c||f;c.length=f.length;for(var b=0;b<f.length;b++)c[b]=f[b]*a[b];return c};g.scalarProduct=function(f,a,c){c=c||f;c.length=f.length;for(var b=0;b<f.length;b++)c[b]=f[b]*a;return c};g.add=function(f,a,c){c=c||f;c.length=f.length;for(var b=0;b<f.length;b++)c[b]=f[b]+a[b];return c}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./HUDMaterial.xml ../../../../geometry/support/aaBoundingRect ../lib/ComponentUtils ../lib/gl-matrix ../lib/GLMaterialTexture ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m){function u(a,b){void 0===b&&(b=L);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var d=b;d[0]=c[0]*(a[2]-a[0])+a[0];d[1]=c[1]*(a[3]-a[1])+a[1]}else x.set(a.anchorPos,b);return b}var x=l.vec2d,v=l.vec3d,y=l.mat3d,A=l.mat4d,C={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},B=[{name:"position",count:3,type:5126,offset:0,stride:76,
normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],D={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,
color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:C.center,shaderPolygonOffset:1E-5,polygonOffset:!1,
textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1};r=function(d){function e(a,b){b=d.call(this,b)||this;b._textureDirty=!1;b.params=q.copyParameters(a,D);"string"===typeof b.params.anchorPos&&(b.params.anchorPos=C[b.params.anchorPos]);return b}f(e,d);e.prototype.dispose=function(){};e.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,texCoordScale:a.texCoordScale,polygonOffset:a.polygonOffset,anchorPos:a.anchorPos,screenOffset:a.screenOffset,verticalOffset:a.verticalOffset,
screenSizePerspective:a.screenSizePerspective,screenSizePerspectiveAlignment:a.screenSizePerspectiveAlignment,shaderPolygonOffset:a.shaderPolygonOffset,textureIsSignedDistanceField:a.textureIsSignedDistanceField,outlineColor:a.outlineColor,outlineSize:a.outlineSize,distanceFieldBoundingBox:a.distanceFieldBoundingBox,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,textureId:a.textureId,occlusionTest:a.occlusionTest,binaryHighlightOcclusion:a.binaryHighlightOcclusion,centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:a.drawInSecondSlot}};e.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&k.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.notifyDirty("matChanged")};e.prototype.getParams=function(){return this.params};
e.prototype.getOutputAmount=function(a){return 114*a};e.prototype.getInstanceBufferLayout=function(){};e.prototype.getVertexBufferLayout=function(){return B};e.prototype.fillInterleaved=function(a,b,c,d,e,f){var h=4*f,l=a.indices[k.VertexAttrConstants.POSITION],n=a.vertexAttr[k.VertexAttrConstants.POSITION].data,g=f+m.findAttribute(B,k.VertexAttrConstants.POSITION).offset/4;for(d=0;d<l.length;++d){var p=3*l[d];q.fill(n,p,e,g,b,3);g+=19;q.fill(n,p,e,g,b,3);g+=19;q.fill(n,p,e,g,b,3);g+=19;q.fill(n,
p,e,g,b,3);g+=19;q.fill(n,p,e,g,b,3);g+=19;q.fill(n,p,e,g,b,3);g+=19}b=a.indices[k.VertexAttrConstants.NORMAL];n=a.vertexAttr[k.VertexAttrConstants.NORMAL].data;g=f+m.findAttribute(B,k.VertexAttrConstants.NORMAL).offset/4;for(d=0;d<b.length;++d)p=3*b[d],q.fill(n,p,e,g,c,3),g+=19,q.fill(n,p,e,g,c,3),g+=19,q.fill(n,p,e,g,c,3),g+=19,q.fill(n,p,e,g,c,3),g+=19,q.fill(n,p,e,g,c,3),g+=19,q.fill(n,p,e,g,c,3),g+=19;d=a.vertexAttr[k.VertexAttrConstants.UV0].data;null==d||3>=d.length?(c=p=0,b=this.params.texCoordScale[0],
n=this.params.texCoordScale[1]):(p=a.vertexAttr[k.VertexAttrConstants.UV0].data[0],c=a.vertexAttr[k.VertexAttrConstants.UV0].data[1],b=a.vertexAttr[k.VertexAttrConstants.UV0].data[2],n=a.vertexAttr[k.VertexAttrConstants.UV0].data[3]);b=Math.min(1.99999,b+1);n=Math.min(1.99999,n+1);g=f+m.findAttribute(B,k.VertexAttrConstants.UV0).offset/4;for(d=0;d<l.length;++d)e[g]=p,e[g+1]=c,g+=19,e[g]=b,e[g+1]=c,g+=19,e[g]=b,e[g+1]=n,g+=19,e[g]=b,e[g+1]=n,g+=19,e[g]=p,e[g+1]=n,g+=19,e[g]=p,e[g+1]=c,g+=19;l=a.indices[k.VertexAttrConstants.COLOR];
c=a.vertexAttr[k.VertexAttrConstants.COLOR].data;h+=m.findAttribute(B,k.VertexAttrConstants.COLOR).offset;b=new Uint8Array(e.buffer);for(d=0;d<l.length;++d)p=4*l[d],q.fillColor(c,p,b,h,4),h+=76,q.fillColor(c,p,b,h,4),h+=76,q.fillColor(c,p,b,h,4),h+=76,q.fillColor(c,p,b,h,4),h+=76,q.fillColor(c,p,b,h,4),h+=76,q.fillColor(c,p,b,h,4),h+=76;p=a.indices[k.VertexAttrConstants.SIZE];h=a.vertexAttr[k.VertexAttrConstants.SIZE].data;l=f+m.findAttribute(B,k.VertexAttrConstants.SIZE).offset/4;for(d=0;d<p.length;++d)c=
h[2*p[d]],b=h[2*p[d]+1],e[l]=c,e[l+1]=b,l+=19,e[l]=c,e[l+1]=b,l+=19,e[l]=c,e[l+1]=b,l+=19,e[l]=c,e[l+1]=b,l+=19,e[l]=c,e[l+1]=b,l+=19,e[l]=c,e[l+1]=b,l+=19;if(null!=a.indices[k.VertexAttrConstants.AUXPOS1]&&null!=a.vertexAttr[k.VertexAttrConstants.AUXPOS1])for(h=a.indices[k.VertexAttrConstants.AUXPOS1],l=a.vertexAttr[k.VertexAttrConstants.AUXPOS1].data,c=f+m.findAttribute(B,"auxpos1").offset/4,d=0;d<h.length;++d)p=4*h[d],q.fill(l,p,e,c,null,4),c+=19,q.fill(l,p,e,c,null,4),c+=19,q.fill(l,p,e,c,null,
4),c+=19,q.fill(l,p,e,c,null,4),c+=19,q.fill(l,p,e,c,null,4),c+=19,q.fill(l,p,e,c,null,4),c+=19;if(null!=a.indices[k.VertexAttrConstants.AUXPOS2]&&null!=a.vertexAttr[k.VertexAttrConstants.AUXPOS2])for(h=a.indices[k.VertexAttrConstants.AUXPOS2],a=a.vertexAttr[k.VertexAttrConstants.AUXPOS2].data,f+=m.findAttribute(B,"auxpos2").offset/4,d=0;d<h.length;++d)p=4*h[d],q.fill(a,p,e,f,null,4),f+=19,q.fill(a,p,e,f,null,4),f+=19,q.fill(a,p,e,f,null,4),f+=19,q.fill(a,p,e,f,null,4),f+=19,q.fill(a,p,e,f,null,4),
f+=19,q.fill(a,p,e,f,null,4),f+=19};e.prototype.intersect=function(a,c,d,e,f,h,l,n){if(e.isSelection&&e.enableHUDSelection&&!b.isAllHidden(c.componentVisibilities,a.data.componentOffsets)){var m=a.getData();a=this.params;f=c=1;A.toMat3(d,aa);if(n){f=n(S);c=f[0];f=f[5];n=aa;h=n[0];var q=n[1],g=n[2],p=n[3],y=n[4],x=n[5],C=n[6],B=n[7],D=n[8],r=1/Math.sqrt(h*h+q*q+g*g),E=1/Math.sqrt(p*p+y*y+x*x),I=1/Math.sqrt(C*C+B*B+D*D);n[0]=h*r;n[1]=q*r;n[2]=g*r;n[3]=p*E;n[4]=y*E;n[5]=x*E;n[6]=C*I;n[7]=B*I;n[8]=D*
I}n=m.getVertexAttr()[k.VertexAttrConstants.POSITION];h=m.getVertexAttr()[k.VertexAttrConstants.SIZE];m=m.getVertexAttr()[k.VertexAttrConstants.NORMAL];k.assert(3<=n.size);q=e.point;g=e.camera;p=u(a);for(y=0;y<n.data.length/n.size;y++)x=y*n.size,v.set3(n.data[x],n.data[x+1],n.data[x+2],G),A.multiplyVec3(d,G,G),x=y*h.size,X[0]=h.data[x]*c,X[1]=h.data[x+1]*f,A.multiplyVec3(g.viewMatrix,G),x=y*m.size,v.set3(m.data[x],m.data[x+1],m.data[x+2],P),this.applyVerticalOffsetTransformation(G,P,aa,g,F),g.applyProjection(G,
J),-1<J[0]&&(x=Math.floor(J[0]),B=Math.floor(J[1]),t.applyPrecomputedScaleFactorVec2(X,F.factor,X),x=x-W-(0<p[0]?X[0]*p[0]:0),C=x+X[0]+2*W,B=B-W-(0<p[1]?X[1]*p[1]:0),D=B+X[1]+2*W,a.textureIsSignedDistanceField&&(r=a.outlineSize/2,E=a.distanceFieldBoundingBox,x+=X[0]*E[0],B+=X[1]*E[1],C-=X[0]*(1-E[2]),D-=X[1]*(1-E[3]),x-=r,C+=r,B-=r,D+=r),q[0]>x&&q[0]<C&&q[1]>B&&q[1]<D&&(C=e.p0,B=e.p1,A.multiplyVec3(A.inverse(g.viewMatrix,V),G,O),J[0]=q[0],J[1]=q[1],g.unprojectPoint(J,G),x=v.negate(e.getDirection(),
v.create()),C=v.dist(C,G)/v.dist(C,B),l(C,x,-1,1,!0,O)))}};e.prototype.normalAndViewAngle=function(a,b,c,d){void 0===d&&(d=N);y.multiplyVec3(b,a,d.normal);A.multiplyVec3(c.viewInverseTransposeMatrix,d.normal);d.cosAngle=v.dot(M,Q);return d};e.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=t.precomputeScaleFactor(N.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?
(a.scaleAlignment=t.precomputeScale(N.cosAngle,c,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};e.prototype.applyVerticalOffsetTransformation=function(a,b,c,d,e,f){var h=this.params;16===c.length&&(c=A.toMat3(c,aa));if(!h.verticalOffset||!h.verticalOffset.screenLength)return e&&(h.screenSizePerspective||h.screenSizePerspectiveAlignment)?(d=this.normalAndViewAngle(b,
c,d),h=v.length(a),this.updateScaleInfo(e,d.cosAngle,h)):e&&(e.factor.scale=1,e.scaleAlignment=1),f?v.set(a,f):a;b=this.normalAndViewAngle(b,c,d);c=v.length(a);d=q.verticalOffsetAtDistance(d,c,h.verticalOffset,b.cosAngle,h.screenSizePerspectiveAlignment||h.screenSizePerspective);e&&this.updateScaleInfo(e,b.cosAngle,c);return v.add(a,v.scale(b.normal,d),f)};e.prototype.getGLMaterials=function(){return{color:E,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:H}};e.prototype.getAllTextureIds=
function(){return[this.params.textureId]};e.prototype.setTextureDirty=function(){this._textureDirty=!0};e.prototype.calculateRelativeScreenBounds=function(a,b,d){void 0===d&&(d=c.create());var e=this.params,f=d;void 0===f&&(f=L);x.set(e.anchorPos,f);f[0]*=-a[0];f[1]*=-a[1];f[0]+=e.screenOffset[0]*b;f[1]+=e.screenOffset[1]*b;d[2]=d[0]+a[0];d[3]=d[1]+a[1];return d};e.prototype.calculateAnchorPosForRendering=function(a){return u(this.params,a)};e.loadShaders=function(b,c,d){b._parse(a);var e=function(a){a.addDefine("OcclTest",
"OCCL_TEST");a.addDefine("SDF","SIGNED_DISTANCE_FIELD");a.addDefine("vvSize","VV_SIZE");a.addDefine("vvColor","VV_COLOR");a.addDefine("verticalOffset","VERTICAL_OFFSET");a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},f=new p("hud",["vertexShaderHUD","fragmentShaderHUD"],null,c,b,d);e(f);f.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER");c.addShaderVariations("hud-material-shader-variations",f);f=new p("hudHighlight",
["vertexShaderHUD","fragmentShaderHUDHighlight"],null,c,b,d);e(f);f.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION");c.addShaderVariations("hud-material-highlight-shader-variations",f);b=new p("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,c,b,d);b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");c.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",
b)};e.shouldRenderVisibilityDuringRenderPass=function(a){return a===h.MATERIAL||h.MATERIAL_HIGHLIGHT};return e}(d);e=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=q.copyParameters(b.getParams());c.selectProgram();c.selectSlot();return c}f(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?n.HUDMATERIAL2:n.HUDMATERIAL1};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};
b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.color=a.color;b.texCoordScale=a.texCoordScale;b.polygonOffset=a.polygonOffset;b.anchorPos=a.anchorPos;b.screenOffset=a.screenOffset;b.verticalOffset=a.verticalOffset;b.screenSizePerspective=a.screenSizePerspective;b.screenSizePerspectiveAlignment=a.screenSizePerspectiveAlignment;b.shaderPolygonOffset=a.shaderPolygonOffset;b.textureIsSignedDistanceField=a.textureIsSignedDistanceField;b.outlineColor=a.outlineColor;
b.outlineSize=a.outlineSize;b.vvSizeEnabled=a.vvSizeEnabled;b.vvSizeMinSize=a.vvSizeMinSize;b.vvSizeMaxSize=a.vvSizeMaxSize;b.vvSizeOffset=a.vvSizeOffset;b.vvSizeFactor=a.vvSizeFactor;b.vvColorEnabled=a.vvColorEnabled;b.vvColorValues=a.vvColorValues;b.vvColorColors=a.vvColorColors;this.updateTexture(a.textureId);this.selectProgram();this.selectSlot()};b.prototype.bindRender=function(a,b){var c=this.params,d=this.getProgram();this.bindTexture(a,d);d.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,
1);a.setActiveTexture(0);d.setUniform4fv("overrideColor",c.color);d.setUniform1f("pixelRatio",b.pixelRatio);c.textureIsSignedDistanceField&&(d.setUniform4fv("outlineColor",c.outlineColor),d.setUniform1f("outlineSize",c.outlineSize));c.vvSizeEnabled&&(d.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),d.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),d.setUniform3fv("vvSizeOffset",c.vvSizeOffset),d.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(d.setUniform1fv("vvColorValues",c.vvColorValues),
d.setUniform4fv("vvColorColors",c.vvColorColors));d.setUniform2fv("texScale",c.texCoordScale);d.setUniform2f("screenOffset",2*c.screenOffset[0],2*c.screenOffset[1]);d.setUniform2fv("anchorPos",u(c));c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};b.prototype.bindProjection=function(a,b){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var c=b.cameraAboveGround?1:-1,d=this.getProgram(),
e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);q.bindVerticalOffset(e.verticalOffset,b,d);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);e.screenSizePerspective&&(q.bindScreenSizePerspective(e.screenSizePerspective,d,"screenSizePerspective"),q.bindScreenSizePerspective(e.screenSizePerspectiveAlignment||e.screenSizePerspective,d,"screenSizePerspectiveAlignment"))};b.prototype.releaseRender=
function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();q.bindView(a,b.view,c);q.bindCamPos(a,b.viewInvTransp,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(e);var E=function(a){function b(b,c,
d){b=a.call(this,b,c,d)||this;b.isOcclusionSlot=!1;return b}f(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits]);this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,
!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,!!a.debugDrawBorder])};b.prototype.getDrawMode=function(a){a=a.gl;return this.isOcclusionSlot?a.POINTS:a.TRIANGLES};b.prototype.release=function(a){a.setDepthFunction(a.gl.LESS);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){var c=a.gl;this.bindProjection(a,b);var d=this.getProgram();a.setDepthTestEnabled(!0);a.setDepthFunction(c.LEQUAL);this.isOcclusionSlot?d.setUniform4f("color",1,1,1,1):(this.bindRender(a,
b),this.bindTexture(a,d))};b.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program};b.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]};b.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===n.OCCLUSION_PIXELS,a===n.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return b}(e),H=function(a){function b(){return null!==a&&a.apply(this,arguments)||
this}f(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,a.binaryHighlightOcclusion])};b.prototype.bind=function(a,b){this.bindProjection(a,b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(e),
F={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},L=[0,0],G=v.create(),P=v.create(),J=v.create(),M=v.create(),O=v.create(),aa=y.create(),V=A.create(),N={normal:M,cosAngle:0},S=A.create();A.identity(S);var W=1,X=[0,0],Q=[0,0,1];return r})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./GLMaterial","../materials/internal/MaterialUtil"],function(r,g,f,a,c){return function(a){function b(b,
d,f,l,g){void 0===g&&(g=!1);b=a.call(this,b,d)||this;b.textureRep=f;b.textureId=l;b.initTransparent=g;b.glTextureRef=c.aquireIfNotUndefined(b.textureId,f,b.initTransparent);return b}f(b,a);b.prototype.dispose=function(){c.releaseIfNotUndefined(this.textureId,this.textureRep)};b.prototype.updateTexture=function(a){a!==this.textureId&&(c.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=c.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};
b.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.textureId))&&a.dirty&&a.redraw&&a.redraw()};b.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};b.prototype.bindTextureSize=function(a,b){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};return b}(a)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require",
"exports"],function(r,g){return function(){function f(a,c){this.material=a;this.programRep=c}f.prototype.dispose=function(){};Object.defineProperty(f.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0});
f.prototype.isVisible=function(){return this.material.isVisible()};f.prototype.getPrograms=function(){return[this.getProgram()]};return f}()})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen","./ModelContentType"],function(r,g,f,a){return function(){function c(a){this._parentStage=null;this._visible=!0;this._renderOccluded=!1;this._renderPriority=0;this.supportsEdges=!1;this.id=c._idGen.gen(a)}Object.defineProperty(c.prototype,"parentStage",{get:function(){return this._parentStage},
enumerable:!0,configurable:!0});c.prototype.addParentStage=function(a){this._parentStage=a};c.prototype.removeParentStage=function(a){this._parentStage=null};Object.defineProperty(c.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=
a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});c.prototype.isVisible=function(){return this._visible};c.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(a.MATERIAL,this,b)};c._idGen=new f;return c}()})},"esri/views/webgl/Profiling":function(){define(["require",
"exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new f(a):null};g.getTimestamp=function(a,c,b){void 0===b&&(b=50);var f=a.capabilities.disjointTimerQuery;if(!f||0>=f.timestampBits())return null;var e=f.createQuery();f.createTimestamp(e);var d=function(){var a=f.resultAvailable(e),l=f.disjoint();a&&!l?(a=f.getResult(e),c(a/1E6)):l?c():setTimeout(d,b)};d()};g.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;
if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var f=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,b){void 0===b&&(b=50);this.cb=a;this.checkInterval=b;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=this.timer.resultAvailable(this.query),b=this.timer.disjoint();a&&!b?(a=this.timer.getResult(this.query),this.cb(a/1E6)):b?this.cb():setTimeout(this.checkQueryResult.bind(this),
this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports dojo/text!./TexOnlyGLMaterial.xml ../../lib/DefaultVertexAttributeLocations ../../lib/gl-matrix ../../lib/RenderSlot ./MaterialUtil ../../../../webgl/Program".split(" "),function(r,g,f,a,c,b,l,e){var d=c.vec4d.createFrom(1,1,1,1);return function(){function c(a,b,c,d,e){this.program=a.get("texOnly");this.color=c;this.depthFunc=e;this.blend=d;this.texGLName=b}c.prototype.beginSlot=
function(a){return a===b.INTERNAL_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.setColor=function(a){this.color=a};c.prototype.bind=function(a,b){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",l.IDENTITY);this.program.setUniformMatrix4fv("proj",b.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:d);this.program.setUniform1i("tex",0);a.bindTexture(this.texGLName,0);this.blend&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};c.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);this.blend&&a.setBlendingEnabled(!1)};c.prototype.bindView=function(a,b){l.bindView(b.origin,b.view,this.program)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};
c.loadShaders=function(b,c,d){b._parse(f);b=new e(d,b.vertexShaderTexOnly,b.fragmentShaderTexOnly,a.Default3D);c.add("texOnly",b)};return c}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(r,g,f){var a=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;f.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=
function(){return this.glMaterial};return a}();return function(){function c(a,c){this.textureRep=a;this.programRep=c;this.id2glMaterialRef={}}c.prototype.aquire=function(a){return this.aquireExt(a,"color")};c.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};c.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};c.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};c.prototype.aquireHighlight=function(a){return this.aquireExt(a,
"highlight")};c.prototype.aquireExt=function(b,c){var e=b.id+"_"+c,d=this.id2glMaterialRef[e];null==d?(b=(d=b.getGLMaterials()[c])?new d(b,this.programRep,this.textureRep):void 0,d=new a(b),this.id2glMaterialRef[e]=d):b=d.getGLMaterial();d.incRefCnt();b&&this.increaseProgramReferences(b);return b};c.prototype.release=function(a){this.releaseExt(a,"color")};c.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};c.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};c.prototype.releaseDepthShadowMap=
function(a){this.releaseExt(a,"depthShadowMap")};c.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};c.prototype.releaseExt=function(a,c){a=a+"_"+c;c=this.id2glMaterialRef[a];c.decRefCnt();if(0===c.getRefCnt()){if(c=c.getGLMaterial())this.decreaseProgramReferences(c),c.dispose();delete this.id2glMaterialRef[a]}};c.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+
"_depth"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};c.prototype.updateParamsForMat=function(a){a.updateParameters&&a.updateParameters()};c.prototype.increaseProgramReferences=
function(a){a=a.getPrograms();for(var b=0;b<a.length;b++)this.programRep.increaseRefCount(a[b])};c.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var b=0;b<a.length;b++)this.programRep.decreaseRefCount(a[b])};return c}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports dojo/text!../materials/internal/highlight.xml ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){var q=l.vec4d;return function(){function l(a,b,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=q.create();this.programRep=a;this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}l.prototype._gridUpdateResources=
function(a,d){var e=this._rctx,f=this._grid,l=!1;null===f.coverageMipmap&&(f.coverageMipmap=[a],l=!0);if(f.viewportWidth!==a.width||f.viewportHeight!==a.height)l=!0,f.viewportWidth=a.width,f.viewportHeight=a.height;f.coverageMipmap[0]=a;f.cellPixelSize!==d&&(f.cellPixelSize=d,l=!0);if(l){for(d=1;d<f.coverageMipmap.length;d++)f.coverageMipmap[d].dispose();f.mipmapLevels=Math.ceil(Math.log(f.cellPixelSize)*Math.LOG2E);f.coverageMipmap.length=f.mipmapLevels+1;for(d=0;d<f.mipmapLevels;d++)l=f.coverageMipmap[d],
l=n.createWithAttachments(e,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)}),f.coverageMipmap[d+1]=l}var l=Math.ceil(a.height/f.cellPixelSize),m=Math.ceil(a.width/f.cellPixelSize);if(!f.vao||f.verticalCellCount!==l||f.horizontalCellCount!==m){f.verticalCellCount=l;f.horizontalCellCount=m;a=l+1;d=m+1;for(var l=1/l,m=1/m,
q=new Float32Array(24*a*d),g=0,p=0;p<a;p++)for(var u=0;u<d;u++)q[g+0]=(u-.5)*m*2-1,q[g+1]=(p-.5)*l*2-1,q[g+2]=u*m,q[g+3]=p*l,q[g+4]=(u+.5)*m*2-1,q[g+5]=(p-.5)*l*2-1,q[g+6]=u*m,q[g+7]=p*l,q[g+8]=(u-.5)*m*2-1,q[g+9]=(p+.5)*l*2-1,q[g+10]=u*m,q[g+11]=p*l,q[g+12]=(u-.5)*m*2-1,q[g+13]=(p+.5)*l*2-1,q[g+14]=u*m,q[g+15]=p*l,q[g+16]=(u+.5)*m*2-1,q[g+17]=(p-.5)*l*2-1,q[g+18]=u*m,q[g+19]=p*l,q[g+20]=(u+.5)*m*2-1,q[g+21]=(p+.5)*l*2-1,q[g+22]=u*m,q[g+23]=p*l,g+=24;f.vao&&f.vao.dispose(!0);f.vao=new k(e,c.Default3D,
{geometry:b.Pos2Tex},{geometry:h.createVertex(e,35044,q)})}};l.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.programRep.get("conservative-downsample");a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,
f);a.drawArrays(5,0,p.vertexCount(this.quadVAO,"geometry"))}};Object.defineProperty(l.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});l.prototype.getIsSupported=function(){return!0};l.prototype.setEnableState=function(a){a?this.enable():this.disable()};l.prototype.getEnableState=function(){return null!==this.blur0Fbo};l.prototype.enable=function(){this.quadVAO=e.createQuadVAO(this._rctx);
var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=n.createWithAttachments(this._rctx,b,a);this.blur1Fbo=n.createWithAttachments(this._rctx,b,a)};l.prototype.disable=function(){this.getEnableState()&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};l.prototype.getHighlightFBO=function(){return this.blur0Fbo};
l.prototype.render=function(b,c,e){var f=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=a.HIGHLIGHTS_VISUALIZE_BLOCKS,k=this._rctx;d.assert(this.getEnableState());q.set(b.fullViewport,this.viewportToRestore);b=Math.ceil(e.width/1);var l=Math.ceil(e.height/1);this.blur0Fbo.resize(b,l);this.blur1Fbo.resize(b,l);k.bindVAO(this.quadVAO);k.setDepthWriteEnabled(!1);k.setDepthTestEnabled(!1);k.setBlendingEnabled(!1);var n=null,m=n=null,g=null;if(f){var u=this._grid;this._gridUpdateResources(e,32);this._gridComputeMipmap();
m=u.vao;g=4;n=this.programRep.get("highlight-blur-grid-5");k.bindProgram(n);k.bindTexture(u.coverageMipmap[u.mipmapLevels].colorTexture,1);n.setUniform1i("coverageTex",1)}else m=this.quadVAO,g=5,n=this.programRep.get("highlight-blur-5"),k.bindProgram(n);k.bindVAO(m);k.bindFramebuffer(this.blur0Fbo);k.setViewport(0,0,b,l);k.setClearColor(0,0,0,0);k.clear(k.gl.COLOR_BUFFER_BIT);n.setUniform1i("tex",0);k.bindTexture(e.colorTexture,0);n.setUniform2f("blurSize",1/b,0);k.drawArrays(g,0,p.vertexCount(m,
"geometry"));k.bindFramebuffer(this.blur1Fbo);k.clear(k.gl.COLOR_BUFFER_BIT);k.bindTexture(this.blur0Fbo.colorTexture,0);n.setUniform2f("blurSize",0,1/l);k.drawArrays(g,0,p.vertexCount(m,"geometry"));k.bindFramebuffer(c);k.setBlendingEnabled(!0);k.setBlendFunctionSeparate(770,771,1,771);k.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);f?(n=this.programRep.get(h?"highlight-apply-grid-debug":"highlight-apply-grid"),k.bindProgram(n),
n.setUniform1i("coverageTex",2),k.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(n=this.programRep.get("highlight-apply"),k.bindProgram(n));n.setUniform1i("tex",0);k.bindTexture(this.blur1Fbo.colorTexture,0);n.setUniform1i("origin",1);k.bindTexture(e.colorTexture,1);n.setUniform4fv("color",this.defaultOptions.color);n.setUniform1f("outlineSize",8.6);n.setUniform1f("blurSize",.4);n.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,
this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);k.drawArrays(g,0,p.vertexCount(m,"geometry"));k.bindVAO(null);k.setDepthWriteEnabled(!0);k.setDepthTestEnabled(!0);k.setBlendingEnabled(!1)};l.prototype.setDefaultOptions=function(a){this.defaultOptions=a};l.loadShaders=function(a,b,d){a._parse(f);for(var e=0,k=["3","5","7","9"];e<k.length;e++){var h=k[e];b.add("highlight-blur-"+h,new t(d,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,c.Default3D,{GAUSSIAN_SAMPLES:h}));
b.add("highlight-blur-grid-"+h,new t(d,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,c.Default3D,{GAUSSIAN_SAMPLES:h,GRID_OPTIMIZATION:"true"}))}b.add("highlight-apply",new t(d,a.vsHighlightApply,a.fsHighlightApply,c.Default3D));b.add("highlight-apply-grid",new t(d,a.vsHighlightApply,a.fsHighlightApply,c.Default3D,["GRID_OPTIMIZATION"]));b.add("highlight-apply-grid-debug",new t(d,a.vsHighlightApply,a.fsHighlightApply,c.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"]));b.add("conservative-downsample",
new t(d,a.vsConservativeDownsample,a.fsConservativeDownsample,c.Default3D))};return l}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util"],function(r,g,f){return function(){function a(){this.shaderVariators={};this._nextId=0;this._programsByName={};this._namesById=[];this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=
function(){for(var a in this._programsByName)this._programsByName[a].dispose();this._programRefCount=this._namesById=this._programsByName=null};a.prototype.add=function(a,b){f.assert(null==this._programsByName[a]);this._programsByName[a]=b;this._namesById[b.id]=a};a.prototype.get=function(a){return this._programsByName[a]};a.prototype.addShaderVariations=function(a,b){this.shaderVariators[a]=b};a.prototype.getShaderVariations=function(a){return this.shaderVariators[a]};a.prototype.getShaderVariationsProgram=
function(a,b,f,e,d){return(a=this.getShaderVariations(a))&&a.getProgram(b,f,e,d)};a.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};a.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:(this._programRefCount[b]=1,this._findCommonUniforms(a))};a.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};a.prototype._getNextId=
function(){return this._nextId++};a.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(f.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[b].push(a))};a.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var c=this._commonUniforms[b],e=c.indexOf(a);-1<e&&(c[e]=c[c.length-1],c.pop())}};return a}()})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports dojo/text!../materials/internal/occluded.xml ./DefaultVertexAttributeLocations ./gl-matrix ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h){var n=c.vec4d;return function(){function c(a,b,c){this._quadVAO=null;this._rctx=c;this._colorFBO=void 0;this._viewportToRestore=n.create();this.programRep=a}Object.defineProperty(c.prototype,"colorFBO",{get:function(){return this._colorFBO},enumerable:!0,configurable:!0});c.prototype.setEnableState=function(a){a?this.enable():this.disable()};c.prototype.getEnableState=function(){return void 0!==this._colorFBO};c.prototype.enable=function(){this._quadVAO=b.createQuadVAO(this._rctx);
this._colorFBO=e.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};c.prototype.disable=function(){this.getEnableState()&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)};c.prototype.setupFBOs=function(a){l.assert(this.getEnableState());this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=a[3];this._rctx.setViewport(0,
0,this._width,this._height)};c.prototype.prepareColorPass=function(){l.assert(this.getEnableState());var a=this._rctx,b=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};c.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])};c.prototype.apply=function(){var a=
this._rctx,b=this.programRep.get("render-occluded-apply");a.bindProgram(b);a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);b.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,h.vertexCount(this._quadVAO,"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)};c.loadShaders=function(b,c,e){b._parse(f);c.add("render-occluded-apply",
new d(e,b.vsRenderOccludedApply,b.fsRenderOccludedApply,a.Default3D))};return c}()})},"esri/views/3d/webgl-engine/lib/ShaderSnippets":function(){define(["require","exports","dojox/xml/parser","./Util"],function(r,g,f,a){return function(){function c(b){var c=a.VertexAttrConstants,e;for(e in c)this[c[e]]=a.VertexAttrConstants[e];if(b)for(var d in b)this[d]=b[d]}c.prototype._parse=function(b){b=f.parse(b).getElementsByTagName("snippet");for(var c=/\$[a-zA-Z0-9_]+[ \t]*/,e=/[\$\s]+/g,d=0;d<b.length;d++){var h=
b[d].getAttribute("name");a.assert(null==this[h]);for(var n=b[d].textContent;;){var g=n.match(c);if(null==g)break;var p=this[g[0].replace(e,"")];a.assert(void 0!==p);n=n.replace(g[0],p)}this[h]=n}};return c}()})},"dojox/xml/parser":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(r){r.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(g,f){var a=r.doc,c;f=f||"text/xml";if(g&&r.trim(g)&&"DOMParser"in r.global){c=
(new DOMParser).parseFromString(g,f);g=c.documentElement;if("parsererror"==g.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==g.namespaceURI){if(a=g.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0])a=a.firstChild.data;throw Error("Error parsing text "+g.firstChild.data+" \n"+a);}return c}if("ActiveXObject"in r.global){a=function(a){return"MSXML"+a+".DOMDocument"};a=["Microsoft.XMLDOM",a(6),a(4),a(3),a(2)];r.some(a,function(a){try{c=new ActiveXObject(a)}catch(e){return!1}return!0});
if(g&&c&&(c.async=!1,c.loadXML(g),g=c.parseError,0!==g.errorCode))throw Error("Line: "+g.line+"\nCol: "+g.linepos+"\nReason: "+g.reason+"\nError Code: "+g.errorCode+"\nSource: "+g.srcText);if(c)return c}else if(a.implementation&&a.implementation.createDocument){if(g&&r.trim(g)&&a.createElement){f=a.createElement("xml");f.innerHTML=g;var b=a.implementation.createDocument("foo","",null);r.forEach(f.childNodes,function(a){b.importNode(a,!0)});return b}return a.implementation.createDocument("","",null)}return null};
dojox.xml.parser.textContent=function(g,f){if(1<arguments.length)return dojox.xml.parser.replaceChildren(g,(g.ownerDocument||r.doc).createTextNode(f)),f;if(void 0!==g.textContent)return g.textContent;var a="";g&&r.forEach(g.childNodes,function(c){switch(c.nodeType){case 1:case 5:a+=dojox.xml.parser.textContent(c);break;case 3:case 2:case 4:a+=c.nodeValue}});return a};dojox.xml.parser.replaceChildren=function(g,f){var a=[];r.isIE&&r.forEach(g.childNodes,function(c){a.push(c)});dojox.xml.parser.removeChildren(g);
r.forEach(a,r.destroy);r.isArray(f)?r.forEach(f,function(a){g.appendChild(a)}):g.appendChild(f)};dojox.xml.parser.removeChildren=function(g){for(var f=g.childNodes.length;g.hasChildNodes();)g.removeChild(g.firstChild);return f};dojox.xml.parser.innerXML=function(g){return g.innerXML?g.innerXML:g.xml?g.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(g):null};return dojox.xml.parser})},"esri/views/3d/webgl-engine/lib/SSAOHelperObscurance":function(){define("require exports dojo/text!../materials/internal/ssao.xml ../../../../core/Logger ../../support/imageUtils ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m){var u=a.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelperObscurance");r=function(){function a(a,b,c,f){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=e.vec4d.create();this._rctx=c;this._programRep=a;this._requestRender=f;this._emptyTexture=d.createEmptyTexture(c)}a.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};a.prototype.getIsSupported=function(){var a=this._rctx,
b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),c=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return a.capabilities.standardDerivatives&&!(b||c)};a.prototype.setEnableState=function(a){a?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.enable=function(){var a=this;if(!this.getEnableState())if(this.getIsSupported()){this._enabled=!0;var b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},
d={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=t.createWithAttachments(this._rctx,b,d);this._blur0FBO=t.createWithAttachments(this._rctx,b,d);this._blur1FBO=t.createWithAttachments(this._rctx,b,d);c.requestImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAqf0lEQVR42gTBB5ydB2EY8G/v8b7v7Xnv9mmcdFp3WpasZUuWFzZgDJgkhgwoSdM2JbTNjzZA06ZNgaRJWtKSEgjDGNuA8UYeWpZkbZ10uj3efu977317j/7/4De/8ef9vCow2VUGGHzRhuQ+t08GvhZb+jy85wOu/68JzwtQSCZedpsvC8SL6NJNNwZoHMaZiMoCrjrPATpGJFxvRCYMKqTCBsyVw8h5B6ROArU3+8HOGLe3Ay+UABow3D4wEcfOakDbjh2h594mikMNcI62ISNzIius0bfeN+QHrv+L7M53FHq1XC29breFgmCjwPHQ/fo88OIg9kvDdQPhB93G8yk6DtRYFT64fR/jQn0NIcIgYHylyFjVHPBboCB7HQ5sXuoZqQCHqKUjtvKNpvxkivqlZe514DOA/Keethib6OkOw204MMTjY3HX8VIGFeITgBEApGRFY3hyKyPeRWK/NNa2huJeLKzBJAimiY7ZQbAh0HwPEP9jxHhs6he37z8+KWqdeD7TCttNwgHftJpfzCq/iOJbKrxap2Ymet8zwVEoNReE7T4aI6t2mBuO4Meyh3vHAeK2+KvLzWHEgSCJpgR5EvP7QPFLyeDWWrqc1iVz6LwPI7GEpOEExCwzVZwtKtDGyzRW5tGyz5WA7HLtfrOIHp9T9kXQB1z7E10eYMytTs5QOuci8E+YIk9W/roj5nxvjVVLaM+30x/09CPGIdQlfsOe/WqxoS9Sf5bVv+drIqyP6uNrQMxFGDPSt1PurVE/UcuV9ci35bmCPTiIjsuZZjZCePj01iMbKBYa7UyVIDI+MDMSAV7sw6CSjKEG0IqwXhEkVtFwFJQ9D3q9q2RE8xEzuxvCN0Bq0pAFH7IMZEW3/zQU6rQ8Dw1bqPE2XCxtht8B/Hsg/yzu3CUcGdb6PW6QCVRs7bYKDwDQfYefmmJO2O/d4LyOzns2kA3kt7Bxrn1ZZ4hlYFs+uYpAnNDyDI36VE+6wLadkEwTwQIdYovCIM8SEVS24D+ktuqjWIT4yWFEN/zEfsqIWkFfKQsW8DNVyLEDKWwZ6ew8x5ojpAmh7DbTuiCGFcW/DXl5hO7Y/BztDCbwqtMaxcanBq59oBYuVIAM2o2twXHduUpDjChd7xinXHoB5OKsvd/jlrN+SnHoir0dn1hWWSbrDzj0Nd6x3PUb1LYyVIpv9AHW9sPW+aEhU8peULyaAG12TddDnq0zVg5S+vfnVLQBwjt3PcU9k0feDfAkCjohqkfBRgeVfcx1xYcTzRYoNbVPbCQ/mmC66x3pMpN7IPDeT7a2+TYYDYj41QNoEoGVQhPLlIPb8k2yMZlM2gNIiEu4nfIZFKeDW08qY9ds2wLoLWIt2yJuYrXnWhNbytRVs1sHIw6qhoE/sYJsJArzFLNdUzxalSOyF3oIBU2ttqZFumoEj6XoZVOHKWSJDoGe+WGZmObQuA4f+uap/u15hOEW1LveusgkSWNvivQRRg7bAQWcd+wUcmN/DTkr6XeHmX/pVnYkebSt/RBNP8PhsXnqFhfUu/ozIH++g98KYa+EnqoRZtFucB/WVPy5MoJEyH+RgSeFoTuDS3Rjpi7Iog/+N2aD7N9oJkprVsWpNOqZ5JsMfDKSID//tUCyQrANUm4Q/czDP1mKVTo2lrM6uuJh9RV3pMc1ylB/5zpYs3EWgR87+hDYZY06VIzFYd+HxTY9FyARG0RytMQAJujsU3Pz/qPlwVVI99+KBosYv4qQOzQP4WWCfPVd5eSjvPMmAkY0LFL9lX5vMfDKgtMADu3pCrNLctVht8XYBr6KRvBkWte8jafxscvmLE7tITB4IxDf4GJ/7YdtklZdgOO6z62Bj4ADitP0UfcQAiwSnoEgw44j+mCCpjb7zL2IcBSOYLS5ArdRgU/EJrsgnLhuAgv6ylO+fTYJZMPiFVUt4bafDNpq8gW2/+Wc1LSVejMjel0a5Yg2kUT1DzSmbB3aGVsieORVfXAq7vYkeQUZKUHxZlufMOFKsneeaJYoxjH4j6q2BObSoPx+o2RkzKti/lyb2uC7h60bB4z9maJ4tnFpvw/fQ8zfJ3IAAiSE6G2X40l/PFI+xGgcAjM+/31BL8p1KGRn8kFaztzEFxsAfOxjR910VTxaqsh6/z5RGNebzyWtoossscYHUPKL91d9BhtQTclREMGf6PoMnmDJ6orHxKl7RZO9DwAIBqRCqlbTHs8hf0fa/1ZcPuxk/I42xYnbafCqgGGatSnGPUaE/1azHhdzw/rok76dX+vslH00lkxaRKfW/wwn3mJTQOH5bu/vzgMJNnTuAvJMFL3p9f90ttxSrfnxNusCI0spKhX0O7XBAHcouivCT56YhuFE+A4vrQr7VfSfeXbsbpt4rbhpwuNPNBagcd8A6DO4PgSzeDQ6lGlIevQ2yGyG3fn49mPgnTNJZqVuLwC8E3FFyBozgL47rtOWlrXOd1s/dRPjgYmLAzl2dWFOGk+bW+PStap2Xm/ERvzJdDYd4fd16N3x3ooL/FzJ8PEPT4H4WRk5ygiRK97yrjHU5p/69gdFfUdLiDlYG0NeFYyjRmZNdLM6mDPgwceejmpR8ek2Pm02WQ3ZqW5nCDTpL9931LtJdladOI0oZjCwoGICD1xZV4cYZxIgzhjekCf9wh4+jDU5IjvsdEm/12T6e0aJ5YqnS7ROWkWBX3FAnboqd7c6kAcAxZwBS3bSAZcH0F6pV/7AkfvSEzW3fzrp1VvQjkL3wetuK7N/CV692ve/zNVq5KYktPLl/CMDhNzFjT6ZOIK3RgxqBaLxgL8Aoc+F8MeP7gFuRpXbCDtlAbL10NvMh/tsocPBVQx9SFIIiN0CNzcipYWwz5GmjGWiarABr7U30U+uUNtF9/saPWDaKnox3JOtzsKvq1INHtwgug+a9C8U+XIiPGGIWaCNg7RE1WFxot+t3g22M6JFGzGOpSzmpS+ODP4Q6RwuwVKDW0f8olQHYv4Iwf51NAr0mmJoXL1TpxX/Jwq9m3b+wiCKtLfiNrWV4I/5xBkDPvnpZ+Q8EN/Czdf1bA+T5A6JpRxP74kwUm8y12j7Jd+fsDMtag5nJvLUigJjbnooZikOBpxD6T+Nk7Ln0kFZlhujYcHz/L1UK05AHRt+gErP4E4f5gKsX+O8TCsbUG1hHj2+vX3Ng7bL0R3a5KytLaPmeay0xND+gBfUj9Phq/2xfYKS87H3ta1Qso4H9Ca6X0hoMdy/IXM7QuhIVg9ZbI2oBRhk6xpX8qoHNrL9POGnrNERY9igV1x61qKLAvFcGoiRcch1N+k7LK/5D0D3eIobCG4s2iADwB67+vJqtk0Tc1TMkgQLKKRG4Bl48I3u2FQq/lO3XbK9g21Br2Wrcyobb2DqyLVhQbWbiwX3JdQGgLjIbjStUiveYGF6IpjdMZj6eyO1pSwXCSByV38TzEY2/VEpeAXdtABk0qq9aZB+cGf+ukGgq26f4iAJfso+9b38L3dfnIImHIwH4TRyf4e78yxS+Uxq6TugN4xw5XDxOoluqXYDJhgyxre24BJr10njnXjpWcTtWbdv4aXNbXQq03s36vFSR1oz9oxk321YuwoQdbNCsfy3tHAmMcnpdcCnnvFu3ffTYs/Ph90bPfqToDdPLPaNcCKivoo0Rwkqbsk1bPVbJpYxGIKUfXH4pK6H8fghaPY13icA4JO+NLuCpoYlHDM9EB75+kNH/n6o9zE+TRnBkkL8xiqWY+Q9ZzaAg4+fLzZjhNfw3w/gUQRFiPz+fPeS0b8aFIJGPC+rr24QY6gIO9YVpEO6A2aaeyYdXRMVVLdKluURo78cBmBt9EtRzeNaKwWKt2E84X3D5pkIp/iAp5BlCgOpbCJAGniU3QBwNA46JmID4zirCmjDcPth6PehZa+zDdAvOqltgXj53q4T5ealBjQn4yoLHxl7ENmhUxeNvsVRYwtikoW6UeUxgr9EMFvwiR9UeuVRYKur4GLqMtLds4H9c7GxNSJGLKubjwZ8TGOXLmgCr4e5uEw7XWCj+lNk1wMUOZOC/mXXfhLtvOu24Kyd7Rq3dEnkuAFo8DA4pyLpJ0zioo44oRxXdESQO1rq81ulq3WDJXbt3ADVNIjWg2a/R+JYnI2PeepVLB6LPzi5eMUa2/jvGWrYA0pIsd2Ax6mPHbLgJuQbN3uQNGGu19WDg/3b6lAnBRn9N3KlQsrLj5LkBOCnwk7P3pLX1ljdnh8cnPPerTvbJmSkWHISCPCTNYii/Dg4JrjaCNS+3DAPRwm9DyJkalkLQz4YsGNLFveiCyw6cE4MzvjUgRAl0jAQclYHdAaYaFVABepI4sP/oeepxPi9oGlSi3tpWIX0FzAOuE71y02MAmdQrbkGPmClGtJGKw+fOHi4cTrPd5qF/4KGkWmwqPqRP9fyB03ZL2FMBtc/W3/43eT17zGJUY+tBegRFjLJktlYf8TKpkmzJai8GvczudWw+UeEPcTZGuLLoFGDpv5YDH7ZFo4P1jmZ3TCjEotNcBqm155Pjm3NzFEKWKF7KcVY72eG4IF507vbNnbj9CwxsimhPW5KBT/cwpfvy/YzvJdcA+6n/B0d85Em9Jpj0SJ6LewBcL7Fw//+NzPSGw1uSqy9jfTmcJuyMzyA57DcJ7BZOkbPIcUXsDPjoMXY/keYYLd0Rax9ZOgJqJzTsb8onXqy1r3kKf8mbdIKVceTSXiiGi4/HR7Pt5tt27+BzW2VM1tj6lqIToB4087XR9bgOfSFKyGf5eeM2J0YhpmrH9/Uu2+28qDSL1av08BUz/i2dTounIci36M4SXJfQvpHifh6TOnD1lTMejVlfZUXf66md5FwdmEaOG1150HxOMK+gQNbgOZs0N1/lb7CJLdA8ILbK7RYCYPhDrXAb+xLMG4f8mFkDpBeyS5+tXLxfxPxJxjk++79i5TfpbnAivqN+HcMfaKsuVEQwkWRTQ6/a5BboYuIP2CsCo3BHucNjYkXfHt7YLxqKU/w4c/bdMrAM0RpawTOtWVdL3+l+Mr9a6KGHjzCdL+Pcs82YJuhXDZ2rh2NZcStekK3eqM4bjnwp/7yMa1OFl1OV3t6QPCo35w0tr2V7Copy7J1Es2x8Vv/HFIPufBxivtOv7nfIH2UelqlYzTdYMRhlOaizWtwONQqix3wIN5egwKRjEqW/h7rM7j0/YG2BRMfQkYeQJUQeo9nCmVps09F9focPDhOOXQUQMjU5dVeslBdgwfdev4kpssy+ovCLglTwJ6SUOXLRMTn3S0pz10x5bTC15u11cl30Nk9Jrzr0xP8nKHV48h0J54cVJqaeI9qlm1gjOB1k0QhXwFP2ObcgC+t0r1ti6P/KzA/SXo/IN0SMFjq9ZuIrLr9A1akw429QOUM5B5UEmUvRmTAe60bM1yWrYMPpCFXI/q4RWB0CWq9rGRvUP6uaKQ/IG34bkpJkt3ViM6N0IEnJx4orp2D+v9I4duJatlZ7BHsJdqYiWJ5E3tNwoeEVCoY2xmtrCoYT1IXAPjUwBP+UKQvs1zFNa06XEMiWsMnUtTlALgZWDlM1hWo28GbMfiUPvgdt/o7pfRflcM/cqANpekRiR1c1GDZum7sabObAKJGAiHtLqegHQC9DUL/UQuHsMQHtHGasfv6lruN/s+g4LNBZ8IJFEA+CQPYmvAjW3wuu8Em2BOLwXwZlFGfMPA9gYvg7ivh8mmQV+jMZCwMKS/nJW8SwW8HazdipRdLct7AJkj40MeOWg3QPwIrXSSc0ovjYScZv/py9VCo137HQyowz7J1BdefseFZXLWQTNmHRNUYHKOArrc1Ld3Tuhw9+iusRlGgUILvkENzEP00tfai71AkRVocwA0+urjxvsVO2au4HpYHBLzTXC5UGH9S7qA+0j8DO6I9fVCSn0La27FII/Qbem53DIga6BQMqMD2zzG2vQobkLxi4skm+av45lv9+w+7UIYVvifAu/74qdQWePGbEC300M0D1rtJrtekESHiIQhLqFk1c20F3oyQ/1MLh3NF2TCvWlpMoB11+RF/m885P9EFQfa2INC4bf0oSDykNB1c7ThJKog6qH/NiRykcxtxc2BiNWPBGQs03Gqy95X23pK3XS3Id6JoO1j/fb+rDEHXOWYCdF5p3D/MD/9Mrf9+0tmM5+43b29zk5/TG88Wc7/BuItg64CzAGDFRsPDYMwC4GPHTsRewpMoEvw7U5wNabW1NhdM5YstTBJvmeCl7EufAXYGheRUrgK3lAcnaBjUtvX7A1YCYrVzG4BI+Fs3u211IAOjITr3qxz1iQhYAzxcC97nqQcC/gNJ/ksGu21JMSvl4BgZhY+tDS2kbAZC/0+j2RmMSIBqxviUr8mBMw5m0irMJ0A6wqp4q7OS54rtv3SYfwE31V4hYBefEWo9yP7E3S6Ry/zAdvd68APdrcHzIBj1kQVNtfTmSN4Y1lvHcX/BxRMGVgizNziT1a+NL4f1ZGrBBLkAbTppStCqqHPLZhyPiDx3SKmtw205TO2WxMEQqkULr7vCn91BzmndvbHWFAu8GiSrgAZyZNMScbS5iAArlhrh5G4HedwL/wH2E6v+bbD1O455A4uBvlNoAUNKwqPsjk9+loTuhkiXwuigelze5UHCb/AJNKw2cc+G4CfE/Z0ZwVsDXSAOfr9R/gpL/ghGMJOL8BA2mOuKNInxFF6AW/7uErMW8sNkEBOBtXXXEbm30CCTJbxe6EOIbec+RTjqvdUflOP7AfgnkC8nhSIm3neEOmts61kCO/o2RP02eqWjJjzYn3A/WgFSoyAwj64gKr0H3nFCK7pZt2FDmwwcSqB3YBMgY3HXWDAoBqr9PHSGIeh/l/QZXZpL2wpO7AylAwZ87Pce3z6xUVvn4SNt0I8zpte4alIJpNWn8cjfSE4UKTvooupk8qPXRvFrmj6smvX17qSIX9baO7HYIjg6IqOvJIEg3tVQ9qyR25F2fx7JpzrMHwCdjgkYRexElPxR1RDICwMQssAVuoCZADE5CJ9ZJS8LV/rUdEFDlFhrI1yQ+/EEZmII9DDLO54bQvrj5cmbQPfa7cH/UOQXdKzucZ2IOklamgTnaRQuwQ/+x1PS39leFqUqIMbQ9x6YH8xs9TiGTviU6lvwehYNuM1i85I+gNg8DiEuTIIk2iOce93t0LQ0udyF6JpSw2dw9G1nJVmKfxT36xJryH6PzgQR9qRD1Mm5e37Mygzm/LbTyeGse9tUbxKBlqB2FtLmQgRT0XuwlEeSNxcWvzw98AE28vXwWr2FlIrAWsXu9Qf2Q3c/wgIo6RZJ5GQlejmceYZfebOaO8nDj/iTnf8s2C9IEEsxD0K57+JXP2Utf9NInQAnGuzKs458w4LXRbgQ9GaWxz4G11+LwAVYeMNM7iHu6gv4qVhtn2OYKeKRJRdJHF61unu1ms8j/2aR7OYTz6aWX1mXRDFnB7aepsLG4BHvkkwVYqa/DYsRNiB3CDPZ2q5Kr5L8oC6j5ULS3/jzu6tf88tQ1tTXmBhfdwgUwXDbbt33gD8woaq7sVQiLnSMXLTtZzY89fkny98x1N8pSu8ETpNAIhg/T8GIQvlae9NA9hx0Nc/krzNurU+PlTodk7+HO9MBugPzcYk8hFtQfN/X7klPxXMLqKf25wcIYKZhb/Htf+L1Uc18kw5jZOGML5c98ZDc5yHfzmVjvWqAh2URb7rTpwH7Z5Z+n7SJeCIdOVzgdwzy80P8Hd9okBHiZ/rd9S+Vrvw4zFlirKiTK6TcVpw1zP5HqVhBXt6RhPfu3IsNMMHfNPSZVSonE3UuRpsMiGM3OJSv93QnDntYsYtdGVuljAmJA47Bndeazv44WQHWORbVjGCIspejDdhnQEoI5OYlcXg5yt52/BHhWJF2Rgxn5H7RStg/JEAf9XnV5j1UAfm2Iy+qgJmEmxTPRFm9jxx0wK5FwlHNEHBPdTZ53Mfs/p00dG2Ren4MbqsBCHPX40CcaD98IfZyAX/LGkYN+CRygtyrER/0WGlb84sVrjlknK7HuCRx0us3BOkONLiBYUCABPNb+cChaP1nBEzlW6DhhQp4wS7EaP8jKzkYuZbKviVem6ZHQsCk7QpfziL22v/or/9J1/1wUns39AYhbg+CwWbwRuSzsQTe07J0eMfvMWHVtaiDsBwCaUJapcqMVu/+bgG9YOOvJ0rvKPZQBrhYhc4Z5hMKxupj1xvFyWmg1W5N56lDJHzoDx/cuAshRzC4RgMiLb4Q2pN8r9bnJc+XUvwe3YZ5fcMVHyusfcuXdpv27i51WA0lbuZsfK3s5de9lWW9zXCCmTWIWhI18QtJZ9RNj1RbAC/ACLbCUo/Cit3JZCjjtKR+f5zdBJtOH2uWGr47tDtauNpKbom3Vu6n4oxtJhFDmzaT2pc62ZPu0gKZ4cnId/Bp195CRRtJRKMX3+4KNbD9NDEARUw+Dj82NV0k8VggVL8EZM8rwKmwWWb4ZiA9mmtNR/6rbulcqybAyYcAajMrvmsCHZJlu0CItUtWhsU38uDA04ET8wqzujLFgSgRRzt+kXEaAKwDm59pL/0Y4byu6kKl7cTK+UR9vb7pvG1tF02qxaRg1uiHnx+g7wOFJdw86CMbIvQEdeeHfeLxFBSPJn5VXZvyXLVsJVZjFpf/G5N9TGEn4xIAIx1aZlnqNx48+fxpszhYt1rUyHKHyqS/reuRCO8KEKE/+p90d4cP7dOZGBZrAe4Q2Cr6VoWFGp7KU8jzB6QbTf++mX28Qt7b0RpHxG638hMdZDlOSXXCsLeIhHkEgDBnDc48xzage9HPIxbGocP0yslbVL0Ed92bnx3d/O9vKImgbfPx20LzQCP7f6r+b/H2tmDTlvc+6g0PHKeaeAe5lUU2I63NVlYI5Hba+5RBXfNRT+s/tQ4/PTEt6013TMhfYY1q4O1CPEUaPZSt/QOqj9rMG3KYH1yhRG/UXcb6yZcW8U+k+wPZPCgBlgpNu8Kf+VLERKyNT9vbszywFAMfMpx9lkOsgwtg4j67egVCDgb+ZEV+Y3qxbUuniUxWX3sxPzIPegZS/ka7kue5Y0IwTZu5WqyB9RSCfE3Uwk57704/vV7o8av3lyOVAoQ+jppahwoMNvpxOGpVqrkEMMvAXy4/1nLZ7CXbF+Kq4DobenxfVH8/pClZz8kcJjJSt/V/IWS/l38JjraIQDwVzDZtH9eDrv81QfiKDZ1jLt12E1ftzmRWhx30rpGsWMCynxugBxI8c3BRcxANJ0r34OFhMkV49Gt40u53T1vkZujkMataE3APzs1g0F8IXsmQDntQsdKFNf6iGH8VLQGmiW3JPBuidQduZTq7OqgW5JykjNnmiYjhbLj8+P7cqCWZYZRrkQTaRDf45QL5RUW9XKQDYn5MF6gY8ryV/nXW3qQrGXcQEKwbvgo4z6HJe/l20BOgwI4GgQJQVMNVFiLM3ZsX3olzj1B2we3+Guo/EO8csQZWY33MdXWPW08uYR5nM+10sH+4/+NzncE/GNbn6voapCiKV4hwCWxfwQ78q7g/B6aP81fbEJ+wCzml/1fZcKYdX5lgUa+LB/huzhEU6bsC/HuPnLhb8Wg6ni/HtV9Ygzwe4IyOGaVdivTDbEOW8wcpQLHx/7eC3Zi8sy8oXu5DhE+kw1u06LV7AqFiBTzxumkfMOCJAaDW1i2H8GXwYpRK1uBaofc2xGWoiG1SfQOZZd0xdeJz8d58GK/YijySB0J9Q+cPTWd/fav6mWhmSO8Q1NbxYhNAcb578XuSsC1uvGTGXkoqnwE2LrPE4WXsNmR+dr37NhPqTXwkhI99/qiruLWDhPRfke3BzfdO0Ym4QFzArH8aMPeu75kh1CseVwnsv8eZgrp91VD2VNU2J07EI+ZuhsZro1D0FpfMsrN9T7l9p9GKTy9r7nBy5t7G3PJk57ic3KRV0fbnLkfXYjF0cMEtFJzX6tUctEsk76FuiYm6EKzekXpHANhG2gts8KgF2qDT9Ady9p3FJLXcvD25D//CQrhEA4ctzFtu/O1u7KgeZ1Lgehq0AnjThaOUIIg7oyTm6DQFQGxYkfvTSD5z57MAe02y8MhnHbc3kWCVWgQS5KFidDa1hijkDgK9HylNiIkH7XUrO8mGx+CxPLJ6RBdr/s20MPBsaIkt9iU5tym3LEP0dJx732kMJwDPoVwVGRLds0r/XgQ5tHsywG8kAgXM0DB7PeFzbWyWa93IoiNSjCBLB+zoOu2+108JuNch6SnYLid74PzEj7llBoIHpx7hDqyxHrF/GasXOcNsJUiWOCPPptVgZcrbrM+/gYSTsRQGWXfwbi+2QpryYDX91ZRFe+c74jbKkPWQeYJdeasX+669/9kssmTPRZwQeXKLpE1E+wMyRDnkcUh+wZGLtPCR7U1wokVAtb7GMvgxlM9qyhlaafSIiZSV2vD+PkAeQIjhlvNRwBAevJgfJOo8qbpPQ2lV3ymUV1TQolwR8JBjKHETgw/91SRAJYKWvUwY46fq3dmcPUTKvlFYHq4cWmVrkV/zqAmy8WLPDahcp4/cpPwdQXMEimgoAXgeHsB/4wcD4WgpYL2kvse//ZIdm06Q86YrrHN/K2SfRJ33m8q3c8ZOC98HW3tg6JanGyYpF7dQgLGiKVfQ9BSfnsWrmyqiJkSrmImzcgVGKVKYrTVWN7tf6d09g6JtyFuSLqhgFsKE9Fy0wFs608u58BMfHhXUar/Ce5muvzisF6JoXe2fcbJTln4mpowiRCwa1bKE6YQTUT9l2z2PjQjcg7OFOC2z8RtLwKey7nwpOL7UIOmIcqMA0iv93CeLhhdhHK4m+WVcKc6sqRqPbXLI16EKsbTpOrc4BMRmvPYq2zwSQVf6zmEllfa8DyVodxwKuwDoOxBniJSY0GaSTDsOqaQq/TpWPIHx64a5xoLT7VUtdG8H8OA3t0HiED0CijKwqttKb740UfZbUfUqGDsNpefiSl7rr/f83Q50h3RzmP+FgiNLqYstIw1HsxCxO+NEcqIwD1RLyafv9PRS1ILpg6J3x9QLGncu4++SB34Fv9pKDJ2lVkflsOoIdszZhLGgK6yT3sT6qIAYAGSBuEik+gu6XOLEgRo4G9MPE8n3jPXHO7aczYZ1+58G+f9MLf5MHd1ldxDeLWLZJoN9pgofnfxs6YhJmWY95DHASjIJ7z4lgpx/SPVFkL0J+49CDoRHdmCHKHKzSLUtPev6OAMuUMQEEHouvSjVNk/k3u7co8aJ+6ADVeEupccQgcHC7UHvmhdNBOLdkMUixyPyK5y5ExMa1LU8oJ3sOnIx+RekN9rAOLaHYPY+Mg+Y7XM8dkgU5p0NAOF36Npi5F2nrS0C9fUadVLAZStsYtK4z94LmF/r8P5vHAT/Fou9Tm8cbjNGvPSpfGe9jhgGmhEpo965JlCczvY8rexaSSe7OVjwZnN2Ob0XkI0+vIwpbCs8lTFWA3WPBZ+j2YdrQXUIbCB4f3E+ES1oGFtWgKXRWKbVP8KnH6tCcoS3ie6H7TTq8e/HEl2l9buU/IptFZByo+5URfMLrQ3UGn29p2sMOyh5u9PYYuA+tOC9Dtsn0O61GrW8Vd1aH6ESfgC5Jg/P8EeGoNSrO1RuOKZ6QOKuKyDdGpj3XS1dR40xjXig7TSGmF9BUEK49IG27ZCocDx5yYHgIKBh8yjbftWO9QPkIibON4Mkgr6TQvea8SNccZVMwuqhXXh1GcPOknL/us4J3nxgC/7gSJD6ZPnuEYD5h5xabgNFEADolRV4z8cp5UeJB0vLK0bCTjKuGoBUQPwToZ9JDn5+w5NxIp4QtgLQBtgfDq1Oc+biHviY+Jm56YXtd9rtk2tlOP76Fb93EUwCcuET2W7HdYPAfxuz11rhA9bgJiSxErg86pGuTrrkL8nelqi1o1VcikcTFPFpXBsQkF9hrfTG5MedxuuME2ltj2r/X8zXK+ZOiW1l5EdKm0wYA6zzCzH/b+cGOyASKNKByGzhU+dk/DSiX2v6GbD0sUznKsJdgSIpDB5vsOUmpSXMKxhQJdBh2zQB9Uga2d7mF1i5Z8Pb/mg0GVkuNZFeFdf6/sQsRJ50cShX0xvFi14EdTAyK5xklct0uG9dU9Ly1BB7e4OdFA2kzjJ4+m4cGSTZsV7nWyCf6oBZWxqinVt+YsTvf6sQA1rUNjuKCtq0KP8EGoOrnXterJwiZH5WDOMJ9wiaTF4E1V6uuU/1KwyzJ+H1nMWLaG9MzrZDB0QJOUnUSxKEth9LU1tb7gYILPvJutypcbbUg/cb8KOPnEjRaCOkwJVQYECuiICK6u6V6FnMA4Qdf4LKiO9CPrEHjf0QCB60rN/YDmrSfSJweSDouFYaper4DVl9KMj8Qq4nhIkrzSCV1VtB8Pv6oXTxphryWz16RTVKqPbbKq9zbQasDtcKWRE9WvP3FNcsICp2kRWQCpSzS+z4+Er1rJgNglbTAWRqrATd8ElRNLkfMfFJWHPwNMPW7vUSOpc9im7UGfizlYOdvT787XWsxMF36s1xPyQov0uMDNuh7HVeyHWziyzKJnJFH1zyJG7twS5yiydQvr+9XtYK/mjNWUEdhgM3TJsWQEK3aaE+HqwUhLE1b65h42a1E3HMqoXuC4BzlnNuEIgryVdgYucd4NsTHd+tf+jBWV+6h6kT2CgOBmdI7gEfBrIYkOCO9tZGY+K770tcEjoG+l/rLT2tDByN06xhRUokM4Ltw8U/fNh/ydTjO4JddSFJ0n6Z9SMiz3lreKURYDM2Z+Szp9+zXvKr6SE29NRrJAGbmRjkSxi3sOErHFrB10tJ2uuT+/tem+j2qexl1P1B2DlgxMa8kS4WHKFWv0vqTQxY7YqnQN8jE+lmv3woeUknMmJciOh8HaLQ2A4uHN+oXYqBkyrckpNz2iLo5vZD/nuEEs/JWzZsCcp2U8YtsPcGQNdIOqvcZRD40+RjBs4WmDr7pU77XhyaIrC93dqsR+qa8BHQOWj4Bu7/Ha59bpCbhRoXY5nTHcgXGvNW2VGXpouirMtJDL3cggbY4AV6rYdtSbnCb2FR0Z3oEVYPa38SZH/o+79XTKl48AVc9BeBWAJbggJXJboVa3PUkSLquk/t1LtVD19MizUfx5LVJ+bJeSq5krVfq1glKB5TIifOV/Do4YI96WDkPPZoWbriIDEdfqy828yhXsnn3/Q6xwJvxVRu4ckHYGnN8zaBRAdlIQwaphWujvdJ4yQCnsPlge7wXDKQuPB5N5wTIyBk/4aw/x/R8SmxQAIM6p4hOxgaYEqGMRpnHcImrDOAMzoXe5VuTKeSPwTmd9FAoKsDOcbGwJsRslfufhCPDSOeWxn4MGty5kg1UIKiP9KtE0xsFPeMLKY0a93YsRVF6su0Tt99uEIYYhogYODAIeFhKqEoyScLyLpjtsnsKTisrwea2HklEPbCjoHgxYi/aPGvA4ZvW8U1dmnMPBgKzwPWT0KUDrRhLPZrT5vB4pMbfon/pNjubIqSAql2YwbQQ66PYVPKvacgMpbKeSS7HSboMBqsLqOFLRlY6bT9QfjaHB7bGfcHQrij1HeGzjphnmbYO359jhvWcLnotM4nsaKU84N3l6nyqRVAQ2K1lrzE659W4Y8ff/hhirkxkgauyvgHNf5Azu8xxk+geLrsjEjx7wK9Z5DodQgqFhp5dO0L4xmvV4M0Y0SFL0OEAVJhhZCKKOnUEM+8TXV/ijaeWGRfwFcNXeQQ4Y7jPytH+ZKzujr6KtApadQaVPlBtAUtg9thT+0kGoo/CvMwOHLTWLuQAvZKzCXc2eFg388gR0yblNUY5JXJ0oFq8N6Et7LKFG367qbWxTUnt3vgemDfAeCT3iMX9+ixihTYoJQGQduFd2K61cIwIDy42PwyyfBAlB69X7pGJWNsTubeIzIBLt1b4a6OQB8ptWFIGIquvVlHu0wqhWx6QJPCQW+8z2h0mDaBT+D9Wddq+oAV60yhIgprTSh7klj8n15U6kkIEZluuJjvLpLZU1QoduLnoIodg37XTJlN/Y0gfKIMzYFZ03d5Wt7iluXVifzY6pDCEoLJ9wOz5Hy6CR/+zuPZFZd4t60NpSxXp6rd3nWq2NfD+YRwSdCNRPK6Lu8LkjZpvlgn+wl0xjLLDD1ixtN0kEMsMAhr8NFsCh6wXAOvrUOc0oEDDrlq9fZH0o8qXnYcv+cXGJweDpW6T2+Lt5q9nFKfv5/JnuxsfcdFm4RMa+wwv/5WLaaPCuv93AxVUQE4R4hKhMQ0H+TkXrcoWciBXUUSWJatVI4SzzvRkzb5PRI+wBz2lOju72rUh1j7mdyWptDkPB/q48dgfBzSCRDyLK/iwy+4+Ndx/I5XmXXV5dlkcnObFaHFJvI5aKgJzGYQ6qpcZ4zooB37BkE9QnAQ5rfxPDVE0hJ2oN6rBryoUXU3OiuuHV/IygkyxwkqeK+YUcsBo5CdWKXw1IC1oZd3U4uKEx93sE1J80d0cKwYmHeqt4jBHVC3p84ObsRrrlbAlJtJcKYXRdj/HwATFUYLcKM1oAAAAABJRU5ErkJggg\x3d\x3d").then(function(b){a._noiseTexture=
new k(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:D,height:D},b);a._requestRender()})}else u.warn("SSAO is not supported for this browser or hardware")};a.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this._quadVAO&&this._quadVAO.dispose(!0),this._noiseTexture&&this._noiseTexture.dispose(),this._blur1FBO.dispose(),this._blur0FBO.dispose(),this._ssaoFBO.dispose(),this._ssaoFBO=this._blur0FBO=this._blur1FBO=this._noiseTexture=this._quadVAO=null)};a.prototype.setAttenuation=
function(a){this._attenuation=a};a.prototype.getAttenuation=function(){return this._attenuation};a.prototype.setRadius=function(a){this._radius=a};a.prototype.getRadius=function(){return this._radius};a.prototype.getFilterRadius=function(){return 4};a.prototype.setSamples=function(a){this._samples=a};a.prototype.getSamples=function(){return this._samples};a.prototype.computeSSAO=function(a,b,c,f){if(this._noiseTexture){h.assert(this.getEnableState());var k=this._rctx,l=c.width,n=c.height,m=l/this._BLUR_F,
g=n/this._BLUR_F;this._ssaoFBO.resize(l,n);this._blur0FBO.resize(m,g);this._blur1FBO.resize(m,g);m=1*l;g=1*n;k.bindFramebuffer(this._ssaoFBO);e.vec4d.set(a.fullViewport,this._viewportToRestore);k.setViewport(0,0,l,n);var p=this._programRep.get(8>=this._samples?"ssao8":16>=this._samples?"ssao16":32>=this._samples?"ssao32":"ssao64"),u=this._programRep.get("blur");p.setUniform2f("rnmScale",l/D,n/D);p.setUniform3fv("pSphere",8>=this._samples?y:16>=this._samples?A:32>=this._samples?C:B);k.bindProgram(p);
p.setUniform1f("numSpiralTurns",this._samples<E.length?E[this._samples]:5779);l=v;n=x;h.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,l,n);p.setUniform4fv("projInfo",l);p.setUniform2fv("zScale",n);p.setUniform2f("nearFar",a.near,a.far);l=1/a.computePixelSizeAtDist(1);p.setUniform1f("projScale",1*l);p.setUniform2f("screenDimensions",m,g);var t=2*this._radius,n=e.vec3d.dist(a.eye,a.center),t=20*a.computePixelSizeAtDist(n),t=Math.max(.1,t);p.setUniform1f("radius",t);p.setUniform1f("intensity",
4*this._attenuation/Math.pow(t,6));p.setUniform1i("rnm",0);p.setUniform1i("normalMap",1);p.setUniform1i("depthMap",2);k.bindTexture(this._noiseTexture,0);k.bindTexture(f.colorTexture,1);k.bindTexture(c.colorTexture,2);c=d.createQuadVAO(this._rctx);k.bindVAO(c);k.drawArrays(5,0,q.vertexCount(c,"geometry"));k.bindTexture(this._ssaoFBO.colorTexture,0);k.setViewport(0,0,m/this._BLUR_F,g/this._BLUR_F);k.bindFramebuffer(this._blur0FBO);u.setUniform2f("screenDimensions",m,g);u.setUniform1i("tex",0);u.setUniform1i("normalMap",
1);u.setUniform1i("depthMap",2);u.setUniform2f("blurSize",0,1*this._BLUR_F/g);u.setUniform1i("radius",4);u.setUniform1f("g_BlurFalloff",.08);u.setUniform2f("nearFar",a.near,a.far);5E4<n&&(l=Math.max(0,l-(n-5E4)));u.setUniform1f("projScale",l);u.setUniform2f("zScale",1,0);k.drawArrays(5,0,q.vertexCount(c,"geometry"));u.setUniform2f("blurSize",1*this._BLUR_F/m,0);k.bindFramebuffer(this._blur1FBO);k.bindTexture(this._blur0FBO.colorTexture,0);k.drawArrays(5,0,q.vertexCount(c,"geometry"));k.bindFramebuffer(b);
k.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};a.prototype.setUniforms=function(a){var b=this.getEnableState()&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",
-1,-1,-1,-1)};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};a.prototype.drawQuad=function(a){h.assert(this.getEnableState());var c=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new m(this._rctx,b.Default3D,{geometry:l.Pos2Tex},{geometry:n.createVertex(this._rctx,35044,H)}));var d=this._rctx;d.setDepthTestEnabled(!1);c.setUniformMatrix4fv("proj",new Float32Array(a));c.setUniform1i("depthTex",
0);d.bindTexture(this._ssaoFBO.colorTexture,0);d.bindVAO(this._debugQuadVAO);d.drawArrays(5,0,q.vertexCount(this._debugQuadVAO,"geometry"));d.setDepthTestEnabled(!0)};a.loadShaders=function(a,c,d){h.assert(null==a.samples);a._parse(f);var e=new p(d,a.vertexShaderShowDepth,a.fragmentShaderShowDepth,b.Default3D),k=a.createFsSSAOSrcObscurance,l=new p(d,a.vsUVQuad,k,b.Default3D,{NUM_TAP_SAMPLES:"8"}),n=new p(d,a.vsUVQuad,k,b.Default3D,{NUM_TAP_SAMPLES:"16"}),m=new p(d,a.vsUVQuad,k,b.Default3D,{NUM_TAP_SAMPLES:"32"}),
k=new p(d,a.vsUVQuad,k,b.Default3D,{NUM_TAP_SAMPLES:"64"});a=new p(d,a.vsUVQuad,a.fsBlurEdgeAware,b.Default3D,{RADIUS:(4).toString()});c.add("showDepth",e);c.add("ssao8",l);c.add("ssao16",n);c.add("ssao32",m);c.add("ssao64",k);c.add("blur",a)};return a}();var x=e.vec2d.create(),v=e.vec4d.create(),y=new Float32Array([.186937,0,0,.677503,0,0,-.782832,.128424,.557187,.248064,.460317,-.659755,.062892,.918659,.312829,-.241031,-.814826,.224206,-.642866,.132138,-.45016,.145727,-.590568,-.626141,.005017,
-.002234,.012668]),A=new Float32Array([.186937,0,0,.700542,0,0,-.864858,-.481795,-.111713,-.624773,.102853,-.730153,-.387172,.260319,.007229,-.222367,-.642631,-.707697,-.01336,-.014956,.169662,.122575,.1544,-.456944,-.177141,.85997,-.42346,-.131631,.814545,.524355,-.779469,.007991,.624833,.308092,.209288,.35969,.359331,-.184533,-.377458,.192633,-.482999,-.065284,.233538,.293706,-.055139,.417709,-.386701,.442449,-.301656,-.836426,.408344]),C=new Float32Array([.837372,0,0,.723531,-.467287,.034157,.169582,
-.31169,-.881801,.696236,.455215,-.204568,-.304514,.528086,.626381,-.053116,.222507,.037523,.199755,.311291,.916799,-.681552,-.516264,.501792,-.37127,.021088,.737477,-.029503,.209188,-.95298,-.573731,.009962,-.154202,-.257345,-.905958,.282747,.370779,.527867,-.669424,-.601758,-.191278,-.708243,.271796,.782684,.535565,-.006867,-.015312,-.017276,.419958,.265628,.233036,-.543898,.554747,-.174055,-.079242,.053475,-.099539,.372042,-.339267,-.357362,.015781,-.011352,.042707,-.340564,-.272507,-.067725,.799249,
-.127948,.586808,.450015,.01965,-.416454,-.506524,.323229,.206546,-.087316,-.311097,.466049,.146374,-.34528,-.045904,-.152614,-.926686,-.287529,-.665726,-.032904,.246643,.248703,.637193,-.062541,-.073706,.495925,-.315143,.05946,-.116042,.075586]),B=new Float32Array([.186937,0,0,.605726,-.313457,-.097616,.003541,.781245,.283011,-.225029,-.373279,.274442,-.047511,.04992,-.226365,.627629,-.623617,-.463628,.133094,-.318299,.528128,.262035,.100234,-.09012,.178335,-.426972,-.666048,-.27306,-.207352,.05514,
-.613649,-.063395,.060608,-.283391,-.41382,-.087565,.136768,.506126,.484137,-.593808,-.344603,.453164,.675326,.124799,-.697865,-.33502,.411337,-.09337,-.15271,.002908,-.063582,.366733,-.699739,.401148,-.519536,-.585625,-.508413,.106482,-.428709,-.260221,.012847,-.118806,.016962,-.188182,.49945,.452364,.586617,.722539,-.23302,.111295,.202827,.066695,-.036503,.315842,.896467,-.039109,-.270116,-.080062,.613435,.508787,.538656,-.352275,.566869,-.666275,.887876,-.138341,-.434135,-.444711,.269156,.119506,
-.029457,-.077316,.754474,.274125,-.13876,-.37082,-.73268,.332723,.568545,-.203992,.878922,-.430778,.541154,-.546752,.11786,-3.93E-4,-.083318,.059333,-.341406,-.117017,-.318568,-.262425,-.457913,.848753,.89229,-.30157,.322416,.742328,.032262,.643827,.048091,-.078044,-.49908,.064858,.549944,-.796252,-.230688,.88978,-.010153,.397241,-.27645,.405666,-.46593,.131187,-.600166,.333834,-.078219,.73837,-.870169,-.411658,-.222175,-.492421,.741454,.293757,-.591244,.389112,-.388324,.792346,.578552,.088459,-.121858,
-.437241,-.472535,-.374835,.302427,.721264,.057485,.204085,-.126575,.510325,.481492,-.579888,-.29411,-.82136,.156404,-.819717,-.042466,.456573,.079884,.07019,.179002,.220279,.970222,-.088025,-.299911,-.234627,-.820794,.912112,.243306,.317869,.241336,.161841,-.721568,.301135,-.635993,-.0939,-.514731,-.089673,.850964,-.905087,.314604,-.098397]),D=64,E=[1,1,1,2,3,2,5,2,3,2,3,3,5,5,3,4,7,5,5,7,9,8,5,5,7,7,7,8,5,8,11,12,7,10,13,8,11,8,7,14,11,11,13,12,13,19,17,13,11,18,19,11,11,14,17,21,15,16,17,18,13,
17,11,17,19,18,25,18,19,19,29,21,19,27,31,29,21,18,17,29,31,31,23,18,25,26,25,23,19,34,19,27,21,25,39,29,17,21,27,29],H=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return r})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});var c=null,b=[];g.enabled=!1;g.begin=function(){g.enabled&&(c=[])};g.trace=function(a){g.enabled&&null!=
c&&c.push(a)};g.end=function(){if(g.enabled){var a=c;c=null;a&&(b.forEach(function(b){return b(a)}),b.length=0);return a}};g.instrumentContext=function(b){return g.enabled?a.default(b)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),b):f.makeDebugContext(b,void 0,function(a,b){g.enabled&&c&&c.push("gl."+a+"("+f.glFunctionArgsToString(a,b)+")")}):b};g.request=function(a){b.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function r(a){if(null==
d){d={};h={};for(var b in a)"number"==typeof a[b]&&(d[a[b]]=b,h[b]=a[b])}}function g(){if(null==d)throw"WebGLDebugUtils.init(ctx) not called";}function f(a){g();var b=d[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,b,c,d){a=e[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[c])){if("object"===typeof a[c]&&void 0!==a[c].enumBitwiseOr){b=a[c].enumBitwiseOr;c=0;a=[];for(var k=0;k<b.length;++k){var l=h[b[k]];0!==(d&l)&&(c|=l,a.push(f(l)))}return c===d?a.join(" | "):f(d)}return f(d)}return null===
d?"null":void 0===d?"undefined":d.toString()}function c(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function b(d,e,h,k){function l(a,b){return function(){h&&h(b,arguments);var c=a[b].apply(a,arguments),d=k.getError();0!=d&&(m[d]=!0,e(d,b,arguments));return c}}k=k||d;r(d);e=e||function(b,c,d){for(var e="",k=d.length,h=0;h<k;++h)e+=(0==h?"":", ")+a(c,k,h,d[h]);b="WebGL error "+f(b)+" in "+c+"("+e+")";window.console&&window.console.error?window.console.error(b):
window.console&&window.console.log&&window.console.log(b)};var m={},n={},g;for(g in d)if("function"==typeof d[g])if("getExtension"!=g)n[g]=l(d,g);else{var p=l(d,g);n[g]=function(){var a=p.apply(d,arguments);return b(a,e,h,k)}}else c(n,d,g);n.getError=function(){for(var a in m)if(m.hasOwnProperty(a)&&m[a])return m[a]=!1,a;return d.NO_ERROR};return n}function l(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),
a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);
a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},
drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,
2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,
1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},
frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},d=null,h=null;return{init:r,mightBeEnum:function(a){g();return void 0!==d[a]},glEnumToString:f,glFunctionArgToString:a,glFunctionArgsToString:function(b,c){for(var d="",e=c.length,f=0;f<e;++f)d+=(0==f?"":", ")+a(b,e,f,c[f]);return d},makeDebugContext:b,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function d(){for(var a=
Object.keys(G),b=0;b<a.length;++b)delete G[a]}function e(){++H;B||r==H&&a.loseContext()}function f(a,b){var c=a[b];return function(){e();if(!B)return c.apply(a,arguments)}}function h(a){return{statusMessage:a,preventDefault:function(){F=!0}}}function g(a){for(var b in a)"function"==typeof a[b]?v[b]=f(a,b):c(v,a,b);v.getError=function(){e();if(!B)for(var a;a=n.getError();)G[a]=!0;for(a in G)if(G[a])return delete G[a],a;return v.NO_ERROR};var d="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");
for(b=0;b<d.length;++b){var h=d[b];v[h]=function(b){return function(){e();if(B)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=C;D.push(c);return c}}(a[h])}d="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<d.length;++b)h=d[b],v[h]=function(b){return function(){e();return B?null:b.apply(a,arguments)}}(v[h]);d="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<d.length;++b)h=d[b],v[h]=function(b){return function(){e();return B?!1:b.apply(a,arguments)}}(v[h]);v.checkFramebufferStatus=function(b){return function(){e();return B?v.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(v.checkFramebufferStatus);v.getAttribLocation=function(b){return function(){e();
return B?-1:b.apply(a,arguments)}}(v.getAttribLocation);v.getVertexAttribOffset=function(b){return function(){e();return B?0:b.apply(a,arguments)}}(v.getVertexAttribOffset);v.isContextLost=function(){return B};return v}var n,v,y=[],A=[];v={};var C=1,B=!1,D=[],r=0,H=0,F=!1,L=0,G={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=n){if(n)throw"got different context";n=c;v=g(n)}return v}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":y.push(b(e));break;case "webglcontextrestored":A.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!B){B=!0;r=0;for(++C;n.getError(););d();G[n.CONTEXT_LOST_WEBGL]=!0;var b=h("context lost"),c=y.slice();setTimeout(function(){for(var d=0;d<c.length;++d)c[d](b);0<=L&&setTimeout(function(){a.restoreContext()},L)},0)}};a.restoreContext=function(){B&&A.length&&setTimeout(function(){if(!F)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<D.length;++a){var b=D[a];b instanceof WebGLBuffer?n.deleteBuffer(b):b instanceof WebGLFramebuffer?n.deleteFramebuffer(b):b instanceof WebGLProgram?n.deleteProgram(b):b instanceof WebGLRenderbuffer?n.deleteRenderbuffer(b):b instanceof WebGLShader?n.deleteShader(b):b instanceof WebGLTexture&&n.deleteTexture(b)}l(n);B=!1;H=0;F=!1;for(var a=A.slice(),b=h("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(B)throw"You can not ask a lost contet to be lost";
r=H+a};a.getNumCalls=function(){return H};a.setRestoreTimeout=function(a){L=a};return a},resetToInitialState:l}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.default=function(f){return window.WebGL2RenderingContext&&f instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/materials/repository":function(){define("require exports dojo/text!./internal/hud.xml dojo/text!./internal/util.xml ../lib/edgeRendering/EdgeView ./CheckerBoardMaterial ./ColorMaterial ./DefaultMaterial ./HUDMaterial ./LineCalloutMaterial ./MeasurementArrowMaterial ./RibbonLineMaterial ./internal/BlendLayers ./internal/SimpleGLMaterial ./internal/TexOnlyGLMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){Object.defineProperty(g,"__esModule",{value:!0});g.initializeShaders=function(m,g,x){m._parse(a);m._parse(f);k.loadShaders(m,g,x);q.loadShaders(m,g,x);e.loadShaders(m,g,x);d.loadShaders(m,g,x);h.loadShaders(m,g,x);t.loadShaders(m,g,x);p.loadShaders(m,g,x);l.loadShaders(m,g,x);n.loadShaders(m,g,x);c.EdgeView.loadShaders(m,g,x);b.loadShaders(m,g,x)}})},"esri/views/3d/webgl-engine/materials/CheckerBoardMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./CheckerBoardMaterial.xml ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ./internal/MaterialUtil".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){var t=[{name:d.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:20,normalized:!1},{name:d.VertexAttrConstants.UV0,count:2,type:5126,offset:12,stride:20,normalized:!1}],p={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,polygonOffset:!1};r=function(b){function c(a,c){c=b.call(this,c)||this;c.canBeMerged=!1;c.params=h.copyParameters(a,p);return c}f(c,b);c.prototype.dispose=function(){};c.prototype.getParameterValues=function(){var a=
this.params;return{size:a.size,color1:a.color1,color2:a.color2,transparent:a.transparent,polygonOffset:a.polygonOffset}};c.prototype.setParameterValues=function(a){h.updateParameters(this.params,a)&&this.notifyDirty("matChanged")};c.prototype.getParams=function(){return this.params};c.prototype.getOutputAmount=function(a){return 5*a};c.prototype.getInstanceBufferLayout=function(){};c.prototype.getVertexBufferLayout=function(){return t};c.prototype.fillInterleaved=function(a,b,c,d,e,f){n.fillInterleaved(a,
b,c,d,t,e,f)};c.prototype.intersect=function(a,b,c,d,e,f,h,k){return n.intersectTriangleGeometry(a,b,c,d,e,f,h)};c.prototype.getGLMaterials=function(){return{color:k,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};c.loadShaders=function(b,c,d){b._parse(a);b=new e("checker-board",["vsCheckerBoard","fsCheckerBoard"],null,c,b,d);c.addShaderVariations("checker-board-material-shader-variations",b)};return c}(b);var k=function(a){function b(b,
c,d){d=a.call(this,b,c)||this;d.programRep=c;d.params=h.copyParameters(b.getParams());d.selectProgram();return d}f(b,a);b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("checker-board-material-shader-variations",[])};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===(this.params.transparent?l.TRANSPARENT_MATERIAL:l.OPAQUE_MATERIAL)};b.prototype.getProgram=
function(){return this.program};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};b.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!1);a.setFaceCullingEnabled(!1);this.params.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-25));a.bindProgram(b);b.setUniform2fv("size",
this.params.size);b.setUniform4fv("color1",this.params.color1);b.setUniform4fv("color2",this.params.color2)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();h.bindView(a,b.view,c)};b.prototype.bindInstance=function(a,b){this.getProgram().setUniformMatrix4fv("model",b.transformation)};b.prototype.release=function(a){a.setDepthWriteEnabled(!0);this.params.transparent&&a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};return b}(c);return r})},
"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./ColorMaterial.xml ../lib/DefaultVertexBufferLayouts ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),function(r,g,f,a,c,b,l,e,d,h,n,t){var p=c.Pos3Col,k=t.getStride(p)/4,q={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1};r=function(b){function c(a,
c){c=b.call(this,c)||this;c.supportsEdges=!0;c.params=n.copyParameters(a,q);return c}f(c,b);c.prototype.getParams=function(){return this.params};c.prototype.getParameterValues=function(){return n.copyParameters(this.params)};c.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};c.prototype.getColor=function(){return this.params.color};c.prototype.setTransparent=function(a){this.params.transparent=a;this.notifyDirty("matChanged")};c.prototype.getTransparent=function(){return this.params.transparent};
c.prototype.getOutputAmount=function(a){return a*k*1};c.prototype.getVertexBufferLayout=function(){return p};c.prototype.getInstanceBufferLayout=function(){};c.prototype.fillInterleaved=function(a,b,c,d,e,f,h){n.fillInterleaved(a,b,c,d,p,e,f,h)};c.prototype.intersect=function(a,b,c,d,e,f,h,k){n.intersectTriangleGeometry(a,b,c,d,e,f,h)};c.prototype.getGLMaterials=function(){return{color:m,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:u}};c.prototype.getAllTextureIds=function(){return[]};
c.loadShaders=function(b,c,e){b._parse(a);b=new d("colorMaterial",["vertexShaderColorMaterial","fragmentShaderColorMaterial"],null,c,b,e);b.addDefine("Color","VERTEXCOLORS");c.addShaderVariations("colorMaterial",b)};return c}(l);var m=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}f(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",
[this.params.vertexColors])};b.prototype.beginSlot=function(a){return a===(1>this.params.color[3]?e.TRANSPARENT_MATERIAL:e.OPAQUE_MATERIAL)};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);a.setFaceCullingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));c.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,
a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setPolygonOffsetFillEnabled(!1);b.transparent&&a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){n.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b),u=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();
return b}f(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])};b.prototype.beginSlot=function(a){return a===e.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);a.setFaceCullingEnabled(!1);
c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};b.prototype.release=function(a){a.setPolygonOffsetFillEnabled(!1)};b.prototype.bindView=function(a,b){n.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b);return r})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./DefaultMaterial.xml ../../layers/graphics/graphicUtils ../../support/buffer/glUtil ../../support/buffer/InterleavedLayout ../lib/DefaultVertexAttributeLocations ../lib/gl-matrix ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Program ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){function x(a,b){var c=a.gl;(b.cullFace?"none"===b.cullFace:b.transparent)?a.setFaceCullingEnabled(!1):(a.setFaceCullingEnabled(!0),"front"===b.cullFace&&a.setCullFace(c.FRONT))}function v(a,b){var c=a.gl;(b.cullFace?"none"===b.cullFace:b.transparent)?a.setFaceCullingEnabled(!0):(a.setFaceCullingEnabled(!1),"front"===b.cullFace&&a.setCullFace(c.BACK))}function y(a,b){return a?t.TRANSPARENT_MATERIAL:b?t.STENCIL_MATERIAL:t.OPAQUE_MATERIAL}function A(a,b){var d=
b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):d&&a.setUniform3fv("vvSizeValue",b.vvSizeValue);d&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),c.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],H.identity(I)),a.setUniformMatrix3fv("vvSymbolRotation",H.toMat3(I,Q)));b.vvColorEnabled&&
(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}function C(a,b){a.vvSizeEnabled=b.vvSizeEnabled;a.vvSizeMinSize=b.vvSizeMinSize;a.vvSizeMaxSize=b.vvSizeMaxSize;a.vvSizeOffset=b.vvSizeOffset;a.vvSizeFactor=b.vvSizeFactor;a.vvSizeValue=b.vvSizeValue;a.vvSymbolAnchor=b.vvSymbolAnchor;a.vvSymbolRotation=b.vvSymbolRotation}var B=d.vec3d,D=d.vec4d,E=d.mat3d,H=d.mat4d,F=k.assert;r=function(c){function d(a,b){b=c.call(this,b)||this;b.supportsEdges=!0;b.params=
q.copyParameters(a,O);b.instanced=!!a.instanced;b.vertexBufferLayout=d.getVertexBufferLayout(b.params);b.instanceBufferLayout=b.instanced?d.getInstanceBufferLayout(b.params):null;return b}f(d,c);d.prototype.isVisible=function(){var a=this.params;if(!c.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var b=aa&&a.instanced,d=a.vertexColors,e=a.symbolColors,b=!!b&&-1<b.indexOf("color"),f=a.vvColorEnabled,h="replace"===a.colorMixMode,k=0<a.opacity,a=a.externalColor&&0<a.externalColor[3];return d&&
(b||f||e)?h?!0:k:d?h?a:k:b||f||e?h?!0:k:h?a:k};d.prototype.getParams=function(){return this.params};d.prototype.getParameterValues=function(){var a=this.params;return{textureId:a.textureId,ambient:a.ambient,diffuse:a.diffuse,specular:a.specular,externalColor:a.externalColor,colorMixMode:a.colorMixMode,opacity:a.opacity,layerOpacity:a.layerOpacity,transparent:a.transparent,polygonOffset:a.polygonOffset,atlasRegions:a.atlasRegions,flipV:a.flipV,doubleSided:a.doubleSided,doubleSidedType:a.doubleSidedType,
cullFace:a.cullFace,writeStencil:a.writeStencil,receiveSSAO:a.receiveSSAO,castShadows:a.castShadows,verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvSizeValue:a.vvSizeValue,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,vvColorColors:a.vvColorColors,compressedNormals:a.compressedNormals,groundNormalShading:a.groundNormalShading,
vvSymbolAnchor:a.vvSymbolAnchor,vvSymbolRotation:a.vvSymbolRotation}};d.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&F(b.textureId,"Can only change texture of material that already has a texture"),"castShadows"===c&&F(a.castShadows===b.castShadows,"Can not change shadow casting behavior."),b[c]=a[c];this.notifyDirty("matChanged")};d.prototype.getOutputAmount=function(a){var b=u.getStride(this.vertexBufferLayout)/4;return a*b};d.prototype.getVertexBufferLayout=
function(){return this.vertexBufferLayout};d.prototype.getInstanceBufferLayout=function(){return this.instanceBufferLayout};d.prototype.fillInterleaved=function(a,b,c,d,e,f,h){q.fillInterleaved(a,b,c,d,this.vertexBufferLayout,e,f,h)};d.prototype.intersect=function(a,b,c,d,e,f,h,k){if(null!==this.params.verticalOffset){k=d.camera;B.set3(c[12],c[13],c[14],ha);var l=B.subtract(ha,k.eye,ea),m=B.length(l),g=B.scale(l,1/m),n=null,l=null;switch(d.viewingMode){case "global":l=B.normalize(ha,ba);break;case "local":l=
B.set(Y,ba)}this.params.screenSizePerspective&&(n=B.dot(l,g));k=q.verticalOffsetAtDistance(k,m,this.params.verticalOffset,n,this.params.screenSizePerspective);B.scale(l,k);E.multiplyVec3(d.transformInverseRotation,l,R);e=B.subtract(e,R,K);f=B.subtract(f,R,T)}q.intersectTriangleGeometry(a,b,c,d,e,f,h)};d.prototype.getGLMaterials=function(){return{color:L,depthShadowMap:this.params.castShadows?P:null,normal:J,depth:G,highlight:M}};d.prototype.getAllTextureIds=function(){var a=this.params,b=[];a.textureId&&
b.push(a.textureId);return b};d.loadShaders=function(b,c,d){b._parse(a);aa=null!==d.capabilities.instancing;var f=new p("phong",["vsPhong","fsPhong"],null,c,b,d);f.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);f.addDefine("Color","VERTEXCOLORS");f.addDefine("symbolColor","SYMBOLVERTEXCOLORS");f.addDefine("FlipV","FLIPV");f.addDefine("DoubleSided","DOUBLESIDED");f.addDefine("WindingOrderDoubleSided","WINDINGORDERDOUBLESIDED");
f.addDefine("Instanced","INSTANCED");f.addDefine("InstColor","INSTANCEDCOLOR");f.addDefine("ReceiveShadows","RECEIVE_SHADOWS");f.addDefine("ReceiveSSAO","RECEIVE_SSAO");f.addDefine("vvSize","VV_SIZE");f.addDefine("vvColor","VV_COLOR");f.addDefine("VerticalOffset","VERTICAL_OFFSET");f.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");f.addDefine("groundNormalShading","GROUND_NORMAL_SHADING");f.addDefine("compressedNormals","COMPRESSED_NORMALS");f.addDefine("componentColor","COMPONENTCOLORS");
c.addShaderVariations(V,f);f=new p("depth",["vsDepth","fsDepth"],null,c,b,d);f.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);f.addDefine("FlipV","FLIPV");f.addDefine("Instanced","INSTANCED");f.addDefine("ShadowMap","BIAS_SHADOWMAP");f.addDefine("vvSize","VV_SIZE");f.addDefine("VerticalOffset","VERTICAL_OFFSET");f.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");c.addShaderVariations(N,f);f=new p("normal",
["vsNormal","fsNormal"],null,c,b,d);f.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);f.addDefine("FlipV","FLIPV");f.addDefine("Instanced","INSTANCED");f.addDefine("vvSize","VV_SIZE");f.addDefine("VerticalOffset","VERTICAL_OFFSET");f.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");f.addDefine("compressedNormals","COMPRESSED_NORMALS");c.addShaderVariations(S,f);f=new p("highlight",["vsHighlight","fsHighlight"],
null,c,b,d);f.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);f.addDefine("FlipV","FLIPV");f.addDefine("Instanced","INSTANCED");f.addDefine("vvSize","VV_SIZE");f.addDefine("VerticalOffset","VERTICAL_OFFSET");f.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");c.addShaderVariations(W,f);var f=new m(d,b.vsDepth,b.fsDepth,e.Default3D,["BIAS_SHADOWMAP 1"]),h=new m(d,b.vsDepthTextured,b.fsDepthTextured,e.Default3D,
["BIAS_SHADOWMAP 1"]),k=new m(d,b.vsDepth,b.fsDepth,e.Default3D),l=new m(d,b.vsDepthTextured,b.fsDepthTextured,e.Default3D),q=new m(d,b.vsNormal,b.fsNormal,e.Default3D),n=new m(d,b.vsNormalTextured,b.fsNormalTextured,e.Default3D),g=new m(d,b.vsHighlight,b.fsHighlight,e.Default3D);b=new m(d,b.vsHighlightTextured,b.fsHighlightTextured,e.Default3D);c.add("depthShadowMap",f);c.add("depthTexturedShadowMap",h);c.add("depth",k);c.add("depthTextured",l);c.add("normal",q);c.add("normalTextured",n);c.add("highlight",
g);c.add("highlightTextured",b)};d.getVertexBufferLayout=function(a){var c=l.newLayout().vec3f("position");a.groundNormalShading||(c=a.compressedNormals?c.vec2i16("normalCompressed",{glNormalized:!0}):c.vec3f("normal"));a.textureId&&(c=c.vec2f("uv0"),a.atlasRegions&&(c=c.vec4u16("region")));a.vertexColors&&(c=c.vec4u8("color"));a.symbolColors&&(c=c.vec4u8("symbolColor"));a.componentIndices&&(c=c.u16("componentIndex").u16("_padding",{glPadding:!0}));return b.glLayout(c)};d.getInstanceBufferLayout=
function(a){var c=l.newLayout().mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(c=c.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(c=c.vec4f("instanceFeatureAttribute"));return b.glLayout(c,{divisor:1})};return d}(n);var L=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.programs=[[null,null],[null,null]];c.params=q.copyParameters(b.getParams());c.slot=y(c.params.transparent,c.params.writeStencil);
b=c.params;c.texturing=b.textureId?b.atlasRegions?"AtlasTextured":"Textured":"none";d=aa&&b.instanced;c.instanced=!!d;c.instancedColor=!!d&&-1<d.indexOf("color");c.pseudoInstancedColor=!aa&&b.instanced&&-1<b.instanced.indexOf("color");c._loadPrograms();return c}f(b,a);b.prototype._loadPrograms=function(){this.programs[0][0]=this._loadProgram(!1,!1);this.programs[1][0]=this._loadProgram(!0,!1);this.params.receiveSSAO?(this.programs[0][1]=this._loadProgram(!1,!0),this.programs[1][1]=this._loadProgram(!0,
!0),this.allPrograms=this.programs[0].concat(this.programs[1])):(this.programs[0][1]=this.programs[0][0],this.programs[1][1]=this.programs[1][0],this.allPrograms=[this.programs[0][0],this.programs[1][0]])};b.prototype._loadProgram=function(a,b){var c=this.params;return this.programRep.getShaderVariationsProgram(V,[this.texturing,c.vertexColors,c.symbolColors,c.flipV,c.doubleSided&&"normal"===c.doubleSidedType,c.doubleSided&&"winding-order"===c.doubleSidedType,!!this.instanced,this.instancedColor,
a,b,c.vvSizeEnabled,c.vvColorEnabled,null!==c.verticalOffset,null!==c.screenSizePerspective,c.groundNormalShading,c.compressedNormals,null!=c.componentColorBuffer])};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.programs[0][0]};b.prototype.getPrograms=function(){return this.allPrograms};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.ambient=a.ambient;b.diffuse=a.diffuse;b.specular=a.specular;
b.externalColor=a.externalColor;b.colorMixMode=a.colorMixMode;b.opacity=a.opacity;b.layerOpacity=a.layerOpacity;b.polygonOffset=a.polygonOffset;b.flipV=a.flipV;b.doubleSided=a.doubleSided;b.doubleSidedType=a.doubleSidedType;b.cullFace=a.cullFace;b.receiveSSAO=a.receiveSSAO;b.castShadows=a.castShadows;b.verticalOffset=a.verticalOffset;b.screenSizePerspective=a.screenSizePerspective;C(b,a);b.vvColorEnabled=a.vvColorEnabled;b.vvColorValues=a.vvColorValues;b.vvColorColors=a.vvColorColors;b.transparent!==
a.transparent&&(this.slot=y(a.transparent,a.writeStencil),b.transparent=a.transparent);b.compressedNormals=a.compressedNormals;b.groundNormalShading=a.groundNormalShading;this.updateTexture(a.textureId);a.atlasRegions&&(b.atlasRegions=a.atlasRegions);b.blendModeOneOne=a.blendModeOneOne;b.inverseWindingOrder=a.inverseWindingOrder;this._loadPrograms()};b.prototype.bind=function(a,b){var c=a.gl,d=this.params,e=this.program=this.programs[b.shadowMappingEnabled?1:0][b.ssaoEnabled?1:0];a.bindProgram(e);
e.setUniform3fv("ambient",d.ambient);e.setUniform3fv("diffuse",d.diffuse);e.setUniform3fv("specular",d.specular);e.setUniform4fv("externalColor",d.externalColor);e.setUniform1i("colorMixMode",q.colorMixModes[d.colorMixMode]);e.setUniform1f("opacity",d.opacity);e.setUniform1f("layerOpacity",d.layerOpacity);q.bindVerticalOffset(d.verticalOffset,b,e);q.bindScreenSizePerspective(d.screenSizePerspective,e);A(e,d);this.bindTexture(a,e);"AtlasTextured"===this.texturing&&this.bindTextureSize(a,e);a.setBlendFunctionSeparate(c.SRC_ALPHA,
c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);d.inverseWindingOrder&&a.setFrontFace(c.CW);d.transparent?(a.setBlendingEnabled(!0),d.blendModeOneOne?(a.setBlendFunction(c.ONE,c.ONE),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):a.setBlendingEnabled(!1);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));x(a,d);a.setDepthTestEnabled(!0);d.componentIndices&&d.componentColorBuffer&&(d.componentColorBuffer.updateTexture(),
d.componentColorBuffer.bind(e,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}))};b.prototype.release=function(a,b){b=a.gl;a.setPolygonOffsetFillEnabled(!1);v(a,this.params);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);a.setDepthWriteEnabled(!0);a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,b){a=this.program=this.programs[b.shadowMappingEnabled?1:0][b.ssaoEnabled?1:0];var c=b.origin;q.bindView(c,
b.view,a);q.bindCamPos(c,b.viewInvTransp,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,c)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal);b.instanceParameters&&this.pseudoInstancedColor&&(b=b.instanceParameters.color)&&(D.multiply(b,this.params.externalColor,X),a.setUniform4fv("externalColor",X))};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(h),G=function(a){function b(b,
c,d,e){void 0===e&&(e=!1);d=a.call(this,b,c,d,b.getParams().textureId)||this;d.params=q.copyParameters(b.getParams());d.instanced=aa&&!!d.params.instanced;d.texturing=u.hasAttribute(b.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=c.getShaderVariationsProgram(N,[d.texturing,d.params.flipV,d.instanced,e,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective]);d.slot=y(d.params.transparent,d.params.writeStencil);return d}f(b,a);b.prototype.beginSlot=
function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.cullFace=a.cullFace;b.inverseWindingOrder=a.inverseWindingOrder;b.flipV=a.flipV;C(b,a);this.updateTexture(a.textureId)};b.prototype.bind=function(a,b){var c=a.gl,d=this.program,e=this.params;a.bindProgram(d);d.setUniform2fv("nearFar",b.nearFar);e.inverseWindingOrder&&a.setFrontFace(c.CW);q.bindVerticalOffset(e.verticalOffset,
b,d);q.bindScreenSizePerspective(e.screenSizePerspective,d);A(d,e);this.bindTexture(a,d);x(a,e);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,c=this.params;v(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,b.view,a);c.screenSizePerspective&&q.bindCamPos(b.origin,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=
function(a){return a.gl.TRIANGLES};return b}(h),P=function(a){function b(b,c,d){return a.call(this,b,c,d,!0)||this}f(b,a);return b}(G),J=function(a){function b(b,c,d,e){void 0===e&&(e=!1);d=a.call(this,b,c,d,b.getParams().textureId)||this;d.params=q.copyParameters(b.getParams());d.instanced=aa&&!!d.params.instanced;d.texturing=u.hasAttribute(b.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=c.getShaderVariationsProgram(S,[d.texturing,d.params.flipV,d.instanced,d.params.vvSizeEnabled,null!==
d.params.verticalOffset,null!==d.params.screenSizePerspective,d.params.compressedNormals]);d.slot=y(d.params.transparent,d.params.writeStencil);return d}f(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.cullFace=a.cullFace;b.inverseWindingOrder=a.inverseWindingOrder;b.flipV=a.flipV;C(b,a);this.updateTexture(a.textureId)};b.prototype.bind=function(a,
b){var c=a.gl,d=this.program,e=this.params;a.bindProgram(d);this.bindTexture(a,d);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);q.bindVerticalOffset(e.verticalOffset,b,d);q.bindScreenSizePerspective(e.screenSizePerspective,d);A(d,e);x(a,e);e.inverseWindingOrder&&a.setFrontFace(c.CW);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,c=this.params;v(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,
b.view,a);c.screenSizePerspective&&q.bindCamPos(b.origin,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(h),M=function(a){function b(b,c,d,e){void 0===e&&(e=!1);d=a.call(this,b,c,d,b.getParams().textureId)||this;d.params=q.copyParameters(b.getParams());d.instanced=aa&&!!d.params.instanced;d.texturing=
u.hasAttribute(b.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=c.getShaderVariationsProgram(W,[d.texturing,d.params.flipV,d.instanced,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective]);d.slot=y(d.params.transparent,d.params.writeStencil);return d}f(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;
b.cullFace=a.cullFace;b.inverseWindingOrder=a.inverseWindingOrder;b.flipV=a.flipV;C(b,a);this.updateTexture(a.textureId)};b.prototype.bind=function(a,b){var c=a.gl,d=this.program,e=this.params;a.bindProgram(d);this.bindTexture(a,d);q.bindVerticalOffset(e.verticalOffset,b,d);q.bindScreenSizePerspective(e.screenSizePerspective,d);A(d,e);x(a,e);e.inverseWindingOrder&&a.setFrontFace(c.CW);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,c=this.params;v(a,c);c.inverseWindingOrder&&
a.setFrontFace(b.CW)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,b.view,a);c.screenSizePerspective&&q.bindCamPos(b.origin,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(h),O={textureId:void 0,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,
1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,
1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},aa,V="material",N="material-depth",S="material-normal",W="material-highlight",X=D.create(),Q=E.create(),I=H.create(),K=B.create(),T=B.create(),Y=B.createFrom(0,0,1),ba=B.create(),R=B.create(),ha=B.create(),ea=B.create();return r})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./LineCalloutMaterial.xml ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){function t(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}var p=d.VertexAttrConstants,k=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],q={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,
0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"};r=function(b){function c(a,d){d=b.call(this,d)||this;d.params=h.copyParameters(a,q);d._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(d.params);return d}f(c,b);Object.defineProperty(c.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});c.prototype.dispose=function(){};c.prototype.getGLMaterials=function(){return{color:m,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};c.prototype.fillAttributeData=function(a,b,c,d,e,f){var l=a.indices[b];a=a.vertexAttr[b].data;if(l&&a)for(b=c+n.findAttribute(k,b).offset/4,c=0;c<l.length;c++)for(var m=d*l[c],q=0;6>q;q++)h.fill(a,m,f,b,e,d),b+=12};c.prototype.fillInterleaved=function(a,b,c,d,e,f,h){this.fillAttributeData(a,p.POSITION,f,3,b,e);this.fillAttributeData(a,p.NORMAL,f,3,c,e);this.fillAttributeData(a,p.AUXPOS1,
f,4,null,e);a=f+n.findAttribute(k,p.UV0).offset/4;b=0;for(c=u;b<c.length;b++)d=c[b],e[a+0]=d[0],e[a+1]=d[1],a+=12};c.prototype.getOutputAmount=function(a){return 288*a};c.prototype.getInstanceBufferLayout=function(){};c.prototype.getVertexBufferLayout=function(){return k};c.prototype.intersect=function(a,b,c,d,e,f,h,k){};c.prototype.getParameterValues=function(){var a=this.params;return{verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,screenOffset:a.screenOffset,centerOffsetUnits:a.centerOffsetUnits,
color:[a.color[0],a.color[1],a.color[2],a.color[3]],size:a.size,borderColor:a.borderColor,occlusionTest:a.occlusionTest,shaderPolygonOffset:a.shaderPolygonOffset,depthHUDAlignStart:a.depthHUDAlignStart}};c.prototype.setParameterValues=function(a){h.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};c.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||
"world"})};c.loadShaders=function(b,c,d){b._parse(a);b=new e("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,c,b,d);b.addDefine("occlTest","OCCL_TEST");b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("depthHud","DEPTH_HUD");b.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START");b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");c.addShaderVariations("line-callout-material-shader-variations",
b)};return c}(b);var m=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.isRenderSlot=!0;b.updateParameters();return b}f(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!1,!!a.depthHUDAlignStart,"screen"===
a.centerOffsetUnits]);this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!0,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits])};b.prototype.beginSlot=function(a){switch(a){case l.LINE_CALLOUTS:return this.isRenderSlot=!0;case l.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:
this.depthProgram},enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,d=this.program,e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);d.setUniformMatrix4fv("viewNormal",
b.viewInvTransp);d.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);t(d,"color",e.color);d.setUniform2f("screenOffset",e.screenOffset[0],e.screenOffset[1]);this.bindBorder(a,b);h.bindVerticalOffset(e.verticalOffset,b,d);this.bindSizing(a,b);h.bindScreenSizePerspective(e.screenSizePerspective,d);this.isRenderSlot?this.bindRender(a,b):this.bindHUDDepth(a,b)};b.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};
b.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;h.bindView(b.origin,b.view,a);h.bindCamPos(b.origin,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,
b):this.releaseHUDDepth(a,b)};b.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};b.prototype.releaseHUDDepth=function(a,b){a.setColorMask(!0,!0,!0,!0)};b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size))};b.prototype.bindBorder=function(a,b){a=this.program;b=this.params;null!==b.borderColor?(t(a,"borderColor",
b.borderColor),a.setUniform1f("borderSize",1)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(c),u=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return r})},"esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./MeasurementArrowMaterial.xml ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t){var p=c.vec3d,k=c.mat4d,q=[{name:h.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:36,normalized:!1},{name:h.VertexAttrConstants.NORMAL,count:3,type:5126,offset:12,stride:36,normalized:!1},{name:h.VertexAttrConstants.UV0,count:2,type:5126,offset:24,stride:36,normalized:!1},{name:h.VertexAttrConstants.AUXPOS1,count:1,type:5126,offset:32,stride:36,normalized:!1}],m={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,
1],stripeOddColor:[1,.5,0,1],polygonOffset:!1};r=function(b){function c(a,c){c=b.call(this,c)||this;c.params=n.copyParameters(a,m);return c}f(c,b);c.prototype.dispose=function(){};c.prototype.getParameterValues=function(){var a=this.params;return{width:a.width,outlineSize:a.outlineSize,outlineColor:a.outlineColor,stripeLength:a.stripeLength,stripeEvenColor:a.stripeEvenColor,stripeOddColor:a.stripeOddColor,polygonOffset:a.polygonOffset}};c.prototype.setParameterValues=function(a){n.updateParameters(this.params,
a)&&this.notifyDirty("matChanged")};c.prototype.getParams=function(){return this.params};c.prototype.getOutputAmount=function(a){return 18*(a/2+1)};c.prototype.getInstanceBufferLayout=function(){};c.prototype.getVertexBufferLayout=function(){return q};c.prototype.fillInterleaved=function(a,b,c,d,e,f){d=a.vertexAttr[h.VertexAttrConstants.POSITION].data;var l=a.vertexAttr[h.VertexAttrConstants.NORMAL].data,m=d.length/3;(a=a&&a.indices&&a.indices.position)&&a.length!==2*(m-1)&&console.warn("MeasurementArrowMaterial does not support indices");
a=f+t.findAttribute(q,h.VertexAttrConstants.POSITION).offset/4;var g=f+t.findAttribute(q,h.VertexAttrConstants.NORMAL).offset/4,u=f+t.findAttribute(q,h.VertexAttrConstants.UV0).offset/4;f+=t.findAttribute(q,h.VertexAttrConstants.AUXPOS1).offset/4;for(var B=x,r=v,D=y,E=A,F=C,H=0,I=0;I<m;++I){var K=3*I;p.set3(d[K],d[K+1],d[K+2],B);I<m-1&&(K=3*(I+1),p.set3(d[K],d[K+1],d[K+2],r),p.set3(l[K],l[K+1],l[K+2],F),p.normalize(F),p.subtract(r,B,D),p.normalize(D),p.cross(F,D,E),p.normalize(E));K=p.dist(B,r);b&&
c&&(k.multiplyVec3(b,B),k.multiplyVec3(b,r),k.multiplyVec3(c,E));n.fill(B,0,e,a,void 0,3);a+=9;n.fill(B,0,e,a,void 0,3);a+=9;n.fill(E,0,e,g,void 0,3);g+=9;n.fill(E,0,e,g,void 0,3);g+=9;e[u]=H;e[u+1]=-1;u+=9;e[u]=H;e[u+1]=1;u+=9;I<m-1&&(H+=K)}for(I=0;I<m;++I)e[f]=H,f+=9,e[f]=H,f+=9};c.prototype.intersect=function(a,b,c,d,e,f,h,k){};c.prototype.getGLMaterials=function(){return{color:u,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};
c.loadShaders=function(b,c,e){b._parse(a);b=new d("measurement-arrow",["vsMeasurementArrow","fsMeasurementArrow"],null,c,b,e);c.addShaderVariations("measurement-arrow-material-shader-variations",b)};return c}(l);var u=function(a){function b(b,c,d){c=a.call(this,b,c)||this;c.params=n.copyParameters(b.getParams());c.selectProgram();return c}f(b,a);b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("measurement-arrow-material-shader-variations",[])};b.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===e.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};b.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));
a.bindProgram(b);b.setUniform1f("width",this.params.width);b.setUniform1f("outlineSize",this.params.outlineSize);b.setUniform4fv("outlineColor",this.params.outlineColor);b.setUniform1f("stripeLength",this.params.stripeLength);b.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor);b.setUniform4fv("stripeOddColor",this.params.stripeOddColor)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();n.bindView(a,b.view,c)};b.prototype.bindInstance=function(a,b){this.getProgram().setUniformMatrix4fv("model",
b.transformation)};b.prototype.release=function(a){a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};return b}(b),x=p.create(),v=p.create(),y=p.create(),A=p.create(),C=p.create();b=k.create();k.identity(b);return r})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./RibbonLineMaterial.xml ../../../../core/Logger ../../support/geometryUtils ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m){var u=k.VertexAttrConstants,x=c.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");r=function(c){function e(a,b){b=c.call(this,b)||this;b.params=q.copyParameters(a,W);"miter"!==b.params.join&&(b.params.miterLimit=0);b.numVertsAtJoin="wall"===b.params.type?2:4;b.numVertsAtCap=2;b.canBeMerged="screen"===b.params.type&&null==b.params.stippleLength;return b}f(e,c);e.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};
e.prototype.getColor=function(){return this.params.color};e.prototype.dispose=function(){};e.prototype.getParams=function(){return this.params};e.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,width:a.width,type:a.type,join:a.join,polygonOffset:a.polygonOffset,miterLimit:a.miterLimit,stippleLength:a.stippleLength}};e.prototype.setParameterValues=function(a){for(var b in a)k.assert("type"!==b,"RibbonLineMaterial: type cannot be changed after creation"),k.assert("stippleLength"!==
b||null!=a[b]===(null!=this.params[b]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};e.prototype.getOutputAmount=function(a){a=(a/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a*m.getStride(Q)/4};e.prototype.getInstanceBufferLayout=function(){};e.prototype.getVertexBufferLayout=function(){return"wall"===this.params.type?X:Q};e.prototype.fillInterleaved=
function(a,b,c,d,e,f){c=a.vertexAttr[u.POSITION].data;d=a.vertexAttr[u.COLOR]?a.vertexAttr[u.COLOR].data:A;var h=a.vertexAttr[u.SIZE]?a.vertexAttr[u.SIZE].data:C;(a=a.indices&&a.indices[u.POSITION])&&a.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");"wall"===this.params.type?this.fillWithoutAuxpos(c,b,e,f):this.fillWithAuxpos(c,d,h,b,e,f)};e.prototype.intersect=function(a,c,e,f,h,m,q,g){if(f.isSelection&&!l.isAllHidden(c.componentVisibilities,a.data.componentOffsets))if(k.isTranslationMatrix(e)){c=
a.getData();a=c.getVertexAttr()[u.POSITION].data;c=c.getVertexAttr()[u.SIZE];m=f.camera;g=f.point;c=((c&&c.data[0])+this.params.width)/2+4;d.vec3d.set3(g[0]-c,g[1]+c,0,M[0]);d.vec3d.set3(g[0]+c,g[1]+c,0,M[1]);d.vec3d.set3(g[0]+c,g[1]-c,0,M[2]);d.vec3d.set3(g[0]-c,g[1]-c,0,M[3]);for(var n=0;4>n;n++)m.unprojectPoint(M[n],O[n]);b.plane.fromPoints(m.eye,O[0],O[1],aa);b.plane.fromPoints(m.eye,O[1],O[2],V);b.plane.fromPoints(m.eye,O[2],O[3],N);b.plane.fromPoints(m.eye,O[3],O[0],S);h=Number.MAX_VALUE;for(n=
0;n<a.length-5;n+=3)if(B[0]=a[n]+e[12],B[1]=a[n+1]+e[13],B[2]=a[n+2]+e[14],D[0]=a[n+3]+e[12],D[1]=a[n+4]+e[13],D[2]=a[n+5]+e[14],!(0>b.plane.distance(aa,B)&&0>b.plane.distance(aa,D)||0>b.plane.distance(V,B)&&0>b.plane.distance(V,D)||0>b.plane.distance(N,B)&&0>b.plane.distance(N,D)||0>b.plane.distance(S,B)&&0>b.plane.distance(S,D))){m.projectPoint(B,F);m.projectPoint(D,L);if(0>F[2]&&0<L[2]){d.vec3d.subtract(B,D,E);var p=m.frustumPlanes,t=-b.plane.distance(p[4],B),p=t/d.vec3d.dot(E,p[4]);d.vec3d.scale(E,
p,E);d.vec3d.add(B,E,B);m.projectPoint(B,F)}else if(0<F[2]&&0>L[2])d.vec3d.subtract(D,B,E),p=m.frustumPlanes,t=-b.plane.distance(p[4],D),p=t/d.vec3d.dot(E,p[4]),d.vec3d.scale(E,p,E),d.vec3d.add(D,E,D),m.projectPoint(D,L);else if(0>F[2]&&0>L[2])continue;p=k.pointLineSegmentDistanceSquared2D(F,L,g);p<h&&(h=p,d.vec3d.set(B,G),d.vec3d.set(D,P))}e=f.p0;f=f.p1;h<c*c&&(a=k.lineLineDistanceSquared3D(G,P,e,f,J),c=Number.MAX_VALUE,a.success&&(d.vec3d.subtract(a.pa,e,H),a=d.vec3d.length(H),d.vec3d.scale(H,1/
a),c=a/d.vec3d.dist(e,f)),q(c,H))}else x.error("intersection assumes a translation-only matrix")};e.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:y}};e.prototype.getAllTextureIds=function(){return[]};e.prototype.fillWithAuxpos=function(a,b,c,d,e,f){var h=a.length/3,k=a[0],l=a[1],g=a[2],n=0,q=f,p=m.getStride(this.getVertexBufferLayout())/4;this.canBeMerged&&(f+=p);d&&(k=d[0]*k+d[4]*l+d[8]*g+d[12],l=d[1]*k+d[5]*l+d[9]*g+d[13],g=d[2]*k+
d[6]*l+d[10]*g+d[14]);var u=k,t=l,v=g,A=a[3],x=a[4],y=a[5];d&&(A=d[0]*A+d[4]*x+d[8]*y+d[12],x=d[1]*A+d[5]*x+d[9]*y+d[13],y=d[2]*A+d[6]*x+d[10]*y+d[14]);for(var C=0;C<h;C++){var B=3*C;C<h-1&&(A=a[B+3],x=a[B+4],y=a[B+5],d&&(A=d[0]*A+d[4]*x+d[8]*y+d[12],x=d[1]*A+d[5]*x+d[9]*y+d[13],y=d[2]*A+d[6]*x+d[10]*y+d[14]));n+=Math.sqrt((u-k)*(u-k)+(t-l)*(t-l)+(v-g)*(v-g));e[f++]=u;e[f++]=t;e[f++]=v;e[f++]=n;e[f++]=0===C?-1.2:-1;e[f++]=k;e[f++]=l;e[f++]=g;e[f++]=A;e[f++]=x;e[f++]=y;e[f++]=b[0];e[f++]=b[1];e[f++]=
b[2];e[f++]=b[3];e[f++]=c[0];e[f++]=u;e[f++]=t;e[f++]=v;e[f++]=n;e[f++]=0===C?1.2:1;e[f++]=k;e[f++]=l;e[f++]=g;e[f++]=A;e[f++]=x;e[f++]=y;e[f++]=b[0];e[f++]=b[1];e[f++]=b[2];e[f++]=b[3];e[f++]=c[0];0<C&&C<h-1&&(e[f++]=u,e[f++]=t,e[f++]=v,e[f++]=n,e[f++]=-1.2,e[f++]=k,e[f++]=l,e[f++]=g,e[f++]=A,e[f++]=x,e[f++]=y,e[f++]=b[0],e[f++]=b[1],e[f++]=b[2],e[f++]=b[3],e[f++]=c[0],e[f++]=u,e[f++]=t,e[f++]=v,e[f++]=n,e[f++]=1.2,e[f++]=k,e[f++]=l,e[f++]=g,e[f++]=A,e[f++]=x,e[f++]=y,e[f++]=b[0],e[f++]=b[1],e[f++]=
b[2],e[f++]=b[3],e[f++]=c[0]);k=u;l=t;g=v;u=A;t=x;v=y}if(this.canBeMerged){for(C=q;C<q+p;C++)e[C]=e[C+p];a=f-p;for(C=0;C<p;C++)e[f++]=e[a++]}};e.prototype.fillWithoutAuxpos=function(a,b,c,d){for(var e=a.length/3,f=0,h=a[0],k=a[1],l=a[2],m,g,n,q=0;q<e;q++){var p=3*q;m=h;g=k;n=l;h=a[p];k=a[p+1];l=a[p+2];b&&(h=b[0]*h+b[4]*k+b[8]*l+b[12],k=b[1]*h+b[5]*k+b[9]*l+b[13],l=b[2]*h+b[6]*k+b[10]*l+b[14]);f+=Math.sqrt((h-m)*(h-m)+(k-g)*(k-g)+(l-n)*(l-n));c[d++]=h;c[d++]=k;c[d++]=l;c[d++]=f;c[d++]=-1;c[d++]=h;
c[d++]=k;c[d++]=l;c[d++]=f;c[d++]=1}};e.loadShaders=function(b,c,d){b._parse(a);var e=function(a){a.addDefine("Screen","SCREENSCALE");a.addDefine("Strip","STRIP");a.addDefine("Wall","WALL");a.addDefine("Stipple","STIPPLE")},f=new p("ribbon-line",["vsRibbonLine","fsRibbonLine"],null,c,b,d);e(f);c.addShaderVariations("ribbon-line-material-shader-variations",f);b=new p("ribbon-line",["vsRibbonLine","fsRibbonLineHighlight"],null,c,b,d);e(b);c.addShaderVariations("ribbon-line-material-highlight-shader-variations",
b)};return e}(n);var v=function(a){function b(b,c){var d=a.call(this,b,c)||this;d.params=q.copyParameters(b.getParams());delete d.params.join;d.program=c.getShaderVariationsProgram("ribbon-line-material-shader-variations",["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]);return d}f(b,a);b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.polygonOffset=a.polygonOffset;b.color=a.color;b.width=a.width;b.miterLimit=
"miter"===a.join?a.miterLimit:0;b.stippleLength=a.stippleLength};b.prototype.beginSlot=function(a){return a===t.TRANSPARENT_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*
b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&
a.setPolygonOffsetFillEnabled(!1);a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){q.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};return b}(h),y=function(a){function b(b,c){var d=a.call(this,b,c)||this;d.params=q.copyParameters(b.getParams());delete d.params.join;d.program=c.getShaderVariationsProgram("ribbon-line-material-highlight-shader-variations",
["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]);return d}f(b,a);b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.polygonOffset=a.polygonOffset;b.color=a.color;b.width=a.width;b.miterLimit="miter"===a.join?a.miterLimit:0;b.stippleLength=a.stippleLength};b.prototype.beginSlot=function(a){return a===t.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){var c=
this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,
-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){q.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};return b}(h),A=[255,255,255,255],C=[0,0,0,
0],B=d.vec3d.create(),D=d.vec3d.create(),E=d.vec3d.create(),H=d.vec3d.create(),F=d.vec3d.create(),L=d.vec3d.create(),G=d.vec3d.create(),P=d.vec3d.create(),J={success:!1,dist2:0,pa:d.vec3d.create(),pb:d.vec3d.create()},M=[d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create()],O=[d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create()],aa=b.plane.create(),V=b.plane.create(),N=b.plane.create(),S=b.plane.create(),W={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,
polygonOffset:!1,stippleLength:null},X=e.Pos3Tex,Q=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}];return r})},"esri/views/3d/webgl-engine/materials/internal/BlendLayers":function(){define(["require",
"exports","dojo/text!./BlendLayers.xml","../../lib/DefaultVertexAttributeLocations","../../../../webgl/Program"],function(r,g,f,a,c){return function(){function b(){}b.loadShaders=function(b,e,d){b._parse(f);b=new c(d,b.vertexShaderBlendLayers,b.fragmentShaderBlendLayers,a.Default3D);e.add("blendLayers",b)};return b}()})},"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":function(){define("require exports dojo/text!./SimpleGLMaterial.xml ../../lib/DefaultVertexAttributeLocations ../../lib/RenderSlot ./MaterialUtil ../../../../webgl/Program".split(" "),
function(r,g,f,a,c,b,l){return function(){function e(a,b,c,e){void 0===e&&(e=4);this.program=a.get("simple");this.color=b;this.depthFunc=c;this.drawMode=e}e.prototype.beginSlot=function(a){return a===c.INTERNAL_MATERIAL};e.prototype.getProgram=function(){return this.program};e.prototype.bind=function(a,c){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",b.IDENTITY);this.program.setUniformMatrix4fv("proj",c.proj);this.program.setUniform4fv("color",this.color);a.setBlendingEnabled(!0);
a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};e.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);a.setBlendingEnabled(!1)};e.prototype.bindView=function(a,c){b.bindView(c.origin,c.view,this.program)};e.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};e.prototype.getDrawMode=function(a){return this.drawMode};
e.loadShaders=function(b,c,e){b._parse(f);b=new l(e,b.vertexShaderSimple,b.fragmentShaderSimple,a.Default3D);c.add("simple",b)};return e}()})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports dojo/has ../../support/geometryUtils ../lib/Camera ../lib/gl-matrix ../lib/PerformanceTimer ../lib/Util ./Visualizer".split(" "),function(r,g,f,a,c,b,l,e,d){var h=[0,0],n=b.mat4d.create(),t=[a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create()];
return function(){function a(a,e,f,h){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=h;this._gl=h.gl;this._visualizer=new d(a,e,f,this._rctx);this._camera=new c(b.vec3.createFrom(0,100,-100),b.vec3.createFrom(0,0,0))}Object.defineProperty(a.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},
enumerable:!0,configurable:!0});a.prototype.getCombinedStats=function(){var a={},b=this._visualizer.getCombinedStats(),c;for(c in b)a[c]=b[c];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=
this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=this._gl.getUsedTextureMemoryStats(),d;for(d in b)a["texMem type: "+d]=b[d]}return a};a.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};a.prototype.setLighting=function(a){this._visualizer.setLighting(a)};a.prototype.getViewParams=function(a){var b=this._visualizer.getViewParams(a);if(!a||a.frustumCullingEnabled)b.frustumCullingEnabled=this._frustumCullingEnabled;if(!a||a.maxFarNearRatio)b.maxFarNearRatio=
this._maxFarNearRatio;return b};a.prototype.setViewParams=function(a){void 0!==a.frustumCullingEnabled&&(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(this._maxFarNearRatio=-1===a.maxFarNearRatio?2E4:a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0};a.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};a.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};a.prototype.getFrustumObjects=function(){var a=
{},b;for(b in this._content)a[this._content[b].name]=1;return a};a.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()};a.prototype.modify=function(a,b,c,d){this._visualizer.modify(a,b,c,d);this._content=this._visualizer.getContent()};a.prototype.getContent=function(){return this._content};a.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0};a.prototype.getCamera=function(){return this._camera};a.prototype.getPickRay=function(a,
b,c){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,b,c)};a.prototype.pickRayWithBeginPoint=function(a,b,c,d,e){return this._visualizer.getPickRay(a,b,this._camera,c,d,e)};a.prototype.addExternalRenderer=function(a,b){return this._visualizer.addExternalRenderer(a,b)};a.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)};a.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};a.prototype.render=function(a,
b){this._updateNearFar();this._visualizer.render(this._camera,a,b)};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};a.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};a.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||0<this._maxFarNearRatio)h[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,h),0<this._maxFarNearRatio&&0<h[1]&&(this._camera.far=h[1],this._camera.near=Math.max(h[0],
this._camera.far/this._maxFarNearRatio))};a.prototype._computeFrustumCullingAndNearFar=function(a,c){b.mat4d.perspective(this._camera.fovY,this._camera.aspect,1,10,n);e.matrixToFrustumPlanes(this._camera.viewMatrix,n,t);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;a=-Number.MAX_VALUE;var d=-Number.MAX_VALUE,f=t[0][0],h=t[0][1],k=t[0][2],l=t[0][3],g=t[1][0],q=t[1][1],p=t[1][2],r=t[1][3],E=t[2][0],H=t[2][1],F=t[2][2],L=t[2][3],G=t[3][0],P=t[3][1],J=t[3][2],M=t[3][3],O=t[4][0],
aa=t[4][1],V=t[4][2],N=t[4][3],S=t[5][3],W;for(W in this._content){var X=this._content[W];this._stats.renderGeometriesTotal++;var Q=X.center,I=Q[0],K=Q[1],Q=Q[2],X=X.bsRadius;f*I+h*K+k*Q+l>X||g*I+q*K+p*Q+r>X||E*I+H*K+F*Q+L>X||G*I+P*K+J*Q+M>X||(K=O*I+aa*K+V*Q,I=K+X,K=-K+X,I>a&&(a=I),K>d&&(d=K),this._stats.renderGeometriesVisible++)}W=a!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&W&&(c[0]=.99*Math.max(1-(a+N),2),c[1]=1.01*Math.max(10+(d+S),c[0]+1))};return a}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../lib/gl-matrix ../lib/HighlightHelper ../lib/NearFarCalc ../lib/OffscreenRenderingHelper ../lib/Renderer ../lib/RenderOccludedHelper ../lib/RenderPass ../lib/ShadowMap ../lib/SSAOHelperObscurance ../lib/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t){var p=f.vec3d,k=f.mat4d,q=t.assert;return function(){function f(d,f,k,m){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content={};this._rctx=m;this._renderer=new l(d,f,k,this._rctx,!1);this._programRep=d;this._nearFarCalc=new c;this._helpers={shadowMap:new h(d,this._rctx),ssao:new n(d,k,this._rctx,this.setNeedsRender.bind(this)),highlight:new a(d,k,this._rctx),renderOccluded:new e(d,k,this._rctx),offscreenRendering:new b(d,
this._rctx)}}Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});f.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};f.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setEnableState(!1);this._helpers.shadowMap.dispose();this._helpers.ssao.getEnableState()&&this._helpers.ssao.setEnableState(!1);this._helpers.ssao.dispose();
this._helpers.highlight.getEnableState()&&this._helpers.highlight.setEnableState(!1);this._helpers.renderOccluded.getEnableState()&&this._helpers.renderOccluded.setEnableState(!1);this._helpers.offscreenRendering.getEnableState()&&this._helpers.offscreenRendering.setEnableState(!1)};f.prototype.setLighting=function(a){this._renderer.setLighting(a)};f.prototype.getViewParams=function(a){var b=a||{};if(!a||a.pixelRatio)b.pixelRatio=this._renderer.getPixelRatio();return b};f.prototype.setViewParams=
function(a){null!=a.pixelRatio&&this._renderer.setPixelRatio(a.pixelRatio)};f.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setTextureResolution(a.shadowMapResolution);void 0!==a.shadowMap&&a.shadowMap!==this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setEnableState(a.shadowMap);void 0!==a.shadowMapMaxCascades&&this._helpers.shadowMap.setMaxNumCascades(a.shadowMapMaxCascades);!0!==this._helpers.highlight.getEnableState()&&
this._helpers.highlight.setEnableState(!0);void 0!==a.ssao&&a.ssao!==this._helpers.ssao.getEnableState()&&this._helpers.ssao.setEnableState(a.ssao);void 0!==a.ssaoAttenuation&&this._helpers.ssao.setAttenuation(a.ssaoAttenuation);void 0!==a.ssaoRadius&&this._helpers.ssao.setRadius(a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&this._helpers.ssao.setSamples(a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&
(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._helpers.ssao.getEnableState()?this._renderer.ssaoEnabled=!0:this._renderer.ssaoEnabled=!1;void 0!==a.offscreenRendering&&a.offscreenRendering!==this._helpers.offscreenRendering.getEnableState()&&this._helpers.offscreenRendering.setEnableState(a.offscreenRendering);a.background&&(this._helpers.offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&
(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);this._needsRender=!0};f.prototype.getRenderParams=function(){var a={};this._helpers.shadowMap.getIsSupported()&&(a.shadowMap=this._helpers.shadowMap.getEnableState(),a.shadowMapResolution=this._helpers.shadowMap.getTextureResolution(),
a.shadowMapMaxCascades=this._helpers.shadowMap.getMaxNumCascades());this._helpers.ssao.getIsSupported()&&(a.ssao=this._helpers.ssao.getEnableState(),a.ssaoAttenuation=this._helpers.ssao.getAttenuation(),a.ssaoRadius=this._helpers.ssao.getRadius(),a.ssaoFilterRadius=this._helpers.ssao.getFilterRadius(),a.ssaoSamples=this._helpers.ssao.getSamples());return a};f.prototype.modify=function(a,b,c,d){this._renderer.modify(a,b,c,d);for(d=0;d<b.length;++d)delete this._content[b[d].uniqueName];for(d=0;d<a.length;++d)this._content[a[d].uniqueName]=
a[d];for(d=0;d<c.length;++d)q(this._content[c[d].renderGeometry.uniqueName]===c[d].renderGeometry)};f.prototype.getContent=function(){return this._content};f.prototype.getPickRay=function(a,b,c,d,e,f){p.unproject(p.createFrom(a[0],a[1],0),d,c.projectionMatrix,c.fullViewport,e);p.unproject(p.createFrom(a[0],a[1],1),d,c.projectionMatrix,c.fullViewport,f)};f.prototype.getProjectionMatrix=function(a,b,c,d,e){b=t.fovx2fovy(b,a[2],a[3]);k.perspective(180*b/Math.PI,a[2]/a[3],c,d,e)};f.prototype.addExternalRenderer=
function(a,b){return this._renderer.addExternalRenderer(a,b)};f.prototype.removeExternalRenderer=function(a){return this._renderer.removeExternalRenderer(a)};f.prototype.getExternalRenderers=function(){return this._renderer.getExternalRenderers()};f.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};f.prototype.setNeedsRender=function(){this._needsRender=!0};f.prototype.render=
function(a,b,c){var e=a.viewport,f;if(this._helpers.shadowMap.getEnableState()){f=this._nearFarCalc.calculateSceneNearFar(a,this._content);this._helpers.shadowMap.prepare(a,b,this._content,f);b=this._helpers.shadowMap.getCascades();for(f=0;f<b.length;++f){var h=b[f];h.camera.setGLViewport(this._rctx);this._renderer.renderGeometryPass(d.MATERIAL_DEPTH_SHADOWMAP,h.camera)}this._helpers.shadowMap.finish(c);a.setGLViewport(this._rctx)}this._helpers.shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(a,
c,this._helpers);this._renderer.render(a,c,this._helpers);this._drawShadowMapDebugQuad&&this._helpers.shadowMap.getEnableState()&&(a=k.ortho(e[0],e[2],e[1],e[3],-1,1),this._helpers.shadowMap.drawDebugQuad(a));this._drawSSAOMapDebugQuad&&this._helpers.ssao.getEnableState()&&(a=k.ortho(e[0],e[2],e[1],e[3],-1,1),this._helpers.ssao.drawQuad(a))};f.prototype.getEdgeView=function(){return this._renderer.edgeView};return f}()})},"esri/views/3d/webgl-engine/lib/NearFarCalc":function(){define(["require","exports",
"./ComponentUtils","./gl-matrix","./Util"],function(r,g,f,a,c){r=a.vec3d;var b=a.vec4d,l=a.mat4d;a=function(){function a(){this._context={content:[],near:[],far:[],nearSpecial:[],farSpecial:[],bestNear:0,bestFar:0,bestNear2:0,bestFar2:0};this._boundingInfoHelper=new e}a.prototype._resetContext=function(){var a=this._context;a.content.length=0;a.near.length=0;a.far.length=0;a.nearSpecial.length=0;a.farSpecial.length=0;a.bestNear=Number.MAX_VALUE;a.bestFar=-Number.MAX_VALUE;return this._context};a.prototype.calculateSceneNearFar=
function(a,b){var c=this._resetContext(),d=a.viewMatrix,e=d[2],h=d[6],k=d[10],l=d[14],g=0,q;for(q in b)if(d=b[q],!f.isAllHidden(d.instanceParameters.componentVisibilities,d.componentOffsets)&&d.castShadow){var p=void 0,t=void 0;d.hasShaderTransformation?(p=d.getBoundingSphere(d.getShaderTransformation(),null,n),t=n):(p=d.bsRadius,t=d.center);var r=e*t[0]+h*t[1]+k*t[2]+l,t=r-p,p=r+p;c.content[g]=d;c.near[g]=-p;c.far[g]=-t;++g}if(0===g)return[c.bestNear,c.bestFar];for(b=0;b<g;++b)c.near[b]>c.bestFar&&
(c.bestFar=c.near[b]),2<c.near[b]&&c.far[b]<c.bestNear&&(c.bestNear=c.far[b]);c.bestNear2=Math.max(.5*c.bestNear,2);c.bestFar2=2*c.bestFar;for(b=h=e=0;b<g;++b)c.near[b]<c.bestNear&&(c.near[b]>=c.bestNear2?c.bestNear=c.near[b]:c.nearSpecial[e++]=b),c.far[b]>c.bestFar&&(c.far[b]<=c.bestFar2?c.bestFar=c.far[b]:c.farSpecial[h++]=b);if(0===e&&0===h)return[c.bestNear,c.bestFar];c.nearSpecial.length=e;c.farSpecial.length=h;c.nearSpecial.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?
1:0});c.farSpecial.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});this._boundingInfoHelper.init(a,c);for(b=0;b<e;++b)c.near[c.nearSpecial[b]]<c.bestNear&&(d=c.content[c.nearSpecial[b]],a=d.boundingInfo,this._boundingInfoHelper.includeNearBoundingInfoRec(a,d.getShaderTransformation()));for(b=0;b<h;++b)c.far[c.farSpecial[b]]>c.bestFar&&(d=c.content[c.farSpecial[b]],a=d.boundingInfo,this._boundingInfoHelper.includeFarBoundingInfoRec(a,d.getShaderTransformation()));return[c.bestNear,
c.bestFar]};return a}();var e=function(){function a(){this._clippingHelper=new d;this._planes=[b.create(),b.create(),b.create(),b.create(),b.create(),b.create()];this._viewProj=l.create();this._view=l.create()}a.prototype.init=function(a,b){this._context=b;l.set(a.viewMatrix,this._view);l.multiply(a.projectionMatrix,this._view,this._viewProj);a.copyFrustumPlanes(this._planes);this._clippingHelper.init(b)};a.prototype.includeNearBoundingInfoRec=function(a,b){var c=a.getBSRadius(),d=a.getCenter();l.multiplyVec3(b,
d,n);var d=n[0],e=n[1],f=n[2],c=c*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*d+this._planes[0][1]*e+this._planes[0][2]*f+this._planes[0][3]>c||this._planes[1][0]*d+this._planes[1][1]*e+this._planes[1][2]*f+this._planes[1][3]>c||this._planes[2][0]*d+this._planes[2][1]*e+this._planes[2][2]*f+this._planes[2][3]>c||this._planes[3][0]*d+this._planes[3][1]*e+this._planes[3][2]*f+this._planes[3][3]>c||
(d=this._view[2]*d+this._view[6]*e+this._view[10]*f+this._view[14],e=d+c,2>-(d-c)||-e>=this._context.bestNear)))if(-e>this._context.bestNear2)this._context.bestNear=-e;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeNearBoundingInfoRec(c[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,b,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,b){var c=a.getBSRadius(),d=a.getCenter();l.multiplyVec3(b,d,n);var d=n[0],
e=n[1],f=n[2],c=c*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*d+this._planes[0][1]*e+this._planes[0][2]*f+this._planes[0][3]>c||this._planes[1][0]*d+this._planes[1][1]*e+this._planes[1][2]*f+this._planes[1][3]>c||this._planes[2][0]*d+this._planes[2][1]*e+this._planes[2][2]*f+this._planes[2][3]>c||this._planes[3][0]*d+this._planes[3][1]*e+this._planes[3][2]*f+this._planes[3][3]>c||(d=this._view[2]*
d+this._view[6]*e+this._view[10]*f+this._view[14]-c,-d<=this._context.bestFar)))if(-d<this._context.bestFar2)this._context.bestFar=-d;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeFarBoundingInfoRec(c[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,b,a.getBBMin(),a.getBBMax())}};return a}(),d=function(){function a(){this._clipP=Array(8);for(var a=0;8>a;++a)this._clipP[a]=b.create()}a.prototype.init=function(a){this._context=a};a.prototype.intersectFrustumAABB=
function(a,b,c,d){l.multiply(a,b,t);for(a=0;8>a;++a){b=this._clipP[a];var e=0===a||3===a||4===a||7===a?c[0]:d[0],f=0===a||1===a||4===a||5===a?c[1]:d[1],k=4>a?c[2]:d[2];b[0]=t[0]*e+t[4]*f+t[8]*k+t[12];b[1]=t[1]*e+t[5]*f+t[9]*k+t[13];b[2]=t[2]*e+t[6]*f+t[10]*k+t[14];b[3]=t[3]*e+t[7]*f+t[11]*k+t[15]}for(a=0;12>a;++a){c=this._clipTriangle(this._clipP[h[a][0]],this._clipP[h[a][1]],this._clipP[h[a][2]]);d=!0;for(b=0;b<c.length;++b)if(e=c[b][3],2<=e){d=!1;break}if(!d)for(b=0;b<c.length;++b)e=c[b][3],e<this._context.bestNear&&
(this._context.bestNear=e),e>this._context.bestFar&&(this._context.bestFar=e)}};a.prototype._inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];c.assert(!1)};a.prototype._intersect=function(a,c,d){var e=0;0===d?e=(-a[3]-a[0])/(c[0]-a[0]+c[3]-a[3]):1===d?e=(-a[3]-a[1])/(c[1]-a[1]+c[3]-a[3]):2===d?e=(a[3]-a[0])/(c[0]-a[0]-c[3]+a[3]):3===d&&(e=(a[3]-a[1])/(c[1]-a[1]-c[3]+a[3]));return b.lerp(a,c,e,b.create())};a.prototype._clipTriangle=
function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this._inside(f,b)?(this._inside(e,b)||a.push(this._intersect(e,f,b)),a.push(f)):this._inside(e,b)&&a.push(this._intersect(e,f,b))}}return a};return a}(),h=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],n=r.create(),t=l.create();return a})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/Logger ./Camera ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){function q(a,b){l.vec3d.set3(a[b],a[b+3],a[b+6],Y);return Y}var m=f.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap"),u=function(){return function(){this.camera=new a;this.lightMat=l.mat4d.create()}}();r=function(){function a(a,b){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.programRep=a;this.rctx=b;this.emptyTexture=e.createEmptyTexture(b);for(a=0;4>a;++a)this.cascades.push(new u)}
a.prototype.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null};a.prototype.getIsSupported=function(){return this.rctx.capabilities.standardDerivatives};a.prototype.setTextureResolution=function(a){this.textureRes=a};a.prototype.getTextureResolution=function(){return this.textureRes};a.prototype.setMaxNumCascades=function(a){this.maxNumCascades=d.clamp(Math.floor(a),1,4)};a.prototype.getMaxNumCascades=function(){return this.maxNumCascades};a.prototype.setEnableState=function(a){a?
this.enable():this.disable()};a.prototype.getEnableState=function(){return!!this.depthTexture};a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)J[a]=this.cascades[a];J.length=this.numCascades;return J};a.prototype.prepare=function(a,b,c,e){d.assert(this.getEnableState());l.mat4d.multiply(a.projectionMatrix,a.viewMatrix,x);var f=e[0],h=e[1];2>f&&(f=2);2>h&&(h=2);f>=h&&(f=2,h=4);this.numCascades=Math.min(1+Math.floor(d.logWithBase(h/
f,4)),this.maxNumCascades);c=Math.pow(h/f,1/this.numCascades);for(e=0;e<this.numCascades+1;++e)this.cascadeDistances[e]=f*Math.pow(c,e);l.mat4d.inverse(x,v);l.mat4d.lookAt([0,0,0],[-b[0],-b[1],-b[2]],[0,1,0],G);c=a.viewMatrix;a=a.projectionMatrix;for(e=0;e<this.numCascades;++e){var k=this.cascades[e],h=-this.cascadeDistances[e],f=-this.cascadeDistances[e+1],h=(a[10]*h+a[14])/Math.abs(a[11]*h+a[15]),f=(a[10]*f+a[14])/Math.abs(a[11]*f+a[15]);d.assert(h<f);for(var g=0;8>g;++g){l.vec4d.set4(0===g%4||
3===g%4?-1:1,0===g%4||1===g%4?-1:1,4>g?h:f,1,y);l.mat4d.multiplyVec4(v,y,A[g]);for(var n=0;3>n;++n)A[g][n]/=A[g][3]}l.vec3d.negate(A[0],P);l.mat4d.translate(G,P,k.camera.viewMatrix);for(g=0;8>g;++g)l.mat4d.multiplyVec3(k.camera.viewMatrix,A[g]);l.vec3d.set(A[0],C);l.vec3d.set(A[0],B);for(g=1;8>g;++g)for(n=0;3>n;++n)C[n]=Math.min(C[n],A[g][n]),B[n]=Math.max(B[n],A[g][n]);C[2]-=200;B[2]+=200;k.camera.near=-B[2];k.camera.far=-C[2];f=1/A[0][3];h=1/A[4][3];d.assert(f<h);var n=f+Math.sqrt(f*h),g=Math.sin(Math.acos(c[2]*
b[0]+c[6]*b[1]+c[10]*b[2])),n=n/g,f=A,m=n,p=g,g=D,t=E,u=H,r=F,n=L;l.vec2d.set2(0,0,aa);for(var Y=0;4>Y;++Y)l.vec2d.add(aa,f[Y],aa);l.vec2d.scale(aa,.25);l.vec2d.set2(0,0,V);for(Y=4;8>Y;++Y)l.vec2d.add(V,f[Y],V);l.vec2d.scale(V,.25);l.vec2d.lerp(f[4],f[5],.5,N[0]);l.vec2d.lerp(f[5],f[6],.5,N[1]);l.vec2d.lerp(f[6],f[7],.5,N[2]);l.vec2d.lerp(f[7],f[4],.5,N[3]);for(var O=0,J=l.vec2d.dist2(N[0],aa),Y=1;4>Y;++Y){var M=l.vec2d.dist2(N[Y],aa);M<J&&(J=M,O=Y)}l.vec2d.subtract(N[O],f[O+4],S);Y=S[0];S[0]=-S[1];
S[1]=Y;l.vec2d.subtract(V,aa,W);l.vec2d.lerp(S,W,p);l.vec2d.normalize(S);O=p=void 0;p=O=l.vec2d.dot(l.vec2d.subtract(f[0],aa,X),S);for(Y=1;8>Y;++Y)J=l.vec2d.dot(l.vec2d.subtract(f[Y],aa,X),S),J<p?p=J:J>O&&(O=J);l.vec2d.set(aa,g);l.vec2d.scale(S,p-m,X);l.vec2d.add(g,X,g);for(var M=-1,da=1,Y=m=J=0;8>Y;++Y){l.vec2d.subtract(f[Y],g,Q);l.vec2d.normalize(Q);var ha=S[0]*Q[1]-S[1]*Q[0];0<ha?ha>M&&(M=ha,J=Y):ha<da&&(da=ha,m=Y)}d.verify(0<M,"leftArea");d.verify(0>da,"rightArea");l.vec2d.scale(S,p,I);l.vec2d.add(I,
aa,I);l.vec2d.scale(S,O,K);l.vec2d.add(K,aa,K);T[0]=-S[1];T[1]=S[0];t=d.rayRay2D(g,f[m],K,l.vec2d.add(K,T,X),1,t);u=d.rayRay2D(g,f[J],K,X,1,u);r=d.rayRay2D(g,f[J],I,l.vec2d.add(I,T,X),1,r);f=d.rayRay2D(g,f[m],I,X,1,n);d.verify(t,"rayRay");d.verify(u,"rayRay");d.verify(r,"rayRay");d.verify(f,"rayRay");u=D;f=E;g=F;r=L;n=k.camera.projectionMatrix;l.vec2d.scale(l.vec2d.subtract(g,r,ba),.5);R[0]=ba[0];R[1]=ba[1];R[2]=0;R[3]=ba[1];R[4]=-ba[0];R[5]=0;R[6]=ba[0]*ba[0]+ba[1]*ba[1];R[7]=ba[0]*ba[1]-ba[1]*ba[0];
R[8]=1;R[6]=-l.vec2d.dot(q(R,0),u);R[7]=-l.vec2d.dot(q(R,1),u);u=l.vec2d.dot(q(R,0),g)+R[6];t=l.vec2d.dot(q(R,1),g)+R[7];Y=l.vec2d.dot(q(R,0),r)+R[6];r=l.vec2d.dot(q(R,1),r)+R[7];u=-(u+Y)/(t+r);R[0]+=R[1]*u;R[3]+=R[4]*u;R[6]+=R[7]*u;u=1/(l.vec2d.dot(q(R,0),g)+R[6]);t=1/(l.vec2d.dot(q(R,1),g)+R[7]);R[0]*=u;R[3]*=u;R[6]*=u;R[1]*=t;R[4]*=t;R[7]*=t;R[2]=R[1];R[5]=R[4];R[8]=R[7];R[7]+=1;u=l.vec2d.dot(q(R,1),f)+R[7];t=l.vec2d.dot(q(R,2),f)+R[8];Y=l.vec2d.dot(q(R,1),g)+R[7];r=l.vec2d.dot(q(R,2),g)+R[8];
u=-.5*(u/t+Y/r);R[1]+=R[2]*u;R[4]+=R[5]*u;R[7]+=R[8]*u;u=l.vec2d.dot(q(R,1),f)+R[7];t=l.vec2d.dot(q(R,2),f)+R[8];Y=-t/u;R[1]*=Y;R[4]*=Y;R[7]*=Y;n[0]=R[0];n[1]=R[1];n[2]=0;n[3]=R[2];n[4]=R[3];n[5]=R[4];n[6]=0;n[7]=R[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=R[6];n[13]=R[7];n[14]=0;n[15]=R[8];k.camera.projectionMatrix[10]=2/(C[2]-B[2]);k.camera.projectionMatrix[14]=-(C[2]+B[2])/(C[2]-B[2]);l.mat4d.multiply(k.camera.projectionMatrix,k.camera.viewMatrix,k.lightMat);f=this.textureRes/2;k.camera.viewport[0]=
0===e%2?0:f;k.camera.viewport[1]=0===Math.floor(e/2)?0:f;k.camera.viewport[2]=f;k.camera.viewport[3]=f}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*h;b=this.rctx;e=b.gl;b.bindFramebuffer(this.fbo);b.bindTexture(null,7);b.setClearColor(1,1,1,1);b.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);b.setBlendingEnabled(!1)};a.prototype.finish=function(a){d.assert(this.getEnableState());this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=
function(a){var b=this.rctx,c=this.getEnableState();b.bindTexture(c?this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};
a.prototype.bindView=function(a,b){if(this.getEnableState()){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||l.vec3d.create(),l.vec3d.set(b,this.lastOrigin),c=0;c<this.numCascades;++c){l.mat4d.translate(this.cascades[c].lightMat,b,M);for(var d=0;16>d;++d)O[16*c+d]=M[d]}a.setUniformMatrix4fv("shadowMapMatrix",O)}};a.prototype.drawDebugQuad=function(a){d.assert(this.getEnableState());var e=this.rctx,f=e.gl;if(!this.debugQuadVAO){var l=new Float32Array([0,
0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new k(e,c.Default3D,{geometry:b.Pos2Tex},{geometry:h.createVertex(e,f.STATIC_DRAW,l)})}var l=this.programRep.get("showDepth"),g=this.debugQuadVAO;e.setDepthTestEnabled(!1);e.bindProgram(l);l.setUniformMatrix4fv("proj",a);l.setUniform1i("depthTex",0);e.bindTexture(this.depthTexture,0);e.bindVAO(g);p.assertCompatibleVertexAttributeLocations(g,l);e.drawArrays(f.TRIANGLE_STRIP,0,p.vertexCount(g,"geometry"));e.setDepthTestEnabled(!0)};a.prototype.enable=
function(){if(!this.getEnableState())if(this.getIsSupported()){var a=this.rctx.gl;this.depthTexture=new t(this.rctx,{target:a.TEXTURE_2D,pixelFormat:a.RGBA,dataType:a.UNSIGNED_BYTE,wrapMode:a.CLAMP_TO_EDGE,samplingMode:a.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes});this.fbo=n.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}else m.warn("Shadow maps are not supported for this browser or hardware")};
a.prototype.disable=function(){this.getEnableState()&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};return a}();var x=l.mat4d.create(),v=l.mat4d.create(),y=l.vec4d.create(),A=[];for(g=0;8>g;++g)A.push(l.vec4d.create());var C=l.vec3d.create(),B=l.vec3d.create(),D=l.vec2d.create(),E=l.vec2d.create(),H=l.vec2d.create(),F=l.vec2d.create(),L=l.vec2d.create(),G=l.mat4d.create(),P=l.vec3d.create(),J=[],M=l.mat4d.create(),O=new Float32Array(64),aa=l.vec2d.create(),V=l.vec2d.create(),N=[l.vec2d.create(),
l.vec2d.create(),l.vec2d.create(),l.vec2d.create()],S=l.vec2d.create(),W=l.vec2d.create(),X=l.vec2d.create(),Q=l.vec2d.create(),I=l.vec2d.create(),K=l.vec2d.create(),T=l.vec2d.create(),Y=l.vec3d.create(),ba=l.vec2d.create(),R=l.mat3d.create();return r})},"esri/views/support/screenshotUtils":function(){define(["require","exports","dojo/_base/lang"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.adjustScreenshotSettings=function(a,c){a=f.mixin({format:"png",quality:100},a||{});var b,
l;a.includePadding?(b=c.width,l=c.height):(b=c.width-c.padding.left-c.padding.right,l=c.height-c.padding.top-c.padding.bottom);var e=b/l;void 0!==a.width&&void 0===a.height?a.height=a.width/e:void 0!==a.height&&void 0===a.width&&(a.width=e*a.height);void 0!==a.height&&(a.height=Math.floor(a.height));void 0!==a.width&&(a.width=Math.floor(a.width));a.area||a.includePadding||(a.area={x:c.padding.left,y:c.padding.top,width:b,height:l});return a};g.resampleHermite=function(a,c,b,f,e,d,h){void 0===h&&(h=
!0);var l=c/e;b/=d;for(var g=Math.ceil(l/2),p=Math.ceil(b/2),k=0;k<d;k++)for(var q=0;q<e;q++){for(var m=4*(q+(h?d-k-1:k)*e),u=0,x=0,v=0,y=0,A=0,C=0,B=0,r=(k+.5)*b,E=Math.floor(k*b);E<(k+1)*b;E++)for(var H=Math.abs(r-(E+.5))/p,F=(q+.5)*l,H=H*H,L=Math.floor(q*l);L<(q+1)*l;L++){var G=Math.abs(F-(L+.5))/g,u=Math.sqrt(H+G*G);-1<=u&&1>=u&&(u=2*u*u*u-3*u*u+1,0<u&&(G=4*(L+E*c),B+=u*a[G+3],v+=u,255>a[G+3]&&(u=u*a[G+3]/250),y+=u*a[G],A+=u*a[G+1],C+=u*a[G+2],x+=u))}f[m]=y/x;f[m+1]=A/x;f[m+2]=C/x;f[m+3]=B/v}}})},
"esri/views/webgl/RenderingContext":function(){define("require exports dojo/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(r,g,f,a,c,b,l){return function(){function c(a,c){this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=
1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};
this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this.contextVersion=b.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=l.loadCapabilities(a,c);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;
this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(c.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};c.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};c.prototype.setBlendColor=function(a,b,c,e){if(a!==this._blendColorState.r||
b!==this._blendColorState.g||c!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,b,c,e),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=c,this._blendColorState.a=e};c.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};
c.prototype.setBlendFunctionSeparate=function(a,b,c,e){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==c||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,b,c,e),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=c,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=e};c.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=
a,this._blendEquationState.modeAlpha=a)};c.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};c.prototype.setColorMask=function(a,b,c,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==c||this._colorMaskState.a!==e)this.gl.colorMask(a,b,c,e),this._colorMaskState.r=a,this._colorMaskState.g=
b,this._colorMaskState.b=c,this._colorMaskState.a=e};c.prototype.setClearColor=function(a,b,c,e){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==c||this._clearColor.a!==e)this.gl.clearColor(a,b,c,e),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=c,this._clearColor.a=e};c.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};c.prototype.setPolygonOffsetFillEnabled=
function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a)};c.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};c.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a)};c.prototype.setFrontFace=function(a){this._frontFace!==
a&&(this.gl.frontFace(a),this._frontFace=a)};c.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};c.prototype.setScissorRect=function(a,b,c,e){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==c||this._scissorRect.height!==e)this.gl.scissor(a,b,c,e),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=c,this._scissorRect.height=
e};c.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a)};c.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};c.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};c.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=
a)};c.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b};c.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};c.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};c.prototype.setStencilFunction=
function(a,b,c){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==c)this.gl.stencilFunc(a,b,c),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=c};c.prototype.setStencilFunctionSeparate=function(a,b,c,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==c||this._stencilFunction.mask!==e)this.gl.stencilFuncSeparate(a,b,c,e),this._stencilFunction.face=
a,this._stencilFunction.func=b,this._stencilFunction.ref=c,this._stencilFunction.mask=e};c.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a)};c.prototype.setStencilOp=function(a,b,c){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==c)this.gl.stencilOp(a,b,c),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=
c};c.prototype.setStencilOpSeparate=function(a,b,c,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,b,c,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=c,this._stencilOperation.zPass=e};c.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};
c.prototype.setActiveTexture=function(b){var c=this._activeTextureUnit;0<=b&&b!==this._activeTextureUnit&&(this.gl.activeTexture(a.BASE_TEXTURE_UNIT+b),this._activeTextureUnit=b);return c};c.prototype.clear=function(a){a&&this.gl.clear(a)};c.prototype.drawArrays=function(a,b,c){this.gl.drawArrays(a,b,c)};c.prototype.drawElements=function(a,b,c,e){5123===c?this.gl.drawElements(a,b,c,e):5125===c&&this.gl.drawElements(a,b,c,e)};Object.defineProperty(c.prototype,"capabilities",{get:function(){return this._capabilities},
enumerable:!0,configurable:!0});c.prototype.setViewport=function(a,b,c,e){var d=this._viewport;if(d.x!==a||d.y!==b||d.width!==c||d.height!==e)d.x=a,d.y=b,d.width=c,d.height=e,this.gl.viewport(a,b,c,e)};c.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),
this._activeShaderProgram=null)};c.prototype.bindTexture=function(a,b){void 0===b&&(b=0);-1===c._MAX_TEXTURE_IMAGE_UNITS&&(c._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(b>=c._MAX_TEXTURE_IMAGE_UNITS||0>b)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[b];this.setActiveTexture(b);null==a||null==a.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(b,!1)),this._textureUnitMap[b]=null):
d&&d.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(b,!0),a.applyChanges(),this._textureUnitMap[b]=a)};c.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};c.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=c._bindBuffer(this.gl,
a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};c.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=c._bindBuffer(this.gl,null,a,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};c.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&
(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};c.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};c.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};c.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};c.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,
a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,
7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.prototype.enforceState=function(){var b=this.gl,c=this._capabilities.vao;c&&c.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)b.disableVertexAttribArray(e);this._activeVertexBuffer?b.bindBuffer(this._activeVertexBuffer.bufferType,
this._activeVertexBuffer.glName):b.bindBuffer(34962,null);this._activeIndexBuffer?b.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):b.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}b.bindFramebuffer(b.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);b.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:
null);b.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);!0===this._blendEnabled?b.enable(this.gl.BLEND):b.disable(this.gl.BLEND);b.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);b.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);b.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,
this._clearColor.a);b.clearDepth(this._clearDepth);b.clearStencil(this._clearStencil);b.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);b.cullFace(this._cullFace);b.depthFunc(this._depthFunction);b.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);b.depthMask(this._depthWriteEnabled);b.frontFace(this._frontFace);b.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?
b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);b.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL);b.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST);b.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);b.stencilOpSeparate(this._stencilOperation.face,
this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);b.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)b.activeTexture(a.BASE_TEXTURE_UNIT+c),b.bindTexture(3553,null),(e=this._textureUnitMap[c])&&b.bindTexture(e.descriptor.target,e.glName);b.activeTexture(a.BASE_TEXTURE_UNIT+this._activeTextureUnit);b.viewport(this._viewport.x,this._viewport.y,this._viewport.width,
this._viewport.height)};c._bindBuffer=function(a,b,c,e){if(!b)return a.bindBuffer(c,null),null;if(e===b)return e;a.bindBuffer(c,b.glName);return b};c._MAX_TEXTURE_IMAGE_UNITS=-1;return c}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(r,g){return function(){function f(){this._instanceCount={textureCount:0,
bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0}}f.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++}};f.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;
break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--}};f.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount)};return f}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),
function(r,g,f,a,c,b){function l(a,b,f,l,g){if(l&&c.default(a))return!0;if(b[f])return!1;for(b=0;b<g.length;b++)if(a.getExtension(g[b]))return!0;return!1}Object.defineProperty(g,"__esModule",{value:!0});g.loadCapabilities=function(e,d){d=d&&d.disabledExtensions||{};var h=a.load(e,d),g=b.load(e,d),t;t=d.compressedTextureS3TC?null:(t=e.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:t.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:t.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:t.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:t.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var p;p=d.textureFilterAnisotropic?null:(p=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:p.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:p.TEXTURE_MAX_ANISOTROPY_EXT}:null;var k=f.load(e,d),q;if(c.default(e))q=d.colorBufferFloat||!e.getExtension("EXT_color_buffer_float")?null:{R16F:e.R16F,
RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F};else if(e instanceof WebGLRenderingContext){q=!d.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float");var m=!d.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");q=q||m?{RGBA16F:q?q.RGBA16F_EXT:void 0,RGBA32F:m?m.RGBA32F_EXT:void 0}:null}else q=void 0;m=c.default(e)?{MIN:e.MIN,MAX:e.MAX}:d.blendMinMax?null:(m=e.getExtension("EXT_blend_minmax"))?{MIN:m.MIN_EXT,MAX:m.MAX_EXT}:
null;return{instancing:h,vao:g,compressedTextureS3TC:t,textureFilterAnisotropic:p,disjointTimerQuery:k,colorBufferFloat:q,blendMinMax:m,depthTexture:l(e,d,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:l(e,d,"standardDerivatives",!0,["OES_standard_derivatives"]),shaderTextureLOD:l(e,d,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:l(e,d,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:l(e,d,
"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.load=function(a,c){if(c.disjointTimerQuery)return null;var b=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return b?f.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(b){return a.getQueryParameter(b,a.QUERY_RESULT_AVAILABLE)},
getResult:function(b){return a.getQueryParameter(b,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(c){return a.beginQuery(b.TIME_ELAPSED_EXT,c)},endTimeElapsed:function(){return a.endQuery(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return b.createQueryEXT()},resultAvailable:function(a){return b.getQueryObjectEXT(a,
b.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return b.beginQueryEXT(b.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return b.endQueryEXT(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return b.getQueryEXT(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require",
"exports","./isWebGL2Context"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.load=function(a,c){return f.default(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:c.angleInstancedArrays?null:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:
null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.load=function(a,c){return f.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:c.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?
{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/Logger ../../../../core/scheduling ../../../../layers/graphics/dehydratedFeatures ./constants ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/mathUtils ../../support/PromiseLightweight".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){function q(a,b){a=null!=a?b.attributes[a]:0;null!=a&&isFinite(a)||(a=0);return a}var m=new d,u=c.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),x={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"};return function(c){function k(a,b,e,f){var h=c.call(this)||this;h._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};h.symbolContainer=a;h.symbol=b;h._context=e;h._symbolLayerOrder=e.layerOrder;
h._symbolLayerOrderDelta=e.layerOrderDelta;h._elevationContext=new d;h._material=null;h._geometryCreationWarningHandle=null;h._updateDrivenProperties(f);h._updateElevationContext();h._prepareResources();return h}f(k,c);k.prototype._logWarning=function(a){u.warn(a)};k.prototype._logGeometryCreationWarnings=function(a,c,d,e){var f=this;if(null==this._geometryCreationWarningHandle){var h=a.geometryData&&a.geometryData.polygons;e+=" geometry failed to be created";var k=null;a.projectionSuccess?!c.length||
1===c.length&&!c[0].length?k=e+" (no "+d+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?k=e+" ("+d+" should contain at least 2 vertices)":h&&0===h.length&&"rings"===d&&(k=e+" (filled "+d+" should use clockwise winding - try reversing the order of vertices)"):k=e+" ("+d+" should be defined as a 2D array)":k=e+" (failed to project geometry to view spatial reference)";k&&(this._geometryCreationWarningHandle=b.schedule(function(){return f._onNextTick()}),
this._logWarning(k))}};k.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};k.prototype._validateGeometry=function(a){return"point"!==a.type||p.isFinite(a.x)&&p.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};k.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};k.prototype._defaultElevationInfoNoZ=function(){return x};k.prototype._defaultElevationInfoZ=function(){return v};k.prototype._updateElevationContext=
function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};k.prototype.getGraphicElevationContext=function(a){var b=l.hasZ(a.geometry)?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();m.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:
b.unit);m.mode=this._elevationContext.mode||b.mode;m.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:b.offset);m.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;m.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==m.mode||(m.mode="relative-to-ground",m.setOffsetMeters(0),m.featureExpressionInfoContext=h.zeroContext);b=h.createFeature(a,this._context.layer);h.setContextFeature(m.featureExpressionInfoContext,
b);n.needsOffsetAdjustment(m,this._elevationOptions,a.geometry,this.symbolContainer)&&(m.setOffsetRenderUnits(e.defaultIconElevationOffset),m.hasOffsetAdjustment=!0);return m};k.prototype._getDrapedZ=function(){return-2};k.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.colors)for(var c=0;c<
a.colors.length;c++){var d=a.colors[c];d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}if(a.stops)for(c=0;c<a.stops.length;c++)(d=a.stops[c].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0);break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b};k.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};k.prototype._getLayerOpacity=function(){if(this._context.layerView&&
"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};k.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};k.prototype._getMaterialOpacityAndColor=function(){var b=this.symbol&&this.symbol.material,c=this._getMaterialOpacity(),b=!this._isPropertyDriven("color")&&b&&b.color?a.toUnitRGB(b.color):
null;return t.mixinColorAndOpacity(b,c)};k.prototype._getVertexOpacityAndColor=function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=t.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):d};k.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};k.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};k.prototype.updateSymbolLayerOrder=function(a,
b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};k.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};k.prototype.createGraphics3DGraphic=function(a){for(var b=1;b<arguments.length;b++);throw Error("This is an abstract base class");};k.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};k.prototype.layerPropertyChanged=
function(a,b,c){return!1};k.prototype.applyRendererDiff=function(a,b,c,d){return!1};k.prototype._getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?q(b.size.field,a):0;a=b.color?q(b.color.field,a):0;return[c,a,0,0]};return k}(k.Promise)})},"esri/views/3d/support/PromiseLightweight":function(){(function(r){function g(a){this._callbacks=[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}
function f(a,b){var c=new g;0===a.length?c.done.apply(c,b):a[0].apply(null,b).then(function(){a.splice(0,1);f(a,arguments).then(function(){c.done.apply(c,arguments)})});return c}g.prototype.cancel=function(a){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(a)};g.prototype.then=function(a,b,f){var c;if(!this._iscancelled)return this._isdone?c=a.apply(f,this.result):this._iserr&&b?c=b.apply(f,this.result):(this._callbacks.push(function(){return a.apply(f,
arguments)}),b&&this._errbacks.push(function(){return b.apply(f,arguments)})),c};g.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]};g.prototype.resolve=g.prototype.done;g.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=
[]}};g.prototype.isRejected=function(){return this._iserr};g.prototype.isFulfilled=function(){return this._isdone||this._iserr};g.prototype.isResolved=function(){return this._isdone};g.prototype.isCancelled=function(){return this._iscancelled};var a={Promise:g,join:function(a){function b(a,b){return function(){b&&(n=!0);d+=1;f[a]=Array.prototype.slice.call(arguments);d===e&&(n?c.reject():c.done(f))}}for(var c=new g,e=a.length,d=0,f=[],n=!1,t=0;t<e;t++)a[t].then(b(t,!1),b(t,!0));0===a.length&&c.done();
return c},chain:f};"function"===typeof define&&define.amd?define(function(){return a}):r.promise=a})(this)},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(r,g,f,a,c,b,l,e){return function(){function d(a,b,c){this.singleUse=!1;this.componentAABB=null;this.id=d.__idGen.gen(b);this.data=a;this.boundingInfo=c}d.prototype.getData=function(){return this.data};d.prototype.getComponentCount=
function(){return a.componentCount(this.data.componentOffsets)};d.prototype.getComponentAABB=function(a,b){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var c=0;6>c;c++)b[c]=this.componentAABB[6*a+c];return b};d.prototype._computeComponentAABB=function(){for(var a=this.getComponentCount(),b=new Float32Array(6*a),c=0;c<a;c++)this._calculateAABB(c,b,6*c);return b};d.prototype._calculateAABB=function(a,b,c){void 0===c&&(c=0);var d=this.data.getIndices(e.VertexAttrConstants.POSITION),
f=this.data.getAttribute(e.VertexAttrConstants.POSITION),h=this.data.componentOffsets,l=h.length?h[a+1]:d.length,g=Infinity,n=Infinity,t=Infinity,y=-Infinity,A=-Infinity,C=-Infinity,B=f.offsetIdx,r=f.strideIdx;for(a=h.length?h[a]:0;a<l;a++)var E=B+r*d[a],h=f.data[E],H=f.data[E+1],E=f.data[E+2],g=Math.min(g,h),n=Math.min(n,H),t=Math.min(t,E),y=Math.max(y,h),A=Math.max(A,H),C=Math.max(C,E);b?(b[c]=g,b[c+1]=n,b[c+2]=t,b[c+3]=y,b[c+4]=A,b[c+5]=C):b=[g,n,t,y,A,C];return b};d.prototype.calculateBoundingInfo=
function(){var a=this.data.getIndices(e.VertexAttrConstants.POSITION),b=this.data.getAttribute(e.VertexAttrConstants.POSITION),d="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(d),g=0;g<d;++g)a[g]=g;g=a.length;l.assert(0===g%d);g=c.generateDefaultIndexArray(g/d);return new f(g,d,a,b)};d.prototype.getBoundingInfo=function(){null==this.boundingInfo&&(this.boundingInfo=this.calculateBoundingInfo());return this.boundingInfo};d.prototype.invalidateBoundingInfo=function(){this.boundingInfo=
null};d.__idGen=new b;return d}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require","exports","./gl-matrix","./Util"],function(r,g,f,a){var c=f.vec3d;return function(){function b(b,e,d,f){a.assert(1<=b.length);a.assert(0===d.length%e);a.assert(d.length>=b.length*e);a.assert(3===f.size||4===f.size);this.primitiveIndices=b;this.indices=d;this._position=f;this._numIndexPerPrimitive=e;var h=f.data,l=f.offsetIdx;f=f.strideIdx;var g=b.length,k=l+f*d[e*b[0]];this.bbMin=c.createFrom(h[k],
h[k+1],h[k+2]);this.bbMax=c.create(this.bbMin);for(k=0;k<g;++k)for(var q=e*b[k],m=0;m<e;++m){var u=l+f*d[q+m];this.bbMin[0]=Math.min(h[u],this.bbMin[0]);this.bbMax[0]=Math.max(h[u],this.bbMax[0]);++u;this.bbMin[1]=Math.min(h[u],this.bbMin[1]);this.bbMax[1]=Math.max(h[u],this.bbMax[1]);++u;this.bbMin[2]=Math.min(h[u],this.bbMin[2]);this.bbMax[2]=Math.max(h[u],this.bbMax[2])}this.center=c.create();c.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],
this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);for(var x=this.bsRadius*this.bsRadius,k=0;k<g;++k)for(q=e*b[k],m=0;m<e;++m){var u=l+f*d[q+m],v=h[u]-this.center[0],y=h[u+1]-this.center[1],u=h[u+2]-this.center[2],A=v*v+y*y+u*u;if(!(A<=x)){var A=Math.sqrt(A),C=.5*(A-this.bsRadius);this.bsRadius+=C;x=this.bsRadius*this.bsRadius;A=C/A;this.center[0]+=v*A;this.center[1]+=y*A;this.center[2]+=u*A}}}b.prototype.getCenter=function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};
b.prototype.getBBMin=function(){return this.bbMin};b.prototype.getBBMax=function(){return this.bbMax};b.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};b.prototype.getIndices=function(){return this.indices};b.prototype.getPosition=function(){return this._position};b.prototype.getChildren=function(){if(this.children)return this.children;if(1<c.dist2(this.bbMin,this.bbMax)){for(var a=c.lerp(this.bbMin,this.bbMax,.5,c.create()),e=this.primitiveIndices.length,d=new Uint8Array(e),
f=Array(8),g=0;8>g;++g)f[g]=0;for(var g=this._position,t=g.data,p=g.offsetIdx,k=g.strideIdx,g=0;g<e;++g){for(var q=0,m=this._numIndexPerPrimitive*this.primitiveIndices[g],u=p+k*this.indices[m],x=t[u],v=t[u+1],y=t[u+2],A=1;A<this._numIndexPerPrimitive;++A){var u=p+k*this.indices[m+A],C=t[u],B=t[u+1],u=t[u+2];C<x&&(x=C);B<v&&(v=B);u<y&&(y=u)}x<a[0]&&(q|=1);v<a[1]&&(q|=2);y<a[2]&&(q|=4);d[g]=q;++f[q]}for(g=a=0;8>g;++g)0<f[g]&&++a;if(2>a)return;a=Array(8);for(g=0;8>g;++g)a[g]=0<f[g]?new Uint32Array(f[g]):
void 0;for(g=0;8>g;++g)f[g]=0;for(g=0;g<e;++g)q=d[g],a[q][f[q]++]=this.primitiveIndices[g];this.children=Array(8);for(g=0;8>g;++g)void 0!==a[g]&&(this.children[g]=new b(a[g],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory ../../support/PromiseLightweight".split(" "),function(r,g,
f,a,c,b){return function(b){function e(a,e,f){var d=b.call(this)||this;d.symbol=a;a=a.symbolLayers;f&&(a=f.concat(a));f=a.length;d.childGraphics3DSymbols=Array(a.length);d.childGraphics3DSymbolPromises=Array(a.length);for(var h=e.layerOrder,k=0,l=0,g=!1,n=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,l++);k--;!this.isRejected()&&g&&1>k&&(0<l?this.resolve():this.reject())},x=0;x<f;x++){var v=a.getItemAt(x);!1!==v.enabled&&(e.layerOrder=h+(1-(1+x)/f),e.layerOrderDelta=1/f,v=c.make(d.symbol,v,e,
v._ignoreDrivers))&&(k++,d.childGraphics3DSymbolPromises[x]=v,v.then(n.bind(d,x,v),n.bind(d,x,null)))}e.layerOrder=h;g=!0;!d.isRejected()&&1>k&&d.resolve();return d}f(e,b);e.prototype.createGraphics3DGraphic=function(b,c){for(var d=b.graphic,e=Array(this.childGraphics3DSymbols.length),f=0;f<this.childGraphics3DSymbols.length;f++){var h=this.childGraphics3DSymbols[f];h&&(e[f]=h.createGraphics3DGraphic(b))}return new a(d,c||this,e,b.layer)};e.prototype.layerPropertyChanged=function(a,b){for(var c=this.childGraphics3DSymbols.length,
d=function(c){var d=e.childGraphics3DSymbols[c],f=function(a){return a._graphics[c]};if(d&&!d.layerPropertyChanged(a,b,f))return{value:!1}},e=this,f=0;f<c;f++){var h=d(f);if("object"===typeof h)return h.value}return!0};e.prototype.applyRendererDiff=function(a,b,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(d,e,f){return d&&(!e||e.applyRendererDiff(a,b,c,f))},!0):!1};e.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(d){d&&
!d.isFulfilled()?a++:d&&d.isFastUpdatesEnabled()?c++:d&&b++});return{loading:a,slow:b,fast:c}};e.prototype.setDrawOrder=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=1/c,e=0;e<c;e++){var f=this.childGraphics3DSymbols[e];f&&f.setDrawOrder(a+(1-(1+e)/c),d,b)}};e.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy()};return e}(b.Promise)})},
"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(r,g,f,a,c,b,l,e,d,h,n){Object.defineProperty(g,"__esModule",{value:!0});var t=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");
g.make=function(a,b,c,d){var e=k[a.type]&&k[a.type][b.type]||p[b.type];return e?new e(a,b,c,d):(t.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var p={icon:c,object:e,line:b,path:d,fill:h,extrude:a,text:n},k={"mesh-3d":{fill:l}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/earcut/earcut ../../../../geometry/Point ../../../../geometry/Polygon ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y){function A(a,b,c,d,e,f,h,k,l,g,m,n,q,p){var t=c.length/3,u=0;m+=2*d.count;var A=d.index,v=d.count,y=l,x=m;E.set(q,L);var C=0<n?1:-1,A=3*A,r=y;q=3*r;for(var D=y+v,y=3*D,I=0;I<v;++I)p&&(L[0]=a[A+0],L[1]=a[A+1],L[2]=a[A+2],E.normalize(L)),e[q+0]=a[A+0],e[q+1]=a[A+1],e[q+2]=a[A+2],f[q+0]=b[A+0],f[q+1]=b[A+1],f[q+2]=b[A+2],h[q+0]=-C*L[0],h[q+1]=-C*L[1],h[q+2]=-C*L[2],k[r]=0,e[y+0]=a[A+0]+n*L[0],e[y+1]=a[A+1]+n*L[1],e[y+2]=a[A+2]+n*L[2],f[y+0]=b[A+0],f[y+
1]=b[A+1],f[y+2]=b[A+2],h[y+0]=C*L[0],h[y+1]=C*L[1],h[y+2]=C*L[2],k[D]=n,q+=3,y+=3,A+=3,r+=1,D+=1;A=0;q=3*x;y=3*(x+t);q=3*(x+t);y=3*x;a=G;b=P;0>n&&(a=P,b=G);for(I=0;I<t;++I)g[q+0]=c[A+a[0]],g[q+1]=c[A+a[1]],g[q+2]=c[A+a[2]],g[y+0]=c[A+b[0]]+v,g[y+1]=c[A+b[1]]+v,g[y+2]=c[A+b[2]]+v,q+=3,y+=3,A+=3;l+=2*d.count;m=m+2*t-(2*d.count+2*t);B(e,f,k,h,u,d.pathLengths[0],d.count,l,g,m,n);l+=4*d.pathLengths[0];m+=2*d.pathLengths[0];u+=d.pathLengths[0];for(c=1;c<d.pathLengths.length;++c)B(e,f,k,h,u,d.pathLengths[c],
d.count,l,g,m,n),l+=4*d.pathLengths[c],m+=2*d.pathLengths[c],u+=d.pathLengths[c]}function C(a,b,c,d,e,f,h){d[f]=d[h];h*=3;f*=3;a[f+0]=a[h+0];a[f+1]=a[h+1];a[f+2]=a[h+2];b[f+0]=b[h+0];b[f+1]=b[h+1];b[f+2]=b[h+2];c[f+0]=e[0];c[f+1]=e[1];c[f+2]=e[2]}function B(a,b,c,d,e,f,h,k,l,g,m){var n=e,q=e+1,p=e+h,t=e+h+1,u=k,A=k+1,v=k+2*f;k=k+2*f+1;0>m&&(n=e+h+1,t=e);g*=3;for(var y=0;y<f;++y){y===f-1&&(0<m?(q=e,t=e+h):(q=e,n=e+h));var x=a,B=n,r=q,D=p,I=O,B=3*B,r=3*r,D=3*D;E.set3(x[B++],x[B++],x[B++],aa);E.set3(x[r++],
x[r++],x[r++],V);E.set3(x[D++],x[D++],x[D++],N);E.subtract(V,aa,S);E.subtract(N,aa,W);E.cross(W,S,I);E.normalize(I,I);C(a,b,d,c,O,u,n);C(a,b,d,c,O,A,q);C(a,b,d,c,O,v,p);C(a,b,d,c,O,k,t);l[g++]=u;l[g++]=v;l[g++]=k;l[g++]=u;l[g++]=k;l[g++]=A;n++;q++;p++;t++;u+=2;A+=2;v+=2;k+=2}}var D=v.VertexAttrConstants,E=p.vec3d,H=p.mat4d,F=E.create(),L=E.create(),G=[0,2,1],P=[0,1,2],J=new c,M={verticalDistanceToGround:0,terrainElevation:0};r=function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;
a._edgeStageObjects=new Set;return a}f(h,c);h.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=n.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=E.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new y(c,a+"_3dlinemat");this._context.stage.add(q.ModelContentType.MATERIAL,
this._material);this.resolve()};h.prototype.destroy=function(){c.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(q.ModelContentType.MATERIAL,this._material.id)};h.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+c.type),null;if(!this._validateGeometry(c))return null;var c="polygon"===
c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b,Float32Array,255),f=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,e,f,d,a.uid)};h.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getMaterialOpacity();c=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:b,transparent:c});if(0<this._edgeStageObjects.size){var e=this._context.stage.view.getEdgeView(),f=this._getLayerOpacity();
this._edgeStageObjects.forEach(function(a){e.updateAllComponentOpacities(a,[f])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(var h in b){var k=b[h];if(a=c(k))k=this.getGraphicElevationContext(k.graphic),a.needsElevationUpdates=d.needsElevationUpdates3D(k.mode),a.elevationContext.set(k)}return!0}return!1};h.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?d.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};
h.prototype._getSymbolSize=function(){return this.symbol.size||1};h.prototype._createAs3DShape=function(c,f,h,g,n,q,p){var u=this,v=c.geometry;"extent"===v.type&&(v=b.fromExtent(v));c=v[f];var y=[],C=[],B=[],r=E.create(),I=Array(6),K=this._context.renderSpatialReference===k.SphericalECEFSpatialReference,w=this._getExtrusionSize(h),L=E.create();K||this._context.renderCoordsHelper.worldUpAtPosition(null,L);h=d.getGeometryVertexData3D(c,l.hasZ(v),v.spatialReference,this._context.renderSpatialReference,
this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(h,c,f,"ExtrudeSymbol3DLayer");if(0<c.length){var O=h.geometryData.polygons,Y=h.eleVertexData,G=h.vertexData;f=G.length/3;var T=new Float64Array(18*f),P=new Float64Array(18*f),ba=new Float64Array(18*f),aa=new Float64Array(6*f),R=0;f=function(b){var c=O[b],e=c.count,f=c.index;if(S._context.clippingExtent&&(d.computeBoundingBox(Y,f,e,I),d.boundingBoxClipped(I,S._context.clippingExtent)))return"continue";
var h=new Float64Array(Y.buffer,3*f*T.BYTES_PER_ELEMENT,3*e),k=c.holeIndices.map(function(a){return a-f}),h=a(h,k,3);if(0<h.length){d.chooseOrigin(G,f,e,r);var k=new Uint32Array(6*e+2*h.length),l=6*e,n=new Float64Array(T.buffer,3*R*T.BYTES_PER_ELEMENT,3*l),p=new Float64Array(P.buffer,3*R*P.BYTES_PER_ELEMENT,3*l),t=new Float64Array(ba.buffer,3*R*ba.BYTES_PER_ELEMENT,3*l),u=new Float64Array(aa.buffer,1*R*aa.BYTES_PER_ELEMENT,1*l);A(G,Y,h,c,n,t,p,u,0,k,0,w,L,K);d.subtractCoordinates(n,0,l,r);R+=6*e;
c=S._createExtrudeGeometry(k,{positions:n,elevation:t,normals:p,heights:u},g);b=new m(c,q+"path"+b);b.singleUse=!0;y.push(b);C.push([S._material]);b=H.identity();H.translate(b,r,b);B.push(b)}};var S=this;for(c=0;c<O.length;++c)f(c);if(0<y.length){p=new x({geometries:y,materials:C,transformations:B,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:p},idHint:q});var W=function(a){var b=u._context.stage.view.getEdgeView();if(b){b.removeObject(a);u._edgeStageObjects.delete(a);var c=t.createMaterial(b,
u.symbol,u._getLayerOpacity());c&&(u._edgeStageObjects.add(a),b.addObject(a,[c]))}};W(p);p=new e(this,p,y,null,null,function(a,b,c,e){var f=e.setAltitude;J.spatialReference=c.spatialReference;for(var h=a.getGeometryRecords(),k=h.length,l="absolute-height"!==b.mode,g=0,m=0;m<k;m++){var n=h[m].geometry,q=h[m].transformation,p=n.getData();Q[0]=q[12];Q[1]=q[13];Q[2]=q[14];n.invalidateBoundingInfo();for(var p=p.getVertexAttr(),n=p[D.POSITION].data,q=p[D.SIZE].data,p=p.mapPos.data,t=n.length/3,u=0,A=0,
v=!1,y=0,x=0;x<t;x++){J.x=p[A];J.y=p[A+1];J.z=p[A+2];X[0]=n[u];X[1]=n[u+1];X[2]=n[u+2];var C=d.computeElevation(c,J,b,e,l?M:null);l&&(y+=M.terrainElevation);F[0]=n[u]+Q[0];F[1]=n[u+1]+Q[1];F[2]=n[u+2]+Q[2];f(C+q[u/3],F);n[u]=F[0]-Q[0];n[u+1]=F[1]-Q[1];n[u+2]=F[2]-Q[2];C=.01/e.unitInMeters;if(Math.abs(X[0]-n[u])>C||Math.abs(X[1]-n[u+1])>C||Math.abs(X[2]-n[u+2])>C)v=!0;A+=3;u+=3}v&&a.geometryVertexAttrsUpdated(m);g+=y/t}b=g/k;W(a);return b},n);p.alignedTerrainElevation=h.terrainElevation;p.needsElevationUpdates=
d.needsElevationUpdates3D(n.mode);return p}}return null};h.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[D.POSITION]=a;d[D.NORMAL]=a;d[D.COLOR]=e;f[D.POSITION]={size:3,data:b.positions};f[D.NORMAL]={size:3,data:b.normals};f[D.COLOR]={size:4,data:c};f[D.SIZE]={size:1,data:b.heights};b.elevation&&(f.mapPos={size:3,data:b.elevation},d.mapPos=a);return new u(f,d)};return h}(h);var O=E.create(),aa=E.create(),V=E.create(),N=E.create(),
S=E.create(),W=E.create(),X=E.create(),Q=E.create();return r})},"esri/views/3d/layers/support/edgeUtils":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.createMaterial=function(c,b,l){b=b&&b.enabled&&b.edges;if(!b)return null;var e=f.toUnitRGBA(b.color);switch(b.type){case "solid":return c.createSolidEdgeMaterial({color:e,size:a.pt2px(b.size),extensionLength:a.pt2px(b.extensionLength),opacity:l});
case "sketch":return c.createSketchEdgeMaterial({color:e,size:a.pt2px(b.size),extensionLength:a.pt2px(b.extensionLength),opacity:l})}}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/when dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/Error ../../../../core/screenUtils ../../../../core/sniff ../../../../core/urlUtils ../../../../symbols/support/symbolUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./SignedDistanceFunctions ../support/FastSymbolUpdates ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L){function G(a){return"cross"===a||"x"===a}function P(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case X.PRIM_CIRCLE:b=v.computeSignedDistancefieldCicle(128,64);break;case X.PRIM_SQUARE:b=v.computeSignedDistancefieldSquare(128,64,!1);break;case X.PRIM_KITE:b=v.computeSignedDistancefieldSquare(128,64,!0);break;case X.PRIM_CROSS:b=v.computeSignedDistancefieldCrossAndX(128,64,!1);break;case X.PRIM_X:b=v.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new F(b,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var J=A.vec3d;r=A.vec4d;var M=A.mat4d.identity(),O=[0,0,1],aa=[0,0,0,0],V=[0,0,0],N=[1,1,1],S="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),W=[.25,.25,.75,.75],X={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},Q=[64,64];u=function(g){function u(){var a=null!==g&&g.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!0};return a}f(u,g);u.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?d.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var c=this._getStageIdHint();if(!this._isPropertyDriven("size")){var e=x.validateSymbolLayerSize(b);if(e){this._logWarning(e);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var f=a.resource||{primitive:"circle",href:void 0},e={anchorPos:this._getAnchorPos(a)},h=this.symbolContainer;
if(this._hasVisibleVerticalOffset(h)){var h=h.verticalOffset,k=h.minWorldLength,l=h.maxWorldLength;e.verticalOffset={screenLength:d.pt2px(h.screenLength),minWorldLength:k||0,maxWorldLength:null!=l?l:Infinity}}this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);f.href?(this._outlineSize=this._getOutlineSize(a,null),e.color=this._getFillColor(a,null),e.outlineColor=this._getOutlineColor(a),e.outlineSize=this._outlineSize,
e.textureIsSignedDistanceField=!1,this._prepareImageResources(b,e,c)):(f=f.primitive||"circle",h="primitive:"+f,this._primitive=f,this._outlineSize=this._getOutlineSize(a,f),e.color=this._getFillColor(a,f),e.outlineColor=this._getOutlineColor(a),e.outlineSize=this._outlineSize,G(f)&&0===e.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(h,P),this._textureURI=h,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=W,e.textureId=this.texture.id,this._size=
[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(e,this._context.stage,c),this.resolve()))};u.prototype._getOutlineSize=function(a,b){var c=0,c=a.outline&&null!=a.outline.size?d.pt2px(a.outline.size):G(b)?1.5:0;return Math.max(c,0)};u.prototype._getOutlineColor=function(a){var b=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var c=l.toUnitRGB(a.outline.color);return[c[0],c[1],c[2],a.outline.color.a*b]}return[0,0,0,b]};u.prototype._getFillColor=function(a,b){return G(b)?
aa:this._getMaterialOpacityAndColor()};u.prototype._getAnchorPos=function(a){return-1<S.indexOf(a.anchor)?a.anchor:"center"};u.prototype._prepareImageResources=function(c,d,f){var k=this,l=t.getIconHref(this.symbolContainer,this.symbol);!h("esri-canvas-svg-support")&&n.isSVG(l)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new e("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(a(this._context.sharedResources.textures.acquire(l,
null,c),function(a){if(!k.isRejected()){var b=a.params,e=b.width/b.height;k._size=c?1<e?[c,Math.round(c/e)]:[Math.round(c*e),c]:[b.width,b.height];d.textureId=a.id;k._createMaterialsAndAddToStage(d,k._context.stage,f);k.resolve()}},function(a){a instanceof b?k.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+l+")",k._logWarning(a),k.reject(new e("Request Failed",a)))}),this._textureURI=l)};u.prototype._createMaterialsAndAddToStage=function(a,b,d){this._fastUpdates=
y.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&c.mixin(a,this._fastUpdates.materialParameters);var e=c.mixin({},a);e.verticalOffset=null;e.screenSizePerspective=null;e.occlusionTest=!1;e.shaderPolygonOffset=0;this._drapedMaterial=new L(e,d+"_iconDraped");b.add(B.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;this._material=new L(a,d+"_icon");b.add(B.ModelContentType.MATERIAL,
this._material)};u.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(B.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(B.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};u.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&
a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=d.pt2px(c))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};u.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;if(!this._validateGeometry(a.geometry))return null;var c=m.placePointOnGeometry(a.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+
a.geometry.type),null;var d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b),f=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(f=this._getScaleFactor(b));f*=this._symbolTextureRatio;b=[this._size[0]*f,this._size[1]*f];f=this.getGraphicElevationContext(a);return"on-the-ground"===f.mode?this._createAsOverlay(a,c,e,b,f,d,a.uid):this._createAs3DShape(a,c,e,b,f,d,a.uid)};u.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),
this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=m.needsElevationUpdates2D(d)||
"absolute-height"===d;for(var e in b){var f=b[e];(d=c(f))&&"object3d"===d.type&&(f=this.getGraphicElevationContext(f.graphic),d.needsElevationUpdates=a,d.elevationContext.set(f))}return!0}return!1};u.prototype.applyRendererDiff=function(a,b,c,d){for(var e in a.diff)switch(e){case "visualVariables":if(y.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);
else return!1;break;default:return!1}return!0};u.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,c.add(this._drapedMaterial.id))};u.prototype._defaultElevationInfoNoZ=function(){return I};u.prototype._createAs3DShape=function(a,b,c,d,e,f,h){var k=this,l=this._getFastUpdateAttrValues(a);a=l?function(a){return y.evaluateModelTransform(k._fastUpdates.materialParameters,l,a)}:null;c=E.createPointGeometry(O,null,c,d,K,
null,l);c=[new D(c,f)];f=m.createStageObjectForPoint.call(this,b,c,[[this._material]],null,null,e,f,this._context.layer.uid,h,!0,a);if(null===f)return null;var g=new q(this,f.object,c,null,null,p.perObjectElevationAligner,e);g.alignedTerrainElevation=f.terrainElevation;g.needsElevationUpdates=m.needsElevationUpdates2D(e.mode)||"absolute-height"===e.mode;g.getScreenSize=this._createScreenSizeGetter(d,a);g.calculateRelativeScreenBounds=function(a){return k._material.calculateRelativeScreenBounds(g.getScreenSize(),
1,a)};m.extendPointGraphicElevationContext(g,b,this._context.elevationProvider);return g};u.prototype._createAsOverlay=function(a,b,c,d,e,f,h){var l=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;e=J.create();C.pointToVector(b,e,this._context.overlaySR);e[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!m.pointInBox2D(e,b))return null;var g=this._getFastUpdateAttrValues(a);a=g?function(a){return y.evaluateModelTransform(l._fastUpdates.materialParameters,g,a)}:null;c=E.createPointGeometry(O,
e,c,d,null,null,g);b=new H(c);b.material=this._drapedMaterial;b.center=e;b.bsRadius=0;b.transformation=M;b.name=f;b.uniqueName=f+"#"+c.id;var n=new k(this,[b],null);n.getScreenSize=this._createScreenSizeGetter(d,a);n.calculateRelativeScreenBounds=function(a){return l._drapedMaterial.calculateRelativeScreenBounds(n.getScreenSize(),1,a)};return n};u.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;
return function(a){void 0===a&&(a=Array(2));var f=b(M);a[0]=f[0]*d+c;a[1]=f[5]*e+c;return a}}var f=a[0]/this._symbolTextureRatio+c,h=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=Array(2));a[0]=f;a[1]=h;return a}};u.prototype._supportsShaderVisualVariables=function(){return!0};u.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],c=d.px2pt(1),a=a*c;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:c,transformation:{anchor:V,
scale:N,rotation:V}}};u.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};u.PRIMITIVE_SIZE=Q;u.VALID_ANCHOR_STRINGS=S;return u}(u);var I={mode:"relative-to-ground",offset:0},K=r.createFrom(0,0,0,1);return u})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.isVolumetricSymbol=
function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};g.getIconHref=function(c,b){b=b.resource.href;return!f("esri-canvas-svg-support")&&c.styleOrigin&&a.test(b)?b.replace(a,"/resource/png/$1.png"):b};var a=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(r,g,f,a,c,b,l,e){r=function(){function f(a,b,c){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}f.prototype.initialize=function(a,b){this.stage=b};f.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),!0):
!1};f.prototype.destroy=function(){if(this.stage){var a=this.stage;this._visible&&a.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null}};f.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};f.prototype.getCenterObjectSpace=function(){return[0,0,0]};f.prototype.addHighlight=function(a,b){var c=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(d){var e=
c.addRenderGeometryHighlight(d,b);a.addRenderGeometry(d,c,e)})};f.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};f.prototype.getProjectedBoundingBox=function(f,h,l,g){return c(this,void 0,void 0,function(){var c,k,m,q;return a(this,function(a){switch(a.label){case 0:b.empty(l);for(c=0;c<this.renderGeometries.length;c++)k=this.renderGeometries[c],this._getRenderGeometryProjectedBoundingRect(k,d,f,g),b.expand(l,d);if(!h)return[3,5];b.center(l,
n);m=void 0;q=e.demResolutionForBoundingBox(l,h);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,h.service.queryElevation(n[0],n[1],q)];case 2:return m=a.sent(),[3,4];case 3:return a.sent(),m=null,[3,4];case 4:null!=m&&(l[2]=Math.min(l[2],m),l[5]=Math.max(l[5],m)),a.label=5;case 5:return[2,l]}})})};f.prototype._getRenderGeometryProjectedBoundingRect=function(a,c,d,e){if(this.boundingBox)b.set(h,this.boundingBox);else{var f=a.center;a=a.bsRadius;h[0]=f[0]-a;h[1]=f[1]-a;h[2]=f[2]-a;h[3]=f[0]+a;h[4]=
f[1]+a;h[5]=f[2]+a}d(h,0,2);this.calculateRelativeScreenBounds&&e.push({location:b.center(h),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return b.toRect(h,c)};return f}();var d=l.create(),h=b.create(),n=[0,0,0];return r})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.computeSignedDistancefieldCicle=function(a,c){var b=new Uint8Array(4*
a*a),l=a/2-.5;c/=2;for(var e=0;e<a;e++)for(var d=0;d<a;d++){var h=d+a*e,g=d-l,t=e-l,g=Math.sqrt(g*g+t*t)-c,g=g/a+.5;f.packFloatRGBA(g,b,4*h)}return b};g.computeSignedDistancefieldSquare=function(a,c,b){b&&(c/=Math.SQRT2);for(var l=new Uint8Array(4*a*a),e=0;e<a;e++)for(var d=0;d<a;d++){var h=d-.5*(a-.5),g=e-.5*(a-.5),t=e*a+d;if(b)var p=(h+g)/Math.SQRT2,g=(g-h)/Math.SQRT2,h=p;h=Math.max(Math.abs(h),Math.abs(g))-.5*c;h=h/a+.5;f.packFloatRGBA(h,l,4*t)}return l};g.computeSignedDistancefieldCrossAndX=function(a,
c,b){b&&(c*=Math.SQRT2);c*=.5;for(var l=new Uint8Array(4*a*a),e=0;e<a;e++)for(var d=0;d<a;d++){var h=d-.5*a,g=e-.5*a,t=e*a+d;if(b)var p=(h+g)/Math.SQRT2,g=(g-h)/Math.SQRT2,h=p;p=void 0;h=Math.abs(h);g=Math.abs(g);p=h>g?h>c?Math.sqrt((h-c)*(h-c)+g*g):g:g>c?Math.sqrt(h*h+(g-c)*(g-c)):h;p=p/a+.5;f.packFloatRGBA(p,l,4*t)}return l}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../graphics/graphicUtils","../../lib/glMatrix"],
function(r,g,f,a,c){function b(a){return null!==a&&void 0!==a}function l(a){return"number"===typeof a}function e(a,b){a&&a.push(b)}function d(a,c,d,k,g){var m=a.minSize,n=a.maxSize;if(a.expression)return e(g,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=k.symbolSize[d],c.minSize[d]=a,c.maxSize[d]=a,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(b(a.field)){if(b(a.stops)){if(2===a.stops.length&&l(a.stops[0].size)&&l(a.stops[1].size))return h(a.stops[0].size,
a.stops[1].size,a.stops[0].value,a.stops[1].value,c,d),c.type[d]=1,!0;e(g,"Could not convert size info: stops only supported with 2 elements");return!1}if(l(m)&&l(n)&&b(a.minDataValue)&&b(a.maxDataValue))return h(m,n,a.minDataValue,a.maxDataValue,c,d),c.type[d]=1,!0;if(null!=f.meterIn[a.valueUnit])return c.minSize[d]=-Infinity,c.maxSize[d]=Infinity,c.offset[d]=0,c.factor[d]=1/f.meterIn[a.valueUnit],c.type[d]=1,!0;"unknown"===a.valueUnit?e(g,"Could not convert size info: proportional size not supported"):
e(g,"Could not convert size info: scale-dependent size not supported");return!1}if(!b(a.field)){if(a.stops&&a.stops[0]&&l(a.stops[0].size))return c.minSize[d]=a.stops[0].size,c.maxSize[d]=a.stops[0].size,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(l(m))return c.minSize[d]=m,c.maxSize[d]=m,c.offset[d]=m,c.factor[d]=0,c.type[d]=1,!0}e(g,"Could not convert size info: unsupported variant of sizeInfo");return!1}function h(a,b,c,d,e,f){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[f]=0<d?a:b;e.maxSize[f]=
0<d?b:a;e.offset[f]=a-c*d;e.factor[f]=d}function n(a,b,c,f){if(a.normalizationField||a.valueRepresentation)return e(f,"Could not convert size info: unsupported property"),null;var h=a.field;if(null!=h&&"string"!==typeof h)return e(f,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return e(f,"Could not convert size info: multiple fields in use"),
null;switch(a.axis){case "width":return(h=d(a,b.size,0,c,f))?b:null;case "height":return(h=d(a,b.size,2,c,f))?b:null;case "depth":return(h=d(a,b.size,1,c,f))?b:null;case "width-and-depth":return(h=d(a,b.size,0,c,f))&&d(a,b.size,1,c,f),h?b:null;case null:case void 0:case "all":return(h=(h=(h=d(a,b.size,0,c,f))&&d(a,b.size,1,c,f))&&d(a,b.size,2,c,f))?b:null;default:return e(f,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function t(a,b,c){for(var d=0;3>d;++d){var f=b.unitInMeters;
1===a.type[d]&&(f*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=f;a.maxSize[d]/=f;a.offset[d]/=f;a.factor[d]/=f}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return e(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function p(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function k(a,
c,d){if(a.normalizationField)return e(d,"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return e(d,"Could not convert color info: too many color stops"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(d=0;8>d;++d){var f=a[Math.min(d,a.length-1)];c.color.values[d]=f.value;p(c.color.colors,d,f.color)}}else if(a.colors){if(!b(a.minDataValue)||
!b(a.maxDataValue))return e(d,"Could not convert color info: missing data values"),null;if(2!==a.colors.length)return e(d,"Could not convert color info: invalid colors array"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c.color.values[0]=a.minDataValue;p(c.color.colors,0,a.colors[0]);c.color.values[1]=a.maxDataValue;p(c.color.colors,1,a.colors[1]);for(d=2;8>d;++d)c.color.values[d]=a.maxDataValue,p(c.color.colors,d,
a.colors[1])}else return e(d,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},d=0;8>d;d++)c.color.values[d]=Infinity,p(c.color.colors,d,a);else return e(d,"Could not convert color info: no field and no colors/stops"),null;return c}function q(a,
b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function m(a,b,c){if("string"!==typeof a.field)return e(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return e(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return q(a,
b.rotation,0,c),b;case "roll":return q(a,b.rotation,1,c),b;case null:case void 0:case "heading":return q(a,b.rotation,2,c),b;default:return e(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function u(a,b,c){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,f=!b.supportedTypes||!!b.supportedTypes.color,h=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,l){if(!a)return a;if(l.valueExpression)return e(c,"Could not convert visual variables: arcade expressions not supported"),
null;switch(l.type){case "size":return d?n(l,a,b,c):a;case "color":return f?k(l,a,c):a;case "rotation":return h?m(l,a,c):a;default:return e(c,"Could not convert visual variables: unsupported type "+l.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!t(a.size,b,c)?null:a}function x(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function v(a,b){var c=
{vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);
a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors);return c}Object.defineProperty(g,"__esModule",{value:!0});g.convertVisualVariables=u;g.initFastSymbolUpdatesState=function(a,b,c){return b&&a&&!a.disableFastUpdates?(a=u(a.visualVariables,c))?{enabled:!0,visualVariables:a,materialParameters:v(a,c),customTransformation:a&&null!=a.size}:{enabled:!1}:{enabled:!1}};g.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;
b=u(b.visualVariables,c);if(!(b&&x(d.size,b.size,"size")&&x(d.color,b.color,"color")&&x(d.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=v(b,c);a.customTransformation=b&&null!=b.size;return!0};g.getMaterialParams=v;var y;(function(b){var d=c.mat4d,e=c.vec3,f=d.create(),h=e.create();b.evaluateModelTransform=function(b,c,e){if(!b.vvSizeEnabled)return e;d.set(e,f);a.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],f);if(b.vvSizeEnabled){for(e=
0;3>e;++e){var k=b.vvSizeOffset[e]+c[0]*b.vvSizeFactor[e],l=e;var g=b.vvSizeMinSize[e],m=b.vvSizeMaxSize[e],k=k<g?g:k>m?m:k;h[l]=k}d.scale(f,h,f)}else d.scale(f,b.vvSizeValue,f);d.translate(f,b.vvSymbolAnchor,f);return f}})(y||(y={}));g.evaluateModelTransform=y.evaluateModelTransform})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){var y=q.vec3d,A=q.mat4d;return function(g){function q(){return null!==g&&g.apply(this,arguments)||this}f(q,g);q.prototype._prepareResources=function(){var a=this.symbol,b=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),a={idHint:this._getStageIdHint(),width:this._getWidth(a),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var c=p.validateSymbolLayerSize(a.width);if(c){this._logWarning(c);
this.reject();return}}if(b||1.5<=a.width)this._isPropertyDriven("size")&&(a.width=0),this._material=k.createRibbonMaterial(a);else if(0<a.width)this._material=k.createNativeMaterial(a);else{this.reject();return}this._context.stage.add(m.ModelContentType.MATERIAL,this._material);this.resolve()};q.prototype._getWidth=function(b){return null!=b.size?a.pt2px(b.size):1};q.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(m.ModelContentType.MATERIAL,
this._material.id),this._material=null)};q.prototype.createGraphics3DGraphic=function(b){var c=b.renderingInfo;b=b.graphic;var d=b.geometry;if("polyline"!==d.type&&"polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for line symbol: "+d.type),null;if(!this._validateGeometry(d))return null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",e="graphic"+b.uid,f=this._getVertexOpacityAndColor(c,Float32Array,255),h=0;c.size&&this._isPropertyDriven("size")&&
(h=n.getSingleSizeDriver(c.size),h=a.pt2px(h));c=this.getGraphicElevationContext(b);return"on-the-ground"===c.mode?this._createAsOverlay(b,d,f,h,c,e):this._createAs3DShape(b,d,f,h,c,e,b.uid)};q.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),this._material.setColor([b[0],b[1],b[2],this._getMaterialOpacity()]),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==
d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=n.needsElevationUpdates2D(d);for(var e in b){var f=b[e];(d=c(f))&&"object3d"===d.type&&(f=f.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(f)))}return!0}return!1};q.prototype._getOutlineGeometry=function(a,b){return b};q.prototype._getGeometry=function(a){a=a.geometry;"extent"===a.type&&(a=c.fromExtent(a));return a};q.prototype._createAs3DShape=
function(a,b,c,d,f,g,m){var q=this._getGeometry(a),p=q[b],t=this._getOutlineGeometry(q,p);a=[];var v=[],C=[],r=y.create(),B=Array(6),q=n.getGeometryVertexData3D(t,l.hasZ(q),q.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(q,p,b,"LineSymbol3DLayer");if(0<t.length){for(var p=q.geometryData.outlines,t=q.eleVertexData,D=q.vertexData,F=0;F<p.length;++F){var E=p[F];if(!(1>=E.count)){var I=E.index,
K=E.count;if(this._context.clippingExtent&&(n.computeBoundingBox(t,I,K,B),n.boundingBoxClipped(B,this._context.clippingExtent)))continue;n.chooseOrigin(D,I,K,r);n.subtractCoordinates(D,I,K,r);E=new Float64Array(t.buffer,3*I*t.BYTES_PER_ELEMENT,3*K);I=new Float64Array(D.buffer,3*I*D.BYTES_PER_ELEMENT,3*K);I=k.createPolylineGeometry(I,E,"rings"===b,c,d);I=new u(I,g+"path"+F);I.singleUse=!0;a.push(I);v.push([this._material]);I=A.identity();A.translate(I,r,I);C.push(I)}}if(0<a.length)return b=new x({geometries:a,
materials:v,transformations:C,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:m},idHint:g}),b=new h(this,b,a,null,null,e.perVertexElevationAligner,f),b.alignedTerrainElevation=q.terrainElevation,b.needsElevationUpdates=n.needsElevationUpdates2D(f.mode),b}return null};q.prototype._createAsOverlay=function(a,c,e,f,h,l){var g=this._getGeometry(a);this._material.renderPriority=this._symbolLayerOrder;var m=g[c],q=this._getOutlineGeometry(g,m);a=[];h=Array(6);var p=b.empty(),u=y.create(),
g=n.getGeometryVertexDataDraped(q,g.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(g,m,c,"LineSymbol3DLayer");if(0<q.length){m=g.vertexData;q=g.geometryData.outlines;for(g=0;g<q.length;++g){var t=q[g],x=t.index,t=t.count;n.computeBoundingBox(m,x,t,h);if(!n.boundingBoxClipped(h,this._context.clippingExtent)){b.expand(p,h);n.chooseOrigin(m,x,t,u);n.subtractCoordinates(m,x,t,u);n.setZ(m,x,t,this._getDrapedZ());t=new Float64Array(m.buffer,3*x*m.BYTES_PER_ELEMENT,3*t);x=A.identity();
A.translate(x,u,x);var t=k.createPolylineGeometry(t,null,"rings"===c,e,f),C=new v(t);C.material=this._material;C.center=[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0];C.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]));C.transformation=x;C.name=l;C.uniqueName=l+"#"+t.id;a.push(C)}}return new d(this,a,p)}return null};return q}(t)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(r,g,f,a,c,b){function l(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(g,"__esModule",{value:!0});var e=a.VertexAttrConstants;g.createRibbonMaterial=function(a){var c={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0};"miter"===a.join||"bevel"===a.join?c.join=a.join:(c.join="miter",a.join&&console.warn("unsupported join type for line symbol: "+a.join));return new b(c,a.idHint+"_ribbonlinemat")};g.createNativeMaterial=function(a){return new c({color:a.color},
a.idHint+"_nativelinemat")};g.isClosed=l;g.createPolylineGeometry=function(a,b,c,g,p){var d,h,m;if(c=c&&!l(a)){c=new Float32Array(a.length+3);for(h=0;h<a.length;h++)c[h]=a[h];h=c.length;c[h-3]=a[0];c[h-2]=a[1];c[h-1]=a[2];d=a.length/3+1;h=new Uint32Array(2*(d-1));m=new Uint32Array(2*(d-1))}else d=a.length/3,h=new Uint32Array(2*(d-1)),m=new Uint32Array(2*(d-1)),c=a;a=new Float32Array(1);a[0]=p;for(var n=p=0,t=0;t<d-1;t++)h[p++]=t,h[p++]=t+1,m[n++]=0,m[n++]=0;p={};d={};p[e.POSITION]=h;p[e.COLOR]=m;
p[e.SIZE]=m;d[e.POSITION]={size:3,data:c,offsetIdx:0,strideIdx:3};d[e.COLOR]={size:4,data:g,offsetIdx:0,strideIdx:4};d[e.SIZE]={size:1,data:a,offsetIdx:0,strideIdx:1};b&&(p.mapPos=h,d.mapPos={size:3,data:b,offsetIdx:0,strideIdx:3});return new f(d,p,f.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../support/geometryUtils ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){var q=t.VertexAttrConstants,m=l.Pos3,u=k.getStride(m)/4,x={color:[1,1,1,1]},v=a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");r=function(a){function d(b,c){c=a.call(this,c)||this;c.params=p.copyParameters(b,x);c.canBeMerged=!0;return c}f(d,a);d.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};d.prototype.getColor=function(){return this.params.color};d.prototype.getParameterValues=function(){return{color:this.params.color}};
d.prototype.getOutputAmount=function(a){return a*u};d.prototype.getInstanceBufferLayout=function(){};d.prototype.getVertexBufferLayout=function(){return m};d.prototype.fillInterleaved=function(a,b,c,d,e,f,h){c=a.vertexAttr[q.POSITION].data;if(b)for(h=c,c=S,d=0;d<h.length;d+=3){var k=h[d],l=h[d+1],g=h[d+2];c[d]=b[0]*k+b[4]*l+b[8]*g+b[12];c[d+1]=b[1]*k+b[5]*l+b[9]*g+b[13];c[d+2]=b[2]*k+b[6]*l+b[10]*g+b[14]}a=a.indices[q.POSITION];for(d=0;d<a.length;d++)b=3*a[d],e[f++]=c[b],e[f++]=c[b+1],e[f++]=c[b+
2]};d.prototype.intersect=function(a,d,f,h,k,l,g,m){if(h.isSelection&&!b.isAllHidden(d.componentVisibilities,a.data.componentOffsets))if(t.isTranslationMatrix(f)){d=a.getData().getVertexAttr().position.data;k=h.camera;l=h.point;e.vec3d.set3(l[0]-2,l[1]+2,0,J[0]);e.vec3d.set3(l[0]+2,l[1]+2,0,J[1]);e.vec3d.set3(l[0]+2,l[1]-2,0,J[2]);e.vec3d.set3(l[0]-2,l[1]-2,0,J[3]);for(m=0;4>m;m++)k.unprojectPoint(J[m],M[m]);c.plane.fromPoints(k.eye,M[0],M[1],O);c.plane.fromPoints(k.eye,M[1],M[2],aa);c.plane.fromPoints(k.eye,
M[2],M[3],V);c.plane.fromPoints(k.eye,M[3],M[0],N);a=Number.MAX_VALUE;for(m=0;m<d.length-5;m+=3)if(C[0]=d[m]+f[12],C[1]=d[m+1]+f[13],C[2]=d[m+2]+f[14],B[0]=d[m+3]+f[12],B[1]=d[m+4]+f[13],B[2]=d[m+5]+f[14],!(0>c.plane.distance(O,C)&&0>c.plane.distance(O,B)||0>c.plane.distance(aa,C)&&0>c.plane.distance(aa,B)||0>c.plane.distance(V,C)&&0>c.plane.distance(V,B)||0>c.plane.distance(N,C)&&0>c.plane.distance(N,B))){k.projectPoint(C,H);k.projectPoint(B,F);if(0>H[2]&&0<F[2]){e.vec3d.subtract(C,B,D);var n=k.frustumPlanes,
q=-c.plane.distance(n[4],C),n=q/e.vec3d.dot(D,n[4]);e.vec3d.scale(D,n,D);e.vec3d.add(C,D,C);k.projectPoint(C,H)}else if(0<H[2]&&0>F[2])e.vec3d.subtract(B,C,D),n=k.frustumPlanes,q=-c.plane.distance(n[4],B),n=q/e.vec3d.dot(D,n[4]),e.vec3d.scale(D,n,D),e.vec3d.add(B,D,B),k.projectPoint(B,F);else if(0>H[2]&&0>F[2])continue;n=t.pointLineSegmentDistanceSquared2D(H,F,l);n<a&&(a=n,e.vec3d.set(C,L),e.vec3d.set(B,G))}f=h.p0;h=h.p1;4>a&&(a=t.lineLineDistanceSquared3D(L,G,f,h,P),d=Number.MAX_VALUE,a.success&&
(e.vec3d.subtract(a.pa,f,E),a=e.vec3d.length(E),e.vec3d.scale(E,1/a),d=a/e.vec3d.dist(f,h)),g(d,E))}else v.error("intersection assumes a translation-only matrix")};d.prototype.getGLMaterials=function(){return{color:y,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:A}};d.prototype.getAllTextureIds=function(){return[]};return d}(h);var y=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.program=c.get("simple");b.updateParameters();return b}f(b,a);b.prototype.updateParameters=function(){this.params=
this.material.getParameterValues()};b.prototype.beginSlot=function(a){return a===n.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("color",c.color);a.setBlendingEnabled(1>c.color[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){1>this.params.color[3]&&a.setBlendingEnabled(!1)};
b.prototype.bindView=function(a,b){p.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.LINES};return b}(d),A=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.program=c.get("highlight");return b}f(b,a);b.prototype.updateParameters=function(){};b.prototype.beginSlot=function(a){return a===n.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};
b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){p.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.LINES};return b}(d),C=e.vec3d.create(),B=e.vec3d.create(),D=e.vec3d.create(),E=e.vec3d.create(),H=e.vec3d.create(),F=e.vec3d.create(),L=e.vec3d.create(),G=e.vec3d.create(),
P={success:!1,dist2:0,pa:e.vec3d.create(),pb:e.vec3d.create()},J=[e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create()],M=[e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create()],O=c.plane.create(),aa=c.plane.create(),V=c.plane.create(),N=c.plane.create(),S=[];return r})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../lib/glMatrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E){var H=B.VertexAttrConstants;r=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};return a}f(c,b);c.prototype._prepareResources=function(){m.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new E({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new E({color:[0,1,1,1]},"debugFAceNormal"));this.resolve()};c.prototype.destroy=function(){b.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(x.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(x.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};c.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("mesh"!==b.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;
var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};c.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getLayerOpacity();for(var d in this._materials){c=this._materials[d];c.material.setParameterValues({layerOpacity:b});var e=c.material.getParameterValues();this._setMaterialTransparentParameter(e);c.material.setParameterValues({transparent:e.transparent})}if(0<this._edgeStageObjects.size){var f=this._context.stage.view.getEdgeView(),
h=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){f.updateAllComponentOpacities(a,[h])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(e in b)if(a=b[e],d=c(a))a=this.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=n.needsElevationUpdates3D(a.mode),d.elevationContext.set(a);return!0}return!1};c.prototype._requiresVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};c.prototype._colorUid=function(a){a=
a.material&&a.material.color;if(!a)return"-";if(a)switch(a.type){case "value":return a.value.toHex();case "image":return a.uid}};c.prototype._materialProperties=function(a,b){a=this._requiresVertexColors();var c=b.material&&b.material.color;b=this._colorUid(b);return{hasVertexColors:a,color:c,uid:"vc:"+a+",cmuid:"+b}};c.prototype._setInternalColorValueParameters=function(b,c){c.diffuse=a.toUnitRGB(b.value);c.opacity=b.value.a};c.prototype._setInternalColorImageParameters=function(a,b,c){var d=a.url;
if(d){var e=this._textures[a.uid];e||(e=new C(d,b+"_"+a.uid+"_tex",{mipmap:!0,wrapClamp:!1,noUnpackFlip:!0}),this._textures[a.uid]=e,this._context.stage.add(x.ModelContentType.TEXTURE,e));c.textureId=e.id}};c.prototype._setInternalMaterialParameters=function(a,b,c){if(a=a.material&&a.material.color)switch(a.type){case "value":this._setInternalColorValueParameters(a,c);break;case "image":this._setInternalColorImageParameters(a,b,c)}};c.prototype._setExternalMaterialParameters=function(b){if(this._isPropertyDriven("color"))b.externalColor=
L;else{var c=this.symbol.material?a.toUnitRGBA(this.symbol.material.color):L;b.externalColor=c}if(c=this.symbol.material&&this.symbol.material.colorMixMode)b.colorMixMode=c};c.prototype._getOrCreateMaterial=function(a,b){a=this._materialProperties(a,b);var c=this._materials[a.uid];if(c)return c.material;var c=this._getStageIdHint(),d={specular:G,symbolColors:a.hasVertexColors,ambient:G,diffuse:F,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity()};
this._setInternalMaterialParameters(b,c,d);this._setExternalMaterialParameters(d);this._setMaterialTransparentParameter(d);c=new D(d,c+"_"+a.uid+"_mat");b=b.material&&b.material.color&&"value"===b.material.color.type&&b.material.color.value;this._materials[a.uid]={geometryOpacity:b?b.a:1,material:c};this._context.stage.add(x.ModelContentType.MATERIAL,c);return c};c.prototype._setMaterialTransparentParameter=function(a){this._isPropertyDriven("opacity")&&(a.transparent=!0);a.transparent=1>a.layerOpacity||
1>a.opacity||a.externalColor&&1>a.externalColor[3]};c.prototype._addDebugNormals=function(a,b,c,d){var e=b.length,f=a.spatialReference.isWGS84?20015077/180:1,h=.1*Math.max(a.extent.width*f,a.extent.height*f,a.extent.zmax-a.extent.zmin),k=[],l=[];a=[];for(var f=[],g=0;g<e;g++)for(var m=b[g],n=m.data.getAttribute(H.POSITION),p=m.data.getAttribute(H.NORMAL),t=m.data.getIndices(H.POSITION),m=m.data.getIndices(H.NORMAL),n=n.data,p=p.data,u=0;u<t.length;u++){for(var A=3*t[u],x=3*m[u],C=0;3>C;C++)k.push(n[A+
C]);for(C=0;3>C;C++)k.push(n[A+C]+p[x+C]*h);l.push(l.length);l.push(l.length);if(0===u%3){this._calculateFaceNormal(n,t,u,aa);this._getFaceVertices(n,t,u,J,M,O);q.vec3d.add(J,M);q.vec3d.add(J,O);q.vec3d.scale(J,1/3);for(C=0;3>C;C++)a.push(J[C]);for(C=0;3>C;C++)a.push(J[C]+aa[C]*h);f.push(f.length);f.push(f.length)}}e=(r={},r[H.POSITION]={data:new Float64Array(k),size:3},r);r=(B={},B[H.POSITION]=new Uint32Array(l),B);B=new y(e,r,void 0,"line");B=new v(B,"debugVertexNormal");B.singleUse=!0;b.push(B);
c.push([this._debugVertexNormalMaterial]);d.push(q.mat4d.create(d[0]));e=(D={},D[H.POSITION]={data:new Float64Array(a),size:3},D);r=(F={},F[H.POSITION]=new Uint32Array(f),F);B=new y(e,r,void 0,"line");B=new v(B,"debugFaceNormal");B.singleUse=!0;b.push(B);c.push([this._debugFaceNormalMaterial]);d.push(q.mat4d.create(d[0]));var r,B,D,F};c.prototype._createAs3DShape=function(a,b,c,e,f){var k=this;a=a.geometry;if("mesh"!==a.type)return null;var l=this._createGeometryInfo(a,b,e);if(!l)return null;b=l.geometries;
var g=l.materials,q=l.transformations,l=l.objectTransformation;m.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,g,q);e=new A({geometries:b,materials:g,transformations:q,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:f},idHint:e});e.setObjectTransformation(l);var t=function(a){var b=k._context.stage.view.getEdgeView();if(b){b.removeObject(a);k._edgeStageObjects.delete(a);var c=p.createMaterial(b,k.symbol,k._getLayerOpacity());c&&(k._edgeStageObjects.add(a),b.addObject(a,
[c],{mergeGeometries:!0}))}};t(e);f=function(a,b,c,e,f){b=d.perObjectElevationAligner(a,b,c,e,f);t(a);return b};b=new h(this,e,b,null,null,f,c);b.needsElevationUpdates=n.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;b.elevationContext.centerPointInElevationSR=c;b.alignedTerrainElevation=f(e,b.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return b};c.prototype._createComponentNormals=function(a,b,c,d){switch(c.shading||
"flat"){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,c,d);case "smooth":return this._createComponentNormalsSmooth(a,c,d)}};c.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,c,d);c=!1;for(var e=0;e<d.length;e+=3){this._calculateFaceNormal(a,d,e,aa);for(var f=0;3>f;f++){var h=3*d[e+f];J[0]=b[h+0];J[1]=b[h+1];J[2]=b[h+2];0>q.vec3d.dot(aa,J)&&(b[h+0]=-b[h+0],b[h+1]=-b[h+
1],b[h+2]=-b[h+2],c=!0)}}return{normals:b,indices:d,didFlipNormals:c}};c.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var f=this._calculateFaceNormal(a,c,e,aa),h=0;3>h;h++)b[e+h]=f[h],d[e+h]=e/3;return{normals:b,indices:d,didFlipNormals:!1}};c.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var d=0;d<c.length;d+=3)for(var e=this._calculateFaceNormal(a,c,d,aa),f=0;3>f;f++){var h=c[d+
f],k=b[h];k||(k={normal:q.vec3d.create(),count:0},b[h]=k);q.vec3d.add(k.normal,e);k.count++}a=new Float32Array(3*c.length);e=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){h=c[d];k=b[h];1!==k.count&&(q.vec3d.normalize(q.vec3d.scale(k.normal,1/k.count)),k.count=1);for(f=0;3>f;f++)a[3*d+f]=k.normal[f];e[d]=d}return{normals:a,indices:e,didFlipNormals:!1}};c.prototype._getFaceVertices=function(a,b,c,d,e,f){var h=3*b[c+0],k=3*b[c+1];b=3*b[c+2];d[0]=a[h+0];d[1]=a[h+1];d[2]=a[h+2];e[0]=a[k+0];e[1]=
a[k+1];e[2]=a[k+2];f[0]=a[b+0];f[1]=a[b+1];f[2]=a[b+2]};c.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,J,M,O);q.vec3d.subtract(M,J);q.vec3d.subtract(O,J);q.vec3d.cross(M,O,J);q.vec3d.normalize(J,d);return d};c.prototype._getOrCreateComponents=function(a){return a.components?a.components:W};c.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);n.reproject(a.vertexAttributes.position,0,a.spatialReference,c,0,this._context.renderSpatialReference,
b.length/3);return c};c.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,f=new Float32Array(c.length);return e.projectNormalToECEF(c,d,b,a.spatialReference,f)};c.prototype._createColorBuffer=function(a){if(this._requiresVertexColors()){a=this._getVertexOpacityAndColor(a);var b=this.symbol.material&&this.symbol.material.colorMixMode||null,c=new Uint8Array(4);
k.encodeSymbolColor(a,b,c);return c}return null};c.prototype._createColorIndices=function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};c.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv;if(d&&d.length!==c.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(e&&e.length/2!==c.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);b=this._createColorBuffer(b);d=this._createNormalBuffer(a,c);a=this._transformCenterLocal(a,c,d);return{positionBuffer:c,normalBuffer:d,uvBuffer:e,colorBuffer:b,objectTransformation:a}};c.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,e=this._context.renderSpatialReference;P[0]=d.x;P[1]=d.y;P[2]=
0;d=q.mat4d.create();u.computeLinearTransformation(a.spatialReference,P,d,e);q.mat4d.inverse(d,V);for(a=0;a<b.length;a+=3)J[0]=b[a+0],J[1]=b[a+1],J[2]=b[a+2],q.mat4d.multiplyVec3(V,J),b[a+0]=J[0],b[a+1]=J[1],b[a+2]=J[2];if(c)for(q.mat4d.toMat3(d,N),q.mat3d.transpose(N,N),a=0;a<c.length;a+=3)J[0]=c[a+0],J[1]=c[a+1],J[2]=c[a+2],q.mat3d.multiplyVec3(N,J),c[a+0]=J[0],c[a+1]=J[1],c[a+2]=J[2];return d};c.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=
-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this._logWarning("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};c.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};
c.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),n.reproject(a.vertexAttributes.position,0,a.spatialReference,b,0,c,d));n.computeBoundingBox(b,0,d,S);return n.boundingBoxClipped(S,this._context.clippingExtent)};c.prototype._createGeometryInfo=function(a,b,c){if(!l.canProject(a,
this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;var d=this._createBuffers(a,b);if(!d)return null;b=d.positionBuffer;for(var e=d.uvBuffer,f=d.colorBuffer,h=d.normalBuffer,d=d.objectTransformation,k=[],g=[],m=[],n=!1,p=0,t=this._getOrCreateComponents(a);p<t.length;p++){var u=t[p];if(!this._validateFaces(a,u))return null;var A=this._getOrCreateFaces(a,u);if(0!==A.length){var x=
this._createComponentNormals(b,h,u,A);x.didFlipNormals&&(n=!0);var C=(r={},r[H.POSITION]={size:3,data:b},r[H.NORMAL]={size:3,data:x.normals},r),x=(B={},B[H.POSITION]=A,B[H.NORMAL]=x.indices,B);f&&(C[H.SYMBOLCOLOR]={size:4,data:f},x[H.SYMBOLCOLOR]=this._createColorIndices(u,A));a.vertexAttributes.uv&&(C[H.UV0]={size:2,data:e},x[H.UV0]=A);A=new y(C,x);A=new v(A,c+"_mesh");A.singleUse=!0;k.push(A);g.push(q.mat4d.identity());m.push([this._getOrCreateMaterial(a,u)])}}n&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:k,transformations:g,materials:m,objectTransformation:d};var r,B};return c}(t);var F=[1,1,1],L=[1,1,1,1],G=[0,0,0],P=q.vec3d.create(),J=q.vec3d.create(),M=q.vec3d.create(),O=q.vec3d.create(),aa=q.vec3d.create(),V=q.mat4d.create(),N=q.mat3d.create(),S=c.create(),W=[new b];return r})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.encodeSymbolColor=function(f,a,c){null==f||"ignore"===
a?(c[0]=255,c[1]=255,c[2]=255,c[3]=255):(c[0]=Math.floor(255*f[0]),c[1]=Math.floor(255*f[1]),c[2]=Math.floor(255*f[2]),f=Math.floor(85*f[3]),c[3]=0===f?0:"tint"===a?f:"replace"===a?f+85:f+170)}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./objectResourceUtils ../support/FastSymbolUpdates ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A){var C=u.mat4d,B=u.vec3d,D=[1,1,1],E=[1,1,1,1],H=[0,0,0];r=e.fromValues(-.5,-.5,-.5,.5,.5,.5);g=e.fromValues(-.5,-.5,0,.5,.5,1);u=e.fromValues(-.5,-.5,0,.5,.5,.5);var F={sphere:r,cube:r,cylinder:g,cone:g,"inverted-cone":g,tetrahedron:u,diamond:r},L=[x.ModelContentType.MATERIAL,x.ModelContentType.TEXTURE,x.ModelContentType.GEOMETRY];return function(g){function p(){return null!==g&&g.apply(this,arguments)||this}f(p,g);p.prototype._prepareResources=
function(){var a=this.symbol,b=this._getStageIdHint();if(!this._isPropertyDriven("size")){var c=k.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};p.prototype._preparePrimitiveResources=function(c,d){var f=this.symbol;if("sphere"===c)this._geometryData=y.createPolySphereGeometry(.5,2,!0);else if("cube"===c)this._geometryData=
y.createBoxGeometry(1);else if("cylinder"===c)this._geometryData=y.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);else if("cone"===c)this._geometryData=y.createConeGeometry(1,.5,15,!1),y.cgToGIS(this._geometryData);else if("inverted-cone"===c)this._geometryData=y.createConeGeometry(1,.5,15,!0),y.cgToGIS(this._geometryData);else if("tetrahedron"===c)this._geometryData=y.createTetrahedronGeometry(1),y.cgToGIS(this._geometryData);else if("diamond"===c)this._geometryData=y.createDiamondGeometry(1),
y.cgToGIS(this._geometryData);else{this._logWarning("Unknown object symbol primitive: "+c);this.reject();return}this._geometry=new v(this._geometryData,d);this._context.stage.add(x.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=F[c];this._resourceSize=e.size(this._resourceBoundingBox);this._symbolSize=k.computeSizeWithResourceSize(this._resourceSize,f);c=this._getMaterialOpacity();c={specular:[0,0,0],opacity:c,transparent:1>c||this._isPropertyDriven("opacity"),instanced:["transformation"],
ambient:D,diffuse:D};var h=this.symbolContainer;if("point-3d"===h.type&&h.verticalOffset){var h=h.verticalOffset,g=h.minWorldLength,n=h.maxWorldLength;c.verticalOffset={screenLength:l.pt2px(h.screenLength),minWorldLength:g||0,maxWorldLength:null!=n?n:Infinity};c.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(c.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?c.externalColor=E:(f=f.material?b.toUnitRGBA(f.material.color):
E,c.externalColor=f);this._fastUpdates=m.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(c,this._fastUpdates.materialParameters),c.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&c.instanced.push("color");this._material=new A(c,d+"_objectmat");this._context.stage.add(x.ModelContentType.MATERIAL,this._material);this.resolve()};p.prototype._prepareModelResources=function(b,
d){var f=this,h=["transformation"];d={materialParamsMixin:{instanced:h},idHint:d,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=m.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(d.materialParamsMixin,this._fastUpdates.materialParameters),h.push("featureAttribute")):this._hasPerInstanceColor()&&h.push("color");h=this.symbolContainer;if("point-3d"===h.type&&h.verticalOffset){var h=
h.verticalOffset,g=h.minWorldLength,n=h.maxWorldLength;d.materialParamsMixin.verticalOffset={screenLength:l.pt2px(h.screenLength),minWorldLength:g||0,maxWorldLength:null!=n?n:Infinity};d.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=q.fetch(b,d);this._symbolLoaderPromise.then(function(a){f._symbolLoaderPromise=null;if(!f.isRejected()){var b=f._context,c=a.stageResources,d=b.stage,h=f._getExternalColorParameters(f.symbol.material),l=f._getMaterialOpacity(),g=f._isPropertyDriven("opacity"),
n=c[x.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(n.length);n.forEach(function(c,d){var e=c.getParameterValues();c.setParameterValues(h);a.originalMaterialOpacities[d]=e.opacity;d=e.opacity*l;c.setParameterValues({opacity:d,transparent:1>d||g||e.transparent});b.screenSizePerspectiveEnabled&&c.setParameterValues({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});L.forEach(function(a){for(var b=c[a],e=0;b&&e<b.length;e++)d.add(a,b[e])});f._resourceBoundingBox=
q.computeBoundingBox(a);f._resourceSize=e.size(f._resourceBoundingBox);f._pivotOffset=a.pivotOffset;f._symbolSize=k.computeSizeWithResourceSize(f._resourceSize,f.symbol);f._i3sModel=a;m.updateFastSymbolUpdatesState(f._fastUpdates,f._context.renderer,f._fastVisualVariableConvertOptions())&&n.forEach(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});f.resolve()}},function(a){f._symbolLoaderPromise=null;if(!f.isFulfilled()){if(!(a instanceof c)){var b="ObjectSymbol3DLayer failed to load";
a&&a.message&&(b+=" ("+a.message+")");f._logWarning(b)}f.reject()}})};p.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[x.ModelContentType.MATERIAL].forEach(a):a(this._material)};p.prototype._getExternalColorParameters=function(a){var c={};this._isPropertyDriven("color")?c.externalColor=E:a&&a.color?c.externalColor=b.toUnitRGBA(a.color):(c.externalColor=E,c.colorMixMode="ignore");return c};p.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||
this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;L.forEach(function(c){for(var d=b[c],e=0;d&&e<d.length;e++)a.remove(c,d[e].id)})}else this._material&&a.remove(x.ModelContentType.MATERIAL,this._material.id),this._geometry&&a.remove(x.ModelContentType.GEOMETRY,this._geometry.id)};p.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;
var c=t.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,d,b.uid)};p.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var e=this._isPropertyDriven("opacity");if(this._i3sModel){var f=this._getMaterialOpacity();this._i3sModel.stageResources[x.ModelContentType.MATERIAL].forEach(function(a,
b){b=d._i3sModel.originalMaterialOpacities[b]*f;a.setParameterValues({opacity:b,transparent:1>b||e})})}else b=this._getMaterialOpacity(),this._material.setParameterValues({opacity:b,transparent:1>b||e});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var h in b){var k=b[h];if(a=c(k))k=this.getGraphicElevationContext(k.graphic),a.needsElevationUpdates=t.needsElevationUpdates3D(k.mode),a.elevationContext.set(k)}return!0}return!1};p.prototype.applyRendererDiff=function(a,b,c,d){var e=
this,f;for(f in a.diff)switch(f){case "visualVariables":if(m.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};p.prototype._createAs3DShape=function(a,b,c,d,e,f){var l=this,g=null,q=null,p=this._getFastUpdateAttrValues(a);p&&(g={featureAttribute:p},q=function(a){return m.evaluateModelTransform(l._fastUpdates.materialParameters,
p,a)});!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(g=g||{},g.color=k.mixinColorAndOpacity(c.color,c.opacity));a=this._context.layer.uid;var u=C.identity();this._applyObjectRotation(c,u);this._applyObjectRotation(this.symbol,u);this._applyObjectScale(c,u);this._applyAnchor(u);if(this._i3sModel){c=this._i3sModel.stageResources[x.ModelContentType.GEOMETRY];for(var v=this._i3sModel.materialsByComponent,A=Array(c.length),y=0;y<A.length;y++)A[y]=u;e=t.createStageObjectForPoint.call(this,b,
c,v,A,g,d,e,a,f,null,q)}else e=t.createStageObjectForPoint.call(this,b,[this._geometry],[[this._material]],[u],g,d,e,a,f,null,q);if(null===e)return null;if(this._fastUpdates.enabled){var r=m.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());this._forEachMaterial(function(a){return a.setParameterValues(r)})}e.object.setCastShadow(!0);f=new n(this,e.object,null,null,null,h.perObjectElevationAligner,d,n.VisibilityModes.REMOVE_OBJECT);f.alignedTerrainElevation=
e.terrainElevation;f.needsElevationUpdates=t.needsElevationUpdates3D(d.mode);t.extendPointGraphicElevationContext(f,b,this._context.elevationProvider);return f};p.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=k.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||C.scale(b,a))};p.prototype._applyObjectRotation=
function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof d))return k.computeObjectRotation(a.heading,a.tilt,a.roll,b)};p.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return B.scale(e.center(this._resourceBoundingBox),-1);case "top":var a=e.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=e.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];
default:return this._pivotOffset?B.scale(this._pivotOffset,-1,Array(3)):H}};p.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&C.translate(a,b)}};p.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};p.prototype._supportsShaderVisualVariables=function(){return this._context.stage.has("instancedRendering")?!0:!1};p.prototype._fastVisualVariableConvertOptions=
function(){var a=this._resourceBoundingBox?e.size(this._resourceBoundingBox):D,b=this._resourceBoundingBox?this._computeAnchor():H,c=this._context.renderCoordsHelper.unitInMeters,d=k.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c);return{modelSize:a,symbolSize:this._symbolSize||D,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};p.PRIMITIVE_BOUNDING_BOX=F;return p}(p)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/Deferred dojo/sniff dojo/_base/lang dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x){function v(a){return new d("","Request for object resource failed: "+a)}function y(a,d){var e,f,h=[],k=[],l=[],g=[],p=[],t=n.Version.parse(a.version||"1.0","wosr");C.validate(t);var t="meshsymbol_"+a.model.name,v=a.textureDefinitions,y={},r;for(r in v){var B=v[r];if(e=B.images[0].data){f=B.encoding+";base64,"+e;e="/textureDefinitions/"+r;var D={noUnpackFlip:!0,wrapClamp:!1};c("enable-feature:jkieboom/alpha-channel-usage")&&(D.wrapClamp=!0);f=new u(f,t,
D);p.push(f);y[e]={engineTexObj:f,alphaChannelUsage:"rgba"===B.channels?B.alphaChannelUsage||"transparency":"none"}}else A.warn("Externally referenced texture data is not yet supported")}r=a.model.geometries;v=a.materialDefinitions;for(B=0;B<r.length;B++){f=D=r[B];var W=f.params,X=W.topology;e=!0;W.vertexAttributes||(A.warn("Geometry must specify vertex attributes"),e=!1);switch(W.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:X=W.faces;if(!X)A.warn("Indexed geometries must specify faces"),
e=!1;else if(W.vertexAttributes){var Q=void 0;for(Q in W.vertexAttributes)(W=X[Q])&&W.values?(null!=W.valueType&&"UInt32"!==W.valueType&&(A.warn("Unsupported indexed geometry indices type '"+W.valueType+"', only UInt32 is currently supported"),e=!1),null!=W.valuesPerElement&&1!==W.valuesPerElement&&(A.warn("Unsupported indexed geometry values per element '"+W.valuesPerElement+"', only 1 is currently supported"),e=!1)):(A.warn("Indexed geometry does not specify face indices for '"+Q+"' attribute"),
e=!1)}break;default:A.warn("Unsupported topology '"+X+"'"),e=!1}f.params.material||(A.warn("Geometry requires material"),e=!1);f=f.params.vertexAttributes;W=void 0;for(W in f)f[W].values||(A.warn("Geometries with externally defined attributes are not yet supported"),e=!1);if(e){f=D.params;e=f.material;f=f.texture;var X=D.params.vertexAttributes,W={},I;for(I in X)Q=X[I],W[I]={data:Q.values,size:Q.valuesPerElement};l.push([]);X={};if("PerAttributeArray"===D.params.topology){for(var D=W.position.data.length/
W.position.size,Q=new Uint32Array(D),K=0;K<D;K++)Q[K]=K;var D=Q,T;for(T in W)X[T]=D}else{var D=D.params.faces,Y;for(Y in D)X[Y]=new Uint32Array(D[Y].values)}D=f?y[f]:null;Q=g[e]?g[e][f]:null;Q||(Q=e.substring(e.lastIndexOf("/")+1),Q=v[Q].params,1===Q.transparency&&(Q.transparency=0),Q={ambient:Q.diffuse,diffuse:Q.diffuse,specular:[0,0,0],opacity:1-(Q.transparency||0),transparent:0<Q.transparency,textureId:D?D.engineTexObj.id:void 0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:Q.externalColorMixMode||
"tint"},c("enable-feature:jkieboom/alpha-channel-usage")&&D&&("transparency"===D.alphaChannelUsage||"maskAndTransparency"===D.alphaChannelUsage)&&(Q.transparent=!0),d&&d.materialParamsMixin&&b.mixin(Q,d.materialParamsMixin),Q=new x(Q,t),g[e]||(g[e]={}),g[e][f]=Q,k.push(Q));l[B].push(Q);e=new q(new m(W,X),t);h.push(e)}}return{stageResources:{textures:p,materials:k,geometries:h},materialsByComponent:l,pivotOffset:a.model.pivotOffset}}Object.defineProperty(g,"__esModule",{value:!0});var A=h.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
C=new n.Version(1,2,"wosr");g.fetch=function(b,c){c=c||{};var d=c.streamDataSupplier;if(d){var f=d.request(b,"json"),h=new a(function(){return d.cancelRequest(f)});f.then(function(a,b){try{var d=y(b,c);return h.resolve(d)}catch(O){return h.reject(O)}},function(a){h.reject(a instanceof l?a:v(a))});return h.promise}var k=e(b),g=new a(function(){return k.cancel()});k.then(function(a){try{var b=y(a.data,c);return g.resolve(b)}catch(M){return g.reject(M)}},function(a){g.reject(a instanceof l?a:v(b))});
return g.promise};g.computeBoundingBox=function(a){a=a.stageResources[k.ModelContentType.GEOMETRY];for(var b=t.empty(),c=[0,0,0],d=[0,0,0],e=0;e<a.length;e++){var f=a[e].getBoundingInfo();p.vec3d.set(f.getBBMin(),c);p.vec3d.set(f.getBBMax(),d);for(f=0;3>f;++f)b[f]=Math.min(b[f],c[f]),b[f+3]=Math.max(b[f+3],d[f])}return b};g.createStageResources=y})},"esri/core/Version":function(){define(["require","exports","./Error"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,
b,f){void 0===f&&(f="");this.major=a;this.minor=b;this._context=f}a.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};a.prototype.since=function(a,b){return!this.lessThan(a,b)};a.prototype.validate=function(a){if(this.major!==a.major)throw new f((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,
this.minor,this._context)};a.parse=function(c,b){void 0===b&&(b="");var l=c.split("."),e=l[0],l=l[1],d=/^\s*\d+\s*$/;if(!e||!e.match||!e.match(d))throw new f((b&&b+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:c});if(!l||!l.match||!l.match(d))throw new f((b&&b+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:c});c=parseInt(e,10);e=parseInt(l,10);return new a(c,e,b)};return a}();g.Version=r})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/Point ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../../../views/3d/lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){function x(a,b,c,d){for(var e=a.getGeometryRecords(),f=e.length,h="absolute-height"!==b.mode,k=0,g=0;g<f;g++){var m=e[g].geometry,n=[e[g].transformation[12],e[g].transformation[13],e[g].transformation[14]],q=m.getData().getVertexAttr(),p=q[C.POSITION].data,t=q.zOffset.data,q=q.mapPos.data,u=q.length/3;A(p.length/3===u*H+2,"unexpected tube geometry");var v=0,y=0;D.spatialReference=c.spatialReference;for(var x=0,r=0;r<u;r++){D.x=q[3*r];D.y=q[3*r+1];D.z=q[3*
r+2];var F=l.computeElevation(c,D,b,d,h?E:null);h&&(x+=E.terrainElevation);var L=H;0!==r&&r!==u-1||L++;for(var G=0;G<L;G++)B[0]=p[v]+n[0],B[1]=p[v+1]+n[1],B[2]=p[v+2]+n[2],d.setAltitude(F+t[y],B),p[v]=B[0]-n[0],p[v+1]=B[1]-n[1],p[v+2]=B[2]-n[2],v+=3,y+=1;m.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(g);k+=x/u}return k/f}var v=h.vec3d,y=h.mat4d,A=m.assert;r=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}f(e,a);e.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
d.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=v.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new u(c,a+"_3dlinemat");this._context.stage.add(t.ModelContentType.MATERIAL,this._material);this.resolve()};e.prototype.destroy=function(){a.prototype.destroy.call(this);
this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(t.ModelContentType.MATERIAL,this._material.id),this._material=null)};e.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};
e.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getMaterialOpacity(),c=1>b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:c}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var d in b){var e=b[d];if(a=c(e))e=this.getGraphicElevationContext(e.graphic),a.needsElevationUpdates=l.needsElevationUpdates3D(e.mode),a.elevationContext.set(e)}return!0}return!1};e.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?
l.getSingleSizeDriver(a.size):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};e.prototype._getSymbolSize=function(){return this.symbol.size||1};e.prototype._createAs3DShape=function(a,d,e,f,h){var g=a.geometry,m=g.paths;a=[];var t=[],u=[],A=v.create(),C=this._context.renderSpatialReference===n.SphericalECEFSpatialReference,r=Array(6),B=this._getPathSize(d),g=l.getGeometryVertexData3D(m,c.hasZ(g),g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,e);this._logGeometryCreationWarnings(g,m,"paths","PathSymbol3DLayer");if(0<m.length){for(var m=g.geometryData.outlines,D=g.eleVertexData,F=g.vertexData,E=0;E<m.length;++E){var L=m[E];if(!(1>=L.count)){var O=L.index,G=L.count;if(this._context.clippingExtent&&(l.computeBoundingBox(D,O,G,r),l.boundingBoxClipped(r,this._context.clippingExtent)))continue;l.chooseOrigin(F,O,G,A);l.subtractCoordinates(F,O,G,A);L=new Float64Array(D.buffer,3*O*D.BYTES_PER_ELEMENT,3*G);O=l.flatArrayToArrayOfArrays(F,
O,G);O=k.createTubeGeometry(O,.5*B,H,C,A);O.getVertexAttr().mapPos={size:3,data:L,offsetIdx:0,strideIdx:3};this._material.getParams().vertexColors&&(L=this._getVertexOpacityAndColor(d),O=k.addVertexColors(O,L));L=new p(O,f+"path"+E);L.singleUse=!0;a.push(L);t.push([this._material]);L=y.identity();y.translate(L,A,L);u.push(L)}}if(0<a.length)return d=new q({geometries:a,materials:t,transformations:u,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:h},idHint:f}),d=new b(this,d,a,null,
null,x,e),d.alignedTerrainElevation=g.terrainElevation,d.needsElevationUpdates=l.needsElevationUpdates3D(e.mode),d}return null};return e}(e);var C=m.VertexAttrConstants,B=v.create(),D=new a,E={verticalDistanceToGround:0,terrainElevation:0},H=10;return r})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D){var E=B.VertexAttrConstants;r=u.vec3d;var H=u.mat4d;k=function(k){function g(){var a=null!==k&&k.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}f(g,k);g.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};g.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),
b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new D(b,a+"_colormat");this._context.stage.add(x.ModelContentType.MATERIAL,this._material)};g.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:c.pt2px(a.size)},this._outlineMaterial=1.5<=a.width?m.createRibbonMaterial(a):m.createNativeMaterial(a),
this._context.stage.add(x.ModelContentType.MATERIAL,this._outlineMaterial)};g.prototype.destroy=function(){k.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(x.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(x.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,c=b.geometry.type;if("polyline"!==
c&&"polygon"!==c&&"extent"!==c)return this._logWarning("unsupported geometry type for fill symbol: "+c),null;if(!this._validateGeometry(b.geometry))return null;c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,d,c):this._createAs3DShape(b,a,d,c,b.uid)};g.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),c=this._getMaterialOpacity(),
this._material.setColor([b[0],b[1],b[2],c]),this._material.setTransparent(1>c),this._outlineMaterial&&(b=this._outlineMaterial.getColor(),this._outlineMaterial.setColor([b[0],b[1],b[2],this._getOutlineOpacity()])),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=p.needsElevationUpdates2D(d);
for(var e in b){var f=b[e];(d=c(f))&&"object3d"===d.type&&(f=f.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(f)))}return!0}return!1};g.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};g.prototype._createAs3DShape=function(a,b,c,e,f){var k=this._getPolyGeometry(a);
a=k.rings;var l=this._getOutlineGeometry(k,a),k=p.getGeometryVertexData3D(l,d.hasZ(k),k.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);P.idHint=e;P.color=b;P.data=k;var g;this._hasOutline&&(g=new k.vertexData.constructor(k.vertexData));P.outNum=0;P.outGeometries=[];P.outTransforms=[];P.outMaterials=[];this._createAs3DShapeFill(P);P.data.vertexData=g;this._createAs3DShapeOutline(P);this._logGeometryCreationWarnings(P.data,a,
"rings","FillSymbol3DLayer");if(0===P.outNum)return null;b=new A({geometries:P.outGeometries,materials:P.outMaterials,transformations:P.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:f},idHint:e});b=new t(this,b,P.outGeometries,null,null,h.perVertexElevationAligner,c);b.alignedTerrainElevation=k.terrainElevation;b.needsElevationUpdates=p.needsElevationUpdates2D(c.mode);return b};g.prototype._createAs3DShapeFill=function(a){for(var c=a.data.geometryData.polygons,d=
a.data.eleVertexData,e=a.data.vertexData,f=function(f){var k=c[f];f=k.count;var l=k.index;if(h._context.clippingExtent&&(p.computeBoundingBox(d,l,f,F),p.boundingBoxClipped(F,h._context.clippingExtent)))return"continue";var g=new Float64Array(d.buffer,3*l*d.BYTES_PER_ELEMENT,3*f),m=new Float64Array(e.buffer,3*l*e.BYTES_PER_ELEMENT,3*f),k=k.holeIndices.map(function(a){return a-l}),k=b(g,k,3);if(0===k.length)return"continue";p.chooseOrigin(e,l,f,L);p.subtractCoordinates(e,l,f,L);f=h._createFillGeometry(k,
0,m,g,a.color);f=new v(f,a.idHint);f.singleUse=!0;g=H.identity();H.translate(g,L,g);a.outGeometries.push(f);a.outMaterials.push([h._material]);a.outTransforms.push(g);a.outNum++},h=this,k=0;k<c.length;++k)f(k)};g.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,d=a.data.vertexData,e=0;e<b.length;++e){var f=b[e],h=f.index,k=f.count;if(this._context.clippingExtent&&(p.computeBoundingBox(c,h,k,F),p.boundingBoxClipped(F,this._context.clippingExtent)))continue;
p.chooseOrigin(d,h,k,L);p.subtractCoordinates(d,h,k,L);f=new Float64Array(c.buffer,3*h*c.BYTES_PER_ELEMENT,3*k);h=new Float64Array(d.buffer,3*h*d.BYTES_PER_ELEMENT,3*k);h=m.createPolylineGeometry(h,f,a.isRings,G,0);h=new v(h,a.idHint+"outline"+e);h.singleUse=!0;f=H.identity();H.translate(f,L,f);a.outGeometries.push(h);a.outMaterials.push([this._outlineMaterial]);a.outTransforms.push(f);a.outNum++}};g.prototype._createAsOverlay=function(a,b,c,d){c=this._getPolyGeometry(a);a=c.rings;var f=this._getOutlineGeometry(c,
a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);c=p.getGeometryVertexDataDraped(f,c.spatialReference,this._context.overlaySR);P.idHint=d;P.color=b;P.data=c;var h;this._hasOutline&&(h=new c.vertexData.constructor(c.vertexData));P.outNum=0;P.outGeometries=[];P.outBoundingBox=e.empty();this._createAsOverlayFill(P);P.data.vertexData=h;this._createAsOverlayOutline(P);this._logGeometryCreationWarnings(P.data,
a,"rings","FillSymbol3DLayer");return 0<P.outNum?new n(this,P.outGeometries,P.outBoundingBox):null};g.prototype._createAsOverlayFill=function(a){for(var c=a.data.vertexData,d=a.data.geometryData.polygons,f=function(f){var k=d[f];f=k.count;var l=k.index,g=new Float64Array(c.buffer,3*l*c.BYTES_PER_ELEMENT,3*f),k=k.holeIndices.map(function(a){return a-l}),g=b(g,k,3);if(0===g.length)return"continue";p.computeBoundingBox(c,l,f,F);if(p.boundingBoxClipped(F,h._context.clippingExtent))return"continue";e.expand(a.outBoundingBox,
F);p.chooseOrigin(c,l,f,L);p.subtractCoordinates(c,l,f,L);p.setZ(c,l,f,h._getDrapedZ());f=H.identity();H.translate(f,L,f);g=h._createFillGeometry(g,l,c,null,a.color);k=new C(g);k.material=h._material;var m=F;k.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0];k.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]));k.transformation=f;k.name=a.idHint;k.uniqueName=a.idHint+"#"+g.id;a.outGeometries.push(k);a.outNum++},h=this,k=0;k<d.length;++k)f(k)};g.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=
a.data.vertexData,c=a.data.geometryData.outlines,d=0;d<c.length;++d){var f=c[d],h=f.index,f=f.count;p.computeBoundingBox(b,h,f,F);if(!p.boundingBoxClipped(F,this._context.clippingExtent)){e.expand(a.outBoundingBox,F);p.chooseOrigin(b,h,f,L);p.subtractCoordinates(b,h,f,L);p.setZ(b,h,f,this._getDrapedZ());f=new Float64Array(b.buffer,3*h*b.BYTES_PER_ELEMENT,3*f);h=H.identity();H.translate(h,L,h);var f=m.createPolylineGeometry(f,null,!0,G,0),k=new C(f);k.material=this._outlineMaterial;var l=F;k.center=
[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0];k.bsRadius=.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]));k.transformation=h;k.name=a.idHint+"outline";k.uniqueName=a.idHint+"outline#"+f.id;a.outGeometries.push(k);a.outNum++}}};g.prototype._getOutlineGeometry=function(a,b){return b};g.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a};g.prototype._getOutlineColor=function(){var b=this.symbol.outline.color,c=this._getOutlineOpacity();return q.mixinColorAndOpacity(a.toUnitRGB(b),
c)};g.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?l.fromExtent(a):a};g.prototype._createFillGeometry=function(a,b,c,d,e){for(var f=a.length,h=new Uint32Array(f),k=new Uint32Array(f),l=0;l<f;l++)h[l]=a[l]+b,k[l]=0;a={};b={};a[E.POSITION]=h;a[E.COLOR]=k;b[E.POSITION]={size:3,data:c};b[E.COLOR]={size:4,data:e};d&&(b.mapPos={size:3,data:d},a.mapPos=h);return new y(b,a)};return g}(k);var F=e.create(),L=r.create(),G=new Float32Array([255,255,255,255]),P={idHint:null,color:null,
data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return k})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){var m=[1,1,1,1],u=[0,0,1],x={mode:"relative-to-ground",offset:0},v=[0,0,0,1];return function(h){function g(){var a=null!==h&&h.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}f(g,h);g.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=n.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};g.prototype.destroy=
function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject()};g.prototype.createGraphics3DGraphic=function(a,b,c,e){void 0===b&&(b={});a=a.graphic;var f=d.placePointOnGeometry(a.geometry);if(!f)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var h=b.text||this.symbol.text;if(!h||1>h.length)return null;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var k=this.getGraphicElevationContext(a,
b.elevationOffset||0);return this._createAs3DShape(this.symbol,f,h,k,this._context.layer.id+"_label_"+a.uid,a.uid,b,c,e,"polyline"===a.geometry.type)};g.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=h.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};g.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationContext();
if(b)for(var d in b){a=b[d];var e=c(a);e&&this.updateGraphicElevationContext(a.graphic,e)}return!0}return!1};g.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=d.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};g.prototype._defaultElevationInfoNoZ=function(){return x};g.prototype._createAs3DShape=function(f,h,g,n,A,y,x,r,P,J){var C=x.centerOffset||v,B=x.screenOffset||
[0,0],D=x.debugDrawBorder||!1,F=x.translation||[0,0,0],E=x.anchor||this._anchor||"center";this._anchor=E;var L=f.material?a.toUnitRGBA(f.material.color):m,H=f.halo&&f.halo.color&&0<f.halo.size,G=H?a.toUnitRGBA(f.halo.color):m,H=H?c.pt2px(f.halo.size):0,Q=this._getTextSize(f);f=new k(g,{size:Q,color:L,font:{family:f.font&&f.font.family?f.font.family:"Arial",weight:f.font&&f.font.weight?f.font.weight:"normal",style:f.font&&f.font.style?f.font.style:"normal"},halo:{size:H,color:G}},A);var I;r?I=x:b.isCalloutSupport(this.symbolContainer)&&
this.symbolContainer.hasVisibleVerticalOffset()&&(I=this.symbolContainer);B={textureId:P?P.textureId:f.id,texCoordScale:P?[1,1]:f.getTexcoordScale(),occlusionTest:!0,screenOffset:B,anchorPos:E,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:x.centerOffsetUnits,debugDrawBorder:D,drawInSecondSlot:!0};I&&I.verticalOffset&&(I=I.verticalOffset,D=I.minWorldLength,E=I.maxWorldLength,B.verticalOffset={screenLength:c.pt2px(I.screenLength),minWorldLength:D||0,maxWorldLength:null!=E?E:Infinity});this._context.screenSizePerspectiveEnabled&&
(I=this._context.sharedResources,D=I.screenSizePerspectiveSettings,B.screenSizePerspective=I.screenSizePerspectiveSettingsLabels.overridePadding(H),B.screenSizePerspectiveAlignment=D);J&&(B.shaderPolygonOffset=1E-4);J=null;H=JSON.stringify(B);null!=r?(J=r.getMaterial(H),null==J&&(J=new q(B,A),r.addMaterial(H,J))):J=new q(B,A);J=[J];H=[f.getTextWidth(),f.getTextHeight()];C=p.createPointGeometry(u,F,void 0,P?[0,0]:H,C,P?[0,0]:null);C=[new t(C,A)];A=d.createStageObjectForPoint.call(this,h,C,[J],null,
null,n,A,this._context.layer.uid,y,!0);r=new e(this,A.object,C,null==r?J:null,P?null:[f],l.perObjectElevationAligner,n);r.alignedTerrainElevation=A.terrainElevation;r.needsElevationUpdates=d.needsElevationUpdates2D(n.mode)||"absolute-height"===n.mode;var K=P?f.getTextWidth():f.getWidth(),T=P?f.getTextHeight():f.getHeight();r.getScreenSize=function(a){void 0===a&&(a=Array(2));a[0]=K;a[1]=T;return a};r.metadata={labelText:g,elevationOffset:x.elevationOffset||0};d.extendPointGraphicElevationContext(r,
h,this._context.elevationProvider);return r};g.prototype._getTextSize=function(a){return c.pt2px((a||this.symbol).size)||12};return g}(h)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define(["require","exports","./Texture","./Util","../../../webgl/Texture"],function(r,g,f,a,c){function b(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function l(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function e(a){return"rgba("+
a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}r=function(){function h(b,c,d,f){void 0===f&&(f=!0);this._idHint=d;this._text=b;this._textLines=b.split(/\r?\n/);this._params=c;this._haloSize=Math.round(this._params.halo.size);this._fillStyle=e(this._params.color);this._haloStyle=l(this._params.halo.color);this._textWidth=this._computeTextWidth();this._lineHeight=this._computeLineHeight();this._textHeight=this._computeTextHeight();this._scaleFactor=f?Math.min(1,Math.min(2048/
this._textWidth,2048/this._textHeight)):1;this._renderedWidth=Math.round(this._textWidth*this._scaleFactor);this._renderedHeight=Math.round(this._textHeight*this._scaleFactor);f&&a.assert(2048>=this._renderedWidth&&2048>=this._renderedHeight);this._width=a.nextHighestPowerOfTwo(this._renderedWidth);this._height=a.nextHighestPowerOfTwo(this._renderedHeight)}Object.defineProperty(h.prototype,"id",{get:function(){null==this._id&&(this._id=f.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});
h.prototype.getParams=function(){return this._params};h.prototype.getText=function(){return this._text};h.prototype.deferredLoading=function(){return!1};h.prototype.getWidth=function(){return this._width};h.prototype.getHeight=function(){return this._height};h.prototype.getTextWidth=function(){return this._textWidth};h.prototype.getTextHeight=function(){return this._textHeight};h.prototype.getRenderedWidth=function(){return this._renderedWidth};h.prototype.getRenderedHeight=function(){return this._renderedHeight};
h.prototype.initializeThroughRender=function(a,b){var d=this._getTextCanvas();d.width=this._width;d.height=this._height;var e=d.getContext("2d");e.save();b.samplingMode=9987;b.wrapMode=33071;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,e,0,this._height-this._renderedHeight);a=new c(a,b,d);e.restore();return a};h.prototype.getTexcoordScale=function(){return[this._renderedWidth/this._width,this._renderedHeight/this._height]};h.prototype.setUnloadFunc=
function(a){this._unloadFunc=a};h.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};h.prototype.renderText=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);b=this._lineHeight*this._scaleFactor;var h=this._haloSize,k=c.textAlign;a=("center"===k?.5*a:"right"===k?a:0)+h;c.save();var l=3>h;if(0<h){var k=h,g=this._getHaloCanvas();g.width=Math.max(512,this._renderedWidth);g.height=Math.max(512,this._renderedHeight);var n=g.getContext("2d");n.clearRect(0,
0,g.width,g.height);this._setFontProperties(n,this._params.size*this._scaleFactor);n.fillStyle=this._haloStyle;n.strokeStyle=this._haloStyle;n.lineJoin=l?"miter":"round";if(l)for(var q=0,p=this._textLines;q<p.length;q++){for(var l=p[q],t=0,r=d;t<r.length;t++){var E=r[t];n.fillText(l,a+h*E[0],h+h*E[1])}k+=b}else for(q=0,p=this._textLines;q<p.length;q++){l=p[q];t=2*h;for(r=0;5>r;r++)n.lineWidth=(.6+.1*r)*t,n.strokeText(l,a,k);k+=b}c.globalAlpha=this._params.halo.color[3];c.drawImage(g,e,f);g.width=
512;g.height=512;c.globalAlpha=1}this._setFontProperties(c,this._params.size*this._scaleFactor);k=f+h;f=0;for(h=this._textLines;f<h.length;f++)l=h[f],c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(l,e+a,k),c.globalCompositeOperation="source-over",c.fillStyle=this._fillStyle,c.fillText(l,e+a,k),k+=b;c.restore()};h.preferredAtlasSize=function(){return 512};h.prototype._getTextCanvas=function(){null==h._textCanvas2D&&(h._textCanvas2D=b());return h._textCanvas2D};h.prototype._getHaloCanvas=
function(){null==h._haloCanvas2D&&(h._haloCanvas2D=b());return h._haloCanvas2D};h.prototype._setFontProperties=function(a,b){var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family;a.textAlign="left";a.textBaseline="top"};h.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var b=0,c=0,d=this._textLines;c<d.length;c++){var e=a.measureText(d[c]).width;e>b&&(b=e)}c=this._params.font;if("italic"===c.style||
"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};h.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};h.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length};return h}();var d=[];for(g=0;360>g;g+=22.5)d.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*
g/180)]);return r})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],function(r,g,f,a){return function(a){function b(b,c){var d=a.call(this)||this;d.symbol=null;d.graphics3DSymbol=null;d.symbol=b;b.fetchSymbol().then(function(a){if(d.isRejected())throw Error();d.graphics3DSymbol=c(a)}).then(function(){if(d.isRejected())throw Error();d.graphics3DSymbol.then(function(){d.isRejected()||
d.resolve()},function(a){d.isRejected()||d.reject(a)})}).catch(function(a){d.isRejected()||d.reject(a)});return d}f(b,a);b.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,this)};b.prototype.layerPropertyChanged=function(a,b){return this.graphics3DSymbol.layerPropertyChanged(a,b)};b.prototype.applyRendererDiff=function(a,b,c){return this.graphics3DSymbol.applyRendererDiff(a,b,c)};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};b.prototype.setDrawOrder=function(a,b){if(this.graphics3DSymbol)return this.graphics3DSymbol.setDrawOrder(a,b)};b.prototype.destroy=function(){this.isFulfilled()||this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return b}(a.Promise)})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(r,g,f,a){Object.defineProperty(g,
"__esModule",{value:!0});r=function(){function c(b,c){var e=this;this.owner=c;this.properties={};this.afterDispatchHandle=null;for(var d in b)c=new f(b[d],null,null,2,2),this.properties[d]={pool:c,acquired:[]};this.afterDispatchHandle=a.afterDispatch(function(){return e.release()})}c.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null};c.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var c=
a.pool.acquire();for(a.acquired.push(c);c===b;)a.acquired.push(c),c=a.pool.acquire();return c};c.prototype.release=function(){for(var b in this.properties){for(var c=this.properties[b],e=0,d=0,f=c.acquired;d<f.length;d++){var g=f[d];a.isValueInUse(g)?c.acquired[e++]=g:c.pool.release(g)}c.acquired.length=e}};return c}();g.PropertiesPool=r;g.default=r})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require","exports","./gl-matrix"],function(r,g,f){var a=f.vec3d;
r=function(){function b(a,b){this._origins=[];this._boxSize=a;this._maxNumOrigins=b}b.prototype.getOrigin=function(f){for(var e=this._origins.length,d,h=!1,l=Number.MAX_VALUE,g=0;g<e;g++){var p=this._origins[g];a.subtract(f,p.vec3,c);c[0]=Math.abs(c[0]);c[1]=Math.abs(c[1]);c[2]=Math.abs(c[2]);var k=c[0]+c[1]+c[2];k<l&&(d=p,l=k,h=c[0]<this._boxSize&&c[1]<this._boxSize&&c[2]<this._boxSize)}h||d&&null!=this._maxNumOrigins&&!(this._origins.length<this._maxNumOrigins)||(e=b.OFFSET,d={vec3:[f[0]+e,f[1]+
e,f[2]+e],id:b.ORIGIN_PREFIX+this._origins.length},this._origins.push(d));return d};b.OFFSET=1.11;b.ORIGIN_PREFIX="fb_";return b}();var c=a.create();return r})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ./gl-matrix ./IdGen ./ModelContentType ./Octree ./Util".split(" "),function(r,g,f,a,c,b,l,e){var d=a.vec3d;return function(){function a(b,c,e){this._parentStages=[];this._children=[];this.id=a._idGen.gen(e);this.name=b;c=c||{};this.group=
c.group||"";this.isPickable=null!=c.isPickable?c.isPickable:!0;this.translation=d.create(c.translation);this._extent=[d.createFrom(0,0,0),d.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}a.prototype.getParentStages=function(){return this._parentStages};a.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)};a.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)};a.prototype.getName=function(){return this.name};
a.prototype.getGroup=function(){return this.group};a.prototype.getTranslation=function(){return this.translation};a.prototype.getObjectIds=function(){return this._children.map(function(a){return a.id})};a.prototype.getObjects=function(){return this._children};a.prototype.getExtent=function(){this._updateExtent();return this._extent};a.prototype.addObject=function(a){this._children.push(a);a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._spatialAccelerator&&
this._spatialAccelerator.add(a)};a.prototype.hasObject=function(a){return-1<this._children.indexOf(a)};a.prototype.removeObject=function(a){return void 0!==f.removeUnordered(this._children,a)?(a.removeParentLayer(this),this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._spatialAccelerator&&this._spatialAccelerator.remove(a),!0):!1};a.prototype.replaceObject=function(a,b){var c=this._children.indexOf(a);e.assert(-1<c,"Layer.replaceObject: layer doesn't contain specified object");
this._children[c]=b;a.removeParentLayer(this);b.addParentLayer(this);this.notifyDirty("layObjectReplaced",[a,b]);this._invalidateExtent();this._spatialAccelerator&&(this._spatialAccelerator.remove(a),this._spatialAccelerator.add(b))};a.prototype.notifyObjectBBChanged=function(a,b){this._spatialAccelerator&&this._spatialAccelerator.update(a,b)};a.prototype.getCenter=function(){this._updateExtent();var a=d.create();return d.lerp(this._extent[0],this._extent[1],.5,a)};a.prototype.getBSRadius=function(){this._updateExtent();
return.5*d.dist(this._extent[0],this._extent[1])};a.prototype.getSpatialQueryAccelerator=function(){if(this._spatialAccelerator)return this._spatialAccelerator;if(50<this._children.length)return this._createOctree(),this._spatialAccelerator};a.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};a.prototype.invalidateSpatialQueryAccelerator=function(){this._spatialAccelerator=null};a.prototype.notifyDirty=function(a,c,d,e){d=d||b.LAYER;e=e||this;for(var f=
0;f<this._parentStages.length;f++)this._parentStages[f].notifyDirty(d,e,a,c)};a.prototype._createOctree=function(){for(var a=this.getExtent(),b=0,c=0;3>c;c++)b=Math.max(b,a[1][c]-a[0][c]);c=d.create();d.lerp(a[0],a[1],.5,c);this._spatialAccelerator=new l(c,1.2*b);this._spatialAccelerator.add(this._children)};a.prototype._invalidateExtent=function(){this._extentDirty=!0};a.prototype._updateExtent=function(){if(this._extentDirty)if(0===this._children.length)this._extent=[[0,0,0],[0,0,0]];else{var a=
this._children[0];this._extent=[d.create(a.getBBMin()),d.create(a.getBBMax())];for(a=0;a<this._children.length;++a)for(var b=this._children[a],c=b.getBBMin(),b=b.getBBMax(),e=0;3>e;++e)this._extent[0][e]=Math.min(this._extent[0][e],c[e]),this._extent[1][e]=Math.max(this._extent[1][e],b[e]);this._extentDirty=!1}};a._idGen=new c;return a}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define(["require","exports","../../../../core/arrayUtils","./gl-matrix","./Util"],function(r,g,f,a,c){function b(a,
b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}var l=a.vec3d;r=function(){function a(a,b,c){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._autoResize=!0;this._outsiders=[];c&&(void 0!==c.maximumObjectsPerNode&&(this._maximumObjectsPerNode=c.maximumObjectsPerNode),void 0!==c.maximumDepth&&(this._maximumDepth=c.maximumDepth),void 0!==c.autoResize&&(this._autoResize=c.autoResize));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(b)?this._root=new e(null,l.createFrom(0,0,0),.5):this._root=
new e(null,a,b/2)}Object.defineProperty(a.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"outsiders",{get:function(){return this._outsiders.slice()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"autoResize",{get:function(){return this._autoResize},enumerable:!0,configurable:!0});a.prototype.add=function(a){a=this._objectOrObjectsArray(a);this._grow(a);for(var b=e.acquire(),c=0;c<a.length;c++){var d=a[c];b.init(this._root);0===
d.getBSRadius()||isNaN(d.getBSRadius())||!this._autoResize&&!this._fitsInsideTree(this._boundingSphereFromObject(d,q))?this._outsiders.push(d):this._add(d,b)}e.release(b)};a.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);for(var c=e.acquire(),d=!0,h=0;h<a.length;h++){var d=a[h],k=this._boundingSphereFromObject(b||d,q);0===k.radius||isNaN(k.radius)||!this._autoResize&&!this._fitsInsideTree(k)?d=void 0!==f.removeUnordered(this._outsiders,d):(c.init(this._root),d=this._remove(d,k,c))}e.release(c);
this._shrink();return d};a.prototype.update=function(a,b){this.remove(a,b);this.add(a)};a.prototype.forEachAlongRay=function(a,b,c){var d=this;this._outsiders.forEach(c);this._forEachNode(this._root,function(e){if(!d._intersectsNode(a,b,e))return!1;e=e.node;e.terminals.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});null!==e.residents&&e.residents.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});return!0})};a.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,
b.center,2*b.halfSize)})};a.prototype._intersectsNode=function(a,d,e){b(e.center,2*-e.halfSize,t);b(e.center,2*e.halfSize,p);return c.rayBoxTest(a,d,t,p)};a.prototype._intersectsObject=function(a,b,d){var e=d.getBSRadius();return 0<e?c.raySphere(a,b,d.getCenter(),e):!0};a.prototype._forEachNode=function(a,b){a=e.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(e.acquire().init(a).advance(d));e.release(a)}};
a.prototype._objectOrObjectsArray=function(a){Array.isArray(a)||(h[0]=a,a=h);return a};a.prototype._remove=function(a,b,c){k.length=0;c.advanceTo(b,function(a,b){k.push(a.node,b)})?(a=void 0!==f.removeUnordered(c.node.terminals,a),c=0===c.node.terminals.length):(a=void 0!==f.removeUnordered(c.node.residents,a),c=0===c.node.residents.length);if(c)for(c=k.length-2;0<=c&&this._purge(k[c],k[c+1]);c-=2);return a};a.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===
a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};a.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=[]),!0):!1};a.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,q))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};a.prototype._split=function(a){var b=a.node.residents;
a.node.residents=null;for(var c=0;c<b.length;c++){var d=e.acquire().init(a);this._add(b[c],d);e.release(d)}};a.prototype._grow=function(a){if(0!==a.length&&this._autoResize&&(a=this._boundingSphereFromObjects(a,this._boundingSphereFromObject,m),!isNaN(a.radius)&&0!==a.radius&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))l.set(a.center,this._root.center),this._root.halfSize=1.25*a.radius;else{var b=e.acquire();this._rootBoundsForRootAsSubNode(a,b);this._placingRootViolatesMaxDepth(b)?
this._rebuildTree(a,b):this._growRootAsSubNode(b);e.release(b)}};a.prototype._rebuildTree=function(a,b){var c=this;l.set(b.center,u.center);u.radius=b.halfSize;a=this._boundingSphereFromObjects([a,u],function(a){return a},x);b=e.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,function(a){c.add(a.node.terminals);null!==a.node.residents&&c.add(a.node.residents);return!0});e.release(b)};a.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,
function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};a.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,f=this._root.halfSize,h=0;3>h;h++){var k=Math.max(0,Math.ceil((e[h]-f-(d[h]-c))/(2*f))),l=Math.max(0,Math.ceil((d[h]+c-(e[h]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(k+l)*Math.LOG2E)));v[h].min=k;v[h].max=l}for(h=0;3>h;h++)k=v[h].min,l=v[h].max,
c=(a-(k+l))/2,k+=Math.ceil(c),l+=Math.floor(c),n[h]=e[h]-f-k*f*2+(l+k)*f;return b.initFrom(null,n,a*f,0)};a.prototype._growRootAsSubNode=function(a){var b=this._root.node;l.set(this._root.center,m.center);m.radius=this._root.halfSize;this._root.init(a);a.advanceTo(m,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};a.prototype._shrink=function(){if(this._autoResize)for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=
0}};a.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};a.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};a.prototype._boundingSphereFromObject=function(a,b){l.set(a.getCenter(),
b.center);b.radius=a.getBSRadius();return b};a.prototype._boundingSphereFromObjects=function(a,b,c){if(1===a.length){var d=b(a[0],m);l.set(d.center,c.center);c.radius=d.radius}else{t[0]=Infinity;t[1]=Infinity;t[2]=Infinity;p[0]=-Infinity;p[1]=-Infinity;p[2]=-Infinity;for(var e=0;e<a.length;e++){var d=b(a[e],m),f=t,h=d.center,k=d.radius;f[0]=Math.min(f[0],h[0]-k);f[1]=Math.min(f[1],h[1]-k);f[2]=Math.min(f[2],h[2]-k);f=p;h=d.center;d=d.radius;f[0]=Math.max(f[0],h[0]+d);f[1]=Math.max(f[1],h[1]+d);f[2]=
Math.max(f[2],h[2]+d)}l.scale(l.add(t,p,c.center),.5);c.radius=Math.max(p[0]-t[0],p[1]-t[1],p[2]-t[2])/2}return c};return a}();var e=function(){function a(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=0);this.center=l.create();this.initFrom(a,b,c,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(b,c,d,e){void 0===b&&(b=null);void 0===d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=b||a.createEmptyNode();c&&l.set(c,this.center);
this.halfSize=d;this.depth=e;return this};a.prototype.advance=function(b){var c=this.node.children[b];c||(c=a.createEmptyNode(),this.node.children[b]=c);this.node=c;this.halfSize/=2;this.depth++;b=d[b];this.center[0]+=b[0]*this.halfSize;this.center[1]+=b[1]*this.halfSize;this.center[2]+=b[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=
null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:[],residents:[]}};a.acquire=function(){if(0===this._pool.length)return new a;var b=this._pool[this._pool.length-
1];this._pool.length--;return b};a.release=function(a){this._pool.push(a)};a._pool=[];return a}(),d=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],h=[null],n=l.create(),t=l.create(),p=l.create(),k=[],q={center:l.create(),radius:0},m={center:l.create(),radius:0},u={center:l.create(),radius:0},x={center:l.create(),radius:0},v=[{min:0,max:0},{min:0,max:0},{min:0,max:0}];return r})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/throttle ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../support/debugFlags".split(" "),
function(r,g,f,a,c,b,l,e,d,h){var n=function(){function a(){this.extents=new b(32,d.create);this.tempExtent=d.create()}Object.defineProperty(a.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"area",{get:function(){var a=0;this.extents.forEach(function(b){a+=d.area(b)});return a},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||(this.removeContained(a),
d.set(this.extents.pushNew(),a))};a.prototype.forEach=function(a){this.extents.forEach(function(b){return a(b)})};a.prototype.mergeAll=function(){for(;1<this.extents.length;){var a=this.extents.length-1;d.expand(this.extents.data[a-1],this.extents.data[a]);this.extents.pop()}};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,c=!1;!c;)for(var c=!0,e=0;e<a.length;++e){for(var f=e,h=a.data[f],l=d.area(h),g=!1,n=a.length-1;n>f;--n){var t=a.data[n],r=d.area(t);d.expand(h,t,b);
t=l+r;.05>(d.area(b)-t)/t&&(d.set(h,b),l=d.area(h),a.swap(n,a.length-1),a.pop(),g=!0)}if(g){c=!1;break}}};a.prototype.toArray=function(){return this.extents.toArray()};a.prototype.contains=function(a){return this.extents.some(function(b){return d.contains(b,a)})};a.prototype.removeContained=function(a){for(var b=this.extents.length-1;0<=b;--b)d.contains(a,this.extents.data[b])&&(this.extents.swap(b,this.extents.length-1),this.extents.pop())};return a}();return function(c){function d(){var a=c.call(this)||
this;a.dirtyExtents=new n;a.globalDirty=!1;a.elevationDirtyGraphicsQueue=new b;a.elevationDirtyGraphicsSet={};a.elevationUpdateEventHandle=null;a.eventHandles=[];a.updateElevation=!1;a.layerView=null;a.graphicsCore=null;a.markDirtyThrottled=l.throttle(a.markDirty,100,a);return a}f(d,c);Object.defineProperty(d.prototype,"updating",{get:function(){return 0<this.elevationDirtyGraphicsQueue.length||this.markDirtyThrottled.hasPendingUpdates()},enumerable:!0,configurable:!0});d.prototype.setup=function(a,
b,c,d){var e=this;this.layerView=a;this.graphicsCore=c;this.elevationProvider=d;this.queryGraphicUIDsInExtent=b;this.elevationUpdateEventHandle=d.on("elevation-change",function(a){return e.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",function(){return e.suspendedChange()}))};d.prototype.destroy=function(){this.elevationDirtyGraphicsSet=this.elevationDirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=
null);this.eventHandles.forEach(function(a){return a.remove()});this.eventHandles=null;this.markDirtyThrottled.remove();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=null};d.prototype.clear=function(){this.elevationDirtyGraphicsSet={};this.elevationDirtyGraphicsQueue.clear();this.notifyChange("updating")};d.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};
d.prototype.needsIdleUpdate=function(){return this.elevationProvider&&0<this.elevationDirtyGraphicsQueue.length};d.prototype.idleUpdate=function(a){if(!a.done()&&0!==this.elevationDirtyGraphicsQueue.length){for(var b=this.layerView.view,c=this.graphicsCore.stageLayer.id,d=this.graphicsCore.labelsEnabled?b.labeler.labelStageLayerId:null,e=0;0<this.elevationDirtyGraphicsQueue.length;){var f=this.elevationDirtyGraphicsQueue.pop(),h=this.graphicsCore.graphics[f];h&&h.alignWithElevation(this.elevationProvider,
b.renderCoordsHelper);delete this.elevationDirtyGraphicsSet[f];e++;if(100<=e&&(b._stage.processDirtyLayer(c),null!=d&&b._stage.processDirtyLayer(d),e=0,a.done()))break}0<e&&(b._stage.processDirtyLayer(c),null!=d&&b._stage.processDirtyLayer(d));b.deconflictor.setDirty();b.labeler.setDirty();this.notifyChange("updating")}};d.prototype.markAllGraphicsElevationDirty=function(){for(var a in this.graphicsCore.graphics)this.markGraphicElevationDirty(this.graphicsCore.graphics[a].graphic.uid);this.notifyChange("updating")};
d.prototype.markGraphicElevationDirty=function(a){this.elevationDirtyGraphicsSet[a]||(this.elevationDirtyGraphicsSet[a]=!0,this.elevationDirtyGraphicsQueue.push(a),1===this.elevationDirtyGraphicsQueue.length&&this.notifyChange("updating"))};d.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===b[0]?this.globalDirty=
!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.markDirtyThrottled(),this.notifyChange("updating"))};d.prototype.markDirty=function(){var a=this;if(this.globalDirty)this.markAllGraphicsElevationDirty();else{if(h.ELEVATION_UPDATE_PROFILE_EXTENT_MERGING){var b=this.dirtyExtents,c=b.count,d=b.area,e=performance.now();b.mergeTight();var e=performance.now()-e,f=b.count,b=b.area;1<e&&console.log({deltaTime:e,beforeCount:c,beforeArea:d,afterCount:f,afterArea:b})}else this.dirtyExtents.mergeTight();
this.dirtyExtents.forEach(function(b){a.queryGraphicUIDsInExtent(b,a.spatialReference,function(b){var c=a.graphicsCore.graphics[b];c&&c.needsElevationUpdates()&&a.markGraphicElevationDirty(b)})})}this.dirtyExtents.clear();this.globalDirty=!1;this.notifyChange("updating")};a([e.property({readOnly:!0})],d.prototype,"updating",null);return d=a([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],d)}(e.declared(c))})},"esri/core/throttle":function(){define(["require","exports"],
function(r,g){function f(a,c,b,f){var e=null,d=1E3;"number"===typeof c?(d=c,f=b):(e=c,d=b);var h=0,l,g=function(){h=0;a.apply(f,l)};c=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];e&&e.apply(f,a);l=a;d?h||(h=setTimeout(g,d)):g()};c.remove=function(){h&&(clearTimeout(h),h=0)};c.forceUpdate=function(){h&&(clearTimeout(h),g())};c.hasPendingUpdates=function(){return!!h};return c}Object.defineProperty(g,"__esModule",{value:!0});g.throttle=f;g.default=f})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){function l(a,b){return null!==a&&0<a&&8E7>a||50<b}return function(c){function d(){var a=c.call(this)||this;a._scaleRangeActive=!1;a._layerScaleRangeVisibilityDirty=!0;a.layerScaleRangeVisibilityQuery=!1;a.scaleChangeEventHandle=null;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.suspended=!1;return a}f(d,c);Object.defineProperty(d.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},
set:function(a){this._layerScaleRangeVisibilityDirty!==a&&(this._layerScaleRangeVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0});d.prototype.setup=function(a,b,c,d,e){this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=d;this.basemapTerrain=e;this.updateScaleRangeActive()};
d.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=null};d.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};d.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};d.prototype.idleUpdate=function(a){this.layerView.view.basemapTerrain&&!a.done()&&
this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1)};d.prototype.scaleRangeActive=function(){return this._scaleRangeActive};d.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=!1;b.labelingInfo&&(c=c||b.labelingInfo.some(function(a){return a&&l(a.minScale,a.maxScale)}));c=c||l(b.minScale,b.maxScale);b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=
this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};d.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a)};d.prototype.updateSuspendScaleVisible=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};d.prototype.visibleAtScale=function(a,b,c){return null==a?!0:a>c&&(!b||a<b)};d.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};d.prototype.visibleAtLabelScale=function(a,b){return this.visibleAtScale(a,b.minScale,b.maxScale)};d.prototype.graphicScale=function(a){var b;
a.centroid?b=a.centroid:"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};d.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};d.prototype.updateGraphicScaleVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b)}return!1};d.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};d.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};d.prototype.scaleUpdateHandler=
function(a){var b=this;if(!this.layerView.suspended){var c=a.extent,d=a.scale,e=this.visibleAtLayerScale(d),f=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var h=a.centroid;h&&(c[0]>h.x||c[1]>h.y||c[2]<h.x||c[3]<h.y)||(h=!1,a.setVisibilityFlag(1,e)&&(h=!0),b.updateLabelScaleVisibility(a,d)&&(h=!0),h&&(f=!0))}});f&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=
!0};d.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(1,void 0)}));this.layerScaleRangeVisibilityDirty=!0};a([b.property({readOnly:!0})],d.prototype,"suspended",void 0);a([b.property({readOnly:!0})],d.prototype,"updating",null);return d=a([b.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],d)}(b.declared(c))})},
"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush".split(" "),function(r,g,f,a,c,b,l,e){r=function(b){function c(a){a=b.call(this)||this;a.index=new e.default(9,[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.spatialReference=
null;return a}f(c,b);c.prototype.destroy=function(){this.index.clear();this.index=null};c.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(h.minX=a[0],h.minY=a[1],h.maxX=a[2],h.maxY=a[3],this.index.search(h,function(a){c(a.graphic.uid)}))};c.prototype.add=function(a){!a.addedToSpatialIndex&&a.computeExtent(this.spatialReference)&&(this.index.insert(a),a.addedToSpatialIndex=!0)};c.prototype.addMany=function(a){d.clear();for(var b=0;b<a.length;b++){var c=a[b];!c.addedToSpatialIndex&&
c.computeExtent(this.spatialReference)&&(d.push(c),c.addedToSpatialIndex=!0)}this.index.load(d.data.slice(0,d.length))};c.prototype.remove=function(a){a.addedToSpatialIndex&&(a.addedToSpatialIndex=!1,this.index.remove(a))};c.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.remove(a[b])};c.prototype.clear=function(){this.index.clear()};a([l.property({constructOnly:!0})],c.prototype,"spatialReference",void 0);return c=a([l.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],
c)}(l.declared(c));var d=new b(50),h={minX:0,minY:0,maxX:0,maxY:0};return r})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(r,g,f,a){function c(a,c){b(a,0,a.children.length,c,a)}function b(a,b,c,d,e){e||(e=k(null,!0));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var f=void 0;b<c;b++)f=a.children[b],l(e,a.leaf?d(f):f);return e}function l(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,
b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function e(a,b){return a.minX-b.minX}function d(a,b){return a.minY-b.minY}function h(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function n(a){return a.maxX-a.minX+(a.maxY-a.minY)}function t(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function p(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function k(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,
maxX:-Infinity,maxY:-Infinity}}function q(b,c,d,e,f){for(var h=[c,d];h.length;)if(d=h.pop(),c=h.pop(),!(d-c<=e)){var k=c+Math.ceil((d-c)/e/2)*e;a(b,k,c,d,f);h.push(c,k,k,d)}}Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,b){void 0===a&&(a=9);this.compareMinX=e;this.compareMinY=d;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&this._initFormat(b);this.clear()}a.prototype.all=function(a){this._all(this.data,
a)};a.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(p(a,c))for(m.clear();c;){for(var e=0,f=c.children.length;e<f;e++){var h=c.children[e],k=c.leaf?d(h):h;p(a,k)&&(c.leaf?b(h):t(a,k)?this._all(h,b):m.push(h))}c=m.pop()}};a.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!p(a,b))return!1;for(m.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var f=b.children[d],h=b.leaf?c(f):f;if(p(a,h)){if(b.leaf||t(a,h))return!0;m.push(f)}}b=m.pop()}return!1};a.prototype.load=
function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};a.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};a.prototype.clear=function(){this.data=
k([],!0);return this};a.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,e,f,h,k=this.toBBox(a);x.clear();for(v.clear();c||x.length;){c||(c=x.pop(),d=x.data[x.length-1],e=v.pop(),f=!0);if(c.leaf){a:{h=a;var l=c.children,g=b;if(g){for(var m=0;m<l.length;m++)if(g(h,l[m])){h=m;break a}h=-1}else h=l.indexOf(h)}if(-1!==h){c.children.splice(h,1);x.push(c);this._condense(x);break}}f||c.leaf||!t(c,k)?d?(e++,c=d.children[e],f=!1):c=null:(x.push(c),v.push(e),e=0,d=c,c=c.children[0])}return this};
a.prototype.toJSON=function(){return this.data};a.prototype.fromJSON=function(a){this.data=a;return this};a.prototype._all=function(a,b){for(u.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else u.pushArray(a.children);a=u.pop()}};a.prototype._build=function(a,b,d,e){var f=d-b+1,h=this._maxEntries,l;if(f<=h)return l=k(a.slice(b,d+1),!0),c(l,this.toBBox),l;e||(e=Math.ceil(Math.log(f)/Math.log(h)),h=Math.ceil(f/Math.pow(h,e-1)));l=k([],!1);l.height=e;f=Math.ceil(f/h);h=
f*Math.ceil(Math.sqrt(h));for(q(a,b,d,h,this.compareMinX);b<=d;b+=h){var g=Math.min(b+h-1,d);q(a,b,g,f,this.compareMinY);for(var m=b;m<=g;m+=f)l.children.push(this._build(a,m,Math.min(m+f-1,g),e-1))}c(l,this.toBBox);return l};a.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=Infinity,f=Infinity,k=void 0,l=0,g=b.children.length;l<g;l++){var m=b.children[l],q=h(m),n=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-
Math.min(m.minY,a.minY))-q;n<f?(f=n,e=q<e?q:e,k=m):n===f&&q<e&&(e=q,k=m)}b=k||b.children[0]}return b};a.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);x.clear();d=this._chooseSubtree(c,this.data,b,x);d.children.push(a);for(l(d,c);0<=b;)if(x.data[b].children.length>this._maxEntries)this._split(x,b),b--;else break;this._adjustParentBBoxes(c,x,b)};a.prototype._split=function(a,b){var d=a.data[b],e=d.children.length,f=this._minEntries;this._chooseSplitAxis(d,f,e);e=this._chooseSplitIndex(d,
f,e);e=k(d.children.splice(e,d.children.length-e),d.leaf);e.height=d.height;c(d,this.toBBox);c(e,this.toBBox);b?a.data[b-1].children.push(e):this._splitRoot(d,e)};a.prototype._splitRoot=function(a,b){this.data=k([a,b],!1);this.data.height=a.height+1;c(this.data,this.toBBox)};a.prototype._chooseSplitIndex=function(a,c,d){var e,f,k;e=f=Infinity;for(var l=c;l<=d-c;l++){var g=b(a,0,l,this.toBBox),m=b(a,l,d,this.toBBox),q;q=Math.max(0,Math.min(g.maxX,m.maxX)-Math.max(g.minX,m.minX))*Math.max(0,Math.min(g.maxY,
m.maxY)-Math.max(g.minY,m.minY));g=h(g)+h(m);q<e?(e=q,k=l,f=g<f?g:f):q===e&&g<f&&(f=g,k=l)}return k};a.prototype._chooseSplitAxis=function(a,b,c){var f=a.leaf?this.compareMinX:e,h=a.leaf?this.compareMinY:d,k=this._allDistMargin(a,b,c,f);b=this._allDistMargin(a,b,c,h);k<b&&a.children.sort(f)};a.prototype._allDistMargin=function(a,c,d,e){a.children.sort(e);e=this.toBBox;for(var f=b(a,0,c,e),h=b(a,d-c,d,e),k=n(f)+n(h),g=c;g<d-c;g++){var m=a.children[g];l(f,a.leaf?e(m):m);k+=n(f)}for(g=d-c-1;g>=c;g--)m=
a.children[g],l(h,a.leaf?e(m):m),k+=n(h);return k};a.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)l(b.data[c],a)};a.prototype._condense=function(a){for(var b=a.length-1,d=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(d=a.data[b-1].children,d.splice(d.indexOf(a.data[b]),1)):this.clear():c(a.data[b],this.toBBox)};a.prototype._initFormat=function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));
this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return a}();g.PooledRBush=r;var m=new f(50),u=new f(50),x=new f(10),v=new f(10);g.default=r})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function r(a,c,b,f,e){for(;f>b;){if(600<f-b){var d=f-b+1,h=c-b+1,l=Math.log(d),t=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*t*(d-t)/d)*(0>h-d/2?-1:1);r(a,c,Math.max(b,Math.floor(c-h*t/d+l)),Math.min(f,Math.floor(c+(d-h)*t/d+l)),e)}d=
a[c];h=b;t=f;g(a,b,c);for(0<e(a[f],d)&&g(a,b,f);h<t;){g(a,h,t);h++;for(t--;0>e(a[h],d);)h++;for(;0<e(a[t],d);)t--}0===e(a[b],d)?g(a,b,t):(t++,g(a,t,f));t<=c&&(b=t+1);c<=t&&(f=t-1)}}function g(a,c,b){var f=a[c];a[c]=a[b];a[b]=f}function f(a,c){return a<c?-1:a>c?1:0}return function(a,c,b,l,e){r(a,c,b||0,l||a.length-1,e||f)}})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){return function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.graphics=null;a.renderer=null;a.view=null;return a}f(e,c);a([b.property()],e.prototype,"graphics",void 0);a([b.property()],e.prototype,"renderer",void 0);a([b.property()],e.prototype,"view",void 0);return e=a([b.subclass("esri.views.layers.GraphicsView")],e)}(b.declared(c))})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../lib/glMatrix ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){function q(a){return!!a&&"selection"===a.type}r=h.vec2d;h=h.vec4d;var m=t.VertexAttrConstants,u=c.getLogger("esri.views.3d.graphics.Deconflictor"),x=h.create(),v=h.create(),y=h.create(),A=h.create(),C=e.create(),B=e.create(),D=new Set,E=t.lerp,H=new b(100),F=new b(100),L=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.currentIndex>=
this.list.length&&this.list.push(new this.creator(a));return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,c=this.list;0<=--a;)b(c[a]);this.currentIndex=0};return a}(),G=function(){function a(){this.graphics3DGraphic=null;this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.id=0}a.release=function(a){a.graphics3DGraphic=null;a.graphicsOwner=null};return a}();c=function(){function c(b){var c=this;this.graphicsOwners=
[];this.deconflictTimeoutId=0;this.handles=new a;this.graphicInfoPool=new L(G,G.release);this.nextGraphicInfoId=0;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=b;this.handles.add([b.watch("state.camera",function(){return c.scheduleRun()}),l.whenNot(b,"ready",function(){return c.clearDeconflictTimeout()})])}c.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.clearDeconflictTimeout();
this.graphicInfoPool.freeAll();this.view=this.graphicInfoPool=null};c.prototype.clearDeconflictTimeout=function(){this.deconflictTimeoutId&&(clearTimeout(this.deconflictTimeoutId),this.deconflictTimeoutId=0)};c.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);this.setDirty();a.layer&&"function"===typeof a.layer.watch&&a.layer.watch("featureReduction",function(c,d){q(c)?b.setDirty():q(d)&&(b._removeIconVisibilityFlags(a),b.setDirty())})};c.prototype.removeGraphicsOwner=
function(a){a=this.graphicsOwners.indexOf(a);0<=a&&this.graphicsOwners.splice(a,1);this.setDirty()};c.prototype.setDirty=function(){this.scheduleRun(10)};c.prototype.initializeLabelVisibility=function(a){a.setVisibilityFlag(2,!1,1)};c.prototype.doesIntersectExistingPoly=function(a){var b=a.graphics3DGraphic.graphic.uid;D.clear();for(var c=Math.floor(a.xMin/this.accBinsSizeX);c<=Math.floor(a.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=
Math.floor(a.yMax/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY))for(var e=this.accBins[c][d],f=0;f<e.length;f++){var h=e.data[f];if(h.graphics3DGraphic.graphic.uid!==b&&(this.accNumTests++,!(h.xMin>a.xMax||h.xMax<a.xMin||h.yMin>a.yMax||h.yMax<a.yMin)))return!0}return!1};c.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var d=0;d<this.accBinsNumX;d++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],f=0;f<this.accBinsNumY;f++)e.push(new b(10))}}for(d=
0;d<this.accBinsNumX;d++)for(f=0;f<this.accBinsNumY;f++)this.accBins[d][f].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=c/this.accBinsNumY;this.accNumTests=0};c.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)0>c||c>=this.accBinsNumY||this.accBins[b][c].push(a)};c.prototype.scheduleRun=
function(a){var b=this;void 0===a&&(a=200);0===this.deconflictTimeoutId&&(this.deconflictTimeoutId=setTimeout(function(){return b.run()},a))};c.prototype.run=function(){this.clearDeconflictTimeout();this.view.ready?(this.graphicInfoPool.freeAll(),this.nextGraphicInfoId=0,d.prepare(this.view),this._collectVisibleObjects()&&(this._deconflictVisibleObjects(H,!1),F.length&&this._deconflictVisibleObjects(F,!0),d.drawAccelerationStruct(this,H),d.drawAccelerationStruct(this,F))):this.setDirty()};c.prototype._collectVisibleObjects=
function(){var a=this.view.state.camera,b=a.fullWidth,c=a.fullHeight;H.clear();F.clear();for(var d=!1,e=0;e<this.graphicsOwners.length;e++){var f=this.graphicsOwners[e],h=f.labelsEnabled,k=q(f.layer?f.layer.featureReduction:null);if(h||k){var l=f.graphics3DGraphics;if(l){var g=f.graphics3DGraphicsKeys;if(g){d||(this.initBins(b,c),d=!0);for(var m=0;m<g.length;m++){var n=l[g[m]];n.areVisibilityFlagsSet(void 0,2)&&(k&&this._collectGraphics(n,n._graphics,0,f,a,H,this.iconMarginFactor),h&&this._collectGraphics(n,
n._labelGraphics,1,f,a,F))}}}}}H.sort(function(a,b){return b.posView-a.posView});F.sort(function(a,b){return b.posView-a.posView});return d};c.prototype._collectGraphics=function(a,b,c,d,f,h,l){void 0===l&&(l=0);if(b.length){for(var g=e.empty(C),q,t,r=0;r<b.length;r++){var D=b[r];if(D&&"object3d"===D.type){var F=D.stageObject,L=F?F.getNumGeometryRecords():0;if(!(1>L)){var H=F.getGeometryRecord(0),G=H.materials[0];if(G instanceof p)if(1<L)u.warn("Graphic objects with more than 1 geometry record are not supported");
else{L=H.geometry.getData().getVertexAttr();if(!t){t=F.getCenter();H=H.origin.vec3;k.transformToWorld(t,H,x);k.transformToView(x,H,f.viewMatrix,v);G.applyVerticalOffsetTransformation(v,L[m.NORMAL].data,F.objectTransformation,f,P);F=L[m.AUXPOS1].data;H="screen"!==G.getParams().centerOffsetUnits;k.transformToProjection(v,f.projectionMatrix,H?F:[0,0,0],y);t=k.transformToNDC(y,A);H||(t[0]+=F[0]/f.fullWidth*2,t[1]+=F[1]/f.fullHeight*2);if(-1>t[0]||-1>t[1]||-1>t[2]||1<=t[0]||1<=t[1])break;q=v[2];a.areVisibilityFlagsSet(2,
void 0,c)&&(q*=.7)}D=D.getScreenSize(J);n.applyPrecomputedScaleFactorVec2(D,P.factor,D);G=e.offset(G.calculateRelativeScreenBounds(D,P.scaleAlignment,B),E(0,f.fullWidth,.5+.5*t[0]),E(0,f.fullHeight,.5+.5*t[1]));0!==l&&(D=l*Math.min(e.width(G),e.height(G)),G[0]-=D,G[1]-=D,G[2]+=D,G[3]+=D);e.expand(g,G)}}}}null!=q&&(b=this.graphicInfoPool.alloc(),b.id=this.nextGraphicInfoId++,b.xMin=g[0],b.yMin=g[1],b.xMax=g[2],b.yMax=g[3],b.graphics3DGraphic=a,b.posView=q,b.graphicsOwner=d,h.push(b))}};c.prototype._deconflictVisibleObjects=
function(a,b){for(var c=b?1:0,e=0;e<a.length;e++){var f=a.data[e],h=f.graphics3DGraphic,k=!(b&&!1===h.areVisibilityFlagsSet(2))&&!this.doesIntersectExistingPoly(f);k&&this.addToBins(f);h.setVisibilityFlag(2,k,c);d.drawPoly(f,k?"green":"red")}};c.prototype._removeIconVisibilityFlags=function(a){var b=a.graphics3DGraphics;a=a.graphics3DGraphicsKeys;if(null!=b&&null!=a)for(var c=0;c<a.length;c++)b[a[c]].setVisibilityFlag(2,void 0)};return c}();var P={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},
scaleAlignment:0,minPixelSizeAlignment:0},J=r.create();return c})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(r,g,f,a){function c(a,b,c,f,k){var h=e.height,l=d;l.beginPath();l.lineWidth=1;l.strokeStyle=k;l.moveTo(a,h-c);l.lineTo(b,h-c);l.stroke();l.lineTo(b,h-f);l.stroke();l.lineTo(b,h-c);l.stroke();l.lineTo(a,h-c);l.stroke();l.lineTo(a,h-c);l.stroke();l.closePath()}Object.defineProperty(g,
"__esModule",{value:!0});var b=!1,l=!1,e,d;g.drawAccelerationStruct=function(a,b){if(l&&d){for(var e=d,f=0,h=0;h<a.accBinsNumX;h++)for(var g=0;g<a.accBinsNumY;g++){var m=a.accBins[h][g],f=f+m.length,n=h*a.accBinsSizeX,x=(h+1)*a.accBinsSizeX,v=g*a.accBinsSizeY,y=(g+1)*a.accBinsSizeY;e.fillText(m.length.toFixed(),n+5,v+15);c(n,x,v,y,"blue")}e.fillText("total totalShownLabels: "+f,70,40);e.fillText("total visible labels: "+b.length,70,50);e.fillText("total numTests: "+a.accNumTests,70,30)}};g.prepare=
function(c){b=a.DECONFLICTOR_SHOW_OUTLINES;l=a.DECONFLICTOR_SHOW_GRID;if(b||l)null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),c.surface.parentElement.style.position="relative",c.surface.parentElement.appendChild(e)),e.setAttribute("width",c.width+"px"),e.setAttribute("height",c.height+"px"),e.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),d=e.getContext("2d"),d.clearRect(0,0,c.width,c.height),d.font="8px Arial"};g.drawPoly=
function(a,d){b&&c(a.xMin,a.xMax,a.yMin,a.yMax,d)}})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper dojo/promise/all ../../../../Color ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DWebStyleSymbol ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTexture ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C){Object.defineProperty(g,"__esModule",{value:!0});r=function(l){function g(a){var b=l.call(this)||this;b.labelStageLayer=null;b.scheduledRunTimeoutId=0;b.labelingContexts=[];b.view=a;b.idHint="__labeler";return b}f(g,l);r=g;g.prototype.setup=function(){var a=this;this.handles||(this.handles=new d,this.handles.add([this.view.watch("state.camera",function(){return a.scheduleRun()})]));this.labelStageLayer||(this.labelStageLayer=new v(this.idHint,
{isPickable:!1},this.idHint+"_labels"),this.view._stage.add(x.ModelContentType.LAYER,this.labelStageLayer),this.view._stage.addToViewContent([this.labelStageLayer.id]),this.textTextureAtlas=new C(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new y(this.view._stage),this.calloutMaterialCollection=new y(this.view._stage))};g.prototype.dispose=function(){this.cancelScheduledRun();this.handles&&(this.handles.destroy(),this.handles=null);this.labelStageLayer&&(this.view._stage.removeFromViewContent([this.labelStageLayer.id]),
this.view._stage.remove(x.ModelContentType.LAYER,this.labelStageLayer.id),this.labelStageLayer=null,this.textTextureAtlas.dispose(),this.textTextureAtlas=null,this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null,this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null)};g.prototype.scheduleRun=function(a){var b=this;void 0===a&&(a=200);0===this.scheduledRunTimeoutId&&(this.scheduledRunTimeoutId=setTimeout(function(){return b.run()},a))};g.prototype.cancelScheduledRun=
function(){this.scheduledRunTimeoutId&&(clearTimeout(this.scheduledRunTimeoutId),this.scheduledRunTimeoutId=0)};g.prototype.run=function(){this.cancelScheduledRun();if(this.view.ready){for(var a=!1,b=0,c=this.labelingContexts;b<c.length;b++){var d=c[b];if(!this.labelsEnabled(d))this.clearLabels(d)&&(a=!0);else if(null!==d.labelClassContexts)if(d.labelClassContexts.length||d.labelClassPromise||this.createLabelClassContexts(d),d.labelClassPromise&&!d.labelClassPromise.isResolved())this.setDirty();else{for(var e in d.uninitializedLabels){var f=
d.uninitializedLabels[e];f.graphics3DGraphic.isVisible(0)&&(this.createLabelGraphics3DResources(f,d)?d.initializedLabels[e]=d.uninitializedLabels[e]:d.invalidLabels[e]=d.uninitializedLabels[e],delete d.uninitializedLabels[e],a=!0)}for(e in d.initializedLabels)if(f=d.initializedLabels[e],f.graphics3DGraphic.setVisibilityFlag(0,!0,1),f.graphics3DGraphic.isVisible(1)){if(f.textTextures.length||this.createLabelTextures(f,d),!d.visibleLabels[e]){d.visibleLabels[e]=f;for(var h=0;h<f.graphics3DGraphic._labelGraphics.length;h++)f.textTextures[h]&&
this.textTextureAtlas.addTextTexture(f.textTextures[h],f.graphics3DGraphic._labelGraphics[h].stageObject);d.invisibleLabels[e]&&(a=!0,delete d.invisibleLabels[e])}}else d.visibleLabels[e]&&(delete d.visibleLabels[e],d.invisibleLabels[e]=f,this.removeLabelTextures(f))}}a&&(this.view.deconflictor.setDirty(),this.setDirty())}else this.setDirty()};g.prototype.createLabelClassContexts=function(a){a.labelClassPromise=a.layer.when(function(){a.scaleVisibility&&a.scaleVisibility.updateScaleRangeActive();
var b=a.graphics3DCore,d=b.layer.labelingInfo&&b.layer.labelingInfo.filter(function(a){return!!a.symbol});if(!d||0===d.length)return null;var e=Array(d.length),d=d.map(function(a,c){var d=a.symbol,f;f=b.getOrCreateGraphics3DSymbol(d);f=f instanceof q?f.graphics3DSymbol:f;var h=null;p.isCalloutSupport(d)&&d.hasVisibleCallout()&&(h=k.make(d,b.symbolCreationContext));e[c]={labelClass:a,graphics3DSymbol:f,graphics3DCalloutSymbolLayer:h,options:a.getOptions()};return f});return c(d).then(function(){return e})}).then(function(b){b&&
(a.labelClassContexts=b)}).catch(function(){a.labelClassContexts=null});return a.labelClassPromise};g.prototype.createLabelText=function(a,b,c,d){if(!t.evaluateWhere(b.where,a.attributes))return null;b=b.getLabelExpression();return b.expression?t.buildLabelText(b.expression,a,d.fields,c):null};g.prototype.createLabelGraphic=function(a,b,c,d,e){a={text:a,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,needsOffsetAdjustment:c.needsOffsetAdjustment,
centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:u.LABELS_SHOW_BORDER};r.tmpGraphicCreationContext.graphic=b;r.tmpGraphicCreationContext.renderingInfo=null;r.tmpGraphicCreationContext.layer=d;return e.createGraphics3DGraphic(r.tmpGraphicCreationContext,a,this.hudMaterialCollection,this.textTextureAtlas)};g.prototype.createLabelCalloutGraphic=function(a,b,c,d,e){r.tmpGraphicCreationContext.graphic=a;r.tmpGraphicCreationContext.renderingInfo={symbol:b,needsOffsetAdjustment:d.needsOffsetAdjustment,
translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};r.tmpGraphicCreationContext.layer=e;return c.createGraphics3DGraphic(r.tmpGraphicCreationContext)};g.prototype.createLabelGraphics3DResources=function(a,b){var c=!1;a=a.graphics3DGraphic;var d=a.graphic,e=b.labelClassContexts,f=b.layer,h=this.labelsEnabled(b);if(e&&0!==e.length&&a._graphics[0]){for(var k=
0;k<e.length;k++){var l=e[k],g=l.labelClass,q=this.createLabelText(d,g,l.options,f);if(q){var n=null;l.graphics3DSymbol&&l.graphics3DSymbol.symbol&&"label-3d"===l.graphics3DSymbol.symbol.type&&(n=l.graphics3DSymbol.symbol);var p=l.graphics3DSymbol.childGraphics3DSymbols[0],u=m.get({graphics3DGraphic:a,labelSymbol:n,labelClass:l.labelClass});if(p&&u.isValid){if(c=this.createLabelGraphic(q,d,u,f,p)){if(c._labelClass=g,a.addLabelGraphic(c,this.labelStageLayer,this.view._stage),b.spatialIndex&&b.spatialIndex.add(a),
a.setVisibilityFlag(0,h,1),a.setVisibilityFlag(1,void 0,1),this.view.deconflictor.initializeLabelVisibility(a),c=!0,l.graphics3DCalloutSymbolLayer&&u.hasLabelVerticalOffset&&(d=this.createLabelCalloutGraphic(d,n,l.graphics3DCalloutSymbolLayer,u,f)))a.addLabelGraphic(d,this.labelStageLayer,this.view._stage),l.calloutSymbolLayerIndex=a._labelGraphics.length}else return!1;break}}}b.scaleVisibility&&c&&b.scaleVisibility.updateGraphicLabelScaleVisibility(a);return!0}};g.prototype.createLabelTextures=function(a,
c){var d=a.graphics3DGraphic,e=c.labelClassContexts;c=c.layer;var f=d.graphic;if(e&&0!==e.length&&d._graphics[0])for(d=0;d<e.length;d++){var k=e[d],l=this.createLabelText(f,k.labelClass,k.options,c)||f.symbol&&f.symbol.text;if(l&&!(1>l.length)){var k=k.graphics3DSymbol.childGraphics3DSymbols[0].symbol,g=k.material?b.toUnitRGBA(k.material.color):B,m=k.halo&&k.halo.color&&0<k.halo.size,q=m?b.toUnitRGBA(k.halo.color):B,m=m?h.pt2px(k.halo.size):0,n=h.pt2px(k.size)||12,l=new A(l,{size:n,color:g,font:{family:k.font&&
k.font.family?k.font.family:"Arial",weight:k.font&&k.font.weight?k.font.weight:"normal",style:k.font&&k.font.style?k.font.style:"normal"},halo:{size:m,color:q}},c.id+"_label_"+f.uid);a.textTextures.push(l)}}};g.prototype.addGraphic=function(a,b){var c={graphics3DGraphic:b,textTextures:[]};a.labelGraphicContexts.push(c);a.uninitializedLabels[b.graphic.uid]=c;this.setDirty()};g.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.initializedLabels[b]||a.uninitializedLabels[b];e.removeUnordered(a.labelGraphicContexts,
c);delete a.initializedLabels[b];delete a.uninitializedLabels[b];delete a.invalidLabels[b];delete a.visibleLabels[b];this.removeLabelTextures(c);this.setDirty()};g.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible};g.prototype.getLabelingContext=function(a){var b=this.labelingContexts.filter(function(b){return b.graphics3DCore===a});return b.length?b[0]:null};g.prototype.elevationInfoChange=function(a){for(var b=function(b){b.graphics3DSymbol.layerPropertyChanged("elevationInfo",
{});if(b.graphics3DCalloutSymbolLayer){for(var c={},d=0,e=a.labelGraphicContexts;d<e.length;d++){var f=e[d].graphics3DGraphic;c[f.graphic.uid]=f}b.graphics3DCalloutSymbolLayer.layerPropertyChanged("elevationInfo",c,function(a){return a._labelGraphics[b.calloutSymbolLayerIndex]})}},c=0,d=a.labelClassContexts;c<d.length;c++)b(d[c])};g.prototype.clearLabels=function(a){var b=a.visibleLabels,c=!1,d;for(d in b)c=b[d],this.removeLabelTextures(c),b[d].graphics3DGraphic.setVisibilityFlag(0,!1,1),a.invisibleLabels[d]=
c,c=!0;a.visibleLabels={};this.labelStageLayer.invalidateSpatialQueryAccelerator();return c};g.prototype.resetLabels=function(a){for(var b=0,c=a.labelGraphicContexts;b<c.length;b++){var d=c[b];this.removeLabelTextures(d);d.textTextures=[];d.graphics3DGraphic.clearLabelGraphics();a.uninitializedLabels[d.graphics3DGraphic.graphic.uid]=d}a.initializedLabels={};a.invalidLabels={};a.invisibleLabels={};a.visibleLabels={};a.labelClassPromise=null;this.setDirty()};g.prototype.removeLabelTextures=function(a){for(var b=
0;b<a.graphics3DGraphic._labelGraphics.length;b++)a.textTextures[b]&&this.textTextureAtlas.removeTextTexture(a.textTextures[b],a.graphics3DGraphic._labelGraphics[b].stageObject)};g.prototype.addGraphicsOwner=function(a,b,c){var d=this;if(!this.getLabelingContext(a)){var e={graphics3DCore:a,layer:a.layer,scaleVisibility:b,spatialIndex:c,labelClassPromise:null,labelClassContexts:[],labelGraphicContexts:[],uninitializedLabels:{},initializedLabels:{},invalidLabels:{},visibleLabels:{},invisibleLabels:{}};
this.labelingContexts.push(e);this.setDirty();return{addGraphic:function(a){return d.addGraphic(e,a)},removeGraphic:function(a){return d.removeGraphic(e,a)},updateLabelingInfo:function(){if(d.labelsEnabled(e))return d.resetLabels(e),d.createLabelClassContexts(e)},layerLabelsEnabled:function(){return d.labelsEnabled(e)},elevationInfoChange:function(){d.elevationInfoChange(e)},clear:function(){return d.clearLabels(e)}}}};g.prototype.removeGraphicsOwner=function(a){if(a=this.getLabelingContext(a)){var b=
this.labelingContexts.indexOf(a);this.labelingContexts.splice(b,1);b=0;for(a=a.labelGraphicContexts;b<a.length;b++)this.removeLabelTextures(a[b]);this.setDirty()}};Object.defineProperty(g.prototype,"labelStageLayerId",{get:function(){return this.labelStageLayer.id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isDirty",{get:function(){return!!this.scheduledRunTimeoutId||this.textTextureAtlas&&this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});g.prototype.setDirty=
function(){this.scheduleRun()};Object.defineProperty(g.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return null!==a.labelClassPromise})},enumerable:!0,configurable:!0});g.tmpGraphicCreationContext={graphic:null,renderingInfo:null,layer:null};a([n.property({type:Boolean,readOnly:!0})],g.prototype,"updating",null);return g=r=a([n.subclass()],g);var r}(n.declared(l));g.Labeler=r;var B=[0,0,0,1]})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/Logger ../../../../core/scheduling ./Graphics3DWebStyleSymbol ../../lib/glMatrix ../../webgl-engine/materials/HUDMaterial".split(" "),
function(r,g,f,a,c,b,l){function e(a,c){switch(c.graphics3DGraphic.graphic.geometry.type){case "polyline":case "polygon":case "extent":case "multipoint":a.anchor="center";break;case "point":var e=c.graphics3DGraphic,f=h(e.graphics3DSymbol).symbol.symbolLayers.getItemAt(0),e=e.getCenterObjectSpace();b.vec3d.set(e,a.translation);switch(f.type){case "icon":case "text":e=c.graphics3DGraphic;f=e._graphics[0].getScreenSize();e.isDraped()?a.hasLabelVerticalOffset||(a.anchor="center"):(e=void 0,void 0===
e&&(e=v),c=c.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].materials[0],c instanceof l?(c=c.getParams().anchorPos,e[0]=2*(c[0]-.5),e[1]=2*(c[1]-.5)):(e[0]=0,e[1]=0),c=e,x[0]=f[0]/2*(a.normalizedOffset[0]-c[0]),x[1]=f[1]/2*(a.normalizedOffset[1]-c[1]),a.screenOffset[0]=x[0],a.hasLabelVerticalOffset?(a.centerOffset[1]=x[1],a.centerOffsetUnits="screen"):a.screenOffset[1]=x[1]);break;case "object":d(a,c)}break;case "mesh":d(a,c)}}function d(a,c){c=c.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace();
c=[c[3]-c[0],c[4]-c[1],c[5]-c[2]];a.centerOffset[0]=1.1*Math.max(c[0],c[1])/2*a.normalizedOffset[0];var d=c[2]/2*a.normalizedOffset[1]+a.translation[2];a.translation[2]=d*(1.1-1);a.elevationOffset=d;c=b.vec3d.length(c);a.centerOffset[2]=1.1*c/2*a.normalizedOffset[2]}function h(a){return a instanceof c?a.graphics3DSymbol:a}function n(a,b){var c=b.labelSymbol;b=b.graphics3DGraphic;var d=h(b.graphics3DSymbol).symbol;if("point-3d"===d.type&&d.supportsCallout()&&d.hasVisibleVerticalOffset()&&!b.isDraped())a.verticalOffset=
t(d.verticalOffset);else if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==d.type||!d.supportsCallout()||!d.verticalOffset||b.isDraped())){a:switch(a.placement){case "above-center":b=!0;break a;default:b=!1}b?(a.verticalOffset=t(c.verticalOffset),a.anchor="bottom",a.normalizedOffset=[0,a.normalizedOffset[1],0],a.hasLabelVerticalOffset=!0):(p.error("verticalOffset","Callouts and vertical offset on labels are currently only supported with above-center label placement (not with "+a.placement+" placement)"),
a.isValid=!1)}}function t(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(g,"__esModule",{value:!0});var p=f.getLogger("esri.views.3d.layers.graphics.labelPlacement"),k=null;g.get=function(b){var c=b.labelClass.labelPlacement,d=q[c];d||(null!=c&&null==k&&(p.warn("labelPlacement","'"+c+"' is not a valid label placement"),k=a.schedule(function(){k.remove();k=null})),d=q["default"]);var c=b.graphics3DGraphic._graphics[0],f=
c.graphics3DSymbolLayer.getGraphicElevationContext(b.graphics3DGraphic.graphic),d={placement:d.placement,anchor:d.anchor,normalizedOffset:d.normalizedOffset,needsOffsetAdjustment:"draped"===c.type?void 0:f.hasOffsetAdjustment,verticalOffset:null,screenOffset:[0,0],centerOffset:[0,0,0,-1],centerOffsetUnits:"world",translation:[0,0,0],elevationOffset:0,hasLabelVerticalOffset:!1,isValid:!0};n(d,b);e(d,b);return d};var q={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},
"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},
"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},m={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],
"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};r=function(a){var b=q[a];m[a].forEach(function(a){q[a]=b})};for(var u in m)r(u);Object.freeze&&(Object.freeze(q),Object.keys(q).forEach(function(a){Object.freeze(q[a]);Object.freeze(q[a].normalizedOffset)}));var x=[0,0],v=[0,0]})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports",
"./ModelContentType"],function(r,g,f){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,b){this.materials[a]=b;this.stage.add(f.MATERIAL,b)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(f.MATERIAL,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/arrayUtils ./ModelContentType ./Texture ./Util ../../../webgl/Texture".split(" "),
function(r,g,f,a,c,b,l){return function(){function e(b,f){this.dirty=!1;this.elementsToAdd={};this.elementsToRemove={};this.elementsToRender={};this.elements={};this.stageObjects={};this.id=c.idGen.gen(b);this.stage=f._stage;this.controller=f.resourceController;this.ctx=e.getOrCreate2DCanvas().getContext("2d");this.worker=this.run.bind(this);this.stage.add(a.TEXTURE,this);b=this.computeAtlasResolution(f.width,f.height);this.createAtlasRegion(b);this.update2DCanvasSize()}e.prototype.setUnloadFunc=
function(a){this.unloadFunc=a};e.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};e.prototype.deferredLoading=function(){return!1};e.prototype.getWidth=function(){return this.atlas.size.width};e.prototype.getHeight=function(){return this.atlas.size.height};e.prototype.initializeThroughRender=function(a,b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;return this.glTexture=new l(a,b,e.getOrCreate2DCanvas())};
e.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.glTexture&&(this.glTexture=null,this.stage.remove(a.TEXTURE,this.id))};e.getOrCreate2DCanvas=function(){e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.setAttribute("id","canvas2d"),e.canvas.setAttribute("style","display:none"),e.canvas.setAttribute("width",(512).toString()),e.canvas.setAttribute("height",(512).toString()));return e.canvas};e.prototype.update2DCanvasSize=
function(){e.canvas&&(e.canvas.setAttribute("width",this.atlas.size.width.toString()),e.canvas.setAttribute("height",this.atlas.size.height.toString()))};e.prototype.generateTextId=function(a){return JSON.stringify(a.getParams())+"_"+a.getText()};e.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};e.prototype.computeAtlasResolution=function(a,c){a=Math.max(a,c);a=b.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};
e.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,b);this.update2DCanvasSize()};e.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=0;a.cursor.y=0;a.lineHeight=0};e.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};e.prototype.getExpectedAtlasUsage=function(){var a=Object.keys(this.elementsToRemove).length,b=Object.keys(this.elementsToAdd).length,
c=Object.keys(this.elements).length;return this.getAtlasUsage()/c*(c+b-a)};e.prototype.addAtlasElement=function(a,b,c,e,f){var d=this.atlas;a.placement.offset.x=d.cursor.x;a.placement.offset.y=d.cursor.y;a.placement.size.width=b;a.placement.size.height=c;a.placement.uvMinMax=[a.placement.offset.x/d.size.width,1-(a.placement.offset.y+c)/d.size.height,(a.placement.offset.x+b)/d.size.width,1-a.placement.offset.y/d.size.height];d.cursor.x+=e;d.lineHeight=Math.max(d.lineHeight,f)};e.prototype.removeAtlasElement=
function(a){if(a&&this.elements[a.textId]){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);delete this.elements[a.textId]}};e.prototype.addStageObject=function(a,b){this.stageObjects[a]||(this.stageObjects[a]=[]);-1===this.stageObjects[a].indexOf(b)&&this.stageObjects[a].push(b)};e.prototype.removeStageObject=function(a,b){this.stageObjects[a]&&f.removeUnordered(this.stageObjects[a],b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),
b.geometryVertexAttrsUpdated(0))};e.prototype.processAdditionRequest=function(a){var b=this.atlas,c=a.textId,d=a.textTexture.getRenderedWidth(),e=a.textTexture.getRenderedHeight(),f=d+2,l=e+2+2;if(b.cursor.x+f<b.size.width&&b.cursor.y+l<b.size.height)this.addAtlasElement(a,d,e,f,l),this.elements[c]=a,this.elementsToRender[c]=a,delete this.elementsToAdd[c];else if(b.cursor.y+l+b.lineHeight<b.size.height)b.cursor.x=2,b.cursor.y+=b.lineHeight,b.lineHeight=0,this.addAtlasElement(a,d,e,f,l),this.elements[c]=
a,this.elementsToRender[c]=a,delete this.elementsToAdd[c];else{a=this.getExpectedAtlasUsage();.85<a&&4096>b.size.width&&this.resizeAtlas(2*b.size.width,2*b.size.height);for(var g in this.elementsToRemove)0===this.stageObjects[g].length&&this.removeAtlasElement(this.elementsToRemove[g]),delete this.elementsToRemove[g];if(!(.95<a&&4096===b.size.width)){for(var u in this.elements)b=this.elements[u],b.rendered=!1,this.elementsToAdd[u]=b,delete this.elements[u];this.resetAtlasCursor();this.elementsToRender=
{}}}};e.prototype.processRenderingRequest=function(a){var b=a.textId;this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textTexture.renderText(a.placement.size.width,a.placement.size.height,this.ctx,a.placement.offset.x,a.placement.offset.y);for(var c=0,b=this.stageObjects[b];c<b.length;c++){var d=b[c];d.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);d.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.width,
a.placement.size.height]);d.geometryVertexAttrsUpdated(0)}a.rendered=!0};e.prototype.run=function(a){if(this.dirty){for(var b in this.elementsToAdd)if(this.elements[b]&&this.elements[b].rendered){for(var c=0,d=this.stageObjects[b];c<d.length;c++){var f=d[c],k=f.geometries[0].data.vertexAttributes;k.uv0.data=new Float32Array(this.elements[b].placement.uvMinMax);k.size.data=new Float32Array([this.elements[b].placement.size.width,this.elements[b].placement.size.height]);f.geometryVertexAttrsUpdated(0)}delete this.elementsToAdd[b]}else this.processAdditionRequest(this.elementsToAdd[b]);
c=!1;for(b in this.elementsToRender){if(!a.remaining()){c&&this.glTexture.setData(e.canvas);return}this.processRenderingRequest(this.elementsToRender[b]);delete this.elementsToRender[b];c=!0}c&&this.glTexture.setData(e.canvas);this.dirty=!1;this.controller.deregisterFrameWorker(this.worker)}};e.prototype.addTextTexture=function(a,b){var c=this.generateTextId(a);this.elementsToAdd[c]||(this.elementsToAdd[c]={textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0},uvMinMax:[]},textTexture:a,rendered:!1});
this.addStageObject(c,b);delete this.elementsToRemove[c];this.setDirty()};e.prototype.removeTextTexture=function(a,b){a=this.generateTextId(a);this.elementsToRemove[a]=this.elements[a];this.removeStageObject(a,b);delete this.elementsToAdd[a]};Object.defineProperty(e.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});e.prototype.setDirty=function(){this.dirty||
(this.dirty=!0,this.controller.registerFrameWorker(this.worker))};return e}()})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){Object.defineProperty(g,"__esModule",{value:!0});var q=e.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");r=function(c){function e(a){a=c.call(this,a)||this;a.tiles=new b;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new l;a.clients=new Set;a.geometryEnginePromise=null;return a}f(e,c);Object.defineProperty(e.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))q.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.update())}},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&
(this._set("suspended",a),a||this.update())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||null!=this.geometryEnginePromise},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this.throttledUpdate=d.throttle(this.update,
function(){return a.notifyChange("updating")},1E3,this);var b=this.disableThrottling?function(){return a.update}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a.tileMeasurements=null},!0));this.handles.add(h.init(this,"changeId",b))};e.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};e.prototype.addClient=function(){var a=this,b=m++;this.clients.add(b);1===this.clients.size&&this.update();return{remove:function(){return a.removeClient(b)}}};
e.prototype.removeClient=function(a){this.clients.delete(a);this.hasClients||this.update()};Object.defineProperty(e.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});e.prototype.update=function(){this.suspended||(this.tilingScheme&&this.hasClients?(this.tileMeasurements||(this.tileMeasurements=new k.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:v})),
this.tileMeasurements.begin(this.viewState.camera,this.cameraOnSurface.location.z),this.updateTiles(this.subdivideTilesForView(this.getRootTiles())),this.tileMeasurements.end()):this.tiles.removeAll());this.notifyChange("updating")};e.prototype.getRootTiles=function(){var a=this;return(this.filterExtent?this.tilingScheme.rootTilesInExtent(t.fromExtent(this.filterExtent,x)):[[0,0,0]]).map(function(b){return new p.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};e.prototype.purgeHorizonTiles=
function(a){a.sort(function(a,b){return b.measures.screen.rect[1]-a.measures.screen.rect[1]});t.empty(u);for(var b=0;b<a.length;b++)if(t.expand(u,a[b].measures.screen.rect),t.height(u)>v)return a.slice(b);return[]};e.prototype.subdivideTilesForView=function(a){a=a.slice();for(var b=[];0<a.length;){var c=a.pop();this.tileMeasurements.updateTile(c);0!==c.measures.visibility&&(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),a.push.apply(a,c.getChildren())):b.push(c))}return this.purgeHorizonTiles(b)};
e.prototype.updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){if(a.used)return!1;b.idToTile.delete(a.id);return!0});this.tiles.removeMany(c);this.tiles.addMany(a);this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:b.measures.screen.area-
a.measures.screen.area});this.tiles.forEach(function(a,b){return a.loadPriority=b})};a([n.property({constructOnly:!0})],e.prototype,"renderCoordsHelper",void 0);a([n.property({constructOnly:!0})],e.prototype,"tilingSchemeOwner",void 0);a([n.property({constructOnly:!0})],e.prototype,"cameraOnSurface",void 0);a([n.property({constructOnly:!0})],e.prototype,"viewState",void 0);a([n.property()],e.prototype,"tiles",void 0);a([n.property()],e.prototype,"tileSize",void 0);a([n.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],
e.prototype,"tilingScheme",null);a([n.property()],e.prototype,"filterExtent",null);a([n.property({value:!1})],e.prototype,"suspended",null);a([n.property()],e.prototype,"updating",null);a([n.property({readOnly:!0,dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera"]})],e.prototype,"changeId",null);a([n.property({constructOnly:!0})],e.prototype,"disableThrottling",void 0);return e=a([n.subclass()],e)}(n.declared(c));g.FeatureTileTree3D=r;var m=0,u=t.create(),x=t.create(),
v=10;g.default=r})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,b,l,e){void 0===e&&(e=null);this.lij=[0,0,0];this.extent=f.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:f.create(),area:0},shouldSplit:!1};this.used=!1;e&&this.acquire(a,b,l,e)}a.prototype.acquire=function(c,
b,f,e){this.tilingScheme=e;this.id=a.id(c,b,f);this.lij[0]=c;this.lij[1]=b;this.lij[2]=f;e.getExtent(c,b,f,this.extent);this.resolution=e.resolutionAtLevel(c)};a.prototype.release=function(){this.tilingScheme=null};a.prototype.getChildren=function(c){var b=this.lij[0]+1,f=2*this.lij[1],e=2*this.lij[2];return c?(c[0].acquire(b,f,e,this.tilingScheme),c[1].acquire(b,f+1,e,this.tilingScheme),c[2].acquire(b,f,e+1,this.tilingScheme),c[3].acquire(b,f+1,e+1,this.tilingScheme),c):[new a(b,f,e,this.tilingScheme),
new a(b,f+1,e,this.tilingScheme),new a(b,f,e+1,this.tilingScheme),new a(b,f+1,e+1,this.tilingScheme)]};a.prototype.copyMeasurementsFrom=function(a){this.measures.visibility=a.measures.visibility;this.measures.shouldSplit=a.measures.shouldSplit;this.measures.screen.area=a.measures.screen.area;f.set(a.measures.screen.rect,this.measures.screen.rect)};a.id=function(a,b,f){return a+"/"+b+"/"+f};return a}();g.FeatureTileDescriptor3D=r;g.default=r})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../lib/glMatrix ../../support/geometryUtils".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function g(b){this.screenRect=f.create();this.tileSize=b.tileSize;this.maxVerticalScreenSize=b.maxVerticalScreenSize;this.renderCoordsHelper=b.renderCoordsHelper;this.tilingScheme=b.tilingScheme;this.visibility=new a.FeatureTileVisibility3D({renderCoordsHelper:b.renderCoordsHelper})}g.prototype.begin=function(a,b){this.camera=a;this.z=b;f.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(a,
b)};g.prototype.end=function(){this.visibility.end()};g.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a)};g.prototype.updateScreenMeasure=function(a){var b=d,c=1<<b,e=a.measures.screen.rect;f.empty(e);for(var h=0,k=a.lij[0]+b,l=a.lij[1]<<b,b=a.lij[2]<<b,g=this.tileSizeWithBias(a),g=g*g,m=!1,q=0,n=0;n<c;n++){for(var p=0;p<c&&!(m=this.computeScreenArea(a,k,l+n,b+p,e),h+=m.area,q+=m.screenOverlap*m.area,m=h>g&&
f.height(e)>this.maxVerticalScreenSize);p++);if(m)break}a.measures.shouldSplit=h>g;a.measures.screen.area=q};g.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*h:this.tileSize};g.prototype.computeScreenArea=function(a,c,d,h,k){var g=n.points;this.projectToScreen(c,d,h,1===a.measures.visibility,g);f.empty(l);for(a=0;4>a;a++)f.expandPointInPlace(l,g[a]);f.expand(k,l);f.intersection(l,this.screenRect,e);n.screenOverlap=f.area(e)/f.area(l);n.area=b.triangle.areaPoints2d(g[0],
g[1],g[2])+b.triangle.areaPoints2d(g[0],g[2],g[3]);return n};g.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,t);this.toRenderCoords(a,b,c,t,0,3,k[0]);this.toRenderCoords(a,b,c+1,t,2,3,k[1]);this.toRenderCoords(a,b+1,c+1,t,2,1,k[2]);this.toRenderCoords(a,b+1,c,t,0,1,k[3]);d&&(this.projectToPlane(k,this.camera.frustumPlanes[4]),this.projectToPlane(k,this.camera.frustumPlanes[3]),this.projectToPlane(k,this.camera.frustumPlanes[2]));
for(a=0;4>a;a++)this.camera.projectPoint(k[a],e[a])};g.prototype.projectToPlane=function(a,d){for(var e=0;4>e;e++)q[e]=b.plane.distance(d,a[e]);e=Math.max(q[0],q[1],q[2],q[3]);if(0<e)for(d=c.vec3d.scale(d,-e,p),e=0;4>e;e++)c.vec3d.add(a[e],d)};g.prototype.toRenderCoords=function(a,b,c,d,e,f,h){p[0]=t[e];p[1]=t[f];p[2]=this.z;this.renderCoordsHelper.toRenderCoords(p,this.tilingScheme.spatialReference,h);return h};return g}();g.FeatureTileMeasurements3D=r;var l=f.create(),e=f.create(),d=2,h=5,n={points:[c.vec3d.create(),
c.vec3d.create(),c.vec3d.create(),c.vec3d.create()],area:0,screenOverlap:0},t=f.create(),p=c.vec3d.create(),k=[c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create()],q=[0,0,0,0];g.default=r})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ./FeatureTileDescriptor3D ../../lib/glMatrix ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),function(r,
g,f,a,c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new b.Frustum({renderCoordsHelper:a});this.extendedFrustum=new b.Frustum({renderCoordsHelper:a});this.intersector=new l.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};a.prototype.end=function(){this.cache.clear()};a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=h&&a.lij[0]<n,c=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==c&&b?this.calculateAggregatedChildrenVisibility(a):c};a.prototype.shortenFrustumFarPlane=function(a){for(var d=a.points,e=0,f=b.Frustum.nearFarLineIndices;e<f.length;e++){var h=f[e],
k=h[1],h=d[h[0]];c.vec3d.add(h,c.vec3d.scale(c.vec3d.subtract(d[k],h,p),t),d[k])}a.updatePoints(d)};a.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=k.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}k.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);
b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=function(a){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,this.aboveGround);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};a.prototype.updateExtendedFrustum=function(a,b){var f=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var h=this.renderCoordsHelper.worldUpAtPosition(a.eye,
p);this.aboveGround||c.vec3d.negate(h);h=d.acos(-c.vec3d.dot(h,a.viewForward));this.allTilesInvisible=h>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=h>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.points;for(h=0;4>h;h++){var k=a.pointIndices[h],l=b[k],g=f.getAltitude(l);if(a.needsAltitudeAdjustment(g)){this.renderCoordsHelper.worldUpAtPosition(l,p);switch(k){case 4:case 7:case 0:case 3:e.plane.projectVector(this.extendedFrustum.planes[0],p);break;
case 5:case 6:case 1:case 2:e.plane.projectVector(this.extendedFrustum.planes[1],p)}c.vec3d.scale(p,a.direction);this.renderCoordsHelper.intersectManifold(l,p,a.zWithMargin,l)}}this.extendedFrustum.updatePoints(b);0>c.vec3d.dot(this.extendedFrustum.planes[4],this.frustum.planes[4])&&(f=this.extendedFrustum.points,this.aboveGround?(a=[f[1],f[0]],f[0]=a[0],f[1]=a[1]):(a=[f[2],f[3]],f[3]=a[0],f[2]=a[1]),this.extendedFrustum.updatePoints(f))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?
this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,c){var d=a-c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(a){return a>d}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,c){var d=a+c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<d}}};
return a}();g.FeatureTileVisibility3D=r;var h=2,n=6,t=.95,p=c.vec3d.create(),k=new f(Array,function(b){4!==b.length&&(b[0]=new a.FeatureTileDescriptor3D,b[1]=new a.FeatureTileDescriptor3D,b[2]=new a.FeatureTileDescriptor3D,b[3]=new a.FeatureTileDescriptor3D)},function(a){a[0].release();a[1].release();a[2].release();a[3].release()});g.default=r})},"esri/views/3d/state/Frustum":function(){define("require exports ../lib/glMatrix ../support/geometryUtils ../support/intersectionUtils ../webgl-engine/lib/Util".split(" "),
function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function l(b){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=f.vec3d.create();this.direction=f.vec3d.create();this._altitude=null;this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;6>b;b++)this.planes[b]=a.plane.create();for(b=0;8>b;b++)this.points[b]=f.vec3d.create();for(b=0;12>b;b++)this.lines[b]={origin:null,direction:f.vec3d.create(),endpoint:null}}l.prototype.update=function(a){b.matrixToFrustumPoints(a.viewMatrix,
a.projectionMatrix,this.points);this.updatePoints(this.points);f.vec3d.set(a.eye,this.origin);f.vec3d.set(a.viewForward,this.direction);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};l.prototype.updatePoints=function(a){if(a!==this.points)for(var c=0;c<this.points.length;c++)f.vec3d.set(a[c],this.points[c]);b.frustumPointsToPlanes(this.points,this.planes);this.updateLines()};Object.defineProperty(l.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,
configurable:!0});l.prototype.intersectsSphere=function(a,b){return c.frustumSphere(this.planes,a,b)};l.prototype.intersectsRay=function(a,b,f){return c.frustumRay(this.planes,a,b,f)};l.prototype.intersectsLineSegment=function(a,b,f){return c.frustumLineSegment(this.planes,a,b,f)};l.prototype.intersectsPoint=function(a){return c.frustumPoint(this.planes,a)};l.prototype.updateLines=function(){for(var a=0;4>a;a++){var b=a,c=a+4;this.updateLine(this.lines[a],this.points[b],this.points[c]);this.updateLine(this.lines[a+
4],this.points[b],3===a?this.points[0]:this.points[b+1]);this.updateLine(this.lines[a+8],this.points[c],3===a?this.points[4]:this.points[c+1])}};l.prototype.updateLine=function(a,b,c){a.origin=b;a.endpoint=c;f.vec3d.direction(c,b,a.direction)};l.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};l.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return l}();g.Frustum=r;g.default=r})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../lib/glMatrix ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h){Object.defineProperty(g,"__esModule",{value:!0});r=.5*Math.PI;var n=r/Math.PI*180,t=r*b.earthRadius,p=.9*b.earthRadius;b=function(){function b(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:c.vec3d.create(),direction:c.vec3d.create()};for(a=0;4>a;a++)this.extent[a]={origin:c.vec3d.create(),direction:c.vec3d.create(),cap:{next:null,direction:c.vec3d.create()}},this.planes[a]=l.plane.create();
this.planes[4]=l.plane.create();this.planes[5]=l.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}b.prototype.update=function(a,b,d,e){void 0===e&&(e=!0);var f=this.extent;this.toRenderBoundingExtent(a,b,d);c.vec3d.add(f[0].origin,f[2].origin,this.center.origin);c.vec3d.scale(this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||c.vec3d.scale(this.center.direction,-1);for(d=0;4>d;d++){var h=f[d];this.renderCoordsHelper.worldUpAtPosition(h.origin,
h.direction);var k=f[3===d?0:d+1];h.cap.next=k.origin;c.vec3d.direction(k.origin,h.origin,h.cap.direction);l.plane.fromVectorsAndPoint(h.direction,h.cap.direction,h.origin,this.planes[d]);e||c.vec3d.scale(h.direction,-1)}l.plane.fromVectorsAndPoint(f[0].cap.direction,f[1].cap.direction,f[0].origin,this.planes[4]);e?l.plane.negate(this.planes[4],this.planes[5]):(l.plane.set(this.planes[5],this.planes[4]),l.plane.negate(this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));
this.maxSpanSpatialReference=b};b.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?n:t))return!0;if(a.altitude>=p)return this.isVisibleInFrustumGlobal(a)}for(var c=0;c<this.extent.length;c++){var d=this.extent[c];if(!b&&a.intersectsRay(d.origin,null,d.direction)||a.intersectsLineSegment(d.origin,d.cap.next,d.cap.direction))return!0}b=b?this.planes:this.planesWithoutFar;for(c=0;c<a.lines.length;c++)if(d=
a.lines[c],e.frustumLineSegment(b,d.origin,d.endpoint,d.direction))return!0;return!1};b.prototype.toRenderBoundingExtentGlobal=function(b,e,l){a.center(b,q);q[2]=l;h.computeLinearTransformation(e,q,m,this.renderCoordsHelper.spatialReference);c.mat4d.inverse(m,u);f.empty(x);for(var g=0,n=k;g<n.length;g++)for(var p=n[g],t=p.x0,v=p.x1,r=p.y0,p=p.y1,y=0;5>y;y++){var A=y/4;q[0]=d.lerp(b[t],b[v],A);q[1]=d.lerp(b[r],b[p],A);q[2]=l;h.vectorToVector(q,e,q,this.renderCoordsHelper.spatialReference);c.mat4d.multiplyVec3(u,
q);f.expandPointInPlace(x,q)}c.mat4d.multiplyVec3(m,c.vec3d.set3(x[0],x[1],x[2],this.extent[0].origin));c.mat4d.multiplyVec3(m,c.vec3d.set3(x[3],x[1],x[2],this.extent[1].origin));c.mat4d.multiplyVec3(m,c.vec3d.set3(x[3],x[4],x[2],this.extent[2].origin));c.mat4d.multiplyVec3(m,c.vec3d.set3(x[0],x[4],x[2],this.extent[3].origin))};b.prototype.toRenderBoundingExtentLocal=function(a,b,d){c.vec3d.set3(a[0],a[1],d,this.extent[0].origin);c.vec3d.set3(a[2],a[1],d,this.extent[1].origin);c.vec3d.set3(a[2],a[3],
d,this.extent[2].origin);c.vec3d.set3(a[0],a[3],d,this.extent[3].origin)};b.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c)}};b.prototype.isVisibleInFrustumGlobal=function(a){if(0>c.vec3d.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>c.vec3d.dot(this.extent[b].direction,a.direction))return!0;return!1};return b}();g.FrustumExtentIntersection=
b;var k=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],q=c.vec3d.create(),m=c.mat4d.create(),u=c.mat4d.create(),x=f.create();g.default=b})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h){Object.defineProperty(g,"__esModule",{value:!0});var n=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];r=function(){function g(d){var f=this;this.view=d;this.graphics=[];this.handles=new a;this._enabled=!0;this.symbols=n.map(function(a){return new e(new b({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([d.featureTiles.addClient(),c.on(d.featureTiles,"tiles","change",function(){return f.update()},function(){return f.update()})])}Object.defineProperty(g.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};g.prototype.update=
function(){var a=this;this.clear();if(this._enabled){var b=this.view.featureTiles,c=b.tilingScheme,e=b.tiles.toArray().sort(function(a,b){return a.loadPriority-b.loadPriority});e.forEach(function(b,k){var g=b.lij,m=g[0],q=g[1],n=g[2],p=c.getExtentGeometry(m,q,n),g=new f({geometry:p,symbol:a.symbols[m%a.symbols.length]}),t=k/(e.length-1);k=h.lerp(0,200,t);var t=h.lerp(20,6,t),u=b.loadPriority>=e.length;b=new f({geometry:p.center,symbol:new l({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new d({text:m+"/"+q+"/"+n+" ("+b.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[k,u?0:k,u?0:k]},size:t/.75})]})});a.graphics.push(g,b);a.view.graphics.addMany([g,b])})}};g.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return g}();g.FeatureTileTree3DDebugger=r;g.default=r})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../views/ViewAnimation ../lib/glMatrix ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function g(a){a=c.call(this,a)||this;a.propertiesPool=new k.default({camera:q},a);a.events=new p.Evented;a.updateQueue=new x;a.processingUpdates=!1;return a}f(g,c);g.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};g.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),mode:a.viewingMode,spatialReference:a.spatialReference,
constraints:new d.default({mode:a.viewingMode})}};Object.defineProperty(g.prototype,"animation",{get:function(){return this.cameraController instanceof h.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==m&&m.copyFrom(a);m.markViewDirty();m.computeUp(this.mode);u.camera=m;this.events.emit("before-camera-change",u);(a=this._get("camera"))&&a.equivalent(m)||
this._set("camera",this.propertiesPool.get("camera").copyFrom(m))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===n.State.Finished||c===n.State.Stopped)b._set("cameraController",null),b.updateCamera(function(b){a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=n.State.Rejected)},enumerable:!0,configurable:!0});g.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==
n.State.Rejected};g.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};g.prototype.cameraChanged=function(){this.updateCamera(function(){})};g.prototype.updateCamera=function(a){this.updateQueue.enqueue(a);this.processingUpdates||this.processUpdateQueue()};g.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.dequeue();m.copyFrom(this._get("camera"));
a(m);this.camera=m;this.processingUpdates=!1;this.processUpdateQueue()}};g.prototype.createInitialCamera=function(a){return"global"===a?new q(e.vec3d.createFrom(4*t.earthRadius,0,0),e.vec3d.createFrom(t.earthRadius,0,0),e.vec3d.createFrom(0,0,1)):new q(e.vec3d.createFrom(0,0,100),e.vec3d.createFrom(0,0,0),e.vec3d.createFrom(0,1,0))};a([b.property({readOnly:!0,type:l,dependsOn:["cameraController"]})],g.prototype,"animation",null);a([b.property({type:q})],g.prototype,"camera",null);a([b.property({constructOnly:!0})],
g.prototype,"constraints",void 0);a([b.property({readOnly:!0})],g.prototype,"events",void 0);a([b.property({readOnly:!0,dependsOn:["isLocal"]})],g.prototype,"isGlobal",null);a([b.property({readOnly:!0,dependsOn:["mode"]})],g.prototype,"isLocal",null);a([b.property({constructOnly:!0})],g.prototype,"mode",void 0);a([b.property({constructOnly:!0})],g.prototype,"spatialReference",void 0);a([b.property({readOnly:!0,dependsOn:["cameraController"]})],g.prototype,"interacting",null);a([b.property()],g.prototype,
"cameraController",null);return g=a([b.subclass()],g)}(b.declared(c));g.ViewState=r;var m=new q,u={camera:null},x=function(){function a(){this.data=[];this.length=this.ptr=0}a.prototype.enqueue=function(a){this.data.push(a);this.length++};a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=this.data.length=0);return a};return a}();g.default=r})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(r,
g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(){this._listeners={}}f.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};f.prototype.on=function(a,c){var b=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var f={};this._listeners[a].set(f,c);return{remove:function(){return b._listeners[a].delete(f)}}};f.prototype.emit=function(a,c){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(c)})};
return f}();g.Evented=r})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/lang ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../geometry/Point ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ../lib/glMatrix ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ./helpers/PickingHelper ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J){Object.defineProperty(g,"__esModule",{value:!0});var M=n.getLogger("esri.views.3d.state.ViewStateManager");r=function(e){function g(a){a=e.call(this)||this;a.propertiesPool=new L.default({frustum:B.default},a);a.handles=new h;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToPromise=null;a.animatedGoToPromise=null;a.ready=!1;return a}f(g,e);Object.defineProperty(g.prototype,"camera",{get:function(){return this.ready?F.internalToExternal(this.view,
this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(F.externalToInternal(this.view,a),{applyConstraints:!1})||M.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),
{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():M.error("#center\x3d","Invalid center",a):M.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):M.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"extent",{get:function(){return this.ready?F.toExtent(this.view,null,
null,null,N):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||M.error("#extent\x3d","Invalid extent",a):M.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):M.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;
return F.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||M.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding,b=this._get("padding");return null!==b&&b.top===a[0]&&b.right===a[1]&&b.bottom===a[2]&&b.left===
a[3]?b:{top:a[0],right:a[1],bottom:a[2],left:a[3]}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?A.vec4d.set4(a.top||0,a.right||0,a.bottom||0,a.left||0,W):A.vec4d.set4(0,0,0,0,W),this.view.state.updateCamera(function(a){a.padding=W}))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"screenCenter",{get:function(){var a=this.padding;return new u((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"viewpoint",{get:function(){return this.ready?G.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||M.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;M.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else M.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"zoom",{get:function(){return this.ready?F.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||M.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});g.prototype.initialize=
function(){var a=this;this.pickingHelper=new H.PickingHelper(this.view);this.handles.add(this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),p.on(this.view,"state.events","before-camera-change",function(b){return a.beforeCameraChangeHandle(b.camera)}));this.handles.add(this.view.on("resize",function(b){return a.handleResize(b.width,b.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(X);a.cancelImmediateGoTo()}));
this.handles.add(p.on(this.view,"pointsOfInterest.events","camera-parameters-changed",function(){return a.notifyChange("scale")}))};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};g.prototype.init=function(){var a=this;this.constraintsManager=new C.default({view:this.view});this.handleResize(this.view.width,this.view.height);var b=this.getInitialProperties();this.cameraSetByUser=
!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(p.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(X);a.setInitialView(a.view.groundExtent)}),X))};g.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),
this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(X),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};g.prototype.goTo=function(a,b){b=c.mixin({animate:!0},b);return b.animate?this.goToAnimated(a,b):this.goToImmediate(a,b)};g.prototype.debugSetCameraOnContent=function(){this.setStateCamera(y.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};
g.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};g.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};g.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};g.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=
[],d=0,e=aa;d<e.length;d++){var f=e[d],h=f.propertyName,f=f.overrides,k=b.has(h),g=this._isOverridden(h);!k&&g&&c.push({name:h,value:this._get(h)});this._clearOverride(h);(k||g)&&f.forEach(function(a){return b.add(a)})}return c.sort(function(b,c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};g.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser){var c={applyConstraints:!0};a instanceof b?c.applyConstraints=!1:a instanceof l?a.targetGeometry instanceof
q?a=F.fromExtent(this.view,a.targetGeometry,0,.5,{noReset:!0}):(a.camera&&(c.applyConstraints=!1),a=G.toCamera(this.view,a)):a=F.fromExtent(this.view,a,0,.5,{noReset:!0});this.setStateCamera(F.externalToInternal(this.view,a),c)}};g.prototype.updatePropertyBeforeReady=function(a,b){if(this.ready)return!1;this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==O.indexOf(a)&&this._override("hasInitialView",
!0));return!0};g.prototype.isCompatible=function(a){return a?a instanceof l?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof b?this.isCompatible(a.position):a.spatialReference&&x.canProject(a.spatialReference,this.view.spatialReference):!1};g.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=V);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};g.prototype.centerPointAtDistanceToCamera=function(a,
b,c){void 0===c&&(c=S);var d=this.getPreservingHeadingTilt();return(a=F.eyeHeadingTiltForCenterPointAtDistance(this.view,d.heading,d.tilt,a,b))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};g.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();return this.centerPointAtDistanceToCamera(a,b.distance)};g.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();if(a=F.fromExtent(this.view,a,b.heading,
b.tilt,N))return F.externalToInternal(this.view,a)};g.prototype.scaleToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();var c=b.renderLocation;a=F.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};g.prototype.zoomToCamera=function(a){return this.scaleToCamera(F.zoomToScale(this.view,a))};g.prototype.viewpointToCamera=function(a){return(a=G.toCamera(this.view,a))?F.externalToInternal(this.view,a):null};g.prototype.setStateCamera=
function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&v.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new E.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};g.prototype.handleResize=function(a,b){var c=this.view.canvas;!c||c.width===a&&c.height===b||(c.width=a,c.height=b);this.view.state&&
(c=this.view.state.camera,c.fullWidth!==a||c.fullHeight!==b)&&(S.copyFrom(c),S.fullWidth=a,S.fullHeight=b,this.view.state.camera=S)};g.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)};g.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};g.prototype.updateCameraAboveGround=function(a){var b=this.view.basemapTerrain,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b&&b.spatialReference?y.surfaceElevationBelowEye(this.view,a):
0;a.aboveGround=c>=b};g.prototype.createGoToCamera=function(a){var c=this;return p.whenOnce(this,"ready",null,!0).then(function(){return G.create(c.view,a)}).then(function(e){var f=!!(a instanceof l&&a.camera||a instanceof b),h=e.camera;if(!c.isCompatible(h))throw e=(e=h.position)&&e.spatialReference,new d("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+(e?e.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:h});h=F.externalToInternal(c.view,
h);if(!h)throw new d("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:e,camera:h,isFullySpecified:f}})};g.prototype.cancellableGoTo=function(a){var b=this,c;return t.create(function(b,d){c={resolve:b,reject:d};a.asyncResult=c},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===c&&a.stopController()})};g.prototype.goToImmediate=function(a,b){var c=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var e=this.createGoToCamera(a).then(function(a){c.immediateGoToPromise===
e&&(c.immediateGoToPromise=null);c.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){c.immediateGoToPromise===e&&(c.immediateGoToPromise=null);a instanceof d&&a.message&&M.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=e};g.prototype.goToAnimatedBeforeReady=function(a,b){var c=this;this.cancelAnimatedGoTo();var e=p.whenOnce(this.view,"ready").then(function(){if(e===
c.animatedGoToPromise)return c.animatedGoToPromise=null,c.goToAnimated(a,b);throw new d("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=e};g.prototype.goToAnimated=function(a,b){var c=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,b);var e=this.view.state.cameraController,f;e instanceof D.PointToPointAnimationController&&(e.updateStateFromViewAnimation(),e.active&&(f=e));null==f&&(f=new D.PointToPointAnimationController(this.view.state,this.pickingHelper));
var h=f.viewAnimation;a=this.createGoToCamera(a);var k=a.then(function(a){return a.viewpoint});h.update(k);if(f!==e&&!this.view.state.switchCameraController(f))return h.stop(),M.error("#goTo()","Cannot start an animation while interacting"),t.reject(new d("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var g=h.target,l=function(){return c.view.state.cameraController===f&&f.viewAnimation.target===g&&f.active};a.then(function(a){var d=a.viewpoint,e=a.camera;a=a.isFullySpecified;
if(l()){f.viewAnimation.update(d);g=f.viewAnimation.target;var k;a?(k=new E.SurfaceCollisionCorrectionController({view:c.view,desiredCamera:e}),v.applySurfaceCollision(c.view,e,1)):v.applyAll(c.view,e);f.begin(e,c.internalAnimateOptions(b));return h.when().then(function(){var a=c.view.state.cameraController;k&&(a&&a.active?a instanceof D.PointToPointAnimationController&&a.viewAnimation.target===g&&(c.view.state.cameraController=k):f.viewAnimation.target===g&&(c.view.state.cameraController=k))})}}).catch(function(a){a instanceof
d&&a.message&&M.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(l())throw c.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(f)};g.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?J.named[a.easing]:a.easing));
return b};a([k.property({type:b,dependsOn:["view.state.camera","ready"]})],g.prototype,"camera",null);a([k.property({type:m,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],g.prototype,"center",null);a([k.property({type:q,dependsOn:["view.state.camera","ready"]})],g.prototype,"extent",null);a([k.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],g.prototype,"frustum",null);a([k.property({readOnly:!0,dependsOn:["view.map.initialViewProperties.viewpoint"]})],g.prototype,
"hasInitialView",null);a([k.property({readOnly:!0,type:Boolean})],g.prototype,"ready",void 0);a([k.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],g.prototype,"scale",null);a([k.property({dependsOn:["view.state.camera","ready"]})],g.prototype,"padding",null);a([k.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],g.prototype,"screenCenter",null);a([k.property({constructOnly:!0})],g.prototype,"view",void 0);a([k.property({type:l,
dependsOn:["camera","ready"]})],g.prototype,"viewpoint",null);a([k.property({type:Number,dependsOn:["scale"]})],g.prototype,"zoom",null);return g=a([k.subclass("esri.views.3d.state.ViewStateManager")],g)}(k.declared(e));g.ViewStateManager=r;var O="camera viewpoint extent scale center zoom".split(" "),aa=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",
overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],V={heading:0,tilt:0},N=new b,S=new P,W=A.vec4d.create(),X="pending-initial-view";g.default=r})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function g(a){var d=c.call(this)||this;d.handles=new b;d.nearFarHeuristic=n.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return d}f(g,c);g.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)],"clipDistance");this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)],"altitude");this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},
!0),this.view.watch("constraints.tilt.mode",function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)],"tilt");this.handles.add([this.view.watch("constraints.collision.enabled",function(){return a.handleCollisionEnabledChanged()},!0)],"collision");this.view.state.isLocal&&this.handles.add(l.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();
this.updateTilt();this.updateCollision();this._set("surfaceCollisionConstraint",new t.default({view:this.view}))};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};g.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};g.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};g.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};g.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};g.prototype.cameraUpdateNearFarAuto=function(a,b){var c=this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,h.surfaceElevationBelowEye(this.view,a),k),d=c.distance,e=c.maxFarNearRatio,c=c.minNearDistance;d/e>c?(a.far=d,a.near=a.far/e):(a.near=c,a.far=a.near*e);b&&b.autoUpdate(a.near,a.far)};g.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};g.prototype.handleCollisionEnabledChanged=function(){this.updateCollision()};g.prototype.updateCollision=function(){var a=this.view.constraints&&this.view.constraints.collision,b=this.view.state.constraints.collision,
a=a?a.enabled:!1;a!==b.enabled&&(b.enabled=a)&&this.reapplyConstraints(8)};g.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};g.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};g.prototype.handleTiltModeChanged=function(){this.updateTilt()};g.prototype.handleTiltMaxChanged=function(){var a=this.view.constraints&&
this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};g.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};g.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(p.deg2rad(a.max))};g.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;a.tilt=a.createDefaultTilt();
this.tiltAutoUpdateMax()};g.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(p.rad2deg(b)))}};g.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&(a.constraints.distance=b))};
g.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return d.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null})})};a([e.property({constructOnly:!0})],g.prototype,"view",void 0);a([e.property({readOnly:!0})],g.prototype,"surfaceCollisionConstraint",void 0);return g=a([e.subclass("esri.views.3d.state.ConstraintsManager")],g)}(e.declared(c));g.ConstraintsManager=
r;var k={distance:0,maxFarNearRatio:0,minNearDistance:0};g.default=r})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../geometry/support/scaleUtils ../lib/glMatrix ../support/earthUtils ../support/mathUtils".split(" "),function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});g.createNearFarHeuristic=function(a,b,c){return"global"===a?new e:new l(b,c)};var l=function(){function e(a,b){this.elevationProvider=a;this.unitInMeters=f.getMetersPerUnitForSR(b)}
e.prototype.compute=function(e,f,g,l,q){q||(q={maxFarNearRatio:0,distance:0,minNearDistance:0});var m=c.earthRadius;q.maxFarNearRatio=d;q.minNearDistance=h/this.unitInMeters;var u=e[2]*this.unitInMeters,v=u;l=u-l;var x=this.elevationProvider?this.elevationProvider.getElevationBounds():null;x&&(u=0<=l?v-this.unitInMeters*x[0]:this.unitInMeters*x[1]-v);v=Math.max(g.xmax-g.xmin,g.ymax-g.ymin,4*Math.max(g.xmax-g.xmin,g.ymax-g.ymin));a.vec3d.subtract(f,e,k);p[0]=0<k[0]?g.xmax:g.xmin;p[1]=0<k[1]?g.ymax:
g.ymin;p[2]=0<k[2]?v/2:-v/2;a.vec3d.subtract(p,e);a.vec3d.normalize(k);e=1.1*a.vec3d.dot(p,k)*this.unitInMeters;m=Math.sqrt(u*(u+2*m));g=Math.max(g.xmax-g.xmin,g.ymax-g.ymin);f=g*t*this.unitInMeters;u=b.clamp((u-f)/(g*n*this.unitInMeters-f),0,1);q.distance=b.lerp(m,e,u*u*u);q.distance*=Math.max(Math.log(Math.abs(l)),1);q.distance=Math.min(q.distance,Math.max(34064E4,v));q.distance/=this.unitInMeters;return q};return e}(),e=function(){function e(){}e.prototype.compute=function(e,f,k,g,l){l||(l={maxFarNearRatio:0,
minNearDistance:0,distance:0});f=c.earthRadius;e=a.vec3d.length(e)-f;l.maxFarNearRatio=d;l.minNearDistance=h/1;e=Math.max(Math.abs(e-g),Math.abs(e));g=Math.sqrt(e*(e+2*(f+Math.min(0,g))));l.maxFarNearRatio=b.clamp(2E4-(Math.log(e)-7.983)/9.011*19E3,1E3,2E4);l.distance=1.2*g/1;return l};return e}(),d=2E4,h=2,n=.001,t=1E-4,p=a.vec3d.create(),k=a.vec3d.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(r,g,f,a,c,b,l,e,d){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function h(a){a=c.call(this)||this;a.handles=new b;return a}f(h,c);h.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};h.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
d.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};h.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){e.applySurfaceCollision(a.view,b,1)})};a([l.property({constructOnly:!0})],h.prototype,"view",void 0);return h=a([l.subclass("esri.views.3d.state.ElevationCollisionConstraint")],h)}(l.declared(c));g.SurfaceCollisionConstraint=r;g.default=r})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(e){function d(b){var c=e.call(this)||this;c.handles=new a;c.view=b.view;c.desiredCamera=b.desiredCamera.copy();return c}f(d,e);Object.defineProperty(d.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(a){var b=
this;e.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};d.prototype.onControllerEnd=function(a){this.handles.removeAll();e.prototype.onControllerEnd.call(this,a)};d.prototype.handleElevationChangeEvent=function(a){b.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};d.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
c.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=l.State.Stopped)})};return d}(l.CameraController);g.SurfaceCollisionCorrectionController=r})},"esri/views/3d/support/cameraUtils":function(){define("require exports dojo/_base/lang ../../../Camera ../../../config ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/glMatrix ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){function x(a){return"global"===a.viewingMode?p:t}function v(c,d,e){var f=c.renderSpatialReference,h=n.vec3d.set(d.viewForward,F),h=B(c,d.eye,h,d.up,L);c=c.spatialReference||l.WGS84;m.vectorToVector(d.eye,f,E,c)||(c=l.WGS84,m.vectorToVector(d.eye,f,E,c));return e?(e.position.x=E[0],e.position.y=E[1],e.position.z=E[2],e.position.spatialReference=c,e.heading=h.heading,e.tilt=h.tilt,e.fov=q.rad2deg(d.fov),e):new a(new b(E,c),h.heading,h.tilt,q.rad2deg(d.fov))}
function y(a,b,d){var e=a.state.camera,f=e.fovX,e=e.width/2;"global"===a.viewingMode&&null!=d&&(b*=Math.cos(q.deg2rad(d)));b/=a.renderCoordsHelper.unitInMeters;return e/(39.37*c.screenDPI/b)/Math.tan(f/2)}function A(a,b,d){var e=a.state.camera;b=39.37*c.screenDPI/(e.width/2/(b*Math.tan(e.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(q.deg2rad(d)));return b*=a.renderCoordsHelper.unitInMeters}function C(b,c,d,e,f,h){var k=b.renderSpatialReference;c=D(b,e.heading,e.tilt,c,d,f);b=m.vectorToPoint(c.eye,
k,b.spatialReference||l.WGS84);if(!b)return null;if(!h)return new a(b,c.heading,c.tilt,e.fov);h.position=b;h.heading=c.heading;h.tilt=c.tilt;h.fov=e.fov;return h}function B(a,b,c,d,e){return x(a).directionToHeadingTilt(b,c,d,e)}function D(a,c,d,e,h,k){var g=n.vec3d.create(),q=a.renderSpatialReference;if(e)if(e instanceof b){var p=e;m.pointToVector(p,g,a.renderSpatialReference);null==p.z&&null!=a.basemapTerrain&&(p=a.basemapTerrain.getElevation(p),null!=p&&a.renderCoordsHelper.setAltitude(p,g))}else e&&
n.vec3d.set(e,g);else n.vec3d.set(a.state.camera.center,g);e&&e instanceof b||(e=m.vectorToPoint(g,q,a.spatialReference||l.WGS84));h=Math.max(h,a.state.constraints.minimumPoiDistance);q=d;d=h;if(!(p=k&&k.noReset))var p=e,t=a.engineToScreen(a.state.camera.center),u=a.toScreen(p),p=t.x-u.x,t=t.y-u.y,u=a.pointsOfInterest.centerOnSurfaceFrequent.distance,u=Math.log(Math.max(d,u)/Math.min(d,u))/Math.LN2,p=!(Math.sqrt(p*p+t*t)>5*Math.max(a.width,a.height)||8<u&&8E5<d);p?(q=x(a).eyeTiltToLookAtTilt(g,d,
q),q=a.state.constraints.clampTilt(d,q),q=x(a).lookAtTiltToEyeTilt(g,d,q)):(c=0,q=a.state.constraints.tilt(d).min);d=q;q=x(a).eyeForCenterWithHeadingTilt;c=q(g,h,c,d);g={eye:c.eye,up:c.up,center:g,heading:c.heading,tilt:c.tilt};return k&&k.noReset||"global"!==a.viewingMode||(c=a.renderCoordsHelper.fromRenderCoords(g.eye,G,a.spatialReference)?a.basemapTerrain&&(a.basemapTerrain.getElevation(G)||0)>G.z-1:!1,!c)?g:(g=a.state.constraints.tilt(h).min,D(a,0,g,e,h,f.mixin({},k,{noReset:!0})))}Object.defineProperty(g,
"__esModule",{value:!0});var E=n.vec3d.create(),H=n.vec3d.create(),F=n.vec3d.create(),L={heading:0,tilt:0},G=new b,P=new q.Cyclical(-2.0037508342788905E7,2.0037508342788905E7);g.externalToInternal=function(a,b){var c=a.renderSpatialReference,d=x(a).headingTiltToDirectionUp,e=n.vec3d.create();return m.pointToVector(b.position,e,c)?(c=d(e,b.heading,b.tilt),n.vec3d.add(c.direction,e),a=h.cameraOnContentAlongViewDirection(a,e,c.direction,c.up),a.fov=q.deg2rad(b.fov),a):null};g.internalToExternal=v;g.scaleToDistance=
y;g.distanceToScale=A;g.fromCenterScale=function(a,b,c,d,e,f){c=y(a,c,b.latitude);return C(a,b,c,d,e,f)};g.fromCenterDistance=C;g.directionToHeadingTilt=B;g.eyeHeadingTiltForCenterPointAtDistance=D;g.fromExtent=function(c,e,f,h,g,q){var n;g instanceof a?(q=g,n={noReset:!1}):n=g;var p="global"===c.viewingMode;g=c.renderSpatialReference;var t=c.spatialReference||l.WGS84,u=l.WebMercator,v=e.spatialReference||u,x,r=0;null!=e.zmax&&null!=e.zmin&&(x=(e.zmax+e.zmin)/2,r=e.zmax-e.zmin);if(p){var p=new b(e.xmin,
e.ymin,v),y=new b(e.xmax,e.ymax,v),p=d.project(p,u),y=d.project(y,u);if(null===p||null===y)return;e=new b(P.center(p.x,y.x),(y.y+p.y)/2,u);null!=x&&(e.z=x);x=k.getGreatCircleSpanAt(e,p,y);u=x.lon;v=x.lat;P.diff(p.x,y.x)>P.range/2&&(u+=k.halfEarthCircumference);u=Math.min(u,k.halfEarthCircumference);v=Math.min(v,k.halfEarthCircumference)}else d.canProject(e,t)&&(e=d.project(e,t)),u=e.xmax-e.xmin,v=e.ymax-e.ymin,e=new b({x:e.xmin+.5*u,y:e.ymin+.5*v,z:x,spatialReference:t});x=c.state.camera;f=D(c,f,
h,e,Math.max(1/Math.tan(x.fovX/2)*u*.5,1/Math.tan(x.fovY/2)*v*.5,1/Math.tan(x.fov/2)*r*.5)/1,n);h=m.vectorToPoint(f.eye,g,t);if(!h)return null;q||(q=new a);q.position=h;q.heading=f.heading;q.tilt=f.tilt;q.fov=c.camera.fov;return q};g.toExtent=function(a,b,c,d,e){var f;f=a.renderSpatialReference;b||(c||(c=a.state.camera),b=v(a,c,e));if(c)e=m.vectorToPoint(c.center,f,a.spatialReference||l.WGS84),f=c.distance;else{e=a.toMap(a.screenCenter);if(!e)return null;f=k.computeCarthesianDistance(b.position,e)}c||
(c=a.state.camera);b=2*f*Math.tan(c.fovX/2)*1;c=2*f*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?p.toExtent(a,e,b,c,d):t.toExtent(a,e,b,c,d)};g.scaleToZoom=function(a,b){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.levelAtScale(b):void 0};g.zoomToScale=function(a,b){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.scaleAtLevel(b):void 0};g.scaleToResolution=function(a,b){return a.spatialReference?e.getResolutionForScale(b,a.spatialReference):void 0};g.computeScale=
function(a,b,c){var d=a.renderSpatialReference;b||(b=a.state.camera);var e;e=l.WGS84;b instanceof u?(m.vectorToVector(b.center,d,H,e),e=H[1],b=b.distance):(e=b.position.latitude,m.pointToVector(b.position,E,d),m.pointToVector(c,H,d),b=n.vec3d.dist(E,H));return A(a,b,e)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../geometry/Extent ../lib/glMatrix ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),function(r,g,f,a,c,b,l){function e(c,e,f){c=a.vec3d.create();
var k=a.vec3d.create();a.mat4d.identity(n);a.mat4d.rotateZ(n,-b.deg2rad(e));a.mat4d.rotateX(n,b.deg2rad(f));a.mat4d.multiplyVec3(n,h,c);a.vec3d.scale(c,-1);a.mat4d.multiplyVec3(n,d,k);return{direction:c,up:k}}Object.defineProperty(g,"__esModule",{value:!0});var d=a.vec3d.createFrom(0,1,0),h=a.vec3d.createFrom(0,0,1),n=a.mat4d.create(),t=a.vec3d.create(),p=a.vec3d.create();g.headingTiltToDirectionUp=e;g.directionToHeadingTilt=function(a,b,e,f){return c.directionToHeadingTilt(b,e,f,h,d)};g.eyeForCenterWithHeadingTilt=
function(b,c,d,f){var h=e(b,d,f);b=a.vec3d.add(a.vec3d.scale(h.direction,-c,a.vec3d.create()),b);return{up:h.up,eye:b,heading:d,tilt:f}};g.lookAtTiltToEyeTilt=function(a,c,d){return b.rad2deg(d)};g.eyeTiltToLookAtTilt=function(a,c,d){return b.deg2rad(d)};g.toExtent=function(a,b,c,d,e){var h=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;l.pointToVector(b,t,h);l.pointToVector(b,p,h);t[0]-=c/2;p[0]+=c/2;t[1]-=d/2;p[1]+=d/2;l.vectorToVector(t,h,t,a);l.vectorToVector(p,h,p,a);
e?(e.xmin=t[0],e.ymin=t[1],e.xmax=p[0],e.ymax=p[1],e.spatialReference=a):e=new f(t[0],t[1],p[0],p[1],a);return e}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../lib/glMatrix","./mathUtils"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});var c=f.vec3d.create(),b=f.vec3d.create();g.directionToHeadingTilt=function(g,e,d,h,n){var l=c;f.vec3d.normalize(g,l);var p=f.vec3d.dot(l,h),k=0<p,p=Math.abs(p);.99<p&&(p=Math.abs(f.vec3d.dot(e,h)),.99>
p?(f.vec3d.set(e,l),k&&f.vec3d.scale(l,-1)):l=null);e=0;l&&(f.vec3d.scale(h,f.vec3d.dot(h,l),b),f.vec3d.subtract(l,b),e=f.vec3d.dot(l,n)/(f.vec3d.length(l)*f.vec3d.length(n)),f.vec3d.cross(l,n,b),e=(0<f.vec3d.dot(b,h)?1:-1)*a.rad2deg(a.acos(e)));g=a.rad2deg(a.acos(-f.vec3d.dot(h,g)/f.vec3d.length(g)));return d?(d.heading=e,d.tilt=g,d):{heading:e,tilt:g}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../lib/glMatrix ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(r,g,f,a,c,b,l,e,d){function h(a,c,e){var f=b.vec3d.create(),h=b.vec3d.create();b.vec3d.cross(a,p,u);0===b.vec3d.dot(u,u)&&b.vec3d.cross(a,k,u);b.mat4d.identity(m);b.mat4d.rotate(m,-d.deg2rad(c),a);b.mat4d.rotate(m,-d.deg2rad(e),u);b.vec3d.cross(u,a,h);b.vec3d.normalize(h);b.mat4d.multiplyVec3(m,h);b.vec3d.normalize(a,f);b.mat4d.multiplyVec3(m,b.vec3d.negate(f));return{direction:f,up:h}}function n(a){var b=a[1];a[1]=-a[2];a[2]=b}function t(a,b){b=h(b,a.heading,a.tilt);a.up=b.up;return a}Object.defineProperty(g,
"__esModule",{value:!0});var p=b.vec3d.createFrom(0,0,1),k=b.vec3d.normalize(b.vec3d.createFrom(1,1,1)),q=new d.Cyclical(-180,180),m=b.mat4d.create(),u=b.vec3d.create(),x=b.vec3d.create();g.headingTiltToDirectionUp=h;g.directionToHeadingTilt=function(a,c,d,e){var f=u;b.vec3d.normalize(a,f);b.vec3d.cross(f,p,x);0===b.vec3d.dot(x,x)&&b.vec3d.cross(f,k,x);b.vec3d.cross(x,f,x);return l.directionToHeadingTilt(c,d,e,f,x)};g.eyeForCenterWithHeadingTilt=function(a,c,e,f){var h={eye:b.vec3d.create(),up:null,
tilt:f,heading:e},k=u;k[0]=a[0];k[1]=a[2];k[2]=-a[1];e=d.deg2rad(e);var g=d.deg2rad(f);f=Math.sin(e);e=Math.cos(e);var l=Math.sin(g),m=Math.cos(g),q=b.vec3d.length(k);if(1E-8>Math.abs(g))g=c+q;else var p=q/l,v=d.asin(c/p),g=p*Math.sin(Math.PI-g-v);var p=l*c,m=m*c,v=e*p,x=g-m,r=x*x,y=c*c*l*l,l=e*e*y,y=f*f*y,A=k[1]*x,C=l*(l+r-k[1]*k[1]);if(0>C)return b.vec3d.scale(k,g/q,h.eye),h.tilt=0,h;var N=Math.sqrt(C),C=l+r,A=0<e?-N+A:N+A;if(1E-8>Math.abs(C))return 1E-8>q?(h.eye[0]=0,h.eye[1]=0,h.eye[2]=c):b.vec3d.scale(k,
g/q,h.eye),h.tilt=0,n(h.eye),t(h,a);h.eye[1]=A/C;C=h.eye[1]*h.eye[1];c=1-C;A=Math.sqrt(c);v=l*C+y-2*v*h.eye[1]*A*x+c*r;if(1E-8>Math.abs(v))return b.vec3d.scale(k,g/q,h.eye),h.tilt=0,n(h.eye),t(h,a);h.eye[0]=(c*(g*k[0]-m*k[0])-p*A*(k[0]*h.eye[1]*e+k[2]*f))/v;h.eye[2]=(c*(g*k[2]-m*k[2])-p*A*(k[2]*h.eye[1]*e-k[0]*f))/v;b.vec3d.scale(h.eye,g);n(h.eye);return t(h,a)};g.lookAtTiltToEyeTilt=function(a,c,e){a=b.vec3d.length(a);c=d.asin(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-e))/Math.sin(e)));return d.rad2deg(e-
c)};g.eyeTiltToLookAtTilt=function(a,c,e){e=d.deg2rad(e);a=b.vec3d.length(a);return d.asin(c/(a/Math.sin(e)))+e};g.toExtent=function(b,h,k,g,l){function m(a){var b=Math.PI/2;a=d.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var n;n=h.latitude;h=h.longitude;var p=e.getLonDeltaForDistance(h,n,k)/2;k=h-p;h+=p;n=d.deg2rad(n);p=e.earthRadius;n=(1+Math.sin(n))/(1-Math.sin(n));var t=(n+1)*Math.tan(g/p/2);n=1.5*Math.PI-2*Math.atan(.5*(t+Math.sqrt(4*n+t*t)));g=n+g/p;n=m(n);g=m(g);g<n&&(p=g,g=n,n=
p);n=Math.max(d.rad2deg(n),-90);g=Math.min(d.rad2deg(g),90);h=q.monotonic(k,h);180<h-k&&(p=(h-k-180)/2,k+=p,h-=p);l?(l.xmin=k,l.ymin=n,l.xmax=h,l.ymax=g,l.spatialReference=a.WGS84):l=new f(k,n,h,g,a.WGS84);b.spatialReference&&b.spatialReference.isWebMercator&&c.geographicToWebMercator(l,!1,l);return l}})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/glMatrix ./cameraUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){function x(a){return 360-m.cyclicalDeg.normalize(a)}function v(a){return m.cyclicalDeg.normalize(360-a)}function y(b,c,d){if(!c)return null;var e=b.spatialReference||a.SpatialReference.WGS84;if(c.camera){b=c.get("camera.position.spatialReference");if(!n.canProject(b,e))return null;c=c.camera.clone();b.equals(e)||(c.position=n.project(c.position,e));return c}var h=c.get("targetGeometry.spatialReference");if(h&&!n.canProject(h,e))return null;var h=k.internalToExternal(b,
b.state.camera),g={noReset:!1};null!=c.rotation&&(h.heading=x(c.rotation),g.noReset=!0);null!=d&&(h.tilt=d);if("point"===c.targetGeometry.type){d=c.targetGeometry;var l=void 0,m=c.targetGeometry.clone(),l=null!=c.scale?k.scaleToDistance(b,c.scale,d.latitude):b.state.camera.distance;c=k.eyeHeadingTiltForCenterPointAtDistance(b,h.heading,h.tilt,m,l,g);e=u.vectorToPoint(c.eye,b.renderSpatialReference,e);return new f(e,c.heading,c.tilt,h.fov)}return k.fromExtent(b,c.targetGeometry.extent,h.heading,h.tilt,
g)}function A(a,b){var c=b.scale;null==c&&null!=b.zoom&&(c=k.zoomToScale(a,b.zoom));return c}function C(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=x(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function B(b,c,d){var e=b.spatialReference||a.SpatialReference.WGS84;c=c||k.externalToInternal(b,d.camera);d.targetGeometry=u.vectorToPoint(c.center,b.renderSpatialReference,e);d.scale=k.computeScale(b,c);d.rotation=v(d.camera.heading);
return d}function D(a,b,c){if(b){if(!n.canProject(b.spatialReference,a.spatialReference))throw new l("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var e=[];if(!b.hasZ&&a.basemapTerrain){var f=void 0;switch(b.type){case "point":f=b;break;case "multipoint":case "polyline":case "mesh":f=b.extent.center;break;case "extent":f=b.center;break;case "polygon":f=
b.centroid}f&&n.canProject(f,a.basemapTerrain.spatialReference)?O[2]=a.basemapTerrain.getElevation(f)||0:O[2]=0}(0,T[b.type])(b,function(a){e.push(a[0],a[1],a[2])},O);var h=e.length/3;if(0!==h&&(f=Array(e.length),u.bufferToBuffer(e,b.spatialReference,0,f,a.spatialReference,0,h)))for(b.hasZ&&(c.hasZ=!0),a=0;a<f.length;a+=3)b.hasZ?(O[0]=f[a+0],O[1]=f[a+1],O[2]=f[a+2]):(O[0]=f[a+0],O[1]=f[a+1]),d.expand(c.boundingBox,O)}}function E(a,b,c,e){return a.whenViewForGraphic(b).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(b,
{minDemResolution:c})}).then(function(a){var b=a.boundingBox;d.expand(e.boundingBox,b);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){e.screenSpaceObjects.push(a)});isFinite(b[2])&&(e.hasZ=!0)}).catch(function(){D(a,b.geometry,e)})}function H(b,d,f,h){if(Array.isArray(d)&&2===d.length){var k=d[0],g=d[1];if("number"===typeof k&&"number"===typeof g)return K.x=k,K.y=g,K.z=void 0,K.spatialReference=a.SpatialReference.WGS84,D(b,K,h),e.resolve()}if(d&&"function"===typeof d.map)return e.eachAlways(d.map(function(a){return H(b,
a,f,h)}));if(d instanceof a.BaseGeometry)try{D(b,d,h)}catch(fa){return e.reject(fa)}else if(d instanceof c)return E(b,d,f,h);return e.resolve()}function F(a,b,c,d){if(b.camera)return L(a,c,b.camera,d);d.scale=b.scale;d.rotation=b.rotation;d.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;d.camera=null;null!=c.heading?d.rotation=v(c.heading):null!=c.rotation&&(d.rotation=c.rotation);b=A(a,c);null!=b&&(d.scale=b);d.camera=y(a,d,c.tilt);return d}function L(a,b,c,d){d.camera=c.clone();d.camera.fov=
a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!n.canProject(c,b))return null;c.equals(b)||(d.camera.position=n.project(d.camera.position,b));return B(a,null,d)}function G(b,c,d,e){if(!d)return null;e.targetGeometry=d.clone();var f=t.cameraOnContentAlongViewDirection(b);if(c.position){d=e.targetGeometry;var h=b.renderSpatialReference;u.pointToVector(c.position,X,h);u.pointToVector(d,Q,h);e.targetGeometry=new a.Point(d);e.camera.position=new a.Point(c.position);p.vec3d.subtract(Q,
X,W);k.directionToHeadingTilt(b,X,W,f.up,e.camera);e.scale=k.distanceToScale(b,p.vec3d.dist(X,Q),e.targetGeometry.latitude);e.rotation=v(e.camera.heading);return e}if(c.zoomFactor){var h=f.distance/c.zoomFactor,g=p.vec3d.scale(f.viewForward,-h,O);p.vec3d.add(f.center,g,f.eye);f.markViewDirty();e.scale=k.distanceToScale(b,h,d.latitude)}k.internalToExternal(b,f,e.camera);h={noReset:!1};C(e.camera,c)&&(h.noReset=!0);return c.zoomFactor||(e.scale=A(b,c),null==e.scale&&(u.pointToVector(d,O,b.renderSpatialReference),
q.frustumPoint(f.frustumPlanes,O)?e.scale=k.distanceToScale(b,p.vec3d.dist(f.eye,O),d.latitude):e.scale=k.computeScale(b,f)),k.fromCenterScale(b,e.targetGeometry,e.scale,e.camera,h,e.camera))?e:null}function P(a,b,c,d){d.targetGeometry=c.clone();var e=t.cameraOnContentAlongViewDirection(a);k.internalToExternal(a,e,d.camera);e={noReset:!1};C(d.camera,b)&&(e.noReset=!0);return k.fromExtent(a,c,d.camera.heading,d.camera.tilt,e,d.camera)?d:null}function J(a,b){if(!b||!a.spatialReference)return null;a=
{target:null};if("declaredClass"in b||Array.isArray(b))a.target=b;else{for(var c in b)a[c]=b[c];b.center&&!a.target&&(a.target=b.center)}return a}function M(a){a&&(a.rotation=v(a.camera.heading));return e.resolve(a)}Object.defineProperty(g,"__esModule",{value:!0});g.DEFAULT_FRAME_COVERAGE=.66;g.rotationToHeading=x;g.headingToRotation=v;g.toCamera=y;g.fromInternalCamera=function(a,c,d){d||(d=new b({camera:new f}));k.internalToExternal(a,c,d.camera);return B(a,c,d)};g.fromCamera=function(a,c,d){d||
(d=new b);d.camera=c.clone();return B(a,null,d)};g.create=function(c,m){var q=J(c,m);if(!q)return e.reject(new l("viewpointutils-create:no-target","Missing target for creating viewpoint"));var n=new b({camera:new f({fov:c.camera.fov})}),v=null!=q.scale||null!=q.zoom;if(q.target instanceof b)return M(F(c,q.target,q,n));if(q.target instanceof f)return M(L(c,q,q.target,n));if(q.target instanceof a.Extent)return m=q.target.xmin===q.target.xmax||q.target.ymin===q.target.ymax,v||m?M(G(c,q,q.target.center,
n)):M(P(c,q,q.target,n));var x={boundingBox:d.empty(),hasZ:!1,screenSpaceObjects:[]};m=v?k.scaleToResolution(c,A(c,q)):void 0;return H(c,q.target,m,x).then(function(){if(isFinite(x.boundingBox[0])){d.center(x.boundingBox,O);K.x=O[0];K.y=O[1];K.z=O[2];K.spatialReference=c.spatialReference;var b=void 0;isFinite(K.z)&&x.hasZ?b=d.isPoint(x.boundingBox):(K.z=void 0,b=h.isPoint(d.toRect(x.boundingBox,S)));if(v||b)return G(c,q,K,n);var e=K,b=x.boundingBox,f;f=x.screenSpaceObjects;var l=g.DEFAULT_FRAME_COVERAGE;
if(f.length){for(var m=Number.NEGATIVE_INFINITY,r=0;r<f.length;r++)var y=f[r].screenSpaceBoundingRect,m=Math.max(m,Math.abs(y[0]),Math.abs(y[1]),Math.abs(y[2]),Math.abs(y[3]));f=l-m/Math.min(c.width,c.height)*2}else f=l;l=f;n.targetGeometry=e.clone();f=t.cameraOnContentAlongViewDirection(c);m=0;e.hasZ?m=e.z:c.basemapTerrain&&(m=c.basemapTerrain.getElevation(e));p.vec3d.set3(e.x,e.y,m,O);u.computeLinearTransformation(c.spatialReference,O,aa,c.renderSpatialReference);p.mat4d.toMat3(aa,V);p.mat3d.transpose(V);
d.empty(N);e=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(r=0;r<e.length;r++){var y=e[r],A=b[y[2]];isFinite(A)||(A=m);p.vec3d.set3(b[y[0]],b[y[1]],A,O);u.vectorToVector(O,c.spatialReference,O,c.renderSpatialReference);d.expand(N,p.mat3d.multiplyVec3(V,O))}b=d.width(N);e=d.height(N);m=d.depth(N);r=1/Math.tan(f.fovY/2);b=Math.max(.5*Math.sqrt(b*b+m*m)*Math.max(r,1/Math.tan(f.fovX/2))+.5*e,.5*e*r+.5*Math.max(b,m))/l;k.internalToExternal(c,f,n.camera);f={noReset:!1};C(n.camera,
q)&&(f.noReset=!0);n.scale=k.distanceToScale(c,b,n.targetGeometry.latitude);b=k.fromCenterScale(c,n.targetGeometry,n.scale,n.camera,f,n.camera)?n:null;return b}if(q.position)return b=t.cameraOnContentAlongViewDirection(c),p.vec3d.set(b.viewForward,W),k.directionToHeadingTilt(c,b.eye,W,b.up,I),n.camera.position=new a.Point(q.position),n.camera.heading=null!=q.heading?q.heading:I.heading,n.camera.tilt=null!=q.tilt?q.tilt:I.tilt,B(c,null,n);b=t.cameraOnContentAlongViewDirection(c);b=u.vectorToPoint(b.center,
c.renderSpatialReference,K,c.spatialReference);return G(c,q,b,n)}).then(function(a){return M(a)})};var O=p.vec3d.create(),aa=p.mat4d.create(),V=p.mat3d.create(),N=d.create(),S=h.create(),W=p.vec3d.create(),X=p.vec3d.create(),Q=p.vec3d.create(),I={heading:0,tilt:0},K=new a.Point,T={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=a.rings[e],h=0;h<f.length;h++)c[0]=f[h][0],c[1]=f[h][1],d&&(c[2]=f[h][2]),b(c)},
polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],h=0;h<f.length;h++)c[0]=f[h][0],c[1]=f[h][1],d&&(c[2]=f[h][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(p.vec3d.set3(a.xmin,a.ymin,a.zmin,c)),b(p.vec3d.set3(a.xmax,a.ymin,a.zmin,c)),b(p.vec3d.set3(a.xmin,a.ymax,a.zmin,c)),b(p.vec3d.set3(a.xmax,a.ymax,a.zmin,c)),b(p.vec3d.set3(a.xmin,a.ymin,
a.zmax,c)),b(p.vec3d.set3(a.xmax,a.ymin,a.zmax,c)),b(p.vec3d.set3(a.xmin,a.ymax,a.zmax,c)),b(p.vec3d.set3(a.xmax,a.ymax,a.zmax,c))):(b(p.vec3d.set3(a.xmin,a.ymin,c[2],c)),b(p.vec3d.set3(a.xmax,a.ymin,c[2],c)),b(p.vec3d.set3(a.xmin,a.ymax,c[2],c)),b(p.vec3d.set3(a.xmax,a.ymax,c[2],c)))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(p.vec3d.set3(a[d+0],a[d+1],a[d+2],c))}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./Evented".split(" "),
function(r,g,f,a,c,b,l){return function(c){function d(a){var b=c.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;b.elevationChange=function(a){b.emit("elevation-change",a)};return b}f(d,c);d.prototype.getElevation=function(a,b){var c=-Infinity,d=!1;if("scene"===b)for(var e=0,f=this.providers.im;e<f.length;e++){var h=f[e],h=h.getElevation(a,b);null!=h&&(c=Math.max(h,c),!d&&isFinite(c)&&(d=!0))}if(!d)for(d=0,e=this.providers.ground;d<e.length;d++)h=e[d],h=h.getElevation(a,
b),null!=h&&(c=Math.max(h,c));if("scene"===b)for(d=0,e=this.providers.scene;d<e.length;d++)h=e[d],h=h.getElevation(a,b),null!=h&&(c=Math.max(h,c));return isFinite(c)?c:null};d.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=this.providers[d].indexOf(a);
-1<e&&this.providers[d].splice(e,1)}};a([b.property({constructOnly:!0})],d.prototype,"view",void 0);a([b.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=a([b.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(b.declared(c,l.Evented))})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/sniff"],function(r,g,f){var a=f("esri-mobile"),c=f("esri-iPhone");r=function(){function a(){}
a.isValidProfile=function(b){return b in a.profiles};a.getDefaultProfile=function(){return f("trident")||c?"low":"medium"};a.apply=function(b,c){b=a.profiles[b];c.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;c.sceneService.point.lodFactor=b.sceneService.point.lodFactor;c.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;c.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;c.sceneService.uncompressedTextureDownsamplingEnabled=
b.sceneService.uncompressedTextureDownsamplingEnabled;c.tiledSurface.lodBias=b.tiledSurface.lodBias;c.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;c.antialiasingEnabled=b.antialiasingEnabled;c.gpuMemoryLimit=b.gpuMemoryLimit;c.frameRate=b.frameRate};return a}();(function(b){b.profiles={low:{sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},
antialiasingEnabled:!1,gpuMemoryLimit:200,frameRate:30},medium:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?400:500,frameRate:30},high:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,
angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?600:1E3,frameRate:0}}})(r||(r={}));return r})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b,l){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.color=new c([0,255,255]);a.haloOpacity=1;
a.fillOpacity=.25;return a}f(d,b);d.toEngineOptions=function(a){return{color:new Float32Array(c.toUnitRGBA(a.color)),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([l.property({type:c})],d.prototype,"color",void 0);a([l.property()],d.prototype,"haloOpacity",void 0);a([l.property()],d.prototype,"fillOpacity",void 0);return d=a([l.subclass()],d)}(l.declared(b))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),
function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function d(a,c,d){void 0===d&&(d=null);var e=this;this.spatialReference=c;this.unitInMeters=b.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=d)||l.create(a&&a.get("portalItem")).then(function(a){e.geometryService=a}).catch(function(){})}d.prototype.toGeographic=function(b){var d=this,h=!0;if(!this.geometryService)return c.reject(new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));
Array.isArray(b[0])&&"number"!==typeof b[0]||(b=[b],h=!1);b=b.map(function(a){return a instanceof f.Point?a:new f.Point(a,d.spatialReference)});b=new e({geometries:b,outSR:f.SpatialReference.WGS84});return this.geometryService.project(b).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return h?a:a[0]})};d.prototype.canProject=function(){return!!this.geometryService};return d}();g.MapCoordsHelper=r;g.default=r})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/typescript".split(" "),
function(r,g,f,a,c,b){var l=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}f(d,c);a([b.property({value:1})],d.prototype,"lodFactor",void 0);return d=a([b.subclass()],d)}(c),e=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}f(d,c);d.prototype.getDefaults=function(){return{"3dObject":new l,point:new l,integratedMesh:new l,pointCloud:new l,uncompressedTextureDownsamplingEnabled:!1}};a([b.property()],d.prototype,"3dObject",void 0);a([b.property()],d.prototype,
"point",void 0);a([b.property()],d.prototype,"integratedMesh",void 0);a([b.property()],d.prototype,"pointCloud",void 0);a([b.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return d=a([b.subclass()],d)}(c),d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}f(d,c);a([b.property({value:0})],d.prototype,"lodBias",void 0);a([b.property({value:1})],d.prototype,"angledSplitBias",void 0);return d=a([b.subclass()],d)}(c);return function(c){function h(){return null!==
c&&c.apply(this,arguments)||this}f(h,c);h.prototype.getDefaults=function(){return{sceneService:new e,tiledSurface:new d,antialiasingEnabled:!0}};a([b.property()],h.prototype,"sceneService",void 0);a([b.property()],h.prototype,"tiledSurface",void 0);a([b.property()],h.prototype,"antialiasingEnabled",void 0);a([b.property()],h.prototype,"gpuMemoryLimit",void 0);a([b.property()],h.prototype,"frameRate",void 0);return h=a([b.subclass()],h)}(c)})},"esri/core/accessorSupport/typescript":function(){define(["../declare",
"../typescript","../JSONSupport","../lang"],function(r,g,f,a){function c(a,f){if(!a)return f;if(!f)return a;for(var b in f){var d=a[b],h=f[b];Array.isArray(h)&&Array.isArray(d)?a[b]=d.concat(h):a[b]="object"===typeof h&&"object"===typeof d?c(d,h):h}return a}return{subclass:function(b,l){return function(e){e=g.declareDefinition(e,b);d&&(e.instanceMembers.properties=c(d,e.instanceMembers.properties));var d=e.instanceMembers.properties;if(d)for(var h in d){var l=d[h];l&&!l.reader&&l.type&&(l.type===
Date?l.reader=function(a){return null!=a?new Date(a):null}:-1!==l.type._meta.bases.indexOf(f)&&(l.reader=function(a){return function(b){return a.fromJSON(b)}}(l.type)))}return a.mixin(r(e.bases,e.instanceMembers),e.classMembers)}},shared:g.shared,property:function(a){return function(b,c){var d=Object.getPrototypeOf(b),d=d&&d.properties;b.properties&&b.properties!==d||(b.properties={});b.properties=b.properties||{};b.properties[c]=a||{}}}}})},"esri/core/typescript":function(){define(["./declare","./lang"],
function(r,g){var f={declareDefinition:function(a,c){var b=[],f=Object.getPrototypeOf(a.prototype),e;if(f!==Object.prototype){var d=f.constructor;e=d.prototype;b.push(d)}c&&(b=b.concat(c));c={};for(var d=Object.getOwnPropertyNames(a.prototype),h=0;h<d.length;h++){var g=d[h];if("constructor"!==g){var t=g;"dojoConstructor"===g&&(t="constructor");e&&a.prototype[g]===e[g]||(c[t]=a.prototype[g])}}d=Object.getOwnPropertyNames(a);f=Object.getOwnPropertyNames(f.constructor);e={};for(h=0;h<d.length;h++)g=
d[h],-1===f.indexOf(g)&&(e[g]=a[g]);return{bases:b,instanceMembers:c,classMembers:e}},subclass:function(a){return function(c){c=f.declareDefinition(c,a);return g.mixin(r(c.bases,c.instanceMembers),c.classMembers)}},shared:function(a){return function(c,b){c[b]=a}}};return f})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../layers/graphics/dehydratedFeatures ../lib/glMatrix ./earthUtils ./geometryUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){Object.defineProperty(g,"__esModule",{value:!0});g.createRenderCoordsHelper=function(a,b){return"global"===a?new q(b):new m(b)};var k;(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(k=g.BasisDimension||(g.BasisDimension={}));r=function(){function b(a,b){this.spatialReference=a;this.unitInMeters=b}b.prototype.toRenderCoords=function(a,b,c){return l.isPoint(a)?t.pointToVector(a,b,this.spatialReference):t.vectorToVector(a,b,c,this.spatialReference)};b.prototype.fromRenderCoords=
function(b,d,e){return d instanceof a?t.vectorToPoint(b,this.spatialReference,d,e):d instanceof c?t.vectorToPoint(b,this.spatialReference,d):t.vectorToVector(b,this.spatialReference,d,e)};return b}();g.RenderCoordsHelper=r;var q=function(a){function b(b){b=a.call(this,b||t.SphericalECEFSpatialReference,1)||this;b.type="global";return b}f(b,a);b.prototype.getAltitude=function(a){return e.vec3d.length(a)-d.earthRadius};b.prototype.setAltitude=function(a,b){a=(a+d.earthRadius)/e.vec3d.length(b);e.vec3d.scale(b,
a)};b.prototype.setAltitudeOfTransformation=function(a,b){var c=b[12],e=b[13],f=b[14];a=(a+d.earthRadius)/Math.sqrt(c*c+e*e+f*f);b[12]=c*a;b[13]=e*a;b[14]=f*a};b.prototype.worldUpAtPosition=function(a,b){return this.worldBasisAtPosition(a,k.Z,b)};b.prototype.worldBasisAtPosition=function(a,b,c){switch(b){case k.X:return n.cartesianToSpherical(a||y,x),a=x[2],e.vec3d.set3(-Math.sin(a),Math.cos(a),0,c);case k.Y:n.cartesianToSpherical(a||y,x);b=x[1];a=x[2];var d=Math.sin(b);return e.vec3d.set3(-d*Math.cos(a),
-d*Math.sin(a),Math.cos(b),c);case k.Z:return e.vec3d.normalize(a||y,c)}};b.prototype.intersectManifold=function(a,b,c,f){void 0===f&&(f=e.vec3d.create());if(!p.raySphere(a,b,null,d.earthRadius+c,x)||0>e.vec3d.dot(e.vec3d.direction(x,a,v),b))return!1;e.vec3d.set(x,f);return!0};return b}(r),m=function(a){function c(c){c=a.call(this,c,b.getMetersPerUnitForSR(c))||this;c.type="local";c.worldX=[1,0,0];c.worldY=[0,1,0];c.worldZ=[0,0,1];return c}f(c,a);c.prototype.getAltitude=function(a,b){return b?a[b+
2]:a[2]};c.prototype.setAltitude=function(a,b){b[2]=a};c.prototype.setAltitudeOfTransformation=function(a,b){b[14]=a};c.prototype.worldUpAtPosition=function(a,b){return e.vec3d.set(this.worldZ,b)};c.prototype.worldBasisAtPosition=function(a,b,c){switch(b){case k.X:return e.vec3d.set(this.worldX,c);case k.Y:return e.vec3d.set(this.worldY,c);case k.Z:return e.vec3d.set(this.worldZ,c)}};c.prototype.intersectManifold=function(a,b,c,d){void 0===d&&(d=e.vec3d.create());h.plane.fromNormalAndOffset(this.worldZ,
-c,u);if(!h.plane.intersectRay(u,a,b,x)||0>e.vec3d.dot(e.vec3d.direction(x,a,v),b))return!1;e.vec3d.set(x,d);return!0};return c}(r),u=h.plane.create(),x=e.vec3d.create(),v=e.vec3d.create(),y=[0,0,0]})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ../../../core/Logger ../../../core/now ../../../core/scheduling ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../webgl-engine/lib/Util".split(" "),function(r,g,f,
a,c,b,l,e,d,h,n){function t(){var a={},b;for(b in k.ClientType)a[k.ClientType[b]]=0;a[k.ClientType.TERRAIN]=15;a[k.ClientType.SCENE]=20;a[k.ClientType.SYMBOLOGY]=5;return new d(a)}var p=c.getLogger("esri.views.support.ResourceController"),k=function(){function c(d,f,h){void 0===f&&(f=l);void 0===h&&(h=b);var k=this;this._view=d;this._memoryController=this._budget=null;this._streamDataLoader=t();this._frameWorkers=[];this._nextFrameWorker=0;this._idleWorkers=[];this._nextIdleWorker=0;this._idleUpdatesStartFired=
!1;this._lastTargetChangeTime=0;this._handles=new a;this._frameTask=null;this.idleTimeout=300;this.idleBudget=100;this._budget=new c.Budget(h);this._lastTargetChangeTime=h();this._memoryController=new e(this._view);this._handles.add(this._view.watch("state.camera",function(){return k._cameraChangedHandler()},!0));this._frameTask=f.addFrameTask({update:function(a){return k._frameUpdate(a)}})}c.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._handles.remove();
this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)};Object.defineProperty(c.prototype,"enableBudget",{set:function(a){this._budget.enabled=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maxGpuMemory",{set:function(a){this._memoryController.setMaxGpuMemory(a)},enumerable:!0,configurable:!0});c.prototype.setMemoryDirty=
function(){this._memoryController.setDirty()};Object.defineProperty(c.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0});c.prototype.getStreamDataSupplier=
function(a,b){return new h(a,this._streamDataLoader,b)};c.prototype.registerIdleFrameWorker=function(a,b){var c=this._idleWorkers.some(function(b){return b.client===a});n.assert(!c,"Can only register idle frame workers once per client/layer");n.assert(!b.idleFrame||b.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");this._idleWorkers.push({client:a,callbacks:b});this._isIdle()&&this._idleUpdatesStartFired&&b.idleBegin&&b.idleBegin.call(a)};c.prototype.deregisterIdleFrameWorker=
function(a){for(var b=this._idleWorkers,c=0;c<b.length;c++){var d=b[c];if(d.client===a){this._idleUpdatesStartFired&&d.callbacks.idleEnd&&d.callbacks.idleEnd.call(a);b[c]=b[b.length-1];b.pop();this._nextIdleWorker>=b.length&&(this._nextIdleWorker=0);break}}};c.prototype.registerFrameWorker=function(a){-1===this._frameWorkers.indexOf(a)&&this._frameWorkers.push(a)};c.prototype.deregisterFrameWorker=function(a){f.removeUnordered(this._frameWorkers,a)?this._nextFrameWorker>=this._frameWorkers.length&&
(this._nextFrameWorker=0):p.warn("Can't deregister unknown frame handler")};c.prototype._cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now();this.setMemoryDirty();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._callIdleWorkers("idleEnd"))};c.prototype._frameUpdate=function(a){var b=Math.max(a.frameDuration-a.elapsedFrameTime-5,10),c=this.idleBudget-a.elapsedFrameTime;this._view._stage&&!this._view._stage.getRenderParams().idleSuspend&&(c=b);b=this._isIdle()?
c:b;this._budget.reset(b);this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3);this._memoryController.update();for(a=0;a<this._frameWorkers.length;++a)if(b=(this._nextFrameWorker+a)%this._frameWorkers.length,this._frameWorkers[b](this._budget),3>this._budget.remaining()){this._nextFrameWorker=(b+1)%this._frameWorkers.length;break}this._isIdle()&&(this._idleUpdatesStartFired||(this._callIdleWorkers("idleBegin"),this._idleUpdatesStartFired=!0),this._budget.reset(this.idleBudget-this._budget.elapsed()),
this._callIdleFrameWorkers())};c.prototype._isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout};c.prototype._callIdleWorkers=function(a){for(var b=this._idleWorkers,c=0;c<b.length;c++){var d=b[c];d.callbacks[a]&&d.callbacks[a].call(d.client)}};c.prototype._callIdleFrameWorkers=function(){for(var a=0;a<this._idleWorkers.length;++a){var b=(this._nextIdleWorker+a)%this._idleWorkers.length;if(this._budget.done()){this._nextIdleWorker=b;break}b=this._idleWorkers[b];
b.callbacks.needsUpdate&&b.callbacks.needsUpdate.call(b.client)&&b.callbacks.idleFrame.call(b.client,this._budget)}};return c}();(function(a){(function(a){a.TERRAIN="terrain";a.SCENE="scene";a.SYMBOLOGY="symbology"})(a.ClientType||(a.ClientType={}));var b=function(){function a(a){this._nowFunc=a;this.enabled=!0;this.budget=this.begin=0}a.prototype.now=function(){return this._nowFunc()};a.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};a.prototype.done=
function(){return this.enabled&&this.elapsed()>=this.budget};a.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY};a.prototype.elapsed=function(){return this.now()-this.begin};return a}();a.Budget=b})(k||(k={}));return k})},"esri/views/3d/support/MemoryController":function(){define(["require","exports","../../../core/Logger","../layers/support/MemoryManagedLayerView","./Evented"],function(r,g,f,a,c){var b=f.getLogger("esri.views.3d.support.MemoryController");
return function(){function f(a){this._view=a;this._minQuality=.1;this._memoryHWM=this._maxQuality=1;this._memoryLWM=.8;this._divideRate=1.5;this._throttle=5;this.events=new c.Evented;this._maxMemory=500;this._quality=1;this._memoryCached=this._memoryCommitted=this._memoryUsed=this._throttled=this._stableQuality=0;this.updating=!1}f.prototype.setMaxGpuMemory=function(a){a&&0<a&&(this._maxMemory=a,this.setDirty())};f.prototype.getMemoryFactor=function(){return this._quality};f.prototype._updateQuality=
function(a){a=Math.min(Math.max(a,this._minQuality),this._maxQuality);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);console.log(this._quality);return!0};f.prototype.getUsedMemory=function(){return this._memoryUsed};f.prototype.setDirty=function(){this._stableQuality=0};f.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryCommitted)){this._unloadSuspended();this._throttled=Math.max(0,this._throttled-1);var a=this._layersUpdating();
if(a){if(this._quality<=this._minQuality)return;if(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)if(0<this._stableQuality)this._updateQuality(this._stableQuality);else if(0===this._throttled||1.05<this._memoryUsed)this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle}else this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,a=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&
this._stableQuality!==this._quality&&(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.1*(this._memoryLWM-this._memoryCommitted+.1)));this.updating!==a&&(this.updating=a,this.events.emit("updating-changed",this.updating))}};f.prototype._layersUpdating=function(){var a=!1;this._view.allLayerViews.forEach(function(b){a=a||b.updating});return a};f.prototype._unloadSuspended=function(){var b=this,c=function(){return 0===b._memoryCached?!1:b._memoryCommitted>1.1*b._memoryHWM||b._memoryUsed>
b._memoryHWM||b._memoryUsed>=b._memoryLWM&&.9>b._quality};if(c())for(var f=this._view.allLayerViews.toArray().filter(function(b){return a.isMemoryManagedLayerView(b)&&(0<b.getCachedMemory()||b.suspended)}),g=function(){var b=null,c=-1;f.forEach(function(d){if(a.isMemoryManagedLayerView(d)){var e=d.getCachedMemory()+(d.suspended?d.getUsedMemory():0);e>c&&(c=e,b=d)}});if(!b)return{value:void 0};b.removeCachedData();l._updateMemory()},l=this;c()&&0<f.length;){var p=g();if("object"===typeof p)return p.value}};
f.prototype._updateMemory=function(){var c=0,d=0,f=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(c+=this._view.basemapTerrain.getUsedMemory());var g=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();g&&(c+=g.getGpuMemoryUsage());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(b){if(a.isMemoryManagedLayerView(b)){var e=b.getUsedMemory();b.suspended?f+=e:c+=e;d+=b.getUnloadedMemory();f+=b.getCachedMemory()}});if(c>this._maxMemory&&
c!==this._warnMemoryUsage){this._warnMemoryUsage=c;var g=function(a){return a.toLocaleString(void 0,{maximumFractionDigits:1})+" Mb"},l=Math.round(100*this._quality);b.warn("GPU Memory Limit exceeded! Limit: "+g(this._maxMemory)+" Current: "+g(c)+" Projected: "+g(c+d)+" Quality: "+l+"%")}this._memoryUsed=(c+f)/this._maxMemory;this._memoryCommitted=(c+d)/this._maxMemory;this._memoryCached=f/this._maxMemory};return f}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require",
"exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.isMemoryManagedLayerView=function(f){return"function"===typeof f.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../request ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),function(r,g,f,a,c,b,l){function e(a,c){if(a.status===d.CANCELLED)return!1;a.status=d.DOWNLOADING;var e,h;switch(a.docType){case "binary":h=
"array-buffer";e=0;break;case "image":h="image";break;default:h="json"}a.startTime=b.now();a.downloadObj=f(a.url,{responseType:h,timeout:e,allowImageDataAccess:"image"===a.docType});a.downloadObj.then(function(d){a.duration=b.now()-a.startTime;a.size="binary"===a.docType?d.data.byteLength:0;a.result=d.data;c(a)},function(b){a.downloadObj.isCanceled()||c(a,b)});return!0}var d;(function(a){a[a.QUEUED=1]="QUEUED";a[a.DOWNLOADING=2]="DOWNLOADING";a[a.CANCELLED=4]="CANCELLED"})(d||(d={}));return function(){function b(b){this.tasks=
new Map;this.loadQueue=new a(e,this._doneLoadingCallback,this,b)}b.prototype.destroy=function(){var a=this;this.tasks.forEach(function(b,c){c.isRejected()||c.reject(b.url,null);a._cancelTask(c)});this.loadQueue.clear();this.tasks=this.loadQueue=null};b.prototype.request=function(a,b,e){var f=this,h=new c.Promise(function(){f.cancel(h)});a={url:a,docType:b,clientType:e,result:null,status:d.QUEUED,clientPromise:h,downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.tasks.set(h,
a);this.loadQueue.push(a);return h};b.prototype.cancel=function(a){this._cancelTask(a)};b.prototype.hasPendingDownloads=function(){return 0<this.tasks.size};b.prototype._cancelTask=function(a){var b=this.tasks.get(a);b&&(b.status===d.DOWNLOADING&&(this.loadQueue.workerCancelled(b),b.status=d.CANCELLED,b.downloadObj.cancel(),b.downloadObj=null),b.status=d.CANCELLED,b.clientPromise=void 0,this.tasks.delete(a))};b.prototype._doneLoadingCallback=function(a,b){l.assert(a.status===d.DOWNLOADING);this.tasks.delete(a.clientPromise);
b?a.clientPromise.isRejected()||a.clientPromise.reject(a.url,b):a.clientPromise.done(a.url,a.result)};return b}()})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],function(r,g,f,a){return function(){function c(a,c,e,d){this.workerFunc=a;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=
0;for(var b in d)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=d[b],this.type2id[b]=this.robin++,this.maxTotalNumWorkers+=d[b];this.numTypes=this.tasks.length;this.robin=0;var f=this;this.taskCallback=function(a){a._cancelledInQueue||(c.apply(e,arguments),f.taskFinished(a))}}c.prototype.setWorkerQuota=function(b){a.assert(f.equals(Object.keys(this.typeWorkerAllication),Object.keys(b)));
this.typeWorkerAllication=b;this.maxTotalNumWorkers=0;for(var c in b)this.typeWorkerQuota[this.type2id[c]]=b[c],this.maxTotalNumWorkers+=b[c]};c.prototype.setWorkerFunc=function(a){this.workerFunc=a};c.prototype.push=function(a){var b=this.type2id[a.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[b]++,this.totalNumWorkers++,this.workerFunc(a,this.taskCallback)):this.tasks[b].push(a)};c.prototype._getStatsForType=function(a){a=this.type2id[a];return{quota:this.typeWorkerQuota[a],
workers:this.typeNumWorkers[a],queueSize:this.tasks[a].length,requestStats:this.typeStatistics[a]}};c.prototype.removeTasks=function(a,c){for(var b=[],d=0,f=this.tasks[this.type2id[c]];d<f.length;d++){var g=f[d];-1===a.indexOf(g)&&b.push(g)}this.tasks[this.type2id[c]]=b};c.prototype.workerCancelled=function(a){this.taskFinished(a);a._cancelledInQueue=!0};c.prototype.clear=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a]=[]};c.prototype.taskFinished=function(b){var c=this.type2id[b.clientType];
this.typeNumWorkers[c]--;this.totalNumWorkers--;this.typeStatistics[c].requests++;this.typeStatistics[c].size+=b.size||0;this.typeStatistics[c].duration+=b.duration||0;this.typeStatistics[c].speed=0<this.typeStatistics[c].duration?this.typeStatistics[c].size/this.typeStatistics[c].duration:0;a.assert(0<=this.typeNumWorkers[c]);this.next()};c.prototype.next=function(){var a=this.robin,c=!1;do this.typeNumWorkers[a]<this.typeWorkerQuota[a]&&this.processQueue(a)&&(c=!0),a=(a+1)%this.numTypes;while(!c&&
a!==this.robin);if(!c){do this.processQueue(a)&&(c=!0),a=(a+1)%this.numTypes;while(!c&&a!==this.robin)}this.robin=a};c.prototype.processQueue=function(a){for(;0<this.tasks[a].length;)if(this.workerFunc(this.tasks[a].shift(),this.taskCallback))return this.typeNumWorkers[a]++,this.totalNumWorkers++,!0;return!1};return c}()})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(r,g){return function(){function f(a,c,b){this._clientType=a;this._loader=c;this._activeRequests=
null;b&&b.trackRequests&&(this._activeRequests=new Map)}f.prototype.request=function(a,c){var b=this;c=this._loader.request(a,c,this._clientType);if(this._activeRequests){this._activeRequests.set(a,c);var f=function(){b._activeRequests.delete(a)};c.then(f,f)}return c};f.prototype.cancelRequest=function(a){this._loader.cancel(a)};f.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(c){a._loader.cancel(c)}),this._activeRequests.clear())};f.prototype.hasPendingDownloads=
function(){return this._loader.hasPendingDownloads()};return f}()})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./ResourceController ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function d(a){this.streamDataSupplier=this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;
var d=c.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(d);this.textures=new b(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=l.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=l.getLabelSettings(a.viewingMode)}d.prototype.destroy=function(){this.streamDataSupplier=
this.textures=this.streamDataSupplier=null};d.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var c="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),f.removeUnordered(b.graphicsOwners,a),b.updateScreenSizePerspectiveEnabled())}}};d.prototype.updateScreenSizePerspectiveEnabled=function(){var b=
this,c=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new a,c=function(){return b.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",c,!0),this.pointsOfInterest.events.on("camera-parameters-changed",c)]),this.updateScreenSizePerspectiveSettings()):!c&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),
this.screenSizePerspectiveHandles=null)};d.prototype.updateScreenSizePerspectiveSettings=function(){e.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;e.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(e);this.screenSizePerspectiveSettingsLabels.update(e);this.stage.setNeedsRender()};return d}();g.SharedSymbolResources=r;var e={distance:0,fovY:0};g.default=r})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/urlUtils dojo/Deferred dojo/_base/lang ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),
function(r,g,f,a,c,b,l){var e=l.assert;return r(null,{constructor:function(a,b,c){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=c||{}},acquire:function(a,b,e){var d;if(d=this._textureRecords[a])return d.referenceCount++,d.texture||d.clientDfd;if(b)return e=b(a),this._stage.add(c.ModelContentType.TEXTURE,e),d={texture:e,referenceCount:1},this._textureRecords[a]=
d,e;d=new f;b=this._streamDataSupplier.request(a,"image");this._textureRecords[a]={clientDfd:d,loaderDfd:b,texture:null,size:Math.ceil(e||0),referenceCount:1};b.then(this._loadedHandler,this._errorHandler);return d.promise},release:function(a){var b=this._textureRecords[a];b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&(b.texture?(this._stage.remove(c.ModelContentType.TEXTURE,b.texture.id),b.texture=null):this._streamDataSupplier.cancelRequest(b.loaderDfd),
delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];e(!a||0<a.referenceCount,"texture record with zero reference count");return!!a},_loadedHandler:function(d,f){var h=this._textureRecords[d];e(h&&!h.texture);if(g.isSVG(d)&&(h.size||0===f.width&&0===f.height)){d=f.width?f.height/f.width:1;var l=h.size||64;1<d?(f.width=Math.round(l/d),f.height=l):(f.width=l,f.height=Math.round(l*d))}d=a.mixin({width:f.width,height:f.height},
this._textureOptions);f=new b(f,"symbol",d);this._stage.add(c.ModelContentType.TEXTURE,f);h.texture=f;h.clientDfd.resolve(f)},_errorHandler:function(a){a=this._textureRecords[a];e(a&&!a.texture);a.clientDfd.reject()}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../Evented ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Selector".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){Object.defineProperty(g,"__esModule",{value:!0});var y=Array;r=function(c){function g(a){a=c.call(this,a)||this;a.handles=new b;a.lastSeenCameraParameters=new x;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new n.default({pointOfView:e,renderPointOfView:y},a);a.updateSurfaceAltitudeFrequentInterval=B;a.updateSurfaceAltitudeInfrequentInterval=
D;a.events=new h.Evented;a.renderPointOfView=[0,0,0];return a}f(g,c);g.prototype.initialize=function(){var a=this,b=this.view,c=b.state,d=b.basemapTerrain,e=b.renderCoordsHelper,b=b.map;this.surfaceSelector=new v(c.mode);this.surfaceSelector.enableBackfacesTerrain=c.isGlobal?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new v(c.mode);this.contentSelector.enableTerrain=!1;var f=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new p.default({state:c,
surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new p.default({state:c,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new p.default({state:c,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),
altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("cameraOnSurface",new t.default({state:c,surface:d,renderCoordsHelper:e,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:b}));this._set("surfaceGeometryUpdates",new u.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new k.default({contentLayerViews:this.view.allLayerViews,
renderCoordsHelper:e}));this._set("surfaceOrigin",new m.default({view:this.view}));this.handles.add(c.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(d.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);
this.forceUpdate()};g.prototype.destroy=function(){q.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","propertiesPool")};Object.defineProperty(g.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);return a},enumerable:!0,configurable:!0});g.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();
this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate()};g.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()};g.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;
this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.state.camera;this.view._stage.pickRay(a.eye,a.center,null,null,null,!1,this.contentSelector);this.contentSelector.minResult.getIntersectionPoint(C)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(C):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};g.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;
if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(C)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(C));return this.surfaceAltitudeAtCenter};g.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);
this.cameraParametersChanged(this.lastSeenCameraParameters,a)&&(this.lastSeenCameraParameters.copyFrom(a),A.camera=a,this.events.emit("camera-parameters-changed",A));a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",d.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};g.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=
this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a)};g.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)};g.prototype.cameraParametersChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||
a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};a([l.property({constructOnly:!0})],g.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([l.property({constructOnly:!0})],g.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0);a([l.property({readOnly:!0})],g.prototype,"centerOnContent",void 0);a([l.property({readOnly:!0})],g.prototype,"centerOnSurfaceFrequent",void 0);a([l.property({readOnly:!0})],
g.prototype,"centerOnSurfaceInfrequent",void 0);a([l.property({readOnly:!0})],g.prototype,"cameraOnSurface",void 0);a([l.property({readOnly:!0})],g.prototype,"surfaceOrigin",void 0);a([l.property({readOnly:!0})],g.prototype,"contentGeometryUpdates",void 0);a([l.property({readOnly:!0})],g.prototype,"events",void 0);a([l.property({readOnly:!0,dependsOn:["renderPointOfView"]})],g.prototype,"pointOfView",null);a([l.property({readOnly:!0})],g.prototype,"renderPointOfView",void 0);a([l.property({readOnly:!0})],
g.prototype,"surfaceGeometryUpdates",void 0);a([l.property({constructOnly:!0})],g.prototype,"view",void 0);return g=a([l.subclass("esri.views.3d.support.PointsOfInterest")],g)}(l.declared(c));g.PointsOfInterest=r;var A={camera:null},C=d.vec3d.create(),B=200,D=3E3;g.default=r})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../PropertiesPool ./PointOfInterest".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){Object.defineProperty(g,"__esModule",{value:!0});var t=Array;r=function(g){function m(a){a=g.call(this,a)||this;a.propertiesPool=new h.default({location:e,renderLocation:t},a);a.estimatedSurfaceAltitude=0;a.pendingElevationQuery=null;a.renderLocation=[0,0,0];return a}f(m,g);m.prototype.initialize=function(){var a=this;this.measureSurfaceAltitudeThrottle=c.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude();var d=function(){return a.measureSurfaceAltitudeThrottle()};this.map&&this.handles.add([b.on(this.map,"ground.layers","change",d,d,d)])};m.prototype.destroy=function(){this.cancelPendingRequest()};Object.defineProperty(m.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});m.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();
this.updateCameraOnSurface()};m.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCameraOnSurface()};m.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()||!!this.pendingElevationQuery};m.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};m.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();if(this.map&&
this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,k,this.state.spatialReference);var b=this.map.ground.queryElevation(k).then(function(b){a.updateSurfaceAltitude(b.geometry.z)}).catch(function(b){b&&"cancel"===b.dojoType||a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===b&&(a.pendingElevationQuery=null)});b.isFulfilled()||(this.pendingElevationQuery=b)}else this.updateSurfaceAltitude(0)};m.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==
a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};m.prototype.updateCameraOnSurface=function(){d.vec3d.set(this.state.camera.eye,p);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,p);var a=this._get("renderLocation");a[0]===p[0]&&a[1]===p[1]&&a[2]===p[2]||this._set("renderLocation",d.vec3d.set(p,this.propertiesPool.get("renderLocation")))};m.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([l.property({constructOnly:!0})],m.prototype,"altitudeEstimationInterval",void 0);
a([l.property({readOnly:!0,dependsOn:["renderLocation"]})],m.prototype,"location",null);a([l.property({constructOnly:!0})],m.prototype,"map",void 0);a([l.property({readOnly:!0})],m.prototype,"renderLocation",void 0);return m=a([l.subclass("esri.views.3d.support.CameraOnSurface")],m)}(l.declared(n.PointOfInterest));g.CameraOnSurface=r;var p=d.vec3d.create(),k=new e;g.default=r})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function d(a){a=c.call(this)||this;a.handles=new b;return a}f(d,c);d.prototype.destroy=function(){e.default(this,"handles")};a([l.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);a([l.property({constructOnly:!0})],d.prototype,"surface",void 0);a([l.property({constructOnly:!0})],d.prototype,"state",void 0);return d=a([l.subclass("esri.views.3d.support.PointOfInterest")],d)}(l.declared(c));
g.PointOfInterest=r;g.default=r})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(r,g,f){function a(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(a instanceof f&&a.destroyed)try{throw Error("instance is already destroyed");}catch(h){console.warn(h.stack)}else for(c=0;c<b.length;c++){var e=b[c];if(!(e in a))throw Error("Property '"+e+"' does not exist and cannot be disposed");var d=a[e];d&&("function"===
typeof d.destroy?d.destroy():"function"===typeof d.dispose?d.dispose():"function"===typeof d.remove&&d.remove());a instanceof f&&e in a.__accessor__.metadatas?a._set(e,null):a[e]=null}}Object.defineProperty(g,"__esModule",{value:!0});g.disposeMembers=a;g.default=a})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){Object.defineProperty(g,"__esModule",{value:!0});var k=Array;r=function(g){function p(a){a=g.call(this,a)||this;a.propertiesPool=new t.default({location:l,renderLocation:k},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}f(p,g);u=p;p.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=c.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude()};Object.defineProperty(p.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});p.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};p.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};p.prototype.hasPendingUpdates=
function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};Object.defineProperty(p.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});p.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};p.prototype.updateCenterOnSurface=function(){var a=q,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),c=this.currentSurfaceAltitude!==
this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=m;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(e.vec3d.set(c,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=e.vec3d.dist(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,e.vec3d.add(e.vec3d.scale(b.viewForward,this._get("distance"),a),b.eye));b=this._get("renderLocation");
b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",e.vec3d.set(a,this.propertiesPool.get("renderLocation")))};p.prototype.calculateSurfaceIntersection=function(a,b){var c=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(c.eye,c.viewForward,a,b))return!1;if(this.state.isGlobal){a=h.earthRadius+a;var d=e.vec3d.length2(c.eye),f=d<a*a,k=e.vec3d.dist(c.eye,b);f&&k>h.earthRadius/4&&e.vec3d.add(e.vec3d.scale(c.viewForward,a-Math.sqrt(d),b),c.eye)}else if(c=this.surface.ready&&
this.surface.extent)b[0]=n.clamp(b[0],c[0],c[2]),b[1]=n.clamp(b[1],c[1],c[3]);return!0};p.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=e.vec3d.dist(c,a);b=e.vec3d.dist(c,b);if(d.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(b-a)/a>u.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};p.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=
.05;a([b.property({constructOnly:!0})],p.prototype,"altitudeEstimationInterval",void 0);a([b.property({readOnly:!0})],p.prototype,"distance",void 0);a([b.property({constructOnly:!0})],p.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([b.property({readOnly:!0,dependsOn:["renderLocation"]})],p.prototype,"location",null);a([b.property({readOnly:!0})],p.prototype,"renderLocation",void 0);return p=u=a([b.subclass("esri.views.3d.support.CenterOnSurface")],p);var u}(b.declared(p.PointOfInterest));
g.CenterOnSurface=r;var q=e.vec3d.create(),m=e.vec3d.create();g.default=r})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Handles","../Evented"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function b(b){this.handles=new f;this.events=new a.Evented;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),
removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",b.contentChanged.bind(b)),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",c)};
return b}();g.ContentGeometryUpdates=r;var c={};g.default=r})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),function(r,g,f,a,c,b,l,e,d,h){Object.defineProperty(g,
"__esModule",{value:!0});r=function(c){function g(a){a=c.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new b;return a}f(g,c);Object.defineProperty(g.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],
function(){return a._update()}),l.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};g.prototype.destroy=function(){this._handles.destroy()};g.prototype._update=function(){var a=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=h.center(this.surfaceView.extent),b=new d({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(b,{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("location",b.geometry)}).catch(function(a){"cancel"===a||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",b)}else this._set("location",null)};a([e.property({constructOnly:!0})],g.prototype,"view",void 0);a([e.property({readOnly:!0,aliasOf:"view.map.ground"})],
g.prototype,"surface",void 0);a([e.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],g.prototype,"surfaceView",void 0);a([e.property({readOnly:!0})],g.prototype,"location",void 0);a([e.property({readOnly:!0,dependsOn:["location"]})],g.prototype,"renderLocation",null);return g=a([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],g)}(e.declared(c));g.StableSurfaceCenter=r;g.default=r})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../geometry/support/aaBoundingRect ../../lib/glMatrix ../debugFlags ../Evented".split(" "),
function(r,g,f,a,c,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function b(a){var b=this;this.handles=new f;this.tileGeometryUpdateExtent=c.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new e.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return b.tileGeometryChangeHandler(a)}))}
b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",d),this.hasPendingTileGeometryChanges=!1)};b.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};b.prototype.tileGeometryChangeHandler=function(b){var d=this;this.tileGeometryUpdateSpatialReference=
b.spatialReference;c.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return d.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};b.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(l.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",d));c.empty(this.tileGeometryUpdateExtent)};b.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};b.prototype.centerIntersectsExtent=function(a,b){var d=this.state.camera.eye,e=t,f=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(d,h,b);this.renderCoordsHelper.fromRenderCoords(f.renderLocation,
n,b);h[0]<n[0]?(e[0]=h[0],e[2]=n[0]):(e[0]=n[0],e[2]=h[0]);h[1]<n[1]?(e[1]=h[1],e[3]=n[1]):(e[1]=n[1],e[3]=h[1]);return c.intersects(e,a)};return b}();g.SurfaceGeometryUpdates=r;var d={},h=b.vec3d.create(),n=b.vec3d.create(),t=c.empty();g.default=r})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../lib/glMatrix ../support/Evented ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J,M,O,aa,V){function N(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function S(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function W(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var f in e.layerInfo)for(var h in e.layerInfo[f]){var g=e.layerInfo[f][h].upsampleFromTile;if(g&&g.tile===b)return!0}c=c||W(e,b)}}return c}var X=m.vec3d,Q=m.vec4d,I=m.mat4d,K=G.weakAssert,T=h.getLogger("esri.views.3d.terrain.TerrainSurface");
r=function(b){function h(a,c){a=b.call(this)||this;a.defaultTileBackground=F.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=Y;a.hideSkirtsMinimumCameraTilt=ba;a.hideSkirtsMaximumCameraTilt=R;a._clippingExtent=null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=q.create();a._iteratorPool=new n(O.IteratorPreorder);a._postorderIterator=new O.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=
0;a._memoryUsage={};a._curOverlayOpacity=1;a._curEyePos=X.create();a._curSplitLimits=[0,0,0,0,0,0];a._curFrustumPlanes=Array(6);a._viewProjectionMatrix=I.identity();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._handles=new d;a._frameLambda=null;a._frameUpdateLowerPrio=
new t(500);a._topLevelTilemapOnlyTiles=Array(F.TILEMAP_SIZE_EXP+1);a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;a.backgroundImage=F.DEFAULT_TILE_BACKGROUND;a.backgroundColor=null;for(c=0;c<a._topLevelTilemapOnlyTiles.length;c++)a._topLevelTilemapOnlyTiles[c]=new J([c-F.TILEMAP_SIZE_EXP,0,0]);for(c=0;6>c;c++)a._curFrustumPlanes[c]=Q.create();return a}f(h,b);h.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};h.prototype.initialize=function(){var a=
this;this.tilePool="planar"===this.manifold?B.Pool:D.Pool;this._renderer=new L(this.manifold,null);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.install(this._view._stage);p.init(this,"_background",function(){a._renderer.updateTileBackground(a._background)});this._handles.add(this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}));this._set("overlayManager",new C({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",
this._handleHasHighlights.bind(this)),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new E.SurfaceExtentHelperGlobal(b):new E.SurfaceExtentHelperLocal(b);this._handles.add(p.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new e({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,
getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new H({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._handles.add(p.init(this._view,
"map.ground.opacity",function(b){a.opacity=null!=b?b:1}));this._handles.add(p.init(this._view,"map.ground.surfaceDefaultColor",function(b){a.backgroundColor=b}));this._streamDataSupplier=this._view.resourceController.getStreamDataSupplier(A.ClientType.TERRAIN);b={needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate};this._frameLambda=this._frameUpdate.bind(this);this._view.resourceController.registerFrameWorker(this._frameLambda);this._view.resourceController.registerIdleFrameWorker(this,
b);this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryEvents.on("quality-changed",function(){return a._viewChangeUpdate()});this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",
this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});this._updateClippingExtent();this.notifyChange("extent")};h.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);
this._view.resourceController.deregisterFrameWorker(this._frameLambda);this._view.resourceController.deregisterIdleFrameWorker(this);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=this._stage=this._view=this._renderer=null};Object.defineProperty(h.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"opacity",{set:function(a){this._renderer.opacity=a;this._set("opacity",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,
configurable:!0});Object.defineProperty(h.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});h.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),
a&&this._viewChangeUpdate())};h.prototype.isVisible=function(){return this.visible&&this.ready};h.prototype.isSeeThrough=function(){return this._renderer.isTransparent()};h.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};h.prototype.intersect=function(a,b,c){this._renderer.intersect(a,b,c,null)};h.prototype.getElevation=function(a){if(!this.ready)return null;var b=this.rootTiles;if(0===b[0].layerInfo[F.LayerClass.ELEVATION].length)return null;var c=fa;if(Array.isArray(a))c=
a;else if("point"===a.type&&!v.pointToVector(a,c,this.tilingScheme.spatialReference))return T.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var d,e=0;e<b.length;e++)if(a=b[e],M.isPosWithinTile(a,c)){for(;a&&!a.renderData;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];d=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null;break}return d?P.elevationSampler(c[0],
c[1],d):null};h.prototype.getElevationBounds=function(){return this._elevationBounds};h.prototype.getScale=function(a){if(this.tilingScheme){if(!v.pointToVector(a,fa,this.spatialReference))return T.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],M.isPosWithinTile(a,fa)){for(;a.children[0];)b=0,fa[0]>a.children[0].extent[2]&&(b+=1),fa[1]<a.children[0].extent[1]&&
(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};h.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};h.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};h.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=this.tilingSchemeLogic.tilingScheme,c=
!1;a&&!q.equals(a,this._dataExtent)&&(c=!0,this._dataExtent?q.set(this._dataExtent,a):this._dataExtent=q.create(a));b!==this.tilingScheme&&(K(!!b,"tiling scheme cannot be reset to undefined"),c=!0,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",b),this._updateClippingExtent(),b&&(this._updateTiledLayers(),this._renderer.setTileSize(b.pixelSize[0]),this.overlayManager.setSpatialReference(b.spatialReference,"spherical"===this.manifold)));c&&this._updateRootTiles()};h.prototype._acquireTile=
function(a,b,c,d){var e=this.tilePool.acquire();ga[0]=a;ga[1]=b;ga[2]=c;e.init(ga,d,this,this.tilingScheme);return e};h.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};h.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var d=da,e=c.rootTilesInExtent(b,d,Infinity);if(this.rootTiles){if(e.length>ha){T.warn(F.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),
f=l.difference(b,e,N);if(0<f.removed.length||0<f.added.length){var h=this.rootTiles.filter(function(b){return-1<l.findIndex(f.removed,N.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});f.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);h.push(b);a._loadTile(b)});this._set("rootTiles",h);this._renderer.setRootTiles(this.rootTiles)}}else e.length>ha&&(T.warn(F.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),e=c.rootTilesInExtent(b,d,ha)),this._set("rootTiles",e.map(function(b){b=a._acquireTile(0,
b[1],b[2],null);a._loadTile(b);return b})),this._renderer.setRootTiles(this.rootTiles);l.equals(d,this._rootExtent)||(this._rootExtent=q.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayDirty();this.notifyChange("ready")}};h.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateOverlayOpacity(this._curEyePos),
this._updateTiles(this.rootTiles))};h.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.pendingUpdates&ca.UPDATE_GEOMETRY&&(this._renderer.updateTileGeometryNeedsUpdate(a),this._updateTileGeometry(a),a.pendingUpdates&=~ca.UPDATE_GEOMETRY)};h.prototype._updateTiles=function(a){var b=this._iteratorPool.acquire();b.reset(a);var c=this._curSplitLimits,d=this._curFrustumPlanes,e=this._curEyePos,f;M.hasVisibleSiblings(a)?(a=this._elevationBounds[0],f=this._elevationBounds[1]):
(a=Infinity,f=-Infinity);for(;!b.done;){var h=b.next();this._updateClippingStatus(h);var g=!0;if(h.updateVisibility(d,e)){h.updateScreenDepth(this._viewProjectionMatrix);h.renderData&&(a=Math.min(h.elevationBounds[0],a),f=Math.max(h.elevationBounds[1],f));var k=h.shouldSplit(c,e);k===ca.SPLIT?(h.pendingUpdates&=~ca.MERGE,h.renderData?(g=!1,h.pendingUpdates|=ca.SPLIT,b.skip()):g=!1):(h.pendingUpdates&=~ca.SPLIT,k===ca.VSPLITMERGE&&h.updateAgents(F.LayerClass.ELEVATION),b.skip())}else b.skip();if(g&&
!h.renderData){h.pendingUpdates|=ca.MERGE;h.pendingUpdates&=~ca.SPLIT;g=this._iteratorPool.acquire();for(g.reset(h);!g.done;)k=g.next(),this._updateClippingStatus(k),k.updateVisibility(d,e),k.visible&&k.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(g)}0!==h.pendingUpdates&&(this._pendingUpdates=!0)}this._iteratorPool.release(b);isFinite(a)&&isFinite(f)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==f)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=f,this.emit("elevation-bounds-change",
null))};h.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias());this._curSplitLimits[0]=b;this._curSplitLimits[1]=d[0]/a.width*this.maxTextureScale*e;this._curSplitLimits[2]=c;this._curSplitLimits[3]=d[1]/a.height*this.maxTextureScale*e;this._curSplitLimits[4]=this.tilingScheme.getMaxLod();this._curSplitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;
a.copyFrustumPlanes(this._curFrustumPlanes);I.multiply(a.projectionMatrix,a.viewMatrix,this._viewProjectionMatrix);X.set(a.eye,this._curEyePos);G.autoUpdateSkirtsVisibility(this,this._curEyePos,a.near)};h.prototype._setLayerViewsUpdating=function(){for(var a=0;a<F.LayerClass.LAYER_CLASS_COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c].updatingChanged(this._pendingUpdates)};h.prototype._frameUpdateTraversal=function(a){if(this.suspended)return!1;this._frameUpdateLowerPrio.clear();var b=
this._renderer.resourceCounter.numTileTexturesComposited,c=this._iteratorPool.acquire();c.reset(this.rootTiles);for(var d=!1,e=!1;!c.done&&(1<a.remaining()||!d)&&this._renderer.resourceCounter.numTileTexturesComposited-b<ea;){var f=c.next();f.pendingUpdates&ca.MERGE?(this._mergeTile(f),f.pendingUpdates&=~ca.MERGE,d=!0,c.skip()):f.pendingUpdates&ca.SPLIT?(this._splitTile(f),f.pendingUpdates&=~ca.SPLIT,d=!0,c.skip()):0<f.pendingUpdates&&this._frameUpdateLowerPrio.push(f);0!==f.pendingUpdates&&(e=!0)}this._pendingUpdates=
e||!c.done;this._iteratorPool.release(c);return d};h.prototype._updateTileGeometry=function(a){this._renderer._updateTileGeometry(a);ka.spatialReference=this.spatialReference;ka.tile=a;ka.extent=a.extent;this.emit("elevation-change",ka)};h.prototype._updateTileTexture=function(a){this._renderer.updateTileTexture(a)};h.prototype._frameUpdate=function(a){if(this.rootTiles){for(var b=this._frameUpdateTraversal(a);(1<a.remaining()||!b)&&0<this._frameUpdateLowerPrio.length;){var c=this._frameUpdateLowerPrio.pop();
c.pendingUpdates&ca.DECODE_ELEVATION?(this._decodeElevation(c),c.pendingUpdates&=~ca.DECODE_ELEVATION,b=!0):c.pendingUpdates&ca.UPDATE_GEOMETRY?(this._renderer.updateTileGeometryNeedsUpdate(c),this._updateTileGeometry(c),b=!0,c.pendingUpdates&=~ca.UPDATE_GEOMETRY):c.pendingUpdates&ca.UPDATE_TEXTURE&&(this._updateTileTexture(c),c.pendingUpdates&=~ca.UPDATE_TEXTURE,b=!0);0!==c.pendingUpdates&&(this._pendingUpdates=!0)}0<this._frameUpdateLowerPrio.length&&(this._pendingUpdates=!0);if(this._streamDataSupplier.hasPendingDownloads()||
0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0);b&&(this._memoryUsage={})}};h.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};h.prototype._idleUpdate=function(){this.overlayManager.updateOverlays();this._updateOverlayOpacity(this._curEyePos)};
h.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=q.create(),b=null;v.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(l.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this._updateTileOverlayParams();this.overlayManager.setOverlayDirty();return!0};h.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};h.prototype._getLodBias=
function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias+2*this._view.resourceController.memoryFactor-2)};h.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=x.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};h.prototype._cancelTilemapRequests=function(a){for(var b=0;b<F.LayerClass.LAYER_CLASS_COUNT;b++){var c=a.layerInfo[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.tilemapRequest&&(e.tilemapRequest.cancel(),e.tilemapRequest=null)}}};
h.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._set("rootTiles",null),this.notifyChange("ready"));for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};h.prototype._purgeChildTiles=function(a){var b=this._postorderIterator;for(b.reset(a);!b.done;){for(var c=b.next(),d=0;4>d;d++)c.children[d]=null;c!==a&&this._purgeTile(c)}};
h.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};h.prototype._splitTile=function(a){var b=a.lij[0]+1,c=2*a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(b,c,d,a);a.children[1]=this._createTile(b,c,d+1,a);a.children[2]=this._createTile(b,c+1,d,a);a.children[3]=this._createTile(b,c+1,d+1,a);a.unload(this._renderer);U.spatialReference=this.spatialReference;U.extent=a.extent;U.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",
U)};h.prototype._createTile=function(a,b,c,d){K(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._curFrustumPlanes,this._curEyePos);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._curSplitLimits,this._curEyePos)===ca.SPLIT&&(a.pendingUpdates|=ca.SPLIT,this._pendingUpdates=!0));this._loadTile(a);return a};h.prototype._mergeTile=function(a){K(!a.renderData,"_mergeTile sanity check");this._loadTile(a);
this._purgeChildTiles(a);U.spatialReference=this.spatialReference;U.extent=a.extent;U.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",U)};h.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._curOverlayOpacity);ka.spatialReference=this.spatialReference;ka.tile=a;ka.extent=a.extent;this.emit("elevation-change",ka)};h.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};
h.prototype._decodeElevation=function(a){var b=F.LayerClass.ELEVATION,c=a.layerInfo[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.pendingUpdates&=~ca.DECODE_ELEVATION;if(e.rawData){var f=a.decodeElevationData(e.rawData);e.rawData=null;if(f){e.data=f;var e=a.lij[0],h=this._iteratorPool.acquire();for(h.reset(a);!h.done;){var g=h.next();g.findElevationBoundsForLayer(d,e);g.computeElevationBounds()}this._iteratorPool.release(h);a.dataArrived(d,b,f);this._updateTiles(a)}}}};h.prototype._handleLayerViewChanges=
function(a){var b=this,c=!1;a.added.forEach(function(a){var d=a.layer;G.isTiledLayerView(a)?(b._registerTiledLayer(a),d.loaded&&(c=!0)):a.supportsDraping&&b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){G.isTiledLayerView(a)?(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(G.isTiledLayerView).length)&&this._updateTiledLayers()};h.prototype._registerTiledLayer=function(a){var b=
this,c=[];c.push(a.watch("suspended",function(){b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));a.on("data-changed",function(){var c=G.isElevationLayerView(a)?F.LayerClass.ELEVATION:F.LayerClass.MAP,d=b._layerIndexByLayerViewId[c][a.uid];null!=d&&b._invalidateLayerData(d,c)});this._basemapLayerViewHandles[a.uid]=c};h.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();
delete this._basemapLayerViewHandles[a]}};h.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,c=[[],[]],d=F.LayerClass,e=null,f=q.empty();b.forEach(function(b){var h=b.layer;if(b.layer&&b&&!b.suspended&&G.isTiledLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?(q.expand(f,g),G.isElevationLayerView(b)?c[d.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===e||b.maxDataLevel>e)&&(e=b.maxDataLevel),c[d.MAP].push(b))):
T.warn("Terrain: tiling scheme of layer "+h.id+" is incompatible with other tiled layers, will not be drawn"):T.warn("Terrain: Map or elevation layer does not have fullExtent: "+h.id)}},this);for(var b=function(a){var b=h._layerViews[a],e=c[a];e.reverse();var f=b.length!==e.length,g=e.length,k=Array(g),l=Array(b.length);h._layerIndexByLayerViewId[a]={};for(var m=0;m<g;m++){h._layerIndexByLayerViewId[a][e[m].uid]=m;var q=b.indexOf(e[m]);k[m]=q;m!==q&&(f=!0);-1<q&&(l[q]=m)}if(f){h._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(l,
k,a)});b=h._postorderIterator;if(h.rootTiles)for(b.reset(h.rootTiles);!b.done;)b.next().modifyLayers(l,k,a);h._layerViews[a]=e;if(h.rootTiles){for(b.reset(h.rootTiles);!b.done;)e=b.next(),e.restartAgents(a),a===d.ELEVATION&&e.computeElevationBounds();h._updateTiles(h.rootTiles)}}},h=this,g=0;g<d.LAYER_CLASS_COUNT;g++)b(g);this.tilingScheme.levels.length-1<e&&(this.tilingScheme.ensureMaxLod(e),this._viewChangeUpdate())}};h.prototype._hasFixedExtent=function(){return!!this._clippingExtent};h.prototype.layerViewByIndex=
function(a,b){return this._layerViews[b][a]};h.prototype.numLayers=function(a){return this._layerViews[a].length};h.prototype.numTotalLayers=function(){return this._layerViews.reduce(function(a,b){return b.length+a},0)};h.prototype._updateTileTextures=function(){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)};h.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,
b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c)};h.prototype.requestTileData=function(a,b,c){var d=this;this.tilemapStats.tilesRequested++;var e=this.layerViewByIndex(b,c),f=e.layer;if(f.tilemapCache&&!G.isVectorTileLayerView(e)){var h=this.getTilemapTile(a),g=h.layerInfo[c][b];if(g.tilemap){if(!h.tileDataAvailable(a,b,c))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),b=new y.Promise,
b.reject(),b}else{g.tilemapRequest||(g.tilemapRequest=this.requestTilemap(h,b,c,e,f));var k,l=new y.Promise(function(){k&&k.cancel()});g.tilemapRequest.always(function(){g.tilemapRequest=null;if(!l.isCancelled()){var b=d._layerIndexByLayerViewId[c][e.uid];null!=b&&(h.tileDataAvailable(a,b,c)?(k=d._requestTileData(a,b,c,e),k.then(function(){return l.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),l.reject()))}});return l}}return this._requestTileData(a,
b,c,e)};h.prototype._requestTileData=function(a,b,c,d){this.tilemapStats.tileRequestsSent++;return c===F.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,d):this._requestMapTileData(a,b,c,d)};h.prototype._requestElevationTileData=function(a,b,c,d){function e(b){var e=h._layerIndexByLayerViewId[c][d.uid];null!=e?(e=a.layerInfo[c][e],e.rawData=b,a.pendingUpdates|=ca.DECODE_ELEVATION,e.pendingUpdates|=ca.DECODE_ELEVATION,h._pendingUpdates=!0):T.warn("TerrainSurface: received data from unknown layer %d %s",
c,a.lij.toString())}function f(b){S(b)||(h.tilemapStats.tileRequestErrors++,h._dispatchDataEvent(a,"dataMissing",c,d,b))}var h=this,g;G.isElevationLayerView(d)?(b=d.layer,G.useFetchTileForLayer(b)?(g=b.fetchTile(a.lij[0],a.lij[1],a.lij[2],F.ELEVATION_NODATA_VALUE),g.then(function(a){return e(a)},f)):(b=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),g=this._streamDataSupplier.request(b,"binary"),g.then(function(a,b){b.url=a;e(b)},f))):K(!1,"_requestElevationTileData can only be called for elevation layer views");
return g};h.prototype._requestMapTileData=function(a,b,c,d){function e(b){h._dispatchDataEvent(a,"dataArrived",c,d,b)}function f(b){S(b)||(h._dispatchDataEvent(a,"dataMissing",c,d,b),h.tilemapStats.tileRequestErrors++)}var h=this;if(G.isVectorTileLayerView(d)){var g=d.tileHandler;b=d.schemeHelper.getCompatibleLevelRowCol(a.lij);b=g.getVectorTileWithLRC(b[0],b[1],b[2],0);b.then(e).catch(f).always(function(){h._vectorTileLayerRequests=g.ongoingRequestCount});this._vectorTileLayerRequests=g.ongoingRequestCount}else G.useFetchTileForLayer(d.layer)&&
G.isTileLayerView(d)?(b=d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{allowImageDataAccess:!0}),b.then(e).catch(f)):(b=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),null!=d.refreshInterval&&d.refreshTimestamp&&(b+=(-1<b.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp),b=this._streamDataSupplier.request(b,"image"),b.then(function(a,b){return e(b)},f));return b};h.prototype.requestTilemap=function(a,b,c,d,e){var f=this,h=a.lij[0]+F.TILEMAP_SIZE_EXP,g=a.lij[1]<<F.TILEMAP_SIZE_EXP,k=a.lij[2]<<F.TILEMAP_SIZE_EXP;
this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return e.tilemapCache.fetchTilemap(h,g,k,{timeout:6E3}).then(function(e){f.tilemapStats.tilemapRequestsPending--;b=f._layerIndexByLayerViewId[c][d.uid];null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(a){f.tilemapStats.tilemapRequestsPending--;f.tilemapStats.tilemapRequestErrors++})};h.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>F.TILEMAP_SIZE_EXP?M.getTileNLevelsUp(a,F.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};
h.prototype._dispatchDataEvent=function(a,b,c,d,e){d=this._layerIndexByLayerViewId[c][d.uid];if(null!=d)a[b](d,c,e);else T.warn("TerrainSurface: received data from unknown layer")};h.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._curOverlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};
h.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._curOverlayOpacity&&this.rootTiles){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._curOverlayOpacity=a;this._renderer.setNeedsRender()}};h.prototype.getStats=function(){var a=0,b=0,c=0,d=[],e=this._iteratorPool.acquire();for(e.reset(this.rootTiles);!e.done;){var f=
e.next();a++;f.renderData&&(b++,f.visible&&(c++,f=f.lij[0],d[f]=null!=d[f]?d[f]+1:1))}this._iteratorPool.release(e);return{numNodes:a,numLeaves:b,numVisible:c,numVisiblePerLevel:d}};h.prototype.getUsedMemory=function(){if(!this._view||!this._view.basemapTerrain)return 0;var a=this._view.basemapTerrain.getMemoryUsage(),b=0,c;for(c in a)b+=a[c];return b/1024/1024};h.prototype.getMemoryUsage=function(){0===Object.keys(this._memoryUsage).length&&this._updateMemoryUsage();return this._memoryUsage};h.prototype._updateMemoryUsage=
function(){if(this.tilingScheme){var a=0,b=0,c=0,d=0,e=0,f=0,h=this._iteratorPool.acquire();h.reset(this.rootTiles);for(var g=this.tilingScheme.pixelSize,g=g[0]*g[1]*4;!h.done;){for(var k=h.next(),l=W(k),m=0,q=k.layerInfo[F.LayerClass.MAP];m<q.length;m++){var n=q[m],n=n.data,p=0,t=0;n instanceof V?p+=1.3*n.descriptor.width*n.descriptor.height*4:n instanceof HTMLImageElement?t+=g:n instanceof aa&&(f+=n.getGpuMemoryUsage(),c+=n.getCpuMemoryUsage());k.renderData||l?(a+=t,d+=p):(b+=t,e+=p)}l=0;for(m=
k.layerInfo[F.LayerClass.ELEVATION];l<m.length;l++)n=m[l],n=n.data,a+=n?g:0;k.renderData&&(n=k.renderData.texture,d+=n&&n.descriptor?1.3*n.descriptor.width*n.descriptor.height*4:0,k=k.renderData.estimateGeometryMemoryUsage(),f+=k,c+=k)}this._iteratorPool.release(h);this._memoryUsage={cpuVisibleImageData:a,cpuInvisibleImageData:b,cpuGeometryData:c,gpuVisibleImageData:d,gpuInvisibleImageData:e,gpuGeometryData:f}}};h.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===
b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),null;var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),e=Math.floor(b[2]/c),f;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<b[0];){var h=b[1]&c?2:0;0<(b[2]&c)&&h++;if(!f.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+M.tile2str(f)),null;f=f.children[h];c>>=1}K(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");
return f}return null};h.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};h.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};h.prototype.setBorders=function(a){this._renderer.drawBorders=a};h.prototype.setDisableRendering=
function(a){this._renderer.disableRendering=a};a([k.property({value:!1})],h.prototype,"cullBackFaces",null);a([k.property({readOnly:!0})],h.prototype,"extent",null);a([k.property({readOnly:!0})],h.prototype,"loaded",void 0);a([k.property({value:1})],h.prototype,"opacity",null);a([k.property({readOnly:!0})],h.prototype,"overlayManager",void 0);a([k.property({readOnly:!0})],h.prototype,"manifold",void 0);a([k.property()],h.prototype,"maxTextureScale",void 0);a([k.property({readOnly:!0})],h.prototype,
"ready",null);a([k.property({value:1})],h.prototype,"renderOrder",null);a([k.property({readOnly:!0})],h.prototype,"rootTiles",void 0);a([k.property({value:!0})],h.prototype,"skirtScale",null);a([k.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],h.prototype,"spatialReference",void 0);a([k.property({})],h.prototype,"backgroundImage",void 0);a([k.property({type:c})],h.prototype,"backgroundColor",void 0);a([k.property({dependsOn:["backgroundColor","backgroundImage"]})],h.prototype,"_background",
null);a([k.property({readOnly:!0})],h.prototype,"tilingScheme",void 0);a([k.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],h.prototype,"tilingSchemeLocked",void 0);a([k.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],h.prototype,"tilingSchemeDone",void 0);a([k.property({readOnly:!0})],h.prototype,"tilingSchemeLogic",void 0);a([k.property({value:!0})],h.prototype,"velvetOverground",null);a([k.property({value:!1})],h.prototype,"wireframe",null);return h=
a([k.subclass("esri.views.3d.terrain.TerrainSurface")],h)}(k.declared(b,u.Evented));var Y=1.2,ba=80/180*Math.PI,R=110/180*Math.PI,ha=F.MAX_ROOT_TILES,ea=12,ca=F.TileUpdateTypes,fa=Q.create(),da=q.create(),ga=[0,0,0],ka={spatialReference:null,tile:null,extent:null},U={spatialReference:null,extent:null,scale:0};return r})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../lib/glMatrix ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../webgl-engine/lib/Selector ../webgl-engine/lib/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C){var B=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],D=d.getLogger("esri.views.3d.OverlayManager"),E,H=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a._handles=new e;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}
f(g,d);Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedTextureRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setOverlayDirty()};this.groundSelector=new A(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=
!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayDirty()}))};g.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._handles&&
(this._handles.destroy(),this._handles=null)};g.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};g.prototype.hasOverlays=function(){return!!this._overlays};g.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new v.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):
new v.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};g.prototype.registerLayerView=function(a){var b=this,d=a.layer.uid;if(this._connectedLayers[d])D.warn("[OverlayManager#registerLayerView]: Layer "+d+" is already connected");else{var e=c(a,"draped-data-change",function(){return b.setOverlayDirty()});this._connectedLayers[d]={eventHandles:[e],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(c,d){a.setDrapingExtent(d,
c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin)});this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)}};g.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];if(c.layerView===a){if(c.eventHandles)for(var d=0;d<c.eventHandles.length;d++)c.eventHandles[d].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a.overlayUpdating=!1)}}};g.prototype.setOverlayDirty=function(){this._dirty||(this._setOverlayUpdating(!0),
this._dirty=!0)};g.prototype._setLayerViewOverlayUpdating=function(a,b){if(!b||!a.suspended&&a.hasDraped)a.overlayUpdating=b};g.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[b].layerView,a);if(b=this.view.graphicsView)b.overlayUpdating=a};g.prototype.updateOverlays=function(){if(this._overlaySR){var a;a=Math.max(this.view.width,this.view.height);a=C.nextHighestPowerOfTwo(a+256);a=Math.min(a,2048);this._computeOverlayExtents(a,
M);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,M.inner,a);this._updateOverlay(this._overlays.outer,1,M.outer,a);this.opacity=1;this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}};g.prototype._updateOverlay=function(a,b,c,d){var e;a:{e=a.extent;for(var f=m.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:H.EXTENTS_DIFFER_THRESHOLD*Math.max(c[2]-c[0],c[3]-c[1],e[2]-e[0],e[3]-e[1]),h=0;4>h;h++)if(Math.abs(e[h]-
c[h])>f){e=!0;break a}e=!1}if(e||d!==a.resolution){t.set(a.extent,c);a.resolution=d;a.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:t.center(a.extent,k.vec3d.create())};for(var g in this._connectedLayers)e=this._connectedLayers[g].layerView,e.setDrapingExtent&&e.setDrapingExtent(b,c,this._overlaySR,d,a.renderLocalOrigin)}};g.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};g.prototype.updateOpacity=function(a){var b=1;if(this._overlays){var c=this._scale;a=
this.view.renderCoordsHelper.getAltitude(a);3.5*a<c&&(b=Math.sqrt(v.clamp((a-c/10)/(c/3.5-c/10),0,1)))}return b};g.prototype.setOverlayParamsOfTile=function(a,b,c){var d=this._overlays.inner,e=this._overlays.outer;a=t.intersection(a.extent,a.parentSurface.extent,O);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,
b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};g.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),f=this._longitudeCyclical.minimalMonotonic(d[0],
a[2]);e>f&&(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null};g.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};g.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(b=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);
return b?(b.extent[2]-b.extent[0])/b.resolution:0};g.prototype._createEmptyOverlay=function(a){var b=this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createRenderTarget("overlayHighlight"+a);return{extent:t.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:{id:"O",vec3:[0,0,0]}}};g.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};g.prototype._disposeOverlays=
function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};g.prototype._intersectGroundFromView=function(a,b,c,d){var e=k.vec3d.createFrom(b*this.view.width,c*this.view.height,1);k.vec3d.unproject(e,a.viewMatrix,
a.projectionMatrix,a.fullViewport,e);b=k.vec3d.createFrom(b*this.view.width,c*this.view.height,0);k.vec3d.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b);this.groundSelector.init([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,b,e);return this.groundSelector.minResult.getIntersectionPoint(d)};g.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=k.vec3d.create(a.eye);k.vec3d.normalize(d);k.vec3d.negate(d);
b=k.vec3d.length(b);b=Math.asin(b/k.vec3d.length(a.eye));var e=Math.acos(k.vec3d.dot(a.viewForward,d)),d=v.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=v.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=k.mat4d.multiplyVec4(a.projectionMatrix,k.vec4d.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],d=v.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};g.prototype._computeOverlayExtents=function(a,
c){var d=this.view.state.camera,e=this.terrainSurface.extent,f=k.vec3d.create(),h=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(d,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,f)||k.vec3d.set(h,f);this._scale=this.view.renderCoordsHelper.getAltitude(d.eye);var g=k.vec3d.dist(d.eye,f),h=q.viewAngle(this.view.renderCoordsHelper,h,d.eye),h=Math.PI/2-Math.abs(h-Math.PI/2);if(u.OVERLAY_SHOW_CENTER){var l=new p({color:[255,0,
0],outline:{color:[255,255,255],width:2}}),m=new n;y.vectorToPoint(f,this._renderSR,m,this._overlaySR);l=new b({geometry:m,symbol:l});void 0!==E&&this.view.graphics.remove(E);this.view.graphics.add(l);E=l}this._overlaySREqualsRenderSR||y.vectorToVector(f,this._renderSR,f,this._overlaySR);a=.5*a*d.perPixelRatio*g*2;m=!1;g=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(a/=Math.cos(y.webMercator.y2lat(f[1])),g=this.terrainSurface.extent[3],g*=.999):(m=!0,a/=x.metersPerDegree,g=90),a>=g&&
(a=g,f[1]=0,this._overlaySR.isWebMercator&&(f[0]=0)));l=1;m&&(l=1/Math.max(.2,Math.cos(Math.abs(v.deg2rad(f[1])))),180<a*l&&(l=180/a));var r=a*l,m=c.inner;m[0]=f[0]-r;m[1]=f[1]-a;m[2]=f[0]+r;m[3]=f[1]+a;this._isSpherical&&this._shiftExtentToFitBounds(m,Infinity,g);c=c.outer;t.set(c,m);6*r>e[2]-e[0]?t.set(c,e):h<=.25*Math.PI?(c[0]-=r,c[1]-=a,c[2]+=r,c[3]+=a):(y.vectorToVector(d.eye,this._renderSR,J,this._overlaySR),k.vec2d.subtract(f,J,P),d=-Math.atan2(P[1],P[0])+.125*Math.PI,0>d&&(d+=2*Math.PI),k.vec4d.scale(B[Math.floor(d/
(.25*Math.PI))],2*a,P),P[0]*=l,P[2]*=l,k.vec4d.add(c,P,c));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],-g),c[3]=Math.min(c[3],g));!this._isSpherical&&e&&(d=t.intersection(m,e,O),e=t.intersection(c,e,aa),t.contains(d,e)&&(c[2]=c[0],c[3]=c[1]))};g.prototype._drawOverlays=function(){var a=this._overlays.inner.extent[2]-this._overlays.inner.extent[0];this._drawOverlay(this._overlays.inner,0,a);this._drawOverlay(this._overlays.outer,
1,a)};g.prototype._drawOverlay=function(a,b,c){var d=this._renderer,e=a.extent,f=a.resolution,h=this._longitudeCyclical?e[2]>this._longitudeCyclical.max:!1,g=this._longitudeCyclical?e[0]<this._longitudeCyclical.min:!1;if(h||g){F.views=G;var g=void 0,g=h?this._longitudeCyclical.max-e[0]:this._longitudeCyclical.min-e[0],g=Math.round(g/(e[2]-e[0])*f),l=F.views[0];k.vec4d.set4(0,0,g,f,l.viewport);k.vec4d.set4(e[0],e[1],this._longitudeCyclical.max,e[3],l.extent);h||(l.extent[0]+=this._longitudeCyclical.range);
l=F.views[1];k.vec4d.set4(g,0,f-g,f,l.viewport);k.vec4d.set4(this._longitudeCyclical.min,e[1],e[2],e[3],l.extent);h&&(l.extent[2]-=this._longitudeCyclical.range)}else F.views=L,t.set(F.views[0].extent,e),k.vec4d.set4(0,0,f,f,F.views[0].viewport);F.width=f;F.height=f;F.pixelRatio=c/(e[2]-e[0]);F.index=b;a.valid=d.draw(a.renderTargetId,F);a.highlightValid=d.drawHighlights(a.highlightRenderTargetId,F)};g.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],
b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):t.intersects(a,b)};g.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:t.contains(b,a)};g.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&
a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};g.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);t.offset(a,d,e)};g.EXTENTS_DIFFER_THRESHOLD=1E-5;a([h.property()],g.prototype,"view",void 0);a([h.property()],g.prototype,"terrainSurface",void 0);a([h.property({type:Boolean})],g.prototype,"hasHighlights",null);return g=a([h.subclass("esri.views.3d.terrain.OverlayManager")],g)}(h.declared(l)),F={width:0,
height:0,pixelRatio:0,views:null,index:0},L=[{viewport:t.create(),extent:t.create()}],G=[L[0],{viewport:t.create(),extent:t.create()}],P=k.vec4d.create(),J=k.vec3d.create(),M={inner:t.create(),outer:t.create()},O=t.create(),aa=t.create();return H})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/glMatrix ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(r,g,f,a,c,b,l,e){r=function(c){function h(a,
b,e,f){var g=c.call(this,h.NumSubdivisionsAtLevel)||this;g.tileUp=d;void 0!==a&&g.init(a,b,e,f);return g}f(h,c);h.prototype.init=function(a,d,e,f){c.prototype.init.call(this,a,d,e,f);this.edgeLen=this.extent[2]-this.extent[0];this.curvatureHeight=0;this.centerAtSeaLevel[0]=b.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=b.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};h.prototype.updateRadiusAndCenter=function(){c.prototype.updateRadiusAndCenter.call(this);
var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(a*a+b*b)};h.prototype.isVisible=function(a,b){if(!this.intersectsClippingArea)return!1;b=this.extent[0];var c=this.extent[1],d=this.elevationBounds[0],e=this.extent[2],f=this.extent[3],h=this.elevationBounds[1];return 0<a[0][0]*(0<a[0][0]?b:e)+a[0][1]*(0<a[0][1]?c:f)+a[0][2]*(0<a[0][2]?d:h)+a[0][3]||0<a[1][0]*(0<a[1][0]?b:e)+a[1][1]*(0<a[1][1]?c:f)+a[1][2]*(0<a[1][2]?d:h)+
a[1][3]||0<a[2][0]*(0<a[2][0]?b:e)+a[2][1]*(0<a[2][1]?c:f)+a[2][2]*(0<a[2][2]?d:h)+a[2][3]||0<a[3][0]*(0<a[3][0]?b:e)+a[3][1]*(0<a[3][1]?c:f)+a[3][2]*(0<a[3][2]?d:h)+a[3][3]||0<a[4][0]*(0<a[4][0]?b:e)+a[4][1]*(0<a[4][1]?c:f)+a[4][2]*(0<a[4][2]?d:h)+a[4][3]||0<a[5][0]*(0<a[5][0]?b:e)+a[5][1]*(0<a[5][1]?c:f)+a[5][2]*(0<a[5][2]?d:h)+a[5][3]?!1:!0};h.prototype.createGeometry=function(a,b,c,d){a.needsUpdate=!1;e.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,c,a.clippingArea,d)};h.NumSubdivisionsAtLevel=
[2,2,2,2,2,2,2,2];h.Pool=new a(h);return h}(l);var d=c.vec3d.createFrom(0,0,1);return r})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../geometry/support/aaBoundingRect ../lib/glMatrix ../support/mathUtils ./ElevationData ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils".split(" "),function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){function q(a){a instanceof e?e.Pool.release(a):a instanceof d&&d.Pool.release(a)}
var m=n.weakAssert,u=c.vec3d.create(),x=c.vec4d.create(),v=c.vec4d.create(),y=c.vec3d.create(),A=t.AGENT_DONE,C=h.LayerClass.LAYER_CLASS_COUNT,B=h.LayerClass.MAP,D=h.LayerClass.ELEVATION,E=h.TileUpdateTypes;return function(){function g(b){this.lij=[0,0,0];this.extent=a.create();this.elevationBounds=c.vec2d.create();this.children=[null,null,null,null];this.layerInfo=Array(C);this.extentWGS84Rad=a.create();this.centerAtSeaLevel=c.vec3d.create();this.center=c.vec3d.create();this.tileUp=y;this.intersectsClippingArea=
this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0;this.numSubdivisionsAtLevel=b}g.prototype.init=function(a,b,d,e){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];e.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b.elevationBounds?c.vec2d.set(b.elevationBounds,this.elevationBounds):
c.vec2d.set2(0,0,this.elevationBounds);this.parent=b;for(a=0;4>a;a++)this.children[a]=null;this.pendingUpdates=0;this.renderData=null;this.screenDepth=0;this.visible=!1;this.parentSurface=d;for(a=0;a<C;a++)if(d){b=d.numLayers(a);var f=void 0;this.layerInfo[a]?(f=this.layerInfo[a],f.length=b):(f=Array(b),this.layerInfo[a]=f);for(var g=0;g<b;g++)f[g]=p.makeEmptyLayerInfo(a,f[g]),a===D&&this.findElevationBoundsForLayer(g,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=
Math.min(e.pixelSize[0],h.MAX_TILE_TESSELATION)};g.prototype.dispose=function(){for(var a=0;a<C;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++)b[c].dispose()};g.prototype.isVisible=function(a,b){return!0};g.prototype.createGeometry=function(a,b,c,d){};g.prototype.updateScreenDepth=function(a){c.vec3d.set(this.center,v);v[3]=1;c.mat4d.multiplyVec4(a,v,v);this.screenDepth=v[2]/v[3]};g.prototype.shouldSplit=function(a,d){var e=this.lij[0];c.vec3d.subtract(this.center,d,u);var f=c.vec3d.length(u),
h=this.edgeLen/(a[0]*f*2),g=this.edgeLen/(a[2]*f*2),k=a[1],l=a[3],m=a[4];a=a[5];return f<this.edgeLen&&e<m?E.SPLIT:h<k?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],E.VSPLITMERGE):E.NONE:e>=m?(g=e+Math.ceil(-b.log2(k/h)),g!==this.vlevel?(this.vlevel=g,E.VSPLITMERGE):E.NONE):6<e&&(c.vec3d.scale(this.tileUp,c.vec3d.dot(this.tileUp,u),x),c.vec3d.subtract(x,u),c.vec3d.length2(x)>this.radius*this.radius&&(c.vec3d.scale(x,this.radius/c.vec3d.length(x)),c.vec3d.add(x,this.center),c.vec3d.subtract(d,
x,x),d=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(c.vec3d.dot(x,this.tileUp))+.5*d+this.curvatureHeight)/c.vec3d.length(x))*g<.1/a*l))?E.NONE:E.SPLIT};g.prototype.decodeElevationData=function(a){var b;if(a instanceof ArrayBuffer)try{b=l.createFromLERC(this.lij,this.extent,a,h.noDataValueOpt)}catch(G){console.warn("Error decoding raw data: %s",G.message)}else b=l.createFromFetchTileResult(this.lij,this.extent,a);return b};g.prototype.getWGS84Extent=function(){var c=this.extentWGS84Rad;
return a.fromValues(b.rad2deg(c[0]),b.rad2deg(c[1]),b.rad2deg(c[2]),b.rad2deg(c[3]))};g.prototype.load=function(a){for(var b=0;b<C;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};g.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<C;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==A&&(d.loadingAgent.dispose(),q(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.pendingUpdates&=~h.TileUpdateTypes.UPDATE_GEOMETRY;
this.pendingUpdates&=~h.TileUpdateTypes.UPDATE_TEXTURE};g.prototype.updateClippingStatus=function(a){if(f.equals(a,this.clippingArea))return!1;var b=this.intersectsClippingArea,c=this.isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;a=c&&this.isWithinClippingArea;b=!c&&!b&&!this.isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||
a||b||this.updateGeometry();return!0};g.prototype.updateVisibility=function(a,b,c){a=(c||this.isVisible(a,b))&&this.intersectsClippingArea;if(a!==this.visible)for(this.visible=a,b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==A&&d.loadingAgent.setSuspension(!a)}return a};g.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};g.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};g.prototype.tileDataAvailable=
function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};g.prototype.requestLayerData=function(a,b,c){h.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;
if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),d.waitingAgents.push(c),setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&E.DECODE_ELEVATION)return d.waitingAgents.push(c),!0;d.waitingAgents.push(c);if(!d.requestPromise){var e=this.parentSurface.requestTileData(this,a,b);if(e.isFulfilled())return!1;a=function(){d.requestPromise===e&&(d.requestPromise=null)};d.requestPromise=
e;e.then(a,a);return!!e}return!0};g.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a};g.prototype.isLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};g.prototype.findByLij=function(a){if(this.isLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};g.prototype.unrequestLayerData=function(a,b,c){h.TILE_LOADING_DEBUGLOG&&
console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=e.indexOf(c);m(-1<c,"agent has not requested this piece of map data");e[c]=e[e.length-1];e.length--;1>e.length&&(e=d.requestPromise,c=!1,b===B&&(c=this.parentSurface.layerViewByIndex(a,B),c=n.isVectorTileLayerView(c)),c||m(e||d.rawData,"no pending operations on layerInfo that agents were waiting for"),e&&!e.isFulfilled()&&(e.cancel(),d.requestPromise=
null),h.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a))};g.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0};g.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);
a.waitingAgents.length=0};g.prototype.updateTexture=function(a){this.renderData&&(a?this.parentSurface.renderer.updateTileTexture(this):(this.pendingUpdates|=h.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface.setPendingUpdates()))};g.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};g.prototype.computeElevationBounds=function(){c.vec2d.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);for(var a=this.layerInfo[D],b=!1,d=0;d<
a.length;d++){var e=a[d];e.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],e.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],e.elevationBounds[1]),b=!0)}b||c.vec2d.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=function(){c.vec3d.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),x);c.vec3d.add(this.centerAtSeaLevel,x,this.center)};g.prototype.findElevationBoundsForLayer=function(a,
b){var d=this.layerInfo[D][a];if(!d.elevationBounds||d.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,D),k.fallsWithinLayer(this,b.layer,!1)){b=!1;if(d.data){var e=d.data;c.vec2d.set(e.bounds,x);x[2]=this.lij[0];b=!0}else{for(var f=this.parent,g=0,l=null,e=d.data;f&&(!e||g<h.ELEVATION_DESIRED_RESOLUTION_LEVEL);){g=this.vlevel-f.lij[0];l=e||l;e=f.layerInfo[D][a].data;if(!e&&l&&g>=h.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;f=f.parent}if(e=e||l)e.computeMinMaxValue(this.lij[0],this.lij[1],
this.lij[2],x),Infinity!==x[0]&&(x[2]=e.level,b=!0)}b&&(d.elevationBounds?c.vec3d.set(x,d.elevationBounds):d.elevationBounds=[x[0],x[1],x[2]])}};g.prototype.updateGeometry=function(){this.pendingUpdates|=h.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()};g.prototype.modifyLayers=function(a,b,c){for(var d=b.length,e=this.layerInfo[c],f=Array(d),h=0;h<e.length;h++){var g=e[h];g.loadingAgent&&g.loadingAgent!==A&&(g.loadingAgent.dispose(),q(g.loadingAgent),g.loadingAgent=null);
g.waitingAgents.length=0}if(c===B)for(h=0;h<e.length;h++)void 0===a[h]&&e[h].dispose();for(h=0;h<d;h++)a=b[h],f[h]=-1<a?e[a]:p.makeEmptyLayerInfo(c);this.layerInfo[c]=f};g.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===D){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=h.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()}else this.updateTexture(!0)};g.prototype.updateAgents=function(a){if(this.renderData){for(var b=
this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===A&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};g.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==A&&a.loadingAgent.dispose();a.loadingAgent=null};g.prototype.agentDone=function(a,b){var c=this.layerInfo[b],d=c[a];d.loadingAgent=A;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};g.prototype._createOrUpdateAgents=function(a,b){var c;c=b===D?!1:!this.visible;
for(var f=this.layerInfo[b];a<f.length;){var g=f[a],l=!1,m=this.parentSurface.layerViewByIndex(a,b);if(null!==g.loadingAgent&&g.loadingAgent!==A)l=g.loadingAgent.update();else if(g.loadingAgent!==A&&k.fallsWithinLayer(this,m.layer,!1)){var n;n=b===h.LayerClass.ELEVATION?e.Pool.acquire():d.Pool.acquire();(l=n.init(this,a,b,c))?g.loadingAgent=n:(n.dispose(),q(n),g.loadingAgent=A)}if(l&&!m.isTransparent)break;a++}};g.prototype.geometryState=function(a){var c,d=this._getElevationInfo(a?a.samplerData:
null),e=this.lij[0],g=!1;d.samplerData?(c=this.vlevel-e,c=Math.max(e-d.maxTileLevel,h.ELEVATION_DESIRED_RESOLUTION_LEVEL-c),e=this._maxTesselation,c=b.clamp((e>>c)+1,2,e+1)):c=8>e?this.numSubdivisionsAtLevel[e]+1:2;e=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)e=null;a?(a.numVertsPerRow!==c&&(a.numVertsPerRow=c,g=!0),d.changed&&(a.samplerData=d.samplerData,g=!0),f.equals(a.clippingArea,e)||(a.clippingArea=e,g=!0),a.needsUpdate=g):a={numVertsPerRow:c,samplerData:d.samplerData,
needsUpdate:!0,clippingArea:e};return a};g.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[D],c=b.length,d=Array(c),e=0,f=0,h=!1,g=0;g<c;g++){var l=b[g];if(l.upsampleFromTile){var l=l.upsampleFromTile.tile,m=l.layerInfo[D][g].data;a&&a[e]===m.samplerData||(h=!0);d[e++]=m.samplerData;f=Math.max(f,l.lij[0])}else l.data&&(m=this.parentSurface.layerViewByIndex(g,D),k.fallsWithinLayer(this,m.layer,!1)&&(m=l.data,a&&a[e]===m.samplerData||(h=!0),d[e++]=m.samplerData,f=this.lij[0]))}a&&a.length!==
e&&(h=!0);0<e?d.length=e:d=null;return{changed:h,samplerData:d,maxTileLevel:f}};g.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};g.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return g}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","../support/mathUtils","./TerrainConst"],function(r,g,
f,a,c){return function(){function b(a,b,c,f){this.samplerData=null;this.level=a;this.i=b;this.j=c;this.extent=f}b.prototype.computeMinMaxValue=function(b,e,d,f){var h=Infinity,g=-Infinity;b-=this.level;var l=Math.pow(2,b);if(Math.floor(e/l)===this.i&&Math.floor(d/l)===this.j&&0<b){var k=this.samplerData.width,q=this.samplerData.pixelData,m=.5*c.ELEVATION_NODATA_VALUE;b=(k-1)/l;d=(d-this.j*l)*b;e=(e-this.i*l)*b;if(1>b){var l=Math.floor(d),u=Math.floor(e),r=l+u*k,v=q[r],y=q[r+1],A=q[r+k],r=q[r+k+1];
if(v+y+A+r<m)return h=a.bilerp(v,y,A,r,d-l,e-u),g=a.bilerp(v,y,A,r,d-l+b,e-u),k=a.bilerp(v,y,A,r,d-l,e-u+b),b=a.bilerp(v,y,A,r,d-l+b,e-u+b),f[0]=Math.min(h,g,k,b),f[1]=Math.max(h,g,k,b),f;d=l;e=u;b=1}else d=Math.floor(d),e=Math.floor(e),b=Math.ceil(b);for(l=d;l<=d+b;l++)for(u=e;u<=e+b;u++)r=l+u*k,v=q[r],v<m?(h=Math.min(h,v),g=Math.max(g,v)):(h=0<h?0:h,g=0>g?0:g)}f[0]=h;f[1]=g;return f};b.createFromLERC=function(a,c,d,h){d=f.decode(d,h);a=new b(a[0],a[1],a[2],c);a.samplerData={pixelData:d.pixelData,
width:d.width,height:d.height,minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue,safeWidth:.99999999*(d.width-1),dx:(d.width-1)/(a.extent[2]-a.extent[0]),dy:(d.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};b.createFromFetchTileResult=function(a,c,d){a=new b(a[0],a[1],a[2],c);c=d.values;for(var e=d.noDataValue,f=Infinity,g=-Infinity,l=!0,k=0;k<c.length;k++){var q=c[k];
q!==e&&(f=q<f?q:f,g=q>g?q:g,l=!1)}l&&(g=f=0);a.samplerData={pixelData:d.values,width:d.width,height:d.height,minValue:f,maxValue:g,noDataValue:e,safeWidth:.99999999*(d.width-1),dx:(d.width-1)/(a.extent[2]-a.extent[0]),dy:(d.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[f,g];return a};return b}()})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(r,g,f,a){Object.defineProperty(g,
"__esModule",{value:!0});(function(a){a[a.MAP=0]="MAP";a[a.ELEVATION=1]="ELEVATION";a[a.LAYER_CLASS_COUNT=2]="LAYER_CLASS_COUNT"})(g.LayerClass||(g.LayerClass={}));(function(a){a[a.NONE=0]="NONE";a[a.SPLIT=1]="SPLIT";a[a.VSPLITMERGE=2]="VSPLITMERGE";a[a.MERGE=4]="MERGE";a[a.DECODE_ELEVATION=8]="DECODE_ELEVATION";a[a.UPDATE_GEOMETRY=16]="UPDATE_GEOMETRY";a[a.UPDATE_TEXTURE=32]="UPDATE_TEXTURE"})(g.TileUpdateTypes||(g.TileUpdateTypes={}));g.TILE_LOADING_DEBUGLOG=!1;g.MAX_ROOT_TILES=64;g.MAX_TILE_TESSELATION=
512;g.ELEVATION_NODATA_VALUE=3.40282347E38/10;g.noDataValueOpt={noDataValue:g.ELEVATION_NODATA_VALUE};g.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;g.TILEMAP_SIZE_EXP=5;g.TILEMAP_SIZE=1<<g.TILEMAP_SIZE_EXP;g.WEBMERCATOR_WORLD_EXTENT=f.create();a.WebMercatorAuxiliarySphere.getExtent(0,0,0,g.WEBMERCATOR_WORLD_EXTENT);g.GEOGRAPHIC_WORLD_EXTENT=f.create([-180,-90,180,90]);g.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";
g.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";g.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC"})},
"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/scaleUtils ../../../layers/support/TileInfo ../support/mathUtils ../support/projectionUtils".split(" "),function(r,g,f,a,c,b,l,e,d,h){var n=h.webMercator.x2lon,t=h.webMercator.y2lat;r=function(){function h(a){var b=h._checkUnsupported(a);if(b)throw b;this.spatialReference=a.spatialReference;
this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,a.origin.y];this.pixelSize=[a.size[0],a.size[1]];this.dpi=a.dpi;var c=a.lods.reduce(function(a,b,c){b.level<a.min&&(a.min=b.level,a.minIndex=c);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),d=a.lods[c.minIndex],e=Math.pow(2,d.level),b=d.resolution*e,d=d.scale*e;this.levels=Array(c.max+1);for(c=0;c<this.levels.length;c++)this.levels[c]={resolution:b,
scale:d,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,d/=2}h.prototype.clone=function(){return new h(this.toTileInfo())};h.prototype.toTileInfo=function(){return new e({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:this.pixelSize,spatialReference:this.spatialReference,lods:this.levels.map(function(a,b){return{level:b,scale:a.scale,resolution:a.resolution}})})};h.prototype.getExtent=function(a,c,e,f,h){void 0===f&&(f=b.create());var g=this.levels[a];
a=g.tileSize[0];g=g.tileSize[1];f[0]=this.origin[0]+e*a;f[2]=f[0]+a;f[3]=this.origin[1]-c*g;f[1]=f[3]-g;h&&(this._isWebMercator?(h[0]=n(f[0]),h[1]=t(f[1]),h[2]=n(f[2]),h[3]=t(f[3])):this._isWGS84&&(h[0]=d.deg2rad(f[0]),h[1]=d.deg2rad(f[1]),h[2]=d.deg2rad(f[2]),h[3]=d.deg2rad(f[3])));return f};h.prototype.getExtentGeometry=function(a,b,c,d){void 0===d&&(d=new f.Extent);this.getExtent(a,b,c,p);d.spatialReference=this.spatialReference;d.xmin=p[0];d.ymin=p[1];d.xmax=p[2];d.ymax=p[3];d.zmin=void 0;d.zmax=
void 0;return d};h.prototype.ensureMaxLod=function(a){for(;this.levels.length<=a;){var b=this.levels[this.levels.length-1],c=b.resolution/2;this.levels.push({resolution:c,scale:b.scale/2,tileSize:[c*this.pixelSize[0],c*this.pixelSize[1]]})}};h.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};h.prototype.getMaxLod=function(){return this.levels.length-1};h.prototype.scaleAtLevel=function(a){return this.levels[0].scale/Math.pow(2,a)};h.prototype.levelAtScale=function(a){var b=
this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E};h.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};h.prototype.compatibleWith=function(a){if(!(a instanceof h)){if(h._checkUnsupported(a))return!1;a=new h(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var b=Math.min(this.levels.length,a.levels.length)-1,c=this.levels[b].resolution,e=.5*c;if(!d.floatEqualAbsolute(a.origin[0],
this.origin[0],e)||!d.floatEqualAbsolute(a.origin[1],this.origin[1],e))return!1;e=.5*c/Math.pow(2,b)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return d.floatEqualAbsolute(c,a.levels[b].resolution,e)};h.prototype.rootTilesInExtent=function(a,b,c){var d=this.levels[0].tileSize;h.computeRowColExtent(a,d,this.origin,p);a=p[1];var e=p[3],f=p[0],g=p[2],k=g-f,l=e-a;k*l>c&&(c=Math.floor(Math.sqrt(c)),l>c&&(a=a+Math.floor(.5*l)-Math.floor(.5*c),e=a+c),k>c&&(f=f+Math.floor(.5*k)-Math.floor(.5*c),g=f+
c));c=Array((g-f)*(e-a));k=0;for(l=a;l<e;l++)for(var m=f;m<g;m++)c[k++]=[0,l,m];b&&(b[0]=this.origin[0]+f*d[0],b[1]=this.origin[1]-e*d[1],b[2]=this.origin[0]+g*d[0],b[3]=this.origin[1]-a*d[1]);return c};h.computeRowColExtent=function(a,b,c,d){var e=.001*(a[2]-a[0]+(a[3]-a[1]));d[0]=Math.floor((a[0]+e-c[0])/b[0]);d[2]=Math.ceil((a[2]-e-c[0])/b[0]);d[1]=Math.floor((c[1]-a[3]+e)/b[1]);d[3]=Math.ceil((c[1]-a[1]-e)/b[1])};h.isPowerOfTwo=function(a){a=a.lods;var b=a[0].resolution*Math.pow(2,a[0].level);
return!a.some(function(a){return!d.floatEqualRelative(a.resolution,b/Math.pow(2,a.level))})};h.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};h.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};h._checkUnsupported=function(b){return b?1>b.lods.length?new a("tilingscheme:generic","Tiling scheme must have at least one level"):h.isPowerOfTwo(b)?
null:new a("tilingscheme:power-of-two","Tiling scheme must be power of two"):new a("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};h.checkUnsupported=function(b){var c=h._checkUnsupported(b);return c?c:h.hasGapInLevels(b)?new a("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):h.tileSizeSupported(b)?null:new a("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};h.fromExtent=function(a,b){var c=
a[2]-a[0],d=a[3]-a[1],f=l.getMetersPerUnitForSR(b),g=1.2*Math.max(c,d);a=new h(new e({size:[256,256],origin:{x:a[0]-.5*(g-c),y:a[3]+.5*(g-d)},lods:[{level:0,resolution:g/256,scale:1/(256/96*.0254/(g*f))}],spatialReference:b}));a.ensureMaxLod(20);return a};h.makeWebMercatorAuxiliarySphere=function(a){void 0===a&&(a=19);var b=new h(h.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};h.makeWGS84WithTileSize=function(a,b){void 0===b&&(b=16);var d=256/a;a=new h(new e({size:[a,a],origin:{x:-180,
y:90},spatialReference:c.WGS84,lods:[{level:0,resolution:.703125*d,scale:2.95497598570834E8*d}]}));a.ensureMaxLod(b);return a};h.WebMercatorAuxiliarySphereTileInfo=new e({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:c.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});h.WebMercatorAuxiliarySphere=h.makeWebMercatorAuxiliarySphere(19);return h}();var p=b.create();return r})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent ./UpsampleInfo".split(" "),
function(r,g,f,a,c,b,l){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}f(d,b);d.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()};d.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=c.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};d.prototype._findAncestorWithData=function(){for(var a=
this.layerClass,b=this.layerIdx,d=this.tile,e=d.vlevel,f;d&&!(d.layerInfo[a][b].data&&(f=d,e-d.lij[0]>=c.ELEVATION_DESIRED_RESOLUTION_LEVEL));)d=d.parent;return f?(a=l.Pool.acquire(),a.init(f,0,0,1),a):null};d.prototype._desiredMinLevelDelta=function(){return c.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};d.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=l.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};
d.Pool=new a(d);return d}(b)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","./tileUtils","./UpsampleInfo"],function(r,g,f,a){function c(b,e,d,f,g,t,p){if(!b.parent||6<p)return null;f*=.5;g*=.5;t*=.5;b.lij[2]&1&&(g+=.5);0===(b.lij[1]&1)&&(t+=.5);return b.parent.hasLayerData(e,d)?(e=a.Pool.acquire(),e.init(b.parent,g,t,f),e):c(b.parent,e,d,f,g,t,p+1)}var b=Error("Abstract method called on TileAgent");return function(){function g(){}g.prototype.init=function(b,c,f,g){this.tile=
b;this.layerIdx=c;this.layerClass=f;this.suspended=g;this._tileLayerInfo=b.getLayerInfo(c,f);this._dataRequested=null;(b=this._findAncestorWithData())?(this._setUpsamplingTile(b.tile),a.Pool.release(b)):(this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile),this._tileLayerInfo.upsampleFromTile=null);return this._requestNext(!0)};g.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=
null);this._tileLayerInfo=this.tile=null};g.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};g.prototype.update=function(){var b=this._findAncestorWithData();b&&this._tileLayerInfo.upsampleFromTile&&b.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(b.tile):b&&a.Pool.release(b);return this._requestNext()};
g.prototype.dataArrived=function(a){throw b;};g.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};g.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};g.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var b=this._findNextDownload();if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,
this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};g.prototype._findNextDownload=function(){for(var a=this.layerIdx,b=this.layerClass,c=this.tile.parentSurface.layerViewByIndex(a,b),l=c.minDataLevel,t=c.maxDataLevel,p=this._desiredMinLevelDelta(),k=g.START_LOADING_LEVEL_DELTA+p,q=this._scaleRangeEnabled,m,u=this.tile,r=0,v=u.lij[0],y=this._tileLayerInfo.upsampleFromTile?this._tileLayerInfo.upsampleFromTile.tile.lij[0]:
-1,A=this.tile.parentSurface,C=A.tilemapStats,B=A.getTilemapTile(u),D=!1;u&&(!q||f.fallsWithinLayer(u,c.layer,!1))&&u.lij[0]>=l;){var E=u.layerInfo[b][a];if(E.data&&r>=p){u.lij[0]>y&&this._setUpsamplingTile(u);E.dataInvalidated&&(m=u);break}if(B&&!B.tileDataAvailable(u,a,b))D=!0;else if(u.lij[0]<=t&&!E.data&&!E.dataMissing&&(m=u,r>=k))break;(u=u.parent)&&B&&(B=B.parent||A.getTilemapTile(u));r++}m&&v-m.lij[0]<p&&this._tileLayerInfo.upsampleFromTile&&(m=null);!m&&D&&C.tilesNotPresent++;return m};g.prototype._findAncestorWithData=
function(){return c(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};g.prototype._desiredMinLevelDelta=function(){throw b;};g.prototype._setUpsamplingTile=function(a){throw b;};g.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};g.START_LOADING_LEVEL_DELTA=4;g.AGENT_DONE=new g;return g}()})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ./UpsampleInfo ../webgl-engine/lib/gl-matrix ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(r,g,f,a,c,b){function l(a,b){b(a);for(var c=0;4>c;c++){var d=a.children[c];d&&l(d,b)}}function e(a,b){for(var c=0;4>c;c++){var d=a.children[c];d&&e(d,b)}b(a)}Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a){void 0===a&&(a=100);this.q=new f(a);this._last=null;this.done=!0}a.prototype.reset=function(a){this.q.clear();a&&this.q.pushAny(a);this._last=null;this.done=0===this.q.length};a.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=
function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var b=4;0<=b;b--){var c=a[b];c&&this.q.push(c)}this._last=null}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();g.IteratorPreorder=r;r=function(){function a(a){void 0===a&&(a=100);this.q=new f(a);this.done=!0}a.prototype.reset=function(a){this.q.clear();this.q.pushAny(a);for(a=0;a<this.q.length;)for(var b=this.q.data[a++],c=0;4>c;c++){var d=
b.children[c];d&&this.q.push(d)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();g.IteratorPostorder=r;g.lij2str=function(a,b,c){return a+"/"+b+"/"+c};g.tile2str=function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]};g.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)l(a[c],b);else l(a,b)};g.traverseTilesPostorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)e(a[c],b);else e(a,
b)};g.fallsWithinLayer=function(a,b,c){if(!b)return!1;var d=b.fullExtent,e=a.extent;if(c){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};g.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};g.getTileNLevelsUp=function(a,b){for(;0<
b;)a=a.parent,b--;return a};g.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,e=0;a.lij[1]>>c&1&&(e+=2);d&1&&(e+=1);return b.children[e]};g.computeUpsampleInfoForAncestor=function(b,c){for(var d=1,e=0,f=0;b!==c;)if(d*=.5,e*=.5,f*=.5,b.lij[2]&1&&(e+=.5),0===(b.lij[1]&1)&&(f+=.5),b=b.parent,null==b)throw Error("tile was not a descendant of ancestorTile");b=a.Pool.acquire();b.init(c,e,f,d);return b};var d=[null];g.hasVisibleSiblings=function(a){Array.isArray(a)||(d[0]=a,a=d);
for(var b=0;b<a.length;b++){var c=a[b],e=c.parent;if(e)for(var f=0;4>f;f++){var h=e.children[f];if(h&&h!==c&&h.visible)return!0}}return!1};var h=Math.pow(2,-52),n=c.vec3d.create(),t=c.vec3d.create();g.intersectSkirts=function(a,d,e,f,g,l,v,r,A){var k=l.data,m=l.offsetIdx;l=l.strideIdx;var q=a[0],p=a[1];a=a[2];var u=d[0]-q,x=d[1]-p;for(d=d[2]-a;e<f;e++){var y=v?v[e]:e,G=m+l*g[3*y],P=m+l*g[3*y+1],J=m+l*g[3*y+2],M=k[G],O=k[G+1],aa=k[G+2];2<=k[G+3]&&(c.vec3d.set3(M,O,aa,n),r(n),M+=n[0],O+=n[1],aa+=n[2]);
var V=k[P],G=k[P+1],N=k[P+2];2<=k[P+3]&&(c.vec3d.set3(V,G,N,n),r(n),V+=n[0],G+=n[1],N+=n[2]);var P=k[J],S=k[J+1],W=k[J+2];2<=k[J+3]&&(c.vec3d.set3(P,S,W,n),r(n),P+=n[0],S+=n[1],W+=n[2]);var J=V-M,G=G-O,N=N-aa,P=P-M,S=S-O,W=W-aa,X=x*W-S*d,Q=d*P-W*u,I=u*S-P*x,V=J*X+G*Q+N*I,M=q-M,K=p-O,T=a-aa,aa=K*N-G*T,O=T*J-N*M,Y=M*G-J*K;if(V>h){M=M*X+K*Q+T*I;if(0>M||M>V)continue;X=u*aa+x*O+d*Y;if(0>X||M+X>V)continue}else if(V<-h){M=M*X+K*Q+T*I;if(0<M||M<V)continue;X=u*aa+x*O+d*Y;if(0<X||M+X<V)continue}else continue;
aa=(P*aa+S*O+W*Y)/V;0<=aa&&(J=b.computeNormal(J,G,N,P,S,W,t),A(aa,J,y))}}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/ObjectPool","../lib/glMatrix"],function(r,g,f,a){var c=a.vec2d;return function(){function a(a,b,d,f){this.scale=0;this.tile=null;this.offset=c.create();void 0!==a&&this.init(a,b,d,f)}a.prototype.init=function(a,b,c,f){this.tile=a;this.offset[0]=b;this.offset[1]=c;this.scale=f};a.prototype.dispose=function(){this.tile=null;this.offset[0]=
0;this.scale=this.offset[1]=0};a.Pool=new f(a);return a}()})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgent ./tileUtils".split(" "),function(r,g,f,a,c,b){return function(c){function e(){var a=c.call(this)||this;a._scaleRangeEnabled=!0;return a}f(e,c);e.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.tile.updateTexture());this._dataRequested=
null;a!==this.tile&&this._requestNext()};e.prototype._desiredMinLevelDelta=function(){return 0};e.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=b.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())};e.Pool=new a(e);return e}(c)})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/BaseElevationLayer ../../../layers/BaseTileLayer ../../../layers/ElevationLayer ../../../layers/TiledLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../layers/WMTSLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t){function p(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function k(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function q(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function m(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function u(){y={};for(var a in h)h[a].baseMapLayers.forEach(function(a){y[a.url]=19});y["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function x(a,b,c,d){return v["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(g,"__esModule",{value:!0});var v={planar:n,spherical:t};g.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};g.autoUpdateSkirtsVisibility=function(a,b,c){var d=v[a.manifold],e,f=d.isInsideExtent(a,b);f?e=d.getElevation(a,b):(e=a.getElevationBounds(),e=.5*(e[0]+e[1]));e=d.getCameraElevation(b)-e;c=.9*Math.abs(e)<c?0:0>e?-1:1;f||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?
(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};g.isTiledLayer=function(c){return c&&(c.isInstanceOf(b)||c.isInstanceOf(a)||c.isInstanceOf(f)||c.isInstanceOf(d))};g.isVectorTileLayer=function(a){return a&&a.isInstanceOf(e)};g.isTileLayerView=p;g.isVectorTileLayerView=k;g.isWMTSLayerView=q;g.isElevationLayerView=m;g.isTiledLayerView=function(a){return a&&(p(a)||m(a)||k(a)||q(a))};g.useFetchTileForLayer=function(a){return a.fetchTile&&
!(a.fetchTile===l.prototype.fetchTile||a.fetchTile===c.prototype.fetchTile)};var y=null;g.getKnownTiledServiceLevelCap=function(a){y||u();a=a&&a.replace(/https?:/,"");return a in y?y[a]:Infinity};g.prepareKnownTiledServiceLevelCaps=u;g.checkIfTileInfoSupportedForView=x;g.getTiledLayerInfo=function(a,b,c){var f,h;if(a.isInstanceOf(d)){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)f=g.tileInfo,h=g.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==x(a.tileInfo,a.fullExtent,
b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else f=a.isInstanceOf(e)?a.compatibleTileInfo256:a.tileInfo,h=a.fullExtent;return f&&h&&null==x(f,h,b,c)?{tileInfo:f,fullExtent:h}:{tileInfo:null,fullExtent:null}}})},"esri/layers/BaseElevationLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ../geometry/support/aaBoundingRect ./Layer ./support/TileInfo".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t){var p={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.tileInfo=t.create({spatialReference:d.WebMercator,size:256});a.fullExtent=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,d.WebMercator);a.spatialReference=d.WebMercator;a.type="base-elevation";return a}f(k,g);k.prototype.getTileBounds=function(a,b,c,d){d=d||h.ZERO;p.level=a;p.row=b;p.col=c;p.extent=d;this.tileInfo.updateTileInfo(p);
p.extent=null;return d};k.prototype.fetchTile=function(a,b,d,e){throw new c("BaseElevationLayer:fetchtile-not-implemented","fetchTile() is not implemented");};k.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return b.reject(new c("base-elevation-layer:view-not-supported","BaseElevationLayer is only supported in 3D"));case "3d":return b.create(function(a){return r(["../views/3d/layers/ElevationLayerView3D"],a)})}};a([l.property({type:t})],k.prototype,"tileInfo",void 0);a([l.property()],
k.prototype,"fullExtent",void 0);a([l.property()],k.prototype,"spatialReference",void 0);a([l.property({readOnly:!0,value:"base-elevation"})],k.prototype,"type",void 0);return k=a([l.subclass("esri.layers.BaseElevationLayer")],k)}(l.declared(n))})},"esri/layers/BaseTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ../geometry/support/aaBoundingRect ./Layer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/TileInfo".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m){var u={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(f){function g(){var a=null!==f&&f.apply(this,arguments)||this;a.tileInfo=m.create({spatialReference:n.WebMercator,size:256});a.type="base-tile";a.fullExtent=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,n.WebMercator);a.spatialReference=n.WebMercator;return a}a(g,f);g.prototype.getTileBounds=function(a,b,c,d){d=d||t.create();u.level=a;u.row=b;u.col=c;u.extent=
d;this.tileInfo.updateTileInfo(u);u.extent=null;return d};g.prototype.getTileUrl=function(a,b,c){throw new l("basetilelayer:gettileurl-not-implemented","getTileUrl() is not implemented");};g.prototype.fetchTile=function(a,c,d,e){a=this.getTileUrl(a,c,d);var f={responseType:"image"};e&&e.timestamp&&(f.query={_ts:e.timestamp});e&&e.allowImageDataAccess&&(f.allowImageDataAccess=e.allowImageDataAccess);return("string"===typeof a?b(a,f):a.then(function(a){return b(a,f)})).then(function(a){return a.data})};
g.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return e.create(function(a){return r(["../views/2d/layers/TiledLayerView2D"],a)});case "3d":return e.create(function(a){return r(["../views/3d/layers/TileLayerView3D"],a)})}};c([d.property({type:m})],g.prototype,"tileInfo",void 0);c([d.property({readOnly:!0,value:"base-tile"})],g.prototype,"type",void 0);c([d.property()],g.prototype,"fullExtent",void 0);c([d.property()],g.prototype,"spatialReference",void 0);return g=c([d.subclass("esri.layers.BaseTileLayer")],
g)}(d.declared(p,k,q))})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./TiledLayer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E){return function(e){function g(a,b){a=e.call(this)||this;a.capabilities=null;a.currentStyleInfo=null;a.fullExtent=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.tilemapCache=null;a.type="vector-tile";a.url=null;return a}a(g,e);g.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?f({url:a},b):a};g.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],
supportsData:!1}).then(function(){if(a.portalItem&&a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return b(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},B.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(g.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&n.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):
null},enumerable:!0,configurable:!0});g.prototype.readCapabilities=function(a,b){return{supportsExportTiles:!!(b&&b.hasOwnProperty("exportTilesAllowed")&&b.exportTilesAllowed),supportsTileMapIndexing:b.capabilities?-1!==b.capabilities.toLowerCase().indexOf("tilemap"):!1}};Object.defineProperty(g.prototype,"parsedUrl",{get:function(){return this.serviceUrl?h.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});g.prototype.writeStyleUrl=function(a,b){a&&n.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};g.prototype.readTileIndexType=
function(a,b){return b.type};g.prototype.readTileIndexUrl=function(a,b){return n.join(this.serviceUrl,b.tileMap)};g.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new A({layer:this}):null};g.prototype.readTileServers=function(a,b){var c=this;a=b.tiles;this.serviceUrl&&a.forEach(function(a,b,d){d[b]=n.join(c.serviceUrl,a)});return a};g.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};g.prototype.readCompatibleTileInfo256=
function(a,b){return y.fromJSON(D.create256x256CompatibleTileInfo(b.tileInfo))};g.prototype.readCompatibleTileInfo512=function(a,b){return y.fromJSON(D.create512x512CompatibleTileInfo(b.tileInfo))};g.prototype.loadStyle=function(a){a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};g.prototype.getTileUrl=
function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};g.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new l("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};g.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return d.create(function(a){return r(["../views/2d/layers/VectorTileLayerView2D"],
a)});case "3d":return d.create(function(a){return r(["../views/3d/layers/VectorTileLayerView3D"],a)})}};g.prototype._getSourceAndStyle=function(a){var b=this;return a?C.loadMetadata(a).then(function(c){b._set("currentStyleInfo",{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition});"string"===typeof a?(b.url=a,b.style=null):(b.url=null,b.style=a);b._set("styleRepository",new E(c.style,c));b.read(c.layerDefinition)}):
d.reject(Error("invalid style!"))};g.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d=["World_Basemap","World_Basemap_v2","World_Basemap_GCS_v2","World_Basemap_WGS84"];c<d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return n.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+
e)}};c([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],g.prototype,"attributionDataUrl",null);c([t.property({readOnly:!0})],g.prototype,"capabilities",void 0);c([t.reader("capabilities",["exportTilesAllowed","capabilities"])],g.prototype,"readCapabilities",null);c([t.property({readOnly:!0})],g.prototype,"currentStyleInfo",void 0);c([t.property({type:p,readOnly:!0})],g.prototype,"fullExtent",void 0);c([t.property()],g.prototype,"style",void 0);c([t.property({readOnly:!0,dependsOn:["serviceUrl"]})],
g.prototype,"parsedUrl",null);c([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],g.prototype,"serviceUrl",null);c([t.property({type:k,dependsOn:["tileInfo"],readOnly:!0})],g.prototype,"spatialReference",null);c([t.property({readOnly:!0})],g.prototype,"styleRepository",void 0);c([t.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],g.prototype,"styleUrl",null);c([t.writer(["portal-item",
"web-document"],"styleUrl")],g.prototype,"writeStyleUrl",null);c([t.property({readOnly:!0})],g.prototype,"tileIndexType",void 0);c([t.reader("tileIndexType",["tileIndexType","type"])],g.prototype,"readTileIndexType",null);c([t.property({readOnly:!0})],g.prototype,"tileIndexUrl",void 0);c([t.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],g.prototype,"readTileIndexUrl",null);c([t.property({readOnly:!0,type:y})],g.prototype,"tileInfo",void 0);c([t.property({readOnly:!0,type:A})],g.prototype,"tilemapCache",
void 0);c([t.reader("tilemapCache",["capabilities"])],g.prototype,"readTilemapCache",null);c([t.property({readOnly:!0})],g.prototype,"tileServers",void 0);c([t.reader("tileServers",["tiles"])],g.prototype,"readTileServers",null);c([t.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],g.prototype,"type",void 0);c([t.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],g.prototype,"url",void 0);c([t.property({readOnly:!0})],
g.prototype,"version",void 0);c([t.reader("version",["version","currentVersion"])],g.prototype,"readVersion",null);c([t.property({readOnly:!0})],g.prototype,"compatibleTileInfo256",void 0);c([t.reader("compatibleTileInfo256",["tileInfo"])],g.prototype,"readCompatibleTileInfo256",null);c([t.property({readOnly:!0})],g.prototype,"compatibleTileInfo512",void 0);c([t.reader("compatibleTileInfo512",["tileInfo"])],g.prototype,"readCompatibleTileInfo512",null);return g=c([t.subclass("esri.layers.VectorTileLayer")],
g)}(t.declared(q,u,x,v,e,m))})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports dojo/has dojo/_base/lang ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),function(r,g,f,a,c,b,l,e){function d(a){if(a){var b=e.getOrigin(a);e.canUseXhr(b)||-1!==q.indexOf(b)||q.push(b);return a}}function h(a,b){var c=a.parsedUrl;if(null!=b.sources){var d=null;c&&(d=c.path.substring(0,c.path.lastIndexOf("/")),a.styleUrl=c.path);d||(d=(d=p(b,c))&&d.url);b.jsonUrl&&
(a.styleUrl=b.jsonUrl);var c=b.sprite||null,f=b.glyphs||null;d&&(c&&!e.isAbsolute(c)&&(c=e.normalize(e.join(d,c))),f&&!e.isAbsolute(f)&&(f=e.normalize(e.join(d,f))));a.style=b;a.spriteUrl=c;a.glyphsUrl=f;return t(a,b)}if(b.hasOwnProperty("tileInfo"))return a.layerDefinition=b,a.serviceUrl=c.path,n(a,b)}function n(a,c){var f=a.parsedUrl;c=c.defaultStyles;e.isAbsolute(c)?a.styleUrl=e.normalize(c):a.styleUrl=e.normalize(e.join(f.path,c,"root.json"));d(a.styleUrl);return b(a.styleUrl,{responseType:"json"}).then(function(b){var c=
b.data.sprite||null,d=b.data.glyphs||null,f=e.removeFile(a.styleUrl);c&&!e.isAbsolute(c)&&(c=e.normalize(e.join(f,c)));d&&!e.isAbsolute(d)&&(d=e.normalize(e.join(f,d)));a.spriteUrl=c;a.glyphsUrl=d;return a.style=b.data})}function t(a,c){var f=a.parsedUrl;(c=p(c,f))||l.reject("Source isn't available in the style object!");if(c.url)return a.serviceUrl=c.url,e.isAbsolute(a.serviceUrl)||(a.serviceUrl=e.join(f.path,a.serviceUrl)),d(a.serviceUrl),b(a.serviceUrl,{query:{f:"json"},responseType:"json"}).then(function(b){a.layerDefinition=
k(b.data);return a});a.layerDefinition=k(c);return l.resolve(a)}function p(a,b){if(!a.sources)return null;var c=a.sources;a=null;if(c.esri)a=c.esri,b&&a.url&&!e.isAbsolute(a.url)&&(c=b.path.substring(0,b.path.lastIndexOf("/")),a.url=e.join(c,a.url));else{for(var d=0,f=Object.keys(c);d<f.length;d++)if(b=f[d],-1!==b.toLocaleLowerCase().indexOf("street")&&"vector"===a.type){a=c[b];break}if(!a)for(d=0,f=Object.keys(c);d<f.length&&(b=f[d],a=c[b],"vector"!==a.type);d++);}return a}function k(a){if(a.hasOwnProperty("tileInfo"))return a;
for(var b={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},c=(b.xmax-b.xmin)/512,e=[],f=a.hasOwnProperty("minzoom")?parseFloat(a.minzoom):0,h=a.hasOwnProperty("maxzoom")?parseFloat(a.maxzoom):16;f<h;f++){var g=c/Math.pow(2,f);e.push({level:f,scale:Math.floor(3779.527559055118*g),resolution:g})}a.tiles.forEach(d);return{capabilities:"TilesOnly",initialExtent:b,fullExtent:b,minScale:e[0].scale,maxScale:e[e.length-
1].scale,tiles:a.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:e,spatialReference:{wkid:102100}}}}Object.defineProperty(g,"__esModule",{value:!0});var q=c.defaults&&c.defaults.io.corsEnabledServers||c.request.corsEnabledServers;g.loadMetadata=function(c){if(!c)return l.reject("invalid input URL!");var f={layerDefinition:null,parsedUrl:null,serviceUrl:null,style:null,styleUrl:null,url:null,spriteUrl:null,glyphsUrl:null};if("string"!==typeof c)return h(f,
c).then(function(){return f});c=f.url=e.normalize(c);var g=f.parsedUrl=e.urlToObject(c);d(c);return b(g.path,{responseType:"json",query:a.mixin({f:"json"},g.query)}).then(function(a){return h(f,a.data)}).then(function(){return f})}})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.createForItem=function(c){return{origin:"portal-item",url:f.urlToObject(c.itemUrl),portal:c.portal||
a.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(r,g){return function(){function f(a,c){this.lockedSchemaPixelSize=a;this.isWGS84=c}f.prototype.getCompatibleLevelRowCol=function(a){var c=a[0],b=a[1];a=a[2];this.isWGS84?(b>>=1,a>>=1):256===this.lockedSchemaPixelSize&&0<c&&(c--,b>>=1,a>>=1);return[c,b,a]};f.prototype.getSchemaShift=function(a,c){var b=0,f=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(b=2*c),a[1]%2&&(f=2*c);return[b,
f]};f.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};f.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.rows&&256===a.cols)return a;for(var c=a.format,b=a.compressionQuality,f=a.dpi,e=a.origin,d=a.spatialReference,h=4326===d.wkid,g=[],t,p,k=a.lods.length,q=0;q<k;q++){var m=a.lods[q];t=m.scale;p=h?m.resolution:2*m.resolution;g.push({level:m.level,scale:t,resolution:p})}return{rows:256,cols:256,dpi:f,format:c,compressionQuality:b,
origin:e,spatialReference:d,lods:g}};f.create512x512CompatibleTileInfo=function(a){if(!a||256===a.rows||256===a.cols)return null;for(var c=a.format,b=a.compressionQuality,f=a.dpi,e=a.origin,d=a.spatialReference,h=[],g,t,p=a.lods.length,k=0;k<p;k++){var q=a.lods[k];g=q.scale;t=.5*q.resolution;h.push({level:q.level,scale:g,resolution:t})}return{rows:512,cols:512,dpi:f,format:c,compressionQuality:b,origin:e,spatialReference:d,lods:h}};return f}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require",
"exports","dojo/has","./StyleLayer"],function(r,g,f,a){return function(){function c(a,f){this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=f?f.spriteUrl:a.sprite;this.glyphs=f?f.glyphsUrl:a.glyphs;this.layers=(a.layers||[]).map(c._create);this._identifyRefLayers()}c.prototype._identifyRefLayers=function(){for(var a=[],c=[],e=0,d=0,f=this.layers;d<f.length;d++){var g=f[d];if(1===g.type){var t=g,p=g.sourceLayer,p=p+("|"+JSON.stringify(g.minzoom)),p=p+("|"+JSON.stringify(g.maxzoom)),p=
p+("|"+JSON.stringify(g.filter));if(t.hasDataDrivenFill||t.hasDataDrivenOutline)p+="|"+JSON.stringify(e);a.push({key:p,layer:g})}2===g.type&&(t=g,p=g.sourceLayer,p+="|"+JSON.stringify(g.minzoom),p+="|"+JSON.stringify(g.maxzoom),p+="|"+JSON.stringify(g.filter),p+="|"+JSON.stringify(g.layout&&g.layout["line-cap"]),p+="|"+JSON.stringify(g.layout&&g.layout["line-join"]),t.hasDataDrivenLine&&(p+="|"+JSON.stringify(e)),c.push({key:p,layer:g}));++e}this._assignRefLayers(a);this._assignRefLayers(c)};c.prototype._assignRefLayers=
function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,c,d=a.length,f=0;f<d;f++){var g=a[f];if(g.key===b)g.layer.refLayerId=c;else if(b=g.key,c=g.layer.id,1===g.layer.type&&!g.layer.getPaintProperty("fill-outline-color"))for(var t=f+1;t<d;t++){var p=a[t];if(p.key===b){if(p.layer.getPaintProperty("fill-outline-color")){a[f]=p;a[t]=g;c=p.layer.id;break}}else break}}};c._create=function(b,c,e){c=1-1/(e.length+1)*(1+c);switch(b.type){case "background":return new a.BackgroundStyleLayer(0,
b,c);case "fill":return new a.FillStyleLayer(1,b,c);case "line":return new a.LineStyleLayer(2,b,c);case "symbol":return new a.SymbolStyleLayer(3,b,c);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,b,c)}throw Error("Unknown vector tile layer");};return c}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),
function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(a,c,e){this.type=a;this.id=c.id;this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=e;switch(a){case 0:this._layoutDefinition=b.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=b.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=b.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=b.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=b.StyleDefinition.lineLayoutDefinition;this._paintDefinition=b.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=b.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=b.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=b.StyleDefinition.circleLayoutDefinition,this._paintDefinition=b.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=c.createFilter(this.filter)};a.prototype.getLayoutProperty=function(a){var b=this._layoutProperties;if(b)return b[a]};a.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};a.prototype.getLayoutValue=function(a,b,c){var d,e=this._layoutProperties;e&&(e=e[a])&&(d=e.getValue(b,c));a=this._layoutDefinition[a];
void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype.getPaintValue=function(a,b,c){var d,e=this._paintProperties;e&&(e=e[a])&&(d=e.getValue(b,c));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype._parseLayout=function(a){var b={},c;for(c in a){var d=this._layoutDefinition[c];d&&(b[c]=new l(c,d,a[c]))}return b};a.prototype._parsePaint=function(a){var b={},c;for(c in a){var d=this._paintDefinition[c];
d&&(b[c]=new l(c,d,a[c]))}return b};return a}();g.StyleLayer=r;a=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}f(b,a);return b}(r);g.BackgroundStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("fill-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("fill-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;c=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=
!c;b.hasDataDrivenOutlineColor=c?c.isDataDriven:!1;b.hasDataDrivenOutline=(c?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}f(b,a);return b}(r);g.FillStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("line-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("line-width");b.hasDataDrivenWidth=c?c.isDataDriven:!1;b.hasDataDrivenLine=
b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;return b}f(b,a);return b}(r);g.LineStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=c?c.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;
c=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=c?c.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}f(b,a);return b}(r);g.SymbolStyleLayer=a;r=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=
c?c.isDataDriven:!1;c=b.getPaintProperty("circle-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=
c?c.isDataDriven:!1;return b}f(b,a);return b}(r);g.CircleStyleLayer=r;r=function(){return function(a,b,c){this.cap=a.getLayoutValue("line-cap",b,c);this.join=a.getLayoutValue("line-join",b,c);this.miterLimit=a.getLayoutValue("line-miter-limit",b,c);this.roundLimit=a.getLayoutValue("line-round-limit",b,c)}}();g.LineLayout=r;r=function(){return function(a,b,c,f){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,f);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,f);this.optional=
a.getLayoutValue("icon-optional",b,f);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b,f);this.size=a.getLayoutValue("icon-size",b,f);this.rotate=a.getLayoutValue("icon-rotate",b,f);this.padding=a.getLayoutValue("icon-padding",b,f);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,f);this.offset=a.getLayoutValue("icon-offset",b,f);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();g.IconLayout=r;r=function(){return function(a,b,c,f){this.allowOverlap=a.getLayoutValue("text-allow-overlap",
b,f);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b,f);this.optional=a.getLayoutValue("text-optional",b,f);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,f);this.fontArray=a.getLayoutValue("text-font",b,f);this.maxWidth=a.getLayoutValue("text-max-width",b,f);this.lineHeight=a.getLayoutValue("text-line-height",b,f);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,f);this.justify=a.getLayoutValue("text-justify",b,f);this.anchor=a.getLayoutValue("text-anchor",
b,f);this.maxAngle=a.getLayoutValue("text-max-angle",b,f);this.size=a.getLayoutValue("text-size",b,f);this.rotate=a.getLayoutValue("text-rotate",b,f);this.padding=a.getLayoutValue("text-padding",b,f);this.keepUpright=a.getLayoutValue("text-keep-upright",b,f);this.transform=a.getLayoutValue("text-transform",b,f);this.offset=a.getLayoutValue("text-offset",b,f);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();g.TextLayout=r})},"esri/views/vectorTiles/style/Filter":function(){define(["require",
"exports"],function(r,g){return function(){function f(a,c,b){this._op=a;"$type"===c?(this._val=b instanceof Array?b.map(function(a){return f._types.indexOf(a)}):f._types.indexOf(b),this._op+=11):(this._key=c,this._val=b)}f.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=
this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var c=0,b=this._val;c<b.length;c++){var f=b[c];if(f.filter(a))return!0}return!1;case 10:c=0;for(b=this._val;c<b.length;c++)if(f=b[c],!f.filter(a))return!1;return!0;case 11:c=0;for(b=this._val;c<b.length;c++)if(f=b[c],f.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<
this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type)}};f.createFilter=function(a){if(!a)return new f(0,void 0,!0);var c=a[0];if(1>=a.length)return new f(0,void 0,"any"!==c);switch(c){case "\x3d\x3d":return new f(1,a[1],a[2]);case "!\x3d":return new f(2,a[1],a[2]);case "\x3e":return new f(4,a[1],a[2]);case "\x3c":return new f(3,a[1],a[2]);case "\x3e\x3d":return new f(6,
a[1],a[2]);case "\x3c\x3d":return new f(5,a[1],a[2]);case "in":return new f(7,a[1],a.slice(2));case "!in":return new f(8,a[1],a.slice(2));case "any":return new f(9,void 0,a.slice(1).map(f.createFilter.bind(this)));case "all":return new f(10,void 0,a.slice(1).map(f.createFilter.bind(this)));case "none":return new f(11,void 0,a.slice(1).map(f.createFilter.bind(this)));default:throw Error("invalid operator: "+c);}};f._types=["Unknown","Point","LineString","Polygon"];return f}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require",
"exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(){}f.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel",
"round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};f.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",
default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},
"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},
"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};f.circleLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};f.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",
value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};f.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",
minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};f.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",
value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map",
"viewport"],default:"map"}};f.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};f.circlePaintDefinition=
{"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",
minimum:0,maximum:1,default:1}};return f}();g.StyleDefinition=r})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(r,g,f,a){return function(){function c(a,f,e){this.isDataDriven=!1;switch(f.type){case "number":a=!0;break;case "color":a=!0;e=c._parseColor(e);break;case "array":a="number"===f.value;break;default:a=!1}null==e&&(e=f.default);a&&"interval"===e.type&&(a=!1);var b=e&&e.stops&&0<e.stops.length;if(b)for(var g=
0,l=e.stops;g<l.length;g++){var t=l[g];t[1]=this._validate(t[1],f)}if(this.isDataDriven=e&&!!e.property)if(void 0!==e.default&&(e.default=this._validate(e.default,f)),b)switch(e.type){case "identity":this.getValue=this._buildIdentity(e,f);break;case "categorical":this.getValue=this._buildCategorical(e,f);break;default:this.getValue=a?this._buildInterpolate(e,f):this._buildInterval(e,f)}else this.getValue=this._buildIdentity(e,f);else b?this.getValue=a?this._buildZoomInterpolate(e):this._buildZoomInterval(e):
(e=this._validate(e,f),this.getValue=this._buildSimple(e))}c.prototype._validate=function(a,c){if("number"===c.type){if(a<c.minimum)return c.minimum;if(a>c.maximum)return c.maximum}return a};c.prototype._buildSimple=function(a){return function(){return a}};c.prototype._buildIdentity=function(a,f){var b=this;return function(d,e){var g;e&&(g=e.values[a.property],"color"===f.type&&(g=c._parseColor(g)));void 0===g&&(g=a.default);return void 0!==g?b._validate(g,f):f.default}};c.prototype._buildCategorical=
function(a,c){var b=this;return function(d,e){var f;e&&(f=e.values[a.property]);f=b._categorical(f,a.stops);return void 0!==f?f:void 0!==a.default?a.default:c.default}};c.prototype._buildInterval=function(a,c){var b=this;return function(d,e){var f;e&&(f=e.values[a.property]);return"number"===typeof f?b._interval(f,a.stops):void 0!==a.default?a.default:c.default}};c.prototype._buildInterpolate=function(a,c){var b=this;return function(d,e){var f;e&&(f=e.values[a.property]);return"number"===typeof f?
b._interpolate(f,a.stops,a.base||1):void 0!==a.default?a.default:c.default}};c.prototype._buildZoomInterpolate=function(a){var b=this;return function(c){return b._interpolate(c,a.stops,a.base||1)}};c.prototype._buildZoomInterval=function(a){var b=this;return function(c){return b._interval(c,a.stops)}};c.prototype._categorical=function(a,c){for(var b=c.length,d=0;d<b;d++)if(c[d][0]===a)return c[d][1]};c.prototype._interval=function(a,c){for(var b=c.length,d=0,f=0;f<b;f++)if(c[f][0]<=a)d=f;else break;
return c[d][1]};c.prototype._interpolate=function(b,c,e){for(var d,f,g=c.length,l=0;l<g;l++){var p=c[l];if(p[0]<=b)d=p;else{f=p;break}}if(d&&f){l=f[0]-d[0];b-=d[0];e=1===e?b/l:(Math.pow(e,b)-1)/(Math.pow(e,l)-1);if(Array.isArray(d[1])){d=d[1];f=f[1];b=[];for(l=0;l<d.length;l++)b.push(a.interpolate(d[l],f[l],e));return b}return a.interpolate(d[1],f[1],e)}if(d)return d[1];if(f)return f[1]};c._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};c._parseColor=function(a){if(Array.isArray(a))return a;
if("string"===typeof a){if(a=new f(a),!this._isEmpty(a))return f.toUnitRGBA(a)}else return a&&a.default&&(a.default=c._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],c._parseColor(a[1])]})),a};return c}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(r,g){function f(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(g,"__esModule",{value:!0});g.C_INFINITY=Number.POSITIVE_INFINITY;g.C_PI=Math.PI;g.C_2PI=2*g.C_PI;g.C_PI_BY_2=
g.C_PI/2;g.C_RAD_TO_256=128/g.C_PI;g.C_256_TO_RAD=g.C_PI/128;g.C_DEG_TO_256=256/360;g.C_DEG_TO_RAD=g.C_PI/180;g.C_SQRT2=1.414213562;g.C_SQRT2_INV=1/g.C_SQRT2;var a=1/Math.LN2;g.positiveMod=f;g.radToByte=function(a){return f(a*g.C_RAD_TO_256,256)};g.degToByte=function(a){return f(a*g.C_DEG_TO_256,256)};g.log2=function(c){return Math.log(c)*a};g.sqr=function(a){return a*a};g.clamp=function(a,b,f){return Math.min(Math.max(a,b),f)};g.interpolate=function(a,b,f){return a*(1-f)+b*f};g.between=function(a,
b,f){return a>=b&&a<=f||a>=f&&a<=b}})},"esri/layers/WMTSLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Collection ../core/Error ../core/Handles ../core/lang ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ./Layer ./WebTileLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/WMTSSublayer ./support/wmtsUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A){function C(a,b){return a.map(function(a){var c=new y;c.read(a,b);return c})}var B={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};return function(g){function k(a,b){var c=g.call(this)||this;c._sublayersHandles=new d;c.copyright=null;c.customParameters=null;c.customLayerParameters=
null;c.fullExtent=null;c.operationalLayerType="WebTiledLayer";c.resourceInfo=null;c.serviceMode="RESTful";c.sublayers=null;c.type="wmts";c.version="1.0.0";c.watch("activeLayer",function(a,b){b&&(b.layer=null);a&&(a.layer=c)},!0);c.watch("sublayers",function(a,b){b&&(b.forEach(function(a){a.layer=null}),c._sublayersHandles.removeAll(),c._sublayersHandles=null);a&&(a.forEach(function(a){a.layer=c}),c._sublayersHandles||(c._sublayersHandles=new d),c._sublayersHandles.add([a.on("after-add",function(a){a.item.layer=
c}),a.on("after-remove",function(a){a.item.layer=null})]))},!0);return c}a(k,g);k.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?f({url:a},b):a};k.prototype.load=function(){var a=this;if("KVP"!==this.serviceMode&&"RESTful"!==this.serviceMode)console.error("WMTS mode could only be 'KVP' or 'RESTful'");else return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){return a._fetchService()}).catch(function(){return n.reject(new e("wmtslayer:unsupported-service-data",
"Invalid response from the WMTS service."))})),this.when()};Object.defineProperty(k.prototype,"activeLayer",{get:function(){return this._get("activeLayer")},set:function(a){this._set("activeLayer",a)},enumerable:!0,configurable:!0});k.prototype.readActiveLayerFromService=function(a,b,c){var d=this,e;this.activeLayer?b.layers.some(function(a){return a.id===d.activeLayer.id?(e=a,!0):!1}):(this.activeLayer=new y,e=b.layers[0]);this.activeLayer.read(e,c);return this.activeLayer};k.prototype.readActiveLayerFromItemOrWebDoc=
function(a,b,c){return new y({id:b.wmtsInfo.layerIdentifier,tileMatrixSetId:b.wmtsInfo.tileMatrixSet})};k.prototype.writeActiveLayer=function(a,b){a=this.activeLayer;b.templateUrl=this.getUrlTemplate(a.id,a.tileMatrixSetId,a.imageFormat,a.styleId);b.wmtsInfo=f({},b.wmtsInfo,{layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId})};Object.defineProperty(k.prototype,"fullExtents",{get:function(){var a=[];this.activeLayer.tileMatrixSets.forEach(function(b){b.fullExtent&&a.push(b.fullExtent)});return a},
enumerable:!0,configurable:!0});k.prototype.readServiceMode=function(a,b,c){return-1<b.templateUrl.indexOf("?")?"KVP":"RESTful"};k.prototype.readSublayersFromService=function(a,b,c){return C(b.layers,c)};Object.defineProperty(k.prototype,"supportedSpatialReferences",{get:function(){return this.activeLayer.tileMatrixSets.map(function(a){return a.tileInfo.spatialReference}).toArray()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"title",{get:function(){return"Layer"===this._get("title")?
this.activeLayer&&this.activeLayer.title:this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"url",{get:function(){return this._get("url")},set:function(a){a&&"/"===a.substr(-1)?this._set("url",a.slice(0,-1)):this._set("url",a)},enumerable:!0,configurable:!0});k.prototype.createWebTileLayer=function(a){var b=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId),
c=this._getTileMatrixSetById(a.tileMatrixSetId).tileInfo,d=a.fullExtent;a={layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId,url:this.url};this.customLayerParameters&&(a.customLayerParameters=this.customLayerParameters);this.customParameters&&(a.customParameters=this.customParameters);return new q({fullExtent:d,urlTemplate:b,tileInfo:c,wmtsInfo:a})};k.prototype.fetchTile=function(a,c,d){a=this.getTileUrl(a,c,d);return b(a,{responseType:"image"}).then(function(a){return a.data})};k.prototype.findSublayerById=
function(a){return this.sublayers.find(function(b){return b.id===a})};k.prototype.getTileUrl=function(a,b,c){var d=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId).tileInfo.lods[a],d=d.levelValue?d.levelValue:String(d.level);(a=this.resourceInfo?"":A.getTileUrlFromResourceUrls(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.styleId,a,b,c))||(a=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId).replace(/\{level\}/gi,
d).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c));return a=this._appendCustomLayerParameters(a)};k.prototype.getUrlTemplate=function(a,b,c,d){var e="";if(!this.resourceInfo&&(e=A.getTileUrlTemplateFromResourceUrls(a,b,c,d)))return e;"KVP"===this.serviceMode?e=this.url+"?SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+a+"\x26STYLE\x3d"+d+"\x26FORMAT\x3d"+c+"\x26TILEMATRIXSET\x3d"+b+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":"RESTful"===this.serviceMode&&
(e="",B[c.toLowerCase()]&&(e=B[c.toLowerCase()]),e=this.url+a+"/"+d+"/"+b+"/{level}/{row}/{col}"+e);return e};k.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return n.create(function(a){return r(["../views/2d/layers/WMTSLayerView2D"],a)});case "3d":return n.create(function(a){return r(["../views/3d/layers/WMTSLayerView3D"],a)})}};k.prototype._fetchService=function(){var a=this;return n.resolve().then(function(){if(a.resourceInfo)return"KVP"===a.resourceInfo.serviceMode&&(a.url+=
-1<a.url.indexOf("?")?"":"?"),{ssl:!1,data:a.resourceInfo};var c=a._getCapabilitiesUrl(a.serviceMode);return b(c,{responseType:"text",callbackParamName:"callback"}).catch(function(d){c=a._getCapabilitiesUrl("KVP"===a.serviceMode?"RESTful":"KVP");return b(c,{responseType:"text",callbackParamName:"callback"})})}).then(function(b){b.data=a.resourceInfo?A.parseResourceInfo(b.data):A.parseCapabilities(b.data,{serviceMode:a.serviceMode,url:a.url});b.data&&a.read(b.data,{origin:"service"})})};k.prototype._getTileMatrixSetById=
function(a){return this.findSublayerById(this.activeLayer.id).tileMatrixSets.find(function(b){return b.id===a})};k.prototype._appendCustomParameters=function(a){if(this.customParameters)for(var b in this.customParameters)a+=(-1===a.indexOf("?")?"?":"\x26")+b+"\x3d"+encodeURIComponent(this.customParameters[b]);return a};k.prototype._appendCustomLayerParameters=function(a){if(this.customLayerParameters||this.customParameters){var b=f({},h.clone(this.customParameters||{}),this.customLayerParameters),
c;for(c in b)a+=(-1===a.indexOf("?")?"?":"\x26")+c+"\x3d"+encodeURIComponent(b[c])}return a};k.prototype._getCapabilitiesUrl=function(a){var b;this.url=this.url.split("?")[0];"KVP"===a?b=this.url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===a&&(b=this.url+"/"+this.version+"/WMTSCapabilities.xml");return b=this._appendCustomParameters(b)};c([t.property({type:y,dependsOn:["sublayers"],json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],k.prototype,
"activeLayer",null);c([t.reader("service","activeLayer",["layers"])],k.prototype,"readActiveLayerFromService",null);c([t.reader(["web-document","portal-item"],"activeLayer",["wmtsInfo"])],k.prototype,"readActiveLayerFromItemOrWebDoc",null);c([t.writer(["web-document","portal-item"],"activeLayer")],k.prototype,"writeActiveLayer",null);c([t.property()],k.prototype,"copyright",void 0);c([t.property({json:{origins:{"web-document":{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}},
"portal-item":{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}}}}})],k.prototype,"customParameters",void 0);c([t.property({json:{origins:{"web-document":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},"portal-item":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],k.prototype,"customLayerParameters",void 0);c([t.property({type:p,json:{write:{ignoreOrigin:!0},origins:{"web-document":{read:{source:"fullExtent"}},
"portal-item":{read:{source:"fullExtent"}}}}})],k.prototype,"fullExtent",void 0);c([t.property({readOnly:!0,dependsOn:["activeLayer"]})],k.prototype,"fullExtents",null);c([t.property()],k.prototype,"operationalLayerType",void 0);c([t.property()],k.prototype,"resourceInfo",void 0);c([t.property()],k.prototype,"serviceMode",void 0);c([t.reader(["portal-item","web-document"],"serviceMode",["templateUrl"])],k.prototype,"readServiceMode",null);c([t.property({type:l.ofType(y)})],k.prototype,"sublayers",
void 0);c([t.reader("service","sublayers",["layers"])],k.prototype,"readSublayersFromService",null);c([t.property({readOnly:!0,dependsOn:["activeLayer"]})],k.prototype,"supportedSpatialReferences",null);c([t.property({dependsOn:["activeLayer"],json:{read:{source:"title"}}})],k.prototype,"title",null);c([t.property({json:{read:!1},readOnly:!0,value:"wmts"})],k.prototype,"type",void 0);c([t.property({json:{origins:{service:{read:{source:"tileUrl"}},"web-document":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},
"portal-item":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],k.prototype,"url",null);c([t.property()],k.prototype,"version",void 0);return k=c([t.subclass("esri.layers.WMTSLayer")],k)}(t.declared(k,m,u,x,v))})},"esri/layers/WebTileLayer":function(){define("dojo/_base/url dojo/string ../core/Error ../core/lang ../core/MultiOriginJSONSupport ../core/urlUtils ../geometry/SpatialReference ../geometry/Extent ../geometry/Point ./TiledLayer ./mixins/OperationalLayer ./mixins/ScaleRangeLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./support/TileInfo ./support/LOD ./support/commonProperties".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){return h.createSubclass([n,c,t,p,k],{declaredClass:"esri.layers.WebTileLayer",normalizeCtorArgs:function(b,c){return"string"===typeof b?a.mixin({urlTemplate:b},c||{}):b},getDefaults:function(b){var c=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,l.WebMercator);return a.mixin(this.inherited(arguments),{fullExtent:c,tileInfo:new q({size:256,dpi:96,format:"PNG8",compressionQuality:0,origin:new d({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:l.WebMercator}),spatialReference:l.WebMercator,lods:[new m({level:0,scale:5.91657527591555E8,resolution:156543.033928}),new m({level:1,scale:2.95828763795777E8,resolution:78271.5169639999}),new m({level:2,scale:1.47914381897889E8,resolution:39135.7584820001}),new m({level:3,scale:7.3957190948944E7,resolution:19567.8792409999}),new m({level:4,scale:3.6978595474472E7,resolution:9783.93962049996}),new m({level:5,scale:1.8489297737236E7,resolution:4891.96981024998}),new m({level:6,scale:9244648.868618,
resolution:2445.98490512499}),new m({level:7,scale:4622324.434309,resolution:1222.99245256249}),new m({level:8,scale:2311162.217155,resolution:611.49622628138}),new m({level:9,scale:1155581.108577,resolution:305.748113140558}),new m({level:10,scale:577790.554289,resolution:152.874056570411}),new m({level:11,scale:288895.277144,resolution:76.4370282850732}),new m({level:12,scale:144447.638572,resolution:38.2185141425366}),new m({level:13,scale:72223.819286,resolution:19.1092570712683}),new m({level:14,
scale:36111.909643,resolution:9.55462853563415}),new m({level:15,scale:18055.954822,resolution:4.77731426794937}),new m({level:16,scale:9027.977411,resolution:2.38865713397468}),new m({level:17,scale:4513.988705,resolution:1.19432856685505}),new m({level:18,scale:2256.994353,resolution:.597164283559817}),new m({level:19,scale:1128.497176,resolution:.298582141647617})]})})},properties:{copyright:{type:String,value:"",json:{write:!0}},fullExtent:{json:{write:!0}},legendEnabled:{json:{read:{source:["showLegend"],
reader:function(a,b){return null!=b.showLegend?b.showLegend:!0}},write:{target:"showLegend"}}},levelValues:{dependsOn:["tileInfo"],get:function(){var a=[];if(!this.tileInfo)return null;this.tileInfo.lods.forEach(function(b){a[b.level]=b.levelValue||b.level},this);return a}},operationalLayerType:"WebTiledLayer",popupEnabled:u.popupEnabled,refreshInterval:{json:{write:!0}},spatialReference:{type:l,value:l.WebMercator,json:{read:{source:["spatialReference","fullExtent.spatialReference"],reader:function(a,
b){return a||b.fullExtent&&b.fullExtent.spatialReference&&l.fromJSON(b.fullExtent.spatialReference)}}}},subDomains:{type:[String],value:null,json:{write:!0}},tileInfo:{type:q,json:{write:!0}},tileServers:{value:null,dependsOn:["urlTemplate","subDomains"],get:function(){if(!this.urlTemplate)return null;var a=new r(this.urlTemplate),b=a.scheme?a.scheme+"://":"//",c=b+a.authority+"/",d=this.subDomains,e,f=[];-1===a.authority.indexOf("{subDomain}")&&f.push(c);d&&0<d.length&&1<a.authority.split(".").length&&
d.forEach(function(c){-1<a.authority.indexOf("{subDomain}")&&(e=b+a.authority.replace(/\{subDomain\}/gi,c)+"/");f.push(e)},this);return f=f.map(function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a})}},type:{value:"web-tile",json:{read:!1}},urlPath:{dependsOn:["urlTemplate"],get:function(){if(!this.urlTemplate)return null;var a=this.urlTemplate,b=new r(a);return a.substring(((b.scheme?b.scheme+"://":"//")+b.authority+"/").length)}},urlTemplate:{type:String,json:{origins:{"portal-item":{read:{source:"url"}}},
read:{source:["urlTemplate","templateUrl"],reader:function(a,b){return a||b.templateUrl}},write:{target:"templateUrl",writer:function(a,c,d){a&&b.isProtocolRelative(a)&&(a="https:"+a);c[d]=a?b.normalize(a):a}}}},url:{json:{write:!1}},wmtsInfo:{json:{write:!0}}},getTileUrl:function(a,b,c){a=this.levelValues[a];var d=this.tileServers[b%this.tileServers.length]+g.substitute(this.urlPath,{level:a,col:c,row:b});return d=d.replace(/\{level\}/gi,a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c)},load:function(){var a=
this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){if(!this.urlTemplate)throw new f("layer:load","WebTileLayer (title: '"+this.title+"', id: '"+this.id+"') is missing the required 'urlTemplate' property value");}.bind(this));this.addResolvingPromise(a);return this}})})},"esri/layers/support/WMTSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ./TileMatrixSet ./WMTSStyle".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){return function(c){function g(a){a=c.call(this)||this;a.fullExtent=null;a.imageFormats=null;a.id=null;a.layer=null;a.styles=null;a.tileMatrixSetId=null;a.tileMatrixSets=null;return a}f(g,c);k=g;Object.defineProperty(g.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});g.prototype.readFullExtent=function(a,b,c){return(a=b.fullExtent)?d.fromJSON(a):null};Object.defineProperty(g.prototype,
"imageFormat",{get:function(){var a=this._get("imageFormat");a||(a=this.imageFormats&&this.imageFormats.length?this.imageFormats[0]:"");return a},set:function(a){if(-1<a.indexOf("image/")||-1===this.imageFormats.indexOf(a))if(-1===a.indexOf("image/")&&(a="image/"+a),this.imageFormats&&-1===this.imageFormats.indexOf(a)){console.error("The layer doesn't support the format of "+a);return}this._set("imageFormat",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"styleId",{get:function(){var a=
this._get("styleId");a||(a=this.styles&&this.styles.length?this.styles.getItemAt(0).id:"");return a},set:function(a){this._set("styleId",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"tileMatrixSet",{get:function(){var a=this;return this.tileMatrixSets.find(function(b){return b.id===a.tileMatrixSetId})},enumerable:!0,configurable:!0});
g.prototype.clone=function(){var a=new k;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("imageFormats")&&(a.imageFormats=this.imageFormats&&this.imageFormats.slice());this.hasOwnProperty("imageFormat")&&(a.imageFormat=this.imageFormat);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("styleId")&&(a.styleId=
this.styleId);this.hasOwnProperty("styles")&&(a.styles=this.styles&&this.styles.clone());this.hasOwnProperty("tileMatrixSetId")&&(a.tileMatrixSetId=this.tileMatrixSetId);this.hasOwnProperty("tileMatrixSets")&&(a.tileMatrixSets=this.tileMatrixSets.clone());this.hasOwnProperty("title")&&(a.title=this.title);return a};a([e.property()],g.prototype,"description",null);a([e.property()],g.prototype,"fullExtent",void 0);a([e.reader("fullExtent",["fullExtent"])],g.prototype,"readFullExtent",null);a([e.property({dependsOn:["imageFormats"]})],
g.prototype,"imageFormat",null);a([e.property({json:{read:{source:"formats"}}})],g.prototype,"imageFormats",void 0);a([e.property()],g.prototype,"id",void 0);a([e.property()],g.prototype,"layer",void 0);a([e.property()],g.prototype,"styleId",null);a([e.property({type:b.ofType(n),json:{read:{source:"styles"}}})],g.prototype,"styles",void 0);a([e.property({value:null,json:{write:{ignoreOrigin:!0}}})],g.prototype,"title",null);a([e.property()],g.prototype,"tileMatrixSetId",void 0);a([e.property({readOnly:!0,
dependsOn:["tileMatrixSetId"]})],g.prototype,"tileMatrixSet",null);a([e.property({type:b.ofType(h),json:{read:{source:"tileMatrixSets"}}})],g.prototype,"tileMatrixSets",void 0);return g=k=a([e.subclass("esri.layers.support.WMTSSublayer")],g);var k}(e.declared(l))})},"esri/layers/support/TileMatrixSet":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b,l){return function(b){function c(a){a=b.call(this)||this;a.fullExtent=null;a.id=null;a.tileInfo=null;return a}f(c,b);e=c;c.prototype.clone=function(){var a=new e;this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("tileInfo")&&(a.tileInfo=this.tileInfo&&this.tileInfo.clone());return a};a([l.property({json:{read:{source:"fullExtent"}}})],c.prototype,"fullExtent",void 0);a([l.property({json:{read:{source:"id"}}})],
c.prototype,"id",void 0);a([l.property({json:{read:{source:"tileInfo"}}})],c.prototype,"tileInfo",void 0);return c=e=a([l.subclass("esri.layer.support.TileMatrixSet")],c);var e}(l.declared(b))})},"esri/layers/support/WMTSStyle":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b,l){return function(b){function c(a){a=
b.call(this)||this;a.id=null;a.title=null;a.description=null;a.legendUrl=null;return a}f(c,b);e=c;c.prototype.clone=function(){var a=new e;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("isDefault")&&(a.isDefault=this.isDefault);this.hasOwnProperty("keywords")&&(a.keywords=this.keywords&&this.keywords.slice());this.hasOwnProperty("legendUrl")&&(a.legendUrl=this.legendUrl);this.hasOwnProperty("title")&&(a.title=this.title);
return a};a([l.property({json:{read:{source:"id"}}})],c.prototype,"id",void 0);a([l.property({json:{read:{source:"title"}}})],c.prototype,"title",void 0);a([l.property({json:{read:{source:"abstract"}}})],c.prototype,"description",void 0);a([l.property({json:{read:{source:"legendUrl"}}})],c.prototype,"legendUrl",void 0);a([l.property({json:{read:{source:"isDefault"}}})],c.prototype,"isDefault",void 0);a([l.property({json:{read:{source:"keywords"}}})],c.prototype,"keywords",void 0);return c=e=a([l.subclass("esri.layer.support.WMTSStyle")],
c);var e}(l.declared(b))})},"esri/layers/support/wmtsUtils":function(){define("require exports ../../core/Error ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/WKIDUnitConversion ./TileInfo".split(" "),function(r,g,f,a,c,b,l,e){function d(a,b){return(a=b.getElementsByTagName(a))&&0<a.length?a[0]:null}function h(a,b){return Array.prototype.slice.call(b.getElementsByTagName(a)).map(function(a){return a.textContent})}function n(a,b){a.split("\x3e").forEach(function(a){b=
d(a,b)});return b&&b.textContent}function t(a,b,c,e){var f;Array.prototype.slice.call(e.childNodes).some(function(e){if(-1<e.nodeName.indexOf(a)){var g=d(b,e),g=g&&g.textContent;return g===c||c.split(":")&&c.split(":")[1]===g?(f=e,!0):!1}});return f}function p(a){var b=[],c=B[a],d=Array.prototype.slice.call(c.getElementsByTagName("ResourceURL")),c=c.getElementsByTagName("Dimension"),e,f,g,k;c.length&&(e=n("Identifier",c[0]),f=h("Default",c[0])||h("Value",c[0]));1<c.length&&(g=n("Identifier",c[1]),
k=h("Default",c[1])||h("Value",c[1]));C[a]={dimensions:f,dimensions2:k};d.forEach(function(a){var c=a.getAttribute("template");if(e&&f.length)if(-1<c.indexOf("{"+e+"}"))c=c.replace("{"+e+"}","{dimensionValue}");else{var d=c.toLowerCase().indexOf("{"+e.toLowerCase()+"}");-1<d&&(c=c.substring(0,d)+"{dimensionValue}"+c.substring(d+e.length+2))}g&&k.length&&(-1<c.indexOf("{"+g+"}")?c=c.replace("{"+g+"}","{dimensionValue2}"):(d=c.toLowerCase().indexOf("{"+g.toLowerCase()+"}"),-1<d&&(c=c.substring(0,d)+
"{dimensionValue2}"+c.substring(d+g.length+2))));b.push({template:c,format:a.getAttribute("fomrat"),resourceType:a.getAttribute("resourceType")})});return b}function k(a,b){return Array.prototype.slice.call(a.getElementsByTagName("Style")).map(function(a){var c=d("LegendURL",a),e=d("Keywords",a),e=e&&h("Keyword",e),c=c&&c.getAttribute("xlink:href");b&&(c=c&&c.replace(/^http:/i,"https:"));return{abstract:n("Abstract",a),id:n("Identifier",a),isDefault:"true"===a.getAttribute("isDefault"),keywords:e,
legendUrl:c,title:n("Title",a)}})}function q(a,b){return h("TileMatrixSet",a).map(function(c){return m(c,a,b)})}function m(a,b,c){b=t("TileMatrixSetLink","TileMatrixSet",a,b);b=h("TileMatrix",b);var f=t("TileMatrixSet","Identifier",a,c);c=u(f);var g=c.spatialReference,k=g.wkid,l=d("TileMatrix",f),l=[parseInt(n("TileWidth",l),10),parseInt(n("TileHeight",l),10)],m=[];b.length?b.forEach(function(b,c){b=t("TileMatrix","Identifier",b,f);m.push(v(b,k,c,a))}):Array.prototype.slice.call(f.getElementsByTagName("TileMatrix")).forEach(function(b,
c){m.push(v(b,k,c,a))});b=x(f,c,l,m[0]);return{id:a,fullExtent:b,tileInfo:new e({dpi:96,spatialReference:g,size:l,origin:c,lods:m})}}function u(a){var e=n("SupportedCRS",a);e&&(e=e.toLowerCase());var f=parseInt(e.split(":").pop(),10);if(900913===f||3857===f)f=102100;var g=!1;if(-1<e.indexOf("crs84")||-1<e.indexOf("crs:84"))f=4326,g=!0;else if(-1<e.indexOf("crs83")||-1<e.indexOf("crs:83"))f=4269,g=!0;else if(-1<e.indexOf("crs27")||-1<e.indexOf("crs:27"))f=4267,g=!0;var h=new b({wkid:f});a=d("TileMatrix",
a);var k=n("TopLeftCorner",a).split(" ");a=k[0].split("E").map(function(a){return Number(a)});var k=k[1].split("E").map(function(a){return Number(a)}),l=a[0],m=k[0],q;1<a.length&&(l=a[0]*Math.pow(10,a[1]));1<k.length&&(m=k[0]*Math.pow(10,k[1]));var p=g&&4326===f&&90===l&&-180===m;A.some(function(a,b){var d=Number(e.split(":").pop());if(d>=a[0]&&d<=a[1]||4326===f&&(!g||p))return q=new c(m,l,h),!0;b===A.length-1&&(q=new c(l,m,h));return!1});return q}function x(b,c,e,f){var g=d("BoundingBox",b),h,k;
g&&(h=n("LowerCorner",g).split(" "),k=n("UpperCorner",g).split(" "));h&&1<h.length&&k&&1<k.length?(b=parseFloat(h[0]),e=parseFloat(h[1]),h=parseFloat(k[0]),k=parseFloat(k[1])):(b=d("TileMatrix",b),h=parseFloat(n("MatrixWidth",b)),g=parseFloat(n("MatrixHeight",b)),b=c.x,k=c.y,h=b+h*e[0]*f.resolution,e=k-g*e[1]*f.resolution);return new a(b,e,h,k,c.spatialReference)}function v(a,b,c,d){var e=n("Identifier",a);a=n("ScaleDenominator",a).split("E").map(function(a){return Number(a)});a=1<a.length?a[0]*Math.pow(10,
a[1]):a[0];b=y(b,a,d);return{level:c,levelValue:e,scale:1.058267716535433*a,resolution:b}}function y(a,b,c){a=l.hasOwnProperty(String(a))?l.values[l[a]]:"default028mm"===c?6370997*Math.PI/180:6378137*Math.PI/180;return 7*b/25E3/a}Object.defineProperty(g,"__esModule",{value:!0});var A=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],
[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],
[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],
[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],C=new Map,B=new Map;g.parseCapabilities=function(a,b){a=a.replace(/ows:/gi,"");a=(new DOMParser).parseFromString(a,"text/xml").documentElement;var c=d("Contents",a);if(!c)throw new f("wmtslayer:wmts-capabilities-xml-is-not-valid");
var e=d("OperationsMetadata",a),e=(e=(e=e&&e.querySelector("[name\x3d'GetTile']"))&&e.getElementsByTagName("Get"))&&Array.prototype.slice.call(e),g=b.url&&-1<b.url.indexOf("https"),l=b.serviceMode,m,p,u;e&&e.length&&e.some(function(a){var b=d("Constraint",a);if(!b||t("AllowedValues","Value",l,b))return p=a.attributes[0].nodeValue,!0;if(!b||t("AllowedValues","Value","RESTful",b)||t("AllowedValues","Value","REST",b))u=a.attributes[0].nodeValue;else if(!b||t("AllowedValues","Value","KVP",b))m=a.attributes[0].nodeValue;
return!1});p||(u?(p=u,l="RESTful"):m?(p=m,l="KVP"):p=d("ServiceMetadataURL",a).getAttribute("xlink:href"));b=p.indexOf("1.0.0/");-1===b&&"RESTful"===l?p+="/":-1<b&&(p=p.substring(0,b));"KVP"===l&&(p+=-1<b?"":"?");g&&(p=p.replace(/^http:/i,"https:"));b=n("ServiceIdentification\x3eAccessConstraints",a);a=Array.prototype.slice.call(c.getElementsByTagName("Layer")).map(function(a){var b=n("Identifier",a);B[b]=a;var e=n("Abstract",a),f=h("Format",a),l,m=d("WGS84BoundingBox",a);l=m?n("LowerCorner",m).split(" "):
["-180","-90"];m=m?n("UpperCorner",m).split(" "):["180","90"];l={xmin:parseFloat(l[0]),ymin:parseFloat(l[1]),xmax:parseFloat(m[0]),ymax:parseFloat(m[1]),spatialReference:{wkid:4326}};var m=k(a,g),p=n("Title",a);a=q(a,c);return{id:b,fullExtent:l,description:e,formats:f,styles:m,title:p,tileMatrixSets:a}});return{copyright:b,layers:a,tileUrl:p,serviceMode:l}};g.parseResourceInfo=function(a){a.layers.forEach(function(a){a.tileMatrixSets.forEach(function(a){var b=a.tileInfo;96!==b.dpi&&(b.lods.forEach(function(c){c.scale=
96*c.scale/b.dpi;c.resolution=y(b.spatialReference.wkid,90.71428571428571*c.scale/96,a.id)}),b.dpi=96)})});return a};g.getTileUrlFromResourceUrls=function(a,b,c,d,e,f){var g=p(a),h=C[a].dimensions&&C[a].dimensions[0];a=C[a].dimensions2&&C[a].dimensions2[0];var k="";g&&0<g.length&&(k=g[e%g.length].template.replace(/\{Style\}/gi,c).replace(/\{TileMatrixSet\}/gi,b).replace(/\{TileMatrix\}/gi,d).replace(/\{TileRow\}/gi,e).replace(/\{TileCol\}/gi,f).replace(/\{dimensionValue\}/gi,h).replace(/\{dimensionValue2\}/gi,
a));return k};g.getTileUrlTemplateFromResourceUrls=function(a,b,c,d){c=p(a);var e="";if(c&&0<c.length){var f=C[a].dimensions&&C[a].dimensions[0];a=C[a].dimensions2&&C[a].dimensions2[0];e=c[0].template;e.indexOf(".xxx")===e.length-4&&(e=e.slice(0,e.length-4));e=e.replace(/\{Style\}/gi,d);e=e.replace(/\{TileMatrixSet\}/gi,b);e=e.replace(/\{TileMatrix\}/gi,"{level}");e=e.replace(/\{TileRow\}/gi,"{row}");e=e.replace(/\{TileCol\}/gi,"{col}");e=e.replace(/\{dimensionValue\}/gi,f);e=e.replace(/\{dimensionValue2\}/gi,
a)}return e}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../geometry/support/aaBoundingRect ../lib/glMatrix ./TerrainConst ./TilingScheme".split(" "),function(r,g,f,a,c,b,l){function e(a,b,e,f){c.vec3d.set(e,d);d[f]=b[f];f=c.vec3d.subtract(d,b);var g=c.vec3d.subtract(a,b,h),g=c.vec3d.dot(g,f),k=c.vec3d.dot(f,f);b=0>=g?b:k<=g?e:c.vec3d.add(b,c.vec3d.scale(f,g/k),d);a=c.vec3d.subtract(a,b,d);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*
a[0]+a[1]*a[1]))}Object.defineProperty(g,"__esModule",{value:!0});var d=c.vec3d.create(),h=c.vec3d.create(),n=c.vec3d.create(),t=c.vec3d.create();g.isInsideExtent=function(b,c,d){void 0===d&&(d=0);b=b.extent;return 0===d?a.containsPoint(b,c):a.containsPointWithMargin(b,c,d*Math.min(b[2]-b[0],b[3]-b[1]))};g.getElevation=function(a,b){return a.getElevation(b)};g.getCameraElevation=function(a){return a[2]};g.tiltOnEdge=e;g.tiltToExtentEdge=function(a,b){var c=a.getElevationBounds();a=a.extent;c=.5*(c[0]+
c[1]);n[0]=a[0];n[1]=a[1];n[2]=c;t[0]=a[2];t[1]=a[3];t[2]=c;a=c=Infinity;b[0]<n[0]?c=e(b,n,t,0):b[0]>t[0]&&(c=e(b,t,n,0));b[1]<n[1]?a=e(b,n,t,1):b[1]>t[1]&&(a=e(b,t,n,1));return Math.min(c,a)};g.checkIfTileInfoSupportedForViewSR=function(c,d,e){if(c.spatialReference.isGeographic)return new f("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var g=l.checkUnsupported(c);if(g)return g;var h=c.lods,g=h[0].resolution*Math.pow(2,h[0].level),k=[g*c.size[0],
g*c.size[1]],q=[c.origin.x,c.origin.y];d=a.fromExtent(d);var n=a.create();l.computeRowColExtent(d,k,q,n);k=(n[2]-n[0])*(n[3]-n[1]);k>b.MAX_ROOT_TILES?(h=h[0].scale*Math.pow(2,h[0].level),g=Math.max((d[3]-d[1])/c.size[1],(d[2]-d[0])/c.size[0])*h/g,d=Math.floor(Math.log(g)/Math.log(10)),g=Math.ceil(g/Math.pow(10,d))*Math.pow(10,d),g=new f("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(h).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+
g.toLocaleString()+".",{level0Scale:h,suggestedLevel0Scale:g,requiredNumRootTiles:k,allowedNumRootTiles:b.MAX_ROOT_TILES})):g=null;return g?g:e&&!c.spatialReference.equals(e)?new f("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define("require exports ../../../core/Error ../lib/glMatrix ../support/earthUtils ../support/projectionUtils ./TilingScheme".split(" "),
function(r,g,f,a,c,b,l){Object.defineProperty(g,"__esModule",{value:!0});var e=a.vec3d.create();g.isInsideExtent=function(a,b,c){void 0===c&&(c=0);return!0};g.getElevation=function(a,c){b.bufferToBuffer(c,b.SphericalECEFSpatialReference,0,e,a.spatialReference,0,1);return a.getElevation(e)};g.tiltToExtentEdge=function(a,b){return 0};g.getCameraElevation=function(b){return a.vec3d.length(b)-c.earthRadius};g.checkIfTileInfoSupportedForViewSR=function(a,b,c){b=a.lods.length-1;if(a.spatialReference.isWebMercator){if(!l.makeWebMercatorAuxiliarySphere(b).compatibleWith(a))return new f("tilingscheme:incompatible-global-web-mercator",
"The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(a.spatialReference.isWGS84){if(!l.makeWGS84WithTileSize(a.size[1],b).compatibleWith(a))return new f("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new f("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(c&&!a.spatialReference.equals(c))return new f("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TerrainConst ./TileAgent ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),function(r,g,f,a,c,b,l){return function(){function e(a){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=
void 0;this.init(a)}e.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;a===f.LayerClass.ELEVATION&&(this.elevationBounds=null)};e.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&(c.Pool.release(this.upsampleFromTile),this.upsampleFromTile=
null)};e.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==a.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(c.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=0;this.disposeData()};e.prototype.disposeData=function(){var a=
this.data;a&&(a instanceof l?a.dispose():a instanceof b&&a.dispose(),this.data=null)};e.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new e(a)};return e}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec2 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){return function(e){function g(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];d=e.call(this)||this;d._renderBuckets=[];d._vectorTileData=null;d._symbolUpdateData=null;d.status=5;d.coords=[0,0];d.bounds=[0,0,0,0];d.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};d.stencilData={mask:0,reference:0};d.status=0;d.tileTransform.transform=c.create();d.tileTransform.displayCoord=b.create();0<a.length&&(f=d.acquire).call.apply(f,[d].concat(a));
return d;var f}f(g,e);g.prototype.reset=function(){d.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=
null;this.status=0};g.prototype.acquire=function(a,b,c,d,e){this.key=a;this.refKey=b;b=c.lodAt(a.level).resolution;var f=c.size[0]*b,g=c.origin,h=a.col*f,k=a.row*f,m=c.spatialReference,q=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=l.getInfo(m),q=m.valid[1]-m.valid[0]);h=g.x+h+a.world*q;g=g.y-k;this.coords[0]=h;this.coords[1]=g;this.bounds[0]=h;this.bounds[1]=g;this.bounds[2]=h+f;this.bounds[3]=g-f;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=e;this.styleLayers=
d;this.id=a.id;this.status=1};g.prototype.setData=function(a,b){this._vectorTileData=a;this.client=b;this.status=3};g.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};g.prototype.dispose=function(){this.fillVertexArrayObject&&(this.fillVertexArrayObject.dispose(),this.fillVertexArrayObject=null);this.fillDDVertexArrayObject&&(this.fillDDVertexArrayObject.dispose(),this.fillDDVertexArrayObject=null);this.outlineVertexArrayObject&&(this.outlineVertexArrayObject.dispose(),
this.outlineVertexArrayObject=null);this.outlineDDVertexArrayObject&&(this.outlineDDVertexArrayObject.dispose(),this.outlineDDVertexArrayObject=null);this.lineVertexArrayObject&&(this.lineVertexArrayObject.dispose(),this.lineVertexArrayObject=null);this.lineDDVertexArrayObject&&(this.lineDDVertexArrayObject.dispose(),this.lineDDVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),
this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this.circleVertexArrayObject&&(this.circleVertexArrayObject.dispose(),this.circleVertexArrayObject=null);this.fillVertexBuffer&&(this.fillVertexBuffer.dispose(),this.fillVertexBuffer=null);this.fillDDVertexBuffer&&(this.fillDDVertexBuffer.dispose(),this.fillDDVertexBuffer=
null);this.fillIndexBuffer&&(this.fillIndexBuffer.dispose(),this.fillIndexBuffer=null);this.outlineVertexBuffer&&(this.outlineVertexBuffer.dispose(),this.outlineVertexBuffer=null);this.outlineDDVertexBuffer&&(this.outlineDDVertexBuffer.dispose(),this.outlineDDVertexBuffer=null);this.outlineIndexBuffer&&(this.outlineIndexBuffer.dispose(),this.outlineIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineDDVertexBuffer&&(this.lineDDVertexBuffer.dispose(),
this.lineDDVertexBuffer=null);this.lineIndexBuffer&&(this.lineIndexBuffer.dispose(),this.lineIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),
this.textDDVertexBuffer=null);this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.circleVertexBuffer&&(this.circleVertexBuffer.dispose(),this.circleVertexBuffer=null);this.circleIndexBuffer&&(this.circleIndexBuffer.dispose(),this.circleIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=7};g.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,
b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};g.prototype.getGpuMemoryUsage=function(){var a=0;this.fillVertexBuffer&&(a+=this.fillVertexBuffer.size);this.fillDDVertexBuffer&&(a+=this.fillDDVertexBuffer.size);this.fillIndexBuffer&&(a+=this.fillIndexBuffer.size);this.outlineVertexBuffer&&(a+=this.outlineVertexBuffer.size);this.outlineDDVertexBuffer&&(a+=this.outlineDDVertexBuffer.size);this.outlineIndexBuffer&&(a+=this.outlineIndexBuffer.size);
this.lineVertexBuffer&&(a+=this.lineVertexBuffer.size);this.lineDDVertexBuffer&&(a+=this.lineDDVertexBuffer.size);this.lineIndexBuffer&&(a+=this.lineIndexBuffer.size);this.iconVertexBuffer&&(a+=this.iconVertexBuffer.size);this.iconDDVertexBuffer&&(a+=this.iconDDVertexBuffer.size);this.iconIndexBuffer&&(a+=this.iconIndexBuffer.size);this.textVertexBuffer&&(a+=this.textVertexBuffer.size);this.textDDVertexBuffer&&(a+=this.textDDVertexBuffer.size);this.textIndexBuffer&&(a+=this.textIndexBuffer.size);
this.circleVertexBuffer&&(a+=this.circleVertexBuffer.size);this.circleIndexBuffer&&(a+=this.circleIndexBuffer.size);this.texture&&(a+=this.texture.descriptor.width*this.texture.descriptor.height*4);return a};g.prototype.attach=function(a){if(4===this.status)return!0;this.status=3;if(!this._vectorTileData||!this._vectorTileData.bufferDataInfo)return this.status=4,!0;if(0===this._renderBuckets.length)for(var b=new Uint32Array(this._vectorTileData.bucketDataInfo),c=b.length,d=0;d<c;){var e=b[d],f=b[d+
1];if(0===f)f=new h.BackgroundRenderBucket,f.layerID=e,this._renderBuckets.push(f),d+=2;else if(1===f)f=new h.FillRenderBucket,f.layerID=e,f.triangleElementStart=b[d+2],f.triangleElementCount=b[d+3],f.outlineElementStart=b[d+4],f.outlineElementCount=b[d+5],this._renderBuckets.push(f),d+=6;else if(2===f)f=new h.LineRenderBucket,f.layerID=e,f.triangleElementStart=b[d+2],f.triangleElementCount=b[d+3],this._renderBuckets.push(f),d+=4;else if(3===f){f=new h.SymbolRenderBucket;f.layerID=e;f.isSDF=0!==b[d+
2];var g=d+3,e=b[g];g++;if(0<e)for(var k=void 0,l=void 0,p=void 0,t=0;t<e;t++)k=b[g],l=b[g+1],p=b[g+2],f.markerPerPageElementsMap.set(k,[l,p]),g+=3;var r=b[g];g++;if(0<r)for(p=l=k=void 0,t=0;t<r;t++)k=b[g],l=b[g+1],p=b[g+2],f.glyphPerPageElementsMap.set(k,[l,p]),g+=3;this._renderBuckets.push(f);d+=5+3*e+3*r}else 4===f?(f=new h.CircleRenderBucket,f.layerID=e,f.triangleElementStart=b[d+2],f.triangleElementCount=b[d+3],this._renderBuckets.push(f),d+=4):console.error("Bad bucket type!")}a=a.context;b=
new Uint32Array(this._vectorTileData.bufferDataInfo);c=b.length;for(f=d=0;f<c;f+=2,d++)if(!(0>=b[f+1]||0===this._vectorTileData.bufferData[d].byteLength))switch(b[f]){case 1:this.fillVertexBuffer?this.fillVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.fillVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 2:this.fillDDVertexBuffer?this.fillDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.fillDDVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);
break;case 3:this.fillIndexBuffer?this.fillIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.fillIndexBuffer=n.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 4:this.outlineVertexBuffer?this.outlineVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.outlineVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 5:this.outlineDDVertexBuffer?this.outlineDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.outlineDDVertexBuffer=
n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 6:this.outlineIndexBuffer?this.outlineIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.outlineIndexBuffer=n.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 7:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.lineVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 8:this.lineDDVertexBuffer?this.lineDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.lineDDVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 9:this.lineIndexBuffer?this.lineIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.lineIndexBuffer=n.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 10:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.iconVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 11:this.iconDDVertexBuffer?this.iconDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.iconDDVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 12:this.iconIndexBuffer?this.iconIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.iconIndexBuffer=n.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 13:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.textVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 14:this.textDDVertexBuffer?this.textDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.textDDVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 15:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.textIndexBuffer=n.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 16:this.circleVertexBuffer?this.circleVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.circleVertexBuffer=n.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 17:this.circleIndexBuffer?this.circleIndexBuffer.setData(this._vectorTileData.bufferData[d]):
this.circleIndexBuffer=n.createIndex(a,35044,this._vectorTileData.bufferData[d])}this._vectorTileData=null;this.status=4;return!0};g.prototype.detach=function(a){this.client&&6!==this.status&&7!==this.status&&this.client.invoke("destructTileData",this.id);this.dispose();e.prototype.detach.call(this,a)};g.prototype.doRender=function(a){if(this.visible&&4===this.status){var b=a.context,c=a.renderer;if(b&&c){var d=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,
this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,f=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==f){var g,h=this._renderBuckets.length,k=0;if(0===d)for(k=h-1;0<=k;k--)g=this._renderBuckets[k],3!==g.type&&4!==g.type&&g.hasData()&&c.renderBucket(b,g,a.displayLevel,a.requiredLevel,d,this,e.layers[g.layerID],f);else for(k=0;k<h;k++)g=this._renderBuckets[k],g.hasData()&&c.renderBucket(b,g,a.displayLevel,a.requiredLevel,d,this,e.layers[g.layerID],f)}}}};g.prototype._updateSymbolData=
function(a){if(!this._symbolUpdateData.bucketDataInfo)return!0;var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),c=b.length;if(0===c)return this._symbolUpdateData=null,!0;if(4!==this.status)return this.requestRender(),!1;a=a.context;for(var d=new Uint32Array(this._symbolUpdateData.bufferDataInfo),e=d.length,f=0,g=0;g<e;g+=2,f++)switch(d[g]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[f]);
break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[f]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=n.createIndex(a,35044,this._symbolUpdateData.bufferData[f]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=n.createVertex(a,
35044,this._symbolUpdateData.bufferData[f]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[f]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=n.createIndex(a,35044,this._symbolUpdateData.bufferData[f])}a=this._renderBuckets.length;for(d=0;d<a;d++)this._renderBuckets[d]instanceof h.SymbolRenderBucket&&
(e=this._renderBuckets[d],e.markerPerPageElementsMap.clear(),e.glyphPerPageElementsMap.clear());for(a=0;a<c;){e=b[a];f=-1;g=this._renderBuckets.length;for(d=0;d<g;d++)if(this._renderBuckets[d].layerID===e){f=d;break}d=this._renderBuckets[f];d||(d=new h.SymbolRenderBucket,d.layerID=e,d.isSDF=0!==b[a+2],this._renderBuckets.push(d));var k=a+3,e=b[k];k++;if(0<e)for(var l=g=f=void 0,p=0;p<e;p++)f=b[k],g=b[k+1],l=b[k+2],d.markerPerPageElementsMap.set(f,[g,l]),k+=3;var t=b[k];k++;if(0<t)for(l=g=f=void 0,
p=0;p<t;p++)f=b[k],g=b[k+1],l=b[k+2],d.glyphPerPageElementsMap.set(f,[g,l]),k+=3;a+=5+3*e+3*t}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);
this._symbolUpdateData=null;return!0};g.pool=new a(g);return g}(e)})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(r){var g={scalar:{},SIMD:{},create:function(){var f=new r.ARRAY_TYPE(16);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},clone:function(f){var a=new r.ARRAY_TYPE(16);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];a[4]=f[4];a[5]=f[5];a[6]=f[6];a[7]=f[7];a[8]=f[8];a[9]=f[9];a[10]=f[10];a[11]=
f[11];a[12]=f[12];a[13]=f[13];a[14]=f[14];a[15]=f[15];return a},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];f[9]=a[9];f[10]=a[10];f[11]=a[11];f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f},fromValues:function(f,a,c,b,g,e,d,h,n,t,p,k,q,m,u,x){var l=new r.ARRAY_TYPE(16);l[0]=f;l[1]=a;l[2]=c;l[3]=b;l[4]=g;l[5]=e;l[6]=d;l[7]=h;l[8]=n;l[9]=t;l[10]=p;l[11]=k;l[12]=q;l[13]=m;l[14]=u;l[15]=x;return l},set:function(f,a,c,b,g,e,d,h,
n,t,p,k,q,m,u,r,v){f[0]=a;f[1]=c;f[2]=b;f[3]=g;f[4]=e;f[5]=d;f[6]=h;f[7]=n;f[8]=t;f[9]=p;f[10]=k;f[11]=q;f[12]=m;f[13]=u;f[14]=r;f[15]=v;return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f}};g.scalar.transpose=function(f,a){if(f===a){var c=a[1],b=a[2],g=a[3],e=a[6],d=a[7],h=a[11];f[1]=a[4];f[2]=a[8];f[3]=a[12];f[4]=c;f[6]=a[9];f[7]=a[13];f[8]=b;f[9]=e;f[11]=a[14];f[12]=g;f[13]=d;f[14]=h}else f[0]=
a[0],f[1]=a[4],f[2]=a[8],f[3]=a[12],f[4]=a[1],f[5]=a[5],f[6]=a[9],f[7]=a[13],f[8]=a[2],f[9]=a[6],f[10]=a[10],f[11]=a[14],f[12]=a[3],f[13]=a[7],f[14]=a[11],f[15]=a[15];return f};g.SIMD.transpose=function(f,a){var c,b,g,e,d,h;c=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,4);g=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);e=SIMD.Float32x4.shuffle(c,b,0,1,4,5);d=SIMD.Float32x4.shuffle(g,a,0,1,4,5);h=SIMD.Float32x4.shuffle(e,d,0,2,4,6);e=SIMD.Float32x4.shuffle(e,d,1,3,5,7);SIMD.Float32x4.store(f,
0,h);SIMD.Float32x4.store(f,4,e);e=SIMD.Float32x4.shuffle(c,b,2,3,6,7);d=SIMD.Float32x4.shuffle(g,a,2,3,6,7);c=SIMD.Float32x4.shuffle(e,d,0,2,4,6);b=SIMD.Float32x4.shuffle(e,d,1,3,5,7);SIMD.Float32x4.store(f,8,c);SIMD.Float32x4.store(f,12,b);return f};g.transpose=r.USE_SIMD?g.SIMD.transpose:g.scalar.transpose;g.scalar.invert=function(f,a){var c=a[0],b=a[1],g=a[2],e=a[3],d=a[4],h=a[5],n=a[6],t=a[7],p=a[8],k=a[9],q=a[10],m=a[11],u=a[12],r=a[13],v=a[14];a=a[15];var y=c*h-b*d,A=c*n-g*d,C=c*t-e*d,B=b*
n-g*h,D=b*t-e*h,E=g*t-e*n,H=p*r-k*u,F=p*v-q*u,L=p*a-m*u,G=k*v-q*r,P=k*a-m*r,J=q*a-m*v,M=y*J-A*P+C*G+B*L-D*F+E*H;if(!M)return null;M=1/M;f[0]=(h*J-n*P+t*G)*M;f[1]=(g*P-b*J-e*G)*M;f[2]=(r*E-v*D+a*B)*M;f[3]=(q*D-k*E-m*B)*M;f[4]=(n*L-d*J-t*F)*M;f[5]=(c*J-g*L+e*F)*M;f[6]=(v*C-u*E-a*A)*M;f[7]=(p*E-q*C+m*A)*M;f[8]=(d*P-h*L+t*H)*M;f[9]=(b*L-c*P-e*H)*M;f[10]=(u*D-r*C+a*y)*M;f[11]=(k*C-p*D-m*y)*M;f[12]=(h*F-d*G-n*H)*M;f[13]=(c*G-b*F+g*H)*M;f[14]=(r*A-u*B-v*y)*M;f[15]=(p*B-k*A+q*y)*M;return f};g.SIMD.invert=
function(f,a){var c,b,g,e,d,h,n,t;d=SIMD.Float32x4.load(a,0);h=SIMD.Float32x4.load(a,4);n=SIMD.Float32x4.load(a,8);t=SIMD.Float32x4.load(a,12);a=SIMD.Float32x4.shuffle(d,h,0,1,4,5);b=SIMD.Float32x4.shuffle(n,t,0,1,4,5);c=SIMD.Float32x4.shuffle(a,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,a,1,3,5,7);a=SIMD.Float32x4.shuffle(d,h,2,3,6,7);e=SIMD.Float32x4.shuffle(n,t,2,3,6,7);g=SIMD.Float32x4.shuffle(a,e,0,2,4,6);e=SIMD.Float32x4.shuffle(e,a,1,3,5,7);a=SIMD.Float32x4.mul(g,e);a=SIMD.Float32x4.swizzle(a,1,
0,3,2);d=SIMD.Float32x4.mul(b,a);h=SIMD.Float32x4.mul(c,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),d);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,a),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);a=SIMD.Float32x4.mul(b,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,a),d);t=SIMD.Float32x4.mul(c,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(e,a));t=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,a),t);t=SIMD.Float32x4.swizzle(t,
2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),e);a=SIMD.Float32x4.swizzle(a,1,0,3,2);g=SIMD.Float32x4.swizzle(g,2,3,0,1);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),d);n=SIMD.Float32x4.mul(c,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(g,a));n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,a),n);n=SIMD.Float32x4.swizzle(n,2,3,0,1);a=SIMD.Float32x4.mul(c,b);a=SIMD.Float32x4.swizzle(a,1,0,3,2);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,a),n);t=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,
a),t);a=SIMD.Float32x4.swizzle(a,2,3,0,1);n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,a),n);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(g,a));a=SIMD.Float32x4.mul(c,e);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(g,a));n=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),n);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),h);n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.mul(c,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,
a),h);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(e,a));t=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),t);c=SIMD.Float32x4.mul(c,d);c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c);c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c);a=SIMD.Float32x4.reciprocalApproximation(c);c=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(a,a)));c=SIMD.Float32x4.swizzle(c,0,0,0,0);if(!c)return null;
SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(c,d));SIMD.Float32x4.store(f,4,SIMD.Float32x4.mul(c,h));SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(c,n));SIMD.Float32x4.store(f,12,SIMD.Float32x4.mul(c,t));return f};g.invert=r.USE_SIMD?g.SIMD.invert:g.scalar.invert;g.scalar.adjoint=function(f,a){var c=a[0],b=a[1],g=a[2],e=a[3],d=a[4],h=a[5],n=a[6],t=a[7],p=a[8],k=a[9],q=a[10],m=a[11],u=a[12],r=a[13],v=a[14];a=a[15];f[0]=h*(q*a-m*v)-k*(n*a-t*v)+r*(n*m-t*q);f[1]=-(b*(q*a-m*v)-k*(g*a-e*v)+r*(g*m-e*q));f[2]=
b*(n*a-t*v)-h*(g*a-e*v)+r*(g*t-e*n);f[3]=-(b*(n*m-t*q)-h*(g*m-e*q)+k*(g*t-e*n));f[4]=-(d*(q*a-m*v)-p*(n*a-t*v)+u*(n*m-t*q));f[5]=c*(q*a-m*v)-p*(g*a-e*v)+u*(g*m-e*q);f[6]=-(c*(n*a-t*v)-d*(g*a-e*v)+u*(g*t-e*n));f[7]=c*(n*m-t*q)-d*(g*m-e*q)+p*(g*t-e*n);f[8]=d*(k*a-m*r)-p*(h*a-t*r)+u*(h*m-t*k);f[9]=-(c*(k*a-m*r)-p*(b*a-e*r)+u*(b*m-e*k));f[10]=c*(h*a-t*r)-d*(b*a-e*r)+u*(b*t-e*h);f[11]=-(c*(h*m-t*k)-d*(b*m-e*k)+p*(b*t-e*h));f[12]=-(d*(k*v-q*r)-p*(h*v-n*r)+u*(h*q-n*k));f[13]=c*(k*v-q*r)-p*(b*v-g*r)+u*(b*
q-g*k);f[14]=-(c*(h*v-n*r)-d*(b*v-g*r)+u*(b*n-g*h));f[15]=c*(h*q-n*k)-d*(b*q-g*k)+p*(b*n-g*h);return f};g.SIMD.adjoint=function(f,a){var c,b,g,e,d,h,n,t;c=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,4);g=SIMD.Float32x4.load(a,8);e=SIMD.Float32x4.load(a,12);h=SIMD.Float32x4.shuffle(c,b,0,1,4,5);d=SIMD.Float32x4.shuffle(g,e,0,1,4,5);a=SIMD.Float32x4.shuffle(h,d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,h,1,3,5,7);h=SIMD.Float32x4.shuffle(c,b,2,3,6,7);b=SIMD.Float32x4.shuffle(g,e,2,3,6,7);c=SIMD.Float32x4.shuffle(h,
b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,h,1,3,5,7);h=SIMD.Float32x4.mul(c,b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);g=SIMD.Float32x4.mul(d,h);e=SIMD.Float32x4.mul(a,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,h),g);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);h=SIMD.Float32x4.mul(d,c);h=SIMD.Float32x4.swizzle(h,1,0,3,2);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),g);t=SIMD.Float32x4.mul(a,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);
g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(b,h));t=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),t);t=SIMD.Float32x4.swizzle(t,2,3,0,1);h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);c=SIMD.Float32x4.swizzle(c,2,3,0,1);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),g);n=SIMD.Float32x4.mul(a,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(c,h));n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),n);n=SIMD.Float32x4.swizzle(n,2,3,0,
1);h=SIMD.Float32x4.mul(a,d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),n);t=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),t);h=SIMD.Float32x4.swizzle(h,2,3,0,1);n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,h),n);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(c,h));h=SIMD.Float32x4.mul(a,b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(c,h));n=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),n);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,
h),e);n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(d,h));h=SIMD.Float32x4.mul(a,c);h=SIMD.Float32x4.swizzle(h,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),e);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(d,h));h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(b,h));t=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),t);SIMD.Float32x4.store(f,0,g);SIMD.Float32x4.store(f,4,e);SIMD.Float32x4.store(f,8,n);SIMD.Float32x4.store(f,12,t);return f};g.adjoint=r.USE_SIMD?g.SIMD.adjoint:
g.scalar.adjoint;g.determinant=function(f){var a=f[0],c=f[1],b=f[2],g=f[3],e=f[4],d=f[5],h=f[6],n=f[7],t=f[8],p=f[9],k=f[10],q=f[11],m=f[12],u=f[13],r=f[14];f=f[15];return(a*d-c*e)*(k*f-q*r)-(a*h-b*e)*(p*f-q*u)+(a*n-g*e)*(p*r-k*u)+(c*h-b*d)*(t*f-q*m)-(c*n-g*d)*(t*r-k*m)+(b*n-g*h)*(t*u-p*m)};g.SIMD.multiply=function(f,a,c){var b=SIMD.Float32x4.load(a,0),g=SIMD.Float32x4.load(a,4),e=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);var d=SIMD.Float32x4.load(c,0),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));SIMD.Float32x4.store(f,0,d);d=SIMD.Float32x4.load(c,4);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),e),
SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));SIMD.Float32x4.store(f,4,d);d=SIMD.Float32x4.load(c,8);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));SIMD.Float32x4.store(f,8,d);c=SIMD.Float32x4.load(c,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),a))));SIMD.Float32x4.store(f,12,b);return f};g.scalar.multiply=function(f,a,c){var b=a[0],g=a[1],e=a[2],d=a[3],h=a[4],n=a[5],t=a[6],p=a[7],k=a[8],q=a[9],m=a[10],u=a[11],r=a[12],v=a[13],y=a[14];a=a[15];var A=c[0],C=c[1],B=c[2],D=c[3];f[0]=A*b+C*h+B*k+D*r;f[1]=A*g+C*n+B*q+D*v;f[2]=A*e+C*
t+B*m+D*y;f[3]=A*d+C*p+B*u+D*a;A=c[4];C=c[5];B=c[6];D=c[7];f[4]=A*b+C*h+B*k+D*r;f[5]=A*g+C*n+B*q+D*v;f[6]=A*e+C*t+B*m+D*y;f[7]=A*d+C*p+B*u+D*a;A=c[8];C=c[9];B=c[10];D=c[11];f[8]=A*b+C*h+B*k+D*r;f[9]=A*g+C*n+B*q+D*v;f[10]=A*e+C*t+B*m+D*y;f[11]=A*d+C*p+B*u+D*a;A=c[12];C=c[13];B=c[14];D=c[15];f[12]=A*b+C*h+B*k+D*r;f[13]=A*g+C*n+B*q+D*v;f[14]=A*e+C*t+B*m+D*y;f[15]=A*d+C*p+B*u+D*a;return f};g.multiply=r.USE_SIMD?g.SIMD.multiply:g.scalar.multiply;g.mul=g.multiply;g.scalar.translate=function(f,a,c){var b=
c[0],g=c[1];c=c[2];var e,d,h,n,t,p,k,q,m,u,r,v;a===f?(f[12]=a[0]*b+a[4]*g+a[8]*c+a[12],f[13]=a[1]*b+a[5]*g+a[9]*c+a[13],f[14]=a[2]*b+a[6]*g+a[10]*c+a[14],f[15]=a[3]*b+a[7]*g+a[11]*c+a[15]):(e=a[0],d=a[1],h=a[2],n=a[3],t=a[4],p=a[5],k=a[6],q=a[7],m=a[8],u=a[9],r=a[10],v=a[11],f[0]=e,f[1]=d,f[2]=h,f[3]=n,f[4]=t,f[5]=p,f[6]=k,f[7]=q,f[8]=m,f[9]=u,f[10]=r,f[11]=v,f[12]=e*b+t*g+m*c+a[12],f[13]=d*b+p*g+u*c+a[13],f[14]=h*b+k*g+r*c+a[14],f[15]=n*b+q*g+v*c+a[15]);return f};g.SIMD.translate=function(f,a,c){var b=
SIMD.Float32x4.load(a,0),g=SIMD.Float32x4.load(a,4),e=SIMD.Float32x4.load(a,8),d=SIMD.Float32x4.load(a,12);c=SIMD.Float32x4(c[0],c[1],c[2],0);a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11]);b=SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(c,0,0,0,0));g=SIMD.Float32x4.mul(g,SIMD.Float32x4.swizzle(c,1,1,1,1));e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(c,2,2,2,2));a=SIMD.Float32x4.add(b,SIMD.Float32x4.add(g,SIMD.Float32x4.add(e,
d)));SIMD.Float32x4.store(f,12,a);return f};g.translate=r.USE_SIMD?g.SIMD.translate:g.scalar.translate;g.scalar.scale=function(f,a,c){var b=c[0],g=c[1];c=c[2];f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;f[4]=a[4]*g;f[5]=a[5]*g;f[6]=a[6]*g;f[7]=a[7]*g;f[8]=a[8]*c;f[9]=a[9]*c;f[10]=a[10]*c;f[11]=a[11]*c;f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};g.SIMD.scale=function(f,a,c){var b;c=SIMD.Float32x4(c[0],c[1],c[2],0);b=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(b,
SIMD.Float32x4.swizzle(c,0,0,0,0)));b=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(f,4,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(c,1,1,1,1)));b=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(c,2,2,2,2)));f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};g.scale=r.USE_SIMD?g.SIMD.scale:g.scalar.scale;g.rotate=function(f,a,c,b){var g=b[0],e=b[1];b=b[2];var d=Math.sqrt(g*g+e*e+b*b),h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G;if(Math.abs(d)<r.EPSILON)return null;
d=1/d;g*=d;e*=d;b*=d;h=Math.sin(c);n=Math.cos(c);t=1-n;c=a[0];d=a[1];p=a[2];k=a[3];q=a[4];m=a[5];u=a[6];x=a[7];v=a[8];y=a[9];A=a[10];C=a[11];B=g*g*t+n;D=e*g*t+b*h;E=b*g*t-e*h;H=g*e*t-b*h;F=e*e*t+n;L=b*e*t+g*h;G=g*b*t+e*h;g=e*b*t-g*h;e=b*b*t+n;f[0]=c*B+q*D+v*E;f[1]=d*B+m*D+y*E;f[2]=p*B+u*D+A*E;f[3]=k*B+x*D+C*E;f[4]=c*H+q*F+v*L;f[5]=d*H+m*F+y*L;f[6]=p*H+u*F+A*L;f[7]=k*H+x*F+C*L;f[8]=c*G+q*g+v*e;f[9]=d*G+m*g+y*e;f[10]=p*G+u*g+A*e;f[11]=k*G+x*g+C*e;a!==f&&(f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);
return f};g.scalar.rotateX=function(f,a,c){var b=Math.sin(c);c=Math.cos(c);var g=a[4],e=a[5],d=a[6],h=a[7],n=a[8],t=a[9],p=a[10],k=a[11];a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[4]=g*c+n*b;f[5]=e*c+t*b;f[6]=d*c+p*b;f[7]=h*c+k*b;f[8]=n*c-g*b;f[9]=t*c-e*b;f[10]=p*c-d*b;f[11]=k*c-h*b;return f};g.SIMD.rotateX=function(f,a,c){var b=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],
f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var g=SIMD.Float32x4.load(a,4);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,c),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(f,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,c),SIMD.Float32x4.mul(g,b)));return f};g.rotateX=r.USE_SIMD?g.SIMD.rotateX:g.scalar.rotateX;g.scalar.rotateY=function(f,a,c){var b=Math.sin(c);c=Math.cos(c);var g=a[0],e=a[1],d=a[2],h=a[3],n=a[8],t=a[9],p=a[10],k=a[11];a!==f&&(f[4]=a[4],
f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=g*c-n*b;f[1]=e*c-t*b;f[2]=d*c-p*b;f[3]=h*c-k*b;f[8]=g*b+n*c;f[9]=e*b+t*c;f[10]=d*b+p*c;f[11]=h*b+k*c;return f};g.SIMD.rotateY=function(f,a,c){var b=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var g=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,
c),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(f,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,b),SIMD.Float32x4.mul(a,c)));return f};g.rotateY=r.USE_SIMD?g.SIMD.rotateY:g.scalar.rotateY;g.scalar.rotateZ=function(f,a,c){var b=Math.sin(c);c=Math.cos(c);var g=a[0],e=a[1],d=a[2],h=a[3],n=a[4],t=a[5],p=a[6],k=a[7];a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=g*c+n*b;f[1]=e*c+t*b;f[2]=d*c+p*b;f[3]=h*c+k*b;f[4]=n*c-g*b;f[5]=t*c-e*b;f[6]=p*c-d*
b;f[7]=k*c-h*b;return f};g.SIMD.rotateZ=function(f,a,c){var b=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var g=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(f,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,c),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(f,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,c),SIMD.Float32x4.mul(g,b)));return f};g.rotateZ=r.USE_SIMD?
g.SIMD.rotateZ:g.scalar.rotateZ;g.fromTranslation=function(f,a){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=a[0];f[13]=a[1];f[14]=a[2];f[15]=1;return f};g.fromScaling=function(f,a){f[0]=a[0];f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a[1];f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=a[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};g.fromRotation=function(f,a,c){var b=c[0],g=c[1];c=c[2];var e=Math.sqrt(b*b+g*g+c*c),d;if(Math.abs(e)<r.EPSILON)return null;e=1/e;b*=e;
g*=e;c*=e;e=Math.sin(a);a=Math.cos(a);d=1-a;f[0]=b*b*d+a;f[1]=g*b*d+c*e;f[2]=c*b*d-g*e;f[3]=0;f[4]=b*g*d-c*e;f[5]=g*g*d+a;f[6]=c*g*d+b*e;f[7]=0;f[8]=b*c*d+g*e;f[9]=g*c*d-b*e;f[10]=c*c*d+a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};g.fromXRotation=function(f,a){var c=Math.sin(a);a=Math.cos(a);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=c;f[7]=0;f[8]=0;f[9]=-c;f[10]=a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};g.fromYRotation=function(f,a){var c=Math.sin(a);a=Math.cos(a);f[0]=a;f[1]=
0;f[2]=-c;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=c;f[9]=0;f[10]=a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};g.fromZRotation=function(f,a){var c=Math.sin(a);a=Math.cos(a);f[0]=a;f[1]=c;f[2]=0;f[3]=0;f[4]=-c;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};g.fromRotationTranslation=function(f,a,c){var b=a[0],g=a[1],e=a[2],d=a[3],h=b+b,n=g+g,t=e+e;a=b*h;var p=b*n,b=b*t,k=g*n,g=g*t,e=e*t,h=d*h,n=d*n,d=d*t;f[0]=1-(k+e);f[1]=p+d;f[2]=b-n;f[3]=0;f[4]=
p-d;f[5]=1-(a+e);f[6]=g+h;f[7]=0;f[8]=b+n;f[9]=g-h;f[10]=1-(a+k);f[11]=0;f[12]=c[0];f[13]=c[1];f[14]=c[2];f[15]=1;return f};g.getTranslation=function(f,a){f[0]=a[12];f[1]=a[13];f[2]=a[14];return f};g.getRotation=function(f,a){var c=a[0]+a[5]+a[10],b=0;0<c?(b=2*Math.sqrt(c+1),f[3]=.25*b,f[0]=(a[6]-a[9])/b,f[1]=(a[8]-a[2])/b,f[2]=(a[1]-a[4])/b):a[0]>a[5]&a[0]>a[10]?(b=2*Math.sqrt(1+a[0]-a[5]-a[10]),f[3]=(a[6]-a[9])/b,f[0]=.25*b,f[1]=(a[1]+a[4])/b,f[2]=(a[8]+a[2])/b):a[5]>a[10]?(b=2*Math.sqrt(1+a[5]-
a[0]-a[10]),f[3]=(a[8]-a[2])/b,f[0]=(a[1]+a[4])/b,f[1]=.25*b,f[2]=(a[6]+a[9])/b):(b=2*Math.sqrt(1+a[10]-a[0]-a[5]),f[3]=(a[1]-a[4])/b,f[0]=(a[8]+a[2])/b,f[1]=(a[6]+a[9])/b,f[2]=.25*b);return f};g.fromRotationTranslationScale=function(f,a,c,b){var g=a[0],e=a[1],d=a[2],h=a[3],n=g+g,t=e+e,p=d+d;a=g*n;var k=g*t,g=g*p,q=e*t,e=e*p,d=d*p,n=h*n,t=h*t,h=h*p,p=b[0],m=b[1];b=b[2];f[0]=(1-(q+d))*p;f[1]=(k+h)*p;f[2]=(g-t)*p;f[3]=0;f[4]=(k-h)*m;f[5]=(1-(a+d))*m;f[6]=(e+n)*m;f[7]=0;f[8]=(g+t)*b;f[9]=(e-n)*b;f[10]=
(1-(a+q))*b;f[11]=0;f[12]=c[0];f[13]=c[1];f[14]=c[2];f[15]=1;return f};g.fromRotationTranslationScaleOrigin=function(f,a,c,b,g){var e=a[0],d=a[1],h=a[2],l=a[3],t=e+e,p=d+d,k=h+h;a=e*t;var q=e*p,e=e*k,m=d*p,d=d*k,h=h*k,t=l*t,p=l*p,l=l*k,k=b[0],u=b[1];b=b[2];var r=g[0],v=g[1];g=g[2];f[0]=(1-(m+h))*k;f[1]=(q+l)*k;f[2]=(e-p)*k;f[3]=0;f[4]=(q-l)*u;f[5]=(1-(a+h))*u;f[6]=(d+t)*u;f[7]=0;f[8]=(e+p)*b;f[9]=(d-t)*b;f[10]=(1-(a+m))*b;f[11]=0;f[12]=c[0]+r-(f[0]*r+f[4]*v+f[8]*g);f[13]=c[1]+v-(f[1]*r+f[5]*v+f[9]*
g);f[14]=c[2]+g-(f[2]*r+f[6]*v+f[10]*g);f[15]=1;return f};g.fromQuat=function(f,a){var c=a[0],b=a[1],g=a[2];a=a[3];var e=c+c,d=b+b,h=g+g,c=c*e,n=b*e,b=b*d,t=g*e,p=g*d,g=g*h,e=a*e,d=a*d;a*=h;f[0]=1-b-g;f[1]=n+a;f[2]=t-d;f[3]=0;f[4]=n-a;f[5]=1-c-g;f[6]=p+e;f[7]=0;f[8]=t+d;f[9]=p-e;f[10]=1-c-b;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};g.frustum=function(f,a,c,b,g,e,d){var h=1/(c-a),l=1/(g-b),t=1/(e-d);f[0]=2*e*h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*e*l;f[6]=0;f[7]=0;f[8]=(c+a)*h;f[9]=(g+b)*l;f[10]=
(d+e)*t;f[11]=-1;f[12]=0;f[13]=0;f[14]=d*e*2*t;f[15]=0;return f};g.perspective=function(f,a,c,b,g){a=1/Math.tan(a/2);var e=1/(b-g);f[0]=a/c;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(g+b)*e;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*g*b*e;f[15]=0;return f};g.perspectiveFromFieldOfView=function(f,a,c,b){var g=Math.tan(a.upDegrees*Math.PI/180),e=Math.tan(a.downDegrees*Math.PI/180),d=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var h=2/(d+a),n=2/(g+e);f[0]=
h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=n;f[6]=0;f[7]=0;f[8]=-((d-a)*h*.5);f[9]=(g-e)*n*.5;f[10]=b/(c-b);f[11]=-1;f[12]=0;f[13]=0;f[14]=b*c/(c-b);f[15]=0;return f};g.ortho=function(f,a,c,b,g,e,d){var h=1/(a-c),l=1/(b-g),t=1/(e-d);f[0]=-2*h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*l;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*t;f[11]=0;f[12]=(a+c)*h;f[13]=(g+b)*l;f[14]=(d+e)*t;f[15]=1;return f};g.lookAt=function(f,a,c,b){var l,e,d,h,n,t,p,k,q=a[0],m=a[1];a=a[2];d=b[0];h=b[1];e=b[2];p=c[0];b=c[1];l=c[2];if(Math.abs(q-
p)<r.EPSILON&&Math.abs(m-b)<r.EPSILON&&Math.abs(a-l)<r.EPSILON)return g.identity(f);c=q-p;b=m-b;p=a-l;k=1/Math.sqrt(c*c+b*b+p*p);c*=k;b*=k;p*=k;l=h*p-e*b;e=e*c-d*p;d=d*b-h*c;(k=Math.sqrt(l*l+e*e+d*d))?(k=1/k,l*=k,e*=k,d*=k):d=e=l=0;h=b*d-p*e;n=p*l-c*d;t=c*e-b*l;(k=Math.sqrt(h*h+n*n+t*t))?(k=1/k,h*=k,n*=k,t*=k):t=n=h=0;f[0]=l;f[1]=h;f[2]=c;f[3]=0;f[4]=e;f[5]=n;f[6]=b;f[7]=0;f[8]=d;f[9]=t;f[10]=p;f[11]=0;f[12]=-(l*q+e*m+d*a);f[13]=-(h*q+n*m+t*a);f[14]=-(c*q+b*m+p*a);f[15]=1;return f};g.str=function(f){return"mat4("+
f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+", "+f[9]+", "+f[10]+", "+f[11]+", "+f[12]+", "+f[13]+", "+f[14]+", "+f[15]+")"};g.frob=function(f){return Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)+Math.pow(f[2],2)+Math.pow(f[3],2)+Math.pow(f[4],2)+Math.pow(f[5],2)+Math.pow(f[6],2)+Math.pow(f[7],2)+Math.pow(f[8],2)+Math.pow(f[9],2)+Math.pow(f[10],2)+Math.pow(f[11],2)+Math.pow(f[12],2)+Math.pow(f[13],2)+Math.pow(f[14],2)+Math.pow(f[15],2))};g.add=function(f,a,
c){f[0]=a[0]+c[0];f[1]=a[1]+c[1];f[2]=a[2]+c[2];f[3]=a[3]+c[3];f[4]=a[4]+c[4];f[5]=a[5]+c[5];f[6]=a[6]+c[6];f[7]=a[7]+c[7];f[8]=a[8]+c[8];f[9]=a[9]+c[9];f[10]=a[10]+c[10];f[11]=a[11]+c[11];f[12]=a[12]+c[12];f[13]=a[13]+c[13];f[14]=a[14]+c[14];f[15]=a[15]+c[15];return f};g.subtract=function(f,a,c){f[0]=a[0]-c[0];f[1]=a[1]-c[1];f[2]=a[2]-c[2];f[3]=a[3]-c[3];f[4]=a[4]-c[4];f[5]=a[5]-c[5];f[6]=a[6]-c[6];f[7]=a[7]-c[7];f[8]=a[8]-c[8];f[9]=a[9]-c[9];f[10]=a[10]-c[10];f[11]=a[11]-c[11];f[12]=a[12]-c[12];
f[13]=a[13]-c[13];f[14]=a[14]-c[14];f[15]=a[15]-c[15];return f};g.sub=g.subtract;g.multiplyScalar=function(f,a,c){f[0]=a[0]*c;f[1]=a[1]*c;f[2]=a[2]*c;f[3]=a[3]*c;f[4]=a[4]*c;f[5]=a[5]*c;f[6]=a[6]*c;f[7]=a[7]*c;f[8]=a[8]*c;f[9]=a[9]*c;f[10]=a[10]*c;f[11]=a[11]*c;f[12]=a[12]*c;f[13]=a[13]*c;f[14]=a[14]*c;f[15]=a[15]*c;return f};g.multiplyScalarAndAdd=function(f,a,c,b){f[0]=a[0]+c[0]*b;f[1]=a[1]+c[1]*b;f[2]=a[2]+c[2]*b;f[3]=a[3]+c[3]*b;f[4]=a[4]+c[4]*b;f[5]=a[5]+c[5]*b;f[6]=a[6]+c[6]*b;f[7]=a[7]+c[7]*
b;f[8]=a[8]+c[8]*b;f[9]=a[9]+c[9]*b;f[10]=a[10]+c[10]*b;f[11]=a[11]+c[11]*b;f[12]=a[12]+c[12]*b;f[13]=a[13]+c[13]*b;f[14]=a[14]+c[14]*b;f[15]=a[15]+c[15]*b;return f};g.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===a[2]&&f[3]===a[3]&&f[4]===a[4]&&f[5]===a[5]&&f[6]===a[6]&&f[7]===a[7]&&f[8]===a[8]&&f[9]===a[9]&&f[10]===a[10]&&f[11]===a[11]&&f[12]===a[12]&&f[13]===a[13]&&f[14]===a[14]&&f[15]===a[15]};g.equals=function(f,a){var c=f[0],b=f[1],g=f[2],e=f[3],d=f[4],h=f[5],n=f[6],t=f[7],
p=f[8],k=f[9],q=f[10],m=f[11],u=f[12],x=f[13],v=f[14];f=f[15];var y=a[0],A=a[1],C=a[2],B=a[3],D=a[4],E=a[5],H=a[6],F=a[7],L=a[8],G=a[9],P=a[10],J=a[11],M=a[12],O=a[13],aa=a[14];a=a[15];return Math.abs(c-y)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(b-A)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(A))&&Math.abs(g-C)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(e-B)<=r.EPSILON*Math.max(1,Math.abs(e),Math.abs(B))&&Math.abs(d-D)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&
Math.abs(h-E)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(n-H)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(H))&&Math.abs(t-F)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(F))&&Math.abs(p-L)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(k-G)<=r.EPSILON*Math.max(1,Math.abs(k),Math.abs(G))&&Math.abs(q-P)<=r.EPSILON*Math.max(1,Math.abs(q),Math.abs(P))&&Math.abs(m-J)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(u-M)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(x-
O)<=r.EPSILON*Math.max(1,Math.abs(x),Math.abs(O))&&Math.abs(v-aa)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(aa))&&Math.abs(f-a)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return g})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var r={EPSILON:1E-6};r.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;r.RANDOM=Math.random;r.ENABLE_SIMD=!1;r.SIMD_AVAILABLE=r.ARRAY_TYPE===Float32Array&&"SIMD"in this;r.USE_SIMD=r.ENABLE_SIMD&&r.SIMD_AVAILABLE;r.setMatrixArrayType=
function(f){r.ARRAY_TYPE=f};var g=Math.PI/180;r.toRadian=function(f){return f*g};r.equals=function(f,a){return Math.abs(f-a)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return r})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(r){var g={create:function(){var f=new r.ARRAY_TYPE(2);f[0]=0;f[1]=0;return f},clone:function(f){var a=new r.ARRAY_TYPE(2);a[0]=f[0];a[1]=f[1];return a},fromValues:function(f,a){var c=new r.ARRAY_TYPE(2);c[0]=f;c[1]=a;return c},copy:function(f,a){f[0]=
a[0];f[1]=a[1];return f},set:function(f,a,c){f[0]=a;f[1]=c;return f},add:function(f,a,c){f[0]=a[0]+c[0];f[1]=a[1]+c[1];return f},subtract:function(f,a,c){f[0]=a[0]-c[0];f[1]=a[1]-c[1];return f}};g.sub=g.subtract;g.multiply=function(f,a,c){f[0]=a[0]*c[0];f[1]=a[1]*c[1];return f};g.mul=g.multiply;g.divide=function(f,a,c){f[0]=a[0]/c[0];f[1]=a[1]/c[1];return f};g.div=g.divide;g.ceil=function(f,a){f[0]=Math.ceil(a[0]);f[1]=Math.ceil(a[1]);return f};g.floor=function(f,a){f[0]=Math.floor(a[0]);f[1]=Math.floor(a[1]);
return f};g.min=function(f,a,c){f[0]=Math.min(a[0],c[0]);f[1]=Math.min(a[1],c[1]);return f};g.max=function(f,a,c){f[0]=Math.max(a[0],c[0]);f[1]=Math.max(a[1],c[1]);return f};g.round=function(f,a){f[0]=Math.round(a[0]);f[1]=Math.round(a[1]);return f};g.scale=function(f,a,c){f[0]=a[0]*c;f[1]=a[1]*c;return f};g.scaleAndAdd=function(f,a,c,b){f[0]=a[0]+c[0]*b;f[1]=a[1]+c[1]*b;return f};g.distance=function(f,a){var c=a[0]-f[0];f=a[1]-f[1];return Math.sqrt(c*c+f*f)};g.dist=g.distance;g.squaredDistance=function(f,
a){var c=a[0]-f[0];f=a[1]-f[1];return c*c+f*f};g.sqrDist=g.squaredDistance;g.length=function(f){var a=f[0];f=f[1];return Math.sqrt(a*a+f*f)};g.len=g.length;g.squaredLength=function(f){var a=f[0];f=f[1];return a*a+f*f};g.sqrLen=g.squaredLength;g.negate=function(f,a){f[0]=-a[0];f[1]=-a[1];return f};g.inverse=function(f,a){f[0]=1/a[0];f[1]=1/a[1];return f};g.normalize=function(f,a){var c=a[0],b=a[1],c=c*c+b*b;0<c&&(c=1/Math.sqrt(c),f[0]=a[0]*c,f[1]=a[1]*c);return f};g.dot=function(f,a){return f[0]*a[0]+
f[1]*a[1]};g.cross=function(f,a,c){a=a[0]*c[1]-a[1]*c[0];f[0]=f[1]=0;f[2]=a;return f};g.lerp=function(f,a,c,b){var g=a[0];a=a[1];f[0]=g+b*(c[0]-g);f[1]=a+b*(c[1]-a);return f};g.random=function(f,a){a=a||1;var c=2*r.RANDOM()*Math.PI;f[0]=Math.cos(c)*a;f[1]=Math.sin(c)*a;return f};g.transformMat2=function(f,a,c){var b=a[0];a=a[1];f[0]=c[0]*b+c[2]*a;f[1]=c[1]*b+c[3]*a;return f};g.transformMat2d=function(f,a,c){var b=a[0];a=a[1];f[0]=c[0]*b+c[2]*a+c[4];f[1]=c[1]*b+c[3]*a+c[5];return f};g.transformMat3=
function(f,a,c){var b=a[0];a=a[1];f[0]=c[0]*b+c[3]*a+c[6];f[1]=c[1]*b+c[4]*a+c[7];return f};g.transformMat4=function(f,a,c){var b=a[0];a=a[1];f[0]=c[0]*b+c[4]*a+c[12];f[1]=c[1]*b+c[5]*a+c[13];return f};g.forEach=function(){var f=g.create();return function(a,c,b,g,e,d){c||(c=2);b||(b=0);for(g=g?Math.min(g*c+b,a.length):a.length;b<g;b+=c)f[0]=a[b],f[1]=a[b+1],e(f,f,d),a[b]=f[0],a[b+1]=f[1];return a}}();g.str=function(f){return"vec2("+f[0]+", "+f[1]+")"};g.exactEquals=function(f,a){return f[0]===a[0]&&
f[1]===a[1]};g.equals=function(f,a){var c=f[0];f=f[1];var b=a[0];a=a[1];return Math.abs(c-b)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(f-a)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return g})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(r,g,f,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._opacity=1;b.renderRequested=
!1;b._visible=!0;return b}f(b,a);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(a){return!0};b.prototype.detach=function(a){};b.prototype.processRender=function(a){this._renderRequestedCalled=!1;this.doRender(a);this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};b.prototype.requestRender=function(){var a=
this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};return b}(a.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function b(){}
b.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};b.prototype.once=function(a,b){return c.once(this,a,b)};b.prototype.emit=function(a){c.emit(this,a,this)};b.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return b}();g.Evented=r;g.EventedMixin=function(b){return function(b){function e(){return null!==b&&b.apply(this,arguments)||this}f(e,b);e.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};e.prototype.once=function(a,b){return c.once(this,
a,b)};e.prototype.emit=function(a,b){c.emit(this,a,b)};e.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return e}(b)}})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(){return function(a){this.type=a}}();g.RenderBucket=r;a=function(a){function b(){var b=a.call(this,2)||this;b.triangleElementStart=
0;b.triangleElementCount=0;return b}f(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(r);g.LineRenderBucket=a;a=function(a){function b(){var b=a.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=0;return b}f(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return b}(r);g.FillRenderBucket=a;a=function(a){function b(){var b=a.call(this,3)||this;b.markerPerPageElementsMap=
new Map;b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}f(b,a);b.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(r);g.SymbolRenderBucket=a;a=function(a){function b(){var b=a.call(this,4)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}f(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(r);g.CircleRenderBucket=a;r=function(a){function b(){return a.call(this,0)||this}f(b,a);
b.prototype.hasData=function(){return!0};return b}(r);g.BackgroundRenderBucket=r})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/glMatrix ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),function(r,g,f,a,c,b,l,e){function d(a,b,c){for(var d=0;d<c.length;d++){var f=c[d];if(f){var g=f.safeWidth,h=f.width,k=f.pixelData,m=l.clamp(f.dy*(f.y1-b),0,g),f=l.clamp(f.dx*(a-f.x0),0,g),g=
Math.floor(m),q=Math.floor(f),n=g*h+q,p=n+h,t=k[n],h=k[p],n=k[n+1],k=k[p+1];if(t+h+n+k<.5*e.ELEVATION_NODATA_VALUE)return m-=g,f-=q,a=t+(n-t)*f,a+(h+(k-h)*f-a)*m}}return null}function h(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=q[f];if(!g){var g=b-1,h=b-1,k=b*b,l=2*g+2*h,m=g*h*6,n=6*l,t=6*(2*g+h-1);d&&(m*=2,n*=2,t*=2);for(var l=65536<k+l?new Uint32Array(m+n):new Uint16Array(m+n),u=0,r=0,v=m,x,y,A,B,C=0,I=0;I<=h;I++){e&&(C=0===I?t:I===h?-t:0);for(var v=v+C,K=0;K<=g;K++)A=p(K,I,g,h),-1<A&&
(B=0===I&&K!==g?1:K===g&&I!==h?g+1:I===h&&0!==K?-1:0===K&&0!==I?-(g+1):0,0!==B&&(x=u,y=k+A,A=k+(0===K&&1===I?0:A+1),B=u+B,d?(l[v+0]=x,l[v+1]=y,l[v+2]=y,l[v+3]=A,l[v+4]=A,l[v+5]=x,l[v+6]=A,l[v+7]=B,l[v+8]=B,l[v+9]=x,l[v+10]=x,l[v+11]=A,v+=12):(l[v+0]=x,l[v+1]=y,l[v+2]=A,l[v+3]=A,l[v+4]=B,l[v+5]=x,v+=6))),++u,K<g&&I<h&&(x=I*(g+1)+K,y=x+1,A=y+(g+1),B=A-1,d?(l[r+0]=x,l[r+1]=y,l[r+2]=y,l[r+3]=A,l[r+4]=A,l[r+5]=x,l[r+6]=A,l[r+7]=B,l[r+8]=B,l[r+9]=x,l[r+10]=x,l[r+11]=A,r+=12):(l[r+0]=x,l[r+1]=y,l[r+2]=A,
l[r+3]=A,l[r+4]=B,l[r+5]=x,r+=6));v-=C}g={values:l,numSurfaceIndices:m,numSkirtIndices:n};q[f]=g}a.indices=g.values;a.numSurfaceIndices=g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function n(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function t(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function p(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===
a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(g,"__esModule",{value:!0});var k=new c.ArrayPool(Float32Array);g.releaseGeometry=function(a){k.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};g.elevationSampler=d;g.createSphericalGlobeTile=function(c,e,g,q,r,E,H,F,L){var y=g[0],A=g[1],B=g[2];g=g[3];var C=.1*b.earthRadius*(g-A),D=c-1,aa=c-1,V=c*c,N=k.get(5*(V+(2*D+2*aa))),S=L.boundingBox;f.empty(S);var W=e[2]-e[0],X=e[3]-e[1],Q=B-y,B=E[0],I=E[1];E=E[2];for(var K=0;K<=D;K++){var T=K/D,Y=
y+T*Q;m[K]=Math.sin(Y);u[K]=Math.cos(Y);x[K]=T;v[K]=e[0]+T*W}y=q&&!!(H&1);W=q&&!!(H&2);for(Y=Q=0;Y<=aa;Y++){var ba=Y/aa,K=l.lerp(A,g,ba),R=Math.cos(K),ha=Math.sin(K),ea=void 0;q?(ea=b.earthRadius/2*Math.log((1+ha)/(1-ha)),ba=(ea-e[1])/X):ea=180*K/Math.PI;for(K=0;K<=D;K++){var T=x[K],ca=m[K],fa=u[K],da=b.earthRadius;r&&(da+=d(v[K],ea,r)||0);fa=fa*R*da-B;ca=ca*R*da-I;da=ha*da-E;n(fa,ca,da,S);var ga=5*Q;N[ga+0]=fa;N[ga+1]=ca;N[ga+2]=da;N[ga+3]=T;N[ga+4]=ba;ga=p(K,Y,D,aa);if(-1<ga){var ga=5*(V+ga),ka=
y&&0===Y?-1:W&&Y===aa?1:0,fa=0===ka?fa:-B,ca=0===ka?ca:-I,da=0===ka?da:b.earthRadius*ka-E;N[ga+0]=fa;N[ga+1]=ca;N[ga+2]=da;N[ga+3]=0===ka?t(T,ba):T;N[ga+4]=0===ka?C:ba;0!==ka&&n(fa,ca,da,S)}++Q}}L.numVertsPerRow=c;L.vertexAttributes=N;L.skirtLength=C;a.vec4d.set4(0,0,1,1,L.uvOffsetAndScale);h(L,c,q?H:0,F)};g.createPlanarGlobeTile=function(b,c,e,g,l,m,q){var u=c[0],r=c[1],v=c[2]-u,x=c[3]-r,y=m?Math.max(0,(m[0]-c[0])/v):0,A=m?Math.max(0,(m[1]-c[1])/x):0,B=m?Math.min(1,(m[2]-c[0])/v):1;c=m?Math.min(1,
(m[3]-c[1])/x):1;var C=B>y?1/(B-y):1,D=c>A?1/(c-A):1,E=-y*C,H=-A*D,W=.1*v,X=b-1,Q=b-1,I=b*b,K=k.get(5*(I+(2*X+2*Q))),T=q.boundingBox;f.empty(T);for(var Y=0,ba=0;ba<=Q;ba++){var R=ba/Q,ha=H+R*D,R=r+R*x;m&&(R<m[1]?(R=m[1],ha=0):R>m[3]&&(R=m[3],ha=1));for(var ea=0;ea<=X;ea++){var ca=ea/X,fa=E+ca*C,ca=u+ca*v;m&&(ca<m[0]?(ca=m[0],fa=0):ca>m[2]&&(ca=m[2],fa=1));var da=e?d(ca,R,e)||0:0,ca=ca-g[0],ga=R-g[1],da=da-g[2];n(ca,ga,da,T);K[5*Y]=ca;K[5*Y+1]=ga;K[5*Y+2]=da;K[5*Y+3]=fa;K[5*Y+4]=ha;var ka=p(ea,ba,
X,X);-1<ka&&(ka=5*(I+ka),K[ka]=ca,K[ka+1]=ga,K[ka+2]=da,K[ka+3]=t(fa,ha),K[ka+4]=W);++Y}}q.numVertsPerRow=b;q.vertexAttributes=K;q.skirtLength=W;a.vec4d.set4(y,A,B-y,c-A,q.uvOffsetAndScale);h(q,b,0,l)};var q=[],m=Array(e.MAX_TILE_TESSELATION+1),u=Array(e.MAX_TILE_TESSELATION+1),x=Array(e.MAX_TILE_TESSELATION+1),v=Array(e.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function f(a,
c){void 0===c&&(c=50);this.arrayConstructor=a;this.maxPoolSizePerCount=c;this.pool={}}f.prototype.get=function(a){var c=this.pool[a];c||(c={ptr:0,data:Array(this.maxPoolSizePerCount)},this.pool[a]=c);0<c.ptr?(a=c.data[--c.ptr],c.data[c.ptr]=null):a=new this.arrayConstructor(a);return a};f.prototype.put=function(a){var c=this.pool[a.length];c.ptr<c.data.length&&(c.data[c.ptr++]=a)};return f}();g.ArrayPool=r})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/glMatrix ../support/earthUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),
function(r,g,f,a,c,b,l,e,d){function h(a,c,d,e){d=b.earthRadius+d;var f=Math.cos(a);e[0]=Math.cos(c)*f*d;e[1]=Math.sin(c)*f*d;e[2]=Math.sin(a)*d}return function(e){function g(a,b,d,f){var h=e.call(this,g.NumSubdivisionsAtLevel)||this;h.obb=[];h.isWebMercator=!1;h.tileUp=c.vec3d.create();h.obb=Array(8);for(var k=0;8>k;k++)h.obb[k]=c.vec3d.create();void 0!==a&&h.init(a,b,d,f);return h}f(g,e);g.prototype.init=function(a,d,f,g){e.prototype.init.call(this,a,d,f,g);this.isWebMercator=g.spatialReference.isWebMercator;
d=this.extentWGS84Rad[0];f=this.extentWGS84Rad[1];g=this.extentWGS84Rad[2];var k=this.extentWGS84Rad[3];a=a[0];var m=l.lerp(f,k,.5),q=l.lerp(d,g,.5);this.edgeLen=(g-d)*Math.cos(0===a?0:Math.min(Math.abs(f),Math.abs(k)))*b.earthRadius;this.curvatureHeight=b.earthRadius-Math.sqrt(b.earthRadius*b.earthRadius-this.edgeLen*this.edgeLen/4);h(m,q,0,this.centerAtSeaLevel);c.vec3d.set(this.centerAtSeaLevel,this.tileUp);c.vec3d.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])c.vec3d.set3(0,0,0,this.center),this.radius=b.earthRadius+this.elevationBounds[1];else{e.prototype.updateRadiusAndCenter.call(this);var a=Math.max(c.vec3d.dist2(this.center,this.obb[0]),c.vec3d.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};g.prototype.isVisible=function(a,b){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){b=this.obb;for(var c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!(0>a[c][0]*b[d][0]+a[c][1]*b[d][1]+a[c][2]*b[d][2]+a[c][3]);d++);
if(8===d)return!1}}else if(b=this.radius,c=this.center,a[0][0]*c[0]+a[0][1]*c[1]+a[0][2]*c[2]+a[0][3]>b||a[1][0]*c[0]+a[1][1]*c[1]+a[1][2]*c[2]+a[1][3]>b||a[2][0]*c[0]+a[2][1]*c[1]+a[2][2]*c[2]+a[2][3]>b||a[3][0]*c[0]+a[3][1]*c[1]+a[3][2]*c[2]+a[3][3]>b||a[4][0]*c[0]+a[4][1]*c[1]+a[4][2]*c[2]+a[4][3]>b||a[5][0]*c[0]+a[5][1]*c[1]+a[5][2]*c[2]+a[5][3]>b)return!1;return!0};g.prototype.computeElevationBounds=function(){e.prototype.computeElevationBounds.call(this);this._updateOBB()};g.prototype.createGeometry=
function(a,b,c,e){var f=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;return d.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this.isWebMercator,a.samplerData,b,f,c,e)};g.prototype._updateOBB=function(){for(var a=this.extentWGS84Rad,d=this.obb,e=0;2>e;e++){var f=this.elevationBounds[e],g=4*e;h(a[1],a[0],f,d[g++]);h(a[3],a[0],f,d[g++]);h(a[3],a[2],f,d[g++]);h(a[1],a[2],f,d[g++])}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(c.vec3d.set3(0,0,
b.earthRadius,d[1]),c.vec3d.set3(0,0,b.earthRadius,d[2]),c.vec3d.set3(0,0,b.earthRadius,d[5]),c.vec3d.set3(0,0,b.earthRadius,d[6])):1===a&&(c.vec3d.set3(0,0,-b.earthRadius,d[0]),c.vec3d.set3(0,0,-b.earthRadius,d[3]),c.vec3d.set3(0,0,-b.earthRadius,d[4]),c.vec3d.set3(0,0,-b.earthRadius,d[7])))};g.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};g.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];g.Pool=new a(g);return g}(e)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){function t(a,b){a&&!a.spatialReference.equals(b)&&(a=d.canProject(a.spatialReference,b)?d.project(a,b):null);return a}Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function d(a){a=c.call(this,a)||this;a._changeListeners=new b;return a}f(d,c);d.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};d.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(d.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});d.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var f=a[d].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=t(f.fullExtent,b),null!=f&&c.push(e.fromExtent(f)))}return c};
a([l.property({readOnly:!0})],d.prototype,"layerViewsExtent",null);a([l.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],d.prototype,"tiledLayersExtent",null);a([l.property({readOnly:!0,dependsOn:["spatialReference"]})],d.prototype,"stencilEnabledExtents",null);a([l.property()],d.prototype,"spatialReference",null);a([l.property()],d.prototype,"tilingScheme",null);a([l.property()],d.prototype,"defaultTiledLayersExtent",void 0);a([l.property({constructOnly:!0})],d.prototype,"layers",
void 0);a([l.property({constructOnly:!0})],d.prototype,"layerViews",void 0);return d=a([l.subclass()],d)}(l.declared(c));c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}f(c,b);c.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};c.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};c.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?h.WEBMERCATOR_WORLD_EXTENT:h.GEOGRAPHIC_WORLD_EXTENT};a([l.property({dependsOn:["spatialReference"]})],
c.prototype,"layerViewsExtent",void 0);return c=a([l.subclass()],c)}(l.declared(r));g.SurfaceExtentHelperGlobal=c;r=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}f(c,b);c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};c.prototype._computeLayerViewsExtent=function(){var a=e.empty(),b=this.spatialReference;
this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInViewSpatialReference||c.layer.fullExtent,(c=t(c,b))&&e.expand(a,c))});var c=e.allFinite(a)?a:null,d=this._get("layerViewsExtent");return e.equals(c,d)?d:c};c.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,c=e.empty();this.layers.forEach(function(d){if(d.loaded&&n.isTiledLayer(d)){var f=n.getTiledLayerInfo(d,b,"local");d=f.tileInfo;f=f.fullExtent;d&&a.compatibleWith(d)&&
f&&f.spatialReference.equals(b)&&e.expand(c,f)}});this.defaultTiledLayersExtent&&e.expand(c,this.defaultTiledLayersExtent);var d=e.allFinite(c)?c:null,f=this._get("tiledLayersExtent");return e.equals(d,f)?f:d};return c=a([l.subclass()],c)}(l.declared(r));g.SurfaceExtentHelperLocal=r})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(r,g,f,a,c,b,l,e,d){return function(c){function g(a){a=c.call(this,a)||this;a._changeHandles=new b;return a}f(g,c);g.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};g.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};g.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return e.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!e.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var c=e.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,c=new d(c),b=e.getKnownTiledServiceLevelCap(b.url);Infinity>b&&c.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(c)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};g.prototype._updateWhen=function(a){var b=this,c=a.when().always(function(){c===b._waitTask&&b._update()});this._waitTask=c};g.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?d.makeWebMercatorAuxiliarySphere(c):d.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};g.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};g.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?d.WebMercatorAuxiliarySphere:d.makeWGS84WithTileSize(256),this.extent=
this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=d.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};a([l.property()],g.prototype,"tilingScheme",void 0);a([l.property()],g.prototype,"extent",void 0);a([l.property({value:!1})],g.prototype,"tilingSchemeLocked",void 0);a([l.property({readOnly:!0,value:!1})],g.prototype,"tilingSchemeDone",void 0);a([l.property({constructOnly:!0})],g.prototype,"viewSpatialReference",void 0);a([l.property({constructOnly:!0})],
g.prototype,"layers",void 0);a([l.property({constructOnly:!0})],g.prototype,"extentHelper",void 0);a([l.property({constructOnly:!0})],g.prototype,"manifold",void 0);return g=a([l.subclass()],g)}(l.declared(c))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper dojo/text!./TerrainMaterial.xml ../../../Color ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../lib/glMatrix ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/ShaderVariations ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../../webgl/BufferObject ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P){function J(a){return function(b,c){b=b.screenDepth;c=c.screenDepth;return b<c?-a:b>c?a:0}}function M(a){var b=J(a);return function(c,d){return 0===c.tiles.length?-a:0===d.tiles.length?a:b(c.tiles.data[0],d.tiles.data[0])}}var O=H.assert,aa=h.mat4d.identity(),V=C.OPAQUE_TERRAIN,N=C.TRANSPARENT_TERRAIN,S=h.vec3d.create(),W=h.vec2d.create(),X=d.create(),Q=h.vec4d.create(),I=h.vec4d.create(),K=h.vec4d.create(),T=function(){return function(){this.extent=
h.vec4d.create();this.maxLevel=this.minLevel=0;this.callback=null}}();r=function(){function f(a,c){this.initialized=!1;this.rctx=null;this.renderDataPool=new b(q.TileRenderData);this.perOriginTileData=new l(10,function(){return{root:null,origin:null,tiles:new l(300)}});this.perOriginTileDataDirty=!0;this.tileIterator=new u.IteratorPreorder;this.highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=F.copyParameters(Y);this._skirtScale=this._opacity=1;this._cullBackFaces=
this._disableRendering=this._drawBorders=!1;this._renderOrder=1;this._velvetOverground=!0;this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new t;this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=!0;this.needsHighlight=this.didRender=
!1;this.visibleScaleRangeQueries=new l(10);this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new l(30);this.visibleScaleRangeQueryPool=new b(T,!1);this.manifold=a;this.tileSize=c||256}f.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null)};f.prototype.install=function(a){a.addExternalRenderer([V,N],this);this.drapedRenderer=a.getDrapedTextureRenderer()};f.prototype.uninstall=function(a){a.removeExternalRenderer(this)};
Object.defineProperty(f.prototype,"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"opacity",{set:function(a){this._opacity=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"drawBorders",{set:function(a){this._drawBorders!==
a&&(this._drawBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderOrder",{set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this._updatePrograms())},
enumerable:!0,configurable:!0});f.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};f.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};f.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};f.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};f.prototype.loadTile=function(a){O(null===a.renderData);a.renderData=
this.renderDataPool.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a);a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===this.wireframe.mode,a.renderData.geometryInfo);a.renderData.localOrigin=b;this._updateTileGeometryBuffers(a);this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};f.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();h.vec4d.set(a,e.extent);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=
c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};f.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};f.prototype.updateTileGeometryNeedsUpdate=function(a){return a.renderData.updateGeometryState(a).needsUpdate};f.prototype._updateTileGeometry=function(a){for(var b=a.renderData.geometryState,c=a.layerInfo[p.LayerClass.ELEVATION],d=0;d<c.length;d++)c[d].pendingUpdates&=~p.TileUpdateTypes.UPDATE_GEOMETRY;
return b.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),a.createGeometry(b,a.renderData.localOrigin,"debug"===this.wireframe.mode,a.renderData.geometryInfo),this._updateTileGeometryBuffers(a),!0):!1};f.prototype.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);return this._updateTileGeometry(a)};f.prototype.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();this.renderDataPool.release(a.renderData);a.renderData=null};
f.prototype.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===this.manifold)return S;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};f.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};f.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};f.prototype.getWireframeEnabled=
function(){return"shader"===this.wireframe.mode};f.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};f.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&u.traverseTilesPreorder(this.rootTiles,function(a){a.renderData&&
(a.renderData.vao&&b._releaseTileGeometry(a),a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,e,a.renderData.geometryInfo),b._updateTileGeometryBuffers(a))})}for(var f in a)c.hasOwnProperty(f)&&(c[f]=a[f]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};f.prototype.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};f.prototype.resetNeedsRender=
function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};f.prototype.isTransparent=function(){var a=this.wireframe;return 1>this._opacity||"shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity)};f.prototype.updateTileBackground=function(a){this.backgroundPromise&&this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof a?n.requestImage(a).catch(function(){return null}):null!=a?e.resolve(c.toUnitRGBA(a)):e.resolve(null);this._renderTileBackground()};
f.prototype.initializeRenderContext=function(b){var c=this,d=this.rctx=b.rctx,f=function(a){e.when(a).then(function(){c.initialized=!0;c.setNeedsRender()}).catch(f)};f(this._renderTileBackground());var g=b.shaderSnippets;b=b.programRep;g.vsTerrain||g._parse(a);var h=new D("terrain",["vsTerrain","fsTerrain"],null,b,g,d);h.addDefine("Spherical","SPHERICAL");h.addDefine("Overlay","OVERLAY");h.addDefine("Atmosphere","ATMOSPHERE");h.addDefine("Wireframe","WIREFRAME");h.addDefine("TileBorders","TILE_BORDERS");
h.addBinaryShaderSnippetSuffix("Wireframe","Wireframe",[!1,!0]);h.addDefine("ReceiveShadows","RECEIVE_SHADOWS");h.addDefine("ScreenSizePerspective","SCREEN_SIZE_PERSPECTIVE");var k=new D("terrainNormal",["vsTerrainNormal","fsNormal"],null,b,g,d);k.addDefine("Spherical","SPHERICAL");k.addDefine("AlphaZero","ALPHA_ZERO");var l=new D("terrainDepth",["vsTerrainDepth","fsDepth"],null,b,g,d);l.addDefine("Spherical","SPHERICAL");l.addDefine("ShadowMap","BIAS_SHADOWMAP");g=new D("terrainHighlight",["vsTerrainHighlight",
"fsTerrainHighlight"],null,b,g,d);g.addDefine("Spherical","SPHERICAL");this.programs={color:null,normal:null,depth:null,depthShadowMap:null,highlight:null};this.programVariations={color:h,normal:k,depth:l,highlight:g};this._updatePrograms();this.tileRenderer=new m(d,this.tileSize,b,this.resourceCounter,this.setNeedsRender.bind(this));this._renderTileBackground();this.emptyTex=y.createEmptyTexture(d)};f.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=
null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};f.prototype.render=function(a){var b=a.rctx,c=b.gl;if(this.initialized&&!this._disableRendering&&this.visible&&this.rootTiles&&this.tileBackgroundInitialized){var d=this.isTransparent()?N:V;if(a.slot===d){E.trace("# BEGIN RENDER TERRAIN");d=a.pass;b.setFaceCullingEnabled(this._cullBackFaces);var e=1===a.lightingData.helper.globalFactor;d===A.MATERIAL?this._renderMaterialPass(a,this._updatePerOriginTileData()):d===A.MATERIAL_DEPTH_SHADOWMAP&&
this.castShadows&&e?this._renderDepthPass(a,this.programs.depthShadowMap,this._updatePerOriginTileData()):d===A.MATERIAL_DEPTH?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):d===A.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):d===A.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clear(c.DEPTH_BUFFER_BIT));this._cullBackFaces&&b.setFaceCullingEnabled(!1);E.trace("# END RENDER TERRAIN");
return!0}}};f.prototype.intersect=function(a,b,c,e){if(this.rootTiles){var f=this.clippingExtent;if((!a.isSelection||!this.isTransparent())&&a.enableTerrain){var g=R,k=ha;h.vec3d.subtract(c,b,g);h.vec3d.set3(1/g[0],1/g[1],1/g[2],k);var l=a.getMinResult(),m=a.getMaxResult(),q=this.tileIterator;q.reset(this.rootTiles);e=function(){var e=q.next();if(null===e.renderData)return"continue";if(a.enableInvisibleTerrain){if(!e.visible&&f&&!e.intersectsExtent(f))return"continue"}else if(!e.visible)return"continue";
var p=e.renderData,t=p.geometryInfo,r=p.localOrigin,v=ea,x=ca;h.vec3d.subtract(b,r,v);h.vec3d.subtract(c,r,x);var y=-n._skirtScale*p.geometryInfo.skirtLength;0!==y&&(p=e.tileUp,d.offset(t.boundingBox,y*p[0],y*p[1],y*p[2],X),d.expandWithBuffer(X,t.boundingBox,0,2));if(!F.intersectAabbInvDir(0!==y?X:t.boundingBox,v,k,a.tolerance))return"continue";var p=function(b,c,d){if(0<=b&&(a.enableBackfacesTerrain||0>h.vec3d.dot(c,g))){d=void 0;if(void 0===l.dist||b<l.dist)d=u.lij2str(e.lij[0],e.lij[1],e.lij[2]),
l.set(void 0,d,b,c,void 0),l.setIntersector("terrain");if(void 0===m.dist||b>m.dist)d=u.lij2str(e.lij[0],e.lij[1],e.lij[2]),m.set(void 0,d,b,c,void 0),m.setIntersector("terrain")}},r=t.indices,w={data:t.vertexAttributes,size:3,offsetIdx:0,strideIdx:5},t=t.numWithoutSkirtIndices/3;F.intersectTriangles(v,x,0,t,r,w,null,p);0!==y&&u.intersectSkirts(v,x,t,r.length/3,r,w,null,"spherical"===n.manifold?function(a){return h.vec3d.scale(a,y/h.vec3d.length(a))}:function(a){return h.vec3d.set3(0,0,y,a)},p)};
for(var n=this;!q.done;)e()}}};f.prototype._renderTileBackground=function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=!0,a.tileRenderer.setBackground(b),a.rootTiles&&u.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b)}))})};f.prototype._updatePrograms=function(){var a="spherical"===this.manifold,b="shader"===this.wireframe.mode;this.programs.color=this.programVariations.color.getProgram([a,
this._hasOverlays,a&&this._velvetOverground,b,this._drawBorders,b||this._drawBorders,this.receiveShadows,this.debugScreenSizePerspective]);this.programs.normal=this.programVariations.normal.getProgram([a,!0]);this.programs.depth=this.programVariations.depth.getProgram([a,!1]);this.programs.depthShadowMap=this.programVariations.depth.getProgram([a,!0]);this.programs.highlight=this.programVariations.highlight.getProgram([a]);this.setNeedsRender()};f.prototype._renderMaterialPass=function(a,b){var c=
this,d=this.isTransparent(),e=a.shadowMap&&a.shadowMap.getEnableState(),f=a.rctx;this.receiveShadows!==e&&(this.receiveShadows=e,this._updatePrograms());e=!this.drapedRenderer.isEmpty();e!==this._hasOverlays&&(this._hasOverlays=e,this._updatePrograms());e=a.camera;f.setDepthTestEnabled(!0);var g=this.wireframe,k=this.programs.color;f.bindProgram(k);k.setUniform1f("opacity",this._opacity);if("shader"===g.mode||this._drawBorders)k.setUniform1f("wireframe.width",this.wireframe.width),k.setUniform1f("wireframe.falloff",
Math.min(g.width,g.falloff)),k.setUniform1f("wireframe.wireOpacity",g.wireOpacity*this._opacity),k.setUniform1f("wireframe.surfaceOpacity",g.surfaceOpacity*this._opacity),k.setUniform4fv("wireframe.color",g.color);a.shadowMap&&a.shadowMap.bind(k);a.ssaoHelper&&a.ssaoHelper.setUniforms(k);k.setUniform1i("tex",0);k.setUniform1i("overlay0Tex",1);k.setUniform1i("overlay1Tex",2);k.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);k.setUniformMatrix4fv("proj",e.projectionMatrix);a.lightingData.helper.setUniforms(k,
!0);f=e.viewMatrix;h.vec3d.set3(f[12],f[13],f[14],ba);h.vec3d.normalize(ba);k.setUniform3fv("viewDirection",ba);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();d?a.offscreenRenderingHelper.renderSeparateAndComposite(function(){return c._renderTiles(a,k,b)},[0,0,0,0],"alpha"):this._renderTiles(a,k,b);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};f.prototype._renderDepthPass=
function(a,b,c){var d=a.rctx,e=a.camera;d.bindProgram(b);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!0);b.setUniformMatrix4fv("model",aa);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);W[0]=e.near;W[1]=e.far;b.setUniform2fv("nearFar",W);this._renderTilesAuxiliary(a,b,c,!1)};f.prototype._renderNormalPass=function(a,b){var c=a.rctx,d=a.camera,e=this.programs.normal;c.bindProgram(e);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);e.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);
this._renderTilesAuxiliary(a,e,b,!1)};f.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);var e=a.offscreenRenderingHelper;c.bindTexture(e.getDepthTexture(),3);d.setUniform1i("depthTex",3);d.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};f.prototype._updatePerOriginTileData=function(){var a=this.perOriginTileData;if(!this.perOriginTileDataDirty)return a;
this.highestVisibleLODTile=null;this._renderCollectOrigins();if(0!==this._renderOrder){for(var b=J(this._renderOrder),c=0;c<a.length;c++)this._sortFrontToBack(a.data[c].tiles,b);b=M(this._renderOrder);this._sortFrontToBack(a,b)}this.perOriginTileDataDirty=!1;return a};f.prototype._renderCollectOrigins=function(){var a=this.perOriginTileData,b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?S:e.centerAtSeaLevel;f.tiles.clear();
this._renderCollectOriginsForRoot(f)}return!0};f.prototype._renderCollectOriginsForRoot=function(a){var b=this.tileIterator,c=this.perOriginTileData;for(b.reset(a.root);!b.done;){var d=b.next(),e=d.renderData;if(e&&!d.visible)this.numTilesCulled++,b.skip();else{var f=c.back();if(7===d.lij[0]){if(f===a||0!==f.tiles.length)f=c.pushNew(),f.tiles.clear();f.root=d;f.origin=d.centerAtSeaLevel}if(e){10<=d.lij[0]?c.back().tiles.push(d):a.tiles.push(d);if(!this.highestVisibleLODTile||d.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=
d;b.skip()}}}};f.prototype._sortFrontToBack=function(a,b){a.sort(b)};f.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swap(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};f.prototype._updateStencilReadStateForTile=function(a,b){if(a.stencilRenderingHelper&&
a.stencilRenderingHelper.getEnableState()){for(var c=this.stencilEnabledLayerExtents,d=!1,e=0;e<c.length;e++)if(b.intersectsExtent(c[e])){d=!0;break}d?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};f.prototype._renderTilesAuxiliary=function(a,b,c,d){var e=a.rctx,f=e.gl,g=a.camera,h=g.viewMatrix;b.setUniformMatrix4fv("proj",g.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",
2));for(g=0;g<c.length;g++){var k=c.data[g];b.setUniform3fv("origin",k.origin);F.bindView(k.origin,h,b);for(var l=0;l<k.tiles.length;l++){var m=k.tiles.data[l],q=m.renderData;d&&(this._bindOverlayTextures(b,q.overlays,!0),b.setUniform1f("overlayOpacity",q.overlayOpacity));this._updateStencilReadStateForTile(a,m);e.bindVAO(q.vao);G.assertCompatibleVertexAttributeLocations(q.vao,b);e.drawElements(f.TRIANGLES,0!==this._skirtScale?q.vao.indexBuffer.size:q.geometryInfo.numWithoutSkirtIndices,q.vao.indexBuffer.indexType,
0)}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};f.prototype._renderTiles=function(a,b,c){var d=a.rctx,e=d.gl,f=a.camera,g=f.viewMatrix;if(this.debugScreenSizePerspective&&this.pointsOfInterest){var k=B.getSettings("spherical"===this.manifold?"global":"local");k.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});F.bindScreenSizePerspective(k,b,"screenSizePerspective")}b.setUniform1f("skirtScale",this._skirtScale);for(f=
0;f<c.length;f++)if(k=c.data[f],b.setUniform3fv("origin",k.origin),F.bindView(k.origin,g,b),a.shadowMap&&a.shadowMap.bindView(b,k.origin),this.numOriginsRendered++,k=k.tiles,0!==k.length){var l="debug"===this.wireframe.mode?e.LINES:e.TRIANGLES,m=this.highestVisibleLODTile,q=void 0,n=void 0;m?(q=m.vlevel,n=this.tileSize/this.wireframe.resolution):(q=16,n=this.tileSize/64);for(m=0;m<k.length;m++){var p=k.data[m],t=p.renderData;this._updateStencilReadStateForTile(a,p);E.trace("# RENDER TILE "+p.lij[0]+
"/"+p.lij[1]+"/"+p.lij[2]+", screenDepth:"+p.screenDepth);var u=t.geometryInfo.uvOffsetAndScale,r=t.texOffsetAndScale;h.vec4d.set4(u[0]*r[2]+r[0],u[1]*r[3]+r[1],u[2]*r[2],u[3]*r[3],K);b.setUniform4fv("texOffsetAndScale",K);d.bindTexture(t.textureReference||t.texture,0);this._bindOverlayTextures(b,t.overlays,!1);b.setUniform1f("overlayOpacity",t.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&b.setUniform1f("wireframe.subdivision",n*(1<<q-p.vlevel));u=0!==this._skirtScale?t.vao.indexBuffer.size:
t.geometryInfo.numWithoutSkirtIndices;d.bindVAO(t.vao);G.assertCompatibleVertexAttributeLocations(t.vao,b);d.drawElements(l,u,t.vao.indexBuffer.indexType,0);p.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=u/3;this._scaleQueriesForTile(p)}}d.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};f.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=c?f.highlightRenderTargetId:f.renderTargetId;
g?(g=this.drapedRenderer.getRenderTargetTexture(g),Q[e]=f.texOffset[0],Q[e+1]=f.texOffset[1],I[e]=f.texScale[0],I[e+1]=f.texScale[1],this.rctx.bindTexture(g,1+d)):(Q[e]=0,Q[e+1]=0,I[e]=0,I[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d))}a.setUniform4fv("overlayTexOffset",Q);a.setUniform4fv("overlayTexScale",I)};f.prototype._updateTileGeometryBuffers=function(a){var b=this.rctx,c=b.gl;a=a.renderData;var d=a.geometryInfo.indices;a.vao=new P(b,x.Default3D,{geometry:v.Pos3Tex},{geometry:L.createVertex(b,
c.STATIC_DRAW,a.geometryInfo.vertexAttributes)},L.createIndex(b,c.STATIC_DRAW,d));this.setNeedsRender()};f.prototype._releaseTileGeometry=function(a){a=a.renderData;a.vao.dispose(!0);a.vao=null;k.releaseGeometry(a.geometryInfo);this.setNeedsRender()};f.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};f.prototype._processScaleRangeQueries=
function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};return f}();var Y={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},ba=h.vec3d.create(),R=h.vec3d.create(),ha=h.vec3d.create(),ea=h.vec3d.create(),ca=h.vec3d.create();return r})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require",
"exports"],function(r,g){return function(){function f(){this._numTileTexturesComposited=0}Object.defineProperty(f.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});f.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};f.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return f}()})},"esri/views/3d/terrain/TileRenderData":function(){define(["require",
"exports","../../../geometry/support/aaBoundingBox","../lib/glMatrix"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function c(){this.overlayTexOffset=a.vec2d.create();this.texOffsetAndScale=a.vec4d.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:f.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:a.vec4d.create()};this.init()}c.prototype.init=function(){var b=this.geometryInfo;
b.indices=null;b.vertexAttributes=null;f.empty(b.boundingBox);b.numSurfaceIndices=0;b.numSkirtIndices=0;b.numWithoutSkirtIndices=0;b.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;a.vec4d.set4(0,0,1,1,this.texOffsetAndScale);if(this.overlays)for(var b=0,c=this.overlays;b<c.length;b++){var e=c[b];e.renderTargetId=null;e.highlightRenderTargetId=null;a.vec2d.set2(1,1,e.texScale);a.vec2d.set2(0,0,e.texOffset)}else for(this.overlays=[null,null],b=0;2>b;b++)this.overlays[b]=
{renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};c.prototype.updateGeometryState=function(a){return this.geometryState=a.geometryState(this.geometryState)};c.prototype.estimateGeometryMemoryUsage=function(){var a=this.geometryInfo;return a.indices.byteLength+a.vertexAttributes.byteLength};return c}();g.TileRenderData=r})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/glMatrix ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){var q=Array(20),m=[0,0];return function(){function g(a,d,e,f,g){this._backgroundTex=null;this.tileSize=256;this._context=a;this.tileSize=d;this._resourceCounter=f;this._setNeedsRender=g;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));d=new Float32Array(20);d[0]=-1;d[1]=-1;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=-1;d[7]=0;d[8]=1;d[9]=0;d[10]=-1;d[11]=1;d[12]=0;d[13]=0;d[14]=1;d[15]=1;d[16]=1;d[17]=0;d[18]=1;d[19]=
1;this._vaoQuad=new k(a,c.Default3D,{geometry:b.Pos3Tex},{geometry:h.createVertex(a,35044,d)});this._blendLayersProgram=e.get("blendLayers")}g.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};g.prototype.updateTileTexture=
function(b){for(var c=a.LayerClass.MAP,d=b.layerInfo[c],e=0;e<d.length;e++)d[e].pendingUpdates&=~a.TileUpdateTypes.UPDATE_TEXTURE;if(b.renderData){var g,e=b.renderData,h,k=0,l=!0;for(h=0;h<d.length;h++){g=d[h];var m=b.parentSurface.layerViewByIndex(h,c);q[h]=m.fullOpacity;if(g.data||g.upsampleFromTile)if(k++,!m.isTransparent){l=!1;break}}h===d.length&&h--;0===k&&this._backgroundTex?(e.textureReference=this._backgroundTex,f.vec4d.set4(0,0,1,1,e.texOffsetAndScale)):1!==k||l?(this._composeMapLayers(b,
d,h,l,q),e.textureReference=null,f.vec4d.set4(0,0,1,1,e.texOffsetAndScale)):(g=d[h],g.data?(c=g,f.vec4d.set4(0,0,1,1,e.texOffsetAndScale)):(b=g.upsampleFromTile,c=b.tile.layerInfo[c][h],f.vec4d.set4(b.offset[0],b.offset[1],b.scale,b.scale,e.texOffsetAndScale)),c&&(c.data instanceof HTMLImageElement&&(c.data=this._buildTexture(c.data)),e.textureReference=c.data));this._setNeedsRender()}};g.prototype.setBackground=function(a){this._backgroundTex=a instanceof HTMLImageElement?this._buildTexture(a):l.createColorTexture(this._context,
a)};g.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if(a instanceof HTMLImageElement)try{d=new t(c,b,a)}catch(C){d=l.createEmptyTexture(c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else b.width=b.height=this.tileSize,d=new t(c,b);c.bindTexture(d);d.generateMipmap();return d};g.prototype._drawVectorData=
function(a,b,c,d,f,g,h,k,l){void 0===l&&(l=1);e(this._context,c,a,b.renderer,b.schemeHelper,c[0],d,f,0,g,h,k,l)};g.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);p.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,p.vertexCount(g,"geometry"))};g.prototype._composeMapLayers=
function(b,c,e,f,g){var h=a.LayerClass.MAP,k=this._context;b.renderData.texture||(b.renderData.texture=this._buildTexture());var l=b.renderData.texture,q=this._fbo;q&&q.width===l.descriptor.width&&q.height===l.descriptor.height||(this._fbo=q=n.create(k,{colorTarget:0,depthStencilTarget:1,width:l.descriptor.width,height:l.descriptor.height}));var p=k.gl;k.bindFramebuffer(q);k.setViewport(0,0,this.tileSize,this.tileSize);k.setClearColor(0,0,0,0);k.setClearDepth(1);k.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);
k.setDepthTestEnabled(!1);k.setBlendFunctionSeparate(1,771,1,771);k.setBlendEquation(32774);k.setBlendingEnabled(!0);var t,u,r;for(f&&this._backgroundTex&&this._drawRasterData(this._backgroundTex,1,m);0<=e;e--)if(f=null,q=c[e],q.data?(f=q,t=m,u=1):q.upsampleFromTile&&(u=q.upsampleFromTile,f=u.tile.layerInfo[h][e],r=u.tile.lij[0],t=u.offset,u=u.scale),f){if(f.data instanceof HTMLImageElement||f.data instanceof HTMLCanvasElement)f.data=this._buildTexture(f.data);f.data instanceof d?(q=b.parentSurface.layerViewByIndex(e,
h),this._drawVectorData(f.data,q,b.lij,l.descriptor.width,l.descriptor.height,u,t,r,g[e])):this._drawRasterData(f.data,u,t,g[e])}k.bindTexture(l);p.copyTexImage2D(k.gl.TEXTURE_2D,0,l.descriptor.pixelFormat,0,0,l.descriptor.width,l.descriptor.height,0);l.generateMipmap();k.bindFramebuffer(null);k.setBlendFunctionSeparate(770,771,1,771);k.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited()};return g}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require",
"exports","dojo/has","../../core/libs/gl-matrix/mat4","../../core/libs/gl-matrix/vec3"],function(r,g,f,a,c){var b={extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(a){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},worldScreenWidth:1,viewpoint:{},toMap:function(a,b,c){return null},toScreen:function(a,b,c){return null},clone:function(){return null},
copy:function(a){return this},toJSON:function(){return null}},l=c.create();return function(c,d,g,n,t,p,k,q,m,u,r,v,y){m=[d[0],d[1],d[2]];for(var e=u;1>e;e*=2)m[0]--,m[1]>>=1,m[2]>>=1;d={context:c,state:b,stationary:!0,pixelRatio:1,displayLevel:t.adjustLevel(p),requiredLevel:t.adjustLevel(d[0]),drawphase:0,renderer:n,layerOpacity:y,painter:null};if(k!==q)throw Error("It is expected that tiles are square!");p=1/u;y=t.getSchemaShift(m,p);e=y[1];g.tileTransform.displayCoord[0]=-1-2*p*r[0]-y[0];g.tileTransform.displayCoord[1]=
1+2*p*(1-r[1]-u)+e;u=g.tileTransform.transform;a.identity(u);t.isWGS84&&512===t.lockedSchemaPixelSize&&(p*=2);0===v&&(p/=2);t=.25*p/k;l.set([t,-t,1]);a.scale(u,u,l);c.setBlendFunctionSeparate(1,771,1,771);c.setClearDepth(1);c.clear(c.gl.DEPTH_BUFFER_BIT);d.state.size=[k,q];d.state.width=k;d.state.height=q;n.setStateParams(d.state,d.pixelRatio,m[0]);g.attach(d);c.setFaceCullingEnabled(!1);c.setDepthFunction(515);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);c.setDepthWriteEnabled(!0);g.processRender(d);
c.setDepthWriteEnabled(!1);c.setBlendingEnabled(!0);d.drawphase=1;g.processRender(d);d.drawphase=2;g.processRender(d);f("esri-vector-tiles-debug")&&n.renderTileInfo(c,g);c.setDepthWriteEnabled(!0);c.setDepthTestEnabled(!1);c.setFaceCullingEnabled(!0)}})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(r){var g={create:function(){var f=new r.ARRAY_TYPE(3);f[0]=0;f[1]=0;f[2]=0;return f},clone:function(f){var a=new r.ARRAY_TYPE(3);a[0]=f[0];a[1]=f[1];a[2]=f[2];return a},fromValues:function(f,
a,c){var b=new r.ARRAY_TYPE(3);b[0]=f;b[1]=a;b[2]=c;return b},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f},set:function(f,a,c,b){f[0]=a;f[1]=c;f[2]=b;return f},add:function(f,a,c){f[0]=a[0]+c[0];f[1]=a[1]+c[1];f[2]=a[2]+c[2];return f},subtract:function(f,a,c){f[0]=a[0]-c[0];f[1]=a[1]-c[1];f[2]=a[2]-c[2];return f}};g.sub=g.subtract;g.multiply=function(f,a,c){f[0]=a[0]*c[0];f[1]=a[1]*c[1];f[2]=a[2]*c[2];return f};g.mul=g.multiply;g.divide=function(f,a,c){f[0]=a[0]/c[0];f[1]=a[1]/c[1];
f[2]=a[2]/c[2];return f};g.div=g.divide;g.ceil=function(f,a){f[0]=Math.ceil(a[0]);f[1]=Math.ceil(a[1]);f[2]=Math.ceil(a[2]);return f};g.floor=function(f,a){f[0]=Math.floor(a[0]);f[1]=Math.floor(a[1]);f[2]=Math.floor(a[2]);return f};g.min=function(f,a,c){f[0]=Math.min(a[0],c[0]);f[1]=Math.min(a[1],c[1]);f[2]=Math.min(a[2],c[2]);return f};g.max=function(f,a,c){f[0]=Math.max(a[0],c[0]);f[1]=Math.max(a[1],c[1]);f[2]=Math.max(a[2],c[2]);return f};g.round=function(f,a){f[0]=Math.round(a[0]);f[1]=Math.round(a[1]);
f[2]=Math.round(a[2]);return f};g.scale=function(f,a,c){f[0]=a[0]*c;f[1]=a[1]*c;f[2]=a[2]*c;return f};g.scaleAndAdd=function(f,a,c,b){f[0]=a[0]+c[0]*b;f[1]=a[1]+c[1]*b;f[2]=a[2]+c[2]*b;return f};g.distance=function(f,a){var c=a[0]-f[0],b=a[1]-f[1];f=a[2]-f[2];return Math.sqrt(c*c+b*b+f*f)};g.dist=g.distance;g.squaredDistance=function(f,a){var c=a[0]-f[0],b=a[1]-f[1];f=a[2]-f[2];return c*c+b*b+f*f};g.sqrDist=g.squaredDistance;g.length=function(f){var a=f[0],c=f[1];f=f[2];return Math.sqrt(a*a+c*c+f*
f)};g.len=g.length;g.squaredLength=function(f){var a=f[0],c=f[1];f=f[2];return a*a+c*c+f*f};g.sqrLen=g.squaredLength;g.negate=function(f,a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};g.inverse=function(f,a){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];return f};g.normalize=function(f,a){var c=a[0],b=a[1],g=a[2],c=c*c+b*b+g*g;0<c&&(c=1/Math.sqrt(c),f[0]=a[0]*c,f[1]=a[1]*c,f[2]=a[2]*c);return f};g.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]};g.cross=function(f,a,c){var b=a[0],g=a[1];a=a[2];var e=
c[0],d=c[1];c=c[2];f[0]=g*c-a*d;f[1]=a*e-b*c;f[2]=b*d-g*e;return f};g.lerp=function(f,a,c,b){var g=a[0],e=a[1];a=a[2];f[0]=g+b*(c[0]-g);f[1]=e+b*(c[1]-e);f[2]=a+b*(c[2]-a);return f};g.hermite=function(f,a,c,b,g,e){var d=e*e,h=d*(2*e-3)+1,l=d*(e-2)+e,t=d*(e-1);e=d*(3-2*e);f[0]=a[0]*h+c[0]*l+b[0]*t+g[0]*e;f[1]=a[1]*h+c[1]*l+b[1]*t+g[1]*e;f[2]=a[2]*h+c[2]*l+b[2]*t+g[2]*e;return f};g.bezier=function(f,a,c,b,g,e){var d=1-e,h=d*d,l=e*e,t=h*d,h=3*e*h,d=3*l*d;e*=l;f[0]=a[0]*t+c[0]*h+b[0]*d+g[0]*e;f[1]=a[1]*
t+c[1]*h+b[1]*d+g[1]*e;f[2]=a[2]*t+c[2]*h+b[2]*d+g[2]*e;return f};g.random=function(f,a){a=a||1;var c=2*r.RANDOM()*Math.PI,b=2*r.RANDOM()-1,g=Math.sqrt(1-b*b)*a;f[0]=Math.cos(c)*g;f[1]=Math.sin(c)*g;f[2]=b*a;return f};g.transformMat4=function(f,a,c){var b=a[0],g=a[1];a=a[2];var e=c[3]*b+c[7]*g+c[11]*a+c[15],e=e||1;f[0]=(c[0]*b+c[4]*g+c[8]*a+c[12])/e;f[1]=(c[1]*b+c[5]*g+c[9]*a+c[13])/e;f[2]=(c[2]*b+c[6]*g+c[10]*a+c[14])/e;return f};g.transformMat3=function(f,a,c){var b=a[0],g=a[1];a=a[2];f[0]=b*c[0]+
g*c[3]+a*c[6];f[1]=b*c[1]+g*c[4]+a*c[7];f[2]=b*c[2]+g*c[5]+a*c[8];return f};g.transformQuat=function(f,a,c){var b=a[0],g=a[1],e=a[2];a=c[0];var d=c[1],h=c[2];c=c[3];var n=c*b+d*e-h*g,t=c*g+h*b-a*e,p=c*e+a*g-d*b,b=-a*b-d*g-h*e;f[0]=n*c+b*-a+t*-h-p*-d;f[1]=t*c+b*-d+p*-a-n*-h;f[2]=p*c+b*-h+n*-d-t*-a;return f};g.rotateX=function(f,a,c,b){var g=[],e=[];g[0]=a[0]-c[0];g[1]=a[1]-c[1];g[2]=a[2]-c[2];e[0]=g[0];e[1]=g[1]*Math.cos(b)-g[2]*Math.sin(b);e[2]=g[1]*Math.sin(b)+g[2]*Math.cos(b);f[0]=e[0]+c[0];f[1]=
e[1]+c[1];f[2]=e[2]+c[2];return f};g.rotateY=function(f,a,c,b){var g=[],e=[];g[0]=a[0]-c[0];g[1]=a[1]-c[1];g[2]=a[2]-c[2];e[0]=g[2]*Math.sin(b)+g[0]*Math.cos(b);e[1]=g[1];e[2]=g[2]*Math.cos(b)-g[0]*Math.sin(b);f[0]=e[0]+c[0];f[1]=e[1]+c[1];f[2]=e[2]+c[2];return f};g.rotateZ=function(f,a,c,b){var g=[],e=[];g[0]=a[0]-c[0];g[1]=a[1]-c[1];g[2]=a[2]-c[2];e[0]=g[0]*Math.cos(b)-g[1]*Math.sin(b);e[1]=g[0]*Math.sin(b)+g[1]*Math.cos(b);e[2]=g[2];f[0]=e[0]+c[0];f[1]=e[1]+c[1];f[2]=e[2]+c[2];return f};g.forEach=
function(){var f=g.create();return function(a,c,b,g,e,d){c||(c=3);b||(b=0);for(g=g?Math.min(g*c+b,a.length):a.length;b<g;b+=c)f[0]=a[b],f[1]=a[b+1],f[2]=a[b+2],e(f,f,d),a[b]=f[0],a[b+1]=f[1],a[b+2]=f[2];return a}}();g.angle=function(f,a){f=g.fromValues(f[0],f[1],f[2]);a=g.fromValues(a[0],a[1],a[2]);g.normalize(f,f);g.normalize(a,a);a=g.dot(f,a);return 1<a?0:Math.acos(a)};g.str=function(f){return"vec3("+f[0]+", "+f[1]+", "+f[2]+")"};g.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===
a[2]};g.equals=function(f,a){var c=f[0],b=f[1];f=f[2];var g=a[0],e=a[1];a=a[2];return Math.abs(c-g)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(b-e)<=r.EPSILON*Math.max(1,Math.abs(b),Math.abs(e))&&Math.abs(f-a)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return g})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(r,g,f,a){return function(){function c(a){this.parent=null;this.lij=a;this.layerInfo=Array(f.LayerClass.LAYER_CLASS_COUNT)}
c.prototype.tileDataAvailable=function(a,c,e){return(c=this.layerInfo[e][c].tilemap)?"unavailable"!==c.getAvailability(a.lij[1],a.lij[2]):!0};c.prototype.modifyLayers=function(b,c,e){b=c.length;for(var d=this.layerInfo[e],f=Array(b),g=0;g<b;g++){var l=c[g];f[g]=-1<l?d[l]:new a(e)}this.layerInfo[e]=f};return c}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/sniff"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});
g.check=function(){var c=null;a("esri-webgl")?a("esri-webgl-major-performance-caveat")?c=new f("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check if your GPU is blacklisted."):a("esri-webgl-high-precision-fragment")?a("esri-webgl-vertex-shader-samplers")?a("esri-webgl-element-index-uint")||(c=new f("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.")):c=new f("webgl:vertex-shader-samplers-required",
"WebGL support for vertex shader samplers is required but not supported."):c=new f("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):c=new f("webgl:required","WebGL is required but not supported.");return c}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(r,g,f,a,c,b){return function(b){function e(a){a=b.call(this)||this;a.components=["attribution","zoom","navigation-toggle","compass"];return a}f(e,b);a([c.property()],e.prototype,"components",void 0);return e=a([c.subclass("esri.views.ui.3d.DefaultUI3D")],e)}(c.declared(b))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-geometry ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){return function(d){function g(a){a=d.call(this)||this;a._defaultPositionLookup=null;a.components=[];return a}f(g,d);g.prototype.initialize=function(){this._handles.add([b.init(this,"components",this._componentsWatcher.bind(this)),b.init(this,"view",this._updateViewAwareWidgets.bind(this))])};g.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=c.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right",
"navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":"top-right"}}return this._defaultPositionLookup[a]};g.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};g.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};g.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};
g.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};g.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._findComponentPosition(a))})};g.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new e({id:a,node:b})};g.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===
a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};g.prototype._createAttribution=function(){return new h({view:this.view})};g.prototype._createCompass=function(){return new n({view:this.view})};g.prototype._createNavigationToggle=function(){return new t({view:this.view})};g.prototype._createZoom=function(){return new p({view:this.view})};a([l.property()],g.prototype,"components",void 0);return g=a([l.subclass("esri.views.ui.DefaultUI")],
g)}(l.declared(d))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b,l,e){return function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.widget=null;return a}f(g,d);g.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(g.prototype,
"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&b.add(a,"esri-component"),c&&b.remove(c,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});g.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),c.byId(a);a&&
"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([e.property()],g.prototype,"id",null);a([e.property()],g.prototype,"node",null);a([e.cast("node")],g.prototype,"castNode",null);a([e.property({readOnly:!0})],g.prototype,"widget",void 0);return g=a([e.subclass("esri.views.ui.Component")],g)}(e.declared(l))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k){function q(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(k)||!("component"in a||"index"in a||"position"in a)?null:a}var m={left:0,top:0,bottom:0,right:0},u={bottom:30,top:15,right:15,left:15};return function(d){function g(){var a=d.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new n;a._componentToKey=new Map;a.view=null;a._initContainers();return a}a(g,d);g.prototype.initialize=
function(){this._handles.add([t.init(this,"view.padding, container",this._applyViewPadding.bind(this)),t.init(this,"padding",this._applyUIPadding.bind(this))])};g.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(g.prototype,"container",{set:function(a){var c=this._get("container");a!==c&&(a&&(b.add(a,"esri-ui"),this._attachContainers(a)),
c&&(b.remove(c,"esri-ui"),e.set(c,{top:"",bottom:"",left:"",right:""}),l.empty(c)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},
enumerable:!0,configurable:!0});g.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:f({},u,a)};Object.defineProperty(g.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});g.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var f=q(a);f&&(d=f.index,b=f.position,a=f.component,
e=f.key);b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(k)||(a=new k({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};g.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};g.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!b.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};g.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=q(a)||q(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};g.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(k)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};g.prototype._getViewPadding=function(){return this.get("view.padding")||
m};g.prototype._attachContainers=function(a){l.place(this._manualContainer,a);l.place(this._innerContainer,a)};g.prototype._initContainers=function(){var a=l.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=l.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=l.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=l.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),e=l.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),g=l.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":e,"bottom-right":g};this._positionNameToContainerLookup=f({manual:b},this._cornerNameToContainerLookup)};g.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};g.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];
var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};g.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup&&a.widget.startup();l.place(a.node,b,c)};g.prototype._applyViewPadding=
function(){var a=this.container;a&&e.set(a,this._toPxPosition(this._getViewPadding()))};g.prototype._applyUIPadding=function(){this._innerContainer&&e.set(this._innerContainer,this._toPxPosition(this.padding))};g.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};g.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};g.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=
d===a)&&(b=d);return c});return b};g.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};g.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};c([p.property()],g.prototype,"container",null);c([p.property({dependsOn:["view.height"]})],g.prototype,"height",null);c([p.property({value:u})],g.prototype,"padding",null);c([p.cast("padding")],g.prototype,"castPadding",
null);c([p.property()],g.prototype,"view",void 0);c([p.property({dependsOn:["view.width"]})],g.prototype,"width",null);return g=c([p.subclass("esri.views.ui.UI")],g)}(p.declared(d,h))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(r,g,
f,a,c,b,l,e,d,h){return function(e){function g(a){a=e.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=c.widgetLabel;a.view=null;a.viewModel=new d;return a}f(g,e);g.prototype.postInitialize=function(){var a=this;this.own(b.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(g.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});g.prototype.render=function(){var a=(b={},b["esri-attribution--open"]=this._isOpen,b);return h.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",a),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),h.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",h.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:"esri-attribution__link"},
"Esri")));var b};g.prototype._renderSourcesNode=function(){var a=this._isOpen,b=this._isInteractive(),c=b?0:-1,d=this.attributionText,e=b?"button":void 0,a=(f={},f["esri-attribution__sources--open"]=a,f["esri-interactive"]=b,f);return h.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",a),innerHTML:d,role:e,tabIndex:c});var f};g.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};g.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};g.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};g.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
a([l.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),h.renderable()],g.prototype,"attributionText",null);a([l.property()],g.prototype,"iconClass",void 0);a([l.property(),h.renderable()],g.prototype,"itemDelimiter",void 0);a([l.property()],g.prototype,"label",void 0);a([l.aliasOf("viewModel.view")],g.prototype,"view",void 0);a([l.property({type:d}),h.renderable(["state","view.size"])],g.prototype,"viewModel",void 0);a([h.accessibleHandler()],g.prototype,"_toggleState",
null);return g=a([l.subclass("esri.widgets.Attribution")],g)}(l.declared(e))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/lang ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/support/webMercatorUtils".split(" "),function(r,g,f,a,c,b,l,e,d,h,n,t){return function(c){function g(a){a=
c.call(this,a)||this;a._handles=new l;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new b;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}f(g,c);g.prototype.initialize=function(){this._handles.add(d.init(this,"view",this._viewWatcher))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,
configurable:!0});g.prototype._viewWatcher=function(a){var b=this,c=this._handles;c&&c.remove();a&&(c.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){c.remove(a.uid)}),b._updateAttributionItems())}),d.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};g.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(d.init(a,"suspended",b._updateAttributionItems),
a.uid)})};g.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(!d.hasAttributionData){if(c=d.get("copyright")){var e=a._findItem(b,{layer:d,text:c});e||b.push({text:c,layer:d})}}else if(d&&d.tileInfo){var f=a._attributionDataByLayerId;if(f[d.uid]){if(c=a._getDynamicAttribution(f[d.uid],a.view,d))(e=a._findItem(b,{layer:d,text:c}))||b.push({text:c,layer:d})}else{var g=a._pendingAttributionItemsByLayerId;a._inProgress(g[d.uid])||
(g[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete g[d.uid];f[d.uid]=b;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};g.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};g.prototype._inProgress=function(a){return a&&!a.isFulfilled()};g.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&
a.get("layer.attributionVisible")})};g.prototype._findItem=function(a,b){var c=b.layer,d=b.text,e;a.some(function(a){var b=a.layer===c&&a.text===d;b&&(e=a);return b});return e};g.prototype._isBingLayer=function(a){return"bing-maps"===a.type};g.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;a.forEach(function(a,d){var f=a.coverageAreas;f&&f.forEach(function(f){var g=f.bbox,h=f.zoomMin-(b&&f.zoomMin?1:0),k=f.zoomMax-(b&&f.zoomMax?1:0);a={extent:t.geographicToWebMercator(new n({xmin:g[1],
ymin:g[0],xmax:g[3],ymax:g[2]})),attribution:a.attribution||"",score:e.isDefined(f.score)?f.score:100,id:d};for(f=h;f<=k;f++)c[f]=c[f]||[],c[f].push(a)})});c.maxKey=Math.max.apply(null,Object.keys(c));return c};g.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;b=c.tileInfo.scaleToZoom(b.scale);b=Math.min(a.maxKey,Math.round(b));if(!d||!e.isDefined(b)||-1>=b)return"";a=a[b];var f=d.center.clone().normalize(),g={};return a.filter(function(a){var b=!g[a.id]&&a.extent.contains(f);b&&(g[a.id]=
!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};a([h.property({readOnly:!0,type:b})],g.prototype,"items",void 0);a([h.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a([h.property()],g.prototype,"view",void 0);return g=a([h.subclass("esri.widgets.Attribution.AttributionViewModel")],g)}(h.declared(c))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(r,g,f,a,c,b,l,e,d){return function(g){function h(a){a=g.call(this)||this;a.activeMode=null;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=c.widgetLabel;a.modes=null;a.view=null;a.viewModel=new e;return a}f(h,g);h.prototype.reset=function(){};h.prototype.render=function(){var a=this.viewModel.orientation,b=this.viewModel.state,e="disabled"===b,f="compass"===("rotation"===b?"rotation":"compass"),b=e?-1:0,e=(g={},g["esri-disabled"]=e,g["esri-compass--active"]="device-orientation"===
this.viewModel.activeMode,g["esri-interactive"]=!e,g),g=(h={},h["esri-icon-compass"]=f,h["esri-icon-dial"]=!f,h);return d.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",e),onclick:this._start,onkeydown:this._start,role:"button",tabIndex:b,"aria-label":c.reset,title:c.reset},d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",g),styles:this._toRotationTransform(a)}),d.tsx("span",{class:"esri-icon-font-fallback-text"},c.reset));var g,h};
h.prototype._start=function(){var a=this.viewModel;a.nextMode();a.startMode()};h.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([b.aliasOf("viewModel.activeMode")],h.prototype,"activeMode",void 0);a([b.aliasOf("viewModel.goToOverride")],h.prototype,"goToOverride",void 0);a([b.property()],h.prototype,"iconClass",void 0);a([b.property()],h.prototype,"label",void 0);a([b.aliasOf("viewModel.modes")],h.prototype,"modes",void 0);a([b.aliasOf("viewModel.view")],h.prototype,
"view",void 0);a([b.property({type:e}),d.renderable(["viewModel.orientation","viewModel.state"])],h.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.reset")],h.prototype,"reset",null);a([d.accessibleHandler()],h.prototype,"_start",null);return h=a([b.subclass("esri.widgets.Compass")],h)}(b.declared(l))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n){var t=l.getLogger("esri.widgets.CompassViewModel");return function(c){function g(a){a=c.call(this,a)||this;a._handles=new b;a._eventType=a._getDeviceOrientationEventType();a.canUseHeading=!1;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);a._updateViewHeading=a._updateViewHeading.bind(a);a._checkHeadingSupport=a._checkHeadingSupport.bind(a);
a._canUseHeading();return a}f(g,c);g.prototype.initialize=function(){this._handles.add(d.init(this,"view",this._updateRotationWatcher))};g.prototype.destroy=function(){this._removeCheckHeadingListener();this._removeOrientationListener();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"activeMode",{get:function(){var a=this._get("activeMode");return a?a:(a=this.modes)?a[0]:"none"},set:function(a){this.stopMode();this._override("activeMode",a);void 0===a&&this._clearOverride("activeMode")},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"modes",{get:function(){return this._get("modes")||["reset"]},set:function(a){this._set("modes",a);void 0===a&&this._clearOverride("modes")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?
this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});g.prototype.previousMode=function(){var a=this.modes;2>a.length||(a=a.indexOf(this.activeMode),this._paginateMode(a-1))};g.prototype.nextMode=function(){var a=this.modes;2>a.length||(a=a.indexOf(this.activeMode),this._paginateMode(a+1))};g.prototype.startMode=function(){var a=this.activeMode;"reset"===a&&this.reset();"device-orientation"===a&&(this._removeOrientationListener(),this._addOrientationListener())};g.prototype.stopMode=
function(){"device-orientation"===this.activeMode&&this._removeOrientationListener()};g.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};g.prototype._getDeviceOrientationEventType=function(){if("ondeviceorientationabsolute"in window)return"deviceorientationabsolute";if("ondeviceorientation"in window)return"deviceorientation"};g.prototype._paginateMode=function(a){var b=this.modes;this.activeMode=b[(a+b.length)%
b.length]};g.prototype._supportsHeading=function(a){var b=a.absolute,c=a.alpha;return"number"===typeof a.webkitCompassHeading||!!b&&"number"===typeof c};g.prototype._getHeading=function(a){var b=a.alpha,c=a.webkitCompassHeading;if(c)return c;if(a.absolute&&"number"===typeof b)return b};g.prototype._removeCheckHeadingListener=function(){var a=this._eventType;a&&window.removeEventListener(a,this._checkHeadingSupport)};g.prototype._checkHeadingSupport=function(a){this._supportsHeading(a)&&this._set("canUseHeading",
!0);this._removeCheckHeadingListener()};g.prototype._canUseHeading=function(){var a=this,b=this._eventType;b&&(window.addEventListener(b,this._checkHeadingSupport),e.after(500).then(function(){a._removeCheckHeadingListener()}))};g.prototype._getHeadingAdjustment=function(a,b){if("orientation"in window){b=window.orientation;if("number"!==typeof b)return a;a+=b;return 360<a?a-360:0>a?a+360:a}return a};g.prototype._updateViewHeading=function(a){var b=this.view,c=this._getHeading(a);!b||!b.stationary||
"number"!==typeof c||0>c||360<c||(a=this._getHeadingAdjustment(c,a),"3d"===b.type&&(c=b.camera.clone(),c.heading=a,b.camera=c),"2d"===b.type&&(b.rotation=a))};g.prototype._removeOrientationListener=function(){this.canUseHeading&&window.removeEventListener(this._eventType,this._updateViewHeading)};g.prototype._addOrientationListener=function(){var a=this._eventType,b=this.canShowNorth;this.canUseHeading?b?window.addEventListener(a,this._updateViewHeading):t.warn("device-orientation mode requires 'canShowNorth' to be true"):
t.warn("The deviceorientation event is not supported in this browser")};g.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};g.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};g.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(d.init(this,"view.rotation",this._updateForRotation)):this._handles.add(d.init(this,"view.camera",this._updateForCamera)))};a([h.property({dependsOn:["modes"]})],
g.prototype,"activeMode",null);a([h.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],g.prototype,"canShowNorth",null);a([h.property({readOnly:!0})],g.prototype,"canUseHeading",void 0);a([h.property({dependsOn:["canUseHeading"]})],g.prototype,"modes",null);a([h.property()],g.prototype,"orientation",void 0);a([h.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],g.prototype,"state",null);a([h.property()],g.prototype,"view",void 0);
a([h.property()],g.prototype,"previousMode",null);a([h.property()],g.prototype,"nextMode",null);a([h.property()],g.prototype,"startMode",null);a([h.property()],g.prototype,"stopMode",null);a([h.property()],g.prototype,"reset",null);return g=a([h.subclass("esri.widgets.CompassViewModel")],g)}(h.declared(c,n))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(r,g,f,a,c,b,l,e,d){return function(g){function h(a){a=g.call(this)||this;a.iconClass="esri-icon-pan2";a.label=c.widgetLabel;a.view=null;a.viewModel=new e;return a}f(h,g);Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});h.prototype.toggle=function(){};h.prototype.render=function(){var a="disabled"===this.get("viewModel.state"),b="pan"===this.get("viewModel.navigationMode"),e=(f={},f["esri-disabled"]=
a,f["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,f),f=(g={},g["esri-navigation-toggle__button--active"]=b,g),b=(h={},h["esri-navigation-toggle__button--active"]=!b,h),a=a?-1:0;return d.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",e),onclick:this._toggle,onkeydown:this._toggle,tabIndex:a,"aria-label":c.toggle,title:c.toggle},d.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
f)},d.tsx("span",{class:"esri-icon-pan"})),d.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},d.tsx("span",{class:"esri-icon-rotate"})));var f,g,h};h.prototype._toggle=function(){this.toggle()};a([b.property()],h.prototype,"iconClass",void 0);a([b.property()],h.prototype,"label",void 0);a([b.property({value:"vertical"}),d.renderable()],h.prototype,"layout",null);a([b.aliasOf("viewModel.view"),d.renderable()],h.prototype,
"view",void 0);a([b.property({type:e}),d.renderable(["viewModel.state","viewModel.navigationMode"])],h.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.toggle")],h.prototype,"toggle",null);a([d.accessibleHandler()],h.prototype,"_toggle",null);return h=a([b.subclass("esri.widgets.NavigationToggle")],h)}(b.declared(l))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b,l,e){return function(c){function d(a){a=c.call(this,a)||this;a._handles=new b;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}f(d,c);d.prototype.initialize=function(){this._handles.add(l.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};d.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});d.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};d.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([e.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);a([e.property()],d.prototype,"navigationMode",void 0);a([e.property()],d.prototype,"view",void 0);
a([e.property()],d.prototype,"toggle",null);return d=a([e.subclass("esri.widgets.NavigationToggleViewModel")],d)}(e.declared(c))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(r,g,f,a,c,b,l,e,d,h){return function(g){function l(a){a=g.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";
a.label=c.widgetLabel;a.view=null;a.viewModel=new d;return a}f(l,g);l.prototype.postInitialize=function(){this._zoomInButton=new e({action:this.zoomIn,iconClass:"esri-icon-plus",title:c.zoomIn});this._zoomOutButton=new e({action:this.zoomOut,iconClass:"esri-icon-minus",title:c.zoomOut})};Object.defineProperty(l.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});l.prototype.render=function(){var a=this.viewModel,b=(c={},c["esri-zoom--horizontal"]=
"horizontal"===this.layout,c);this._zoomInButton.enabled="ready"===a.state&&a.canZoomIn;this._zoomOutButton.enabled="ready"===a.state&&a.canZoomOut;return h.tsx("div",{class:this.classes("esri-zoom esri-widget",b)},this._zoomInButton.render(),this._zoomOutButton.render());var c};l.prototype.zoomIn=function(){};l.prototype.zoomOut=function(){};a([b.property()],l.prototype,"iconClass",void 0);a([b.property()],l.prototype,"label",void 0);a([b.property({value:"vertical"}),h.renderable()],l.prototype,
"layout",null);a([b.aliasOf("viewModel.view"),h.renderable()],l.prototype,"view",void 0);a([b.property({type:d}),h.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],l.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.zoomIn")],l.prototype,"zoomIn",null);a([b.aliasOf("viewModel.zoomOut")],l.prototype,"zoomOut",null);return l=a([b.subclass("esri.widgets.Zoom")],l)}(b.declared(l))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(r,g,f,a,c,b,l){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}f(d,b);d.prototype.render=function(){var a=this.enabled?0:-1,b=(c={},c["esri-disabled"]=!this.enabled,c["esri-interactive"]=this.enabled,c),c=(d={},d[this.iconClass]=!!this.iconClass,d);return l.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",b),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:a,
title:this.title},l.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",c)}),l.tsx("span",{class:"esri-icon-font-fallback-text"},this.title));var c,d};d.prototype._triggerAction=function(){this.action.call(this)};a([c.property()],d.prototype,"action",void 0);a([c.property(),l.renderable()],d.prototype,"enabled",void 0);a([c.property({readOnly:!1}),l.renderable()],d.prototype,"iconClass",void 0);a([c.property(),l.renderable()],d.prototype,"title",void 0);a([l.accessibleHandler()],
d.prototype,"_triggerAction",null);return d=a([c.subclass("esri.widgets.IconButton")],d)}(c.declared(b))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(r,g,f,a,c,b,l,e){return function(c){function d(a){a=c.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}f(d,c);d.prototype.destroy=function(){this.view=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new l({view:a}):"3d"===a.type&&(this._zoomConditions=new e):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});d.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};d.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};d.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};a([b.property()],d.prototype,"_zoomConditions",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],d.prototype,"canZoomIn",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],d.prototype,"canZoomOut",
void 0);a([b.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);a([b.property()],d.prototype,"view",null);a([b.property()],d.prototype,"zoomIn",null);a([b.property()],d.prototype,"zoomOut",null);return d=a([b.subclass("esri.widgets.Zoom.ZoomViewModel")],d)}(b.declared(c))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){return function(c){function e(){return null!==c&&c.apply(this,arguments)||this}f(e,c);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canZoomOut",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");return 0===b||a<b},enumerable:!0,configurable:!0});a([b.property({dependsOn:["view.ready",
"view.scale"],readOnly:!0})],e.prototype,"canZoomIn",null);a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],e.prototype,"canZoomOut",null);a([b.property()],e.prototype,"view",void 0);return e=a([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],e)}(b.declared(c))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){return function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}f(e,c);a([b.property({readOnly:!0})],e.prototype,"canZoomIn",void 0);a([b.property({readOnly:!0})],e.prototype,"canZoomOut",void 0);return e=a([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],e)}(b.declared(c))})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/has dojo/errors/CancelError dojo/promise/all ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/support/aaBoundingBox ../../../layers/IntegratedMeshLayer ../../../layers/SceneLayer ../../../views/3d/layers/SceneLayerView3D ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../views/3d/lib/glMatrix ../../../views/3d/support/projectionUtils ../../../views/3d/support/PromiseLightweight ../../../views/3d/support/ResourceController".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J,M){function O(a,b){return a.length===b.length&&a.every(function(a){return 0<=aa(b,a.name)})}function aa(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}var V=t.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");r=function(e){function g(a){a=e.call(this)||this;a.nodeIndex={};a.screenSizeFactor=0;a.updating=!0;a.updatingPercentage=0;a._lodFactorProperty=null;a._lodTargetFactor=
1;a._isIdle=!1;a._cameraDirty=!0;a._hasFeatures=!1;a._alwaysLoadEverythingModeEnabled=!1;a._uncompressedTextureDownsamplingEnabled=!1;a._processLambda=null;a._featureTarget=5E4;a._featureMargin=1.5;a._loadingNodes=new Map;a._updatingNodes=new Map;a._progressMaxNumNodes=1;a._poi=null;a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=null;a._handles=new n;a._idleQueue=new L.IdleQueue;a._errorCount=0;return a}f(g,e);
Object.defineProperty(g.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(M.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer instanceof A&&
this.layer.definitionExpression)try{var a=x.create(this.layer.definitionExpression);if(!a.isStandardized())return V.error("definitionExpression is using non standard function"),null;var b=[],c=a.getFields();H.findFieldsCaseInsensitive(c,this.layer.fields,{missingFields:b});return 0<b.length?(V.error("definitionExpression references unknown fields: "+b.join(", ")),null):a}catch(T){return V.error("Failed to parse definitionExpression: "+T),null}else return null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return H.findFieldsCaseInsensitive(a,this._fields)}return null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"crsVertex",{get:function(){return H.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"crsIndex",{get:function(){return H.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):!0},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return a._needsAnimationFrameHandler()},idleFrame:function(b){return a._processLogError(b)},idleBegin:function(){a._updateIdleState(!0)},idleEnd:function(){a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended=
{idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=new D(this.layerViewRequiredFunctions,this.layerViewOptionalFunctions,function(){return a.updatingChanged()});this.layerView._controller=this;var b=this.layer;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this._rootNodeUrl=b.store.rootNode;var d=this._rootNodeUrl.split("/");this._rootNodeId=d[d.length-1];this.disableCache=c("disable-feature:idb-cache");b instanceof A?("mesh"===b.geometryType?this._lodFactorProperty=
"qualitySettings.sceneService.3dObject.lodFactor":"point"===b.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),this._fields=b.fields,this._attributeStorageInfo=b.attributeStorageInfo):b instanceof y&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");b=l([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var b=a.layerView.view;a.setClippingArea(b.clippingArea);a._centerOnSurface=
b.pointsOfInterest.centerOnSurfaceFrequent;a._handles.add(a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}));var c=a.layerView.view.resourceController;c.memoryEvents.on("quality-changed",function(){return a._setCameraDirty()});var d=!1;a._processLambda=a._frame.bind(a);a._handles.add(m.init(a.layerView,"suspended",function(b){d&&(c.deregisterIdleFrameWorker(a),a.restartNodeLoading());b?(c.registerIdleFrameWorker(a,a.updateEventListenerWhileSuspended),c.deregisterFrameWorker(a._processLambda)):
(c.registerIdleFrameWorker(a,a.updateEventListener),c.registerFrameWorker(a._processLambda));d=!0}),"layerview");a._handles.add(a.layer.watch("elevationInfo",function(b){return a._elevationInfoChanged(b)}),"layer");a.layerView instanceof C&&a._handles.add([m.init(a.layerView,"alwaysLoadEverythingModeEnabled",function(b){a._alwaysLoadEverythingModeEnabled=b;a.restartNodeLoading()}),m.init(a.layerView,"uncompressedTextureDownsamplingEnabled",function(b){a._uncompressedTextureDownsamplingEnabled=b;a.restartNodeLoading()})],
"layer");a._handles.add(b.state.watch("camera",function(){return a._setCameraDirty()}));a._lodFactorProperty&&a._handles.add(a.layerView.view.watch(a._lodFactorProperty,function(){return a._setCameraDirty()}),"quality")}});this.addResolvingPromise(b);this.when(function(){return a._startNodeLoading()})};g.prototype.destroy=function(){this.layerView.view.resourceController.deregisterIdleFrameWorker(this);this.layerView.view.resourceController.deregisterFrameWorker(this._processLambda);this._handles.destroy();
this._nodeLoader=null};g.prototype._getRequiredAttributes=function(){if(!(null!=this._attributeStorageInfo&&this.layer instanceof A&&this._fields))return[];var a=Object.create(null);this.layer.renderer&&this.layer.renderer.collectRequiredFields(a);this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(b){b._collectRequiredFields(a)});if(null!=this.definitionExpressionFields)for(var b=0,c=this.definitionExpressionFields;b<c.length;b++)a[c[b]]=!0;var d=this._attributeStorageInfo,
e=this._fields,f=this.layer.objectIdField;return Object.keys(a).map(function(a){var b=aa(d,a);a=aa(e,a);return 0<=b&&0<=a?{index:b,name:e[a].name,field:e[a],attributeStorageInfo:d[b]}:null}).filter(function(a){return null!=a&&a.name!==f}).sort(function(a,b){return b.index-a.index}).filter(function(a,b,c){return 0===b||c[b-1].index!==a.index})};g.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};g.prototype._labelingChanged=function(){var a=this._requiredAttributes,
b=this._getRequiredAttributes();O(a,b)||this._requiredFieldsChange()};g.prototype.setClippingArea=function(a){var b=v.create();P.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};g.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI(),
this._index.requestReload())))};g.prototype._calculatePointOfInterest=function(a){void 0===a&&(a=G.vec3d.create());var b=this._centerOnSurface.renderLocation,c=G.vec3d.create();G.vec3d.subtract(b,this.camPos,c);G.vec3d.normalize(c);var d=this.layerView.view.renderCoordsHelper,e=G.vec3d.create();d.worldUpAtPosition(b,e);c=Math.acos(G.vec3d.dot(e,c))-.5*Math.PI;G.vec3d.lerp(this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))),a);return a};g.prototype.updateClippingArea=function(a){this.setClippingArea(a);
this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};g.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.updatingChanged()};g.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};g.prototype.updateElevationChanged=function(a,b,c){H.findIntersectingNodes(a,b,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(a){c.push(a)});for(a=0;a<c.length;a++)b=c.data[a],this._viewportQueries.invalidateCache(b.id),b.id===this._rootNodeId&&
this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()};g.prototype._elevationInfoChanged=function(a){this._viewportQueries.invalidateCache();this._initViewData()};g.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};g.prototype.schedule=function(a){return this._idleQueue.push(a)};g.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0};g.prototype._needsAnimationFrameHandler=
function(){return!0};g.prototype._frame=function(a){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty);this.layerView.visible&&this._processLogError(a,!1)};g.prototype._processLogError=function(a,b){void 0===b&&(b=!0);try{this._process(a,b)}catch(K){50>this._errorCount?V.error("Error during processing: "+K):50===this._errorCount&&V.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};g.prototype._process=function(a,
b){this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateViewData();this._processIndex()&&(b=!1);for(b=this._processNodes(a,b);0<this._idleQueue.length()&&(b||!a.done());)b=!1,this._idleQueue.process();b=this._index;(!b.isLoading()||b.getNumFeatures()>2*this._featureTarget)&&this._updateTargetLOD();a.done()||this._prefetchIndex();this.updatingChanged();this._lodHandling.lodGlobalHandling()}};g.prototype._processIndex=
function(){var a=Math.min(10-this._index.getNumLoading(),this._getAvailableLoadTokens(1)),b=Math.min(5-this._loadingNodes.size,this._getAvailableLoadTokens(2));this._index.update(a,b,d.keysOfMap(this._loadingNodes));return this._index.load()};g.prototype._prefetchIndex=function(){if(!(0<this._loadingNodes.size)){var a=Math.min(10-this._index.getNumLoading(),this._getAvailableLoadTokens(1));this._index.prefetch(a)}};g.prototype._updateTargetLOD=function(){var a=this._index.getFeatureEstimate();if(a.estimate){var b=
this._featureTarget*this._getLodFactor()*this._getLodMemoryFactor()/this._lodTargetFactor;if(b/a.estimate>this._featureMargin&&1E4>this._lodTargetFactor){if(a.leafsReached)return;var c=this._lodTargetFactor;this._lodTargetFactor*=1+.1*(b/a.estimate-1);this._viewportQueries.updateScreenSpaceErrorBias(this._getLodFactor()*this._getLodMemoryFactor());this._index.requestReload();this._index.update(0,0,d.keysOfMap(this._loadingNodes));a=this._index.getFeatureEstimate();a.estimate&&a.estimate/b>this._featureMargin&&
(this._lodTargetFactor=c)}else if(a.estimate/b>this._featureMargin&&1E-4<this._lodTargetFactor)this._lodTargetFactor/=1+.1*(a.estimate/b-1);else return;this._viewportQueries.updateScreenSpaceErrorBias(this._getLodFactor()*this._getLodMemoryFactor());this._index.requestReload()}};g.prototype._processNodes=function(a,b){var c=this,d=Math.min(5-this._loadingNodes.size,this._getAvailableLoadTokens(2)),d=this._index.getUpdates(d);d.cancel.forEach(this._cancelNodeIdLoading,this);d.update.forEach(function(d){if(b||
!a.done())b=!1,c._updateLoadedNode(d.id)});d.add.forEach(function(d,e){if(b||!a.done())b=!1,c._loadNode(c.nodeIndex[e])});return b};g.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.forEach(function(b,c){return a._cancelNodeIdLoading(c)});this._loadingNodes.clear();this._updatingNodes.forEach(function(b,c){return a._updatingNodes.get(c).cancel()});this._updatingNodes.clear()};g.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.get(a).cancel();this._loadingNodes.delete(a)};
g.prototype._getAvailableLoadTokens=function(a){return Math.floor((12-1*this._index.getNumLoading()-2*this._loadingNodes.size)/a)};g.prototype.updatingChanged=function(){var a=this._index?this._index.getNumPending():0,b=this._index?this._index.getNumUnloadedNodes():0,a=a+3*b+2*this._loadingNodes.size,b=!(!(0<a||0<this._updatingNodes.size||this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length()||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&
this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};g.prototype._initViewData=function(){var a=this.layerView.view,b=a.state.camera,c=a.renderCoordsHelper;this.camPos=G.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest();
var d=(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this._getLodMemoryFactor();this._viewportQueries=new F(this.crsIndex,c,b,this._poi,this._clippingArea,a.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,d),screenspaceErrorBias:d,angleDependentLoD:.5>d,disableLod:this._alwaysLoadEverythingModeEnabled});this._cameraDirty=!1;this.notifyChange("rootNodeVisible")};g.prototype._updateViewData=function(){if(this._cameraDirty&&
this._index){var a=this.layerView.view,b=a.state.camera;this.camPos=G.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.updatePointOfInterest(this._poi);a=this._getLodFactor()*this._getLodMemoryFactor();this._viewportQueries.updateScreenSpaceErrorBias(a);this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI();
this._index.requestReload();this._alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes();this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};g.prototype._getProgressiveLoadFactor=function(a,b){return a instanceof A&&"mesh"===a.geometryType?(a=1<=b&&c("enable-feature:progressive-3dobject"))?S.factor3dObject:1:a instanceof y?(a=1<=b&&!c("disable-feature:progressive-im"))?S.factorIM:1:1};g.prototype._getLodFactor=function(){return this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||
1};g.prototype._getLodMemoryFactor=function(){return this.layerView.view.resourceController.memoryFactor*this._lodTargetFactor};g.prototype._getLodDropFactor=function(){return Math.min(this._getLodMemoryFactor(),.5)/.5};g.prototype.getFeatureDetail=function(){return this._lodTargetFactor};g.prototype.getNumUnloadedNodes=function(){return this._index?this._index.getNumUnloadedNodes():0};g.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData();this._alwaysLoadEverythingModeEnabled&&
this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()};g.prototype.isGeometryVisible=function(a){return this._viewportQueries.isGeometryVisible(a)};g.prototype._shouldLoadNode=function(a){if(!this._lodHandling.shouldLoadNode(a))return!1;var b=this._getLodDropFactor();return 0<b&&0<this._viewportQueries.maxDistance&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.distToPOI(a)>this._viewportQueries.maxDistance*b?!1:a.obb?this._viewportQueries.isGeometryVisible(a):
!0};g.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();null!=this.layerViewOptionalFunctions.getLoadedAttributes&&this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return a._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),
this.layer.watch("labelsVisible",function(){return a._labelingChanged()}),this.layer.watch("labelingInfo",function(){return a._labelingChanged()})],"requiredAttributes"));var b=this.layerViewOptionalFunctions.textureOptions,c=E.TextureFormat.Normal;b&&b.useCompressedTextures?c=E.TextureFormat.Compressed:this._uncompressedTextureDownsamplingEnabled&&(c=E.TextureFormat.Downsampled);b=this._defaultGeometrySchema;this._nodeLoader=new E(this.streamDataSupplier,V,b,this._requiredAttributes,{textureFormat:c,
loadTextureData:this.layerView instanceof C&&this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==b||null==b.ordering});c=S.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new B(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,c,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,V,function(b){return a.layerViewRequiredFunctions.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._needsUpdate(b)});this._alwaysLoadEverythingModeEnabled||
this._removeInvisibleNodes();this._lodHandling.startNodeLoading(function(b){return a._viewportQueries.isNodeVisible(b)},function(b){return a._viewportQueries.isGeometryVisible(b)},function(b){return a._index.nodeTraversalState(b)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.layerViewOptionalFunctions.additionalStartNodeLoadingHandler&&this.layerViewOptionalFunctions.additionalStartNodeLoadingHandler();this.updatingChanged()}};g.prototype.isNodeLoading=function(){return null!=
this._nodeLoader&&null!=this._index};g.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._index.cancel(),this._nodeLoader.cancel(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._poi=this._index=this._nodeLoader=null,this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler&&this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler(),this.updatingChanged())};g.prototype._removeInvisibleNodes=function(){var a=this.layerViewRequiredFunctions.getLoadedNodeIDs(),
b=this._getLodDropFactor(),c=this._viewportQueries.maxDistance*b,b=0<b&&0<c;N.clear();for(var d=0;d<a.length;d++){var e=this.nodeIndex[a[d]];if(!this._viewportQueries.isGeometryVisible(e)||b&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.distToPOI(e)>c)this._lodHandling.setLodGlobalDirty(),N.push(e)}this.layerViewRequiredFunctions.removeNodeData(N);N.clear()};g.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;var b=
this.layerViewOptionalFunctions.getLoadedAttributes;a=null!=b?b(a):void 0;return null!=a&&a!==this._requiredAttributes};g.prototype._updateLoadedNode=function(a){var c=this,d=this.nodeIndex[a],e=d.baseUrl,f=this.layerViewOptionalFunctions.getLoadedAttributes(d),e=O(f,this._requiredAttributes)?q.resolve(this.layerViewOptionalFunctions.getAttributeData(d)):this._nodeLoader.loadAttributes(d,e,this._requiredAttributes);this._updatingNodes.set(a,e);e.then(function(a){return c.schedule().then(function(){return c.layerViewOptionalFunctions.setAttributeData(d,
c._requiredAttributes,a)})}).catch(function(a){a instanceof b||c.layerViewOptionalFunctions.setAttributeData(d,c._requiredAttributes,{})}).always(function(){c._updatingNodes.delete(a);c.updatingChanged()});this.updatingChanged()};g.prototype._loadNode=function(a){var b=this,c=new J.Promise;this._loadingNodes.set(a.id,c);this.updatingChanged();this._loadAndAddBundle(a).always(function(){b._loadingNodes.delete(a.id);b._hasFeatures=b._hasFeatures||!!a.numFeatures;b.updatingChanged();c.done()});return c};
g.prototype._loadAndAddBundle=function(a){var c=this;1!==a.featureData.length&&V.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");return this._loadCached(a).then(function(b){if(!b)return c._loadUncached(a)}).catch(function(d){if(!(d instanceof b))return c._loadUncached(a)})};g.prototype._loadCached=function(a){var b=this,c=this.disableCache?null:this.layerViewOptionalFunctions.loadCachedNodeData,d=this.disableCache?null:this.layerViewOptionalFunctions.addCachedNodeData;
return c&&d?this.schedule().then(function(){return c(a,function(a,c){return b._nodeLoader.loadTextures(a,c)})}).then(function(c){if(null==c)return!1;var e=b._requiredAttributes;return b.schedule().then(function(){return b._nodeLoader.loadAttributes(a,a.baseUrl,e)}).then(function(a){return b.schedule({loadedAttributes:e,attributeData:a})}).then(function(b){return d(a,c,b)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);return!0})}):q.resolve(!1)};g.prototype._loadUncached=function(a){var c=
this;return this.schedule().then(function(){return c._nodeLoader.loadBundleData(a,0)}).then(function(a){return c.schedule(a)}).then(function(b){return c.layerViewRequiredFunctions.addNodeData(a,b)}).then(function(){return c._lodHandling.lodSwapBundleLoaded(a)}).catch(function(c){c instanceof b||(V.error("Failed to load node '"+a.id+"' bundle 0: "+c),a.failed=!0)})};g.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),
this.updatingChanged())};a([u.property({readOnly:!0})],g.prototype,"isMeshPyramid",null);a([u.property({readOnly:!0})],g.prototype,"streamDataSupplier",null);a([u.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],g.prototype,"parsedDefinitionExpression",null);a([u.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],g.prototype,"definitionExpressionFields",null);a([u.property({readOnly:!0})],g.prototype,"crsVertex",null);a([u.property({readOnly:!0})],g.prototype,"crsIndex",
null);a([u.property({readOnly:!0})],g.prototype,"nodeIndex",void 0);a([u.property()],g.prototype,"camPos",void 0);a([u.property()],g.prototype,"screenSizeFactor",void 0);a([u.property()],g.prototype,"layerView",void 0);a([u.property()],g.prototype,"layerViewRequiredFunctions",void 0);a([u.property()],g.prototype,"layerViewOptionalFunctions",void 0);a([u.property()],g.prototype,"layer",void 0);a([u.property({readOnly:!0})],g.prototype,"updating",void 0);a([u.property({readOnly:!0})],g.prototype,"updatingPercentage",
void 0);a([u.property({readOnly:!0})],g.prototype,"rootNodeVisible",null);return g=a([u.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],g)}(u.declared(e,k,h));var N=new p,S={factorIM:.2,factor3dObject:.05,distancePenalty:10};return r})},"esri/core/sql/WhereClause":function(){define(["require","exports","../../moment","./StandardizedFunctions","./WhereGrammar"],function(r,g,f,a,c){function b(a){return Array.isArray(a)?a:[a]}function l(a){return null!==a?!0!==a:null}function e(a,
b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function d(a,b,c){if(null==a)return null;for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function h(a){return a instanceof Date?a.valueOf():a}function n(a,b,
c){if(null==b||null==c)return null;b=h(b);c=h(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function t(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}return function(){function g(){this.parameters=this.parseTree=null}g.create=function(a){var b=new g;b.parseTree=c.WhereGrammar.parse(a);return b};g.prototype.isStandardized=
function(){var b=!0;this.visitAll(this.parseTree,function(c){b&&"function"===c.type&&(b=a.isStandardized(c.name,c.args.value.length))});return b};g.prototype.setVariablesDictionary=function(a){this.parameters=a};g.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};g.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)};g.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});
return t(a)};g.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(b){"column_ref"===b.type&&a.push(b.column)});return t(a)};g.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return t(a)};g.prototype.featureValue=function(a,b,c){a=a&&"object"===typeof a.attributes?a.attributes:a;var d=a[b];if(void 0!==d)return d;for(var e in a)if(b.toLowerCase()===e.toLowerCase())return c.column=e,a[e];
return null};g.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,
b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};g.prototype.evaluateNode=function(c,g){switch(c.type){case "case_expression":if("simple"===c.format)for(var k=h(this.evaluateNode(c.operand,g)),q=0;q<c.clauses.length;q++){if(k===h(this.evaluateNode(c.clauses[q].operand,g)))return this.evaluateNode(c.clauses[q].value,g)}else for(q=0;q<c.clauses.length;q++)if(!0===this.evaluateNode(c.clauses[q].operand,g))return this.evaluateNode(c.clauses[q].value,g);return null!==c.else?
this.evaluateNode(c.else,g):null;case "param":return this.parameters[c.value.toLowerCase()];case "expr_list":k=[];q=0;for(c=c.value;q<c.length;q++){var p=c[q];k.push(this.evaluateNode(p,g))}return k;case "unary_expr":return l(this.evaluateNode(c.expr,g));case "binary_expr":switch(c.operator){case "AND":return k=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,g),null!=k&&null!=g?!0===k&&!0===g:!1===k||!1===g?!1:null;case "OR":return k=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,
g),null!=k&&null!=g?!0===k||!0===g:!0===k||!0===g?!0:null;case "IS":if("null"!==c.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(c.left,g);case "ISNOT":if("null"!==c.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(c.left,g);case "IN":return k=b(this.evaluateNode(c.right,g)),e(this.evaluateNode(c.left,g),k);case "NOT IN":return k=b(this.evaluateNode(c.right,g)),l(e(this.evaluateNode(c.left,g),k));case "BETWEEN":return k=this.evaluateNode(c.left,
g),g=this.evaluateNode(c.right,g),null==k||null==g[0]||null==g[1]?null:k>=g[0]&&k<=g[1];case "NOTBETWEEN":return k=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,g),null==k||null==g[0]||null==g[1]?null:k<g[0]||k>g[1];case "LIKE":return d(this.evaluateNode(c.left,g),this.evaluateNode(c.right,g),c.escape);case "NOT LIKE":return l(d(this.evaluateNode(c.left,g),this.evaluateNode(c.right,g),c.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return n(c.operator,
this.evaluateNode(c.left,g),this.evaluateNode(c.right,g));case "*":return this.evaluateNode(c.left,g)*this.evaluateNode(c.right,g);case "-":return this.evaluateNode(c.left,g)-this.evaluateNode(c.right,g);case "+":return this.evaluateNode(c.left,g)+this.evaluateNode(c.right,g);case "/":return this.evaluateNode(c.left,g)/this.evaluateNode(c.right,g)}throw Error("Not Supported Operator "+c.operator);case "null":case "bool":case "string":case "number":return c.value;case "date":return f(c.value,["YYYY-M-D"]).toDate();
case "timestamp":return f(c.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===c.column.toUpperCase()?(p=new Date,p.setHours(0,0,0,0),p):"CURRENT_TIMESTAMP"===c.column.toUpperCase()?new Date:this.featureValue(g,c.column,c);case "function":return g=this.evaluateNode(c.args,g),a.evaluateFunction(c.name,g)}throw Error("Unsupported sql syntax "+c.type);};return g}()})},"esri/core/sql/StandardizedFunctions":function(){define(["require",
"exports","dojo/regexp"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});g.evaluateFunction=function(c,b){var f=a[c.toLowerCase()];if(null==f)throw Error("Function Not Recognised");if(b.length<f.minParams||b.length>f.maxParams)throw Error("Invalid Parameter count for call to "+c.toUpperCase());return f.evaluate(b)};g.isStandardized=function(c,b){c=a[c.toLowerCase()];return null!=c&&b>=c.minParams&&b<=c.maxParams};var a={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=
a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],c=a[1];return null==b||null==c?null:b.toString().substring(c-1)}if(3===a.length)return b=
a[0],c=a[1],a=a[2],null==b||null==c||null==a?null:0>=a?"":b.toString().substring(c-1,c+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,c=b?a[1]:" ",b=b?a[2]:a[1];if(null==c||null==b)return null;c="("+f.escapeString(c)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+c+"*|"+c+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+c+"*",
"g"),"");case "TRAILING":return b.replace(new RegExp(c+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?
Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",c=0;c<a.length;c++){if(null==a[c])return null;b+=a[c].toString()}return b}},lower:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(){}a.parse=function(a){return f.parse(a)};return a}();g.WhereGrammar=r})},"esri/core/sql/sql92grammar":function(){define([],function(){function r(g,
f,a,c){this.message=g;this.expected=f;this.found=a;this.location=c;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}(function(g,f){function a(){this.constructor=g}a.prototype=f.prototype;g.prototype=new a})(r,Error);r.buildMessage=function(g,f){function a(a){return a.charCodeAt(0).toString(16).toUpperCase()}function c(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function b(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}var l={literal:function(a){return'"'+c(a.text)+'"'},"class":function(a){var c=
"",e;for(e=0;e<a.parts.length;e++)c+=a.parts[e]instanceof Array?b(a.parts[e][0])+"-"+b(a.parts[e][1]):b(a.parts[e]);return"["+(a.inverted?"^":"")+c+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var e=c,f;f=a[c];f=l[f.type](f);b[e]=f}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];
case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(g)+" but "+(f?'"'+c(f)+'"':"end of input")+" found."};return{SyntaxError:r,parse:function(g,f){function a(a,b){return{type:"literal",text:a,ignoreCase:b}}function c(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function b(a){var b=Na[a],c;if(!b){for(c=a-1;!Na[c];)c--;b=Na[c];for(b={line:b.line,column:b.column};c<a;)10===g.charCodeAt(c)?(b.line++,b.column=1):b.column++,c++;Na[a]=b}return b}
function l(a,c){var d=b(a),e=b(c);return{start:{offset:a,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function e(a){z<ta||(z>ta&&(ta=z,lb=[]),lb.push(a))}function d(){var a,b,c;a=z;b=U();b!==w?(b=n(),b!==w?(c=U(),c!==w?a=b:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function h(){var a,b,c,d,e,f,g,h;a=z;b=n();if(b!==w){c=[];d=z;e=U();e!==w?(f=da(),f!==w?(g=U(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=U(),e!==w?
(f=da(),f!==w?(g=U(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);if(c!==w){a={type:"expr_list"};b=[b];for(d=0;d<c.length;d++)b.push(c[d][3]);a.value=b}else z=a,a=w}else z=a,a=w;return a}function n(){var a,b,c,d,e,f,g,h;a=z;b=t();if(b!==w){c=[];d=z;e=U();e!==w?(f=T(),f!==w?(g=U(),g!==w?(h=t(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=U(),e!==w?(f=T(),f!==w?(g=U(),g!==w?(h=t(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):
(z=d,d=w)):(z=d,d=w);c!==w?a=b=ia(b,c):(z=a,a=w)}else z=a,a=w;return a}function t(){var a,b,c,d,e,f,g,h;a=z;b=p();if(b!==w){c=[];d=z;e=U();e!==w?(f=K(),f!==w?(g=U(),g!==w?(h=p(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=U(),e!==w?(f=K(),f!==w?(g=U(),g!==w?(h=p(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=ia(b,c):(z=a,a=w)}else z=a,a=w;return a}function p(){var a,b,c,d,f;a=z;b=I();b===w&&(b=z,33===g.charCodeAt(z)?(c=Pa,
z++):(c=w,0===Z&&e(ya)),c!==w?(d=z,Z++,61===g.charCodeAt(z)?(f=Fa,z++):(f=w,0===Z&&e(xa)),Z--,f===w?d=void 0:(z=d,d=w),d!==w?b=c=[c,d]:(z=b,b=w)):(z=b,b=w));b!==w?(c=U(),c!==w?(d=p(),d!==w?a=b={type:"unary_expr",operator:"NOT",expr:d}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);if(a===w)if(a=z,b=u(),b!==w)if(c=U(),c!==w){var l,n,t;c=[];d=z;f=U();f!==w?(l=k(),l!==w?(n=U(),n!==w?(t=u(),t!==w?d=f=[f,l,n,t]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);if(d!==w)for(;d!==w;)c.push(d),d=z,f=U(),f!==w?(l=k(),l!==w?(n=
U(),n!==w?(t=u(),t!==w?d=f=[f,l,n,t]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);else c=w;c!==w&&(c={type:"arithmetic",tail:c});c===w&&(c=z,d=m(),d!==w?(f=U(),f!==w?(f=ga(),f!==w?(f=U(),f!==w?(f=h(),f!==w?(l=U(),l!==w?(l=ka(),l!==w?c=d={op:d,right:f}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w),c===w&&(c=z,d=m(),d!==w?(f=U(),f!==w?(f=ga(),f!==w?(f=U(),f!==w?(f=ka(),f!==w?c=d={op:d,right:{type:"expr_list",value:[]}}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w),
c===w&&(c=z,d=m(),d!==w?(f=U(),f!==w?(f=H(),f!==w?c=d={op:d,right:f}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w))),c===w&&(c=z,f=I(),f!==w?(d=U(),d!==w?(d=Y(),d!==w?(l=U(),l!==w?(l=u(),l!==w?(n=U(),n!==w?(n=K(),n!==w?(f=U(),f!==w?(f=u(),f!==w?c=f={op:"NOT"+d,right:{type:"expr_list",value:[l,f]}}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w),c===w&&(c=z,f=Y(),f!==w?(d=U(),d!==w?(d=u(),d!==w?(l=U(),l!==w?(l=K(),l!==w?(n=U(),n!==w?(n=u(),n!==w?c=f={op:f,right:{type:"expr_list",
value:[d,n]}}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)),c===w&&(c=z,d=X(),d!==w?(f=U(),f!==w?(f=I(),f!==w?(f=U(),f!==w?(f=u(),f!==w?c=d={op:d+"NOT",right:f}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w),c===w&&(c=z,d=X(),d!==w?(f=U(),f!==w?(f=u(),f!==w?c=d={op:d,right:f}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)),c===w&&(c=z,d=q(),d!==w?(f=U(),f!==w?(f=L(),f!==w?(l=U(),l!==w?(l=z,g.substr(z,6).toLowerCase()===dd?(n=g.substr(z,6),z+=6):(n=w,0===Z&&e(ed)),n!==w?(n=z,
Z++,t=D(),Z--,t===w?n=void 0:(z=n,n=w),n!==w?l="ESCAPE":(z=l,l=w)):(z=l,l=w),l!==w?(l=U(),l!==w?(l=G(),l!==w?c=d={op:d,right:f,escape:l.value}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w)):(z=c,c=w),c===w&&(c=z,d=q(),d!==w?(f=U(),f!==w?(f=L(),f!==w?c=d={op:d,right:f,escape:""}:(z=c,c=w)):(z=c,c=w)):(z=c,c=w))))));c===w&&(c=null);c!==w?(a=b,b=c,""==b||void 0==b||null==b?b=a:(c=null,b=c="arithmetic"==b.type?ia(a,b.tail):sa(b.op,a,b.right,b.escape)),a=b):(z=a,a=w)}else z=a,a=w;else z=
a,a=w;return a}function k(){var a;g.substr(z,2)===Ga?(a=Ga,z+=2):(a=w,0===Z&&e(Qa));a===w&&(62===g.charCodeAt(z)?(a=La,z++):(a=w,0===Z&&e(tb)),a===w&&(g.substr(z,2)===Ra?(a=Ra,z+=2):(a=w,0===Z&&e(Ma)),a===w&&(g.substr(z,2)===za?(a=za,z+=2):(a=w,0===Z&&e(Sa)),a===w&&(60===g.charCodeAt(z)?(a=Mb,z++):(a=w,0===Z&&e(ib)),a===w&&(61===g.charCodeAt(z)?(a=Fa,z++):(a=w,0===Z&&e(xa)),a===w&&(g.substr(z,2)===Ha?(a=Ha,z+=2):(a=w,0===Z&&e(Ob))))))));return a}function q(){var a,b,c,d;a=a=z;b=I();b!==w?(c=U(),c!==
w?(d=Q(),d!==w?a=b=[b,c,d]:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);a!==w&&(a=a[0]+" "+a[2]);a===w&&(a=Q());return a}function m(){var a,b,c,d;a=a=z;b=I();b!==w?(c=U(),c!==w?(d=W(),d!==w?a=b=[b,c,d]:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);a!==w&&(a=a[0]+" "+a[2]);a===w&&(a=W());return a}function u(){var a,b,c,d,e,f,g,h;a=z;b=v();if(b!==w){c=[];d=z;e=U();e!==w?(f=x(),f!==w?(g=U(),g!==w?(h=v(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=U(),e!==w?(f=x(),f!==w?(g=U(),g!==
w?(h=v(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=ia(b,c):(z=a,a=w)}else z=a,a=w;return a}function x(){var a;43===g.charCodeAt(z)?(a=oa,z++):(a=w,0===Z&&e(ub));a===w&&(45===g.charCodeAt(z)?(a=vb,z++):(a=w,0===Z&&e(wb)));return a}function v(){var a,b,c,d,e,f,g,h;a=z;b=A();if(b!==w){c=[];d=z;e=U();e!==w?(f=y(),f!==w?(g=U(),g!==w?(h=A(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=U(),e!==w?(f=y(),f!==w?(g=U(),g!==w?(h=A(),
h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=ia(b,c):(z=a,a=w)}else z=a,a=w;return a}function y(){var a;42===g.charCodeAt(z)?(a=Nb,z++):(a=w,0===Z&&e(xb));a===w&&(47===g.charCodeAt(z)?(a=Pb,z++):(a=w,0===Z&&e(Qb)));return a}function A(){var a,b,c,d,f,k,l;l=G();if(l===w){var m,q,p,t;m=z;var u,r,v,x;u=z;r=O();r!==w?(v=aa(),v!==w?(x=V(),x!==w?u=r=parseFloat(r+v+x):(z=u,u=w)):(z=u,u=w)):(z=u,u=w);u===w&&(u=z,r=O(),r!==w?(v=aa(),v!==w?u=r=parseFloat(r+v):(z=u,u=w)):(z=u,u=w),
u===w&&(u=z,r=O(),r!==w?(v=V(),v!==w?u=r=parseFloat(r+v):(z=u,u=w)):(z=u,u=w),u===w&&(u=z,r=O(),r!==w&&(r=parseFloat(r)),u=r)));q=u;q!==w?(p=z,Z++,t=B(),Z--,t===w?p=void 0:(z=p,p=w),p!==w?m=q={type:"number",value:q}:(z=m,m=w)):(z=m,m=w);l=m;if(l===w){var y,A;y=z;var I,Ra,K,Q;I=z;g.substr(z,4).toLowerCase()===fd?(Ra=g.substr(z,4),z+=4):(Ra=w,0===Z&&e(gd));Ra!==w?(K=z,Z++,Q=D(),Z--,Q===w?K=void 0:(z=K,K=w),K!==w?I=Ra=[Ra,K]:(z=I,I=w)):(z=I,I=w);A=I;A!==w&&(A={type:"bool",value:!0});y=A;if(y===w){y=
z;var Ma,Fa,T,Y;Ma=z;g.substr(z,5).toLowerCase()===hd?(Fa=g.substr(z,5),z+=5):(Fa=w,0===Z&&e(id));Fa!==w?(T=z,Z++,Y=D(),Z--,Y===w?T=void 0:(z=T,T=w),T!==w?Ma=Fa=[Fa,T]:(z=Ma,Ma=w)):(z=Ma,Ma=w);A=Ma;A!==w&&(A={type:"bool",value:!1});y=A}l=y;if(l===w){var N,za,X,Sa,S;za=z;g.substr(z,4).toLowerCase()===jd?(X=g.substr(z,4),z+=4):(X=w,0===Z&&e(kd));X!==w?(Sa=z,Z++,S=D(),Z--,S===w?Sa=void 0:(z=Sa,Sa=w),Sa!==w?za=X=[X,Sa]:(z=za,za=w)):(z=za,za=w);N=za;N!==w&&(N={type:"null",value:null});l=N;if(l===w){var xa,
tb,Mb,ya;xa=z;var Ha,ib,ca,Ga;Ha=z;g.substr(z,4).toLowerCase()===ld?(ib=g.substr(z,4),z+=4):(ib=w,0===Z&&e(md));ib!==w?(ca=z,Z++,Ga=D(),Z--,Ga===w?ca=void 0:(z=ca,ca=w),ca!==w?Ha=ib="DATE":(z=Ha,Ha=w)):(z=Ha,Ha=w);tb=Ha;tb!==w?(Mb=U(),Mb!==w?(ya=L(),ya!==w?xa=tb={type:"date",value:ya.value}:(z=xa,xa=w)):(z=xa,xa=w)):(z=xa,xa=w);l=xa;if(l===w){var da,fa,Ob,Qa;da=z;var La,ia,la,Nb;La=z;g.substr(z,9).toLowerCase()===nd?(ia=g.substr(z,9),z+=9):(ia=w,0===Z&&e(od));ia!==w?(la=z,Z++,Nb=D(),Z--,Nb===w?la=
void 0:(z=la,la=w),la!==w?La=ia="TIMESTAMP":(z=La,La=w)):(z=La,La=w);fa=La;fa!==w?(Ob=U(),Ob!==w?(Qa=L(),Qa!==w?da=fa={type:"timestamp",value:Qa.value}:(z=da,da=w)):(z=da,da=w)):(z=da,da=w);l=da}}}}}a=l;if(a===w){var oa,xb,Pb,wb,sa,qa,vb,ub,ua,yb,Qb,Sb;oa=z;var ta,gb,Ja,lc;ta=z;g.substr(z,7).toLowerCase()===pd?(gb=g.substr(z,7),z+=7):(gb=w,0===Z&&e(qd));gb!==w?(Ja=z,Z++,lc=D(),Z--,lc===w?Ja=void 0:(z=Ja,Ja=w),Ja!==w?ta=gb="EXTRACT":(z=ta,ta=w)):(z=ta,ta=w);xb=ta;if(xb!==w)if(Pb=U(),Pb!==w)if(wb=ga(),
wb!==w)if(sa=U(),sa!==w){var Aa,Ka,Pa,fb,Kb;Ka=z;g.substr(z,4).toLowerCase()===rd?(Pa=g.substr(z,4),z+=4):(Pa=w,0===Z&&e(sd));Pa!==w?(fb=z,Z++,Kb=D(),Z--,Kb===w?fb=void 0:(z=fb,fb=w),fb!==w?Ka=Pa="YEAR":(z=Ka,Ka=w)):(z=Ka,Ka=w);Aa=Ka;if(Aa===w){var Wa,hb,Va,mc;Wa=z;g.substr(z,5).toLowerCase()===td?(hb=g.substr(z,5),z+=5):(hb=w,0===Z&&e(ud));hb!==w?(Va=z,Z++,mc=D(),Z--,mc===w?Va=void 0:(z=Va,Va=w),Va!==w?Wa=hb="MONTH":(z=Wa,Wa=w)):(z=Wa,Wa=w);Aa=Wa;if(Aa===w){var Xa,kb,eb,kc;Xa=z;g.substr(z,3).toLowerCase()===
vd?(kb=g.substr(z,3),z+=3):(kb=w,0===Z&&e(wd));kb!==w?(eb=z,Z++,kc=D(),Z--,kc===w?eb=void 0:(z=eb,eb=w),eb!==w?Xa=kb="DAY":(z=Xa,Xa=w)):(z=Xa,Xa=w);Aa=Xa;if(Aa===w){var Ya,jb,zb,Rb;Ya=z;g.substr(z,4).toLowerCase()===xd?(jb=g.substr(z,4),z+=4):(jb=w,0===Z&&e(yd));jb!==w?(zb=z,Z++,Rb=D(),Z--,Rb===w?zb=void 0:(z=zb,zb=w),zb!==w?Ya=jb="HOUR":(z=Ya,Ya=w)):(z=Ya,Ya=w);Aa=Ya;if(Aa===w){var Za,Na,Ab,Lb;Za=z;g.substr(z,6).toLowerCase()===zd?(Na=g.substr(z,6),z+=6):(Na=w,0===Z&&e(Ad));Na!==w?(Ab=z,Z++,Lb=D(),
Z--,Lb===w?Ab=void 0:(z=Ab,Ab=w),Ab!==w?Za=Na="MINUTE":(z=Za,Za=w)):(z=Za,Za=w);Aa=Za;if(Aa===w){var $a,Oa,Bb,lb;$a=z;g.substr(z,6).toLowerCase()===Bd?(Oa=g.substr(z,6),z+=6):(Oa=w,0===Z&&e(Cd));Oa!==w?(Bb=z,Z++,lb=D(),Z--,lb===w?Bb=void 0:(z=Bb,Bb=w),Bb!==w?$a=Oa="SECOND":(z=$a,$a=w)):(z=$a,$a=w);Aa=$a}}}}}qa=Aa;qa!==w?(vb=U(),vb!==w?(ub=ba(),ub!==w?(ua=U(),ua!==w?(yb=n(),yb!==w?(Qb=U(),Qb!==w?(Sb=ka(),Sb!==w?oa=xb={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:qa},
yb]}}:(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)}else z=oa,oa=w;else z=oa,oa=w;else z=oa,oa=w;else z=oa,oa=w;a=oa;if(a===w){var pa,nc,wc,xc,yc,Tb,zc,Ac,Bc,Ub,Cc,wa,mb,oc,pc,qc;pa=z;var ab,Vb,Cb,Dc;ab=z;g.substr(z,9).toLowerCase()===Dd?(Vb=g.substr(z,9),z+=9):(Vb=w,0===Z&&e(Ed));Vb!==w?(Cb=z,Z++,Dc=D(),Z--,Dc===w?Cb=void 0:(z=Cb,Cb=w),Cb!==w?ab=Vb="SUBSTRING":(z=ab,ab=w)):(z=ab,ab=w);nc=ab;if(nc!==w)if(wc=U(),wc!==w)if(xc=ga(),xc!==w)if(yc=U(),yc!==w)if(Tb=
n(),Tb!==w)if(zc=U(),zc!==w)if(Ac=ba(),Ac!==w)if(Bc=U(),Bc!==w)if(Ub=n(),Ub!==w)if(Cc=U(),Cc!==w){wa=z;var bb,Wb,Db,Ec;bb=z;g.substr(z,3).toLowerCase()===Fd?(Wb=g.substr(z,3),z+=3):(Wb=w,0===Z&&e(Gd));Wb!==w?(Db=z,Z++,Ec=D(),Z--,Ec===w?Db=void 0:(z=Db,Db=w),Db!==w?bb=Wb="FOR":(z=bb,bb=w)):(z=bb,bb=w);mb=bb;mb!==w?(oc=U(),oc!==w?(pc=n(),pc!==w?(qc=U(),qc!==w?wa=mb=[mb,oc,pc,qc]:(z=wa,wa=w)):(z=wa,wa=w)):(z=wa,wa=w)):(z=wa,wa=w);wa===w&&(wa=null);wa!==w?(mb=ka(),mb!==w?pa=nc={type:"function",name:"substring",
args:{type:"expr_list",value:wa?[Tb,Ub,wa[2]]:[Tb,Ub]}}:(z=pa,pa=w)):(z=pa,pa=w)}else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;a=pa;if(a===w){var ja,nb,Xb,Yb,Zb,Ba,$b,ob,ac,bc,Fc,rc,Gc,Hc;ja=z;nb=R();nb!==w?(Xb=U(),Xb!==w?(Yb=ga(),Yb!==w?(Zb=U(),Zb!==w?(Ba=F(),Ba===w&&(Ba=null),Ba!==w?($b=U(),$b!==w?(ob=n(),ob!==w?(ac=U(),ac!==w?(bc=ba(),bc!==w?(Fc=U(),Fc!==w?(rc=n(),rc!==w?(Gc=U(),Gc!==w?(Hc=ka(),
Hc!==w?ja=nb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Ba?"BOTH":Ba},ob,rc]}}:(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w);ja===w&&(ja=z,nb=R(),nb!==w?(Xb=U(),Xb!==w?(Yb=ga(),Yb!==w?(Zb=U(),Zb!==w?(Ba=F(),Ba===w&&(Ba=null),Ba!==w?($b=U(),$b!==w?(ob=n(),ob!==w?(ac=U(),ac!==w?(bc=ka(),bc!==w?ja=nb={type:"function",name:"trim",args:{type:"expr_list",
value:[{type:"string",value:null==Ba?"BOTH":Ba},ob]}}:(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w)):(z=ja,ja=w));a=ja;if(a===w){var ra,sc,Ic,Jc,Kc,tc,Lc,Mc,Nc,uc,Oc,Pc;ra=z;var cb,cc,Eb,Qc;cb=z;g.substr(z,8).toLowerCase()===Hd?(cc=g.substr(z,8),z+=8):(cc=w,0===Z&&e(Id));cc!==w?(Eb=z,Z++,Qc=D(),Z--,Qc===w?Eb=void 0:(z=Eb,Eb=w),Eb!==w?cb=cc="POSITION":(z=cb,cb=w)):(z=cb,cb=w);sc=cb;sc!==w?(Ic=U(),Ic!==w?(Jc=ga(),Jc!==w?(Kc=U(),Kc!==w?(tc=n(),
tc!==w?(Lc=U(),Lc!==w?(Mc=W(),Mc!==w?(Nc=U(),Nc!==w?(uc=n(),uc!==w?(Oc=U(),Oc!==w?(Pc=ka(),Pc!==w?ra=sc={type:"function",name:"position",args:{type:"expr_list",value:[tc,uc]}}:(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w);a=ra;if(a===w){var va,dc,Rc,Sc,Tc,pb,Uc,Vc;va=z;var Ca,Fb,Gb,Ia;Ca=z;Ca=Fb=C();if(Ca===w)if(Ca=z,96===g.charCodeAt(z)?(Fb=Wc,z++):(Fb=w,0===Z&&e(Xc)),Fb!==w){Gb=[];Yc.test(g.charAt(z))?
(Ia=g.charAt(z),z++):(Ia=w,0===Z&&e(Zc));if(Ia!==w)for(;Ia!==w;)Gb.push(Ia),Yc.test(g.charAt(z))?(Ia=g.charAt(z),z++):(Ia=w,0===Z&&e(Zc));else Gb=w;Gb!==w?(96===g.charCodeAt(z)?(Ia=Wc,z++):(Ia=w,0===Z&&e(Xc)),Ia!==w?Ca=Fb=Gb.join(""):(z=Ca,Ca=w)):(z=Ca,Ca=w)}else z=Ca,Ca=w;dc=Ca;dc!==w?(Rc=U(),Rc!==w?(Sc=ga(),Sc!==w?(Tc=U(),Tc!==w?(pb=h(),pb===w&&(pb=null),pb!==w?(Uc=U(),Uc!==w?(Vc=ka(),Vc!==w?va=dc={type:"function",name:dc,args:pb?pb:{type:"expr_list",value:[]}}:(z=va,va=w)):(z=va,va=w)):(z=va,va=
w)):(z=va,va=w)):(z=va,va=w)):(z=va,va=w)):(z=va,va=w);a=va;if(a===w){var ec,ma,qb,fc,rb,gc,Ta,Da,Hb,$c,ad;ma=z;qb=ha();if(qb!==w)if(fc=U(),fc!==w)if(rb=n(),rb!==w)if(gc=U(),gc!==w){Ta=[];for(Da=J();Da!==w;)Ta.push(Da),Da=J();Ta!==w?(Da=U(),Da!==w?(Hb=ea(),Hb!==w?ma=qb={type:"case_expression",format:"simple",operand:rb,clauses:Ta,else:null}:(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)}else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;if(ma===w)if(ma=z,qb=ha(),qb!==w)if(fc=U(),fc!==w)if(rb=n(),
rb!==w)if(gc=U(),gc!==w){Ta=[];for(Da=J();Da!==w;)Ta.push(Da),Da=J();Ta!==w?(Da=U(),Da!==w?(Hb=M(),Hb!==w?($c=U(),$c!==w?(ad=ea(),ad!==w?ma=qb={type:"case_expression",format:"simple",operand:rb,clauses:Ta,else:Hb.value}:(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)}else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;ec=ma;if(ec===w){var na,sb,hc,Ua,Ea,Ib,bd,cd;na=z;sb=ha();if(sb!==w)if(hc=U(),hc!==w){Ua=[];for(Ea=P();Ea!==w;)Ua.push(Ea),Ea=P();Ua!==w?(Ea=U(),Ea!==w?(Ib=ea(),
Ib!==w?na=sb={type:"case_expression",format:"searched",clauses:Ua,else:null}:(z=na,na=w)):(z=na,na=w)):(z=na,na=w)}else z=na,na=w;else z=na,na=w;if(na===w)if(na=z,sb=ha(),sb!==w)if(hc=U(),hc!==w){Ua=[];for(Ea=P();Ea!==w;)Ua.push(Ea),Ea=P();Ua!==w?(Ea=U(),Ea!==w?(Ib=M(),Ib!==w?(bd=U(),bd!==w?(cd=ea(),cd!==w?na=sb={type:"case_expression",format:"searched",clauses:Ua,else:Ib.value}:(z=na,na=w)):(z=na,na=w)):(z=na,na=w)):(z=na,na=w)):(z=na,na=w)}else z=na,na=w;else z=na,na=w;ec=na}a=ec;if(a===w){var Jb,
db,vc,ic,jc;db=z;vc=B();if(vc!==w){ic=[];for(jc=E();jc!==w;)ic.push(jc),jc=E();ic!==w?db=vc+=ic.join(""):(z=db,db=w)}else z=db,db=w;Jb=db;Jb!==w&&(Jb={type:"column_ref",table:"",column:Jb});a=Jb;a===w&&(a=H(),a===w&&(a=z,b=ga(),b!==w?(c=U(),c!==w?(d=n(),d!==w?(f=U(),f!==w?(k=ka(),k!==w?(d.paren=!0,a=b=d):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)))}}}}}}}return a}function C(){var a,b,c,d;a=z;b=B();if(b!==w){c=[];for(d=D();d!==w;)c.push(d),d=D();c!==w?a=b+=c.join(""):(z=a,a=w)}else z=a,
a=w;return a}function B(){var a;jb.test(g.charAt(z))?(a=g.charAt(z),z++):(a=w,0===Z&&e(Rb));return a}function D(){var a;yb.test(g.charAt(z))?(a=g.charAt(z),z++):(a=w,0===Z&&e(kb));return a}function E(){var a;Sb.test(g.charAt(z))?(a=g.charAt(z),z++):(a=w,0===Z&&e(eb));return a}function H(){var a,b,c;a=z;64===g.charCodeAt(z)?(b=fb,z++):(b=w,0===Z&&e(kc));b!==w?(c=C(),c!==w?a=b=[b,c]:(z=a,a=w)):(z=a,a=w);a!==w&&(a={type:"param",value:a[1]});return a}function F(){var a,b,c;a=z;g.substr(z,7).toLowerCase()===
Jd?(b=g.substr(z,7),z+=7):(b=w,0===Z&&e(Kd));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="LEADING":(z=a,a=w)):(z=a,a=w);a===w&&(a=z,g.substr(z,8).toLowerCase()===Ld?(b=g.substr(z,8),z+=8):(b=w,0===Z&&e(Md)),b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="TRAILING":(z=a,a=w)):(z=a,a=w),a===w&&(a=z,g.substr(z,4).toLowerCase()===Nd?(b=g.substr(z,4),z+=4):(b=w,0===Z&&e(Od)),b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="BOTH":(z=a,a=w)):(z=a,a=w)));return a}function L(){var a;
a=G();a===w&&(a=H());return a}function G(){var a,b,c;a=z;39===g.charCodeAt(z)?(b=gb,z++):(b=w,0===Z&&e(Kb));b===w&&(g.substr(z,2)===Lb?(b=Lb,z+=2):(b=w,0===Z&&e(lc)));if(b!==w){b=[];c=z;g.substr(z,2)===Ja?(c=Ja,z+=2):(c=w,0===Z&&e(hb));c!==w&&(c="'");c===w&&(Va.test(g.charAt(z))?(c=g.charAt(z),z++):(c=w,0===Z&&e(Ka)));for(;c!==w;)b.push(c),c=z,g.substr(z,2)===Ja?(c=Ja,z+=2):(c=w,0===Z&&e(hb)),c!==w&&(c="'"),c===w&&(Va.test(g.charAt(z))?(c=g.charAt(z),z++):(c=w,0===Z&&e(Ka)));b!==w?(39===g.charCodeAt(z)?
(c=gb,z++):(c=w,0===Z&&e(Kb)),c!==w?a=b={type:"string",value:b.join("")}:(z=a,a=w)):(z=a,a=w)}else z=a,a=w;return a}function P(){var a,b,c;a=z;b=ca();b!==w?(b=U(),b!==w?(b=n(),b!==w?(c=U(),c!==w?(c=fa(),c!==w?(c=U(),c!==w?(c=n(),c!==w?a=b={type:"when_clause",operand:b,value:c}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function J(){var a,b,c;a=z;b=ca();b!==w?(b=U(),b!==w?(b=n(),b!==w?(c=U(),c!==w?(c=fa(),c!==w?(c=U(),c!==w?(c=n(),c!==w?a=b={type:"when_clause",
operand:b,value:c}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function M(){var a,b;a=z;var c,d;b=z;g.substr(z,4).toLowerCase()===Pd?(c=g.substr(z,4),z+=4):(c=w,0===Z&&e(Qd));c!==w?(c=z,Z++,d=D(),Z--,d===w?c=void 0:(z=c,c=w),c!==w?b="ELSE":(z=b,b=w)):(z=b,b=w);b!==w?(b=U(),b!==w?(b=n(),b!==w?a={type:"else_clause",value:b}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function O(){var a,b,c;a=N();a===w&&(a=z,45===g.charCodeAt(z)?(b=vb,z++):(b=w,0===Z&&e(wb)),b===
w&&(43===g.charCodeAt(z)?(b=oa,z++):(b=w,0===Z&&e(ub))),b!==w?(c=N(),c!==w?a=b=b[0]+c:(z=a,a=w)):(z=a,a=w));return a}function aa(){var a,b;a=z;46===g.charCodeAt(z)?(b=mc,z++):(b=w,0===Z&&e(Rd));b!==w?(b=N(),b===w&&(b=null),b!==w?a="."+(null!=b?b:""):(z=a,a=w)):(z=a,a=w);return a}function V(){var a,b,c;b=a=z;Sd.test(g.charAt(z))?(c=g.charAt(z),z++):(c=w,0===Z&&e(Td));c!==w?(Ud.test(g.charAt(z))?(c=g.charAt(z),z++):(c=w,0===Z&&e(Vd)),c===w&&(c=null),c!==w?b="e"+(null===c?"":c):(z=b,b=w)):(z=b,b=w);
b!==w?(c=N(),c!==w?a=b+c:(z=a,a=w)):(z=a,a=w);return a}function N(){var a,b;a=[];b=S();if(b!==w)for(;b!==w;)a.push(b),b=S();else a=w;a!==w&&(a=a.join(""));return a}function S(){var a;Wd.test(g.charAt(z))?(a=g.charAt(z),z++):(a=w,0===Z&&e(Xd));return a}function W(){var a,b,c;a=z;g.substr(z,2).toLowerCase()===Yd?(b=g.substr(z,2),z+=2):(b=w,0===Z&&e(Zd));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="IN":(z=a,a=w)):(z=a,a=w);return a}function X(){var a,b,c;a=z;g.substr(z,2).toLowerCase()===
$d?(b=g.substr(z,2),z+=2):(b=w,0===Z&&e(ae));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="IS":(z=a,a=w)):(z=a,a=w);return a}function Q(){var a,b,c;a=z;g.substr(z,4).toLowerCase()===be?(b=g.substr(z,4),z+=4):(b=w,0===Z&&e(ce));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="LIKE":(z=a,a=w)):(z=a,a=w);return a}function I(){var a,b,c;a=z;g.substr(z,3).toLowerCase()===de?(b=g.substr(z,3),z+=3):(b=w,0===Z&&e(ee));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="NOT":
(z=a,a=w)):(z=a,a=w);return a}function K(){var a,b,c;a=z;g.substr(z,3).toLowerCase()===fe?(b=g.substr(z,3),z+=3):(b=w,0===Z&&e(ge));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="AND":(z=a,a=w)):(z=a,a=w);return a}function T(){var a,b,c;a=z;g.substr(z,2).toLowerCase()===he?(b=g.substr(z,2),z+=2):(b=w,0===Z&&e(ie));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="OR":(z=a,a=w)):(z=a,a=w);return a}function Y(){var a,b,c;a=z;g.substr(z,7).toLowerCase()===je?(b=g.substr(z,7),z+=
7):(b=w,0===Z&&e(ke));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="BETWEEN":(z=a,a=w)):(z=a,a=w);return a}function ba(){var a,b,c;a=z;g.substr(z,4).toLowerCase()===le?(b=g.substr(z,4),z+=4):(b=w,0===Z&&e(me));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="FROM":(z=a,a=w)):(z=a,a=w);return a}function R(){var a,b,c;a=z;g.substr(z,4).toLowerCase()===ne?(b=g.substr(z,4),z+=4):(b=w,0===Z&&e(oe));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="TRIM":(z=a,a=w)):(z=a,
a=w);return a}function ha(){var a,b,c;a=z;g.substr(z,4).toLowerCase()===pe?(b=g.substr(z,4),z+=4):(b=w,0===Z&&e(qe));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="CASE":(z=a,a=w)):(z=a,a=w);return a}function ea(){var a,b,c;a=z;g.substr(z,3).toLowerCase()===re?(b=g.substr(z,3),z+=3):(b=w,0===Z&&e(se));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="END":(z=a,a=w)):(z=a,a=w);return a}function ca(){var a,b,c;a=z;g.substr(z,4).toLowerCase()===te?(b=g.substr(z,4),z+=4):(b=w,0===
Z&&e(ue));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="WHEN":(z=a,a=w)):(z=a,a=w);return a}function fa(){var a,b,c;a=z;g.substr(z,4).toLowerCase()===ve?(b=g.substr(z,4),z+=4):(b=w,0===Z&&e(we));b!==w?(b=z,Z++,c=D(),Z--,c===w?b=void 0:(z=b,b=w),b!==w?a="THEN":(z=a,a=w)):(z=a,a=w);return a}function da(){var a;44===g.charCodeAt(z)?(a=xe,z++):(a=w,0===Z&&e(ye));return a}function ga(){var a;40===g.charCodeAt(z)?(a=ze,z++):(a=w,0===Z&&e(Ae));return a}function ka(){var a;41===g.charCodeAt(z)?
(a=Be,z++):(a=w,0===Z&&e(Ce));return a}function U(){var a,b;a=[];for(b=la();b!==w;)a.push(b),b=la();return a}function la(){var a;De.test(g.charAt(z))?(a=g.charAt(z),z++):(a=w,0===Z&&e(Ee));return a}function sa(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function ia(a,b){for(var c=0;c<b.length;c++)a=sa(b[c][1],a,b[c][3]);return a}f=void 0!==f?f:{};var w={},qa={start:d},ua=d,Pa="!",ya=a("!",!1),Fa="\x3d",xa=a("\x3d",!1),Ga="\x3e\x3d",Qa=a("\x3e\x3d",!1),
La="\x3e",tb=a("\x3e",!1),Ra="\x3c\x3d",Ma=a("\x3c\x3d",!1),za="\x3c\x3e",Sa=a("\x3c\x3e",!1),Mb="\x3c",ib=a("\x3c",!1),Ha="!\x3d",Ob=a("!\x3d",!1),oa="+",ub=a("+",!1),vb="-",wb=a("-",!1),Nb="*",xb=a("*",!1),Pb="/",Qb=a("/",!1),jb=/^[A-Za-z_\x80-\uFFFF]/,Rb=c([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),yb=/^[A-Za-z0-9_]/,kb=c([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Sb=/^[A-Za-z0-9_.\x80-\uFFFF]/,eb=c([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),fb="@",kc=a("@",!1),
gb="'",Kb=a("'",!1),Lb="N'",lc=a("N'",!1),Ja="''",hb=a("''",!1),Va=/^[^']/,Ka=c(["'"],!0,!1),mc=".",Rd=a(".",!1),Wd=/^[0-9]/,Xd=c([["0","9"]],!1,!1),Sd=/^[eE]/,Td=c(["e","E"],!1,!1),Ud=/^[+\-]/,Vd=c(["+","-"],!1,!1),jd="null",kd=a("NULL",!0),fd="true",gd=a("TRUE",!0),hd="false",id=a("FALSE",!0),Yd="in",Zd=a("IN",!0),$d="is",ae=a("IS",!0),be="like",ce=a("LIKE",!0),dd="escape",ed=a("ESCAPE",!0),de="not",ee=a("NOT",!0),fe="and",ge=a("AND",!0),he="or",ie=a("OR",!0),je="between",ke=a("BETWEEN",!0),le=
"from",me=a("FROM",!0),Fd="for",Gd=a("FOR",!0),Dd="substring",Ed=a("SUBSTRING",!0),pd="extract",qd=a("EXTRACT",!0),ne="trim",oe=a("TRIM",!0),Hd="position",Id=a("POSITION",!0),nd="timestamp",od=a("TIMESTAMP",!0),ld="date",md=a("DATE",!0),Jd="leading",Kd=a("LEADING",!0),Ld="trailing",Md=a("TRAILING",!0),Nd="both",Od=a("BOTH",!0),rd="year",sd=a("YEAR",!0),td="month",ud=a("MONTH",!0),vd="day",wd=a("DAY",!0),xd="hour",yd=a("HOUR",!0),zd="minute",Ad=a("MINUTE",!0),Bd="second",Cd=a("SECOND",!0),pe="case",
qe=a("CASE",!0),re="end",se=a("END",!0),te="when",ue=a("WHEN",!0),ve="then",we=a("THEN",!0),Pd="else",Qd=a("ELSE",!0),xe=",",ye=a(",",!1),ze="(",Ae=a("(",!1),Be=")",Ce=a(")",!1),De=/^[ \t\n\r]/,Ee=c([" ","\t","\n","\r"],!1,!1),Wc="`",Xc=a("`",!1),Yc=/^[^`]/,Zc=c(["`"],!0,!1),z=0,Na=[{line:1,column:1}],ta=0,lb=[],Z=0,Oa;if("startRule"in f){if(!(f.startRule in qa))throw Error("Can't start parsing from rule \""+f.startRule+'".');ua=qa[f.startRule]}Oa=ua();if(Oa!==w&&z===g.length)return Oa;Oa!==w&&z<
g.length&&e({type:"end"});throw function(a,b,c){return new r(r.buildMessage(a,b),a,b,c)}(lb,ta<g.length?g.charAt(ta):null,ta<g.length?l(ta,ta+1):l(ta,ta));}}})},"esri/layers/IntegratedMeshLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ../symbols/support/ElevationInfo".split(" "),function(r,g,f,a,c,b,l,
e,d,h,n){return function(d){function g(a,b){a=d.call(this)||this;a.geometryType="mesh";a.operationalLayerType="IntegratedMeshLayer";a.type="integrated-mesh";a.profile="mesh-pyramids";a.elevationInfo=null;return a}a(g,d);g.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?f({url:a},b):a};g.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return a._verifyRootNodeAndUpdateExtent()});
this.addResolvingPromise(b);return this.when()};g.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return l.reject(new b("integrated-mesh-layer:view-not-supported","IntegratedMeshLayer is only supported in 3D"));case "3d":return l.create(function(a){return r(["../views/3d/layers/SceneLayerView3D"],a)})}};g.prototype._validateLayer=function(a){if(a.layerType&&"IntegratedMesh"!==a.layerType)throw new b("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",
{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new b("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new b("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});};c([e.shared("esri.layers.IntegratedMeshLayer")],g.prototype,"declaredClass",void 0);c([e.property({type:String,
readOnly:!0})],g.prototype,"geometryType",void 0);c([e.property()],g.prototype,"operationalLayerType",void 0);c([e.property({json:{read:!1},readOnly:!0})],g.prototype,"type",void 0);c([e.property({type:n,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],g.prototype,"elevationInfo",void 0);return g=c([e.subclass()],g)}(e.declared(d,h))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v){var y=l.getLogger("esri.layers.mixins.SceneService");return function(e){function g(){var a=null!==e&&e.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}f(g,e);g.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
g.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return k.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new k(a):null};g.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new t({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};g.prototype.readVersion=function(a,
b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};g.prototype.readCopyright=function(a,b){return b.copyrightText};g.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};g.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return v.titleFromUrlAndName(this.url,
b.name);b=b.name||v.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return v.cleanTitle(b)};g.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(g.prototype,"url",{set:function(a){a=v.sanitizeUrlWithLayerId(this,a,y);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});g.prototype.writeUrl=function(a,b){v.writeUrlWithLayerId(this,a,"layers",b)};Object.defineProperty(g.prototype,"parsedUrl",
{get:function(){var a=this._get("url");if(!a)return null;a=h.urlToObject(a);null!=this.layerId&&v.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});g.prototype.readRootNode=function(a,b){return b.store.rootNode};g.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};g.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&
null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};g.prototype._fetchRootNode=function(){if(!this.rootNode)return d.resolve();var a=h.join(this.parsedUrl.path,this.rootNode);return c(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(c){throw new b("sceneservice:root-node-missing","Root node missing.",{error:c,url:a});})};g.prototype._fetchService=function(){var a=this;return(null==this.layerId&&
/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):d.resolve()).then(function(){return a._fetchServiceLayer()})};g.prototype._fetchFirstLayerId=function(){return c(this.url,{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};g.prototype._fetchServiceLayer=function(){var a=this;return c(this.parsedUrl.path,{query:{f:"json"},
responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};g.prototype._validateLayer=function(a){};g.prototype.createGraphicsController=function(a){var b=this;a.layer=this;var c=d.create(function(a){return r(["../graphics/controllers/I3SOnDemandController"],a)}).then(function(b){return new b(a)});c.then(function(a){b.emit("graphics-controller-create",{graphicsController:a})});return c};a([n.shared({id:{json:{origins:{service:{read:!1},
"portal-item":{read:!1}}}}})],g.prototype,"properties",void 0);a([n.property({type:k})],g.prototype,"spatialReference",void 0);a([n.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],g.prototype,"readSpatialReference",null);a([n.property({type:t})],g.prototype,"fullExtent",void 0);a([n.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],g.prototype,"readFullExtent",null);a([n.property({readOnly:!0,type:p})],g.prototype,
"heightModelInfo",void 0);a([n.property({readOnly:!0})],g.prototype,"version",void 0);a([n.reader("version",["store.version"])],g.prototype,"readVersion",null);a([n.property({type:String})],g.prototype,"copyright",void 0);a([n.reader("copyright",["copyrightText"])],g.prototype,"readCopyright",null);a([n.property({type:String})],g.prototype,"sublayerTitleMode",void 0);a([n.property({type:String})],g.prototype,"title",void 0);a([n.reader("portal-item","title")],g.prototype,"readTitlePortalItem",null);
a([n.reader("service","title",["name"])],g.prototype,"readTitleService",null);a([n.property({type:Number})],g.prototype,"layerId",void 0);a([n.reader("service","layerId",["id"])],g.prototype,"readLayerId",null);a([n.property()],g.prototype,"url",null);a([n.writer("url")],g.prototype,"writeUrl",null);a([n.property({dependsOn:["layerId"]})],g.prototype,"parsedUrl",null);a([n.property()],g.prototype,"store",void 0);a([n.property({type:String})],g.prototype,"rootNode",void 0);a([n.reader("rootNode",["store.rootNode"])],
g.prototype,"readRootNode",null);return g=a([n.subclass("esri.layers.mixins.SceneService")],g)}(n.declared(q,m,e,u,x))})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J,M,O){function aa(a,b,c){a&&((a=G.read(a,b,c)||void 0)||N.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var V=["3DObject","Point"],N=h.getLogger("esri.layers.SceneLayer"),S={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
W={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(g){function h(a,b){a=g.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.elevationInfo=null;a.labelsVisible=!1;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(h,g);h.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?f({url:a},b):a};h.prototype.getField=function(a){return D.getField(a,this.fields)};Object.defineProperty(h.prototype,"geometryType",{get:function(){return W[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderer",{set:function(a){D.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});h.prototype.readCachedDrawingInfo=function(a,b){if(null==
a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};h.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};h.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&S[a])return S[a];N.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};h.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame};h.prototype.load=function(){var a=
this,c=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return b([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return P.loadStyleRenderer(a,{origin:"service"})}).then(function(){return D.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(c);return this.when()};h.prototype.createLayerView=
function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?n.create(function(a){return r(["../views/3d/layers/SceneLayerView3D"],a)}):n.create(function(a){return r(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};h.prototype.createQuery=function(){var a=new O;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};h.prototype.queryExtent=
function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};h.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};h.prototype.queryFeatures=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,d=a.features;c<
d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};h.prototype.queryFeaturesJSON=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeaturesJSON(a||b.createQuery())})};h.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})};h.prototype.getFieldUsageInfo=function(a){return this._fieldUsageInfo[a]||{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1}};h.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?n.resolve(b):n.reject(new d("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};h.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};h.prototype.queryCachedStatistics=
function(a){if(!this.hasCachedStatistics(a))return n.reject(new d("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,c=this.statisticsInfo;b<c.length;b++){var f=c[b];if(f.name===a)return a=t.join(this.parsedUrl.path,f.href),e(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};h.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};h.prototype._validateLayer=function(a){if(a.layerType&&-1===V.indexOf(a.layerType))throw new d("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new d("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new d("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,
c=!1,e=!1;if(null==a)e=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;e=b;break;case "vertex-reference-frame":c=!0;e=!b;break;default:c=!1}if(!c)throw new d("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!e)throw new d("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};h.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=
function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};h.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=
0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=q.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};h.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})};h.prototype._fetchCompanionFeatureLayer=
function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?n.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?N.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):N.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+
a.title);return null})};h.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new L({id:a.id,portal:a.portal})):n.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};h.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=
this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return n.resolve(new m({url:b,portalItem:a}))})};h.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return n.resolve(new m({url:a}))})};h.prototype._findMatchingCompanionSublayerUrl=function(a){var c=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!c)return n.reject();null==a&&(a=c[1]+"/FeatureServer");
var d=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var f=c[1]+"/SceneServer",g=parseInt(c[2],10),c=e(f,a).catch(function(a){return{layers:null}});a=e(d,a);return b([a,c]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===g)return d+"/"+b[c].id}else if(g<b.length)return d+"/"+b[g].id;
throw Error("could not find matching associated sublayer");})};h.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=k.nameToId(this.originOf(a));a=k.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=k.OriginId.SERVICE?null==b||b<k.OriginId.SERVICE:null!=a&&a<=k.OriginId.PORTAL_ITEM?null==b||b<k.OriginId.PORTAL_ITEM:!1};c([p.shared("esri.layers.SceneLayer")],h.prototype,"declaredClass",void 0);c([p.property({types:{key:"type",base:A.default,typeMap:{selection:C.default}},
json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],h.prototype,"featureReduction",void 0);c([p.property({type:[F.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],h.prototype,"rangeInfos",void 0);c([p.property()],h.prototype,"associatedLayer",void 0);c([p.property()],h.prototype,"operationalLayerType",void 0);c([p.property({json:{read:!1},
readOnly:!0})],h.prototype,"type",void 0);c([p.property({type:[B]})],h.prototype,"fields",void 0);c([p.property({readOnly:!0})],h.prototype,"attributeStorageInfo",void 0);c([p.property({readOnly:!0})],h.prototype,"statisticsInfo",void 0);c([p.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],h.prototype,"definitionExpression",void 0);c([p.property({type:M,json:{origins:{service:{read:{source:"elevationInfo"}}},
read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],h.prototype,"elevationInfo",void 0);c([p.property({type:String,dependsOn:["profile"]})],h.prototype,"geometryType",null);c([p.property(v.labelsVisible)],h.prototype,"labelsVisible",void 0);c([p.property({type:[E],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:H.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",
reader:H.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],h.prototype,"labelingInfo",void 0);c([p.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],h.prototype,"legendEnabled",void 0);c([p.property({types:J.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:aa}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:aa},write:{target:"layerDefinition.drawingInfo.renderer"}},
value:null})],h.prototype,"renderer",null);c([p.property({json:{read:!1}})],h.prototype,"cachedDrawingInfo",void 0);c([p.reader("service","cachedDrawingInfo")],h.prototype,"readCachedDrawingInfo",null);c([p.property(v.popupEnabled)],h.prototype,"popupEnabled",void 0);c([p.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],h.prototype,"popupTemplate",void 0);c([p.property({type:String,json:{read:!1}})],h.prototype,"objectIdField",void 0);c([p.reader("service","objectIdField",
["objectIdField","fields"])],h.prototype,"readObjectIdField",null);c([p.property()],h.prototype,"objectIdFilter",void 0);c([p.property({type:String,json:{read:!1}})],h.prototype,"profile",void 0);c([p.reader("service","profile",["store.profile"])],h.prototype,"readProfile",null);c([p.property({readOnly:!0,type:String,json:{read:!1}})],h.prototype,"normalReferenceFrame",void 0);c([p.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],h.prototype,"readNormalReferenceFrame",null);
c([p.property(y.screenSizePerspectiveEnabled)],h.prototype,"screenSizePerspectiveEnabled",void 0);return h=c([p.subclass()],h)}(p.declared(u,x))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(r,g,f,a,c,b){Object.defineProperty(g,"__esModule",{value:!0});r=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||
this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}f(e,c);a([b.property({type:String,json:{read:!0,write:!0}})],e.prototype,"name",void 0);a([b.property({type:String,json:{read:!0,write:!0}})],e.prototype,"field",void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"currentRangeExtent",void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"fullRangeExtent",void 0);a([b.property({type:String,readOnly:!0,
json:{read:!1,write:!0}})],e.prototype,"type",void 0);return e=a([b.subclass("esri.layers.support.RangeInfo")],e)}(b.declared(c));g.RangeInfo=r;g.default=r})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper dojo/has dojo/_base/lang dojo/errors/CancelError ../../../Graphic ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/Collection ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../layers/IntegratedMeshLayer ../../../symbols/FillSymbol3DLayer ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ../../../tasks/support/Query ./LayerView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SQueryEngine ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ../lib/glMatrix ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/Stage ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/DefaultMaterial module".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J,M,O,aa,V,N,S,W,X,Q,I,K,T,Y,ba,R,ha,ea,ca,fa,da,ga,ka){function U(a,b,c,d,e){var f=!1,g;b.encoding===N.DDS_ENCODING_STRING?g=ca.DDS_ENCODING:f=!(fa.isPowerOfTwo(a.width)&&fa.isPowerOfTwo(a.height));c=((a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas)?d:c)&&!f;return{mipmap:c,wrapClamp:a||!b.wrap,disableAnisotropy:a&&c&&e,encoding:g,noUnpackFlip:!0}}function la(a){return a.data instanceof ArrayBuffer}
function sa(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0));for(a=0;a<b.length;a++)d=b[a],d.data instanceof ArrayBuffer&&(c+=d.data.byteLength);return c}var ia=Y.ModelContentType,w=q.getLogger("esri.views.3d.layers.SceneLayerView3D"),qa=[1,1,1,1],ua=[.8,.8,.8],Pa=[.5,.5,.5];g=function(g){function q(){var a=null!==g&&g.apply(this,arguments)||this;a._queryEngine=null;a._highlights=new M(a);a._elevationProvider=null;a._worker=
new P;a._workerThread=null;a._controllerCreated=!1;a._idbCache=new S.IDBCache("esri-scenelayer-cache","geometries",8);a._cancelCount=0;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.alwaysLoadEverythingModeEnabled=!1;a._cacheKeySuffix=null;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;return a}f(q,g);Object.defineProperty(q.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,
configurable:!0});Object.defineProperty(q.prototype,"rendererNeedsTextures",{get:function(){return N.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=B.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=F.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,
"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this._useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_useCompressedTextures",{get:function(){var a=this.layer.version,a=!l("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},
enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps&&this.view._stage.has("standardDerivatives")},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},
enumerable:!0,configurable:!0});q.prototype.initialize=function(){var a=this;y.open(u.getAbsMid("./SceneLayerWorker",r,ka),{client:this}).then(function(b){a.destroyed?b.close():a._workerThread=b});N.checkSceneLayerValid(this.layer);N.checkSceneLayerCompatibleWithView(this.layer,this.view);this._initGraphicsController();this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._isIntegratedMesh()||(this._edgeView=this._stage.view.getEdgeView());this._texId2Meta=
new Map;this._nodeId2Meta=new Map;this._addThisLayerToStage();this._elevationProvider=new O({layerView:this,stageLayer:this._stageLayer});this.handles.add([v.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),v.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),v.init(this.layer,"objectIdFilter",function(){return a._filterChange()}),v.init(this.layer,"elevationInfo",function(){return a._elevationInfoChanged()}),v.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),
v.init(this,"_controller.parsedDefinitionExpression",function(){return a._filterChange()}),v.watch(this,"fullOpacity",function(b){return a._opacityChange(b)}),v.watch(this,["elevationOffset","rendererNeedsTextures"],function(){return a._reloadAll()}),v.watch(this,"uncompressedTextureDownsamplingEnabled",function(){return a._reloadAll()}),v.init(this,"suspended",function(b){return a.setVisibility(!b)})],"sceneLayerHandles");this._idbCache.init();this._cacheKeySuffix=N.getCacheKeySuffix(this.layer.spatialReference,
this.view.renderSpatialReference);this._componentColorManager=this._hasSymbolColors()?new da.BufferManager(this._stage.view.renderingContext):null};q.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._removeThisLayerFromStage();this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();
this._nodeId2Meta=this._texId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};q.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};q.prototype.isUpdating=function(){return this._controllerCreated?!(!this._controller||!this._controller.updating):!0};q.prototype.memEstimateTextureAdded=
function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};q.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a;9.5367431640625E-7>this.gpuMemoryEstimate&&(this.texMemoryEstimate=this.gpuMemoryEstimate=0)};q.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage()/1048576;this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};q.prototype.memEstimateGeometryRemoved=
function(a){a=a.estimateGpuMemoryUsage()/1048576;this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a;9.5367431640625E-7>this.gpuMemoryEstimate&&(this.texMemoryEstimate=this.gpuMemoryEstimate=0)};q.prototype._isNodeLoaded=function(a){return this._nodeId2Meta.has(a.id)};q.prototype._initGraphicsController=function(){var a=this;this.layer.createGraphicsController({layerView:this,layerViewRequiredFunctions:{addNodeData:function(b,c){return a._addNodeData(b,c)},isNodeLoaded:function(b){return a._isNodeLoaded(b)},
getMemoryUsage:function(){return a.view.resourceController.usedMemory},removeNodeData:function(b){return a._removeNodeData(b)},getLoadedNodeIDs:function(){return a._getLoadedNodeIDs()}},layerViewOptionalFunctions:{setPolygonOffset:function(b,c){return a._setPolygonOffset(b,c?!0:!1)},textureOptions:{useCompressedTextures:this._useCompressedTextures},getLoadedAttributes:function(b){return a._getLoadedAttributes(b)},getAttributeData:function(b){return a._getAttributeData(b)},setAttributeData:function(b,
c,d){return a._setAttributeData(b,c,d)},additionalCancelNodeLoadingHandler:function(){return a._cancel()},loadCachedNodeData:function(b,c){return a._loadCachedNodeData(b,c)},addCachedNodeData:function(b,c,d){return a._addCachedNodeData(b,c,d)}}}).then(function(b){a._controller=b;b.watch("rootNodeVisible",function(){a.notifyChange("suspended")})}).always(function(){a._controllerCreated=!0;a.notifyChange("updating")})};q.prototype.getUsedMemory=function(){return this.gpuMemoryEstimate};q.prototype.getUnloadedMemory=
function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0};q.prototype.getCachedMemory=function(){return 0};q.prototype.removeCachedData=function(){this.suspended&&this._removeAllNodeDataFromStage()};q.prototype.setVisibility=function(a){var b=this;this._nodeId2Meta.forEach(function(c){c=c.engineObject;c.setHidden(c.geometryRecords[0],!a);b._edgeView&&b._edgeView.updateObjectVisibility(c,a)});if(a){var c=this._isIntegratedMesh()?"im":"scene";this.view.elevationProvider.register(c,
this._elevationProvider);this.visibleGeometryChanged()}else this.visibleGeometryChanged(),this.view.elevationProvider.unregister(this._elevationProvider)};q.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":this.gpuMemoryEstimate+"MB","Geometry Memory Estimate":this.geoMemoryEstimate+"MB","Texture Memory Estimate":this.texMemoryEstimate+"MB"};this._controller&&(a.index=Object.keys(this._controller.nodeIndex).length,
0<this._controller.getNumUnloadedNodes()&&(a.nodes+=" + "+this._controller.getNumUnloadedNodes()));return a};q.prototype._addThisLayerToStage=function(){for(var a=this._stage,b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;this._whiteTexture=new ca(b,"white",{width:8,height:8});a.add(ia.TEXTURE,this._whiteTexture);b=this.layer.id;this._stageLayer=b=new R(b,{},b);a.add(ia.LAYER,b);this._stage.addToViewContent([b.id])};q.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var a=
this._stage;a.remove(ia.TEXTURE,this._whiteTexture.id);this._removeAllNodeDataFromStage();fa.assert(0===this._nodeId2Meta.size);fa.assert(0===this._texId2Meta.size);a.remove(ia.LAYER,this._stageLayer.id);this._stageLayer=void 0;this.gpuMemoryEstimate=0}};q.prototype._getLoadedAttributes=function(a){if(a=this._nodeId2Meta.get(a.id))return a.loadedAttributes};q.prototype._getAttributeData=function(a){if(a=this._nodeId2Meta.get(a.id))return a.attributeData};q.prototype._setAttributeData=function(a,b,
c){var d=this._nodeId2Meta.get(a.id);d&&(d.loadedAttributes=b,d.attributeData=c,this._setObjectSymbology(d),this._addOrUpdateEdgeRendering(d),this._applyFilters(a),this.visibleGeometryChanged(d.engineObject))};q.prototype._getLoadedNodeIDs=function(){return t.keysOfMap(this._nodeId2Meta)};q.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){var d=this.fullOpacity,e=1-fa.clamp(fa.fallbackIfUndefined(b.transparency,0),0,1);a=1>e||1>d||a&&k.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||
c;return{opacity:e,layerOpacity:d,transparent:a}};q.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};q.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};q.prototype._getMaterialParameters=function(a,b,c,d){var f;null!=a&&(f=(f=this._texId2Meta.get(b))&&f.engineTex?f.engineTex.id:this._whiteTexture.id);b=c.params;var g=fa.fallbackIfUndefined(b.diffuse,ua);
"standard"!==c.type&&w.warn("Unknown material type '"+c.type+"', must be 'standard'");c=this._isIntegratedMesh();d={ambient:g,diffuse:g,specular:fa.fallbackIfUndefined(b.specular,Pa),atlasRegions:b.vertexRegions,textureId:f,vertexColors:this._hasVertexColors(),componentIndices:this._hasSymbolColors(),componentColorBuffer:this._hasSymbolColors()&&d?d.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(b),cullFace:this._calcEngineMaterialCullFaceParams(b),writeStencil:c,
receiveSSAO:!c,groundNormalShading:c,compressedNormals:!c};c||(a=this._calcEngineMaterialTransparencyParams(a,b),e.mixin(d,a));return d};q.prototype._createEngineMaterial=function(a,b,c,d,e,f,g){var h=null!=b?this._getI3STexEncoding(b):null;g=this._getMaterialParameters(b,c,d,g);g=new ga(g,e);g.metadata={i3sMatId:e,i3sTexId:c,i3sTex:b,i3sMatParams:d.params};if(null!=b){(d=this._texId2Meta.get(c))?d.usedByEngineMats.push(g):(d={id:c,usedByEngineMats:[g],images:b.images,encoding:h,atlas:!0===b.atlas,
wrap:"none"!==b.wrap[0]||"none"!==b.wrap[1]},this._texId2Meta.set(c,d));a:{for(b=0;b<f.length;b++)if(h=f[b],h.i3sTexId===c){c=h.data;break a}c=null}null!=c&&null==d.engineTex&&(f=U(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),d.engineTex=new ca(c,d.id,f),this._stage.add(ia.TEXTURE,d.engineTex),a.memory+=this.memEstimateTextureAdded(d.engineTex));if(null!=d.engineTex)for(a=d.engineTex.id,c=0,f=d.usedByEngineMats;c<f.length;c++)f[c].setParameterValues({textureId:a})}return g};
q.prototype._getI3STexEncoding=function(a){var b=N.getAppropriateTextureEncoding(a.encoding,this._useCompressedTextures);return-1<b?a.encoding[b]:a.encoding};q.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,d=b.materialDefinitions[c];fa.assert(void 0!==d,"geometry wants unknown material "+c);a=a.params.textureID||"none";var e;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||w.warn("textureDefinitions missing in shared resource"),e=b.textureDefinitions[a]);
b=this._getMaterialParameters(e,a,d);return ga.getVertexBufferLayout(b)};q.prototype._createEngineMat=function(a,b,c,d,e){var f=b.params.materialID,g=c.materialDefinitions[f];fa.assert(void 0!==g,"geometry wants unknown material "+f);b=b.params.textureID||"none";var h;"none"!==b&&(null!=c.textureDefinitions&&null!=c.textureDefinitions[b]||w.warn("textureDefinitions missing in shared resource"),h=c.textureDefinitions[b]);return this._createEngineMaterial(a,h,b,g,f,d,e)};q.prototype._getObjectIdField=
function(){return this.layer.objectIdField||"OBJECTID"};q.prototype._findGraphicNodeAndIndex=function(a){var b=W.attributeLookup(a.attributes,this._getObjectIdField()),c=null;this._nodeId2Meta.forEach(function(a,d){var e=null==c?a.featureIds.indexOf(b):-1;-1!==e&&(c={node:a.node,nodeId:d,index:e})});return c};q.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.id);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=W.attributeLookup(b[e].attributes,
d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};q.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(null!=a){var b=this._nodeId2Meta.get(a.nodeId).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));if(T.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=C.empty(),C.expandWithBuffer(b,a,0,8),m.resolve({boundingBox:b,screenSpaceObjects:[]})}return m.reject()};q.prototype.whenGraphicAttributes=
function(a,b){var c=this;return N.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})};q.prototype.getGraphicsFromStageObject=function(a,b){if(this.layer instanceof D)return m.reject();var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?(c=this._createGraphic(a,
c),m.resolve(c)):m.reject()};q.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.i3sNode)};q.prototype._getCacheKey=function(a){return a.baseUrl+this._cacheKeySuffix};q.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};q.prototype._cancel=function(){this._cancelCount=this._cancelCount+1|0};q.prototype._handleCancelled=function(a){if(0<(this._cancelCount-a|0))throw new d;};q.prototype._loadCachedNodeData=
function(a,b){var c=this,d=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a)).then(function(e){if(null==e)return null;c._handleCancelled(d);if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=K.clone(e.nodeObb));var f=function(a){if(null==a.data)return!0;var b=c._getI3STexEncoding(e.sharedResource.textureDefinitions[a.i3sTexId]);return a.encoding!==b};return c.rendererNeedsTextures&&e.textureData.some(f)?b(e.allGeometryData,
e.sharedResource).then(function(b){e.textureData=b;b.every(la)&&c._idbCache.put(c._getCacheKey(a),e).catch(function(b){return w.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)});c._handleCancelled(d);return e}):e}):m.resolve(null)};q.prototype._addNodeData=function(a,b){var c=this;return this._transformBundle(a,b).then(function(d){a.obb=a.obb||d.obb;d={allGeometryData:b.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:b.textureData,sharedResource:b.sharedResource,
nodeVersion:a.version,nodeObb:a.obb,byteSize:sa(d.transformedGeometries,b.textureData)};if(c._cachingEnabled()){var e=d.textureData.map(function(a){return la(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,data:null}});c._idbCache.put(c._getCacheKey(a),{allGeometryData:d.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:e,sharedResource:d.sharedResource,nodeVersion:d.nodeVersion,nodeObb:d.nodeObb,byteSize:d.byteSize}).catch(function(b){return w.warn("Failed to store node in IndexedDB cache: "+
a.id+": "+b)})}return c._addCachedNodeData(a,d,b.attributeDataInfo)})};q.prototype._transformBundle=function(a,b){for(var c=[],d=[b.geometryBuffer],e=0,f=b.allGeometryData;e<f.length;e++)for(var g=0,h=f[e].geometries;g<h.length;g++)c.push(this._getVertexBufferLayout(h[g],b.sharedResource));a={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData,layouts:c,center:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,hasColors:this._hasColors,needNormals:!this._isIntegratedMesh()&&this._controller.isMeshPyramid,
normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",a,d):m.resolve(this._worker.transform(a))};q.prototype._addCachedNodeData=function(a,b,c){var d=this;if(this._nodeId2Meta.has(a.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(a.id)),this._applyFilters(a),m.resolve();if(!this.alwaysLoadEverythingModeEnabled&&
!this._controller.isGeometryVisible(a))return m.resolve();var e=b.allGeometryData,f=b.transformedGeometries,g=b.textureData;b=b.sharedResource;if(0===e.length)return m.resolve();1!==e.length&&console.warn("Node with",e.length,"geometries is unsupported");if(!this.rendererNeedsTextures)for(var h=0;h<g.length;h++)g[h].data=null;var k={};k[ia.OBJECT]={};k[ia.GEOMETRY]={};k[ia.MATERIAL]={};var h=0,l=!1;a.memory=0;var n=e[0],e=n.componentOffsets,q=n.geometries,n=n.featureIds,p=null,t=null;if(this._hasSymbolColors())for(var p=
this._componentColorManager.getBuffer(n.length),t=new Uint16Array(n.length),u=0;u<n.length;u++)t[u]=p.aquireIndex();for(var u=a.id+"|"+n[0],r=[],v=[],x=[],w,y=0;y<q.length;y++){var A=q[y],C=this._createEngineMat(a,A,b,g,p);w=f[h++];var l=l||w.hasColors,B=aa.extractPositionData(w.interleavedVertexData,w.layout,w.indices),B=new ea(new Float32Array(w.interleavedVertexData),w.layout,B,e||ea.DefaultOffsets,w.indices||ea.DefaultIndices);this._hasSymbolColors()&&this._setComponentIndices(B,t);w=w.corMatrices;
var D=I.mat4d.create(w.localTrafo);null!=A.transformation&&I.mat4d.multiply(D,A.transformation,D);A=r.length;A=new ba(B,u+(0<A?"_"+A:""));r.push(A);v.push(D);x.push([C]);a.memory+=this.memEstimateGeometryAdded(A.getData());k[ia.MATERIAL][C.id]=C;k[ia.GEOMETRY][A.id]=A}var E=new ha({idHint:a.id,name:u,geometries:r,materials:x,transformations:v,castShadow:!0,metadata:{i3sNode:a.id,layerUid:this.layer.uid}}),f=I.mat4d.create();I.mat4d.identity(f);I.mat4d.multiply(f,w.globalTrafo,f);E.setObjectTransformation(f);
k[ia.OBJECT][E.id]=E;var O={node:a,engineObject:E,featureIds:n,attributeData:c?c.attributeData:null,loadedAttributes:c?c.loadedAttributes:null,componentColorBuffer:p,componentIndices:t};return m.create(function(b){d._addOrUpdateEdgeRendering(O).then(function(){d._nodeId2Meta.set(a.id,O);d._setObjectSymbology(O);d._applyFilters(a);d._highlights.objectCreated(E);d.visibleGeometryChanged(E);var c=d._stageLayer,e=d._stage;e.beginMod();var f=k[ia.OBJECT],g;for(g in f)f.hasOwnProperty(g)&&c.addObject(f[g]);
for(var h in k)if(k.hasOwnProperty(h)){var c=k[h],m;for(m in c)c.hasOwnProperty(m)&&null==e.get(h,m)&&e.add(h,c[m])}e.endMod();!d._hasTextures&&null!=a.textureData&&0<a.textureData.length&&(d._hasTextures=!0);d._hasColors||(d._hasColors=l);d._hasData=!0;d.notifyChange("hasTexturesOrVertexColors");b()})})};q.prototype._clippingAreaChanged=function(){var a=this,b=C.create();T.extentToBoundingBox(this.view.clippingArea,b,this.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null;
this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)});this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};q.prototype._filterChange=function(){var a=this;this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)})};q.prototype._updateFilters=function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();
b.push(function(b,e){return a._objectIdFilter(c,d,e)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var e=this._controller.parsedDefinitionExpression,f=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,e,f,c)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,a._clippingArea,c)});this._filters=b};q.prototype._sqlFilter=function(a,b,c,d){var e=
{},f=new h(null,null,e);f.layer=this.layer;f.sourceLayer=this.layer;var g=this.layer.objectIdField,k=0,l=0,m=this._nodeId2Meta.get(a.id);a=m.featureIds;for(var n=m.attributeData,m=c.every(function(a){return null!=n[a]||a===g}),q=0;q<a.length&&k<d.length;q++)if(d[k]===a[q]){var p=!0;if(m){e[g]=a[q];for(var p=0,t=c;p<t.length;p++){var u=t[p];u!==g&&(e[u]=N.getCachedAttributeValue(n[u],q))}p=this._evaluateClause(b,f)}p&&(d[l]=d[k],l++);k++}d.length=l};q.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(za){return this._definitionExpressionErrors<
this._maxDefinitionExpressionErrors&&w.error("Error while evaluating definitionExpression: "+za),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&w.error("Further errors are ignored"),!1}};q.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=n.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};q.prototype._boundingboxFilter=function(a,b,c){var d=[0,0,0,0];T.mbsToMbs(a.mbs,this._controller.crsIndex,d,this.view.renderSpatialReference);
d=null!=b?N.intersectBoundingBoxWithMbs(b,d):2;if(2!==d)if(0===d)c.length=0;else{var e=d=0,f=this._nodeId2Meta.get(a.id);a=f.featureIds;var g=f.engineObject.getObjectTransformation(),h=f.engineObject.getGeometryRecords()[0].getShaderTransformation();I.mat4d.multiply(g,h);if(0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&0===g[11]&&1===g[15]){h=Fa;h[0]=(b[0]-g[12])/g[0];h[1]=(b[1]-g[13])/g[5];h[2]=(b[2]-g[14])/g[10];h[3]=(b[3]-g[12])/g[0];h[4]=(b[4]-g[13])/g[5];h[5]=
(b[5]-g[14])/g[10];b=f.engineObject.getGeometryRecords()[0].geometry;f=b.getComponentCount();for(g=0;g<f&&d<c.length;g++)if(c[d]===a[g]){var k=b.getComponentAABB(g,xa);C.intersects(h,k)&&(c[e]=c[d],e++);d++}c.length=e}}};q.prototype._addOrUpdateEdgeRendering=function(a){return c(this,void 0,void 0,function(){var c,d,e,f,g,h;return b(this,function(b){switch(b.label){case 0:if(!this._edgeView)return[2];c=a.engineObject;d=this._edgeView.hasObject(c);e=this._extractObjectEdgeMaterials(a);f=e.hasEdges;
g=e.perFeatureEdgeMaterials;h=!c.isHidden(c.geometryRecords[0]);if(!d)return[3,1];this._edgeView.updateAllComponentMaterials(c,g);this._edgeView.updateObjectVisibility(c,h);return[3,3];case 1:return h&&f?[4,this._edgeView.addObject(c,g)]:[3,3];case 2:b.sent(),b.label=3;case 3:return[2]}})})};q.prototype._applyFilters=function(a){var b=this._nodeId2Meta.get(a.id);b&&this._applyFiltersToObjects(a,b)};q.prototype.unhideEdgesForAllFeatures=function(a){a=a.engineObject;this._edgeView&&this._edgeView.hasObject(a)&&
this._edgeView.updateAllComponentOpacities(a,this.fullOpacity)};q.prototype._applyFiltersToObjects=function(a,b){var c=b.engineObject;c.unhideAllComponents();if(0===this._filters.length)this.unhideEdgesForAllFeatures(b);else{for(var d=b.featureIds,e=d.slice(),f=0,g=this._filters;f<g.length;f++)(0,g[f])(a,e);if(e.length===d.length)this.unhideEdgesForAllFeatures(b);else{a=0;f=c.getGeometryRecords()[0];b=Array(b.featureIds.length);for(var g=this.fullOpacity,h=0;h<d.length;h++){var k=d[h];a>=e.length||
e[a]!==k?(c.setComponentVisibility(f,h,!1),b[h]=0):(a++,b[h]=g)}this._edgeView&&this._edgeView.hasObject(c)&&this._edgeView.updateAllComponentOpacities(c,b)}}};q.prototype._removeAllNodeDataFromStage=function(){var a=this;this._nodeId2Meta.forEach(function(b,c){return a._removeNodeStageData(c)})};q.prototype._removeNodeData=function(a){var b=this;a.forEach(function(a){return b._removeNodeStageData(a.id)})};q.prototype._removeNodeStageData=function(a){var b=this._nodeId2Meta.get(a);if(b){var c=this._stage,
d=this._stageLayer,e=b.engineObject;this._highlights.objectDeleted(e);this._edgeView&&this._edgeView.removeObject(e);this.visibleGeometryChanged(e);d.removeObject(e);for(var d=0,f=e.getGeometryRecords();d<f.length;d++){var g=f[d];this.memEstimateGeometryRemoved(g.geometry.getData());c.remove(ia.GEOMETRY,g.geometry.id);for(var h=0,g=g.materials;h<g.length;h++)this._removeMaterial(g[h],c)}if(b.componentIndices){for(d=0;d<b.componentIndices.length;d++)b.componentColorBuffer.releaseIndex(b.componentIndices[d]);
this._componentColorManager.garbageCollect()}c.remove(ia.OBJECT,e.id);this._nodeId2Meta.delete(a)}};q.prototype._removeMaterial=function(a,b){b.remove(ia.MATERIAL,a.id);var c=a.metadata.i3sTexId||"none";if("none"!==c){var d=this._texId2Meta.get(c),e=d.usedByEngineMats;a=e.indexOf(a);-1<a?(e[a]=e[e.length-1],e.pop()):w.error("Missing reference from material to texture");0===e.length&&((e=d.engineTex)&&e!==this._whiteTexture&&(this.memEstimateTextureRemoved(e),b.remove(ia.TEXTURE,d.engineTex.id)),this._texId2Meta.delete(c))}};
q.prototype._setPolygonOffset=function(a,b){var c=this._nodeId2Meta.get(a.id);if(c)for(a=0,c=c.engineObject.getGeometryRecords();a<c.length;a++)for(var d=0,e=c[a].materials;d<e.length;d++)e[d].setParameterValues({polygonOffset:b})};q.prototype._rendererChange=function(a){(this._currentRenderer=a)&&(a.colorInfo||a.sizeInfo)&&w.warn("renderer.colorInfo and renderer.sizeInfo are not supported for Scene Services. Use visualVariables instead.");if(a){var b=0;for(a=a.getSymbols();b<a.length;b++){var c=
a[b];"mesh-3d"!==c.type&&w.error("Symbols of type '"+c.type+"' are not supported for 3D Object Scene Services.")}}this.view.resourceController.setMemoryDirty()};q.prototype._getRenderingInfo=function(a,b){var c=this._currentRenderer,d=c&&c.getSymbol(a);if(!(d instanceof H&&this._hasSymbolColors()))return null;var e,f;if(c&&c.visualVariables)for(a=c.getVisualVariableValues(a),c=0;c<a.length;c++){var g=a[c],h=g.variable.type;"color"===h?e=g.value:"opacity"===h&&(f=g.value)}b.symbol=d;b.color=e?[e.r/
255,e.g/255,e.b/255]:null;b.opacity=null!=f?f:e&&null!=e.a?e.a:null;return b};q.prototype._getSymbolFillMaterial=function(a,b){var c=0;for(a=a.symbolLayers.items;c<a.length;c++){var d=a[c];if("fill"===d.type){c=d.material;a=null!=c?c.color:null;null!=a?(Ga[0]=a.r/255,Ga[1]=a.g/255,Ga[2]=a.b/255,Ga[3]=a.a,b.color=Ga):b.color=null;b.colorMixMode=null!=c?c.colorMixMode:null;return}}b.color=null;b.colorMixMode=null};q.prototype._hasSymbolColors=function(){if(this._isIntegratedMesh()||!this.layer.store.defaultGeometrySchema)return!1;
var a=this.layer.store.defaultGeometrySchema.featureAttributes;return!!(a&&a.faceRange&&a.id)};q.prototype._isIntegratedMesh=function(){return this.layer instanceof D};q.prototype._hasVertexColors=function(){return null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color)};q.prototype._extractObjectEdgeMaterials=function(a){for(var b=[],c=a.featureIds?a.featureIds.length:1,d=this.layer.objectIdField,e=new h(null,
null,{}),f=e.attributes,g=this._currentRenderer&&this._currentRenderer.requiredFields,k,l=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),m=this.fullOpacity,n=!1,q=0;q<c;q++){k=l;null!=d&&null!=a.featureIds&&(f[d]=a.featureIds[q]);if(null!=g&&null!=a.attributeData)for(var p=0,t=Object.keys(a.attributeData);p<t.length;p++){var u=t[p];f[u]=N.getCachedAttributeValue(a.attributeData[u],q)}u=this._getRenderingInfo(e,Qa);p=a.engineObject;p=p.getComponentVisibility(p.getGeometryRecords()[0],
q)?m:0;if(u&&u.symbol instanceof H)for(t=0,u=u.symbol.symbolLayers.items;t<u.length;t++){var r=u[t];if(r instanceof E&&(r=X.createMaterial(this._edgeView,r,p))){n=!0;k=r;break}}b.push(k)}return{hasEdges:n,perFeatureEdgeMaterials:b}};q.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors()){for(var b=a.featureIds?a.featureIds.length:1,c=new h(null,null,{}),d=c.attributes,e=this.layer.objectIdField,f=this._currentRenderer&&this._currentRenderer.requiredFields,g=!1,k=new Uint8Array(4),
l={color:null,colorMixMode:null},m=[0,0,0,0],n=null,q=0;q<b;q++){null!=e&&null!=a.featureIds&&(d[e]=a.featureIds[q]);if(null!=f&&null!=a.attributeData)for(var p=0,t=Object.keys(a.attributeData);p<t.length;p++){var u=t[p];d[u]=N.getCachedAttributeValue(a.attributeData[u],q)}(t=this._getRenderingInfo(c,Qa))?(t.symbol!==n&&(n=t.symbol,this._getSymbolFillMaterial(t.symbol,l)),p=t.color,t=t.opacity,p=null==p||null==t?J.overrideColor(p,t,l.color,l.color&&l.color[3],qa,m):J.overrideColor(p,t,null,null,qa,
m),1>p[3]&&(g=!0),N.encodeSymbolColor(p,l.colorMixMode,k)):N.encodeSymbolColor(null,null,k);a.componentColorBuffer.textureBuffer.setData(a.componentIndices[q],0,k[0],k[1],k[2],k[3])}this._updateObjectOpacity(a.engineObject,g)}};q.prototype._setComponentIndices=function(a,b){for(var c=a.getAttribute(fa.VertexAttrConstants.COMPONENTINDEX),d=c.data,e=c.offsetIdx,c=c.strideIdx,f=a.getIndices(fa.VertexAttrConstants.COMPONENTINDEX),g=0;g<b.length;g++)for(var h=a.componentOffsets[g+1],k=a.componentOffsets[g];k<
h;k++)d[e+f[k]*c]=b[g]};q.prototype._elevationInfoChanged=function(){var a=this.layer.elevationInfo&&this.layer.elevationInfo.unit;a&&!F.supportsUnit(a)&&w.warn("elevationInfo.unit","'"+a+"' is not a valid unit")};q.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&w.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};q.prototype._reloadAll=function(){this._removeAllNodeDataFromStage();null!=this._controller&&this._controller.restartNodeLoading()};
q.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._addOrUpdateEdgeRendering(a)})};q.prototype._updateObjectOpacity=function(a,b){var c=0;for(a=a.getGeometryRecords();c<a.length;c++)for(var d=0,e=a[c].materials;d<e.length;d++){var f=e[d],g=f.metadata;void 0!==b&&(g.symbolIsTransparent=b);var h=f.getParams(),g=this._calcEngineMaterialTransparencyParams(g.i3sTex,g.i3sMatParams,g.symbolIsTransparent);h.transparent===g.transparent&&
h.layerOpacity===g.layerOpacity||f.setParameterValues(g)}};q.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};q.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};q.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};q.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};q.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=
this._createQueryEngine());return this._queryEngine};q.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new V(this.layer,{forAll:function(c,d){a._forAllFeatures(function(d,e,f){b.id=d;b.index=e;b.meta=f;a._boundingBoxCornerPoints(e,f.engineObject,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,b.meta)},requestFields:function(b,c,d){return N.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=
a._getGraphicIndices(b,c);return{node:b,indices:d}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};q.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=C.empty(),d=new Float64Array(24);return{add:function(e){T.bufferToBuffer(e.bbCorners,a,0,d,b,0,8)&&C.expandWithBuffer(c,d,0,8)},getExtent:function(){return C.toExtent(c,b)}}};
q.prototype._forAllFeatures=function(a,b,c){var d=this;this._nodeId2Meta.forEach(function(e,f){d._forAllFeaturesOfNode(e,a,c);b&&b(e.node)})};q.prototype._forAllFeaturesOfNode=function(a,b,c){for(var d=a.featureIds,e=a.engineObject.getGeometryRecords()[0],f=0;f<d.length;f++)(c||a.engineObject.getComponentVisibility(e,f))&&b(d[f],f,a,e)};q.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);if(null!=b.attributeData)for(var d=0,e=Object.keys(b.attributeData);d<
e.length;d++){var f=e[d];c[f]=N.getCachedAttributeValue(b.attributeData[f],a)}a=new h(null,null,c);a.layer=this.layer;a.sourceLayer=this.layer;return a};q.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,Fa);for(var d=0;8>d;++d)ya[0]=d&1?a[0]:a[3],ya[1]=d&2?a[1]:a[4],ya[2]=d&4?a[2]:a[5],I.mat4d.multiplyVec3(b.objectTransformation,ya),c[3*d]=ya[0],c[3*d+1]=ya[1],c[3*d+2]=ya[2];return c};q.prototype.highlight=function(a,b){var c=this,d=this._highlights;if(a instanceof
L){b=d.acquireSet(b);var e=b.set,f=b.handle;this.queryObjectIds(a).then(function(a){return d.setFeatureIds(e,a)});return f}if("number"===typeof a||a instanceof h)return this.highlight([a],b);a instanceof p&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof h)return a=a.map(function(a){return W.attributeLookup(a.attributes,c._getObjectIdField())}),f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f;if("number"===typeof a[0])return f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,
a),f}return{remove:function(){}}};q.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=x.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null}))};a([A.property()],q.prototype,"layer",void 0);a([A.property()],q.prototype,"_controller",void 0);a([A.property({dependsOn:["_controller.updating"]})],
q.prototype,"updating",void 0);a([A.property(Q.updatingPercentage)],q.prototype,"updatingPercentage",void 0);a([A.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],q.prototype,"updatingPercentageValue",void 0);a([A.property({readOnly:!0})],q.prototype,"hasTexturesOrVertexColors",null);a([A.property({readOnly:!0,dependsOn:["layer.renderer"]})],q.prototype,"rendererNeedsTextures",null);a([A.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],q.prototype,"elevationOffset",null);
a([A.property()],q.prototype,"alwaysLoadEverythingModeEnabled",void 0);a([A.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","_useCompressedTextures"]})],q.prototype,"uncompressedTextureDownsamplingEnabled",null);a([A.property({dependsOn:["layer.version"]})],q.prototype,"_useCompressedTextures",null);return q=a([A.subclass("esri.views.3d.layers.SceneLayerView3D")],q)}(A.declared(G));var ya=I.vec3d.create(),Fa=C.create(),xa=C.create(),Ga=[0,0,0,0],Qa=
{symbol:null};return g})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),function(r,g,f,a,c,b,l,e,d){return function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.supportsHeightUnitConversion=!1;return a}
f(g,d);g.prototype.postscript=function(a){this.inherited(arguments);e.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};g.prototype._validateHeightModelInfo=function(){var a=this;return c.create(function(c,d){b.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var b=e.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);b?d(b):c()})})};a([l.property()],g.prototype,"view",void 0);return g=a([l.subclass("esri.views.3d.layers.LayerView3D")],
g)}(l.declared(d))})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/promiseUtils ../../../geometry/SpatialReference ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ../lib/glMatrix ../support/meshProcessing ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),function(r,g,f,a,c,b,l,e,d,h,n,t){r=function(){function g(){}g.prototype.process=function(a){var b=[a.geometryBuffer];
return f.resolve({result:this.transform(a,b),transferList:b})};g.prototype.transform=function(f,g){var k=a.fromJSON(f.indexSR),m=a.fromJSON(f.vertexSR),q=a.fromJSON(f.renderSR),u=!1,r=0,x=[],E=f.obb?null:d.create([0,0,0],[-1,-1,-1],[0,0,0,1]);l.vec3d.set(f.center,p);p[2]+=f.elevationOffset;var H=l.mat4d.create();h.computeLinearTransformation(k,p,H,q);for(var F=0,L=f.geometryData;F<L.length;F++)for(var G=L[F],P=G.componentOffsets,J=0,G=G.geometries;J<G.length;J++){var M=G[J],O=f.layouts[r];++r;var aa=
c.interleaveGeometryBuffer(M,f.geometryBuffer,O,[{name:t.VertexAttrConstants.COLOR,byteValue:255}],[t.VertexAttrConstants.NORMAL,t.VertexAttrConstants.NORMALCOMPRESSED,t.VertexAttrConstants.SYMBOLCOLOR,t.VertexAttrConstants.COMPONENTINDEX]),V=new n(new Float32Array(aa),O),N=V.getAttribute(t.VertexAttrConstants.POSITION),S=b.reprojectPoints(N,f.center,f.elevationOffset,k,m,q);E&&this._updateObb(E,N,H);f.needNormals&&(N={normals:V.getAttribute(t.VertexAttrConstants.NORMALCOMPRESSED),positions:N,normalInd:V.getIndices(t.VertexAttrConstants.NORMALCOMPRESSED),
positionInd:V.getIndices(t.VertexAttrConstants.POSITION)},c.processAndInterleaveNormals(f.normalReferenceFrame,M,f.geometryBuffer,S.globalTrafo,N));(M=V.getAttribute(t.VertexAttrConstants.COMPONENTINDEX))&&this._createComponentNumbers(M,P);(V=V.getAttribute(t.VertexAttrConstants.COLOR))&&!u&&(u=this._hasColors(V));V=O[0].stride;V=e.deduplicate(aa,V/4,1-.8*V/(V+4));null!=V?(aa=65536>V.uniqueCount?new Uint16Array(V.indices):V.indices,x.push({layout:O,interleavedVertexData:V.buffer,indices:aa,corMatrices:S,
hasColors:u}),g&&(g.push(V.buffer),g.push(aa.buffer))):(x.push({layout:O,interleavedVertexData:aa,corMatrices:S,hasColors:u}),g&&g.push(aa))}E&&(l.mat4d.multiplyVec3(H,E.center,E.center),h.vectorToVector(E.center,q,E.center,m),E.center[2]-=f.elevationOffset);return{geometryBuffer:f.geometryBuffer,transformedGeometries:x,obb:E}};g.prototype._hasColors=function(a){var b=a.data,c=a.size,d=a.strideIdx;for(a=a.offsetIdx;a<b.length;a+=d)for(var e=0;e<c;e++)if(255!==b[a+e])return!0;return!1};g.prototype._createComponentNumbers=
function(a,b){var c=a.data,d=a.strideIdx,e=c.length/d,f=0;a=a.offsetIdx;for(var g=0;g<e;g++)g>=b[f+1]&&f++,c[a]=f,a+=d};g.prototype._updateObb=function(a,b,c){if(0<a.halfSize[0]){l.vec3.subtract(a.center,a.halfSize,p);l.vec3.add(a.center,a.halfSize,k);for(c=b.offsetIdx;c<b.data.length;c+=b.strideIdx)p[0]=Math.min(p[0],b.data[c]),p[1]=Math.min(p[1],b.data[c+1]),p[2]=Math.min(p[2],b.data[c+2]),k[0]=Math.max(k[0],b.data[c]),k[1]=Math.max(k[1],b.data[c+1]),k[2]=Math.max(k[2],b.data[c+2]);l.vec3.subtract(k,
p,a.halfSize);l.vec3d.scale(a.halfSize,.5);l.vec3d.add(p,k,a.center);l.vec3d.scale(a.center,.5)}else d.compute(b,a),b=2*Math.sqrt(1+c[0]+c[5]+c[10]),q[0]=(c[9]-c[6])/b,q[1]=(c[2]-c[8])/b,q[2]=(c[4]-c[1])/b,q[3]=.25*b,l.quat4.conjugate(q),l.quat4.multiply(q,a.quaternion,a.quaternion)};return g}();var p=l.vec3d.create(),k=l.vec3d.create(),q=l.quat4.create();return r})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ./I3SBinaryReader ../../support/meshProcessing ../../webgl-engine/lib/gl-matrix ../../webgl-engine/lib/Util".split(" "),
function(r,g,f,a,c,b){function l(a,b,c,d,e,f,g){switch(c){case 1:for(c=0;c<g;c++)d[e]=a[b],b+=1,e+=f;break;case 2:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],b+=2,e+=f;break;case 3:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],b+=3,e+=f;break;case 4:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],d[e+3]=a[b+3],b+=4,e+=f;break;default:throw t("Unhandled stride size "+c);}}function e(a,b,c,d,e,f){switch(b){case 1:for(b=0;b<f;b++)c[d]=a,d+=e;break;case 2:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,d+=
e;break;case 3:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,d+=e;break;case 4:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,c[d+3]=a,d+=e;break;default:throw t("Unhandled stride size "+b);}}function d(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function h(a){switch(a){case 5120:return"Int8";case 5126:return"Float32";
case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function n(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function t(a){return Error("I3SGeometryUtil processing failed: "+a)}Object.defineProperty(g,"__esModule",{value:!0});var p=new Uint8Array(64);g.interleaveGeometryBuffer=function(a,b,c,f,g){void 0===f&&(f=[]);void 0===g&&(g=[]);var k=a.params.vertexAttributes,m=k.position.count;
if(!n(c[0].stride))throw t("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var q=new Uint32Array(c[0].stride/Uint32Array.BYTES_PER_ELEMENT*m);c=c.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==g.indexOf(a.name))return"continue";var c=k[a.name],r=d(a.type),u=void 0,v=!1;if(null==c)if(v=f.filter(function(b){return b.name===a.name})[0]){c={valueType:h(a.type),byteOffset:0,count:m,valuesPerElement:a.count};for(u=0;u<p.length;u++)p[u]=v.byteValue;u=
p.buffer;v=!0}else throw t("Geometry definition is missing attribute");else u=b;if(h(a.type)!==c.valueType)throw t("Geometry definition type must match attribute type");if(0!==c.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw t(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!n(c.valuesPerElement*r.BYTES_PER_ELEMENT)||!n(a.count*r.BYTES_PER_ELEMENT))throw t(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var u=
new Uint32Array(u),x=c.byteOffset/Uint32Array.BYTES_PER_ELEMENT,c=c.valuesPerElement*r.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,r=a.offset/Uint32Array.BYTES_PER_ELEMENT,y=a.stride/Uint32Array.BYTES_PER_ELEMENT;v?e(u[0],c,q,r,y,m):l(u,x,c,q,r,y,m)};for(var r=0;r<c.length;r++)a(c[r]);return q.buffer};g.processAndInterleaveNormals=function(a,d,e,g,h){if("none"===a){var l=h.normals,m=h.positions;d=h.normalInd;a=h.positionInd;b.assert(h.normalInd.length===h.positionInd.length);h=c.vec3.create();
g=c.vec3.create();e=c.vec2.create();for(var n=m.data,p=m.offsetIdx,m=m.strideIdx,t=l.data,r=l.offsetIdx,l=l.strideIdx,u=0;u<a.length;u+=3){var v=a[u],v=p+m*v,x=n[v],y=n[v+1],J=n[v+2],v=a[u+1],v=p+m*v;h[0]=n[v]-x;h[1]=n[v+1]-y;h[2]=n[v+2]-J;v=a[u+2];v=p+m*v;g[0]=n[v]-x;g[1]=n[v+1]-y;g[2]=n[v+2]-J;c.vec3.cross(h,g,h);b.encodeNormal(h,e);for(x=0;3>x;x++)y=r+l*d[u+x],t[y]=b.encodeInt16(e[0]),t[y+1]=b.encodeInt16(e[1])}}else if(d=f.createTypedView(e,d.params.vertexAttributes.normal),e=h.normals,y="earth-centered"===
a?g:null,a=d.length/3,h=e.data,g=e.offsetIdx,e=e.strideIdx,null!=y)for(n=y[0],p=y[1],m=y[2],t=y[4],r=y[5],l=y[6],u=y[8],x=y[9],y=y[10],J=0;J<a;J++){var v=d[3*J],M=d[3*J+1],O=d[3*J+2];k[0]=n*v+p*M+m*O;k[1]=t*v+r*M+l*O;k[2]=u*v+x*M+y*O;b.encodeNormal(k,q);h[g+J*e]=b.encodeInt16(q[0]);h[g+J*e+1]=b.encodeInt16(q[1])}else for(J=0;J<a;J++)k[0]=d[3*J],k[1]=d[3*J+1],k[2]=d[3*J+2],b.encodeNormal(k,q),h[g+J*e]=b.encodeInt16(q[0]),h[g+J*e+1]=b.encodeInt16(q[1])};g.extractPositionData=function(b,c,d){c=c[0];
if(null==c||"position"!==c.name||5126!==c.type)return null;var e=new Float32Array(b),f=c.stride/4,g=3*e.length/f,h=new Float32Array(g);for(b=0;b<g/3;b++)h[3*b]=e[b*f+c.offset],h[3*b+1]=e[b*f+c.offset+1],h[3*b+2]=e[b*f+c.offset+2];c=a.deduplicate(h.buffer,3);b=65536>c.uniqueCount;if(d)for(e=new (b?Uint16Array:Uint32Array)(d.length),b=0;b<d.length;b++)e[b]=c.indices[d[b]];else e=b?new Uint16Array(c.indices):c.indices;return{data:new Float32Array(c.buffer),indices:e}};var k=c.vec3.create(),q=c.vec2.create()})},
"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports dojo/_base/lang ../../../../core/Error ../../../../core/Logger ./LEPCC".split(" "),function(r,g,f,a,c,b){function l(b,c,d){for(var e="",f=0;f<d;){var g=b[c+f];if(128>g)e+=String.fromCharCode(g),f++;else if(192<=g&&224>g){if(f+1>=d)throw new a("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var h=b[c+f+1],g=(g&31)<<6|h&63,e=e+String.fromCharCode(g),f=f+2}else if(224<=g&&240>g){if(f+2>=d)throw new a("utf8-decode-error",
"UTF-8 Decode failed. Multi byte character was truncated.");var h=b[c+f+1],k=b[c+f+2],g=(g&15)<<12|(h&63)<<6|k&63,e=e+String.fromCharCode(g),f=f+3}else if(240<=g&&248>g){if(f+3>=d)throw new a("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");h=b[c+f+1];k=b[c+f+2];g=(g&7)<<18|(h&63)<<12|(k&63)<<6|b[c+f+3]&63;e=65536<=g?e+String.fromCharCode((g-65536>>10)+55296,(g&1023)+56320):e+String.fromCharCode(g);f+=4}else throw new a("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");
}return e}function e(a,b){for(var c={byteOffset:0,byteCount:0,fields:Object.create(null)},d=0,e=0;e<b.length;e++){var f=b[e],h=f.valueType||f.type;c.fields[f.property]=(0,g.valueType2ArrayBufferReader[h])(a,d);d+=g.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}c.byteCount=d;return c}function d(b,c,d){var e=[],f,g=0,h;for(h=0;h<b;h+=1){f=c[h];if(0<f){if(e.push(l(d,g,f-1)),0!==d[g+f-1])throw new a("string-array-error","Invalid string array: missing null termination.");}else e.push(null);g+=f}return e}
function h(a,b){return new g.valueType2TypedArrayClassMap[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}function n(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function t(b,c,d){b=null!=c.header?e(b,c.header):{byteOffset:0,byteCount:0,fields:{count:d}};d={header:b,byteOffset:b.byteCount,byteCount:0,entries:Object.create(null)};for(var g=b.byteCount,h=0;h<c.ordering.length;h++){var l=c.ordering[h],m=f.clone(c[l]);m.count=b.fields.count;if("String"===m.valueType){if(m.byteOffset=
g,m.byteCount=b.fields[l+"ByteCount"],"UTF-8"!==m.encoding)throw new a("unsupported-encoding","Unsupported String encoding.",{encoding:m.encoding});}else if(k(m.valueType)){var n=q(m.valueType),g=g+(0!==g%n?n-g%n:0);m.byteOffset=g;m.byteCount=n*m.valuesPerElement*m.count}else throw new a("unsupported-value-type","Unsupported binary valueType",{valueType:m.valueType});g+=m.byteCount;d.entries[l]=m}d.byteCount=g-d.byteOffset;return d}function p(b,c,d){c!==b&&m.error("Invalid "+d+" buffer size\n expected: "+
b+", actual: "+c+")");if(c<b)throw new a("buffer-too-small","Binary buffer is too small",{expectedSize:b,actualSize:c});}function k(a){return g.valueType2TypedArrayClassMap.hasOwnProperty(a)}function q(a){return k(a)&&g.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(g,"__esModule",{value:!0});var m=c.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");g.readHeader=e;g.readStringArray=d;g.createTypedView=h;g.createRawView=n;g.createAttributeDataIndex=t;g.createGeometryDataIndex=
function(a,b,c){var d=e(a,b&&b.header),g=d.byteCount,h={header:d,byteOffset:d.byteCount,byteCount:0,vertexAttributes:f.clone(b.vertexAttributes)},k=h.vertexAttributes;c||null==k.region||delete k.region;var d=d.fields,l=null!=d.vertexCount?d.vertexCount:d.count;for(c=0;c<b.ordering.length;c++){var m=b.ordering[c];null!=k[m]&&(k[m].byteOffset=g,k[m].count=l,g+=q(k[m].valueType)*k[m].valuesPerElement*l)}k=d.faceCount;if(b.faces&&k)for(h.faces=f.clone(b.faces),l=h.faces,c=0;c<b.ordering.length;c++)m=
b.ordering[c],null!=l[m]&&(l[m].byteOffset=g,l[m].count=k,g+=q(l[m].valueType)*l[m].valuesPerElement*k);d=d.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&d)for(h.featureAttributes=f.clone(b.featureAttributes),k=h.featureAttributes,c=0;c<b.featureAttributeOrder.length;c++)l=b.featureAttributeOrder[c],k[l].byteOffset=g,k[l].count=d,m=q(k[l].valueType),"UInt64"===k[l].valueType&&(m=8),g+=m*k[l].valuesPerElement*d;p(g,a.byteLength,"geometry");h.byteCount=g-h.byteOffset;return h};g.readBinaryAttribute=
function(c,e,f){if("lepcc-rgb"===c.encoding)return b.decodeRGB(e);if("lepcc-intensity"===c.encoding)return b.decodeIntensity(e);if(null!=c.encoding&&""!==c.encoding)throw new a("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");c["attributeByteCounts "]&&!c.attributeByteCounts&&(m.warn("Warning: Trailing space in 'attributeByteCounts '."),c.attributeByteCounts=c["attributeByteCounts "]);"ObjectIds"===c.ordering[0]&&c.hasOwnProperty("objectIds")&&(m.warn("Warning: Case error in objectIds"),
c.ordering[0]="objectIds");f=t(e,c,f);p(f.byteOffset+f.byteCount,e.byteLength,"attribute");if(c=f.entries.attributeValues||f.entries.objectIds){if("String"===c.valueType){f=f.entries.attributeByteCounts;var g=h(e,f);e=n(e,c);return d(f.count,g,e)}return h(e,c)}throw new a("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};g.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,
Int32:Int32Array};g.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,
b){return(new DataView(a,0)).getInt32(b,!0)}};g.isValueType=k;g.getBytesPerValue=q})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(r,g,f){function a(a,b,c){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,c+l.identifierOffset,l.identifierLength)),version:b.getUint16(c+l.versionOffset,!0),checksum:b.getUint32(c+l.checksumOffset,!0)}}function c(a,c,f){var d=[];c=b(a,c,d);for(var e=[],g=0;g<d.length;g++){e.length=0;c=b(a,
c,e);for(var h=0;h<e.length;h++)f.push(e[h]+d[g])}return c}function b(a,b,c){var d=new DataView(a,b),e=d.getUint8(0),g=e&31,h=!!(e&32),l=(e&192)>>6,e=0;if(0===l)e=d.getUint32(1,!0),b+=5;else if(1===l)e=d.getUint16(1,!0),b+=3;else if(2===l)e=d.getUint8(1),b+=2;else throw new f("lepcc-decode-error","Bad count type");if(h)throw new f("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,b,Math.ceil(e*g/8));for(var l=h=d=0,m=-1>>>32-g,r=0;r<e;r++){for(;h<g;)d|=a[l]<<h,h+=8,l+=1;c[r]=d&m;d>>>=
g;h-=g;32<h+g&&(d|=a[l-1]>>8-h)}return b+l}Object.defineProperty(g,"__esModule",{value:!0});var l={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};g.decodeXYZ=function(b){var d,e,g,t,p,k,q,m,r,x,v,y,A=new DataView(b,0),C=0;t=a(b,A,C);g=t.identifier;t=t.version;C+=l.byteCount;if("LEPCC     "!==g)throw new f("lepcc-decode-error","Bad identifier");if(1<t)throw new f("lepcc-decode-error","Unknown version");var B=C;d=A.getUint32(B+0,!0);e=A.getUint32(B+4,!0);g=A.getFloat64(B+
8,!0);t=A.getFloat64(B+16,!0);p=A.getFloat64(B+24,!0);k=A.getFloat64(B+32,!0);q=A.getFloat64(B+40,!0);m=A.getFloat64(B+48,!0);r=A.getFloat64(B+56,!0);x=A.getFloat64(B+64,!0);v=A.getFloat64(B+72,!0);y=A.getUint32(B+80,!0);A.getUint32(B+84,!0);C+=88;if(e*Math.pow(2,32)+d!==b.byteLength)throw new f("lepcc-decode-error","Bad size");A=new Float64Array(3*y);d=[];e=[];y=[];B=[];C=c(b,C,d);C=c(b,C,e);C=c(b,C,y);C=c(b,C,B);if(C!==b.byteLength)throw new f("lepcc-decode-error","Bad length");for(var D=C=b=0;D<
d.length;D++)for(var C=C+d[D],E=0,H=0;H<e[D];H++){var E=E+y[b],F=B[b];A[3*b]=Math.min(k,g+2*r*E);A[3*b+1]=Math.min(q,t+2*x*C);A[3*b+2]=Math.min(m,p+2*v*F);b++}return{errorX:r,errorY:x,errorZ:v,result:A}};g.decodeRGB=function(b){var c,e,g,t,p,k,q=new DataView(b,0),m=0;t=a(b,q,m);g=t.identifier;t=t.version;m+=l.byteCount;if("ClusterRGB"!==g)throw new f("lepcc-decode-error","Bad identifier");if(1<t)throw new f("lepcc-decode-error","Unknown version");k=m;c=q.getUint32(k+0,!0);e=q.getUint32(k+4,!0);g=
q.getUint32(k+8,!0);t=q.getUint16(k+12,!0);p=q.getUint8(k+14);k=q.getUint8(k+15);m+=16;if(e*Math.pow(2,32)+c!==b.byteLength)throw new f("lepcc-decode-error","Bad size");if(2!==p&&1!==p||0!==k){if(0===p&&0===k){if(3*g+m!==b.byteLength||0!==t)throw new f("lepcc-decode-error","Bad count");return(new Uint8Array(b,m)).slice()}if(2>=p&&1===k){if(m+3!==b.byteLength||1!==t)throw new f("lepcc-decode-error","Bad count");t=q.getUint8(m);c=q.getUint8(m+1);q=q.getUint8(m+2);m=new Uint8Array(3*g);for(b=0;b<g;b++)m[3*
b]=t,m[3*b+1]=c,m[3*b+2]=q;return m}throw new f("lepcc-decode-error","Bad method "+p+","+k);}if(3*t+g+m!==b.byteLength||256<t)throw new f("lepcc-decode-error","Bad count");q=new Uint8Array(b,m,3*t);t=new Uint8Array(b,m+3*t,g);m=new Uint8Array(3*g);for(b=0;b<g;b++)c=t[b],m[3*b]=q[3*c],m[3*b+1]=q[3*c+1],m[3*b+2]=q[3*c+2];return m};g.decodeIntensity=function(c){var d,e,g,t,p,k=new DataView(c,0),q=0;t=a(c,k,q);g=t.identifier;t=t.version;q+=l.byteCount;if("Intensity "!==g)throw new f("lepcc-decode-error",
"Bad identifier");if(1<t)throw new f("lepcc-decode-error","Unknown version");var m=q;d=k.getUint32(m+0,!0);e=k.getUint32(m+4,!0);g=k.getUint32(m+8,!0);t=k.getUint16(m+12,!0);p=k.getUint8(m+14);k.getUint8(m+15);q+=16;if(e*Math.pow(2,32)+d!==c.byteLength)throw new f("lepcc-decode-error","Bad size");k=new Uint16Array(g);if(8===p){if(g+q!==c.byteLength)throw new f("lepcc-decode-error","Bad size");p=new Uint8Array(c,q,g)}else if(16===p){if(2*g+q!==c.byteLength)throw new f("lepcc-decode-error","Bad size");
p=new Uint16Array(c,q,g)}else if(p=[],b(c,q,p)!==c.byteLength)throw new f("lepcc-decode-error","Bad size");for(c=0;c<g;c++)k[c]=p[c]*t;return k}})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["require","exports","../../lib/glMatrix","../../support/projectionUtils"],function(r,g,f,a){Object.defineProperty(g,"__esModule",{value:!0});g.ReprojectionTypes={PER_VERTEX:"perVertex",NO_REPROJECTION:"noReprojection"};var c=new Float64Array(3E3),b=f.vec3d.create();g.reprojectPoints=function(g,
e,d,h,n,t){var l=g.data,k=g.offsetIdx;g=g.strideIdx;f.vec3d.set(e,b);b[2]+=d;e=f.mat4d.create();a.computeLinearTransformation(h,b,e,t);d=f.mat4d.create();f.mat4d.inverse(e,d);var q=f.mat4d.create();f.mat4d.identity(q);var m=[0,0,0],r=l.length/g;a.vectorToVector(b,h,m,n);for(h=0;h<r;h+=1E3){for(var x=Math.min(1E3,r-h),v=0;v<x;v++){var y=k+g*(h+v);c[3*v]=l[y]+m[0];c[3*v+1]=l[y+1]+m[1];c[3*v+2]=l[y+2]+m[2]}a.bufferToBuffer(c,n,0,c,t,0,x);for(v=0;v<x;v++){var y=c[3*v],A=c[3*v+1],C=c[3*v+2],B=k+g*(h+v);
l[B]=d[0]*y+d[4]*A+d[8]*C+d[12];l[B+1]=d[1]*y+d[5]*A+d[9]*C+d[13];l[B+2]=d[2]*y+d[6]*A+d[10]*C+d[14]}}return{localTrafo:q,globalTrafo:e}}})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/glMatrix ./dito ./geometryUtils".split(" "),function(r,g,f,a,c,b){function l(b,c,d){return{center:a.vec3d.createFrom(b[0],b[1],b[2]),halfSize:n.createFrom(c[0],c[1],c[2]),quaternion:h.createFrom(d[0],d[1],d[2],d[3])}}function e(a,c){var e=
b.plane.distance(c,a.center);a=d(a,c);return e>a?1:e<-a?-1:0}function d(a,b){h.conjugate(a.quaternion,t);h.multiplyVec3(t,b,p);a=a.halfSize;return Math.abs(p[0]*a[0])+Math.abs(p[1]*a[1])+Math.abs(p[2]*a[2])}Object.defineProperty(g,"__esModule",{value:!0});var h=a.quat4,n=a.vec3;r=a.mat3d;var t=h.create(),p=n.create(),k=n.create(),q=r.create();r=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:new Float64Array(this.buffer,56*
b+0,3),halfSize:new Float32Array(this.buffer,56*b+24,3),quaternion:new Float32Array(this.buffer,56*b+36,4)}}}();g.ObbArray=r;g.create=l;g.clone=function(a){return l(a.center,a.halfSize,a.quaternion)};g.set=function(b,c){a.vec3d.set(b.center,c.center);a.vec3.set(b.halfSize,c.halfSize);a.quat4.set(b.quaternion,c.quaternion)};g.compute=function(a,b){b||(b=l([0,0,0],[-1,-1,-1],[0,0,0,1]));c.computeOBB(a,b);return b};g.intersectPlane=e;g.toAaBoundingBox=function(a,b){b||(b=f.create());var c=h.toMat3(a.quaternion,
q),d=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),e=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-d;b[1]=a.center[1]-e;b[2]=a.center[2]-c;b[3]=a.center[0]+d;b[4]=a.center[1]+e;b[5]=a.center[2]+c;return b};g.minimumDistancePlane=function(a,c){var e=b.plane.distance(c,a.center);a=d(a,c);return e-a};g.maximumDistancePlane=
function(a,c){var e=b.plane.distance(c,a.center);a=d(a,c);return e+a};g.isVisible=function(a,b){return 0>=e(a,b[0])&&0>=e(a,b[1])&&0>=e(a,b[2])&&0>=e(a,b[3])&&0>=e(a,b[4])&&0>=e(a,b[5])};g.intersectLine=function(b,c,d,e){void 0===e&&(e=0);h.conjugate(b.quaternion,t);a.vec3.subtract(c,b.center,p);c=h.multiplyVec3(t,p,p);d=h.multiplyVec3(t,d,k);for(var f=-Infinity,g=Infinity,l=0;3>l;l++)if(1E-6<Math.abs(d[l]))var m=(e+b.halfSize[l]-c[l])/d[l],n=(-e-b.halfSize[l]-c[l])/d[l],f=Math.max(f,Math.min(m,n)),
g=Math.min(g,Math.max(m,n));else if(c[l]>b.halfSize[l]+e||c[l]<-b.halfSize[l]-e)return!1;return f<=g}})},"esri/views/3d/support/dito":function(){define(["require","exports","../lib/glMatrix"],function(r,g,f){function a(a,b,e,g,h,k){if(!(1E-6>f.vec3d.length2(b)))for(f.vec3d.cross(e,b,C),f.vec3d.cross(g,b,B),f.vec3d.cross(h,b,D),c(a,b,A),H[1]=A[0],E[1]=A[1],F[1]=E[1]-H[1],e=[e,g,h],g=[C,B,D],h=0;3>h;++h){c(a,e[h],A);H[0]=A[0];E[0]=A[1];c(a,g[h],A);H[2]=A[0];E[2]=A[1];F[0]=E[0]-H[0];F[2]=E[2]-H[2];var l=
d(F);l<k.quality&&(f.vec3d.set(e[h],k.b0),f.vec3d.set(b,k.b1),f.vec3d.set(g[h],k.b2),k.quality=l)}}function c(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],f);c[1]=Math.max(c[1],f)}}function b(a,b,c){f.vec3d.set(a,c.center);f.vec3d.scale(b,.5,c.halfSize);f.quat4.identity(c.quaternion)}function l(a,b,d,e,f,g){c(a,b,A);f[0]=A[0];g[0]=A[1];c(a,d,A);f[1]=A[0];g[1]=
A[1];c(a,e,A);f[2]=A[0];g[2]=A[1]}function e(a,b,c,d,e,g,h){N[0]=a[0];N[3]=a[1];N[6]=a[2];N[1]=b[0];N[4]=b[1];N[7]=b[2];N[2]=c[0];N[5]=c[1];N[8]=c[2];f.quat4.fromRotationMatrix(N,h.quaternion);f.vec3d.add(d,e,S);f.vec3d.scale(S,.5);f.vec3d.scale(a,S[0],h.center);f.vec3d.scale(b,S[1],V);f.vec3d.add(h.center,V);f.vec3d.scale(c,S[2],V);f.vec3d.add(h.center,V);f.vec3d.scale(g,.5,h.halfSize)}function d(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}Object.defineProperty(g,"__esModule",{value:!0});var h=f.vec3d.create(),
n=f.vec3d.create();g.computeOBB=function(c,g){var r=c.data.length/c.strideIdx;if(!(0>=r)){var C=new W(c);f.vec3d.add(C.minProj,C.maxProj,h);f.vec3d.scale(h,.5);f.vec3d.subtract(C.maxProj,C.minProj,n);var B=d(n),D=new X;D.quality=B;14>r&&(c={data:new Float64Array(C.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var E=f.vec3d.create(),I=f.vec3d.create(),F=f.vec3d.create(),r=f.vec3d.create(),H=f.vec3d.create(),N=f.vec3d.create(),Q=f.vec3d.create(),V;V=c;for(var S=f.vec3d.dist2(C.maxVert[0],C.minVert[0]),
U=0,la=1;7>la;++la){var sa=f.vec3d.dist2(C.maxVert[la],C.minVert[la]);sa>S&&(S=sa,U=la)}f.vec3d.set(C.minVert[U],E);f.vec3d.set(C.maxVert[U],I);if(1E-6>f.vec3d.dist2(E,I))V=1;else{f.vec3d.subtract(E,I,r);f.vec3d.normalize(r);C=V.data;S=V.strideIdx;U=Number.NEGATIVE_INFINITY;la=0;for(sa=V.offsetIdx;sa<C.length;sa+=S){f.vec3d.set3(C[sa]-E[0],C[sa+1]-E[1],C[sa+2]-E[2],y);var ia=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],w=f.vec3d.length2(r),ia=f.vec3d.length2(y)-ia*ia/w;ia>U&&(U=ia,la=sa)}f.vec3d.set3(C[la],C[la+
1],C[la+2],F);1E-6>U?V=2:(f.vec3d.subtract(I,F,H),f.vec3d.normalize(H),f.vec3d.subtract(F,E,N),f.vec3d.normalize(N),f.vec3d.cross(H,r,Q),f.vec3d.normalize(Q),a(V,Q,r,H,N,D),V=0)}switch(V){case 1:b(h,n,g);return;case 2:B=c;f.vec3d.set(r,G);Math.abs(r[0])>Math.abs(r[1])&&Math.abs(r[0])>Math.abs(r[2])?G[0]=0:Math.abs(r[1])>Math.abs(r[2])?G[1]=0:G[2]=0;1E-6>f.vec3d.length2(G)&&(G[0]=G[1]=G[2]=1);f.vec3d.cross(r,G,P);f.vec3d.normalize(P);f.vec3d.cross(r,P,J);f.vec3d.normalize(J);l(B,r,P,J,M,O);f.vec3d.subtract(O,
M,aa);e(r,P,J,M,O,aa,g);return}V=c;C=t;S=p;U=A;la=V.data;ia=V.offsetIdx;sa=V.strideIdx;f.vec3d.set3(la[ia],la[ia+1],la[ia+2],S);f.vec3d.set(S,C);U[0]=f.vec3d.dot(L,Q);U[1]=U[0];for(ia+=sa;ia<la.length;ia+=sa)f.vec3d.set3(la[ia],la[ia+1],la[ia+2],L),w=f.vec3d.dot(L,Q),w<U[0]&&(U[0]=w,f.vec3d.set(L,S)),w>U[1]&&(U[1]=w,f.vec3d.set(L,C));Q=f.vec3.dot(E,Q);A[1]-1E-6<=Q&&(C[0]=void 0);A[0]+1E-6>=Q&&(S[0]=void 0);void 0!==t[0]&&(f.vec3d.subtract(t,E,k),f.vec3d.normalize(k),f.vec3d.subtract(t,I,q),f.vec3d.normalize(q),
f.vec3d.subtract(t,F,m),f.vec3d.normalize(m),f.vec3d.cross(q,r,u),f.vec3d.normalize(u),f.vec3d.cross(m,H,x),f.vec3d.normalize(x),f.vec3d.cross(k,N,v),f.vec3d.normalize(v),a(V,u,r,q,k,D),a(V,x,H,m,q,D),a(V,v,N,k,m,D));void 0!==p[0]&&(f.vec3d.subtract(p,E,k),f.vec3d.normalize(k),f.vec3d.subtract(p,I,q),f.vec3d.normalize(q),f.vec3d.subtract(p,F,m),f.vec3d.normalize(m),f.vec3d.cross(q,r,u),f.vec3d.normalize(u),f.vec3d.cross(m,H,x),f.vec3d.normalize(x),f.vec3d.cross(k,N,v),f.vec3d.normalize(v),a(V,u,r,
q,k,D),a(V,x,H,m,q,D),a(V,v,N,k,m,D));l(c,D.b0,D.b1,D.b2,M,O);c=f.vec3d.create();f.vec3d.subtract(O,M,c);D.quality=d(c);D.quality<B?e(D.b0,D.b1,D.b2,M,O,c,g):b(h,n,g)}};var t=f.vec3d.create(),p=f.vec3d.create(),k=f.vec3d.create(),q=f.vec3d.create(),m=f.vec3d.create(),u=f.vec3d.create(),x=f.vec3d.create(),v=f.vec3d.create(),y=f.vec3d.create(),A=f.vec2d.create(),C=f.vec3d.create(),B=f.vec3d.create(),D=f.vec3d.create(),E=f.vec3d.create(),H=f.vec3d.create(),F=f.vec3d.create(),L=f.vec3d.create(),G=f.vec3d.create(),
P=f.vec3d.create(),J=f.vec3d.create(),M=f.vec3d.create(),O=f.vec3d.create(),aa=f.vec3d.create(),V=f.vec3d.create(),N=f.mat3d.create(),S=f.vec3d.create(),W=function(){return function(a){this.minVert=[];this.maxVert=[];this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(b+=56;7>this.minVert.length;)this.minVert.push(new Float64Array(this.buffer,b,3)),b+=24;for(;7>this.maxVert.length;)this.maxVert.push(new Float64Array(this.buffer,
b,3)),b+=24;for(b=0;7>b;++b)this.minProj[b]=Number.POSITIVE_INFINITY,this.maxProj[b]=Number.NEGATIVE_INFINITY;for(var c=[],d=[],e=a.data,g=a.strideIdx,b=a.offsetIdx;b<e.length;b+=g)a=e[b],a<this.minProj[0]&&(this.minProj[0]=a,c[0]=b),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=b),a=e[b+1],a<this.minProj[1]&&(this.minProj[1]=a,c[1]=b),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=b),a=e[b+2],a<this.minProj[2]&&(this.minProj[2]=a,c[2]=b),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=b),a=e[b]+e[b+1]+e[b+2],
a<this.minProj[3]&&(this.minProj[3]=a,c[3]=b),a>this.maxProj[3]&&(this.maxProj[3]=a,d[3]=b),a=e[b]+e[b+1]-e[b+2],a<this.minProj[4]&&(this.minProj[4]=a,c[4]=b),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=b),a=e[b]-e[b+1]+e[b+2],a<this.minProj[5]&&(this.minProj[5]=a,c[5]=b),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=b),a=e[b]-e[b+1]-e[b+2],a<this.minProj[6]&&(this.minProj[6]=a,c[6]=b),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=b);for(b=0;7>b;++b)a=c[b],f.vec3d.set3(e[a],e[a+1],e[a+2],this.minVert[b]),
a=d[b],f.vec3d.set3(e[a],e[a+1],e[a+2],this.maxVert[b])}}(),X=function(){return function(){this.b0=f.vec3d.createFrom(1,0,0);this.b1=f.vec3d.createFrom(0,1,0);this.b2=f.vec3d.createFrom(0,0,1);this.quality=0}}()})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(r,g,f){var a=function(){return function(a){this.highlightSet=new f;this.ids=new Set;this.options=a}}();return function(){function c(a){this.highlights=[];this.layerView=
a}c.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};c.prototype.acquireSet=function(b){var c=this,e=new a(b);this.highlights.push(e);return{set:e,handle:{remove:function(){return c.releaseSet(e)}}}};c.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};c.prototype.setFeatureIds=function(a,c){c.forEach(function(b){return a.ids.add(b)});
this.layerView._forAllFeatures(function(b,c,f,g){a.ids.has(b)&&(b=f.engineObject.setComponentHighlight(g,c,a.options),a.highlightSet.addObject(f.engineObject,b))},null,!0)};c.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(c){b.layerView._forAllFeaturesOfNode(b.layerView._getMetadata(a),function(b,e,f,g){c.ids.has(b)&&(b=a.setComponentHighlight(g,e,c.options),c.highlightSet.addObject(a,b))},!0)})};c.prototype.objectDeleted=function(a){this.highlights.forEach(function(b){b.highlightSet.removeObject(a)})};
c.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return c}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(r,g){return function(){function f(){this.items=[]}f.prototype.addObject=function(a,c){this.items.push({type:"object",highlightId:c,object:a})};f.prototype.addRenderGeometry=function(a,c,b){this.items.push({type:"renderGeometry",highlightId:b,renderGeometry:a,renderer:c})};f.prototype.removeObject=
function(a){for(var c=this.items.length-1;0<=c;--c){var b=this.items[c];"object"===b.type&&b.object===a&&(b.object.removeHighlights(b.highlightId),this.items.splice(c,1))}};f.prototype.removeRenderGeometry=function(a){for(var c=this.items.length-1;0<=c;--c){var b=this.items[c];"renderGeometry"===b.type&&b.renderGeometry===a&&(b.renderer.removeRenderGeometryHighlight(b.renderGeometry,b.highlightId),this.items.splice(c,1))}};f.prototype.removeAll=function(){this.items.forEach(function(a){"object"===
a.type?a.object.removeHighlights(a.highlightId):"renderGeometry"===a.type&&a.renderer.removeRenderGeometryHighlight(a.renderGeometry,a.highlightId)});this.items=[]};return f}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../lib/glMatrix ../../support/Evented ../../webgl-engine/lib/Selector".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t){var p=e.empty(),k={spatialReference:null,extent:p},q=h.vec3d.create(),m=h.vec3d.create(),u=h.vec3d.create(),x=b.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function c(a){return b.call(this)||this}f(c,b);c.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new t(this.layerView.view.viewingMode);var a=this.layerView.layer.fullExtent;this.zmin=
a.zmin;this.zmax=a.zmax};c.prototype.getElevation=function(a){if(d.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,q))return x.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,q))return x.error("could not project point for elevation alignment"),-Infinity;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;h.vec3d.set(q,m);h.vec3d.set(q,u);this.renderCoordsHelper.setAltitude(b,m);this.renderCoordsHelper.setAltitude(a,
u);this.selector.init(this.intersectLayers,m,u,null,null,1,!1);return this.selector.getMinResult().getIntersectionPoint(q)?this.renderCoordsHelper.getAltitude(q):-Infinity};c.prototype.layerChanged=function(){this.spatialReference&&(k.extent=this.computeLayerExtent(this.intersectLayers[0]),k.spatialReference=this.spatialReference,this.emit("elevation-change",k))};c.prototype.objectChanged=function(a){this.spatialReference&&(k.extent=this.computeObjectExtent(a),k.spatialReference=this.spatialReference,
this.emit("elevation-change",k))};c.prototype.computeObjectExtent=function(a){e.empty(p);this.expandExtent(a,p);return p};c.prototype.computeLayerExtent=function(a){e.empty(p);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],p);return p};c.prototype.expandExtent=function(a,b){for(var c=a.getBBMin(!0),d=a.getBBMax(!0),f=0;8>f;++f)q[0]=f&1?c[0]:d[0],q[1]=f&2?c[1]:d[1],q[2]=f&4?c[2]:d[2],h.mat4d.multiplyVec3(a.objectTransformation,q),this.renderCoordsHelper.fromRenderCoords(q,q,this.spatialReference),
e.expand(b,q);return b};a([l.property({constructOnly:!0})],c.prototype,"layerView",void 0);a([l.property({constructOnly:!0})],c.prototype,"stageLayer",void 0);a([l.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],c.prototype,"spatialReference",void 0);return c=a([l.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],c)}(l.declared(c,n.Evented))})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports dojo/promise/all ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/FeatureSet".split(" "),
function(r,g,f,a,c,b,l){return function(){function e(a,b,c){this._layer=a;this._support=b;this._options=c}e.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,d=b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;d.add(a)});return{count:c,extent:0===c?null:d.getExtent()}})};e.prototype.queryFeatureCount=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};
e.prototype.queryFeatures=function(d){var e=this;return this._rejectUnsupported(d).then(function(){var b=[],g=d&&d.outFields,h=[];if(0<e._forAllQueried(d,function(a){return h.push(e._support.createGraphic(a))},function(a){g&&(b.push(e._support.requestFields(a,h,g)),h=[])})&&!d.num)return c.reject(new a("Unsupported Query","Large feature query, use Query.num and Query.start to batch"));g||b.push(c.resolve(h));return f(b)}).then(function(a){for(var c=[],d=0;d<a.length;++d)for(var f=a[d],g=0;g<f.length;++g)c.push(b.hydrateGraphic(f[g],
e._layer));a=new l;a.features=c;return a})};e.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,function(a){return c.push(a.id)});return c})};e.defaultExtentBuilder=function(a){var b=null;return{add:function(c){(c=a(c))&&(b=null!=b?b.union(c):c.clone())},getExtent:function(){return b}}};e.prototype._forAllQueried=function(a,b,c){var d=[];if(a&&a.objectIds){var e=a.objectIds;d.push(function(a){return 0<=e.indexOf(a.id)})}var f=
a&&a.start||0,g=a&&a.num||1E4;d.push(function(){if(0>=g)return--g,!1;if(0<f)return--f,!1;--g;return!0});this._support.forAll(function(a){for(var c=0;c<d.length;c++)if(!(0,d[c])(a))return;b(a)},c);return Math.max(0,-g)};e.prototype._rejectUnsupported=function(b){if(null==b)return c.resolve();var d=function(b){return c.reject(new a("Unsupported Query","Unsupported property '"+b+"'"))};return null!=b.distance?d("distance"):null!=b.geometryPrecision?d("geometryPrecision"):b.groupByFieldsForStatistics&&
b.groupByFieldsForStatistics.length?d("groupByFieldsForStatistics"):null!=b.maxAllowableOffset?d("maxAllowableOffset"):b.multipatchOption?d("multipatchOption"):b.orderByFields&&b.orderByFields.length?d("orderByFields"):b.outSpatialReference?d("outSpatialReference"):b.outStatistics&&b.outStatistics.length?d("outStatistics"):b.pixelSize?d("pixelSize"):b.quantizationParameters?d("quantizationParameters"):b.relationParameter?d("relationParameter"):b.returnDistinctValues?d("returnDistinctValues"):b.text?
d("text"):b.timeExtent?d("timeExtent"):b.where?d("where"):b.geometry?d("geometry"):!this._options.enableOutFields&&b.outFields&&b.outFields.length?d("outFields"):!this._options.enableObjectId&&b.objectIds&&b.objectIds.length?d("objectIds"):c.resolve()};return e}()})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/Error ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils ../support/symbolColorUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p){function k(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function q(a,b,c,d,e,f){if(null!=c){var g=c.mbs;b!==d&&(g=P,t.mbsToMbs(c.mbs,d,g,b));if(0!==m(a,g)&&(f(c),c.children))for(g=0;g<c.children.length;++g)q(a,b,e[c.children[g].id],d,e,f)}}function m(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=0;if(c<a[0])var g=a[0]-c,f=f+g*g;d<a[1]&&(g=a[1]-d,f+=g*g);e<a[2]&&(g=a[2]-e,f+=g*g);c>a[3]&&(g=c-a[3],f+=g*g);d>a[4]&&(g=d-a[4],f+=g*g);e>a[5]&&(g=
e-a[5],f+=g*g);if(f>b*b)return 0;if(0<f)return 1;f=Infinity;c-a[0]<f&&(f=c-a[0]);d-a[1]<f&&(f=d-a[1]);e-a[2]<f&&(f=e-a[2]);a[3]-c<f&&(f=a[3]-c);a[4]-d<f&&(f=a[4]-d);a[5]-e<f&&(f=a[5]-e);return f>b?2:1}function u(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,m=b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function x(a,b){return a.filter(function(a){return a.toLowerCase()!==
b.toLowerCase()}).concat([b])}function v(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=u(d,a.fields,{originalFields:f});return A(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c];d.attributes={};for(var h=0;h<f.length;h++)d.attributes[f[h]]=e[g[h]]}return b})}function y(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function A(b,e,f){if(null!=b.maxRecordCount&&
e.length>b.maxRecordCount){var g=D(e,b.maxRecordCount);return c.all(g.map(function(a){return A(b,a,f)})).then(E)}g=new h({objectIds:e,outFields:f,orderByFields:[b.objectIdField]});return(new d(b.parsedUrl.path)).execute(g).then(function(b){return b&&b.features&&b.features.length===e.length?b.features.map(function(a){return a.attributes}):c.reject(new a("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function C(d,e,g,h,k){for(var l=[],m=0;m<e.attributeData.length;m++){var q=
e.attributeData[m],p=d[m];p&&-1!==h.indexOf(p.name)&&(q=b.makeAbsolute(q.href,e.baseUrl),l.push({url:q,storageInfo:p}))}return c.eachAlways(l.map(function(a){return f(a.url,{responseType:"array-buffer"}).then(function(b){return n.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(b){var d=[];if(!k.ignoreUnavailableFields&&b.some(function(a){return null==a.value})){for(var d=[],e=0;e<b.length;e++)null==b[e].value&&d.push({name:l[e].storageInfo.name,error:b[e].error});return c.reject(new a("scenelayer:attribute-request-failed",
"Request for scene layer attributes failed",{failedAttributes:d}))}for(var f=0;f<g.length;f++){for(var h=g[f],m={},e=0;e<b.length;e++)null!=b[e].value&&(m[l[e].storageInfo.name]=B(b[e].value,h));d.push(m)}return d})}function B(a,b){b=a[b];return a instanceof Int16Array?b===J?null:b:a instanceof Int32Array?b===M?null:b:b!==b?null:b}function D(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function E(a){for(var b=[],c=
0;c<a.length;c++)b=b.concat(a[c]);return b}function H(a){var b=new l(k(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function F(a){var b=new l(k(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function L(b,c,d){if(!e.canProject(b,c))throw new a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
d&&b.isGeographic)throw new a("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function G(a,b,c){var d=H(a);a=F(a);L(d,b,c);L(a,b,c)}Object.defineProperty(g,"__esModule",{value:!0});g.DDS_ENCODING_STRING="image/vnd-ms.dds";g.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];g.extractWkid=k;g.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(g.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<
a.length;b++)if(-1<g.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;throw Error("Could not find appropriate texture encoding (among "+a.toString()+")");}return-1};g.findIntersectingNodes=q;g.buildTopNodeMap=function(a,b,c,d){if(0>=b)a.clear();else for(c&&a.set(c,d),c=function(){var b=Number.POSITIVE_INFINITY,c;a.forEach(function(a,d){a<b&&(c=d,b=a)});a.delete(c)};a.size>b;)c()};var P=[0,0,0,0];g.intersectBoundingBoxWithMbs=m;g.findFieldsCaseInsensitive=u;g.whenGraphicAttributes=function(b,
d,e,f,g,h){var k=!0===(h&&h.populateObjectId),l=h.ignoreUnavailableFields?void 0:[],m=1===f.length&&"*"===f[0];!m&&k&&(f=x(f,e));f=m?f:u(f,b.fields,{missingFields:l});if(l&&0!==l.length)return c.reject(new a("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:l}));if(0===d.length)return c.resolve(d);var k=b.associatedLayer,l=b.attributeStorageInfo,n=m?b.fields.map(function(a){return a.name}):f;if(k)return v(k,d,e,n);b=y(n,d[0]);return 0===b.length?c.resolve(d):
l?(g=g(),null==g?c.reject(new a("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):C(l,g.node,g.indices,b,h).then(function(a){for(var b=0;b<d.length;b++){for(var c=0,e=n;c<e.length;c++){var f=e[c];f in a[b]||(a[b][f]=d[b].attributes[f])}d[b].attributes=a[b]}return d})):c.reject(new a("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var J=-Math.pow(2,15),M=-Math.pow(2,31);g.getCachedAttributeValue=B;g.convertFlatRangesToOffsets=
function(b,c,d){void 0===d&&(d=2);c=null!=c?c:b.length/d;for(var e=new Uint32Array(c+1),f=0;f<c;f++){var g=b[f*d];e[f]=3*g;var h=(f-1)*d+1;if(0<=h&&g-1!==b[h])throw new a("Face ranges are not continuous");}e[e.length-1]=3*(b[(c-1)*d+1]+1);return e};g.getIndexCrs=H;g.getVertexCrs=F;g.getCacheKeySuffix=function(a,b){return b===t.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};g.checkSpatialReference=L;g.checkSpatialReferences=G;g.checkSceneLayerValid=function(b){var c;
(c=null==b.store||null==b.store.defaultGeometrySchema)||(b=b.store.defaultGeometrySchema,c=!!(null!=b.geometryType&&"triangles"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null==b.vertexAttributes||null==b.vertexAttributes.position));if(c)throw new a("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};g.checkSceneLayerCompatibleWithView=function(a,b){G(a,b.spatialReference,b.viewingMode)};g.checkPointCloudLayerValid=
function(b){var c;(c=null==b.store||null==b.store.defaultGeometrySchema)||(b=b.store.defaultGeometrySchema,c=!!(null==b.geometryType||"points"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null!=b.encoding&&""!==b.encoding&&"lepcc-xyz"!==b.encoding||null==b.vertexAttributes||null==b.vertexAttributes.position));if(c)throw new a("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};g.checkPointCloudLayerCompatibleWithView=
function(a,b){L(a.spatialReference,b.spatialReference,b.viewingMode)};g.encodeSymbolColor=p.encodeSymbolColor;g.rendererNeedsTextures=function(a){if(null==a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var e=
c[d];if("fill"!==e.type||null==e.material||"replace"!==e.material.colorMixMode)return!0}}return!1}})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/promiseUtils"],function(r,g,f,a){function c(b){return a.create(function(a,c){b.oncomplete=function(){return a()};b.onerror=function(){return c(b.error)};b.onabort=function(){return c(b.error)}})}function b(b){return a.create(function(a,c){"done"===b.readyState?null!=b.error?c(b.error):
a(b.result):(b.onsuccess=function(){return a(b.result)},b.onerror=function(){return c(b.error)})})}Object.defineProperty(g,"__esModule",{value:!0});r=function(){function g(a,b,c){this._quotaReductionPromise=this._db=null;this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=b;this._version=c}g.prototype.init=function(){var c=this;return a.resolve().then(function(){var a=indexedDB.open(c._dbName,c._version);
a.onupgradeneeded=function(b){var d=a.result,e=a.transaction,f=d.objectStoreNames.contains(c._storeName)?e.objectStore(c._storeName):d.createObjectStore(c._storeName),d=d.objectStoreNames.contains("last_access")?e.objectStore("last_access"):d.createObjectStore("last_access");d.indexNames.contains("date")||d.createIndex("date","date",{unique:!1});d.indexNames.contains("byteSize")||d.createIndex("byteSize","byteSize",{unique:!1});b.oldVersion<c._version&&(f.clear(),d.clear())};return b(a)}).then(function(a){c._destroyed?
a.close():c._db=a})};g.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};g.prototype.put=function(b,c){var d=this;return null==this._db?a.reject(new f("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:a.resolve()).then(function(){return d._put(b,c)}).catch(function(a){if("QuotaExceededError"===a.name)return null==d._quotaReductionPromise&&(d._quotaReductionPromise=d._getCacheSize().then(function(a){return d._removeLeastRecentlyAccessed(c.byteSize+
Math.ceil(a*d.quotaReductionFactor))}),d._quotaReductionPromise.always(function(){d._quotaReductionPromise=null})),d._quotaReductionPromise.then(function(){return d._put(b,c)});throw a;}).then(function(){d._gcCounter--;0>d._gcCounter&&(d._gcCounter=d.gcFrequency,d._getCacheSize().then(function(a){return d._removeLeastRecentlyAccessed(a-d.maxByteSize)}))})};g.prototype.get=function(c){var d=this;return null==this._db?a.resolve(null):a.resolve().then(function(){var a=d._db.transaction(d._storeName,
"readonly").objectStore(d._storeName).get(c);return b(a)}).then(function(a){null!=a&&d._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:a.byteSize},c);return a}).catch(function(a){return null})};g.prototype.remove=function(b){var d=this;return null==this._db?a.resolve():a.resolve().then(function(){var a=d._db.transaction([d._storeName,"last_access"],"readwrite"),e=a.objectStore(d._storeName),f=a.objectStore("last_access");e.delete(b);f.delete(b);
return c(a)})};g.prototype._put=function(a,b){var d=this._db.transaction([this._storeName,"last_access"],"readwrite");d.objectStore(this._storeName).put(b,a);d.objectStore("last_access").put({date:(new Date).getTime(),byteSize:b.byteSize},a);return c(d)};g.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var b=this._db.transaction([this._storeName,"last_access"],"readwrite"),e=b.objectStore(this._storeName),f=b.objectStore("last_access"),g=0,l=f.index("date").openCursor(null,"next");
l.onsuccess=function(b){b=l.result;null!=b&&(null!=b.value.byteSize&&(g+=b.value.byteSize),e.delete(b.primaryKey),f.delete(b.primaryKey),g<a&&b.continue())};return c(b)}};g.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),b=0,f=a.objectStore("last_access").index("byteSize").openKeyCursor();f.onsuccess=function(a){if(a=f.result){var c=a.key;null!=c&&(b+=c);a.continue()}};return c(a).then(function(){return b})};return g}();g.IDBCache=r;g.whenTransaction=c;g.whenRequest=b})},
"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.attributeLookup=function(f,a){a=a.toLowerCase();for(var c=0,b=Object.keys(f);c<b.length;c++){var g=b[c];if(g.toLowerCase()===a)return f[g]}return null}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.updatingPercentageValue={value:100,
readOnly:!0};g.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define(["require","exports","../../../../core/urlUtils","./I3SUtil","../../support/orientedBoundingBox"],function(r,g,f,a,c){var b="version level sharedResource attributeData geometryData textureData lodSelection".split(" ");return function(){function g(a,b,c,g,l,p,k,q,m,r,x){var d=
this;this.rootId=c;this.progressiveLoadPenalty=g;this.nodeIndex=l;this.streamDataSupplier=p;this.viewportQueries=k;this.logger=q;this._isLoaded=m;this._needsLoading=r;this._needsUpdate=x;this._prefetching=this._loading=this._dirty=!0;this.cancelled=!1;this._loadingNodes=new Set;this._indexMissing=1;this._nodesMissing=0;this._nodeTraversalState={};this._numFeatures=this._version=0;this._featureEstimate=null;this._unloadedMemoryEstimate=0;this._missing=new Map;this._prefetch=new Map;this._updates={update:[],
add:new Map,cancel:[]};this._maxLodLevel=this.viewportQueries.maxLodLevel;this.rootUrl=f.makeAbsolute(b,a);this.traverseVisible(function(a,b){return d.nodeTraversalState(b)})}g.prototype.requestReload=function(){this._prefetching=this._loading=this._dirty=!0;++this._version};g.prototype.update=function(b,c,f){var d=this;if(this.cancelled||!this._dirty)return!1;b=Math.max(b,0);c=Math.max(c,0);this._nodesMissing=this._indexMissing=0;this._missing.clear();this._prefetch.clear();this._updates.add.clear();
this._updates.update=[];this._updates.cancel=f;this._prefetching=this._loading=0<this._loadingNodes.size;var e=b,g=Number.NEGATIVE_INFINITY,h=!0,l=function(){return function(){this.unremoved=this.missingNodes=this.knownNodes=this.missing=this.known=0}}(),m=new l,r=new l;this.traverseVisible(function(k,l,q){if(l){if(l.children){q=0;for(var n=l.children;q<n.length;q++){var p=n[q];d.nodeIndex[p.id]||d._loadingNodes.has(p.id)||(++d._indexMissing,d._prefetching=!0,0<e&&a.buildTopNodeMap(d._prefetch,e,
{id:p.id,href:p.href,baseUrl:l.baseUrl},d.entryPriority(p)))}}if(!l.failed&&l.featureData&&0!==l.featureData.length)if(d._isLoaded(l))m.known+=l.memory,++m.knownNodes,++r.knownNodes,d._needsLoading(l)?(r.known+=l.numFeatures,l.children&&(h=!1)):(m.unremoved+=l.memory,r.unremoved+=l.numFeatures,h=!1),d._needsUpdate(l)&&d._updates.update.push({prio:d.entryPriority(l),id:l.id});else if(l.memory&&(m.known+=l.memory,++m.knownNodes),d._needsLoading(l))if(++d._nodesMissing,h=!1,l.memory?m.missing+=l.memory:
++m.missingNodes,l.numFeatures?(r.known+=l.numFeatures,++r.knownNodes):++r.missingNodes,0<=f.indexOf(l.id))d._updates.cancel=d._updates.cancel.filter(function(a){return a!==l.id});else if(0<c){q=d.progressiveLoadPenalty;for(n=l;n;n=n.parentNode?d.nodeIndex[n.parentNode.id]:null)if(d._isLoaded(n)){q=0;break}n=d.entryPriority(k)+q;a.buildTopNodeMap(d._updates.add,c,l.id,n)}}else++d._indexMissing,d._loading=!0,n=d.entryPriority(k),g=Math.max(g,n),p=k.id,0<b&&!d._loadingNodes.has(p)&&(a.buildTopNodeMap(d._missing,
b,{id:p,href:k.href,baseUrl:q},n),e=b-d._missing.size)});a.buildTopNodeMap(this._prefetch,e);this._unloadedMemoryEstimate=m.missing-m.unremoved;3<m.knownNodes&&(this._unloadedMemoryEstimate+=m.missingNodes*m.known/m.knownNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate=0<r.knownNodes?{estimate:Math.max(0,r.known+r.missing-r.unremoved+(r.known+r.missing+r.unremoved)/r.knownNodes*r.missingNodes),leafsReached:h}:{estimate:0,leafsReached:!1};this._updates.add.forEach(function(a,
b){a<g&&d._updates.add.delete(b)});this._updates.update.sort(function(a,b){return b.prio-a.prio});return this._dirty=this._prefetching||0<this._indexMissing||0<this._nodesMissing||0<this._updates.update.length||0<this._updates.cancel.length};g.prototype.load=function(){var a=this;this._missing.forEach(function(b,c){return a._loadNode(c)});this._missing.clear();return this._loading};g.prototype.prefetch=function(b){var c=this;a.buildTopNodeMap(this._prefetch,b);this._prefetch.forEach(function(a,b){return c._loadNode(b)});
this._prefetch.clear()};g.prototype.cancel=function(){this.cancelled=!0};g.prototype.isLoading=function(){return this._loading};g.prototype.isPrefetching=function(){return this._prefetching};g.prototype.getNumLoading=function(){return this._loadingNodes.size};g.prototype.getNumPending=function(){return this._indexMissing};g.prototype.getNumFeatures=function(){return this._numFeatures};g.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};g.prototype.getNumUnloadedNodes=
function(){return this._nodesMissing};g.prototype.getUpdates=function(b){a.buildTopNodeMap(this._updates.add,b);return this._updates};g.prototype.getFeatureEstimate=function(){return this._featureEstimate};g.prototype.nodeTraversalState=function(a){if(!a)return null;var b=this._nodeTraversalState[a.id];if(b&&b.version===this._version)return b;var c=0;if(a.parentNode){var e=this.nodeIndex[a.parentNode.id];if(null==e)return null;if(e=this._nodeTraversalState[e.id])c=e.lodLevel}var e=this.viewportQueries.hasLOD(a),
f=this.viewportQueries.getLodLevel(a),c=!e||f>c;if(b)return b.lodLevel=f,b.isChosen=c,b.version=this._version,b;this._nodeTraversalState[a.id]={nodeHasLOD:e,lodLevel:f,isChosen:c,version:this._version};return this._nodeTraversalState[a.id]};g.prototype._loadNode=function(a){var d=this;this._loadingNodes.add(a.id);var e=f.makeAbsolute(a.href,a.baseUrl);this.streamDataSupplier.request(e,"json").then(function(a,e){var f={id:e.id,mbs:e.mbs,parentNode:e.parentNode,children:e.children,featureData:e.featureData};
b.forEach(function(a){f[a]=e.hasOwnProperty(a)?e[a]:null});e.hasOwnProperty("obb")&&(f.obb=c.clone(e.obb),f.hasServiceOBB=!0);d.nodeIndex[f.id]=f;f.baseUrl=a;f.featureData&&1===f.featureData.length&&f.featureData[0].featureRange&&(f.numFeatures=f.featureData[0].featureRange[1]-f.featureData[0].featureRange[0]);d.nodeTraversalState(f);d._loadingNodes.delete(f.id)},function(b){d.loadErrorCallback(e);d._loadingNodes.delete(a.id)})};g.prototype.entryPriority=function(a){if(a.id===this.rootId)return 0;
var b=0,c=this.nodeIndex[a.id];null!=c&&null!=c.parentNode&&(c=this._nodeTraversalState[c.parentNode.id],null!=c&&(b=c.lodLevel));a=this.viewportQueries.distToPOI(a);return-a-b*(a+this.progressiveLoadPenalty)};g.prototype.traverseVisible=function(a){var b=this.nodeIndex[this.rootId];this._numFeatures=0;b?this._traverse({id:this.rootId,mbs:b.mbs,href:this.rootUrl},b,a,""):a({id:this.rootId,mbs:null,href:this.rootUrl},null,"")};g.prototype._traverse=function(a,b,c,f){if(!b.children||0===b.children.length)this.viewportQueries.isGeometryVisible(b)&&
(c(a,b,f),this._numFeatures+=b.numFeatures);else if(this.viewportQueries.isNodeVisible(b)&&(c(a,b,f),this._numFeatures+=b.numFeatures,a=this.nodeTraversalState(b),!a.nodeHasLOD||a.lodLevel!==this._maxLodLevel))for(a=0,f=b.children;a<f.length;a++){var d=f[a],e=this.nodeIndex[d.id];e?this._traverse(d,e,c,b.baseUrl):this.viewportQueries.isNodeVisible(d)&&c(d,null,b.baseUrl)}};g.prototype.loadErrorCallback=function(a){this.logger.warn("Error loading node: "+a)};return g}()})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require",
"exports","../../../../core/PooledArray"],function(r,g,f){r=function(){function c(a,c,e){this.layerViewRequiredFunctions=a;this.layerViewOptionalFunctions=c;this.lodGlobalDirtyChanged=e}c.prototype.startNodeLoading=function(a,c,e,d,f,g){this._lodGlobalDirty=!1;this._maxLodLevel=g.maxLodLevel;this._nodeIndex=d;this._rootId=f;this._nodeTraversalState=e;this._isNodeVisible=a;this._isGeometryVisible=c;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};c.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a);
return b.isChosen?b.lodLevel===this._maxLodLevel?!0:this.childrenEmpty(a):!1};c.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};c.prototype.lodSwapBundleLoaded=function(a){this.setLodGlobalDirty()};Object.defineProperty(c.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||1.1<this.layerViewRequiredFunctions.getMemoryUsage())},enumerable:!0,configurable:!0});c.prototype.lodGlobalHandling=
function(){if(this.requiresLODGlobalHandling){var b=this._rootId,c=this.layerViewRequiredFunctions.getMemoryUsage(),c=Math.max(0,Math.floor(10*(c-1)));a.clear();this._lodGlobalHandlingRecursion(b,c);this.layerViewRequiredFunctions.removeNodeData(a);a.clear();this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}};c.prototype._lodGlobalHandlingRecursion=function(b,c){b=this._nodeIndex[b];if(null==b)return!1;var e=this._nodeTraversalState(b),d=e.isChosen&&(!e.nodeHasLOD||e.lodLevel===
this._maxLodLevel);(e=this.layerViewRequiredFunctions.isNodeLoaded(b))&&null!=this.layerViewOptionalFunctions.setPolygonOffset&&this.layerViewOptionalFunctions.setPolygonOffset(b,!d);if(d&&e)return this._removeChildrenRecursive(b),!0;var f=!1;if(null!=b.children&&0!==b.children.length)for(var f=!0,g=0,l=b.children;g<l.length;g++){var p=l[g],k=this._nodeIndex[p.id];if(k?this._isGeometryVisible(k):this._isNodeVisible(p))p=this._lodGlobalHandlingRecursion(p.id,c),f=f&&p}e&&!d&&(f||a.length<c)&&(a.push(b),
e=!1);c=!b.featureData||0===b.featureData.length;return f||e||c};c.prototype._removeChildrenRecursive=function(b){if(null!=b.children){var c=0;for(b=b.children;c<b.length;c++){var e=this._nodeIndex[b[c].id];null!=e&&(this._removeChildrenRecursive(e),a.push(e))}}};c.prototype._subtreeEmpty=function(a){return this.layerViewRequiredFunctions.isNodeLoaded(a)?!1:this.childrenEmpty(a)};c.prototype.childrenEmpty=function(a){if(null==a.children)return!0;var b=0;for(a=a.children;b<a.length;b++){var c=a[b];
if(this._isNodeVisible(c)&&(c=this._nodeIndex[c.id],null!=c&&!this._subtreeEmpty(c)))return!1}return!0};return c}();var a=new f;return r})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/Deferred dojo/_base/lang dojo/errors/CancelError ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SUtil ../../webgl-engine/lib/Util".split(" "),function(r,g,f,a,c,b,l,e,d,h){r=function(){function g(a,c,d,e,f){this.logger=c;this.defaultGeometrySchema=d;
this.requiredAttributes=e;this.options=f;this.loadShared=function(a){if(null==a.sharedResource)return b.resolve({});var c=l.makeAbsolute(a.sharedResource.href,a.baseUrl);return this.loadJSON(c).then(function(a){g.fixTextureEncodings(a);g.addAbsoluteHrefTexture(a,c);return a})};this.loader=a;this.cancelled=!1}g.prototype.cancel=function(){this.cancelled=!0};g.prototype.loadJSON=function(a){var b=this.loader.request(a,"json"),c=new f;b.then(function(a,b){c.resolve(b)},function(b){c.reject(Error("Failed to load: "+
a))});return c.promise};g.prototype.loadBinary=function(a){var b=this.loader.request(a,"binary"),c=new f;b.then(function(a,b){c.resolve(b)},function(b){c.reject(Error("Failed to load: "+a))});return c.promise};g.prototype.loadImage=function(a){var b=this.loader.request(a,"image"),c=new f;b.then(function(a,b){c.resolve(b)},function(b){c.reject(Error("Failed to load: "+a))});return c.promise};g.prototype.loadAttribute=function(a,b,c){a=l.makeAbsolute(c,a);return this.loadBinary(a).then(function(a){return e.readBinaryAttribute(b,
a)})};g.prototype.loadAttributes=function(a,c,d){var e=this,f=d.map(function(d){return null==a.attributeData||null==a.attributeData[d.index]?(e.logger.error("Missing attributeData for '"+d.name+"' on node '"+a.id+"'"),b.resolve(null)):e.loadAttribute(c,d.attributeStorageInfo,a.attributeData[d.index].href).catch(function(b){e.logger.error("Failed to load attributeData for '"+d.name+"' on node '"+a.id+"'");return null})});return b.all(f).then(function(a){for(var b={},c=0;c<d.length;++c)a[c]&&(b[d[c].name]=
a[c]);return b})};g.prototype.prepareBinaryGeometryData=function(b,c,f,g){a.mixin(b.geometries[0].params,f);g||null!=f.vertexAttributes.region||delete f.vertexAttributes.region;if(null!=f.featureAttributes){g=f.featureAttributes;if(g.faceRange){var h=e.createTypedView(c,g.faceRange);b.componentOffsets=d.convertFlatRangesToOffsets(h,f.header.fields.featureCount,g.faceRange.valuesPerElement)}if(g.id){b.featureIds=[];var h=1,k=e.valueType2TypedArrayClassMap[g.id.valueType];"UInt64"===g.id.valueType&&
(k=Uint32Array,h=2);c=new k(c,g.id.byteOffset,g.id.count*g.id.valuesPerElement*h);for(k=0;k<f.header.fields.featureCount;k++)if(b.featureIds[k]=c[k*g.id.valuesPerElement*h],2===h){var l=c[k*g.id.valuesPerElement*h+1];if(2097150<=l)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");b.featureIds[k]+=4294967296*l}}}};g.prototype.loadBundleData=function(a,c){var d=this,f=a.baseUrl,g=null,h=this.loadShared(a),n=null;null!=this.requiredAttributes&&
(n=this.loadAttributes(a,f,this.requiredAttributes));var p=null;null!=a.geometryData&&(f=l.makeAbsolute(a.geometryData[c].href,f),p=this.loadBinary(f));return h.then(function(f){d.handleCancelled();return(d.options.loadFeatureData?d.loadFeatureData(a,c):b.resolve(null)).then(function(c){d.handleCancelled();var h=d.options.loadFeatureData?d.collectGeometries(a,c,f):d.meshPyramidGeometryData(a,f);c=null!=p?p.then(function(a){g=a;var b=Object.keys(f.materialDefinitions)[0],b=f.materialDefinitions[b].params.vertexRegions,
c=e.createGeometryDataIndex(a,d.defaultGeometrySchema,b);d.prepareBinaryGeometryData(h[0],a,c,b);return h}):b.resolve(h);var k=d.loadTextures(h,f);return b.all([k,c,n])}).then(function(a){var b=a[0],c=a[1];a=a[2];d.handleCancelled();var e=null;a&&(e={attributeData:a,loadedAttributes:d.requiredAttributes});return{allGeometryData:c,attributeDataInfo:e,geometryBuffer:g,sharedResource:f,textureData:b}})})};g.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=0,d=Object.keys(a);c<
d.length;c++)for(var e=0,f=a[d[c]].images;e<f.length;e++){var g=f[e];Array.isArray(g.href)?g.hrefConcat=g.href.map(function(a){return l.makeAbsolute(a,b)}):g.hrefConcat=l.makeAbsolute(g.href,b)}};g.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};
g.prototype.loadTexture=function(a,b,c,e){var f=this;return e===d.DDS_ENCODING_STRING?this.loadBinary(a).then(function(a){f.handleCancelled();return{i3sTexId:b,data:a,encoding:e}}):this.loadImage(a).then(function(a){var d=a;f.handleCancelled();if(c&&4096<=a.width*a.height){var d=Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=d;h.height=g;h.getContext("2d").drawImage(a,0,0,d,g);d=h}return{i3sTexId:b,data:d,encoding:e}})};g.prototype.loadTextures=function(a,
c){for(var e=[],f=0;f<a.length;f++){var l=a[f].geometries;if(null!=l)for(var n=0;n<l.length;n++){var p=l[n].params.textureID||"none";if("none"!==p){null!=c.textureDefinitions&&null!=c.textureDefinitions[p]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+p);var t=c.textureDefinitions[p];h.assert(void 0!==t,"geometry wants unknown texture "+p);if(0!==t.images.length){var r=t.images[t.images.length-1],A=this.options.textureFormat===g.TextureFormat.Downsampled,C=d.getAppropriateTextureEncoding(t.encoding,
this.options.textureFormat===g.TextureFormat.Compressed),t=-1<C?t.encoding[C]:t.encoding,r=-1<C?r.hrefConcat[C]:r.hrefConcat;this.options.loadTextureData?e.push(this.loadTexture(r,p,A,t)):e.push({i3sTexId:p,encoding:t,data:null})}}}}return b.all(e)};g.prototype.meshPyramidGeometryData=function(a,b){a=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:a,
textureID:b}}],featureDataPosition:[0,0,0]}]};g.prototype.collectGeometries=function(a,b,c){a=[];c=0;for(b=b.featureData;c<b.length;c++){var d=b[c],e=d.geometries;if(null!=e)for(var f=0;f<e.length;f++)a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:[d.geometries[f]]});else null!=d.position&&a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return a};g.prototype.loadFeatureData=function(a,b){a=l.makeAbsolute(a.featureData[b].href,a.baseUrl);return this.loadJSON(a)};
g.prototype.handleCancelled=function(){if(this.cancelled)throw new c;};return g}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(r||(r={}));return r})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../geometry/Point ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../lib/glMatrix ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t){return function(){function g(b,g,h,l,n,p,t,r){void 0===r&&(r={});this.indexSR=b;this._renderCoordsHelper=g;this.extent=n;this.elevationProvider=p;this.options=r;this._computedOBBs={};this._computedMBSs={};this._isNodeVisibleCached={};this.fp=[];this._idleCamera=!0;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=[0,0,0];this._tmp2=[0,0,0];this._tmp3=[0,0,0];this._tmp0=[0,0,0];this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter",
"distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=r.screenspaceErrorBias||1;this.progressiveLoadFactor=r.progressiveLoadFactor||1;this.enableLoD=!r.disableLod;for(g=0;8>g;++g)this.fp[g]=d.plane.create();this.updateCamera(h);this._poi=e.vec3d.create(l);this.engineSR=this._renderCoordsHelper.spatialReference;t?(this._elevationContext=new a,this._elevationContext.featureExpressionInfoContext=c.createContext(c.extractExpressionInfo(t,!1)),this._elevationContext.mixinApi(t)):this._elevationContext=
null;this.tmpPoint=new f({x:0,y:0,z:0,spatialReference:b})}g.prototype.updateCamera=function(a){t.matrixToFrustumPlanes(a.viewMatrix,a.projectionMatrix,this.fp);this._screenSizeFactor=1/a.perPixelRatio;this._camPos=a.eye;this._isNodeVisibleCached={}};g.prototype.updatePointOfInterest=function(a){e.vec3d.set(a,this._poi);this.maxDistance=0};g.prototype.updateScreenSpaceErrorBias=function(a){this.screenspaceErrorBias=a};g.prototype.setCameraIdle=function(a){this._idleCamera!==a&&(this._idleCamera=a,
this._isNodeVisibleCached={})};g.prototype.updateExtent=function(a){this.extent=a;this._isNodeVisibleCached={}};g.prototype.computeMbs=function(a){var c=this._computedMBSs[a.id];c||(c=e.vec4d.createFrom(a.mbs[0],a.mbs[1],a.mbs[2],-1),this._computedMBSs[a.id]=c);0>c[3]&&(e.vec4d.set(a.mbs,c),this._elevationContext&&1E5>c[3]&&(this.tmpPoint.x=c[0],this.tmpPoint.y=c[1],this.tmpPoint.z=c[2],c[2]=b.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),
n.mbsToMbs(c,this.indexSR,c,this.engineSR));return c};g.prototype.computeObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])){var c=this._computedOBBs[a.id];c||(c=h.clone(a.obb),c.halfSize[0]=-1,this._computedOBBs[a.id]=c);0>c.halfSize[0]&&(c.halfSize[0]=a.obb.halfSize[0],e.vec3d.set(a.obb.center,c.center),this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],c.center[2]=b.computeElevation(this.elevationProvider,this.tmpPoint,
this._elevationContext,this._renderCoordsHelper,null)),n.bufferToBuffer(c.center,this.indexSR,0,c.center,this.engineSR,0,1));return c}};g.prototype._isNodeVisible=function(a){var b=this.computeMbs(a);return this.isMBSinExtent(b)?a.hasServiceOBB&&a.obb?(a=this.computeObb(a),h.isVisible(a,this.fp)):this.isMBSVisible(b):!1};g.prototype.isNodeVisible=function(a){if(!this.enableLoD)return!0;if(!this._idleCamera)return this._isNodeVisible(a);if(null!=this._isNodeVisibleCached[a.id])return this._isNodeVisibleCached[a.id];
this._isNodeVisibleCached[a.id]=this._isNodeVisible(a);return this._isNodeVisibleCached[a.id]};g.prototype.isGeometryVisible=function(a){return this.isNodeVisible(a)?a.hasServiceOBB?!0:(a=this.computeObb(a))?h.isVisible(a,this.fp):!0:!1};g.prototype.invalidateCache=function(a){if(null==a){for(var b=0,c=Object.keys(this._computedMBSs);b<c.length;b++)a=c[b],this._computedMBSs[a][3]=-1;b=0;for(c=Object.keys(this._computedOBBs);b<c.length;b++)a=c[b],this._computedOBBs[a].halfSize[0]=-1}else this._computedMBSs[a]&&
(this._computedMBSs[a][3]=-1),this._computedOBBs[a]&&(this._computedOBBs[a].halfSize[0]=-1)};g.prototype.isMBSinExtent=function(a){return this.extent?0!==l.intersectBoundingBoxWithMbs(this.extent,a):!0};g.prototype.isMBSVisible=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];var e=this.fp;return e[0][0]*b+e[0][1]*c+e[0][2]*d+e[0][3]<=a&&e[1][0]*b+e[1][1]*c+e[1][2]*d+e[1][3]<=a&&e[2][0]*b+e[2][1]*c+e[2][2]*d+e[2][3]<=a&&e[3][0]*b+e[3][1]*c+e[3][2]*d+e[3][3]<=a&&e[4][0]*b+e[4][1]*c+e[4][2]*d+e[4][3]<=a&&
e[5][0]*b+e[5][1]*c+e[5][2]*d+e[5][3]<=a};g.prototype.calcScreenSpaceSize=function(a,b){a=this.computeMbs(a);var c=a[3];a=e.vec3d.dist2(a,this._camPos)-c*c;return 0>a?.5*Number.MAX_VALUE:b/Math.sqrt(a)*this._screenSizeFactor};g.prototype.calcCameraDistance=function(a){a=this.computeMbs(a);return Math.max(0,e.vec3d.dist(a,this._camPos)-a[3])};g.prototype.calcAngleDependentLoD=function(a){a=this.computeMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-
this._camPos[2]))/e.vec3d.length(a)+b)/e.vec3d.dist(a,this._camPos);return Math.min(1,a)};g.prototype.hasLOD=function(a){return null!=a.lodSelection};g.prototype.hasFeatures=function(a){return null!=a.featureData};g.prototype.getDistancePlanarMode=function(a,b,c){var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];d=d+d+e*e;if(d<=c*c)return Math.abs(a);c=Math.sqrt(d)-c;return Math.sqrt(a*a+c*c)};g.prototype.getDistanceGlobeMode=function(a,b,c){var d=e.vec3d.length(b),f=e.vec3d.length(a)-d;e.vec3d.scale(a,e.vec3d.dot(a,
b)/e.vec3d.length2(a),this._tmp0);if(e.vec3d.dist2(b,this._tmp0)<=c*c)return Math.abs(f);b=e.vec3d.scale(b,1/d,this._tmp0);var d=e.vec3d.scale(b,d-c*c/2/d,this._tmp1),g=e.vec3d.subtract(a,d,this._tmp2),g=e.vec3d.subtract(g,e.vec3d.scale(b,e.vec3d.dot(b,g),this._tmp3),this._tmp2),d=e.vec3d.add(d,e.vec3d.scale(g,c/e.vec3d.length(g),this._tmp2),this._tmp2);c=e.vec3d.dist(a,d);2E5<=f&&(a=e.vec3d.subtract(a,d,this._tmp1),a=e.vec3d.dot(a,b)/e.vec3d.length(a),.08>a&&(a=1E-4),c/=a);return c};g.prototype.getDistance=
function(a,b,c){return this.engineSR===n.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b,c):this.getDistancePlanarMode(a,b,c)};g.prototype._selectErrorMetric=function(a){for(var b=0;b<a.length;b++)if(0<=this.supportedMetrics.indexOf(a[b].metricType))return a[b];return null};g.prototype.getLodLevel=function(a){if(!a.lodSelection||0>=a.lodSelection.length||!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;var b=this.enableLoD?this._selectErrorMetric(a.lodSelection):
null;if(null==b)return 0;if(1>this.progressiveLoadFactor){var c=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,b)?this.evaluateLODmetric(a,c,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,b)?this.maxLodLevel:0};g.prototype.evaluateLODmetric=function(a,b,c){return"screenSpaceRelative"===c.metricType?(a=this.computeMbs(a),a=2*this.getDistance(this._camPos,a,a[3])/this._screenSizeFactor,c.maxError*b<=a):"maxScreenThreshold"===
c.metricType?(b=this.calcScreenSpaceSize(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<c.maxError):"removedFeatureDiameter"===c.metricType?10>this.calcScreenSpaceSize(a,c.maxError)*b:"distanceRangeFromDefaultCamera"===c.metricType?this.calcCameraDistance(a)>c.maxError*b:!1};g.prototype.distToPOI=function(a){a=this.computeMbs(a);a=e.vec3d.dist(a,this._poi)-a[3];this.maxDistance=Math.max(this.maxDistance,a);return a};g.prototype.distCameraToPOI=function(){return e.vec3d.dist(this._camPos,
this._poi)};return g}()})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/Deferred"],function(r,g,f){Object.defineProperty(g,"__esModule",{value:!0});r=function(){function a(){this._deferreds=[];this._values=[]}a.prototype.push=function(a){var b=new f;this._deferreds.push(b);this._values.push(a);return b.promise};a.prototype.length=function(){return this._deferreds.length};a.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())};a.prototype.cancelAll=
function(){for(var a=0,b=this._deferreds;a<b.length;a++)b[a].cancel();this._deferreds.length=0;this._values.length=0};return a}();g.IdleQueue=r})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),function(r,g,f,a,c,b,l,e,d,h){return function(d){function g(){return null!==
d&&d.apply(this,arguments)||this}f(g,d);g.prototype.initialize=function(){var a=this,d=this.get("view.map.ground.layers"),e=this.get("view.map.allLayers"),e=e&&e.includes(this.layer),d=d&&d.includes(this.layer);e&&!d&&(d=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(b.reject(d)));(d=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?this.addResolvingPromise(b.reject(d)):(d=l.whenTrueOnce(this.view,
"basemapTerrain.tilingSchemeLocked").then(function(){h.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(d));this.addResolvingPromise(h.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()};a([e.property({aliasOf:"layer.fullExtent"})],g.prototype,"fullExtent",void 0);a([e.property()],g.prototype,"layer",void 0);a([e.property({aliasOf:"layer.tileInfo"})],g.prototype,"tileInfo",void 0);return g=a([e.subclass("esri.views.3d.layers.ElevationLayerView3D")],
g)}(e.declared(d))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/accessorSupport/decorators ./LayerView3D ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(r,g,f,a,c,b,l,e,d){return function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a.minDataLevel=0;a.maxDataLevel=Infinity;a._isUpdating=!1;return a}f(h,g);
Object.defineProperty(h.prototype,"formatIsTransparent",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isTransparent",{get:function(){return 1>this.fullOpacity||this.formatIsTransparent},enumerable:!0,configurable:!0});h.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};h.prototype.updatingChanged=function(a){this._isUpdating=a;this.notifyChange("updating")};h.prototype.isUpdating=function(){return this._isUpdating};h.prototype._getTileInfoSupportError=
function(a,b){if(a=d.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var e=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":e=new c("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":e=new c("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",
b);break;default:e=new c("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return e}return null};h.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new c("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};h.prototype._updateMinMaxDataLevel=function(){var a=Infinity,b=0;this.tileInfo.lods.forEach(function(c){a=Math.min(c.level,a);
b=Math.max(c.level,b)});c=[a,b];this.minDataLevel=c[0];this.maxDataLevel=c[1];var c};a([b.property({readOnly:!0})],h.prototype,"formatIsTransparent",null);a([b.property(e.updatingPercentage)],h.prototype,"updatingPercentage",void 0);a([b.property(e.updatingPercentageValue)],h.prototype,"updatingPercentageValue",void 0);a([b.property()],h.prototype,"fullExtent",void 0);a([b.property({readOnly:!0,dependsOn:["fullOpacity","formatIsTransparent"]})],h.prototype,"isTransparent",null);a([b.property()],h.prototype,
"layer",void 0);a([b.property()],h.prototype,"minDataLevel",void 0);a([b.property()],h.prototype,"maxDataLevel",void 0);a([b.property()],h.prototype,"tileInfo",void 0);return h=a([b.subclass("esri.views.3d.layers.TiledLayerView3D")],h)}(b.declared(l))})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(r,g,f,a,c,b){function l(a){var b=
null,c=a.search(/\/rest\/services\//i);0<c&&(b=a.substring(0,c+6));return b}Object.defineProperty(g,"__esModule",{value:!0});g.checkArcGISServiceVersionCompatibility=function(e){if(!b.isHostedAgolService(e.url)){if(10.22>e.version)return e=new a("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+e.version,{minVersion:10.22,detectedVersion:e.version}),c.reject(e);if(10.22!==e.version||b.isHostedSecuredProxyService(e.url,e.get("portalItem.id")))return c.resolve();
e=l(e.url);var d=new a("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");return f(e+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw d;}).catch(function(){throw d;})}};g.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Evented ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/support/controllerUtils ../../../layers/graphics/sources/MemorySource ./FeatureLikeLayerView3D ../../layers/RefreshableLayerView".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x){g=function(c){function g(a){return c.call(this)||this}f(g,c);n=g;Object.defineProperty(g.prototype,"controllerTypeForSource",{get:function(){return this.layer.source&&this.layer.source.isInstanceOf&&this.layer.source.isInstanceOf(m)?"memory":"point"===this.layer.geometryType?"feature-tile-3d":"snapshot"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspendResumeExtentMode",{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)return this.controller.suspendResumeExtentMode;
switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return"data";case "memory":case "snapshot":return"computed"}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"displayLimitExceeded",{get:function(){return this.controller&&"feature-tile-3d"===this.controller.type?!(this.suspended||!this.controller.displayLimitExceeded):!1},enumerable:!0,configurable:!0});g.prototype.createController=function(){return l(this,void 0,void 0,function(){var a;
return b(this,function(b){switch(b.label){case 0:a=this.controllerTypeForSource;switch(a){case "memory":return[3,1];case "snapshot":return[3,3];case "feature-tile-3d":return[3,5]}return[3,7];case 1:return[4,this.createMemoryController()];case 2:return[2,b.sent()];case 3:return[4,this.createSnapshotController()];case 4:return[2,b.sent()];case 5:return[4,this.createFeatureTileController()];case 6:return[2,b.sent()];case 7:return[3,8];case 8:return[2]}})})};g.prototype.createMemoryController=function(){return l(this,
void 0,void 0,function(){var a;return b(this,function(b){switch(b.label){case 0:return[4,t.create(function(a){r(["../../../layers/graphics/controllers/MemoryController"],a)})];case 1:return a=b.sent(),[2,new a({layerView:this,layer:this.layer,graphics:this.layer.source})]}})})};g.prototype.createFeatureTileController=function(){return l(this,void 0,void 0,function(){var a=this,c,d;return b(this,function(b){switch(b.label){case 0:return[4,t.create(function(a){r(["../../../layers/graphics/controllers/FeatureTileController3D"],
a)})];case 1:return c=b.sent(),d=new c({layerView:this,graphics:new v,displayFeatureLimit:y}),this.handles.add([d.watch("suspendResumeExtentMode",function(){return a.notifyChange("suspendResumeExtentMode")},!0),d.watch("displayLimitExceeded",function(){return a.notifyChange("displayLimitExceeded")},!0)]),this.handles.add(p.init(d,"dataExtent",function(b){return a.graphics3d.dataExtent=b})),this.handles.add(p.init(this,"suspended",function(a){a?d.suspend():d.resume()},!0)),[2,d]}})})};g.prototype.createSnapshotController=
function(){return l(this,void 0,void 0,function(){var a,c,f;return b(this,function(b){switch(b.label){case 0:return this.addResolvingPromise(this.validateMaximumFeatureCount()),[4,t.create(function(a){r(["../../../layers/graphics/controllers/SnapshotController"],a)})];case 1:return a=b.sent(),c=d.ofType(e),f=new a({layerView:this,layer:this.layer,graphics:new c,maxPageSize:300}),[4,f.when()];case 2:return b.sent(),this.handles.add(p.whenFalseOnce(this,"suspended",function(){f.startup()})),[2,f]}})})};
g.prototype.validateMaximumFeatureCount=function(){return 0>n.maximumFeatureCount||!this.layer.url?t.resolve():this.layer.queryFeatureCount().then(function(a){if(a>n.maximumFeatureCount)throw new h("featurelayerview3d:maximum-feature-count-exceeded","The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",{maximumFeatureCount:n.maximumFeatureCount,numberOfFeatures:a});})};g.prototype.doRefresh=function(){!this.suspended&&q.isRefreshable(this.controller)&&
this.controller.refresh()};g.maximumFeatureCount=-1;a([k.property()],g.prototype,"layer",void 0);a([k.property()],g.prototype,"controller",void 0);a([k.property({readOnly:!0,dependsOn:["layer"]})],g.prototype,"controllerTypeForSource",null);a([k.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],g.prototype,"suspendResumeExtentMode",null);a([k.property({dependsOn:["suspended","controller"]})],g.prototype,"displayLimitExceeded",null);return g=n=a([k.subclass("esri.views.3d.layers.FeatureLayerView3D")],
g);var n}(k.declared(u,x));var v=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new Set;return a}f(c,b);d=c;Object.defineProperty(c.prototype,"length",{get:function(){return this.items.size},enumerable:!0,configurable:!0});c.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this.items.add(a[b]);this.emit("change",{added:a,removed:[],moved:[]})};c.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.items.delete(a[b]);this.emit("change",{added:[],
removed:a,moved:[]});return a};c.prototype.removeAll=function(){var a=this.toArray();this.emit("change",{added:[],removed:a,moved:[]})};c.prototype.toArray=function(){var a=[];this.items.forEach(function(b){return a.push(b)});return a};c.prototype.forEach=function(a){this.items.forEach(a)};c.prototype.some=function(a){return this.toArray().some(a)};c.prototype.find=function(a){var b=null;this.forEach(function(c){!b&&a(c)&&(b=c)});return b};c.prototype.filter=function(a){var b=new d;this.forEach(function(c){a(c)&&
b.items.add(c)});return b};return c=d=a([k.subclass("esri.views.3d.layers.FeatureLayerView3D.SetCollection")],c);var d}(k.declared(n)),y={min:3E3,max:5E4,perTile:1E4};return g})},"esri/layers/graphics/controllers/support/controllerUtils":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.isRefreshable=function(f){return f&&f.refresh}})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/QueryEngine ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/stats ./support/projectExtentUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u){return function(g){function k(a){a=g.call(this)||this;a.suspendResumeExtentMode="computed";a.supportsDraping=!0;a.overlayUpdating=!1;a.supportsHeightUnitConversion=!0;a.controller=null;a._controllerClientSideFiltering=!1;a.suspendResumeExtent=null;a.fullExtentInViewSpatialReference=null;a._controllerCreated=!1;return a}f(k,g);k.prototype.initialize=function(){var a=this;this._set("graphics3d",new q({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,
scaleVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,verticalScaleEnabled:this.supportsHeightUnitConversion,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}}));this.handles.add(this.watch("suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=b}));this.addResolvingPromise(this.graphics3d.setup());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.addResolvingPromise(this.initializeController());
this.addResolvingPromise(this.validateGeometryType());var b=u.toView(this).then(function(b){a.fullExtentInViewSpatialReference=b});b&&this.addResolvingPromise(b);this.notifyChange("updating")};k.prototype.destroy=function(){this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.loadedGraphics=null};Object.defineProperty(k.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);
this._set("drawingOrder",a)},enumerable:!0,configurable:!0});k.prototype.getRenderingInfo=function(a){if((a=p.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};k.prototype.getGraphicsFromStageObject=function(a,b){var c=this,d=a.getMetadata().graphicId,f=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===d?(f=n.hydrateGraphic(a,c.layer),!0):!1});return e.create(function(a,b){null!==f?a(f):b()})};Object.defineProperty(k.prototype,
"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"graphics3DGraphicsKeys",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsKeys:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});
k.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};k.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};k.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};k.prototype.queryFeatureCount=function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};k.prototype.queryExtent=
function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};k.prototype.highlight=function(a,b){return this.graphics3d.highlight(a,b,this.layer.objectIdField)};k.prototype.getStats=function(){var a=m.stats(this,this.graphics3d.graphicsCore);a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};k.prototype.canResume=function(){return!this.inherited(arguments)||
this.graphics3d&&this.graphics3d.suspended?!1:!0};k.prototype.isUpdating=function(){return this.graphics3d.destroyed?!1:!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready)||this.graphics3d.updating};k.prototype.initializeController=function(){return b(this,void 0,void 0,function(){var a;return c(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return a=b.sent(),[4,a.when()];
case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};k.prototype.setControllerWhenInitialized=function(a){return b(this,void 0,void 0,function(){return c(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,d.whenTrueOnce(this.view,"basemapTerrain.ready")]:[2];case 4:return b.sent(),this.controller=a,
this.loadedGraphics=a.graphics,this._queryEngine=new t({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField}),this.notifyChange("updating"),[2]}})})};k.prototype.updateClippingExtent=function(a){if(!this.controller)return!1;switch(this.controller.type){case "memory":case "stream":return!1;case "snapshot":if(this._controllerClientSideFiltering)return!1;this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0):this.controller.extent=
a;return!0;case "feature-tile-3d":return this.controller.extent=a,!0}};k.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return e.reject(new l("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};k.prototype._rejectQuery=function(){return e.reject(new l("featurelayerview3d:query","Not ready to execute query"))};a([h.property()],k.prototype,"loadedGraphics",
void 0);a([h.property({dependsOn:["graphics3d.suspended"]})],k.prototype,"suspended",void 0);a([h.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],k.prototype,"updating",void 0);a([h.property()],k.prototype,"controller",void 0);a([h.property()],k.prototype,"graphics3d",void 0);a([h.property({readOnly:!0})],k.prototype,"suspendResumeExtentMode",void 0);a([h.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],k.prototype,"hasDraped",void 0);a([h.property({readOnly:!0,
type:Boolean})],k.prototype,"supportsDraping",void 0);a([h.property({type:Boolean})],k.prototype,"overlayUpdating",void 0);a([h.property()],k.prototype,"drawingOrder",null);return k=a([h.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],k)}(h.declared(k))})},"esri/renderers/support/renderingInfoUtils":function(){define(["require","exports"],function(r,g){function f(a,b){if(!a||a.symbol)return null;b=b.renderer;return a&&b&&b.getObservationRenderer?b.getObservationRenderer(a):b}function a(a,
b){if(a.symbol)return a.symbol;var c=f(a,b);return c&&c.getSymbol(a,b)}Object.defineProperty(g,"__esModule",{value:!0});g.getRenderer=f;g.getSymbol=a;g.getRenderingInfo=function(c,b){var g=f(c,b),e=a(c,b);if(!e)return null;e={renderer:g,symbol:e};if(g){g.colorInfo&&(e.color=g.getColor(c).toRgba());if(g.sizeInfo){var d=g.getSize(c);e.size=[d,d,d]}if(g.visualVariables){c=g.getVisualVariableValues(c,b);d=["proportional","proportional","proportional"];for(b=0;b<c.length;b++){var h=c[b],g=h.variable,n=
h.value;"color"===g.type?e.color=n.toRgba():"size"===g.type?"outline"===g.target?e.outlineSize=n:(h=g.axis,g=g.useSymbolValue?"symbolValue":n,"width"===h?d[0]=g:"depth"===h?d[1]=g:"height"===h?d[2]=g:d[0]="width-and-depth"===h?d[1]=g:d[1]=d[2]=g):"opacity"===g.type?e.opacity=n:"rotation"===g.type&&"tilt"===g.axis?e.tilt=n:"rotation"===g.type&&"roll"===g.axis?e.roll=n:"rotation"===g.type&&(e.heading=n)}if(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))e.size=d}}return e}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./Graphics3DVerticalScale ./graphicUtils ../support/attributeUtils".split(" "),
function(r,g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C){return function(b){function g(a){a=b.call(this)||this;a._handles=new e;a.highlights=new u;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}f(g,b);Object.defineProperty(g.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this.graphicsCore&&
this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});g.prototype.normalizeCtorArgs=function(a){var b=this,c=null,d,e,f,g;a.queryGraphicUIDsInExtent||!a.scaleVisibilityEnabled&&!a.elevationAlignmentEnabled||(c=new v({spatialReference:a.owner.view.spatialReference}));a.frustumVisibilityEnabled&&(d=new m);a.scaleVisibilityEnabled&&(e=new x);a.elevationAlignmentEnabled&&(f=new q);a.verticalScaleEnabled&&
(g=new y({sourceSpatialReference:a.layer.spatialReference,destSpatialReference:a.owner.view.spatialReference}));var h=function(a,b,d){return c.queryGraphicUIDsInExtent(a,b,d)};return{graphicsCore:new k({owner:a.owner,layer:a.layer,basemapTerrain:a.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicTransformFunc:function(a){return b.verticalScale?b.verticalScale.adjust(a):a}}),frustumVisibility:d,verticalScale:g,scaleVisibility:e,elevationAlignment:f,
spatialIndex:c,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent,queryGraphicUIDsInExtent:a.queryGraphicUIDsInExtent||h}};g.prototype.initialize=function(){var a=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(){return a.graphicsCore.elevationInfoChange()}));
this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return a.owner.view.labeler.setDirty()})),this._handles.add(this.layer.watch("labelingInfo",function(){return a.graphicsCore.updateLabelingInfo()})));this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.elevationAlignment,this.graphicsCore]};g.prototype.setup=function(){var a=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var b=this.owner.view.basemapTerrain,c=this.owner.view.elevationProvider;
this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,b);this.elevationAlignment&&this.elevationAlignment.setup(this.owner,this.queryGraphicUIDsInExtent,this.graphicsCore,c);this.highlights&&this.highlights.setup(this.graphicsCore);this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex));this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,
spatialIndex:this.spatialIndex,labeling:this.labeling,highlights:this.highlights});this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",function(){return a.graphicsCore.opacityChange()})]);this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)}));this.setupSuspendResumeExtent();this.owner.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this.needsIdleUpdate,
idleFrame:this.idleUpdate});this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),this._updateClippingExtent());if(this.graphicsCore.labelsEnabled)return this.graphicsCore.updateLabelingInfo()};g.prototype.destroy=function(){this.owner&&this.owner.view.resourceController.deregisterIdleFrameWorker(this);this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",
null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null));this.highlights&&(this.highlights.destroy(),this._set("highlights",null));this._set("layer",null);this._set("owner",null)};g.prototype.highlight=function(a,
b,d){var e=this;if(a instanceof t){b=this.highlights.acquireSet(b,d);var f=b.set,g=b.handle;this.owner.queryObjectIds(a).then(function(a){return e.highlights.setObjectIds(f,a)});return g}if("number"===typeof a||a instanceof c)return this.highlight([a],b,d);a instanceof l&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof c)if(g=a,d&&g[0].attributes&&null!==C.attributeLookup(g[0].attributes,d))a=g.map(function(a){return C.attributeLookup(a.attributes,d)});else return a=g.map(function(a){return a.uid}),
g=this.highlights.acquireSet(b,null),b=g.set,g=g.handle,this.highlights.setUids(b,a),g;if("number"===typeof a[0])return g=this.highlights.acquireSet(b,d),b=g.set,g=g.handle,this.highlights.setObjectIds(b,a),g}return{remove:function(){}}};g.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=b[a];if(c&&c.needsIdleUpdate())return!0}return!1};g.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];d&&d.idleUpdate(a)}};g.prototype._updateClippingExtent=
function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};g.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(d.init(this,"suspendResumeExtentMode",function(b){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(d.init(a.graphicsCore,"computedExtent",
function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(d.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode")}}))};g.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};g.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!n.canProject(a,
c))return;a=n.project(a,c)}return A.enlargeExtent(a,b,p.SUSPEND_RESUME_EXTENT_OPTIMISM)};g.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};a([h.property({aliasOf:"graphicsCore.layer"})],g.prototype,"layer",void 0);a([h.property({aliasOf:"graphicsCore.owner"})],g.prototype,"owner",void 0);a([h.property({constructOnly:!0})],g.prototype,"updateClippingExtent",void 0);a([h.property({constructOnly:!0})],
g.prototype,"queryGraphicUIDsInExtent",void 0);a([h.property({constructOnly:!0})],g.prototype,"graphicsCore",void 0);a([h.property({constructOnly:!0})],g.prototype,"verticalScale",void 0);a([h.property({constructOnly:!0})],g.prototype,"spatialIndex",void 0);a([h.property({constructOnly:!0})],g.prototype,"scaleVisibility",void 0);a([h.property({constructOnly:!0})],g.prototype,"elevationAlignment",void 0);a([h.property({constructOnly:!0})],g.prototype,"frustumVisibility",void 0);a([h.property({readOnly:!0})],
g.prototype,"labeling",void 0);a([h.property({readOnly:!0})],g.prototype,"highlights",void 0);a([h.property()],g.prototype,"suspendResumeExtentMode",void 0);a([h.property()],g.prototype,"dataExtent",void 0);a([h.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],g.prototype,"suspended",null);a([h.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","scaleVisibility.updating"]})],g.prototype,"updating",null);return g=a([h.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],
g)}(h.declared(b))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection".split(" "),function(r,g,f,a,c,b,l,e,d,h){var n=-.3*d.earthRadius;return function(c){function d(){var a=c.call(this)||
this;a.suspended=!0;a._frustumVisibilityDirty=!0;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new b;a.layerView=null;return a}f(d,c);Object.defineProperty(d.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(a){a!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},
enumerable:!0,configurable:!0});d.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new h.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var c=a.basemapTerrain;this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),c.on("elevation-bounds-change",function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(l.init(c,
["opacity","wireframe"],function(){return b.isVisibleBelowSurface=c.isSeeThrough()}))};d.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty};d.prototype.setExtent=function(a){this.extent=a;this.frustumVisibilityDirty=this.extentIntersectionDirty=!0};d.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};d.prototype.elevationBoundsChange=
function(){this.extentIntersectionDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(d.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentIntersectionDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});d.prototype.idleUpdate=function(a){!a.done()&&this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1)};d.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=
!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=n;else{b=a.basemapTerrain.getElevationBounds();var c=b[0];b=c-Math.max(1,(b[1]-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};d.prototype.updateSuspendFrustumVisible=function(){this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):this._set("suspended",!1)};a([e.property({readOnly:!0})],d.prototype,"suspended",void 0);
a([e.property({readOnly:!0})],d.prototype,"updating",null);return d=a([e.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],d)}(e.declared(c))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(r,g,f){return function(){function a(){this.graphicsCore=null;this.highlights=[]}a.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};a.prototype.setup=
function(a){this.graphicsCore=a};a.prototype.acquireSet=function(a,b){var c=this,e=new f(a,b);this.highlights.push(e);return{set:e,handle:{remove:function(){return c.releaseSet(e)}}}};a.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};a.prototype.setUids=function(a,b){var c=this.graphicsCore.graphics;b.forEach(function(b){a.ids.add(b);(b=c[b])&&b.addHighlight(a.highlightSet,a.options)})};a.prototype.setObjectIds=
function(a,b){var c=this.graphicsCore.graphics;b.forEach(function(b){return a.ids.add(b)});for(var e in c)(b=c[e])&&a.hasGraphic(b)&&b.addHighlight(a.highlightSet,a.options)};a.prototype.graphicCreated=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)})};a.prototype.graphicDeleted=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.removeHighlight(b.highlightSet)})};a.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};
return a}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(r,g,f){return function(){function a(a,b){this.highlightSet=new f;this.ids=new Set;this.options=a;this.objectIdField=b}a.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):this.ids.has(a.graphic.uid)};return a}()})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require",
"exports","../../../../geometry/support/scaleUtils","../../../../layers/graphics/dehydratedFeatures"],function(r,g,f,a){return function(){function c(a){this.sourceSpatialReference=a.sourceSpatialReference;this.destSpatialReference=a.destSpatialReference}c.prototype.adjust=function(a){var b=this._getVerticalUnitScale();1!==b&&(a=a.slice(),this._scaleVerticalUnits(a,b));return a};c.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var a=
f.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),c=f.getMetersPerVerticalUnitForSR(this.destSpatialReference);return a/c}return 1};c.prototype._vertexListsScaleZ=function(a,c){for(var b=0;b<a.length;++b)for(var d=a[b],f=0;f<d.length;++f)d[f][2]*=c};c.prototype._scaleVerticalUnits=function(b,c){for(var e=0;e<b.length;++e){var d=b[e].geometry;d&&a.hasZ(d)&&(this._geometryIsPoint(d)?null!==d.z&&(d.z*=c):this._geometryIsPolyline(d)?this._vertexListsScaleZ(d.paths,c):this._geometryIsPolygon(d)&&
this._vertexListsScaleZ(d.rings,c))}};c.prototype._geometryIsPoint=function(a){return"point"===a.type};c.prototype._geometryIsPolygon=function(a){return"polygon"===a.type};c.prototype._geometryIsPolyline=function(a){return"polyline"===a.type};return c}()})},"esri/views/3d/layers/graphics/stats":function(){define(["require","exports"],function(r,g){Object.defineProperty(g,"__esModule",{value:!0});g.stats=function(f,a){var c=a.graphics3DGraphics,b="null",g=f.suspendResumeExtent;g&&(b=[g[0],g[1],g[2],
g[3]].map(function(a){return a.toPrecision(4)}).join(", "));var g="null",e=a.computedExtent;e&&(g=[e.xmin,e.ymin,e.xmax,e.ymax].map(function(a){return a.toPrecision(4)}).join(", "));return{numCollection:f.loadedGraphics.length,numGraphics:Object.keys(c).length,graphicsUpdating:a.updating,resumeExtent:b,computedExtent:g,updating:f.updating,suspended:f.suspended}}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils",
"../../../../portal/support/geometryServiceUtils"],function(r,g,f,a,c){Object.defineProperty(g,"__esModule",{value:!0});g.toView=function(b){var g=b.view.spatialReference,e=b.layer.fullExtent&&b.layer.fullExtent.spatialReference;return!e||e.equals(g)||"local"!==b.view.viewingMode?f.resolve(null):a.canProject(e,g)?f.resolve(a.project(b.layer.fullExtent,g)):c.projectGeometry(b.layer.fullExtent,g,b.layer.portalItem).then(function(a){if(!b.destroyed&&a)return a}).catch(function(){return null})}})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(r,g,f,a,c,b){return function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.refreshTimestamp=null;return a}f(e,c);e.prototype.refresh=function(a){void 0===a&&(a=Date.now());this._set("refreshTimestamp",a);this.doRefresh&&this.doRefresh()};a([b.property()],e.prototype,"layer",void 0);a([b.aliasOf("layer.refreshInterval")],e.prototype,"refreshInterval",void 0);a([b.property({readOnly:!0})],e.prototype,"refreshTimestamp",void 0);return e=a([b.subclass("esri.layers.mixins.RefreshableLayerView")],
e)}(b.declared(c))})},"url:esri/views/3d/environment/materials/SimpleAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsSimpleAtmosphere"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n\n#ifndef PANORAMIC\n\n  const float TWICEPI \x3d 2.0*3.14159265;\n  const float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\n  uniform vec3 silCircleCenter;\n  uniform vec3 silCircleV1;\n  uniform vec3 silCircleV2;\n  uniform vec2 texV;\n\n#endif\n\n  uniform vec3 lightDirection;\n\n  attribute vec3 $position;\n  varying vec2 vtc;\n  varying float falloff;\n\n  void main(void) {\n\n#ifdef PANORAMIC\n\n    vec3 pos \x3d $position;\n    float ndotl \x3d lightDirection.z;\n    vtc \x3d vec2(0, $position.z+0.05);\n\n#else\n\n    float phi \x3d $position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n    vec3 pos \x3d (sin(phi) * silCircleV1 + cos(phi) * silCircleV2 + silCircleCenter) * $position.y;\n    float ndotl \x3d dot(normalize(pos), lightDirection);\n\n    vtc.x \x3d $position.x / ATMOSPHERE_RIM_SEGMENTS;\n    vtc.y \x3d texV.x * (1.0 - $position.z) + texV.y * $position.z;\n\n#endif\n\n    falloff \x3d max(0.0, (smoothstep(-1.0, 0.8, ndotl + ndotl)));\n\n    gl_Position \x3d proj * view * vec4(pos, 1.0);\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsSimpleAtmosphere"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  varying vec2 vtc;\n  varying float falloff;\n\n  void main() {\n    vec4 texColor \x3d texture2D(tex, vtc);\n    gl_FragColor \x3d texColor * falloff;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/environment/materials/RealisticAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3c!--Vertex Shader for Atmosphere--\x3e\n\x3csnippet name\x3d"vsRealisticAtmosphere"\x3e\x3c![CDATA[\n//\n// Based on Atmospheric scattering vertex shader by Sean O\'Neil from GPU Gems 2 Chapter 16.\n//\n// Link:                   http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\n// Download Portal:        http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html\n// Unmodified Source Code: http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Content/16.zip\n//\n// Adapted for WebGIS by Jascha Gr\u00fcbel (jgruebel@esri.com), Z\u00fcrich 2015\n//\n\n  $vsprecisionf\n\n  //Camera\n  uniform vec2 halfSizeNearPlane;\n  uniform vec3 v3CameraUp;\n  uniform vec3 v3CameraRight;\n  uniform vec3 v3CameraDir;\n  uniform vec2 v2CameraCenterOffset;\n\n  //Attributes\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  //Varyings\n  varying vec3 v3WorldRay;\n  varying vec2 vtc;\n\n#ifdef HAZE\n  varying vec3 v3EyeDir;\n#endif\n\n  void main(void) {\n    vec3 v3Pos \x3d $position;\n    vtc \x3d $uv0;\n    vec2 rayvtc \x3d $uv0 - v2CameraCenterOffset;\n\n#ifdef HAZE\n    v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#else\n    vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#endif\n    v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\n    gl_Position \x3d vec4(v3Pos, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"atmosphereScaleFunction"\x3e\x3c![CDATA[\n  //Approximation for inner integral based on a radii ratio of 10.25:10\n  float scale(float fCos){\n    float x \x3d 1.0 - fCos;\n    return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"toneMapperConstants"\x3e\x3c![CDATA[\n#ifdef HAZE\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\n#else\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\n#endif\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"exponentialToneMapper"\x3e\x3c![CDATA[\n  //ToneMapping operators\n  vec3 expTM(vec3 inputColor,float exposure){\n      return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"reinhardToneMapper"\x3e\x3c![CDATA[\n  vec3 reinhardTM(vec3 inputColor, float exposure){\n      vec3 intermediate \x3d inputColor *exposure;\n      intermediate /\x3d (1.0+intermediate);\n      return pow(intermediate, v3OneOverGamma);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"HSVColorSpace"\x3e\x3c![CDATA[\n//based on http://gamedev.stackexchange.com/a/59808\n// Hue in range [0,1] instead of 360\u00b0\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d \x3d q.x - min(q.w, q.y);\n    float e \x3d 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"atmosphereUniformsConstantsVaryings"\x3e\x3c![CDATA[\n\n  //Light\n  uniform vec3 v3LightDir;      // The direction vector to the light source\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\n  uniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\n\n  //Radii\n  uniform vec4 v4Radii; // inner, inner^2, outer, outer^2,\n\n  //Atmosphere\n  const float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n  //uniform float fScale;         // 1 / (fOuterRadius - fInnerRadius)\n  //uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\n  //uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n  //uniform float fOneOverScaleDepth; // 1.0 / fScaleDepth\n\n  //uniform float fScaleDepthBlue;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\n  //uniform float fScaleOverScaleDepthBlue; // fScale / fScaleDepth\n  //uniform float fOneOverScaleDepthBlue; // 1.0 / fScaleDepth\n\n  uniform vec4 v4AtmosParams1; //(fScale,fScaleDepth,fScaleOverScaleDepth,fOneOverScaleDepth)\n  uniform vec4 v4AtmosParams2; //(g,fScaleDepthBlue,fScaleOverScaleDepthBlue,fOneOverScaleDepthBlue)\n#ifndef HAZE\n  uniform vec4 v4AtmosParams3; //(g2,fMiePhaseCoefficients,fLowerAlphaBlendBound,fOneOverOuterRadiusMinusAlphaBlendBound)\n#endif\n\n  //Camera\n  uniform vec3 v3CameraPos;     // The camera\'s current position\n  //uniform float fCameraHeight;  // The camera\'s current height\n  //uniform float fCameraHeight2; // fCameraHeight^2\n  //uniform float fC; //fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\n  //uniform float fCSur; //fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  uniform vec4 v4SphereComp; //The camera\'s current height, CameraHeight^2,fC,fCSur\n  uniform vec2 nearFar;\n\n  //Camera HDR\n#ifdef HAZE\n  const float fExposure \x3d 1.5;\n#else\n  const float fExposure \x3d 2.0;\n#endif\n\n#ifdef HAZE\n  //Depth texture\n  uniform sampler2D tDepth;\n#endif\n\n  //Testing variables\n  uniform float showTest;\n\n  //Varyings\n  varying vec3 v3EyeDir;\n  varying vec3 v3WorldRay;\n  varying vec2 vtc;\n\n  //Loop constants for integral approximation\n  const float fSamples \x3d 5.0;\n  const int maxSamples \x3d 5;\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmospherePrecomputation"\x3e\x3c![CDATA[\n    float fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\n    float fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\n    float fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\n    float fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\n\n    float fCameraHeight \x3d v4SphereComp[0];\n    float fCameraHeight2 \x3d v4SphereComp[1];\n    float fC \x3d v4SphereComp[2];\n    float fCSur \x3d v4SphereComp[3];\n\n    vec3 cameraPosition \x3d v3CameraPos;\n\n    //Debug variables\n    vec3 test \x3d vec3(0.0,0.0,0.0);\n\n    //Obtain ray from Camera\n    vec3 worldSpaceRay \x3d normalize(v3WorldRay);\n\n    //Compute Atmosphere intersection; i.e. ray/sphere intersection\n    float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n    float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\n\n    //idealized sphere intersection to discard early some pixels\n    float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\n\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereDiscardPixels"\x3e\x3c![CDATA[\n#ifdef HAZE\n      bool continueComputation \x3d true;\n\n      // only use red channel from depth texture.\n      // see \'Issues\' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\n      float depthSample \x3d texture2D(tDepth, vtc).r;\n\n      float zNear \x3d nearFar[0];\n      float zFar \x3d nearFar[1];\n\n      // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n      float zNorm \x3d 2.0 * depthSample - 1.0;\n      float linDepth \x3d 2.0 * zNear * zFar /\n        (zFar + zNear - zNorm * (zFar - zNear));\n\n      float rayEndT;\n      float altitudeAlpha \x3d 1.0;\n\n      // find intersections with ground, but only between the near and far\n      // clipping planes.\n      if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n        vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\n        cameraSpaceRay /\x3d cameraSpaceRay.z;\n        cameraSpaceRay *\x3d linDepth;\n\n        float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n        vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n        float v3WorldRadius2 \x3d dot(v3World, v3World);\n\n        // Handle tall structures:\n        // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n        float transitionStart \x3d fInnerRadius + 20000.0;\n        float transitionHeight \x3d 25000.0;\n        float transitionEnd \x3d transitionStart + transitionHeight;\n\n        float edge0 \x3d transitionStart * transitionStart;\n        float edge1 \x3d transitionEnd * transitionEnd;\n\n        altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\n        rayEndT \x3d cameraSpaceRayLength;\n\n        if (altitudeAlpha \x3e 0.0) {\n          continueComputation \x3d true;\n\n          if (detSur \x3e 0.0) {\n            float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\n            float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n            rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\n          }\n        }\n      }\n#endif\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"atmosphereUnpackAddUniforms"\x3e\x3c![CDATA[\n        float fScale \x3d v4AtmosParams1.x;\n        vec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\n        vec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\n        vec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\n\n#ifndef HAZE\n        float g \x3d v4AtmosParams2.x;\n        float g2 \x3d v4AtmosParams3.x;\n        float fMiePhaseCoefficients \x3d v4AtmosParams3.y;\n        float fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\n        float fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputeRayAndLoopSetup"\x3e\x3c![CDATA[\n        float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n#ifdef HAZE\n        float nearT \x3d abs(rayStartT);\n        float farT \x3d abs(rayEndT);\n#else\n        float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\n\n#endif\n\n        float fDistance;//calculate its scattering offset\n        // Calculate the ray\'s starting position\n        if (rayStartT \x3c 0.0)\n        { //ray starts from camera to far\n          rayStartT \x3d 0.0;\n#ifndef HAZE\n          fDistance \x3d fScale*(fInnerRadius - fCameraHeight);\n#endif\n        }\n#ifndef HAZE\n        else\n        {//outside atmosphere\n          fDistance \x3d -1.0;\n        }\n#endif\n\n        // Initialize the scattering loop variables\n        vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\n\n#ifdef HAZE\n        vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\n\n        float fEndLength \x3d length(v3End);\n        float fLocalCameraHeight \x3d length(v3Start);\n\n        //computed for the original end point to get consistent light angles after possible inversions\n        float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\n\n        if (nearT \x3e farT)\n        {\n          if (fLocalCameraHeight \x3c fEndLength)\n          {\n            //Switch positive slopes for flipped rays\n            v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\n            v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\n            worldSpaceRay *\x3d -1.0;\n            fEndLength \x3d length(v3End);\n            fLocalCameraHeight \x3d length(v3Start);\n          }\n          else if (fLocalCameraHeight \x3d\x3d fEndLength)\n          {// create minuscule fake slope for integration if the slope is zero\n            fLocalCameraHeight +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n            //slope for the camera function\n          }\n        }\n\n        //Calculate its scattering offset\n        // Assumes camera constrains of WSV 3.8\n        float fCameraDepth;\n        float fCameraDepthBlue;\n        if (fLocalCameraHeight \x3e fOuterRadius)\n        {\n          fDistance \x3d fInnerRadius - fOuterRadius;\n        } else\n        {//outside atmosphere\n          fDistance \x3d fEndLength - fLocalCameraHeight;\n        }\n\n#endif\n        vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\n\n        float fRayLength \x3d rayEndT - rayStartT;\n        float fSampleLength \x3d fRayLength / fSamples;\n        float fScaledLength \x3d fSampleLength * fScale;\n        vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\n        vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\n\n#ifdef HAZE\n        float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / fEndLength;\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\n\n        float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\n        vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\n#else\n        float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\n        float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\n\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\n#endif\n\n        //Loop variables\n        vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\n        vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\n        vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\n        vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputeSampleContribution"\x3e\x3c![CDATA[\n          float fHeight \x3d length(v3SamplePoint);\n          vec2 v2Depth \x3d exp(v2ScaleOverScaleDepth * (fInnerRadius - fHeight));\n#ifdef HAZE\n          vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\n#else\n          float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\n          float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\n          float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\n          vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\n#endif\n          v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\n          v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\n\n          v3FrontColor +\x3d v3Attenuate * v2Depth.x;\n          v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\n\n          v3SamplePoint +\x3d v3SampleRay;\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputeHDRColors"\x3e\x3c![CDATA[\n        //Phase computation\n        //clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n        float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\n        float fOnePlusCos2 \x3d fCos*fCos + 1.0;\n#ifdef HAZE\n        // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n        vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\n\n        //Scaled Length is only applied afterwards to save multiplications\n        vec3 v3Color \x3d colorCoefficients *v3FrontColor;\n        vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\n#else\n        vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\n        float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\n\n        // Calculate the attenuation factor for the ground\n        vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\n        vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"atmosphereComputePixelColor"\x3e\x3c![CDATA[\n\n\n        //HDR to LDR conversion\n        vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\n        vec3 ldrRed \x3d expTM(v3Color,fExposure);\n\n        //mix reddish and blueish atmosphere\n        vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\n#ifdef HAZE\n        LDR *\x3d (1.0-fCameraAngle);\n        vec3 hsv \x3d rgb2hsv(LDR);\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost haze saturation by 50%\n        LDR \x3d hsv2rgb(hsv);\n        vec3 finalColor \x3d LDR;\n        // when rendering we specify the blend functions such that\n        // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n#else\n        //reinhard tonemapper for looking upwards\n        vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\n        LDR +\x3d angleMultiplier*ldrReinhard;\n\n        //height dependent parameter to smooth out reddish atmosphere\n        float side \x3d (rayEndT+rayStartT)*0.5;\n        float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\n        float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\n\n        vec3 finalColor \x3d LDR*h2;\n        vec3 hsv \x3d rgb2hsv(finalColor);\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost sky saturation by 50%\n        finalColor \x3d hsv2rgb(hsv);\n#endif\n#ifndef HAZE\n        float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\n        gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\n#else\n        gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3c!--Fragment Shader for Atmosphere--\x3e\n\x3csnippet name\x3d"fsRealisticAtmosphere"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n$atmosphereUniformsConstantsVaryings\n\n$atmosphereScaleFunction\n\n  //Conversion implementation found in util.xml\n$rgba2float\n\n\n$toneMapperConstants\n$exponentialToneMapper\n#ifndef HAZE\n$reinhardToneMapper\n#endif\n\n$HSVColorSpace\n\n  void main()\n  {\n\n    $atmospherePrecomputation\n\n    //Inside Atmosphere\n    if (det \x3e\x3d 0.0) {\n#ifdef HAZE\n      $atmosphereDiscardPixels\n\n      if (continueComputation) {\n#endif\n        $atmosphereUnpackAddUniforms\n\n        $atmosphereComputeRayAndLoopSetup\n\n        // Now loop through the sample rays\n        for(int i\x3d0; i\x3cmaxSamples; i++)\n        {\n          $atmosphereComputeSampleContribution\n        }\n\n        $atmosphereComputeHDRColors\n\n        $atmosphereComputePixelColor\n\n        //Debug variable overlay\n        if(showTest\x3e0.0){\n          gl_FragColor \x3d vec4(test,1.0);\n        }\n#ifdef HAZE\n      } else {//Not on surface\n        gl_FragColor \x3d vec4(0.0);\n      }\n#endif\n    } else {//Outside Atmosphere\n      gl_FragColor \x3d vec4(0.0);\n    }\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position \x3d vec4($position.xy, 0.0, 1.0);\n    vtc \x3d $position.xy * 0.5 + 0.5;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform float uToPremultiplied;\n\n  varying vec2 vtc;\n\n  void main() {\n    vec4 texColor \x3d texture2D(tex, vtc);\n\n    // optionally, convert to premultiplied\n    gl_FragColor \x3d mix(\n      texColor,\n      vec4(texColor.rgb * texColor.a, texColor.a),\n      uToPremultiplied\n    );\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/environment/materials/StarMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderStar"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tuniform vec4 viewport;\n\n\tattribute vec3 $position;\n\tattribute vec4 $color;\n  attribute float $size;\n\n\tvarying vec4 vcolor;\n\tvarying float vsize;\n\n\t$alignToPixelCenter\n\n\tvoid main(void) {\n\t\tvec4 posProj \x3d proj * view * model*vec4($position*1.0e25,1.0);//move infinitely far away\n\t\tgl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\tvcolor \x3d $color/1.2;\n\t\tvsize \x3d size*5.0;\n\t\tgl_PointSize \x3d vsize;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderStar"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tvarying vec4 vcolor;\n\tvarying float vsize;\n\n\tvoid main() {\n\t\tfloat cap \x3d 0.7;\n\t\tfloat scale \x3d 1.0/cap;\n\t\tfloat helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n\t\tfloat alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\n\t\tfloat intensity \x3d alpha*alpha*alpha;\n\t\tif (vsize \x3c 3.0)\n\t\t\tintensity *\x3d 0.5;\n\t\tgl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\n\t\tgl_FragColor.xyz *\x3d vcolor.xyz;\n\t}\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsRibbonEdgeStyleOutputs"\x3e\x3c![CDATA[\n#if defined(SKETCH) || defined(UBER)\n\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x +\x3d aVariantOffset;\n\n    vLineIndex \x3d lineIndex;\n  }\n#endif /* SKETCH || UBER */\n\n#if defined(SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif defined(SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif defined(UBER)\n  varying float vType;\n\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType \x3d unpackedAttributes.type;\n\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif /* UBER */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeRegular"\x3e\x3c![CDATA[\n\n#if defined(UBER) || !defined(SKETCH)\n\n  float calculateLineAmplitudeRegular() {\n    return 0.0;\n  }\n\n#endif /* UBER || !SKETCH */\n\n#if !defined(UBER) \x26\x26 !defined(SKETCH)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeRegular();\n  }\n\n#endif /* !UBER \x26\x26 !SKETCH */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeSketch"\x3e\x3c![CDATA[\n\n#if defined(UBER) || defined(SKETCH)\n\n  uniform float uStrokesAmplitude;\n\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n\n#endif /* UBER || SKETCH */\n\n#ifdef SKETCH\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n\n#endif /* SKETCH */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeUber"\x3e\x3c![CDATA[\n\n#ifdef UBER\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type \x3d unpackedAttributes.type;\n\n    if (type \x3c\x3d 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeRegular();\n    }\n  }\n\n#endif /* UBER */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsRibbonEdge"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  // Transformations\n  uniform mat4 uProj;\n  uniform mat4 uView;\n  uniform mat4 uModel;\n  uniform vec3 uCameraPosition;\n\n  // Line configuration\n\n  // Conversion constants\n  uniform vec2 uPixelToNDC;\n  uniform vec2 uNDCToPixel;\n\n  // Inputs\n  attribute vec3 aPosition0;\n  attribute vec3 aPosition1;\n  attribute float aVariantOffset;\n  attribute float aVariantStroke;\n  attribute float aVariantExtension;\n\n#ifdef SILHOUETTE\n\n  attribute vec3 aNormalA;\n  attribute vec3 aNormalB;\n\n#else /* SILHOUETTE */\n\n  attribute vec3 aNormal;\n\n#endif /* SILHOUETTE */\n\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\n\nstruct UnpackedAttributes {\n  vec2 sideness;\n  vec2 sidenessNorm;\n  float lineWidthPixels;\n  float extensionLengthPixels;\n\n#ifdef UBER\n\n  float type;\n\n#endif\n};\n\n  // Output required to compute color\n  varying vec4 vColor;\n\n  // Output required to compute distance to line/caps\n  varying vec3 vPosition;\n  varying float vRadius;\n  varying float vLineLengthPixels;\n  varying float vSizeFalloffFactor;\n\n  $EdgeRendererUtils_adjustProjectedPosition\n\n  $vsRibbonEdgeStyleOutputs\n\n  $vsRibbonEdgeLineAmplitudeRegular\n  $vsRibbonEdgeLineAmplitudeSketch\n  $vsRibbonEdgeLineAmplitudeUber\n\n  $EdgeRendererUtils_readComponentData\n  $EdgeRendererUtils_distanceBasedPerspectiveFactor\n  $EdgeRendererUtils_worldNormal\n  $EdgeRendererUtils_extensionFalloff\n\n#ifdef SILHOUETTE\n\n  $EdgeRendererUtils_isSilhouetteEdge\n\n#endif /* SILHOUETTE */\n\n  vec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vec2 sideness \x3d unpackedAttributes.sideness;\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n    vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n    vec4 projPosV0 \x3d uProj * viewPosV0;\n    vec4 projPosV1 \x3d uProj * viewPosV1;\n    vec4 projPos \x3d uProj * viewPos;\n\n    vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n    vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n    float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n    float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n    vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n    vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n    float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z);\n    float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n    float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n    float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes);\n\n    vSizeFalloffFactor \x3d falloffFactor;\n\n    float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n    float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n#ifdef ANTIALIASING\n\n    const float aaPaddingPixels \x3d 1.0;\n\n    // Line size with padding\n    float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n    float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n\n    // Line length with padding\n    float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n    float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\n\n#else /* ANTIALIASING */\n\n    // Even if there is no AA, we still want to do proper \x3c1px rendering,\n    // so we effectively clamp the pixel sizes to minimum of 1px and compute\n    // coverage in the fragment shader\n    float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n    float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n\n    float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\n\n#endif /* ANTIALIASING */\n\n    // Half line width in NDC including padding for anti aliasing\n    vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n    vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n    vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n    // Compute screen space position of vertex, offsetting for line size and end caps\n    vec2 ndcOffset \x3d (\n        screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n      + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n    );\n\n    projPos.xy +\x3d ndcOffset * projPos.w;\n    projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n    projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n    // Line length with end caps\n    float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n    float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n    // Position in pixels with origin at first vertex of line segment\n    vPosition \x3d vec3(\n      halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n      pixelPositionAlongLine,\n      pixelPositionAlongLine / extendedLineLengthPixels\n    );\n\n    // The line width radius in pixels\n    vRadius \x3d lineWidthPixels * 0.5;\n    vLineLengthPixels \x3d extendedLineLengthPixels;\n\n#ifdef SILHOUETTE\n\n    gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\n\n#else /* SILHOUETTE */\n\n    gl_Position \x3d projPos;\n\n#endif /* SILHOUETTE */\n\n#ifdef UBER\n\n    if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\n      gl_Position \x3d vec4(10, 10, 10, 1);\n    }\n\n#elif defined(SKETCH)\n\n    if (lineLengthPixels \x3c\x3d 3.0) {\n      gl_Position \x3d vec4(10, 10, 10, 1);\n    }\n\n#endif\n\n    return projPos;\n  }\n\n#ifdef UBER\n\n  UnpackedAttributes unpackAttributes(ComponentData component) {\n\n    vec2 sidenessNorm \x3d aSideness;\n    vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n\n    float fType \x3d component.type;\n    float extensionLengthPixels \x3d component.extensionLength;\n    float lineWidth \x3d component.lineWidth;\n\n    if (fType \x3c\x3d 0.0) {\n      extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\n    }\n\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n  }\n\n#else /* UBER */\n\n  UnpackedAttributes unpackAttributes(ComponentData component) {\n    vec2 sidenessNorm \x3d aSideness;\n    vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n    float extensionLengthPixels \x3d component.extensionLength;\n\n#ifdef SKETCH\n\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\n\n#endif /* SKETCH */\n\n    float lineWidth \x3d component.lineWidth;\n\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n  }\n\n#endif /* UBER */\n\n  void main() {\n    ComponentData component \x3d readComponentData();\n    UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n    vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\n    vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\n\n    vec4 viewPosV0 \x3d uView * worldPosV0;\n    vec4 viewPosV1 \x3d uView * worldPosV1;\n\n#ifdef SILHOUETTE\n\n    vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\n\n#else /* SILHOUETTE */\n\n    vec3 worldNormal \x3d modelToWorldNormal(aNormal);\n\n#endif /* SILHOUETTE */\n\n    // General geometric computation for all types of edges\n    vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n\n    // Component color\n    vColor \x3d component.color;\n\n    // Specific computation for different edge styles\n    calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetSketch"\x3e\x3c![CDATA[\n\n$rgba2float\n\n#if defined(UBER) || defined(SKETCH)\n\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n\n  varying vec2 vStrokeUV;\n\n  float calculateLineOffsetSketch() {\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\n  }\n\n#endif /* UBER || SKETCH */\n\n#ifdef SKETCH\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n\n#endif /* SKETCH */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetRegular"\x3e\x3c![CDATA[\n\n#if defined(UBER) || !defined(SKETCH)\n\n  float calculateLineOffsetRegular() {\n    return 0.0;\n  }\n\n  float calculateLinePressureRegular() {\n    return 1.0;\n  }\n\n#endif /* UBER || !SKETCH */\n\n#if !defined(UBER) \x26\x26 !defined(SKETCH)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetRegular();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureRegular();\n  }\n\n#endif /* !UBER || !SKETCH */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetUber"\x3e\x3c![CDATA[\n\n#ifdef UBER\n  varying float vType;\n\n  float calculateLineOffset() {\n    if (vType \x3c\x3d 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetRegular();\n    }\n  }\n\n  float calculateLinePressure() {\n    if (vType \x3c\x3d 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureRegular();\n    }\n  }\n#endif /* UBER */\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRibbonEdge"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  varying vec4 vColor;\n  varying float vRadius;\n  varying vec3 vPosition;\n  varying float vLineLengthPixels;\n  varying float vSizeFalloffFactor;\n  varying float vLineIndex;\n\n  // At which coverage threshold we discard a fragment completely\n  #define COVERAGE_TEST_THRESHOLD 0.01\n\n  $fsRibbonEdgeLineOffsetRegular\n  $fsRibbonEdgeLineOffsetSketch\n  $fsRibbonEdgeLineOffsetUber\n\n  vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n    float lineOffset \x3d calculateLineOffset();\n    float positionX \x3d position.x - lineOffset;\n\n    if (radius \x3c 1.0) {\n      // Handle this specifically for subpixel sizes:\n      // 1. Compute correct coverage (note coverage is computed by\n      //    0.5 - dist, so we make sure that that will lead to correct\n      //    subpixel coverage\n      // 2. Ignore rounded caps\n      float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n      float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n      float coverage \x3d min(coverageX, coverageY);\n\n      return vec2(0.5 - coverage, 0.0);\n    }\n    else {\n      // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n      float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n      vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n      return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n    }\n  }\n\n  void main() {\n\n    float radius \x3d vRadius * calculateLinePressure();\n\n    vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n    float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n#ifdef ANTIALIASING\n\n    const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\n\n#else /* ANTIALIASING */\n\n    // Use subpixel coverage computation when lines get subpixel widths\n    // so we still render them appropriately. Otherwise discard anything\n    // that is not fully within the line\n    float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n\n#endif /* ANTIALIASING */\n\n    if (coverage \x3c coverageLimit) {\n      discard;\n    }\n\n    float alpha \x3d vColor.a * coverage;\n\n    gl_FragColor \x3d vec4(vColor.rgb, alpha);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRendererUtils.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"EdgeRendererUtils_distanceBasedPerspectiveFactor"\x3e\x3c![CDATA[\n  uniform float uDistanceFalloffFactor;\n\n  float distanceBasedPerspectiveFactor(float distance) {\n    return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"EdgeRendererUtils_readComponentData"\x3e\x3c![CDATA[\n  uniform sampler2D uComponentDataTex;\n  uniform vec2 uComponentDataTexInvDim;\n\n  attribute float aComponentIndex;\n\n  #define COMPONENT_COLOR_FIELD_OFFSET 0.0\n  #define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n  #define COMPONENT_FIELD_COUNT 2.0\n\n  #define LINE_WIDTH_FRACTION_FACTOR 8.0\n  #define EXTENSION_LENGTH_OFFSET 128.0\n\n  #define COMPONENT_TEX_WIDTH 4096.0\n\n  vec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n    float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n    float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n    float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n    vec2 linearIndex \x3d vec2(\n      (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n      (rowIndex + 0.5) * uComponentDataTexInvDim.y\n    );\n\n    return linearIndex;\n  }\n\n  struct ComponentData {\n    vec4 color;\n    float lineWidth;\n    float extensionLength;\n    float type;\n  };\n\n  ComponentData readComponentData() {\n    vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n    vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n    vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n    vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n    return ComponentData(\n      vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n      otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n      otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n      -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n    );\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"EdgeRendererUtils_isSilhouetteEdge"\x3e\x3c![CDATA[\n  // #uniforms: uView, uModel\n  bool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n    // transform the two face normals\n    vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\n    vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\n\n    // compute the direction from the edge to the camera\n    vec3 viewDir \x3d -viewPos.xyz;\n\n    // check which of the two faces are visible\n    // display the edge if exactly one of the two is visible\n    float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\n    float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\n\n    // 1 if exactly one face visible, 0 otherwise\n    return faceAVisible * faceBVisible \x3c 0.0;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"EdgeRendererUtils_adjustProjectedPosition"\x3e\x3c![CDATA[\n  uniform vec2 uDepthBias;\n  uniform vec2 uViewportDimInv;\n\n  // Utility function to check for NaN values\n  bool isNaN(float val) {\n    return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n    // important: some nVidias failed to cope with version below.\n    // Probably wrong optimization.\n    /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n  }\n\n  // An offset in xy screen space, along the projected normal of the edge\n  // This reduces depth fighting when looking at a face from a flat angle\n  vec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n    float offsetXY \x3d uDepthBias.x;\n    float offsetZ  \x3d uDepthBias.y;\n\n    // screen space pixel offset\n    // we multiply by two to account for the fact that NDC go from -1 to 1\n    // we multiply by projPos.w to compensate for the perspective divison that happens later\n    // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n    // towards the camera\n    vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\n\n    return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n  }\n\n  // A z-offset, using a depth based heuristic.\n  float calculateProjectedBiasZ(vec4 projPos) {\n    float offsetZ \x3d uDepthBias.y;\n    return sqrt(projPos.z) * offsetZ;\n  }\n\n  vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n    vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n    // we currently have to do this check because some geometries come with 0 length edge normals.\n    // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n    if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n      projPos.xy +\x3d offsetXY;\n    }\n\n    projPos.z +\x3d calculateProjectedBiasZ(projPos) * lineWidth;\n\n    return projPos;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"EdgeRendererUtils_worldNormal"\x3e\x3c![CDATA[\n  vec3 modelToWorldNormal(vec3 normal) {\n    return (uModel * vec4(normal, 0)).xyz;\n  }\n\n  vec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n    return modelToWorldNormal(normalize(normalA + normalB));\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"EdgeRendererUtils_extensionFalloff"\x3e\x3c![CDATA[\n  // Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\n  // fall-off exponentially\n  float calculateExtensionLength(float extensionLength, float lineLength) {\n    return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/HUDMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderHUD"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  uniform float pixelRatio;\n  uniform vec2 screenOffset;\n  uniform vec2 anchorPos;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspective;\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n\n  attribute vec2 $uv0;\n  attribute vec4 $color;\n  attribute vec2 $size;\n  attribute vec4 $auxpos2;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n  $vvUniforms\n\n  $alignToPixelCenter\n  $alignToPixelOrigin\n  $projectPositionHUD\n  $vvFunctions\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 posProj \x3d projectPositionHUD(projectAux);\n\n    vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n    inputSize \x3d screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n    vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n    inputSize \x3d $size;\n\n    vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n\n#ifdef VV_SIZE\n    // only use width (.xx) for proportional scaling\n    // (if no width was defined in vv, width\n    //  will be a copy of height vv)\n    inputSize *\x3d vvGetScale($auxpos2).xx;\n#endif\n\n    vec2 combinedSize \x3d inputSize * pixelRatio;\n    vec4 quadOffset \x3d vec4(0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n    bool visible \x3d testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  voccluded \x3d visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n    if (visible) {\n#endif\n      // UV goes from 0 to 1.99999, where the integer part is used\n      // for the normalized vertex coordinates, and the fractional\n      // part is used for texture sampling\n      vec2 uv01 \x3d floor($uv0);\n      vec2 uv \x3d $uv0 - uv01;\n\n      // Displace icon based on anchor position (normalized for size) and\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n      // SDF primitives might be scaled so that the SDF texture resolution does\n      // not match the resolution of the canvas, but we still want to render\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\n      // pixel border at the geometry center achieves this, since SDF textures\n      // always have power of 2 dimensions.\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n      posProj +\x3d quadOffset;\n\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\n      // border renders textures with pixel-perfect results. If the texture\n      // resolution does not match the canvas resolution then aligning is\n      // redundant.\n      if (inputSize.x \x3d\x3d $size.x) {\n        posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n      }\n#endif\n\n      gl_Position \x3d posProj;\n\n      vtc \x3d uv;\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\n#endif\n\n      vsize \x3d inputSize;\n#ifdef OCCL_TEST\n    } else {\n      vtc \x3d vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords \x3d vec3(0);\n#endif\n\n    }\n#endif\n\n    gl_Position \x3d posProj;\n\n#ifdef VV_COLOR\n    vcolor \x3d vvGetColor($auxpos2, vvColorValues, vvColorColors);\n#else\n    vcolor \x3d $color / 255.0;\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUDBaseVariables"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  #extension GL_OES_standard_derivatives : require\n\n  uniform sampler2D tex;\n  uniform vec4 overrideColor;\n  uniform vec4 outlineColor;\n  uniform float outlineSize;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUDBaseMain"\x3e\x3c![CDATA[\n  vec4 premultiply(vec4 v) {\n    return vec4(v.rgb * v.a, v.a);\n  }\n\n  $rgba2float\n\n  void main() {\n\n#ifdef SIGNED_DISTANCE_FIELD\n    vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    vec4 fillPixelColor \x3d overrideColor * vcolor;\n\n    // Attempt to sample texel centers to avoid that thin cross outlines\n    // disappear with large symbol sizes.\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n    const float txSize \x3d 128.0;\n    const float texelSize \x3d 1.0 / txSize;\n    // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n    vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n    vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n    // Get distance and map it into [-0.5, 0.5]\n    float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n    // Distance in output units (i.e. pixels)\n    float dist \x3d d * vsize.x;\n\n    // Create smooth transition from the icon into its outline\n    fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\n\n    if (outlineSize \x3e 0.25) {\n      vec4 outlinePixelColor \x3d outlineColor;\n      float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n      // Create smooth transition around outline\n      outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n      float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n      vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n      gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n    }\n    else {\n      gl_FragColor \x3d premultiply(fillPixelColor);\n    }\n\n    // visualize SDF:\n    // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n    // fragment color. Input textures should already be pre-multiplied and so\n    // don\'t require adjustment, but the override and vertex colors must be\n    // modulated by their alpha values.\n\n    gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n     float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n     gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\n#endif\n\n    if (gl_FragColor.a \x3c 0.1) {\n      discard;\n    }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUD"\x3e\x3c![CDATA[\n$fragmentShaderHUDBaseVariables\n$fragmentShaderHUDBaseMain\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderHUDHighlight"\x3e\x3c![CDATA[\n$fragmentShaderHUDBaseVariables\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n$fragmentShaderHUDBaseMain\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\n    // do it for all highlight pixel based on the centroid occlusion. This\n    // is a temporary solution for:\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n    if (voccluded \x3d\x3d 1.0) {\n      gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n    } else {\n      gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n    }\n#else\n    $highlightWrite\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"vertexShaderOcclusionTestPixel"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  $alignToPixelCenter\n  $projectPositionHUD\n\n  void main(void) {\n    vec4 posProjCenter;\n\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\n    // of clip space.\n    if (dot($position, $position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\n      // the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderTexOnly"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n\t\tvtc \x3d $uv0;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderTexOnly"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tuniform vec4 color;\n\tvarying vec2 vtc;\n\n\tvoid main() {\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t\tgl_FragColor \x3d texColor * color;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/highlight.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3c!--\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\nSmartly downsamples a texture, halfing its resolution. This allows for a square\nscreen region to check if none, any or all pixels were set.\n\nThe red channel is always ceiled after interpolating the 4 merged pixels.\nThis allows to evaluate:\nany(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\nnone(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\n\nThe green and blue channels are set to floor(max(green, blue)).\nThis allows to evaluate:\nall(pixels.green || pixels.blue) as green \x3d\x3d 1.0\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n--\x3e\n\n\x3csnippet name\x3d"vsConservativeDownsample"\x3e\x3c![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n\n  void main()\n  {\n    gl_Position \x3d vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsConservativeDownsample"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec2 invFramebufferDim;\n\n  void main()\n  {\n    vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n    vec4 value \x3d texture2D(tex, coord);\n    float mx \x3d floor(max(value.g, value.b));\n    gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c!--\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\nGaussian blur with linear sampling. Supports different number of samples, but\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\nthe number of samples taken.\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGAUSSIAN_SAMPLES (3,5,7)\n\nThis technique requires linear filtering on source texture\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n--\x3e\n\x3csnippet name\x3d"vsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform sampler2D coverageTex;\n    varying vec3 blurCoordinate;\n  #else\n    uniform vec2 blurSize;\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    gl_Position \x3d vec4($position, 0.0, 1.0);\n\n    #ifdef GRID_OPTIMIZATION\n      // sample the coverage texture at the block center\n      // and if no coverage detected, create degenerate triangle\n      vec4 cov \x3d texture2D(coverageTex, $uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0,0,0,0);\n      }\n\n      // create texture coordinate for blur center\n      // encode information about fully inside block in z coordinate\n      blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n    #else\n      vec2 uv \x3d $position.xy * .5 + vec2(.5);\n\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\n        // not proper gaussian weights\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n        // not proper gaussian weights\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n        // not proper gaussian weights\n        blurCoordinates[0] \x3d uv;\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\n        blurCoordinates[7] \x3d uv + blurSize * 7.1;\n        blurCoordinates[8] \x3d uv - blurSize * 7.1;\n      #endif\n    #endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform vec2 blurSize;\n    varying vec3 blurCoordinate;\n  #else\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      vec2 uv \x3d blurCoordinate.xy;\n      vec4 center \x3d texture2D(tex, uv);\n\n      // do not blur if no pixel or all pixels in neighborhood are set\n      if (blurCoordinate.z \x3d\x3d 1.0) {\n        gl_FragColor \x3d center;\n      }\n      else {\n        vec4 sum \x3d vec4(0.0);\n\n        #if GAUSSIAN_SAMPLES \x3d\x3d 3\n          // not proper gaussian weights\n          sum +\x3d center * 0.204164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n          sum +\x3d center * 0.204164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n          // not proper gaussian weights\n          sum +\x3d center * 0.204164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n          sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\n          sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n          // not proper gaussian weights\n          sum +\x3d center * 0.154164;\n          sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n          sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n          sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n          sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\n          sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\n        #endif\n\n        gl_FragColor \x3d sum;\n      }\n    #else\n      vec4 sum \x3d vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\n        // not proper gaussian weights\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n        // not proper gaussian weights\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n        // not proper gaussian weights\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\n        sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\n        sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\n      #endif\n\n      gl_FragColor \x3d sum;\n    #endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c!--\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\nMerging blurred outlines with source image, advanced version\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGRID_DEBUG (set or !set)\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n--\x3e\n\x3csnippet name\x3d"vsHighlightApply"\x3e\x3c![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  #ifdef GRID_OPTIMIZATION\n    attribute vec2 $uv0;\n    uniform sampler2D coverageTex;\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      #ifdef GRID_DEBUG\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block,\n        // or all pixels set, hide block\n        if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\n          gl_Position \x3d vec4(0,0,0,0);\n          return;\n        }\n        gl_Position \x3d vec4($position, .0, 1.0);\n        uv \x3d $uv0;\n        return;\n      #else\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block, hide block\n        if (cov.r \x3d\x3d 0.0) {\n          gl_Position \x3d vec4(0,0,0,0);\n          return;\n        }\n      #endif\n    #endif\n\n    gl_Position \x3d vec4($position, .0, 1.0);\n    uv \x3d $position.xy * .5 + vec2(.5);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlightApply"\x3e\x3c![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform sampler2D origin;\n\n  uniform vec4 color;\n  uniform float outlineSize;\n  uniform float blurSize;\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\n  varying vec2 uv;\n\n  void main()\n  {\n    #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\n      gl_FragColor \x3d vec4(uv, 0, 1.0);\n    #else\n      // Read the highlight intensity from the blurred highlight image\n      vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n      float highlightIntensity \x3d blurredHighlightValue.a;\n\n      // Discard all pixels which are not affected by highlight\n      if (highlightIntensity \x3d\x3d 0.0) {\n        discard;\n      }\n\n      vec4 origin_color \x3d texture2D(origin, uv);\n\n      float outlineIntensity;\n      float fillIntensity;\n\n      // if occluded\n      if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n        outlineIntensity \x3d color.w * opacities[1];\n        fillIntensity \x3d color.w * opacities[3];\n      }\n      // if unoccluded\n      else {\n        outlineIntensity \x3d color.w * opacities[0];\n        fillIntensity \x3d color.w * opacities[2];\n      }\n\n      float inner \x3d 1.0 - outlineSize / 9.0;\n      float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n      float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n      //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n      float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n      float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n      // I.e., color should not be premultiplied with alpha\n      gl_FragColor \x3d vec4(color.xyz, intensity);\n    #endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/occluded.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsRenderOccludedApply"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position \x3d vec4($position, 0.0, 1.0);\n    uv \x3d $position.xy * 0.5 + vec2(0.5);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRenderOccludedApply"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D occludedColorMap;\n\n  varying vec2 uv;\n\n  void main() {\n    vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\n    gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/ssao.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\t\x3csnippet name\x3d"createFsSSAOSrc"\x3e\x3c![CDATA[\n\n\t$fsprecisionf\n\n\tuniform sampler2D rnm;\n\tuniform sampler2D normalMap;\n\tuniform sampler2D depthMap;\n\tuniform float\t\tssaoAtt;\n\tuniform vec2\t\trnmScale;\n\tuniform float\t\tradius;\n\tuniform vec2\t\tnearFar;\n\tuniform vec3\t\tpSphere[64];\n\n\tvarying vec2\t\tuv;\n\n\tconst\tfloat\t\tstrength \x3d .07;\n\tconst\tfloat\t\tfalloff \x3d .000002;\n\n\t$rgba2float\n\tvoid main(void) {\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\t\tfloat currentPixelDepth \x3d rgba2float(texture2D(depthMap, uv));\n\t\tvec3 ep \x3d vec3(uv.xy, currentPixelDepth);\n\t\tvec3 norm \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\n\t\tfloat bl \x3d .0;\n\t\tfloat f \x3d mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\n\t\tfloat radD \x3d radius / f;\n\t\tradD \x3d min(radD, .5);\n\t\tfloat depthDifference;\n\t\tvec3 ray;\n\n\t\tfor(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i) {\n\t\t\tray \x3d radD*reflect(pSphere[i], fres);\n\t\t\tvec2 tc \x3d ep.xy + sign(dot(ray, norm) ) * ray.xy;\n\t\t\tif (tc.x \x3e\x3d .0 \x26\x26 tc.y \x3e\x3d .0 \x26\x26 tc.x \x3c\x3d 1.0 \x26\x26 tc.y \x3c\x3d 1.0) {\n\t\t\t\tfloat occluderDepth \x3d rgba2float(texture2D(depthMap, tc));\n\t\t\t\tvec3 occluderNormal \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\n\t\t\t\tdepthDifference \x3d currentPixelDepth - occluderDepth;\n\t\t\t\tbl +\x3d step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\n\t\t\t};\n\t\t}\n\n\t\tfloat ao \x3d 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\n\t\tgl_FragColor.a \x3d ao;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"getDepthLinear"\x3e\x3c![CDATA[\n\tfloat getDepthLinear(vec2 ssC) {\n\t\treturn -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"createFsSSAOSrcObscurance"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform mat4 projMatrixInv;\n\n\tuniform sampler2D normalMap;\n\tuniform sampler2D depthMap;\n\n\tuniform float     intensity;\n\n\tuniform float projScale;\n\tuniform float     radius;\n\tuniform vec2      nearFar;\n\n\tuniform vec4      projInfo;\n\n\tuniform vec2\t  screenDimensions;\n\n\t//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\n\tuniform vec3\t\tpSphere[NUM_TAP_SAMPLES]; //tap position\n\tuniform vec2\t\trnmScale;\n\tuniform sampler2D rnm; //noise texture\n\n\t//set z scaling, used to prevent division in ortho mode\n\tuniform vec2 zScale;\n\n\tvarying vec2  uv;\n\tvarying vec4  camPos;\n\n\t$rgba2float\n\t$getDepthLinear\n\n\t/** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\n\t/*uniform float numSpiralTurns;\n\tvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n\t\t// Radius relative to ssR\n\t\tfloat alpha \x3d (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\n\t\tfloat angle \x3d alpha * (numSpiralTurns * 6.28) + spinAngle;\n\n\t\tssR \x3d alpha;\n\t\treturn vec2(cos(angle), sin(angle));\n\t}*/\n\n\n\tfloat fallOffFunction(float vv, float vn, float bias) {\n\t  float radius2 \x3d radius * radius;\n\n\t\t// A: From the HPG12 paper\n\t\t// Note large epsilon to avoid overdarkening within cracks\n\t\t// return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n\t\t// B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n\t\tfloat f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n\t\t// C: Medium contrast (which looks better at high radii), no division.  Note that the\n\t\t// contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\n\t\t// more computationally efficient and happens to be aesthetically pleasing.\n\t\t// return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n\t\t// D: Low contrast, no division operation\n\t\t// return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n\t}\n\n\n\t/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\n\tfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n\t\tvec3 v \x3d Q - C;\n\t\tfloat vv \x3d dot(v, v);\n\t\tfloat vn \x3d dot(normalize(v), n_C);\n\t\treturn fallOffFunction(vv, vn, 0.1);\n\t}\n\n\n\t/** Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\n\t\tpixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\n\t\tis at (0.5, 0.5) [but that need not be the location at which the sample tap\n\t\twas placed!]\n\n\t\tCosts 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n\t  */\n\tvec3 reconstructCSPosition(vec2 S, float z) {\n\t\treturn vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n\t}\n\n\tvoid main(void)\n\t{\n\n\t\t//Hash function used in the HPG12 AlchemyAO paper\n\t\t//Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n\t\t//ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n\t\t//float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n\t   float currentPixelDepth \x3d getDepthLinear(uv);\n\n\t   if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n\t\tgl_FragColor \x3d vec4(0);\n\t\treturn;\n\t   }\n\n\t   vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n\t   // get the normal of current fragment\n\t   vec4 norm4 \x3d texture2D(normalMap, uv);\n\t   vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n\t   bool isTerrain \x3d norm4.w\x3c0.5;\n\n\t   float sum \x3d .0;\n\n\t   vec4 occluderFragment;\n\t   vec3 ray;\n\n\t   vec3 tapPixelPos;\n\n\t   // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n\t   // bug or deviation from CE somewhere else?\n\t   float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n\t   for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i)\n\t   {\n\t\t  // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n\t\t  //float ssR;\n\t\t  //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n\t\t  // get the depth of the occluder fragment\n\t\t  //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n\t\t  vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n\t\t  vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n\n\t\t  //don\'t use current or very nearby samples\n\t\t  if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n\n\t\t  vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n\t\t  if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n\t\t  vec2 tcTap \x3d tc/screenDimensions;\n\t\t  float occluderFragmentDepth \x3d getDepthLinear(tcTap);\n\n\t\t  if (isTerrain) {\n\t\t  \tbool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n\t\t  \tif (isTerrainTap)\n\t\t  \t\tcontinue;\n\t\t  }\n\n\t\t  tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\n\n\t\t  sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n\t   }\n\n\t   // output the result\n\n\t\tfloat A \x3d max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\n\n\t\t// Anti-tone map to reduce contrast and drag dark region farther\n\t\t// (x^0.2 + 1.2 * x^4)/2.2\n\t\tA \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n\n\t   //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n\t   //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n\t   //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n\t   gl_FragColor \x3d vec4(A);\n\n\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsBlurEdgeAware"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D normalMap;\n\tuniform sampler2D depthMap;\n\tuniform sampler2D tex;\n\n\n\tuniform vec2 blurSize;\n\n\n\tuniform float g_BlurFalloff;\n\tuniform float projScale;\n\n\n\tvarying vec2 uv;\n\n\tuniform vec2\t\tnearFar;\n\n\t//set z scaling, used to prevent division in ortho mode\n\tuniform vec2 zScale;\n\n\t$rgba2float\n\t$getDepthLinear\n\n\tfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\n\t{\n\t\tfloat c \x3d texture2D(tex, uv).r;\n\t\tfloat d \x3d getDepthLinear(uv);\n\n\t\tfloat ddiff \x3d d - center_d;\n\n\t\tfloat w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n\t\tw_total +\x3d w;\n\n\t\treturn w*c;\n\t}\n\n\tvoid main(void)\n\t{\n\n\t\tfloat b \x3d 0.0;\n\t\tfloat w_total \x3d 0.0;\n\n\t\tfloat center_d \x3d  getDepthLinear(uv);\n\n\t\tfloat sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\n\t\tfor (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r)\n\t\t{\n\t\t\tfloat rf \x3d float(r);\n\t\t\tvec2 uvOffset \x3d uv + rf*blurSize;\n\t\t\tb +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n\t\t}\n\n\t\tgl_FragColor \x3d vec4(b/w_total);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\t\x3csnippet name\x3d"fsBlurSrc0"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D tex;\n\tuniform float blurSize;\n\tvarying vec2 uv;\n\n\tvoid main() {\n\t\tint rad \x3d RADIUS - 1;\n\n\t\tvec4 sum \x3d vec4(0.0);\n\t\tfor (int k \x3d -RADIUS; k \x3c\x3d RADIUS; ++k) { \t\t// NOTE for-variable-init must be a const expression\n\t\t\tfloat fi \x3d float(k);\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsBlurSrc1"\x3e\x3c![CDATA[\n\t\t}\n\n\t\tgl_FragColor \x3d sum / float(RADIUS * RADIUS);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsBlurH"\x3e\x3c![CDATA[\n\t$fsBlurSrc0\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\n\t$fsBlurSrc1\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fsBlurV"\x3e\x3c![CDATA[\n\t$fsBlurSrc0\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\n\t$fsBlurSrc1\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/hud.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"commonAttributesAndUniformsHUD"\x3e\x3c![CDATA[\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec4 $auxpos1;\n\n  uniform mat4 proj;\n\n  uniform mat4 view;\n  uniform mat4 viewNormal;\n\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n\n  uniform vec4 viewport;\n\n  uniform vec3 camPos;\n\n  uniform float polygonOffset;\n  uniform float cameraGroundRelative;\n\n#ifdef VERTICAL_OFFSET\n\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  // [ divisor, offset, minPixelSize, paddingPixels ]\n  uniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\n  uniform sampler2D hudVisibilityTexture;\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"projectPositionHUD"\x3e\x3c![CDATA[\n  $screenSizePerspective\n\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\n  const float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\n\n  struct ProjectHUDAux {\n    vec3 posModel;\n    vec3 posView;\n    vec3 vnormal;\n\n    float distanceToCamera;\n    float absCosAngle;\n  };\n\n\n  /**\n   * Apply the simulated polygon offset for HUD objects that improves\n   * issues with Z-fighting.\n   *\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n   *   and the view direction.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n    float pointGroundSign \x3d sign(pointGroundDistance);\n\n    if (pointGroundSign \x3d\x3d 0.0) {\n      pointGroundSign \x3d 1.0;\n    }\n\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n    float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n    // view angle dependent part of polygon offset emulation\n    // we take the absolute value because the sign that is dropped is\n    // instead introduced using the ground-relative position of the symbol and the camera\n    if (polygonOffset \x3e .0) {\n      float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n      float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n      float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n      // same side of the terrain\n      if (groundRelative \x3e 0.0) {\n        posView *\x3d factor;\n      }\n      // opposite sides of the terrain\n      else {\n        posView /\x3d factor;\n      }\n    }\n\n    return groundRelative;\n  }\n\n  /**\n   * Project the 3d position of a HUD object from world space to clip space. In addition\n   * to standard model view projection, it also emulates a polygon offset to\n   * help with points above/below ground and icon flickering. The resulting location\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\n   * visibility of the HUD object. Note that the returned projected position is not\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - position: contains the point world position\n   *     - normal: contains the world normal pointing up at the point\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - model: the object -\x3e world transformation matrix\n   *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\n   *     - view: the world -\x3e view transformation matrix\n   *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\n   *     - proj: the view -\x3e clip projection matrix\n   *     - verticalOffset: a vec4 containing:\n   *         - the screen height of the vertical offset\n   *         - the screen height of the vertical offset as a fraction of camera distance.\n   *         - the minimum world size vertical offset.\n   *         - the maximum world size vertical offset.\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\n   *     - screenSizePerspectiveAlignment: a vec3 containing\n   *         - the view distance dependent divisor\n   *         - the view distance dependent offset\n   *         - the minimum pixel size\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - camPos: the position of the camera in world space\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\n    // centerOffset is in view space and is used to implement world size offsetting\n    // of labels with respect to objects. It also pulls the label towards the viewer\n    // so that the label is visible in front of the object.\n    vec3 centerOffset \x3d $auxpos1.xyz;\n\n    // The pointGroundDistance is the distance of the geometry to the ground and is\n    // negative if the point is below the ground, or positive if the point is above\n    // ground.\n    float pointGroundDistance \x3d $auxpos1.w;\n\n    aux.posModel \x3d (model * vec4($position, 1.0)).xyz;\n    aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n    aux.vnormal \x3d (modelNormal * vec4($normal, 1.0)).xyz;\n\n    // Screen sized offset in world space, used for example for line callouts\n    // Note: keep this implementation in sync with the CPU implementation, see\n    //   - MaterialUtil.verticalOffsetAtDistance\n    //   - HUDMaterial.applyVerticalOffsetTransformation\n\n    aux.distanceToCamera \x3d length(aux.posView);\n\n    vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n    float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n    aux.absCosAngle \x3d abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n    vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n    vec3 modelOffset \x3d aux.vnormal * worldOffset;\n\n    aux.posModel +\x3d modelOffset;\n\n    vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n    aux.posView +\x3d viewOffset;\n\n    // Since we elevate the object, we need to take that into account\n    // in the distance to ground\n    pointGroundDistance +\x3d worldOffset;\n\n#endif\n\n    float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n    aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\n\n    // Same material all have same z !\x3d 0.0 condition so should not lead to\n    // branch fragmentation and will save a normalization if it\'s not needed\n    if (centerOffset.z !\x3d 0.0) {\n      aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n    }\n#endif\n\n    vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n    float centerOffsetY \x3d centerOffset.y;\n#endif\n\n    posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n    // constant part of polygon offset emulation\n    posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n\n    return posProj;\n  }\n\n  /**\n   * Test for visibility of a HUD object.\n   *\n   * Dependencies:\n   *\n   *   Uniforms:\n   *     - hudVisibilityTexture: the texture that contains the visibility information\n   *     - markerColor: the special marker color that is used to write visibility information\n   *     - viewport: the viewport\n   */\n  bool testVisibilityHUD(vec4 posProj) {\n    // For occlusion testing, use the nearest pixel center to avoid\n    // subpixel filtering messing up the color we use to test for\n    vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n    return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/util.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"alignToPixelCenter"\x3e\x3c![CDATA[\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1), bias towards right pixel edge\n    vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel center\n    vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"alignToPixelOrigin"\x3e\x3c![CDATA[\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1),\n    vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel border, (0 : 1)\n    vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"float2rgba"\x3e\x3c![CDATA[\n  // This is the maximum float value representable as 32bit fixed point,\n  // it is rgba2float(vec4(1)) inlined.\n  const float MAX_RGBA_FLOAT \x3d\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n\t// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 fixedPointFactors \x3d vec4(1, 256, 256 * 256, 256 * 256 * 256);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat \x3d 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"rgba2float"\x3e\x3c![CDATA[\n\t// Factors to convert rgba back to float\n\tconst vec4 rgba2float_factors \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n  float rgba2float(vec4 rgba) {\n    // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n    // add the components together with their corresponding\n    // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n\t\treturn dot(rgba, rgba2float_factors);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"calcFragDepth"\x3e\x3c![CDATA[\n\t#ifdef GL_OES_standard_derivatives\n\t\t#extension GL_OES_standard_derivatives : enable\n\t#endif\n\n\tfloat calcFragDepth(const in float depth) {\n\t\t//calc polygon offset\n\t\tconst float SLOPE_SCALE \x3d 2.0;\n\t\tconst float BIAS \x3d 2.0 * .000015259;\t\t// 1 / (2^16 - 1)\n\t\tfloat m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n\t\tfloat result \x3d depth + SLOPE_SCALE * m + BIAS;\n\t\treturn clamp(result, .0, .999999);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"evalShadow"\x3e\x3c![CDATA[\n\t$rgba2float\n\n\t// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n\t// once IE11 is fine with it, const should probably be re-introduced\n\tfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n\t\t//choose correct cascade\n\t\tint i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n\t\tif (i \x3e\x3d num) return .0;\n\n\t\tmat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\n\n\t\tvec4 lv \x3d mat * vec4(vpos, 1.0);\n\t\tlv.xy /\x3d lv.w;\n\n\t\t//vertex completely outside? -\x3e no shadow\n\t\tvec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\n\t\tif (lvpos.z \x3e\x3d 1.0) return .0;\n\t\tif (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) return .0;\n\n\t\t//calc coord in cascade texture\n\t\tvec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n\t\tfloat texSize \x3d .5 / halfPxSz;\n\n\t\t//filter, offset by half pixels\n\t\tvec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\n\n\t\tfloat s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\t\tfloat s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\t\tfloat s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\t\tfloat s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n\n\t\treturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\x3c!--\n\tScene Lighting Definitions:\n\t\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\n\n\tdefines:\n\t\t- SH_ORDER: 1|2|3\n\tinput:\n\t\t- normal: vec3\n\t\t- albedo: vec3\n\t  - shadow: float\n\t\t- ssao: float\n\treturn:\n\t  - color: vec3\n--\x3e\n\x3csnippet name\x3d"sceneLightingDefinitions"\x3e\x3c![CDATA[\n\t$viewingMode\n\n\t// main light\n\t/////////////////////////////////////////\n\tuniform vec3 lightingMainDirection;\n\tuniform vec3 lightingMainIntensity;\n\n\t// ambient lighting\n\t/////////////////////////////////////////\n\t#ifndef SH_ORDER\n\t\t#define SH_ORDER 2\n\t#endif\n\n\t#if SH_ORDER \x3d\x3d 0\n\t\tuniform vec3 lightingAmbientSH0;\n\t#elif SH_ORDER \x3d\x3d 1\n\t\tuniform vec4 lightingAmbientSH_R;\n\t\tuniform vec4 lightingAmbientSH_G;\n\t\tuniform vec4 lightingAmbientSH_B;\n\t#elif SH_ORDER \x3d\x3d 2\n\t\tuniform vec3 lightingAmbientSH0;\n\t\tuniform vec4 lightingAmbientSH_R1;\n\t\tuniform vec4 lightingAmbientSH_G1;\n\t\tuniform vec4 lightingAmbientSH_B1;\n\t\tuniform vec4 lightingAmbientSH_R2;\n\t\tuniform vec4 lightingAmbientSH_G2;\n\t\tuniform vec4 lightingAmbientSH_B2;\n\t#endif\n\n\t// special tweaking\n\t//////////////////////////////////////////\n\t\tuniform float lightingFixedFactor;\n\t\tuniform float lightingGlobalFactor;\n\n\t\tuniform float ambientBoostFactor;\n\n\t// evaluation\n\t//////////////////////////////////////////\n\n\tvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n\t\t// evaluate the main light\n\t\tfloat dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\n\t\tvec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n\t\t// evaluate the sh ambient light\n\t\t#if SH_ORDER \x3d\x3d 0\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\t\t#elif SH_ORDER \x3d\x3d 1\n\t\t\tvec4 sh0 \x3d vec4(\n\t\t\t\t0.282095,\n\t\t\t\t0.488603 * normal.x,\n\t\t\t\t0.488603 * normal.z,\n\t\t\t\t0.488603 * normal.y\n\t\t\t);\n\t\t\tvec3 ambientLight \x3d vec3(\n\t\t\t\tdot(lightingAmbientSH_R, sh0),\n\t\t\t\tdot(lightingAmbientSH_G, sh0),\n\t\t\t\tdot(lightingAmbientSH_B, sh0)\n\t\t\t);\n\t\t#elif SH_ORDER \x3d\x3d 2\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n\t\t\tvec4 sh1 \x3d vec4(\n\t\t\t\t0.488603 * normal.x,\n\t\t\t\t0.488603 * normal.z,\n\t\t\t\t0.488603 * normal.y,\n\t\t\t\t1.092548 * normal.x * normal.y\n\t\t\t);\n\t\t\tvec4 sh2 \x3d vec4(\n\t\t\t\t1.092548 * normal.y * normal.z,\n\t\t\t\t0.315392 * (3.0 * normal.z * normal.z - 1.0),\n\t\t\t\t1.092548 * normal.x * normal.z,\n\t\t\t\t0.546274 * (normal.x * normal.x - normal.y * normal.y)\n\t\t\t);\n\t\t\tambientLight +\x3d vec3(\n\t\t\t\tdot(lightingAmbientSH_R1, sh1),\n\t\t\t\tdot(lightingAmbientSH_G1, sh1),\n\t\t\t\tdot(lightingAmbientSH_B1, sh1)\n\t\t\t);\n\t\t\tambientLight +\x3d vec3(\n\t\t\t\tdot(lightingAmbientSH_R2, sh2),\n\t\t\t\tdot(lightingAmbientSH_G2, sh2),\n\t\t\t\tdot(lightingAmbientSH_B2, sh2)\n\t\t\t);\n\t\t#endif\n\t\tambientLight *\x3d (1.0 - ssao);\n\n\t\t// inverse gamma correction on the albedo color\n\t\tfloat gamma \x3d 2.1;\n\t\tvec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\n\n\t\t// physically correct BRDF normalizes by PI\n\t\tconst float PI \x3d 3.14159;\n\t\tvec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n\t\ttotalLight \x3d min(totalLight, vec3(PI, PI, PI));\n\t\tvec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n\t\t// apply gamma correction to the computed color\n\t\toutColor \x3d pow(outColor, vec3(1.0/gamma));\n\n\t\treturn outColor;\n\t}\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"sceneLightingAdditionalLightGlobal"\x3e\x3c![CDATA[\n  vec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n    // heuristic lighting model originally used in the terrain shading\n    // now used to generated additional ambient light\n\n#ifdef VIEWING_MODE_GLOBAL\n\n      float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\n\n#else\n\n      float vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\n\n#endif\n\n    additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"normal2envTC"\x3e\x3c![CDATA[\n\tvec2 normal2envTC(vec3 normal) {\n\t\tfloat v \x3d .5 + .5 * asin(normal.y) * 0.63661977;\n\t\tfloat u \x3d .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\n\t\treturn vec2(u, v);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vertexShaderShowDepth"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tattribute vec2 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d proj * vec4($position.x, $position.y, .0, 1.0);\n\t\tvtc \x3d $uv0;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\t\x3csnippet name\x3d"fragmentShaderShowDepth"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform sampler2D depthTex;\n\tvarying vec2 vtc;\n\t$rgba2float\n\tvoid main() {\n\t//\tgl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\n\t\tgl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\n\t//\tgl_FragColor \x3d texture2D(depthTex, vtc);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsUVQuad"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec2 $position;\n\tvarying vec2 uv;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d vec4($position.x, $position.y, .0, 1.0);\n\t\tuv \x3d $position * .5 + vec2(.5);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"toScreenCoords"\x3e\x3c![CDATA[\n\tvec4 toScreenCoords(vec3 vertex) {\n\t\tvec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n\t\tvClipSpace.xy *\x3d screenSize;\n\t\treturn vClipSpace/abs(vClipSpace.w);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vvUniforms"\x3e\x3c![CDATA[\n#if defined(VV_SIZE)\n\t#define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n\tuniform vec3 vvSizeMinSize;\n\tuniform vec3 vvSizeMaxSize;\n\tuniform vec3 vvSizeOffset;\n\tuniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n\tuniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\tuniform mat3 vvSymbolRotation;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\tuniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n\t#define VV_COLOR_N 8\n\tuniform float vvColorValues[VV_COLOR_N];\n\tuniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vvFunctions"\x3e\x3c![CDATA[\n// Evaluation of size\n#if defined(VV_SIZE)\n\tvec3 vvGetScale(vec4 featureAttribute) {\n\t\treturn clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n\t}\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n\tvec3 vvGetScale(vec4 featureAttribute) {\n\t\treturn vvSizeValue;\n\t}\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\tvec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n\t\treturn vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n\t}\n\n\tvec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n\t\t// Normal transform is the inverse transpose of model transform\n\t\treturn vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\n\t}\n#endif\n\n#ifdef VV_COLOR\n\tvec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n\t\tfloat value \x3d featureAttribute.y;\n\t\tif (value \x3c\x3d values[0]) {\n\t\t\treturn colors[0];\n\t\t}\n\n\t\tfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n\t\t\tif (values[i] \x3e\x3d value) {\n\t\t\t\tfloat f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n\t\t\t\treturn mix(colors[i-1], colors[i], f);\n\t\t\t}\n\t\t}\n\n\t\treturn colors[VV_COLOR_N - 1];\n\t}\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"rgb2hsv"\x3e\x3c![CDATA[\nvec3 rgb2hsv(vec3 c)\n{\n\tvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\tfloat d \x3d q.x - min(q.w, q.y);\n\tfloat e \x3d 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"hsv2rgb"\x3e\x3c![CDATA[\nvec3 hsv2rgb(vec3 c)\n{\n\tvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"colorMixMode"\x3e\x3c![CDATA[\n$rgb2hsv\n$hsv2rgb\n\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha \x3d 0.0;\n\n  const float maxTint \x3d 85.0;\n  const float maxReplace \x3d 170.0;\n  const float scaleAlpha \x3d 3.0;\n\n  if (symbolColor.a \x3d\x3d 0.0) {\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\n    symbolAlpha \x3d 0.0;\n  }\n  else if (symbolColor.a \x3c\x3d maxTint) {\n    colorMixMode \x3d 0; // tint\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a \x3c\x3d maxReplace) {\n    colorMixMode \x3d 3; // replace\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode \x3d 1;  // multiply\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed \x3d internalColor * textureColor;\n  vec3 allMixed \x3d internalMixed * externalColor;\n\n  if (mode \x3d\x3d 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed \x3d internalOpacity * textureOpacity;\n  float allMixed \x3d internalMixed * externalOpacity;\n\n  if (mode \x3d\x3d 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"highlightWrite"\x3e\x3c![CDATA[\n  // the following uniforms are common to all highlight shaders:\n  // uniform sampler2D depthTex\n  // uniform vec4 highlightViewportPixelSz\n  float sceneDepth \x3d texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n  if (gl_FragCoord.z \x3e sceneDepth + 5e-6) {\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"screenSizePerspective"\x3e\x3c![CDATA[\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding \x3d 2 * factor.w\n  //   minSize \x3d factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -\x3e 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"computeNormal"\x3e\x3c![CDATA[\n  #ifdef GROUND_NORMAL_SHADING\n    #ifdef VIEWING_MODE_GLOBAL\n      vec3 normal \x3d normalize(vpos + localOrigin);\n    #else\n      vec3 normal \x3d vec3(0,0,1);\n    #endif\n  #else\n    // compute normal\n    #ifdef DOUBLESIDED\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal \x3d vnormal;\n    #endif\n    normal \x3d normalize(normal);\n  #endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"decodeNormal"\x3e\x3c![CDATA[\nvec3 decodeNormal(vec2 f)\n{\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/CheckerBoardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsCheckerBoard"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  varying vec2 vUV;\n\n  void main(void) {\n    vUV \x3d $uv0;\n    gl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsCheckerBoard"\x3e\x3c![CDATA[\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n  $fsprecisionf\n\n  uniform vec2 size;\n  uniform vec4 color1;\n  uniform vec4 color2;\n\n  varying vec2 vUV;\n\n  void main() {\n    vec2 uvScaled \x3d vUV / (2.0 * size);\n\n#ifdef GL_OES_standard_derivatives\n    vec2 uv \x3d fract(uvScaled - 0.25);\n    vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n    float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n    float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\n#else\n    vec2 ab \x3d step(0.5, fract(uvScaled));\n    float t \x3d abs(1.0 - ab.x - ab.y);\n#endif\n\n    gl_FragColor \x3d mix(color2, color1, t);\n  }\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/ColorMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderColorMaterial"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\n\tattribute vec3 $position;\n#ifdef VERTEXCOLORS\n\tattribute vec4 $color;\n\n\tvarying vec4 vColor;\n#endif\n\n\tvoid main(void) {\n#ifdef VERTEXCOLORS\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255;\n#endif\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderColorMaterial"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec4 eColor;\n#ifdef VERTEXCOLORS\n\tvarying vec4 vColor;\n#endif\n\n\tvoid main() {\n#ifdef VERTEXCOLORS\n\t\tgl_FragColor \x3d vColor * eColor;\n#else\n\t\tgl_FragColor \x3d eColor;\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/DefaultMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"calculateVerticalOffset"\x3e\x3c![CDATA[\n  $viewingMode\n\n#ifdef VERTICAL_OFFSET\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspectiveAlignment;\n\n  $screenSizePerspective\n\n#endif\n\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n    float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\n    float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\n\n#ifdef VIEWING_MODE_GLOBAL\n    vec3 worldNormal \x3d normalize(worldPos + localOrigin);\n#else\n    vec3 worldNormal \x3d vec3(0, 0, 1);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n\n    float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n\n    // Screen sized offset in world space, used for example for line callouts\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n    return worldNormal * worldOffset;\n  }\n#endif\n]]\x3e\n\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhongSrc"\x3e\x3c![CDATA[\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec3 camPos;\n\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n    attribute mat4 model;\n    attribute mat4 modelNormal;\n#else\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n#endif\n#ifdef INSTANCEDCOLOR\n  attribute vec4 instanceColor;\n#endif\n  attribute vec3 $position;\n#ifdef COMPRESSED_NORMALS\n  attribute vec2 $normalCompressed;\n#else\n  attribute vec3 $normal;\n#endif\n  varying vec3 vpos;\n  varying vec3 vnormal;\n\n#ifdef COMPONENTCOLORS\n  uniform sampler2D uComponentColorTex;\n  uniform vec2 uComponentColorTexInvDim;\n\n  attribute float $componentIndex;\n\n  vec4 readComponentColor() {\n    float normalizedIndex \x3d ($componentIndex + 0.5) * uComponentColorTexInvDim.x;\n    vec2 indexCoord \x3d vec2(\n      mod(normalizedIndex, 1.0),\n      (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n    );\n    return texture2D(uComponentColorTex, indexCoord);\n  }\n#endif\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\n  attribute vec4 $color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\n  attribute vec4 $symbolColor;\n#endif\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n\n$vvUniforms\n\n#if defined(VERTEXCOLORS)\n  varying vec4 vcolor;\n#endif\n\n  // Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n  // We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n  // there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n  // since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n  // This should be further cleaned up later with through the following issue:\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\n  uniform vec4 externalColor;\n  varying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n  $vvFunctions\n\n  $colorMixMode\n\n  $calculateVerticalOffset\n\n  $decodeNormal\n\n  void main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\n#ifdef COMPRESSED_NORMALS\n    vnormal \x3d normalize((modelNormal * vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute)).xyz);\n#else\n    vnormal \x3d normalize((modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\n#endif\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\n    vpos \x3d (model * vec4($position, 1.0)).xyz;\n#ifdef COMPRESSED_NORMALS\n    vnormal \x3d normalize((modelNormal * vec4(decodeNormal($normalCompressed), 1.0)).xyz);\n#else\n    vnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\n#endif\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\n    // passed as varying to properly drive the cascading shadow map index.\n    linearDepth \x3d gl_Position.w;\n#endif\n\n#ifdef VERTEXCOLORS\n    vcolor \x3d $color * 0.003921568627451; // \x3d 1/255\n#endif\n\n    vcolorExt \x3d externalColor;\n\n#ifdef INSTANCEDCOLOR\n    vcolorExt *\x3d instanceColor;\n#endif\n#ifdef VV_COLOR\n    vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n    int symbolColorMixMode;\n    vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n#ifdef COMPONENTCOLORS\n    int symbolColorMixMode;\n    vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhongSrc"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n  $sceneLightingDefinitions\n  $sceneLightingAdditionalLightGlobal\n\n  // material parameters\n  //////////////////////////////////////////\n  uniform vec3 ambient;\n  uniform vec3 diffuse;\n  uniform vec3 specular;\n  uniform float opacity;\n  uniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\n  uniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\n  uniform sampler2D depthTex;\n  uniform int shadowMapNum;\n  uniform vec4 shadowMapDistance;\n  uniform mat4 shadowMapMatrix[4];\n  uniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\n  uniform sampler2D ssaoTex;\n  uniform vec4 viewportPixelSz;\n#endif\n\n\n  varying vec3 vpos;\n  varying vec3 vnormal;\n#if defined(VERTEXCOLORS)\n  varying vec4 vcolor;\n#endif\n  varying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n  $evalShadow\n#endif\n\n  $colorMixMode\n\n  void main() {\n    vec3 viewDir \x3d normalize(vpos - camPos);\n\n    $computeNormal\n\n    vec3 reflDir \x3d normalize(reflect(viewDir, normal));\n\n    // compute ssao\n    #ifdef RECEIVE_SSAO\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n    #else\n        float ssao \x3d 1.0;\n    #endif\n\n    // At global scale we create some additional ambient light based on the main light to simulate global illumination\n    float additionalAmbientScale;\n    vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n    // compute shadowing\n    float shadow \x3d 0.0;\n    #ifdef RECEIVE_SHADOWS\n      shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n    #elif defined(VIEWING_MODE_GLOBAL)\n      // at global scale (and in global scenes) we fall back to this approximation\n      // to shadow objects on the dark side of the earth\n      shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n    #endif\n\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c!-- Keep is synchronized with the logic in Material.js:isVisible --\x3e\n\x3csnippet name\x3d"externalColorMix"\x3e\x3c![CDATA[\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\n  #if defined(VERTEXCOLORS)\n      // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n      vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n      float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  #else\n      // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n      vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n      float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  #endif\n  albedo_+\x3d 0.25 * specular; // don\'t completely ignore specular for now\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhong"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $vsPhongSrc\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhong"\x3e\x3c![CDATA[\n    $fsprecisionf\n\n    $fsPhongSrc\n\n    vec4 texColor \x3d vec4(1,1,1,1);\n    $externalColorMix\n\n    if (opacity_ \x3c 0.001) {\n      discard;\n    }\n\n    vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n    gl_FragColor \x3d vec4(shadedColor, opacity_);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhongTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsPhongSrc\n#ifndef FLIPV\n    vtc \x3d $uv0;\n#else\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhongTextured"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  varying vec2 vtc;\n\n  $fsPhongSrc\n\n    // read texture color\n    vec4 texColor \x3d texture2D(tex, vtc);\n    if (texColor.a \x3c .33) discard;\n\n    $externalColorMix\n\n    if (opacity_ \x3c 0.001) {\n      discard;\n    }\n\n    vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n    gl_FragColor \x3d vec4(shadedColor, opacity_);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsPhongAtlasTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec4 $uv0;\n  attribute vec4 $region;\n  varying vec2 vtc;\n  varying vec4 regionV;\n  $vsPhongSrc\n#ifndef FLIPV\n    vtc \x3d $uv0.xy;\n#else\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n    regionV \x3d $region/65535.0;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsPhongAtlasTextured"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n  varying vec4 regionV;\n\n  float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n    // from:\n    //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n    //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n    //   - http://www.linedef.com/virtual-texture-demo.html\n    float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n    return max(0.5 * log2(deltaMaxSqr), 0.0);\n  }\n\n  $fsPhongSrc\n\n    vec2 uv \x3d vtc;\n    uv \x3d fract(uv);\n    //[umin, vmin, umax, vmax]\n\n    vec2 atlasScale \x3d regionV.zw - regionV.xy;\n    uv \x3d uv.xy * atlasScale + regionV.xy;\n\n    vec4 texColor;\n    #ifdef GL_OES_standard_derivatives\n      #extension GL_OES_standard_derivatives : enable\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(vtc) * atlasScale;\n      vec2 dUVdy \x3d dFdy(vtc) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        #extension GL_EXT_shader_texture_lod : enable\n\n        // workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\n        // see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\n        const float epsilon \x3d 1.0E-32;\n        float zeroUVShift \x3d uv.x \x3d\x3d 0.0 \x26\x26 uv.y \x3d\x3d 0.0 ? epsilon : 0.0;\n\n        texColor \x3d texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uv);\n        vec2 dUVdyAuto \x3d dFdy(uv);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n        texColor \x3d texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\n      #endif\n    #else\n      texColor \x3d texture2D(tex, uv);\n    #endif\n\n    if (texColor.a \x3c .33) discard;\n\n    $externalColorMix\n\n    if (opacity_ \x3c 0.001) {\n      discard;\n    }\n\n    vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n    gl_FragColor \x3d vec4(shadedColor, opacity_);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsDepthSrc"\x3e\x3c![CDATA[\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n  attribute mat4 model;\n  attribute mat4 modelNormal;\n#else\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n#endif\n  uniform vec2 nearFar;\n  attribute vec3 $position;\n  varying float depth;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  void main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n    vec4 eye \x3d view * vec4(vpos, 1);\n\n    gl_Position \x3d proj * eye;\n    depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsDepth"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $vsDepthSrc\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsDepthTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsDepthSrc\n#ifndef FLIPV\n        vtc \x3d $uv0;\n#else\n        vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsNormalSrc"\x3e\x3c![CDATA[\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n  attribute mat4 model;\n  attribute mat4 modelNormal;\n#else\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n#endif\n  uniform mat4 viewNormal;\n  attribute vec3 $position;\n#ifdef COMPRESSED_NORMALS\n  attribute vec2 $normalCompressed;\n#else\n  attribute vec3 $normal;\n#endif\n  varying vec3 vnormal;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $decodeNormal\n\n  void main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n#ifdef COMPRESSED_NORMALS\n    vnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute)).xyz);\n#else\n    vnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\n#endif\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\n#ifdef COMPRESSED_NORMALS\n    vnormal \x3d normalize((viewNormal * modelNormal * vec4(decodeNormal($normalCompressed), 1.0)).xyz);\n#else\n    vnormal \x3d normalize((viewNormal * modelNormal * vec4($normal, 1.0)).xyz);\n#endif\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n    gl_Position \x3d proj * view * vec4(vpos, 1);\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsNormal"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $vsNormalSrc\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsNormalTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsNormalSrc\n#ifndef FLIPV\n    vtc \x3d $uv0;\n#else\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsHighlightSrc"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n#ifdef INSTANCED\n  attribute mat4 model;\n  attribute mat4 modelNormal;\n#else\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n#endif\n  attribute vec3 $position;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  void main(void) {\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\n#endif\n\n#else /* VV_CUSTOM_MODEL_MATRIX */\n\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\n#endif\n\n#endif /* VV_CUSTOM_MODEL_MATRIX */\n\n#ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\n#endif\n\n    gl_Position \x3d proj * view * vec4(vpos, 1);\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsHighlight"\x3e\x3c![CDATA[\n  $vsHighlightSrc\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsHighlightTextured"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsHighlightSrc\n#ifndef FLIPV\n    vtc \x3d $uv0;\n#else\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsDepthSrc"\x3e\x3c![CDATA[\n  $fsprecisionf\n  varying float depth;\n\n  void main() {\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsDepth"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  $calcFragDepth\n  $float2rgba\n  $fsDepthSrc\n#ifndef BIAS_SHADOWMAP\n    gl_FragColor \x3d float2rgba(depth);\n#else\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsDepthTextured"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  varying vec2 vtc;\n  $calcFragDepth\n  $float2rgba\n\n  $fsDepthSrc\n    if (texture2D(tex, vtc).a \x3c .33) discard;\n#ifndef BIAS_SHADOWMAP\n    gl_FragColor \x3d float2rgba(depth);\n#else\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsNormal"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  varying vec3 vnormal;\n  void main() {\n    vec3 normal \x3d normalize(vnormal);\n    if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n\n#ifndef ALPHA_ZERO\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsNormalTextured"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  varying vec3 vnormal;\n  varying vec2 vtc;\n  uniform sampler2D tex;\n  void main() {\n    if (texture2D(tex, vtc).a \x3c .33) discard;\n    vec3 normal \x3d normalize(vnormal);\n    if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#ifndef ALPHA_ZERO\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlight"\x3e\x3c![CDATA[\n  $fsprecisionf\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  void main() {\n    $highlightWrite\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsHighlightTextured"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  varying vec2 vtc;\n  uniform sampler2D tex;\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  void main() {\n    if (texture2D(tex, vtc).a \x3c .33) discard;\n\n    $highlightWrite\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderLineCallout"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  attribute vec2 $uv0;\n\n  uniform float lineSize;\n  uniform vec2 pixelToNDC;\n  uniform float borderSize;\n  uniform vec2 screenOffset;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  $alignToPixelOrigin\n  $alignToPixelCenter\n\n  $projectPositionHUD\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n#ifdef OCCL_TEST\n    if (!testVisibilityHUD(endPoint)) {\n      gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\n    }\n    else {\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n      vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * model * vec4($position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\n\n      vec4 startPoint \x3d proj * vec4(posView, 1);\n\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n      endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n      startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, $uv0.y);\n\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n\n#endif\n\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + $uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d ($uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n\n#ifdef OCCL_TEST\n    }\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet\x3e\x3c![CDATA[\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderLineCallout"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform vec4 color;\n  uniform vec4 borderColor;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  void main() {\n    // Mix between line and border coverage offsets depending on whether we need\n    // a border (based on the sidedness).\n    vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n    // Mix between border and line color based on the line coverage (conceptually the line\n    // blends on top of the border background).\n    //\n    // Anti-alias by blending final result using the full (including optional border) coverage\n    // and the color alpha\n    float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n    float colorAlpha \x3d color.a * coverage.x;\n\n    float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n    if (finalAlpha \x3c 0.01) {\n      discard;\n    }\n\n#else\n\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n    // need to divide by finalAlpha). We avoid the division here by setting the\n    // appropriate blending function in the material.\n    vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n    gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n\n#endif\n\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsMeasurementArrow"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  uniform float width;\n\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec2 $uv0;\n  attribute float $auxpos1;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  void main(void) {\n    vec3 bitangent \x3d $normal;\n\n    vtc \x3d $uv0;\n    vlength \x3d $auxpos1;\n    vradius \x3d 0.5 * width;\n\n    vec4 pos \x3d view * vec4((model * vec4($position + vradius * bitangent * $uv0.y, 1.0)).xyz, 1.0);\n    gl_Position \x3d proj * pos;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsMeasurementArrow"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform float outlineSize;\n  uniform vec4 outlineColor;\n  uniform float stripeLength;\n  uniform vec4 stripeEvenColor;\n  uniform vec4 stripeOddColor;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  #define INV_SQRT2 (1.0 / sqrt(2.0))\n\n  vec4 arrowColor(vec2 tc, float len) {\n    float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\n    d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n    d \x3d min(d, 1.0 - abs(tc.y));\n\n    if (d \x3c 0.0) {\n      return vec4(0.0);\n    } else if (d \x3c outlineSize) {\n      return outlineColor;\n    } else {\n      return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\n    }\n  }\n\n  void main(void) {\n    vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\n    vec4 color \x3d arrowColor(ntc, vlength / vradius);\n    if (color.a \x3d\x3d 0.0) {\n      discard;\n    }\n    gl_FragColor \x3d color;\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsRibbonLine"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\n\tuniform float extLineWidth;\n\tuniform float nearPlane;\n\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\tvarying vec2 vtc;\n\n\tattribute vec4 $color;\n\tvarying vec4 vColor;\n\n\tattribute float size;\n\n#ifndef WALL\n\tuniform float miterLimit;\n\tattribute vec3 $auxpos1;\n\tattribute vec3 $auxpos2;\n#endif\n\n#ifdef SCREENSCALE\n\tuniform vec2 screenSize;\n\t$toScreenCoords\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y \x3e 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y \x3c 0.0\n\n#endif //ifdef SCREENSCALE\n\n\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t}\n\n#ifdef SCREENSCALE\n\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n\t\tfloat vnp \x3d nearPlane*0.99;\n\n\t\t//We have four vertices per point on the line. Start and end vertices\n\t\t//are treated differently --\x3e d \x3e 0, d \x3c 0\n\t\tfloat d \x3d abs($uv0.y) - 1.1;\n\n\t\t//current pos behind ncp --\x3e we need to clip\n\t\tif(pos.z \x3e -nearPlane) {\n\t\t\tif (d \x3c 0.0) {\n\t\t\t\t//previous in front of ncp\n\t\t\t\tif(prev.z \x3c -nearPlane) {\n\t\t\t\t\tpos \x3d mix(prev, pos, interp(vnp, prev, pos));\n\t\t\t\t\tnext \x3d pos;\n\t\t\t\t} else {\n\t\t\t\t  pos \x3d vec4(0, 0, 0, 1);\n\t\t\t  }\n\t\t\t}\n\t\t\t//next in front of ncp\n\t\t\tif(d \x3e 0.0) {\n\t\t\t\tif(next.z \x3c -nearPlane) {\n\t\t\t\t\tpos \x3d mix(pos, next, interp(vnp, pos, next));\n\t\t\t\t\tprev \x3d pos;\n\t\t\t\t} else {\n\t\t\t\t\tpos \x3d vec4(0, 0, 0, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\telse {\n\t\t\t//current position visible\n\t\t\t//previous behind ncp\n\t\t\tif (prev.z \x3e -nearPlane) {\n\t\t\t\tprev \x3d mix(pos, prev, interp(vnp, pos, prev));\n\t\t\t}\n\t\t\t//next behind ncp\n\t\t\tif (next.z \x3e -nearPlane) {\n\t\t\t\tnext \x3d mix(next, pos, interp(vnp, next, pos));\n\t\t\t}\n\t\t}\n\n\t\tpos\x3d proj * pos;\n\t\tpos.xy *\x3d screenSize;\n\t\tpos /\x3d pos.w;\n\n\t\tnext \x3d proj * next;\n\t\tnext.xy *\x3d screenSize;\n\t\tnext /\x3d next.w;\n\n\t\tprev \x3d proj * prev;\n\t\tprev.xy *\x3d screenSize;\n\t\tprev /\x3d prev.w;\n  }\n\n#endif // SCREENSCALE\n\n\tvoid main(void) {\n\n#ifdef SCREENSCALE\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\n  // of clip space.\n  if (dot($position, $position) \x3d\x3d 0.0) {\n    // Project out of clip space\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  else {\n#endif\n\n\tfloat lineWidth \x3d extLineWidth + $size;\n\n#ifdef SCREENSCALE\n\n#if 0\n\t\tvec4 pos \x3d toScreenCoords($position.xyz);\n\t\tvec2 left \x3d (pos - toScreenCoords($auxpos1)).xy;\n\t\tvec2 right \x3d (toScreenCoords($auxpos2) - pos).xy;\n#else\n\t\tvec4 pos  \x3d view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\n\t\tvec4 prev \x3d view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\n\t\tvec4 next \x3d view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\n\n\t\tclipAndTransform(pos, prev, next);\n\n\t\tvec2 left \x3d (pos - prev).xy;\n\t\tvec2 right \x3d (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n\t\tvec4 pos \x3d vec4($position, 1.0);\n#ifndef WALL\n\t\tvec3 left \x3d $position.xyz - $auxpos1;\n\t\tvec3 right \x3d $auxpos2 - $position.xyz;\n\t\tvec3 up \x3d normalize($position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n\t\tfloat displacementLen \x3d lineWidth;\n\t\tvec3 displacementDir \x3d normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n\t\tfloat leftLen \x3d length(left);\n\t\tleft \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\n\n\t\tfloat rightLen \x3d length(right);\n\t\tright \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\n\n\t\t// determine if vertex is on the "outside or "inside" of the join\n\t\tbool isOutside \x3d ISOUTSIDE;\n\n\t\t// compute miter join position first\n\t\tfloat displacementLen \x3d lineWidth;\n\t\tVECTYPE displacementDir \x3d normalize(left + right);\n\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\n\t\tif (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n\t\t\tfloat nDotSeg \x3d dot(displacementDir, left);\n\t\t\tdisplacementLen /\x3d length(nDotSeg*left - displacementDir);\n\n\t\t\t// limit displacement of inner vertices\n\t\t\tif (!isOutside)\n\t\t\t\tdisplacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n\t\t}\n\n\t\tif (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\n\t\t\t// convert to bevel join if miterLimit is exceeded\n\t\t\tif (leftLen \x3c 0.001)\n\t\t\t    displacementDir \x3d right;\n\t\t\telse if (rightLen \x3c 0.001)\n\t\t\t\tdisplacementDir \x3d left;\n\t\t\telse\n\t\t\t\tdisplacementDir \x3d (abs($uv0.y) - 1.1 \x3c 0.0) ? left : right;\n\t\t\tdisplacementDir \x3d normalize(displacementDir);\n\t\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\n\t\t\tdisplacementLen \x3d lineWidth;\n\t\t}\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n\t\tpos.xy +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\n\t\tpos.xy /\x3d screenSize;\n#else\n\t\tpos.xyz +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\n\t\tpos \x3d proj * view * model * pos;\n#endif\n\n\t\tvtc \x3d $uv0;\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255\n\t\tgl_Position \x3d pos;\n\n#ifdef SCREENSCALE\n    }\n#endif\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\n\x3csnippet name\x3d"fsRibbonLine"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n\tuniform vec4 eColor;\n\tvarying vec4 vColor;\n\tvarying vec2 vtc;\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n\tvoid main() {\n\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n      discard;\n    }\n#endif\n\n    gl_FragColor \x3d eColor * vColor;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsRibbonLineHighlight"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n\tvoid main() {\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n      discard;\n    }\n#endif\n\n\t\tgl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderBlendLayers"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tattribute vec3 $position;\n\tattribute vec2 $uv0;\n\n\tuniform float scale;\n\tuniform vec2 offset;\n\n\tvarying vec2 uv;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d vec4($position, 1.0);\n\t\tuv \x3d $uv0 * scale + offset;;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderBlendLayers"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n\tvarying vec2 uv;\n\n\tuniform sampler2D tex;\n\tuniform float opacity;\n\n\tvoid main() {\n\t\tvec4 color \x3d texture2D(tex, uv);\n\n    // Note: output in pre-multiplied alpha for correct alpha compositing\n\t\tgl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"url:esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vertexShaderSimple"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n\tuniform mat4 proj;\n\tuniform mat4 view;\n\tuniform mat4 model;\n\tattribute vec3 $position;\n\n\tvoid main(void) {\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n\t}\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fragmentShaderSimple"\x3e\x3c![CDATA[\n\t$fsprecisionf\n\n\tuniform vec4 color;\n\n\tvoid main() {\n\t\tgl_FragColor \x3d color;\n\t}\n]]\x3e\x3c/snippet\x3e\n\x3c/snippets\x3e\n',
"url:esri/views/3d/terrain/TerrainMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"getOverlayColor"\x3e\x3c![CDATA[\n  vec4 getOverlayColor(vec4 texCoords, float opacity) {\n    vec4 color \x3d vec4(0, 0, 0, 0);\n\n    if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\n      // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\n      color \x3d texture2D(overlay0Tex, texCoords.xy);\n    } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\n      // sample from outer overlay\n      color \x3d texture2D(overlay1Tex, texCoords.zw);\n    }\n\n    return color * opacity;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"applySkirts"\x3e\x3c![CDATA[\n  uniform float skirtScale;\n\n  vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal) {\n    float skirtLength \x3d 0.0;\n\n    if (uv.x \x3e\x3d 2.0) {\n      skirtLength \x3d uv.y * skirtScale;\n      // decode original uv-coordinates (see `encodeSkirtPos`)\n      vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n      uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n    }\n\n    return vpos - vnormal * skirtLength;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrain"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec3 origin;\n  uniform vec4 texOffsetAndScale;\n  uniform mat4 viewNormal;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  varying vec3 vpos;\n  varying vec3 vnormal;\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n#endif\n\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\n  varying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\n  uniform vec3 lightDirection;\n  varying vec3 wpos;\n  varying vec3 wview;\n  varying vec3 wnormal;\n  varying vec3 wlight;\n#endif\n\n#ifdef OVERLAY\n  // these variables combine two possible overlays into one by using a vec4:\n  // components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\n  uniform vec4 overlayTexOffset;\n  uniform vec4 overlayTexScale;\n  varying vec4 vtcOverlay;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n  uniform vec4 screenSizePerspective;\n\n  varying float screenSizeDistanceToCamera;\n  varying float screenSizeCosAngle;\n\n#endif\n\n$applySkirts\n\n  void main(void) {\n    vpos \x3d $position;\n\n#ifdef SPHERICAL\n    vnormal \x3d normalize(vpos + origin);\n#else\n    vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\n#endif\n\n  vec2 uv \x3d $uv0;\n  vpos \x3d applySkirts(uv, vpos, vnormal);\n\n#ifdef ATMOSPHERE\n    wpos \x3d (view * vec4(vpos, 1.0)).xyz;\n    wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n    wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\n#endif\n\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\n    vuv \x3d uv;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n    vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n\n    screenSizeDistanceToCamera \x3d length(viewPos);\n\n    vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n    screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\n\n#endif\n\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\n    // passed as varying to properly drive the cascading shadow map index.\n    linearDepth \x3d gl_Position.w;\n#endif\n\n    vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n\n#ifdef OVERLAY\n    vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainCommon"\x3e\x3c![CDATA[\n  uniform vec3 lightDirection;\n  uniform vec3 viewDirection;\n  uniform sampler2D depthTex;\n  uniform int shadowMapNum;\n  uniform vec4 shadowMapDistance;\n  uniform mat4 shadowMapMatrix[4];\n  uniform float depthHalfPixelSz;\n  uniform sampler2D ssaoTex;\n  uniform vec4 viewportPixelSz;\n  uniform sampler2D tex;\n  uniform float opacity;\n\n  varying vec3 vpos;\n  varying vec3 vnormal;\n  varying vec2 vtc;\n\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\n  varying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\n  varying vec3 wpos;\n  varying vec3 wview;\n  varying vec3 wnormal;\n  varying vec3 wlight;\n#endif\n\n  $sceneLightingDefinitions\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n  $screenSizePerspective\n\n  uniform vec4 screenSizePerspective;\n\n  varying float screenSizeDistanceToCamera;\n  varying float screenSizeCosAngle;\n#endif\n\n  const vec3 ambient \x3d vec3(0.2,0.2,0.2);\n  const vec3 diffuse \x3d vec3(0.8,0.8,0.8);\n  const float diffuseHardness \x3d 2.5;\n\n#ifdef OVERLAY\n  uniform sampler2D overlay0Tex;\n  uniform sampler2D overlay1Tex;\n  uniform float overlayOpacity;\n  varying vec4 vtcOverlay;\n\n  $getOverlayColor\n#endif\n\n#ifdef RECEIVE_SHADOWS\n\tvarying float linearDepth;\n\t$evalShadow\n#endif\n\n  float lum(vec3 c) {\n    float max \x3d max(max(c.r, c.g), c.b);\n    float min \x3d min(min(c.r, c.g), c.b);\n    return (min + max) * 0.5;\n  }\n\n#ifdef ATMOSPHERE\n  vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n    vec3 surfaceColor   \x3d vec3(0.0);\n    vec3 fuzzySpecColor \x3d vec3(1.0);\n    vec3 subColor       \x3d vec3(0.0);\n    float rollOff       \x3d 1.0;\n\n    vec3 Ln \x3d normalize(lightPos);\n    vec3 Nn \x3d normalize(normal);\n    vec3 Hn \x3d normalize(view + Ln);\n\n    float ldn \x3d dot(Ln, Nn);\n    float diffComp \x3d max(0.0, ldn);\n    float vdn \x3d 1.0 - dot(view, Nn);\n    float ndv \x3d dot(view, Ln);\n\n    vec3 diffContrib \x3d surfaceColor * diffComp;\n    float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n    vec3 subContrib \x3d subLamb * subColor;\n    vec3 vecColor \x3d vec3(vdn);\n\n    vec3 diffuseContrib \x3d (subContrib + diffContrib);\n    vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n    return (diffContrib + specularContrib) * rollOff;\n  }\n#endif\n\n  void main() {\n    vec3 a \x3d ambient;\n\n    float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n    shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n    float vndl \x3d dot(normalize(vnormal), lightDirection);\n    float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n    vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n    float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n    vec4 texCol \x3d texture2D(tex, vtc);\n\n#ifdef OVERLAY\n    vec4 overlayColor \x3d getOverlayColor(vtcOverlay, overlayOpacity);\n\n    // texCol and overlayTexCols have pre-multiplied alpha\n    texCol \x3d texCol * (1.0 - overlayColor.a) + overlayColor;\n#endif\n\n    vec3 atm \x3d vec3(0.0);\n#ifdef ATMOSPHERE\n    float ndotl \x3d max(0.0, min(1.0, vndl));\n    atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n    atm *\x3d max(0.0, min(1.0, (1.0-lum(texCol.rgb)*1.5))); //avoid atmosphere on bright base maps\n    atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n#endif\n\n    vec3 albedo \x3d atm + texCol.rgb;\n    vec3 normal \x3d normalize(vnormal);\n\n    // heuristic shading function used in the old terrain, now used to add ambient lighting\n    float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n\t\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n    gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), texCol.a) * opacity;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n    // This is only used for debug rendering the screenSize perspective\n\n    float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n\n    if (perspectiveScale \x3c\x3d 0.25) {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\n    }\n    else if (perspectiveScale \x3c\x3d 0.5) {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\n    }\n    else if (perspectiveScale \x3e\x3d 0.99) {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\n    }\n    else {\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\n    }\n\n#endif\n\n  // closing } is missing here, it\'s in the shaders using this snippet below\n\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainWireframe"\x3e\x3c![CDATA[\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n  $fsprecisionf\n\n  struct WireframeSettings {\n    float width;\n    float falloff;\n    float subdivision;\n    vec4 color;\n    float wireOpacity;\n    float surfaceOpacity;\n  };\n\n  uniform WireframeSettings wireframe;\n\n    $fsTerrainCommon\n\n    vec2 vuvScaled \x3d vuv * wireframe.subdivision;\n    vec2 vuvMod \x3d fract(vuvScaled);\n\n#ifdef GL_OES_standard_derivatives\n    vec2 dVuv \x3d fwidth(vuvScaled);\n    dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\n#else\n    // Something that reasonably works\n    vec2 dVuv \x3d vec2(0.05);\n#endif\n\n    vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                                  wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\n\n    float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n#ifdef WIREFRAME\n    gl_FragColor \x3d vec4(mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a),\n                        mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor));\n#endif\n\n\n#ifdef TILE_BORDERS\n    dVuv \x3d fwidth(vuv);\n    edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                              wireframe.width * dVuv, min(vuv, 1.0 - vuv));\n    edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrain"\x3e\x3c![CDATA[\n    $fsprecisionf\n    $fsTerrainCommon\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrainNormal"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform vec3 origin;\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 viewNormal;\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec3 vnormal;\n\n$applySkirts\n\n  void main(void) {\n#ifdef SPHERICAL\n    vec4 normal \x3d vec4(normalize($position + origin), 1.0);\n#else\n    vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\n#endif\n\n    vec2 uv \x3d $uv0;\n    vec3 vpos \x3d applySkirts(uv, $position, normal.xyz);\n\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\n    vnormal \x3d normalize((viewNormal * normal).xyz);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrainDepth"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform vec3 origin;\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec2 nearFar;\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying float depth;\n\n$applySkirts\n\n  void main(void) {\n#ifdef SPHERICAL\n    vec3 normal \x3d normalize($position + origin);\n#else\n    vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec2 uv \x3d $uv0;\n    vec3 vpos \x3d applySkirts(uv, $position, normal.xyz);\n\n    vec4 eye \x3d view * vec4(vpos, 1.0);\n    gl_Position \x3d proj * eye;\n    depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"vsTerrainHighlight"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  uniform vec3 origin;\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform vec4 overlayTexScale;\n  uniform vec4 overlayTexOffset;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  varying vec4 vtcOverlay;\n\n$applySkirts\n\n  void main() {\n    #ifdef SPHERICAL\n      vec3 vnormal \x3d normalize($position + origin);\n    #else\n      vec3 vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\n    #endif\n\n    vec2 uv \x3d $uv0;\n    vec3 vpos \x3d applySkirts(uv, $position, vnormal);\n\n    vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsTerrainHighlight"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D overlay0Tex;\n  uniform sampler2D overlay1Tex;\n  uniform float overlayOpacity;\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  varying vec4 vtcOverlay;\n\n  $getOverlayColor\n\n  void main() {\n    vec4 overlayColor \x3d getOverlayColor(vtcOverlay, overlayOpacity);\n\n    if (overlayColor.a \x3d\x3d 0.0) {\n      // Here we have to write black, instead of discarding the fragment in order to overwrite\n      // the highlights which might have been written by skirts of other tiles.\n      // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n      gl_FragColor \x3d vec4(0,0,0,0);\n      return;\n    }\n\n    $highlightWrite\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n',
"*now":function(r){r(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/when ../Camera ../geometry ../Graphic ../Viewpoint ../core/Error ../core/Handles ../core/Logger ../core/promiseUtils ../core/scheduling ../core/sniff ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/watch ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/GraphicsView3D ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/lib/glMatrix ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),function(r,
g,f,a,c,b,l,e,d,h,n,t,p,k,q,m,u,x,v,y,A,C,B,D,E,H,F,L,G,P,J,M,O,aa,V,N,S,W,X,Q,I,K,T,Y,ba,R,ha,ea,ca,fa,da,ga,ka,U,la,sa,ia,w){var qa=p.getLogger("esri.views.SceneView");r=function(g){function p(a){a=g.call(this)||this;a._layerViewsUpdatingHandles={};a._clippingArea=null;a._internallyReady=!1;a._userClippingArea=null;a._initialDefaultSpatialReference=null;a._defaults={};a._externallySet={environment:!1};a._handles=new t;a._surfaceReadyWatchHandle=null;a._updateUpdatingMonitorsHandle=null;a._mapLayersChangeHandle=
null;a._updateDrawingOrderHandle=null;a._stageFrameTask=null;a.onViewExtentUpdateHandle=null;a.graphicsView=null;a.resourceController=new ea(a);a.deconflictor=new O(a);a.labeler=new aa.Labeler(a);a.renderSpatialReference=null;a.sharedSymbolResources=null;a.basemapTerrain=null;a.elevationProvider=null;a.camera=null;a.canvas=null;a.center=null;a.constraints=new L.default;a.extent=null;a.fullOpacity=1;a.map=null;a.screenSizePerspectiveEnabled=!0;a.state=null;a.scale=null;a.isHeightModelInfoRequired=
!0;a.alpha=!1;a.type="3d";a.ui=new ia;a.updating=!1;a.updatingPercentage=0;a.viewpoint=null;a.zoom=null;a.highlightOptions=new T;u.when(a,"ready",a._viewReadyHandler.bind(a));a._evaluateUpdating=a._evaluateUpdating.bind(a);a.watch("map",function(a){a&&a.load&&a.load()});a.inputManager=new J({view:a});a.stateManager=new X.ViewStateManager({view:a});return a}f(p,g);p.prototype.getDefaults=function(a){var b=this.inherited(arguments);b.environment||a.environment||(this._defaults.environment=new G,b.environment=
this._defaults.environment);return b};p.prototype.initialize=function(){var a=this;this.environmentManager=new P.default({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});u.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));this.resourceController.memoryEvents.on("updating-changed",function(){return a._evaluateUpdating()});u.init(this.qualitySettings,
"gpuMemoryLimit",function(b){a.resourceController&&(a.resourceController.maxGpuMemory=b)});u.init(this.qualitySettings,"frameRate",function(a){q.setFrameRate(a)});u.init(I,"SCENEVIEW_LOCKING_LOG",function(b){a.defaultsFromMap.logDebugInformation=b})};p.prototype.destroy=function(){this.activeTool=null;v.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._handles.removeAll();this.inputManager&&
(this.inputManager.destroy(),this._set("inputManager",null))};Object.defineProperty(p.prototype,"activeTool",{set:function(a){if(a&&!this.ready)qa.error("#activeTool\x3d","cannot set active tool while view is not ready");else{var b=this._get("activeTool");a!==b&&(b&&b.deactivate(),this._set("activeTool",a),a&&a.activate())}},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;
var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof e.Extent))return qa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(B.canProject(b.spatialReference,this.spatialReference))b=B.project(b,this.spatialReference);else return qa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&b&&this._clippingArea.equals(b)?
this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?qa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||e.SpatialReference.WGS84,c=this.clippingArea;c&&(c=B.project(c,b));var d=function(d){d&&(d=B.project(d,b))&&(c&&(d=d.intersection(c)),
d&&a.push(d))},f=this._get("basemapTerrain");f&&f.spatialReference&&d(new e.Extent({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){d(a.fullExtent)});return 0<a.length?(f=a.reduce(function(a,b){return a.union(b)}),f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,f.zmax)):(f.zmin=0,f.zmax=0),f):new e.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b})},enumerable:!0,
configurable:!0});Object.defineProperty(p.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);a?a instanceof G?this._set("environment",a):a instanceof w?this.environment.lighting=a.lighting:a.declaredClass?this._set("environment",a):this._set("environment",new G(a)):this._set("environment",new G)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=
a.extent;return new e.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new e.Extent({spatialReference:this.spatialReference||e.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"initialExtentRequired",{get:function(){return!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});
p.prototype._mapSetter=function(a){a!==this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))};Object.defineProperty(p.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||K.getDefaultProfile()},set:function(a){K.isValidProfile(a)&&(K.apply(a,this.qualitySettings),this._set("qualityProfile",
a))},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"resolution",{get:function(){return null!=this.spatialReference?C.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?y.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewingMode",{get:function(){var a=
this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?qa.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});p.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};
p.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};p.prototype.toMap=function(a,b,c){if(!this.ready)return qa.error("#toMap()","Scene view cannot be used before it is ready"),null;var d;"number"===typeof a?(d=a,a=b):(d=a.x,a=a.y,c=b);b=this._stage.pick([d,this.height-a]).getMinResult();return this._computeMapPointFromIntersectionResult(b,c)};p.prototype.toScreen=function(a,b,c,d){if(!this.ready)return qa.error("#toScreen()",
"Scene view cannot be used before it is ready"),null;"number"===typeof a?("object"===typeof c&&(d=c),ba.vectorToVector([a,b,"number"===typeof c?c:0],this.spatialReference,ua,this.renderSpatialReference)):(ba.pointToVector(a,ua,this.renderSpatialReference),d=b);return this.engineToScreen(ua,d)};p.prototype.pixelSizeAt=function(a,b){if(!this.ready)return qa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof a){if(a=this._stage.pick([a,this.height-b]).getMinResult(),
!a.getIntersectionPoint(ua))return 0}else if(a instanceof e.Point)ba.pointToVector(a,ua,this.renderSpatialReference);else if(a=this._stage.pick([a.x,this.height-a.y]).getMinResult(),!a.getIntersectionPoint(ua))return 0;return this.state.camera.computePixelSizeAt(ua)};p.prototype.hitTest=function(a,c){if(!this.ready)return qa.error("#hitTest()","Scene view cannot be used before it is ready"),null;var d,f;"number"===typeof a?(d=a,f=c):(d=a.x,f=a.y);var g=this._stage.pick([d,this.height-f],null,!0);
a=g.getMinResult();var h=this._computeMapPointFromIntersectionResult(a),k;switch(a.targetType){case "None":k=null;break;case "StageObject":k=this._getGraphicFromStageObject(a.target,a.triangleNr);break;case "StagePoint":k=b(this._getGraphicFromStagePoint(a.target))}return b(k).catch(function(){return null}).then(function(a){var b=[];(a||h)&&b.push({mapPoint:h,graphic:a});a={screenPoint:new e.ScreenPoint({x:d,y:f}),results:b};I.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(a.selector=g);return a})};p.prototype.goTo=
function(a,b){return this.stateManager.goTo(a,b)};p.prototype.takeScreenshot=function(a){var b=this;if(this.ready)return a=la.adjustScreenshotSettings(a,this),k.create(function(c){b._stage.requestScreenCapture(a,function(a){q.schedule(function(){c(a)})})});qa.error("#takeScreenshot()","Scene view cannot be used before it is ready")};p.prototype.destroyLayerViews=function(){for(var a in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[a].remove();this._layerViewsUpdatingHandles={};this.stateManager.deinit();
this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null};p.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&
this._initialDefaultSpatialReference||null};p.prototype.validate=function(){var a=sa.check();m("safari")&&9>m("safari")&&(a=new n("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:m("safari")}));return a?(qa.warn("#validate()",a.message),k.reject(a)):k.resolve()};p.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,f=a.isWGS84,g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&
!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!e&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(b)if(ga.isTiledLayer(b)){if(d=void 0,h?h=ga.getTiledLayerInfo(b,a,this.viewingMode):(h=ga.getTiledLayerInfo(b,
a,"global"),null==h.tileInfo&&(h=ga.getTiledLayerInfo(b,a,"local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((f||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),h||this._internallyReady||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),
!1;return!0};p.prototype.engineToScreen=function(a,b){var c=S.vec3d.create();this.state.camera.projectPoint(a,c);a=c[0];var d=this.height-c[1],c=c[2];return b?(b.x=a,b.y=d,b.z=c,b):new e.ScreenPoint({x:a,y:d,z:c})};p.prototype.flushDisplayModifications=function(){this._stage.processDirty()};p.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})};p.prototype.getViewForGraphic=function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===
a.layer}):this.graphicsView};p.prototype.whenViewForGraphic=function(a){return a.layer?this.whenLayerView(a.layer):k.resolve(this.graphicsView)};p.prototype._computeMapPointFromIntersectionResult=function(a,b){if(a.getIntersectionPoint(ua)){b=this._computeMapPointFromVec3d(ua,b);var c=this._get("basemapTerrain");"terrain"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null};p.prototype._computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||e.SpatialReference.WGS84;
ba.vectorToVector(a,this.renderSpatialReference,a,c)||(c=e.SpatialReference.WGS84,ba.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new e.Point(a,c);return b};p.prototype._getGraphicFromStageObject=function(a,b){var c=a.getMetadata();if(null!=c&&null!=c.layerUid){if(c.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicsFromStageObject(a,b);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){if(c&&
null!=c.getGraphicsFromStageObject&&!c.suspended)return c.getGraphicsFromStageObject(a,b)})}return null};p.prototype._getGraphicFromStagePoint=function(a){var b=this._computeMapPointFromVec3d(a.point),b=new d(b);a=a.metadata.layerUid;null!=a&&b.set("layer",this.map.findLayerByUid(a));return b};p.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};p.prototype._initBasemapTerrain=function(a){this._disposeBasemapTerrain();this._set("basemapTerrain",
new da(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new Q({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};p.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,0,0,0],maxFarNearRatio:0,frustumCullingEnabled:!1});this._initBasemapTerrain(a);this._set("pointsOfInterest",new fa.default({view:this}));this._set("featureTiles",new V.default({renderCoordsHelper:this.renderCoordsHelper,
cameraOnSurface:this.pointsOfInterest.cameraOnSurface,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,filterExtent:null}));this._handles.add(this.featureTiles.watch("updating",function(){return b._evaluateUpdating()}));this._handles.add(u.init(I,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTilesDebugger?b.featureTilesDebugger=new N.FeatureTileTree3DDebugger(b):!a&&b.featureTilesDebugger&&(b.featureTilesDebugger.destroy(),b.featureTilesDebugger=null)}),"feature-tiles");
this._handles.add(u.init(this,["clippingArea","basemapTerrain.extent"],function(){if(b.clippingArea||b.basemapTerrain.extent)if(b.basemapTerrain.extent&&b.basemapTerrain.spatialReference){var a=A.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference);b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a}else b.featureTiles.filterExtent=b.clippingArea;else b.featureTiles.filterExtent=null},!0),"feature-tiles");this._initStateManager()};p.prototype._initCoordinateSystem=
function(){if(this.spatialReference){var a=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(a)||this._set("mapCoordsHelper",new Y.default(this.map,a));var b="global"===this.viewingMode,a=b?ba.SphericalECEFSpatialReference:a;a!==this.renderSpatialReference&&(this.renderSpatialReference=a,this._set("renderCoordsHelper",ha.createRenderCoordsHelper(b?"global":"local",a)),this._stage&&this._stage.setIntersectTolerance(U.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",
null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};p.prototype._evaluateUpdating=function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});if(this.graphicsView&&this.graphicsView.updating||this.resourceController&&this.resourceController.updating||this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating)c=!0;c!==this.updating&&this._set("updating",c);a=0!==b?a/b:c?100:0;this.updatingPercentage!==
a&&this._set("updatingPercentage",a)};p.prototype._updateUpdatingMonitors=function(a){for(var b=0;b<a.removed.length;b++){var c=a.removed[b],d=this._layerViewsUpdatingHandles[c.uid];d&&(delete this._layerViewsUpdatingHandles[c.uid],c.destroyed||d.remove())}for(b=0;b<a.added.length;b++)c=a.added[b],c.destroyed||(d=c.watch(["updating","updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[c.uid]=d);this._evaluateUpdating()};p.prototype._pickRay=function(a,b,c,d,e,f,g){return this._stage?
this._stage.pickRay(a,b,c,d,e,f,g):null};p.prototype._pickRayWithBeginPoint=function(a,b,c,d,e){this._stage&&this._stage.pickRayWithBeginPoint(a,b,c,d,e)};p.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this._mapLayersChangeHandle=a(this._mapLayersChangeHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),
this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};p.prototype._disposeBasemapTerrain=function(){var a=this._get("basemapTerrain");a&&(a.destroy(),this._set("basemapTerrain",null))};p.prototype._initStage=function(){var a=this,b={};b.renderContext=this.renderContext;b.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;
b.viewingMode=this.viewingMode;b.alpha=this.alpha;this.renderCanvas&&(b.canvas=this.renderCanvas);this._stage=new ka(this.viewingMode,c.byId(this.surface),b);this._handles.add(u.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),"stage");b=function(){a._stage.setRenderParams({defaultHighlightOptions:T.toEngineOptions(a.highlightOptions)})};this._handles.add(this.watch(["highlightOptions","highlightOptions.color",
"highlightOptions.haloOpacity","highlightOptions.fillOpacity"],b),"stage");b();this.renderCoordsHelper&&this._stage.setIntersectTolerance(U.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=q.addFrameTask(this._stage.getFrameTask())};p.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ca.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,
pointsOfInterest:this.pointsOfInterest,viewState:this.state})};p.prototype._initGraphicsView=function(){var a=this;this._surfaceReadyWatchHandle=u.whenTrueOnce(this,"basemapTerrain.ready",function(){a.graphicsView=new M({view:a});a._surfaceReadyWatchHandle=null;a._layerViewsUpdatingHandles[a.graphicsView.mockLayerId]=u.init(a.graphicsView,"updating",a._evaluateUpdating)})};p.prototype._disposeGraphicsView=function(){this._surfaceReadyWatchHandle&&(this._surfaceReadyWatchHandle.remove(),this._surfaceReadyWatchHandle=
null);if(this.graphicsView){var a=this.graphicsView.mockLayerId;this._layerViewsUpdatingHandles[a].remove();delete this._layerViewsUpdatingHandles[a];this.graphicsView.destroy();this.graphicsView=null}};p.prototype._initState=function(){this._set("state",new W.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};p.prototype._initStateManager=function(){this.stateManager.init()};p.prototype._viewReadyHandler=function(a,b){b||("global"===this.viewingMode&&(this._clippingArea=
null),this._internallyReady=!0,this._initSurface(),this._initGraphicsView(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this)),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0))};p.prototype._viewUnreadyHandler=function(a,b){b&&(this.activeTool&&(this.activeTool.deactivate(),this._set("activeTool",
null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),this._stage=null),this._handles.remove("stage"),this._set("canvas",null))};p.prototype._updateDrawingOrder=
function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in b&&(b.drawingOrder=a-c)})};a([x.property({value:null})],p.prototype,"activeTool",null);a([x.property({type:F,readOnly:!0,aliasOf:"state.animation"})],p.prototype,"animation",void 0);a([x.property({readOnly:!0})],p.prototype,"basemapTerrain",void 0);a([x.property({readOnly:!0})],p.prototype,"elevationProvider",void 0);a([x.property({type:l,aliasOf:"stateManager.camera"})],p.prototype,"camera",void 0);
a([x.property({readOnly:!0})],p.prototype,"canvas",void 0);a([x.property({type:e.Point,aliasOf:"stateManager.center"})],p.prototype,"center",void 0);a([x.property({type:e.Extent,dependsOn:["map.clippingArea","map.clippingEnabled","viewingMode"]})],p.prototype,"clippingArea",null);a([x.property({type:L.default})],p.prototype,"constraints",void 0);a([x.property({type:e.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],p.prototype,"dataExtent",null);a([x.property({value:null})],
p.prototype,"environment",null);a([x.property()],p.prototype,"environmentManager",void 0);a([x.property({type:e.Extent,aliasOf:"stateManager.extent"})],p.prototype,"extent",void 0);a([x.property({type:e.ScreenPoint,readOnly:!0,aliasOf:"stateManager.screenCenter"})],p.prototype,"screenCenter",void 0);a([x.property({aliasOf:"stateManager.frustum"})],p.prototype,"frustum",void 0);a([x.property({type:Number,readOnly:!0})],p.prototype,"fullOpacity",void 0);a([x.property({type:e.Extent,dependsOn:["basemapTerrain.extent"],
readOnly:!0})],p.prototype,"groundExtent",null);a([x.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],p.prototype,"initialExtentRequired",null);a([x.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],p.prototype,"interacting",null);a([x.property()],p.prototype,"map",void 0);a([x.property({readOnly:!0})],p.prototype,"mapCoordsHelper",void 0);a([x.property({aliasOf:"stateManager.padding"})],p.prototype,"padding",void 0);a([x.property({type:fa.default,readOnly:!0})],
p.prototype,"pointsOfInterest",void 0);a([x.property({type:V.default,readOnly:!0})],p.prototype,"featureTiles",void 0);a([x.property({type:N.FeatureTileTree3DDebugger})],p.prototype,"featureTilesDebugger",void 0);a([x.property({type:Boolean})],p.prototype,"screenSizePerspectiveEnabled",void 0);a([x.property({constructOnly:!0})],p.prototype,"deactivatedWebGLExtensions",void 0);a([x.property({constructOnly:!0})],p.prototype,"renderCanvas",void 0);a([x.property({readOnly:!0})],p.prototype,"state",void 0);
a([x.property({readOnly:!0})],p.prototype,"inputManager",void 0);a([x.property({readOnly:!0})],p.prototype,"stateManager",void 0);a([x.property()],p.prototype,"qualityProfile",null);a([x.property({type:R,get:function(){var a=this._get("qualitySettings");a||(a=new R,K.apply(this.qualityProfile,a));return a}})],p.prototype,"qualitySettings",void 0);a([x.property({dependsOn:["viewingMode"]})],p.prototype,"ready",void 0);a([x.property({readOnly:!0})],p.prototype,"renderCoordsHelper",void 0);a([x.property({type:Number,
dependsOn:["scale","spatialReference"],readOnly:!0})],p.prototype,"resolution",null);a([x.property({type:Number,aliasOf:"stateManager.scale"})],p.prototype,"scale",void 0);a([x.property()],p.prototype,"heightModelInfo",null);a([x.property({dependsOn:["map.initialViewProperties.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],p.prototype,"spatialReference",void 0);a([x.property({type:Boolean})],p.prototype,"isHeightModelInfoRequired",void 0);a([x.property({type:Boolean,constructOnly:!0})],
p.prototype,"alpha",void 0);a([x.property()],p.prototype,"type",void 0);a([x.property({type:ia})],p.prototype,"ui",void 0);a([x.property({type:Boolean,readOnly:!0})],p.prototype,"updating",void 0);a([x.property({type:Number,readOnly:!0})],p.prototype,"updatingPercentage",void 0);a([x.property({type:String,dependsOn:["map.initialViewProperties.viewingMode","spatialReference"]})],p.prototype,"viewingMode",null);a([x.property({type:h,aliasOf:"stateManager.viewpoint"})],p.prototype,"viewpoint",void 0);
a([x.property({type:Number,aliasOf:"stateManager.zoom"})],p.prototype,"zoom",void 0);a([x.property({type:T})],p.prototype,"highlightOptions",void 0);return p=a([x.subclass("esri.views.SceneView")],p)}(x.declared(E,H,D));var ua=S.vec3d.create();return r});