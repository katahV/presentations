// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./Texture","./ModelContentType"],function(t,p){var d,q=function(u){this._textTextures={};var l=t.__idGen.gen(u),b=null;this.getId=function(){return l};this.dispose=function(){};this.deferredLoading=function(){return!1};this.getWidth=function(){return 512};this.getHeight=function(){return 512};this.renderGl=function(c,a){this._createTextTexture(c,a);a._isTracingEnabled&&(c._debugTracingType="TextTextureAtlas")};this._createTextTexture=function(c,a){void 0===d&&(d=document.createElement("canvas"),
d.setAttribute("id","canvas2d"),d.setAttribute("width",512),d.setAttribute("height",512),d.setAttribute("style","display:none"));var b=d.getContext("2d");b.save();b.clearRect(0,0,512,512);a.bindTexture(a.TEXTURE_2D,c);for(var f in this._textTextures)c=this._textTextures[f],c.textTexture.renderText(1,c.placement.width,c.placement.height,b,c.placement.atlasOffX,c.placement.atlasOffY);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d);f=a.LINEAR;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,
a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,f);a.bindTexture(a.TEXTURE_2D,null);b.restore()};this.setUnloadFunc=function(c){b=c};this.unload=function(){null!=b&&(b(l),b=void 0)}};return function(d,l){var b=[],c=0,a=0,k=0;this.dispose=function(){for(var a=0;a<b.length;a++)l.remove(p.TEXTURE,b[a].getId());b=[]};this.addTextTexture=function(f){for(var r=JSON.stringify(f.getParams())+
"_"+f.getString(),e=0;e<b.length;e++){var h=b[e]._textTextures[r];if(null!=h)return h.placement}var g=null;0===b.length&&(g=new q(d),b.push(g));var e=f.getTextWidth(),h=f.getTextHeight(),m,n;k=Math.max(k,h);512>c+e&&512>a+k||(512>a+k+h?(c=0,a+=k):(g=new q(d),b.push(g),a=c=0),k=h);m=c;n=a;c+=e;null!=g&&l.add(p.TEXTURE,g);g=b[b.length-1];e={uvMinMax:[m/512,1-(n+h)/512,(m+e)/512,1-n/512],atlasOffX:m,atlasOffY:n,width:e,height:h,texture:g};g._textTextures[r]={placement:e,textTexture:f};return e}}});