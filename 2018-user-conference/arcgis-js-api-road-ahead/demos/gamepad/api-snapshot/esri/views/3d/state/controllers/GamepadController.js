// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/glMatrix ../Constraints ./CameraController ../../support/mathUtils".split(" "),function(u,v,A,B,a,w,C,x){Object.defineProperty(v,"__esModule",{value:!0});var k=a.vec3d.create(),l=a.vec3d.create(),y=a.vec3d.create(),n=a.vec3d.create(),z=a.vec3d.create(),r=a.vec3d.create(),g=a.mat4d.create(),m=a.mat4d.create(),b={translation:[0,0,0],heading:0,tilt:0};u=function(t){function h(a){var b=t.call(this)||
this;b.view=a;return b}A(h,t);Object.defineProperty(h.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});h.prototype.stepController=function(e,f){t.prototype.stepController.call(this,e,f);this.view.gamepad.updateTransformation(b);if(0!==b.translation[0]||0!==b.translation[1]||0!==b.translation[2]||0!==b.heading||0!==b.tilt){a.mat4d.identity(g);a.mat4d.identity(m);e=f.eye;var h=f.center,q=f.viewUp,p=f.viewRight,d=f.viewForward;this.view.renderCoordsHelper.worldUpAtPosition(e,
l);var c=this.view.renderCoordsHelper.getAltitude(e);if("local"===this.view.viewingMode){c=Math.pow(Math.min(Math.max(c,1),1E4),2);a.vec3d.set3(d[0],d[1],0,k);a.vec3d.normalize(k);a.vec3d.scale(p,b.translation[0]*c*1E-5,y);switch(this.view.gamepad.mode){case "hover":a.vec3d.scale(k,-b.translation[1]*c*1E-5,n);break;case "flight":a.vec3d.scale(d,-b.translation[1]*c*1E-5,n)}a.vec3d.scale(l,b.translation[2]*c*1E-5,z);a.vec3d.add(y,n,r);a.vec3d.add(r,z);a.mat4d.translate(g,r);a.mat4d.rotate(m,.04*-b.heading,
l);c=.04*b.tilt;d=Math.acos(a.vec3d.dot(l,d));d-c>w.TiltDefault.min&&d-c<x.deg2rad(this.view.constraints.tilt.max)&&a.mat4d.rotate(m,c,p)}else if("global"===this.view.viewingMode){c=Math.pow(Math.min(Math.max(c,1),1E4),2);a.vec3d.cross(p,e,k);a.vec3d.normalize(k);a.vec3d.negate(k);a.mat4d.rotate(g,b.translation[0]*c*1E-11,k);switch(this.view.gamepad.mode){case "hover":a.mat4d.rotate(g,b.translation[1]*c*1E-11,p);break;case "flight":a.vec3d.scale(d,-b.translation[1]*c*1E-4,n),a.mat4d.translate(g,n)}a.vec3d.scale(l,
b.translation[2]*c*1E-5);a.mat4d.translate(g,l);a.mat4d.rotate(m,.04*-b.heading,e);c=.04*b.tilt;d=Math.acos(a.vec3d.dot(l,d));d-c>w.TiltDefault.min&&d-c<x.deg2rad(this.view.constraints.tilt.max)&&a.mat4d.rotate(m,c,p)}a.vec3d.subtract(h,e);a.vec3d.subtract(q,e);a.mat4d.multiplyVec3(m,h);a.mat4d.multiplyVec3(m,q);a.vec3d.add(h,e);a.vec3d.add(q,e);a.mat4d.multiplyVec3(g,e,f.eye);a.mat4d.multiplyVec3(g,h,f.center);a.mat4d.multiplyVec3(g,q,f.up);B.applyAll(this.view,f,{selection:8,interactionType:0,interactionFactor:null,
interactionStartCamera:null,interactionDirection:null})}};return h}(C.CameraController);v.GamepadController=u});