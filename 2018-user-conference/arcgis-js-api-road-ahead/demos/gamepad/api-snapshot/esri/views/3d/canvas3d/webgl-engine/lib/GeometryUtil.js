// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(B,Q,K,R){var f=R.vec3,O=R.vec3d,k=K.VertexAttrConstants,J=Q.Vec3Compact,F=O.create(),S=O.create(),P={createSphereGeometry:function(a,e,b,c,d,m,g){a=a||50;c=void 0!==c?c:-Math.PI;d=void 0!==d?d:2*Math.PI;m=void 0!==m?m:.5*-Math.PI;g=void 0!==g?g:Math.PI;var l=Math.max(3,Math.floor(e)||8),h=Math.max(2,Math.floor(b)||6),n=(l+1)*(h+1);b=new Float32Array(3*n);e=new Float32Array(3*n);var n=new Float32Array(2*n),p,q,v=[],x=f.create(),
u=0;for(q=0;q<=h;q++){var r=[],t=q/h,w=m+t*g,E=Math.cos(w);for(p=0;p<=l;p++){var A=p/l,y=c+A*d,C=Math.cos(y)*E*a,G=Math.sin(w)*a,y=-Math.sin(y)*E*a;b[3*u]=C;b[3*u+1]=G;b[3*u+2]=y;f.set3(C,G,y,x);f.normalize(x);e[3*u]=x[0];e[3*u+1]=x[1];e[3*u+2]=x[2];n[2*u]=A;n[2*u+1]=t;r.push(u);++u}v.push(r)}a=new Uint32Array(2*l*(h-1)*3);for(q=u=0;q<h;q++)for(p=0;p<l;p++)c=v[q][p],d=v[q][p+1],m=v[q+1][p+1],g=v[q+1][p],0===q?(a[u++]=c,a[u++]=m,a[u++]=g):q===h-1?(a[u++]=c,a[u++]=d,a[u++]=m):(a[u++]=c,a[u++]=d,a[u++]=
m,a[u++]=m,a[u++]=g,a[u++]=c);K.assert(u===a.length);l={};l[k.POSITION]=a;l[k.NORMAL]=a;l[k.UV0]=a;h={};h[k.POSITION]={size:3,data:b};h[k.NORMAL]={size:3,data:e};h[k.UV0]={size:2,data:n};return new B([{type:"triangle",indices:l,positionKey:k.POSITION}],h)},createPolySphereGeometry:function(a,e,b){function c(b,c){b>c&&(b=c+(c=b,0));var d=b.toString()+"."+c.toString();if(g[d])return g[d];var e=m.length;m.length+=3;J.add(m,3*b,m,3*c,m,e);J.scale(m,e,a/J.length(m,e));e/=3;return g[d]=e}var d,m;b?(m=[0,
-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],b=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(b=a*(1+Math.sqrt(5))/2,m=[-a,b,0,a,b,0,-a,-b,0,a,-b,0,0,-a,b,0,a,b,0,-a,-b,0,a,-b,b,0,-a,b,0,a,-b,0,-a,-b,0,a],b=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(d=0;d<m.length;d+=3)J.scale(m,d,a/J.length(m,d));var g={};for(d=0;d<e;d++){for(var f=b.length,h=Array(4*f),n=0;n<f;n+=3){var p=b[n],q=b[n+1],v=b[n+2],x=c(p,q),
u=c(q,v),r=c(v,p),t=4*n;h[t]=p;h[t+1]=x;h[t+2]=r;h[t+3]=q;h[t+4]=u;h[t+5]=x;h[t+6]=v;h[t+7]=r;h[t+8]=u;h[t+9]=x;h[t+10]=u;h[t+11]=r}b=h;g={}}e=new Float32Array(m);for(d=0;d<e;d+=3)J.normalize(e,d);m=new Float32Array(m);d={};d[k.POSITION]=b;d[k.NORMAL]=b;b={};b[k.POSITION]={size:3,data:m};b[k.NORMAL]={size:3,data:e};return new B([{type:"triangle",indices:d,positionKey:k.POSITION}],b)},createPointGeometry:function(a,e,b,c,d,m,g){var f=new Float32Array(3);f[0]=e?e[0]:0;f[1]=e?e[1]:0;f[2]=e?e[2]:0;e=
new Float32Array(3);e[0]=a?a[0]:0;e[1]=a?a[1]:0;e[2]=a?a[2]:1;if(null==g)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(g.length);for(var h=0;h<g.length;h++)a[h]=g[h]}g=new Uint8Array(4);g[0]=b?255*b[0]:255;g[1]=b?255*b[1]:255;g[2]=b?255*b[2]:255;g[3]=b&&3<b.length?255*b[3]:255;b=new Float32Array(2);b[0]=null!=c&&2==c.length?c[0]:1;b[1]=null!=c&&2==c.length?c[1]:1;if(null!=m){var n=new Float32Array(4);n[0]=m[0];n[1]=m[1];n[2]=m[2];n[3]=m[3]}h=new Uint32Array(1);h[0]=0;c={};c[k.POSITION]=
h;c[k.NORMAL]=h;c[k.UV0]=h;c[k.COLOR]=h;c[k.SIZE]=h;null!=m&&(c[k.AUXPOS1]=h);h={};h[k.POSITION]={size:3,data:f};h[k.NORMAL]={size:3,data:e};h[k.UV0]={size:a.length,data:a};h[k.COLOR]={size:4,data:g};h[k.SIZE]={size:2,data:b};null!=m&&(h[k.AUXPOS1]={size:4,data:n});m=[{type:"point",indices:c,positionKey:k.POSITION}];return d?{faces:m[0],vertexAttr:h,id:B.getNewId().toString()}:new B(m,h)},createPointArrayGeometry:function(a,e){for(var b=new Float32Array(3*a.length),c=new Float32Array(e?3*a.length:
3),d=new Uint32Array(a.length),m=new Uint32Array(a.length),g=0;g<a.length;g++)b[3*g]=a[g][0],b[3*g+1]=a[g][1],b[3*g+2]=a[g][2],e&&(c[3*g]=e[g][0],c[3*g+1]=e[g][1],c[3*g+2]=e[g][2]),d[g]=g,m[g]=0;e||(c[0]=0,c[1]=1,c[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;g={};g[k.POSITION]=d;g[k.NORMAL]=e?d:m;g[k.UV0]=m;e={};e[k.POSITION]={size:3,data:b};e[k.NORMAL]={size:3,data:c};e[k.UV0]={size:2,data:a};return new B([{type:"point",indices:g,positionKey:k.POSITION}],e)},createTriangleGeometry:function(){var a=
new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var e=new Uint32Array(3);e[0]=0;e[1]=1;e[2]=2;var b=new Float32Array(3);b[0]=0;b[1]=1;b[2]=0;var c=new Uint32Array(3);c[0]=0;c[1]=0;c[2]=0;var d=new Float32Array(2);d[0]=0;d[1]=0;var m=new Uint32Array(3);m[0]=0;m[1]=0;m[2]=0;var g={};g[k.POSITION]=e;g[k.NORMAL]=c;g[k.UV0]=m;e={};e[k.POSITION]={size:3,data:a};e[k.NORMAL]={size:3,data:b};e[k.UV0]={size:2,data:d};return new B([{type:"triangle",indices:g,positionKey:k.POSITION}],
e)},createSquareGeometry:function(a,e){var b,c,d=new Float32Array(12);if(a)for(b=0;4>b;b++)for(c=0;3>c;c++)d[3*b+c]=a[b][c];else d[0]=-1,d[1]=-1,d[2]=0,d[3]=1,d[4]=-1,d[5]=0,d[6]=1,d[7]=1,d[8]=0,d[9]=-1,d[10]=1,d[11]=0;c=new Uint32Array(6);c[0]=0;c[1]=1;c[2]=2;c[3]=2;c[4]=3;c[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var m=new Uint32Array(6);for(b=0;6>b;b++)m[b]=0;b=new Float32Array(8);b[0]=0;b[1]=0;b[2]=1;b[3]=0;b[4]=1;b[5]=1;b[6]=0;b[7]=1;var g={};g[k.POSITION]=c;g[k.NORMAL]=m;g[k.UV0]=c;
c={};c[k.POSITION]={size:3,data:d};c[k.NORMAL]={size:3,data:a};c[k.UV0]={size:2,data:b};d=[{type:"triangle",indices:g,positionKey:k.POSITION}];return e?{faces:d[0],vertexAttr:c,id:B.getNewId().toString()}:new B(d,c)},createBoxGeometry:function(){var a,e,b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],c=new Float32Array([0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1]),d=new Float32Array(8);d[0]=0;d[1]=0;d[2]=1;d[3]=0;d[4]=1;d[5]=1;d[6]=0;d[7]=1;var m=
new Uint32Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),g=new Uint32Array(36);for(a=0;6>a;a++)for(e=0;6>e;e++)g[6*a+e]=a;var f=new Uint32Array(36);for(a=0;6>a;a++)f[6*a+0]=0,f[6*a+1]=1,f[6*a+2]=2,f[6*a+3]=2,f[6*a+4]=3,f[6*a+5]=0;return function(a){var e;Array.isArray(a)||(a=[a,a,a]);var h=new Float32Array(24);for(e=0;8>e;e++)h[3*e]=b[e][0]*a[0],h[3*e+1]=b[e][1]*a[1],h[3*e+2]=b[e][2]*a[2];a={};a[k.POSITION]=m;a[k.NORMAL]=g;a[k.UV0]=f;e={};e[k.POSITION]={size:3,data:h};
e[k.NORMAL]={size:3,data:c};e[k.UV0]={size:2,data:d};return new B([{type:"triangle",indices:a,positionKey:k.POSITION}],e)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],e=new Float32Array([0,1,1,-1,1,0,0,1,-1,1,1,0,0,-1,1,-1,-1,0,0,-1,-1,1,-1,0]),b=new Uint32Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),c=new Uint32Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);return function(d){var f;Array.isArray(d)||(d=[d,d,d]);
var g=new Float32Array(18);for(f=0;6>f;f++)g[3*f]=a[f][0]*d[0],g[3*f+1]=a[f][1]*d[1],g[3*f+2]=a[f][2]*d[2];d={};d[k.POSITION]=b;d[k.NORMAL]=c;f={};f[k.POSITION]={size:3,data:g};f[k.NORMAL]={size:3,data:e};return new B([{type:"triangle",indices:d,positionKey:k.POSITION}],f)}}(),createTetrahedronGeometry:function(){var a=f.createFrom(-.5,0,-.5),e=f.createFrom(.5,0,-.5),b=f.createFrom(0,0,.5),c=f.createFrom(0,.5,0),d=f.create(),m=f.create(),g=f.create(),l=f.create(),h=f.create();f.subtract(a,c,d);f.subtract(a,
e,m);f.cross(d,m,g);f.normalize(g,g);f.subtract(e,c,d);f.subtract(e,b,m);f.cross(d,m,l);f.normalize(l,l);f.subtract(b,c,d);f.subtract(b,a,m);f.cross(d,m,h);f.normalize(h,h);var n=[a,e,b,c],p=new Float32Array([0,-1,0,g[0],g[1],g[2],l[0],l[1],l[2],h[0],h[1],h[2]]),q=new Uint32Array([0,1,2,3,1,0,3,2,1,3,0,2]),v=new Uint32Array([0,0,0,1,1,1,2,2,2,3,3,3]);return function(a){var b;Array.isArray(a)||(a=[a,a,a]);var c=new Float32Array(12);for(b=0;4>b;b++)c[3*b]=n[b][0]*a[0],c[3*b+1]=n[b][1]*a[1],c[3*b+2]=
n[b][2]*a[2];a={};a[k.POSITION]=q;a[k.NORMAL]=v;b={};b[k.POSITION]={size:3,data:c};b[k.NORMAL]={size:3,data:p};return new B([{type:"triangle",indices:a,positionKey:k.POSITION}],b)}}(),createConeGeometry:function(a,e,b,c){var d=0,m=f.createFrom(0,0,0),g=f.createFrom(0,d,0),l=f.createFrom(0,d+a,0),h=f.createFrom(0,1,0);c&&(d=a,l=f.createFrom(0,0,0),g=f.createFrom(0,d,0));var g=[l,g],m=[m,h],h=b+2,n=0,l=Math.sqrt(a*a+e*e);if(c)for(c=b-1;0<=c;c--)n=2*Math.PI/b*c,p=f.createFrom(Math.cos(n)*e,d,Math.sin(n)*
e),g.push(p),n=f.createFrom(a*Math.cos(n)/l,e/l,a*Math.sin(n)/l),m.push(n);else for(c=0;c<b;c++){var n=2*Math.PI/b*c,p=f.createFrom(Math.cos(n)*e,d,Math.sin(n)*e);g.push(p);n=f.createFrom(a*Math.cos(n)/l,e/l,a*Math.sin(n)/l);m.push(n)}a=new Uint32Array(6*(b+2));b=new Uint32Array(6*(b+2));d=e=0;for(c=3;c<g.length;c++)a[e++]=1,a[e++]=c-1,a[e++]=c,b[d++]=1,b[d++]=1,b[d++]=1;a[e++]=g.length-1;a[e++]=2;a[e++]=1;b[d++]=1;b[d++]=1;b[d++]=1;for(c=3;c<g.length;c++)a[e++]=c,a[e++]=c-1,a[e++]=0,b[d++]=c,b[d++]=
c-1,b[d++]=1;a[e++]=0;a[e++]=2;a[e++]=g.length-1;b[d++]=1;b[d++]=2;b[d++]=m.length-1;d=1;Array.isArray(d)||(d=[d,d,d]);e=new Float32Array(3*h);for(c=0;c<h;c++)e[3*c]=g[c][0]*d[0],e[3*c+1]=g[c][1]*d[1],e[3*c+2]=g[c][2]*d[2];g=new Float32Array(3*h);for(c=0;c<h;c++)g[3*c]=m[c][0],g[3*c+1]=m[c][1],g[3*c+2]=m[c][2];m={};m[k.POSITION]=a;m[k.NORMAL]=b;h={};h[k.POSITION]={size:3,data:e};h[k.NORMAL]={size:3,data:g};return new B([{type:"triangle",indices:m,positionKey:k.POSITION}],h)},createCylinderGeometry:function(a,
e,b,c,d,m){c||(c=f.createFrom(1,0,0));d||(d=f.createFrom(0,0,0));m=void 0===m?!0:m;var g=f.create();f.normalize(c,g);c=f.create();f.scale(g,Math.abs(a),c);var l=f.create();f.scale(c,-.5,l);f.add(l,d);var h=f.createFrom(0,1,0);Math.abs(.2>1-f.dot(g,h))&&f.set3(0,0,1,h);var n=f.create();f.cross(g,h,n);f.normalize(n);f.cross(n,g,h);var p=2*b+(m?2:0),q=b+(m?2:0);d=new Float32Array(3*p);a=new Float32Array(3*q);var v=new Float32Array(2*p),x=new Uint32Array(3*b*(m?4:2)),u=new Float32Array(3*b*(m?4:2));m&&
(d[3*(p-2)+0]=l[0],d[3*(p-2)+1]=l[1],d[3*(p-2)+2]=l[2],v[2*(p-2)]=0,v[2*(p-2)+1]=0,d[3*(p-1)+0]=d[3*(p-2)+0]+c[0],d[3*(p-1)+1]=d[3*(p-2)+1]+c[1],d[3*(p-1)+2]=d[3*(p-2)+2]+c[2],v[2*(p-1)]=1,v[2*(p-1)+1]=1,a[3*(q-2)+0]=-g[0],a[3*(q-2)+1]=-g[1],a[3*(q-2)+2]=-g[2],a[3*(q-1)+0]=g[0],a[3*(q-1)+1]=g[1],a[3*(q-1)+2]=g[2]);for(var r,t=0,w=f.create(),E=f.create(),g=0;g<b;g++){r=2*Math.PI/b*g;f.scale(h,Math.sin(r),w);f.scale(n,Math.cos(r),E);f.add(w,E);a[3*g+0]=w[0];a[3*g+1]=w[1];a[3*g+2]=w[2];f.scale(w,e);
f.add(w,l);d[3*g+0]=w[0];d[3*g+1]=w[1];d[3*g+2]=w[2];v[2*g+0]=g/b;v[2*g+1]=0;d[3*(g+b)+0]=d[3*g+0]+c[0];d[3*(g+b)+1]=d[3*g+1]+c[1];d[3*(g+b)+2]=d[3*g+2]+c[2];v[2*(g+b)+0]=g/b;v[2*g+1]=1;r=(g+1)%b;var A=function(a,b,c){x[a]=b;u[a]=c};m&&(A(t++,p-2,q-2),A(t++,g,q-2),A(t++,r,q-2));A(t++,g,g);A(t++,g+b,g);A(t++,r,r);A(t++,r,r);A(t++,g+b,g);A(t++,r+b,r);m&&(A(t++,g+b,q-1),A(t++,p-1,q-1),A(t++,r+b,q-1))}e={};e[k.POSITION]=x;e[k.NORMAL]=u;e[k.UV0]=x;b={};b[k.POSITION]={size:3,data:d};b[k.NORMAL]={size:3,
data:a};b[k.UV0]={size:2,data:v};return new B([{type:"triangle",indices:e,positionKey:k.POSITION}],b)},createTubeGeometry:function(a,e,b,c,d){b=b||10;c=c||!0;K.assert(1<a.length);for(var f=[],g=[],l=0;l<b;l++){f.push([0,-l-1,-((l+1)%b)-1]);var h=l/b*2*Math.PI;g.push([Math.cos(h)*e,Math.sin(h)*e])}return P.createPathExtrusionGeometry(g,a,[[0,0,0]],f,c,d)},createSquareTubeGeometry:function(a,e,b){b=b||!0;K.assert(1<a.length);e*=Math.SQRT2;return P.createPathExtrusionGeometry([[e,e],[-e,e],[-e,-e],[e,
-e]],a,[],[[-1,-2,-3],[-3,-4,-1]],b,[[0,1],[-1,0],[0,-1],[1,0]])},createPathExtrusionGeometry:function(a,e,b,c,d,m,g){var l,h=a.length,n=new Float32Array(e.length*h*3+(6*b.length||0)),p=new Float32Array(e.length*h+(2*b.length||0)),q=new Float32Array(e.length*h*3+(b?6:0)),v=0,x=0,u=0,r=new Uint32Array((e.length-1)*h*6+6*c.length),t=new Uint32Array((e.length-1)*h*6+6*c.length),w=0,E=0,A=f.create(),y=f.create(),C=f.create(),G=f.create(),K=f.create(),J=f.create(),z=f.create(),M=f.create(),D=f.create();
f.subtract(e[1],e[0],y);f.normalize(y);d?(f.add(e[0],m,D),f.normalize(D,C)):f.set3(0,1,0,C);f.cross(C,y,G);f.normalize(G);f.cross(G,y,C);f.normalize(C);for(l=0;l<b.length;l++)f.scale(G,b[l][0],z),f.scale(C,b[l][1],D),f.add(z,D),f.add(z,e[0]),n[v++]=z[0],n[v++]=z[1],n[v++]=z[2],p[u++]=0;q[x++]=-y[0];q[x++]=-y[1];q[x++]=-y[2];for(l=0;l<c.length;l++)r[w++]=0<c[l][0]?c[l][0]:-c[l][0]-1+b.length,r[w++]=0<c[l][1]?c[l][1]:-c[l][1]-1+b.length,r[w++]=0<c[l][2]?c[l][2]:-c[l][2]-1+b.length,t[E++]=0,t[E++]=0,
t[E++]=0;var H=b.length;l=b.length-1;for(var F,N=0;N<e.length;N++){F=!1;0<N&&(d?(f.add(e[N],m,D),f.normalize(D,C)):f.set3(0,1,0,C),f.set(y,A),f.set(A,D),N<e.length-1?(f.subtract(e[N+1],e[N],y),f.normalize(y),f.add(D,y)):F=!0,f.cross(C,D,G),f.normalize(G),f.cross(G,D,C),f.normalize(C));g&&(f.cross(C,y,J),f.normalize(J),f.cross(J,y,K),f.normalize(K));for(var I=0;I<h;I++)if(f.scale(G,a[I][0],z),f.scale(C,a[I][1],D),f.add(z,D),g?(f.scale(J,g[I][0],M),f.scale(K,g[I][1],D),f.add(M,D),f.normalize(M),f.scale(M,
-1)):f.normalize(z,M),q[x++]=M[0],q[x++]=M[1],q[x++]=M[2],f.add(z,e[N]),n[v++]=z[0],n[v++]=z[1],n[v++]=z[2],p[u++]=-a[I][1],!F){var L=(I+1)%h;r[w++]=H+I;r[w++]=H+h+I;r[w++]=H+L;r[w++]=H+L;r[w++]=H+h+I;r[w++]=H+h+L;if(g)for(L=0;6>L;L++)t[E++]=H-l+I;else for(L=0;6>L;L++)t[E++]=r[w-6+L]-l}H+=h}F=e[e.length-1];for(l=0;l<b.length;l++)f.scale(G,b[l][0],z),f.scale(C,b[l][1],D),f.add(z,D),f.add(z,F),n[v++]=z[0],n[v++]=z[1],n[v++]=z[2],p[u++]=0;a=x/3;q[x++]=y[0];q[x++]=y[1];q[x++]=y[2];h=H-h;for(l=0;l<c.length;l++)r[w++]=
0<=c[l][0]?H+c[l][0]:-c[l][0]-1+h,r[w++]=0<=c[l][2]?H+c[l][2]:-c[l][2]-1+h,r[w++]=0<=c[l][1]?H+c[l][1]:-c[l][1]-1+h,t[E++]=a,t[E++]=a,t[E++]=a;c={};c[k.POSITION]=r;c[k.NORMAL]=t;r={};r[k.POSITION]={size:3,data:n};r.zOffset={size:1,data:p};r[k.NORMAL]={size:3,data:q};return new B([{type:"triangle",indices:c,positionKey:k.POSITION}],r)},createPolylineGeometry:function(a,e){K.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");K.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");
for(var b=new Float32Array(3*a.length),c=new Uint32Array(2*(a.length-1)),d=0,f=0,g=0;g<a.length;g++){for(var l=0;3>l;l++)b[d++]=a[g][l];0<g&&(c[f++]=g-1,c[f++]=g)}d={};a={};d[k.POSITION]=c;a[k.POSITION]={size:3,data:b};b=[{type:"line",indices:d,positionKey:k.POSITION}];return e?{faces:b[0],vertexAttr:a,id:B.getNewId().toString()}:new B(b,a)},addVertexColors:function(a,e,b){var c,d,f;if(b){var g={};b=a.getVertexAttr();for(f in b)g[f]=b[f];a=a.getFaces();b=Array(a.length);for(d=0;d<a.length;d++){c=
{};for(f in a[d].indices)c[f]=a[d].indices[f];b[d]={type:a[d].type,indices:c,positionKey:a[d].positionKey}}a=new B(b,g)}e=e||[1,1,1,1];f=new Uint8Array(4);f[0]=255*e[0];f[1]=255*e[1];f[2]=255*e[2];f[3]=255*(3<e.length?e[3]:1);a.getVertexAttr()[k.COLOR]={size:4,data:f};b=a.getFaces();for(d=0;d<b.length;d++)e=b[d],c=new Uint32Array(e.indices[e.positionKey].length),e.indices[k.COLOR]=c;return a},addNormals:function(a){var e=a.getVertexAttr();a=a.getFaces();for(var b=Q.Vec3Compact.subtract,c=a.map(function(a){return a.indices.position.length/
3}).reduce(function(a,b){return a+b}),c=new Float32Array(3*c),d=e.position.data,f=0,g=0;g<a.length;g++){for(var l=a[g].indices.position,h=new Uint32Array(l.length),k=0;k<l.length;k+=3){b(d,3*l[k],d,3*l[k+2],S,0);b(d,3*l[k],d,3*l[k+1],F,0);O.cross(F,S);O.normalize(F);var p=f/3;c[f++]=F[0];c[f++]=F[1];c[f++]=F[2];h[k]=p;h[k+1]=p;h[k+2]=p}a[g].indices.normal=h}e.normal={size:3,data:c}}};return P});