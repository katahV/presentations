// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\n\n\x3csnippets\x3e\n\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position \x3d vec4($position.xy, 0.0, 1.0);\n    vtc \x3d $position.xy * 0.5 + 0.5;\n  }\n]]\x3e\x3c/snippet\x3e\n\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform float uToPremultiplied;\n\n  varying vec2 vtc;\n\n  void main() {\n    vec4 texColor \x3d texture2D(tex, vtc);\n\n    // optionally, convert to premultiplied\n    gl_FragColor \x3d mix(\n      texColor,\n      vec4(texColor.rgb * texColor.a, texColor.a),\n      uToPremultiplied\n    );\n  }\n\n]]\x3e\x3c/snippet\x3e\n\n\x3c/snippets\x3e\n'}});
define("require exports dojo/text!../materials/internal/offscreen.xml ./DefaultVertexAttributeLocations ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util".split(" "),function(w,x,l,m,n,p,q,r,e,t){var g={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},u={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},h=[0,0,0,0],v=[0,0,0,1];return function(){function a(b,
a){this._intermediateTexture=this._hudVisibilityTexture=null;this._enabled=!1;this._height=this._width=0;this._background={type:"plain",color:[0,0,0,1]};this._programRep=b;this._rctx=a;this._height=this._width=null}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.enable=function(){if(!this.getEnableState()){var b=this._rctx;
this._enabled=!0;this.framebuffer=q.createWithAttachments(b,g,{colorTarget:0,depthStencilTarget:b.capabilities.depthTexture?4:3});this.quadVAO=n.createQuadVAO(b)}};a.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};a.prototype.setEnableState=function(b){b?this.enable():this.disable()};Object.defineProperty(a.prototype,"background",{get:function(){return this._background},
set:function(b){this._background=b},enumerable:!0,configurable:!0});a.prototype.getEnableState=function(){return this._enabled};a.prototype.getColorTexture=function(){return this.framebuffer.colorTexture};a.prototype.getDepthTexture=function(){return a.supportsDepthTexture(this._rctx)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null};a.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture};a.supportsDepthTexture=function(b){return b.capabilities.depthTexture};
a.prototype.initializeFrame=function(b){p.assert(this.getEnableState());var a=this._rctx,c=a.gl;b=b.fullViewport;this._width=b[2];this._height=b[3];this.framebuffer.resize(this._width,this._height);a.bindFramebuffer(this.framebuffer);a.setClearStencil(0);b=this._background.color;a.setClearColor(b[0]*b[3],b[1]*b[3],b[2]*b[3],b[3]);a.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};a.prototype.renderSeparateColor=function(b,a,c){void 0===c&&(c=h);var d=this._rctx,k=d.gl;b.resize(this._width,
this._height);var e=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(b);d.bindFramebuffer(this.framebuffer);d.setClearColor(c[0],c[1],c[2],Math.max(1E-13,c[3]));d.clear(k.COLOR_BUFFER_BIT);a();k.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(e)};a.prototype.renderSeparateAndComposite=function(b,a,c){void 0===a&&(a=h);void 0===c&&(c="none");this._intermediateTexture||(this._intermediateTexture=new e(this._rctx,g));this.renderSeparateColor(this._intermediateTexture,
b,a);this.composite(this._intermediateTexture,this.framebuffer,c)};a.prototype.renderHUDVisibility=function(b){this._hudVisibilityTexture||(this._hudVisibilityTexture=new e(this._rctx,u));this.renderSeparateColor(this._hudVisibilityTexture,b,v)};a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};a.prototype.getFramebuffer=function(){return this.framebuffer};a.prototype.detachDepthTextureFromBuffer=function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;
this.framebuffer.detachDepthStencilTexture()};a.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};a.prototype.composite=function(b,a,c){void 0===b&&(b=this.framebuffer.colorTexture);void 0===a&&(a=null);void 0===c&&(c="none");var d=this._rctx,f=this._programRep.get("offscreenProgram");d.bindFramebuffer(a);d.setDepthTestEnabled(!1);d.bindProgram(f);f.setUniform1i("tex",1);d.bindTexture(b,
1);d.setBlendFunction(1,771);switch(c){case "none":f.setUniform1f("uToPremultiplied",0);d.setBlendingEnabled(!1);break;case "alpha":f.setUniform1f("uToPremultiplied",1);d.setBlendingEnabled(!0);break;case "premultiplied-alpha":f.setUniform1f("uToPremultiplied",0),d.setBlendingEnabled(!0)}d.bindVAO(this.quadVAO);d.drawArrays(5,0,t.vertexCount(this.quadVAO,"geometry"));d.setDepthTestEnabled(!0);d.setBlendingEnabled(!1)};a.loadShaders=function(a,e,c){a._parse(l);a=new r(c,a.vsOffscreenRenderer,a.fsOffscreenRenderer,
m.Default3D);e.add("offscreenProgram",a)};return a}()});