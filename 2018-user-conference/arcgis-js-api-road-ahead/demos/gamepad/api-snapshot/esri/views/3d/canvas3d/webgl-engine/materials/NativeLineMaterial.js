// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./internal/MaterialUtil","../lib/Util","../lib/gl-matrix"],function(q,x,y){var b=y.vec3d,A=y.vec2d,B=y.mat4d,D=x.VertexAttrConstants,d=b.create(),e=b.create(),n=b.create(),w=b.create(),r=A.create(),t=A.create(),m=function(z,C,c,p){"string"===typeof c&&(p=c,c=void 0);q.basicMaterialConstructor(this,p);this.lineType=c||m.LINES;var a=q.Layouts.Pos,u=a.getStride();this.canBeMerged=this.lineType===m.LINES;this.setColor=function(h){C=h};this.getColor=function(){return C};this.dispose=function(){};
this.getOutputAmount=function(h){h=h/2+1;if(this.lineType===m.STRIP)return h*u;if(this.lineType===m.LINES)return(2*h-2)*u};this.getVertexBufferLayout=function(){return a};this.fillInterleaved=function(h,k,g,b,a,d){h=h.vertexAttr[D.POSITION].data;if(k||this.lineType===m.LINES)for(b=h.length/3,g=0;g<b;g++){var l=3*g,f=h[l],e=h[l+1],c=h[l+2];if(k)var l=f,n=e,f=k[0]*l+k[4]*n+k[8]*c+k[12],e=k[1]*l+k[5]*n+k[9]*c+k[13],c=k[2]*l+k[6]*n+k[10]*c+k[14];a[d++]=f;a[d++]=e;a[d++]=c;this.lineType===m.LINES&&0!==
g&&g!==b-1&&(a[d++]=f,a[d++]=e,a[d++]=c)}else for(g=0;g<h.length;g++)a[d++]=h[g]};this.intersect=function(a,c,g,m,u,z,l,f,p,q,v){if(v){a=a.getData().getVertexAttr("position").position.data;c=Number.MAX_VALUE;var h,k;for(l=0;l<a.length-5;l+=3){d[0]=a[l];d[1]=a[l+1];d[2]=a[l+2];B.multiplyVec3(g,d);e[0]=a[l+3];e[1]=a[l+4];e[2]=a[l+5];B.multiplyVec3(g,e);p.projectPoint(d,r);p.projectPoint(e,t);if(0>r[2]&&0<t[2])b.subtract(d,e,n),f=p.frustumPlanes,v=-(b.dot(f[4],d)+f[4][3]),f=v/b.dot(n,f[4]),b.scale(n,
f,n),b.add(d,n,d),p.projectPoint(d,r);else if(0<r[2]&&0>t[2])b.subtract(e,d,n),f=p.frustumPlanes,v=-(b.dot(f[4],e)+f[4][3]),f=v/b.dot(n,f[4]),b.scale(n,f,n),b.add(e,n,e),p.projectPoint(e,t);else if(0>r[2]&&0>t[2])continue;f=x.projectVectorVector2D(r,t,m);f<c&&(c=f,h=d,k=e)}2>c&&(g=x.linelineDistance3D(h,k,u,z),m=Number.MAX_VALUE,g[0]&&(b.subtract(u,g[3],w),g=b.length(w),b.scale(w,1/g),m=.98*g/b.dist(u,z)),q(m,w))}};this.getGLMaterials=function(){return[E,void 0,void 0]};this.getAllTextureIds=function(){return[]}};
m.STRIP=1;m.LINES=2;var E=function(b,d){q.basicGLMaterialConstructor(this,b);var c=d.get("simple"),e=b.getColor();this.beginSlot=function(a){return 1===a};this.getProgram=function(){return c};this.bind=function(a,d){c.use();c.uniform4fv("color",e);b.getVertexBufferLayout().enableVertexAttribArrays(a,c);1>e[3]&&a.enable(a.BLEND)};this.release=function(a){b.getVertexBufferLayout().disableVertexAttribArrays(a,c);1>e[3]&&a.disable(a.BLEND)};this.bindView=function(a,b){q.bindView(b.origin,b.view,c)};this.bindInstance=
function(a,b){c.uniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return b.lineType===m.STRIP?a.LINE_STRIP:a.LINES}};return m});