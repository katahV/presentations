// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./IdGen","./Util","./gl-matrix"],function(C,q,D){var l=D.vec3d,E=new C,G=function F(f,h,g,x){q.assert(1<=f.length);q.assert(0===g.length%h);q.assert(g.length>=f.length*h);q.assert(3===x.size||4===x.size);var c=x.data,A=x.size,b=A*g[h*f[0]],d=l.createFrom(c[b],c[b+1],c[b+2]),t=l.create(d),e,k,w;e=0;for(w=f.length;e<w;++e){var y=h*f[e];for(k=0;k<h;++k)for(var b=A*g[y+k],m=0;3>m;++m){var n=c[b+m];n<d[m]?d[m]=n:n>t[m]&&(t[m]=n)}}var u=l.create();l.lerp(d,t,.5,u);var v=0;e=0;for(w=f.length;e<
w;++e)for(y=h*f[e],k=0;k<h;++k)b=A*g[y+k],m=c[b]-u[0],n=c[b+1]-u[1],b=c[b+2]-u[2],b=m*m+n*n+b*b,b>v&&(v=b);var v=Math.sqrt(v),z;this.getCenter=function(){return u};this.getBSRadius=function(){return v};this.getBBMin=function(){return d};this.getBBMax=function(){return t};this.getPrimitiveIndices=function(){return f};this.getIndices=function(){return g};this.getPosition=function(){return x};this.getChildren=function(){if(void 0===z&&(z="no_children",1<l.dist2(d,t))){var b=l.lerp(d,t,.5,l.create()),
c=new Uint8Array(f.length),e=Array(8),a;for(a=0;8>a;++a)e[a]=0;a=0;for(w=f.length;a<w;++a){for(var p=0,m=h*f[a],k=x.data,r=A*g[m],n=k[r],q=k[r+1],u=k[r+2],v=1;v<h;++v){var r=A*g[m+v],y=k[r],B=k[r+1],r=k[r+2];y<n&&(n=y);B<q&&(q=B);r<u&&(u=r)}n<b[0]&&(p|=1);q<b[1]&&(p|=2);u<b[2]&&(p|=4);c[a]=p;++e[p]}for(a=p=0;8>a;++a)0<e[a]&&++p;if(2>p)return;b=Array(8);for(a=0;8>a;++a)b[a]=0<e[a]?new Uint32Array(e[a]):void 0;for(a=0;8>a;++a)e[a]=0;a=0;for(w=c.length;a<w;++a)p=c[a],b[p][e[p]++]=f[a];z=Array(8);for(a=
0;8>a;++a)void 0!==b[a]&&(z[a]=new F(b[a],h,g,x))}if("no_children"!==z)return z}};return function(l,f,h){var g=E.gen(f);this.getId=function(){return g};this.metadata=void 0;this.singleUse=!1;q.assert(1<=l.getFaces().length);h=h||[];this.getData=function(){return l};this.getNumGroups=function(){return l.getFaces().length};this.getBoundingInfo=function(f){var c=h[f];if(void 0===c){var c=l.getFaces()[f],g="triangle"===c.type?3:1,b=c.indices[c.positionKey],d;if(0===b.length)for(b=new Uint32Array(g),d=
0;d<g;++d)b[d]=d;d=b.length;q.assert(0===d%g);var t=d/g,e=new Uint32Array(t);for(d=0;d<t;++d)e[d]=d;c=new G(e,g,b,l.getVertexAttr()[c.positionKey]);h[f]=c}return c};this.invalidateBoundingInfo=function(){h=[]}}});