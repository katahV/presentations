// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["dojo/_base/lang","./Util","../lib/GLSLProgram","../lib/GLSLShader"],function(t,u,y,w){var h=u.assert,z=function(h,p){return h+p.toString()};return function(u,p,m,x,g,A,B){h(2===p.length,"you must specify shader snippet prefixes for vertex and fragment shaders");m&&0!==m.length?Array.isArray(m[0])||(m=[m,m]):m=[[],[]];var n=[],q=!1,r={},v={};this.addDefine=function(a,k,c,l){h(!q,"you cannot add another variable after the first program has been generated");h(a,"you must specify a program name suffix");
n.push({programNameSuffixes:["",a],shaderNameSuffixes:l||a,defineStr:k,affectsShaderTypes:c||[!0,!0]})};this.addBinaryShaderSnippetSuffix=function(a,k,c){h(!q,"you cannot add another variable after the first program has been generated");h(a,"you must specify a program name suffix");n.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",k],affectsShaderTypes:c||[!0,!0]})};this.addNaryShaderSnippetSuffix=function(a,k){h(!q,"you cannot add another variable after the first program has been generated");
var c=a.map(function(a){h(null!=a.value,"value must always be specified");return a.value});n.push({values:c,programNameSuffixes:a.map(function(a,d){return null!=a.programNameSuffix?a.programNameSuffix:c[d]}),shaderSnippetSuffixes:a.map(function(a,d){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:c[d]}),affectsShaderTypes:k||[!0,!0]})};this.getShaderVariation=function(a){h(a.length===n.length,"you must specify a value for each variable");for(var k=u,c=t.clone(p),l=t.clone(p),d=t.clone(m),
e=0;e<n.length;e++){var f=n[e],b=a[e],g;f.values?(g=f.values.indexOf(b),h(0<=g,"invalid value "+b+" for variable "+e)):g=b?1:0;k+=f.programNameSuffixes[g];for(b=0;2>b;b++)f.affectsShaderTypes[b]&&(f.shaderSnippetSuffixes&&(c[b]+=f.shaderSnippetSuffixes[g],l[b]+=f.shaderSnippetSuffixes[g]),f.defineStr&&g&&(d[b].push(f.defineStr),l[b]+=f.shaderNameSuffixes))}return{programName:k,shaderSnippetNames:c,shaderNames:l,defines:d}};this.getProgram=function(a,k,c){k=k||A;c=c||B;q=!0;var l=a.reduce(z,"");if(v[l])return v[l];
a=this.getShaderVariation(a);var d=x.get[a.programName];if(d)return d;var e,f,b=a.shaderNames[0],d=r[b]||g&&g.shaders[b];d||(e=a.shaderSnippetNames[0],f=k[e],h(null!=f,"shader snippet '"+e+"' does not exist"),d=new w(c.VERTEX_SHADER,f,c,a.defines[0]),r[b]=d,g&&g.add(b,d));b=a.shaderNames[1];e=r[b]||g&&g.shaders[b];e||(e=a.shaderSnippetNames[1],f=k[e],h(null!=f,"shader snippet '"+e+"' does not exist"),e=new w(c.FRAGMENT_SHADER,f,c,a.defines[1]),r[b]=e,g&&g.add(b,e));d=new y([d,e],c);v[l]=d;x.add(a.programName,
d);return d}}});