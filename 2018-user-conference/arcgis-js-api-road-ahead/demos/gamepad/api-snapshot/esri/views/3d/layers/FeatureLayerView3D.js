// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Evented ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/support/controllerUtils ../../../layers/graphics/sources/MemorySource ./FeatureLikeLayerView3D ../../layers/RefreshableLayerView".split(" "),
function(n,q,r,f,D,k,l,t,u,v,w,m,p,d,x,y,z,A){q=function(g){function a(b){return g.call(this)||this}r(a,g);e=a;Object.defineProperty(a.prototype,"controllerTypeForSource",{get:function(){return this.layer.source&&this.layer.source.isInstanceOf&&this.layer.source.isInstanceOf(y)?"memory":"point"===this.layer.geometryType?"feature-tile-3d":"snapshot"},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"suspendResumeExtentMode",{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)return this.controller.suspendResumeExtentMode;
switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return"data";case "memory":case "snapshot":return"computed"}},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayLimitExceeded",{get:function(){return this.controller&&"feature-tile-3d"===this.controller.type?!(this.suspended||!this.controller.displayLimitExceeded):!1},enumerable:!0,configurable:!0});a.prototype.createController=function(){return l(this,void 0,void 0,function(){var b;
return k(this,function(a){switch(a.label){case 0:b=this.controllerTypeForSource;switch(b){case "memory":return[3,1];case "snapshot":return[3,3];case "feature-tile-3d":return[3,5]}return[3,7];case 1:return[4,this.createMemoryController()];case 2:return[2,a.sent()];case 3:return[4,this.createSnapshotController()];case 4:return[2,a.sent()];case 5:return[4,this.createFeatureTileController()];case 6:return[2,a.sent()];case 7:return[3,8];case 8:return[2]}})})};a.prototype.createMemoryController=function(){return l(this,
void 0,void 0,function(){var b;return k(this,function(a){switch(a.label){case 0:return[4,m.create(function(a){n(["../../../layers/graphics/controllers/MemoryController"],a)})];case 1:return b=a.sent(),[2,new b({layerView:this,layer:this.layer,graphics:this.layer.source})]}})})};a.prototype.createFeatureTileController=function(){return l(this,void 0,void 0,function(){var a=this,h,c;return k(this,function(b){switch(b.label){case 0:return[4,m.create(function(a){n(["../../../layers/graphics/controllers/FeatureTileController3D"],
a)})];case 1:return h=b.sent(),c=new h({layerView:this,graphics:new B,displayFeatureLimit:C}),this.handles.add([c.watch("suspendResumeExtentMode",function(){return a.notifyChange("suspendResumeExtentMode")},!0),c.watch("displayLimitExceeded",function(){return a.notifyChange("displayLimitExceeded")},!0)]),this.handles.add(p.init(c,"dataExtent",function(b){return a.graphics3d.dataExtent=b})),this.handles.add(p.init(this,"suspended",function(a){a?c.suspend():c.resume()},!0)),[2,c]}})})};a.prototype.createSnapshotController=
function(){return l(this,void 0,void 0,function(){var a,h,c;return k(this,function(b){switch(b.label){case 0:return this.addResolvingPromise(this.validateMaximumFeatureCount()),[4,m.create(function(a){n(["../../../layers/graphics/controllers/SnapshotController"],a)})];case 1:return a=b.sent(),h=u.ofType(t),c=new a({layerView:this,layer:this.layer,graphics:new h,maxPageSize:300}),[4,c.when()];case 2:return b.sent(),this.handles.add(p.whenFalseOnce(this,"suspended",function(){c.startup()})),[2,c]}})})};
a.prototype.validateMaximumFeatureCount=function(){return 0>e.maximumFeatureCount||!this.layer.url?m.resolve():this.layer.queryFeatureCount().then(function(a){if(a>e.maximumFeatureCount)throw new v("featurelayerview3d:maximum-feature-count-exceeded","The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",{maximumFeatureCount:e.maximumFeatureCount,numberOfFeatures:a});})};a.prototype.doRefresh=function(){!this.suspended&&x.isRefreshable(this.controller)&&
this.controller.refresh()};a.maximumFeatureCount=-1;f([d.property()],a.prototype,"layer",void 0);f([d.property()],a.prototype,"controller",void 0);f([d.property({readOnly:!0,dependsOn:["layer"]})],a.prototype,"controllerTypeForSource",null);f([d.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],a.prototype,"suspendResumeExtentMode",null);f([d.property({dependsOn:["suspended","controller"]})],a.prototype,"displayLimitExceeded",null);return a=e=f([d.subclass("esri.views.3d.layers.FeatureLayerView3D")],
a);var e}(d.declared(z,A));var B=function(g){function a(){var a=null!==g&&g.apply(this,arguments)||this;a.items=new Set;return a}r(a,g);e=a;Object.defineProperty(a.prototype,"length",{get:function(){return this.items.size},enumerable:!0,configurable:!0});a.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this.items.add(a[b]);this.emit("change",{added:a,removed:[],moved:[]})};a.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.items.delete(a[b]);this.emit("change",{added:[],
removed:a,moved:[]});return a};a.prototype.removeAll=function(){var a=this.toArray();this.emit("change",{added:[],removed:a,moved:[]})};a.prototype.toArray=function(){var a=[];this.items.forEach(function(b){return a.push(b)});return a};a.prototype.forEach=function(a){this.items.forEach(a)};a.prototype.some=function(a){return this.toArray().some(a)};a.prototype.find=function(a){var b=null;this.forEach(function(c){!b&&a(c)&&(b=c)});return b};a.prototype.filter=function(a){var b=new e;this.forEach(function(c){a(c)&&
b.items.add(c)});return b};return a=e=f([d.subclass("esri.views.3d.layers.FeatureLayerView3D.SetCollection")],a);var e}(d.declared(w)),C={min:3E3,max:5E4,perTile:1E4};return q});