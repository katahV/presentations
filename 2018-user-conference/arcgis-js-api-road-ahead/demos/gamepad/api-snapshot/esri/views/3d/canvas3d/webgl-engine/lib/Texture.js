// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./IdGen","./Util","./GLUtil","./DDSUtil"],function(c,m,k,n){var l=new c,r=function(c,g,b,p,h,f,e,q){e=!1!==e;var d=new Image;d.src=c;d.onerror=function(){f();d.onerror=void 0;d.onload=void 0};d.onload=function(){b.isTexture(g)&&k.texImage2D(d,g,b,p,h,e,!0,q);f();d.onerror=void 0;d.onload=void 0}};c=function g(b,c,h){var f=l.gen(c),e;this.getId=function(){return f};this.params=h||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=
this.params.noUnpackFlip||!1;this.estimatedTexMemRequiredMB=null==b?0:b.byteLength?b.byteLength/1E6:1.3*this.params.width*this.params.height*4/1E6;this.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};this.dispose=function(){b=void 0};this.deferredLoading=function(){return"string"===typeof b};this.getWidth=function(){return this.params.width};this.getHeight=function(){return this.params.height};this.loadGl=function(c,d,a,e,f){"string"===typeof b?r(b,d,a,e,f,c,this.params.mipmap,
this.params.noUnpackFlip):b instanceof Image||b instanceof ImageData||b instanceof HTMLCanvasElement?(this.params.width=b.width,this.params.height=b.height,k.texImage2D(b,d,a,e,f,this.params.mipmap,this.params.mipmap||!this.params.wrapClamp,this.params.noUnpackFlip)):b&&(this.params.encoding===g.DDS_ENCODING?(c=n.uploadDDSLevels(a,b,!0),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<c.mipmapCount?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),this.params.width=
c.width,this.params.height=c.height):(!0===this.params.noUnpackFlip&&a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),m.assert(this.params.width&&this.params.height),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.params.width,this.params.height,0,a.RGBA,a.UNSIGNED_BYTE,b),this.params.mipmap?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),!0===this.params.noUnpackFlip&&a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
!0)));a._isTracingEnabled&&(d._debugTracingType="Texture");b=void 0};this.setUnloadFunc=function(b){e=b};this.unload=function(){void 0!==e&&(e(f),e=void 0)}};c.__idGen=l;c.DDS_ENCODING="image/vnd-ms.dds";return c});