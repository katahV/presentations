// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./Util"],function(l){return function(m,f){function h(a){a.updateVisibility();a.updateParameters&&a.updateParameters()}var c={},n=function(a){var b=0;this.incRefCnt=function(){++b};this.decRefCnt=function(){--b;l.assert(0<=b)};this.getRefCnt=function(){return b};this.getGLMaterial=function(){return a}};this.aquire=function(a){return g(a,0,c)};this.aquireDepthShadowMap=function(a){return g(a,1,c)};this.aquireDepth=function(a){return g(a,3,c)};this.aquireNormal=function(a){return g(a,2,c)};
var g=function(a,b,e){var d=a.getId();1===b?d+="_depthShadowMap":2===b?d+="_normal":3===b&&(d+="_depth");var c=e[d];void 0===c?(a=(c=a.getGLMaterials()[b])?new c(a,f,m):void 0,c=new n(a),e[d]=c):a=c.getGLMaterial();c.incRefCnt();if(a)if(e=a,e.getAllPrograms)for(e=e.getAllPrograms(),d=0;d<e.length;d++)f.increaseRefCount(e[d]);else f.increaseRefCount(e.getProgram());return a};this.release=function(a){k(a)};this.releaseDepth=function(a){k(a+"_depth")};this.releaseNormal=function(a){k(a+"_normal")};var k=
function(a){var b=c[a];b.decRefCnt();if(0===b.getRefCnt()){if(b=b.getGLMaterial()){if(b.getAllPrograms)for(var e=b.getAllPrograms(),d=0;d<e.length;d++)f.decreaseRefCount(e[d]);else f.decreaseRefCount(b.getProgram());void 0!==b.dispose&&b.dispose()}delete c[a]}};this.updateMaterialParameters=function(a){var b=c[a];b&&b.getGLMaterial()&&h(b.getGLMaterial());(b=c[a+"_depth"])&&b.getGLMaterial()&&h(b.getGLMaterial());(a=c[a+"_normal"])&&a.getGLMaterial()&&h(a.getGLMaterial())}}});