// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("./Renderer ./ShadowMap ./GLFBO ./GLVBO ./VertexBufferLayout ./Camera ./Util ./gl-matrix ../materials/internal/TexOnlyGLMaterial".split(" "),function(u,v,w,C,D,x,y,h,E){var z=h.vec3,m=h.mat4d;return function(a,h,n,A,p,q){var g={},r=[0,0,0,0],f=new u(n,void 0,A,p,a,!0),t=new v(n,a);f.setLightingData({ambient:[1,1,1,1],diffuse:[0,0,0,0],specular:[0,0,0,0],direction:[0,-1,0]});var B={get:function(){return!0}};this.dispose=function(){for(var a in g)g[a].fbo.dispose(),p.release(a);g=null;f.dispose();
f=null};this.addRenderGeometries=function(a){a.forEach(function(a){if(null==a.origin){var c=a.center,b=0,d=10*a.bsRadius/1E4;1<d&&(b=Math.ceil(y.logWithBase(d,2)));var d=1E4*Math.pow(2,b),f=Math.round(c[0]/d),e=Math.round(c[1]/d),c=Math.round(c[2]/d),b=b+"_"+f+"_"+e+"_"+c,g=l[b];void 0===g&&(g={vec3:z.createFrom(f*d,e*d,c*d),id:b},l[b]=g);a.origin=g}});f.modify(a,[])};this.removeRenderGeometries=function(a){f.modify([],a)};this.updateRenderGeometries=function(a,e){a=a.map(function(a){return{renderGeometry:a,
updateType:e}});f.modify([],[],a,[])};this.updateRenderOrder=function(a){0<Object.keys(a).length&&f.modifyRenderOrder(a)};this.setBackgroundColor=function(a){r=a};this.isEmpty=function(){return f.isEmpty()};var e=new x;this.draw=function(d,k){var c=q.getDirtyMaterials();c&&f.modify([],[],[],c);q.clearDirtyMaterials();var c=d.getId(),b;if(g[c])d=g[c].fbo;else{b=p.aquire(c);d=new w(a.RGBA,a.UNSIGNED_BYTE,!1,a.NEAREST,a,b);var l=Object.keys(g).length;g[c]={glName:b,fbo:d,idx:l}}c=k.width;b=k.height;
if(d.getWidth()!==c||d.getHeight()!==b)d.setSize(c,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);e.near=1;e.far=1E4;d.bind();a.disable(a.DEPTH_TEST);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);a.clearColor.apply(a,r);a.clear(a.COLOR_BUFFER_BIT);t.bindAll(n);f.setPixelRatio(k.pixelRatio||1);for(c=0;c<k.views.length;c++)b=k.views[c],e.viewport=b.viewport,m.ortho(0,b.maxWebMerc[0]-b.minWebMerc[0],
0,b.maxWebMerc[1]-b.minWebMerc[1],e.near,e.far,e.projectionMatrix),m.identity(e.viewMatrix),m.translate(e.viewMatrix,[-b.minWebMerc[0],-b.minWebMerc[1],0]),e.setGLViewport(a),f.render(e,B,t,d);a.enable(a.DEPTH_TEST);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.bindFramebuffer(a.FRAMEBUFFER,null);a.viewport(0,0,h.width,h.height)};var l={}}});