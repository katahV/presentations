// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../renderers ../../../../../core/Accessor ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/diffUtils ../../../engine/webgl/rendererInfoUtils ../../../engine/webgl/visualVariablesUtils ../../../engine/webgl/WGLFeatureView ../../../engine/webgl/WGLTile ./BaseTileRenderer".split(" "),function(g,h,n,p,e,q,k,l,f,m,r,t,u){function v(d){for(var c in d.diff){var a=
d.diff[c];if("collection"===a.type){if(0!==a.changed.length||0!==a.added.length||0!==a.removed.length)return!0}else if("visualVariables"!==c&&"authoringInfo"!==c)return!0}return!1}Object.defineProperty(h,"__esModule",{value:!0});g=function(d){function c(a){return d.call(this)||this}n(c,d);c.prototype.initialize=function(){};c.prototype.createTile=function(a){var b=[0,0,0,0];this.tileInfoView.getTileBounds(b,a);return new t(a,b)};c.prototype.disposeTile=function(a){this._featuresView.removeChild(a)};
c.prototype.highlight=function(a){return this._featuresView.highlight(a)};c.prototype.hitTest=function(a,b){return this._featuresView.hitTest(a,b)};c.prototype.supportsRenderer=function(a){return f.isRendererWebGLCompatible(a)};c.prototype.getProcessorConfiguration=function(){var a=this.layer;return{type:"symbol",renderer:a.renderer.toJSON(),devicePixelRatio:window.devicePixelRatio||1,definitionExpression:a.definitionExpression,outFields:a.outFields.slice().sort(),gdbVersion:a.gdbVersion,historicMoment:a.historicMoment&&
a.historicMoment.getTime()}};c.prototype.needsReconfiguration=function(a){var b=this.configuration;if(!b||b.definitionExpression!==a.definitionExpression||b.outFields.join()!==a.outFields.join())return!0;b=this.configuration&&e.fromJSON(this.configuration.renderer)||null;a=a&&e.fromJSON(a.renderer)||null;b=l.diff(b,a);if(!b)return!1;switch(b.type){case "complete":return!0;case "partial":if(v(b))return!0;if(b.diff.visualVariables){var b=this._featuresView.visualVariablesInfo,c=this.tileInfoView.tileInfo.spatialReference,
d={fields:this.layer.fields.map(function(a){return a.toJSON()})};a=f.getNormalizedRenderer(a,c,d);a=m.convertVisualVariables(a.visualVariables).vvFields;return l.diff(b.vvFields,a)?!0:!1}}};c.prototype.applyConfiguration=function(a){if(this.needsReconfiguration(a))for(var b=0,c=this._featuresView.children.slice();b<c.length;b++){var d=c[b];this._featuresView.removeChild(d);d.attached=!1;this._featuresView.addChild(d)}b=e.fromJSON(a.renderer);c={fields:this.layer.fields.map(function(a){return a.toJSON()})};
b=f.getNormalizedRenderer(b,this.tileInfoView.tileInfo.spatialReference,c);this.configuration=a;this._featuresView.visualVariablesInfo=m.convertVisualVariables(b.visualVariables)};c.prototype.install=function(a){var b=new r.default({highlightOptions:this.highlightOptions,tileInfoView:this.tileInfoView});this._featuresView=b;b.install(a)};c.prototype.uninstall=function(a){this._featuresView.uninstall(a)};c.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);b&&(this._featuresView.onTileData(b,
a.data),this.requestUpdate())};c.prototype.onTileUpdate=function(a){var b=this.tiles.get(a.tileKey);b&&(this._featuresView.onTileUpdate(b,a.data),this.requestUpdate())};c.prototype.onTileError=function(a){if(a=this.tiles.get(a.tileKey))this._featuresView.onTileError(a),this.requestUpdate()};c.prototype.getMaterialItems=function(a){return this._featuresView.getMaterialItems(a)};return c=p([k.subclass()],c)}(k.declared(q,u.default));h.default=g});