// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/features/controllers":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","../../../../core/Error","../../../../core/promiseUtils"],function(g,b,e,c,a){Object.defineProperty(b,"__esModule",{value:!0});b.getControllerConfiguration=function(d){var r=d.source;return d.capabilities.operations.supportsQuery?r&&"esri.layers.graphics.sources.CSVSource"===r.declaredClass?a.resolve().then(function(){return{type:"memory",processing:d.processing&&
d.processing.toWorker()||null}}):a.resolve({type:"on-demand",gdbVersion:d.gdbVersion,historicMoment:d.historicMoment&&d.historicMoment.getTime(),processing:d.processing&&d.processing.toWorker()||null}):a.reject(new c("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:d}))};b.createController=function(d,c){return("memory"===d?a.create(function(a){return g(["./controllers/MemoryController"],a)}):a.create(function(a){return g(["./controllers/OnDemandController"],
a)})).then(function(a){return a.default}).then(function(a){return new a(e({},c.serviceAndViewInfo,{tileStore:c.tileStore,remoteClient:c.remoteClient}))})}})},"esri/views/2d/layers/features/tileRenderers":function(){define("require exports dojo/has ../../../../core/nextTick ../../../../core/promiseUtils ../../engine/webgl/rendererInfoUtils".split(" "),function(g,b,e,c,a,d){Object.defineProperty(b,"__esModule",{value:!0});b.createOrReuseTileRenderer=function(b,p,h){if(b&&b.supportsRenderer(p))return a.create(function(a){return c(function(){return a(b)})});
var f=h.layer,f=e("esri-webgl")&&e("esri-featurelayer-webgl")&&d.isRendererWebGLCompatible(p)&&f.capabilities.query.supportsQuantization;switch(p.type){case "class-breaks":case "simple":case "unique-value":if(f)return a.create(function(a){c(function(){return g(["./tileRenderers/SymbolTileRenderer"],a)})}).then(function(a){return a.default}).then(function(a){return new a(h)});break;case "heatmap":return a.create(function(a){c(function(){return g(["./tileRenderers/HeatmapTileRenderer"],a)})}).then(function(a){return a.default}).then(function(a){return new a(h)})}return a.resolve(null)}})},
"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/Accessor ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/throttle ../../../../core/workers ../../../../core/accessorSupport/decorators ../../../../tasks/support/FeatureSet ./util module".split(" "),
function(g,b,e,c,a,d,r,p,h,f,m,q,n,t,u,v){Object.defineProperty(b,"__esModule",{value:!0});a=function(a){function b(l){l=a.call(this,l)||this;l.tileRenderer=null;l.setViewState=m.throttle(l.setViewState,50,l);return l}e(b,a);b.prototype.initialize=function(){var a=this;this.addResolvingPromise(q.open(f.getAbsMid("../features/Pipeline",g,v),{client:this.client,strategy:"dedicated"}).then(function(b){a._connection=b;return a._getStartupOptions(a.layer,a.tileInfo)}).then(function(b){return Array.isArray(b.service.source)?
a._connection.invoke("startup",b,b.service.source):a._connection.invoke("startup",b)}))};b.prototype.destroy=function(){this._connection&&this._connection.close()};b.prototype.configure=function(a){return this._connection.invoke("configure",a)};b.prototype.refresh=function(){return this._connection.invoke("controller.refresh")};b.prototype.registerTile=function(a){return this._connection.invoke("registerTile",a.id)};b.prototype.unregisterTile=function(a){return this._connection.invoke("unregisterTile",
a.id)};b.prototype.setViewState=function(a){return this._connection.invoke("controller.setViewState",a.toJSON())};b.prototype.queryFeatures=function(a){return this._connection.invoke("controller.queryFeatures",a.toJSON()).then(function(a){return t.fromJSON(a)}).then(function(a){return a&&a.features})};b.prototype.queryObjectIds=function(a){return this._connection.invoke("controller.queryObjectIds",a.toJSON())};b.prototype.queryFeatureCount=function(a){return this._connection.invoke("controller.queryFeatureCount",
a.toJSON())};b.prototype.queryExtent=function(a){return this._connection.invoke("controller.queryExtent",a.toJSON()).then(function(a){return{count:a.count,extent:d.Extent.fromJSON(a.extent)}})};b.prototype._getStartupOptions=function(a,b){var c=a.source;return c&&"esri.layers.graphics.sources.CSVSource"===c.declaredClass?c.openPorts().then(function(c){return{service:{capabilities:a.capabilities,fields:a.fields.map(function(a){return a.toJSON()}),fullExtent:a.fullExtent.toJSON(),geometryType:u.toJSONGeometryType(a.geometryType),
objectIdField:a.objectIdField,source:c},tileInfo:b.toJSON()}}):h.resolve({service:{capabilities:a.capabilities,fields:a.fields.map(function(a){return a.toJSON()}),fullExtent:a.fullExtent.toJSON(),geometryType:u.toJSONGeometryType(a.geometryType),objectIdField:a.objectIdField,source:a.url+"/"+a.layerId},tileInfo:b.toJSON()})};c([n.property({constructOnly:!0})],b.prototype,"client",void 0);c([n.property({constructOnly:!0})],b.prototype,"layer",void 0);c([n.property({constructOnly:!0})],b.prototype,
"tileInfo",void 0);c([n.property()],b.prototype,"tileRenderer",void 0);return b=c([n.subclass()],b)}(n.declared(r,p));b.default=a})},"esri/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(g,b,e){function c(a,b){if(Array.isArray(b)){var d=new e;a(b,function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];d.resolve(a)});return d.promise}return c(a,[b]).then(function(a){return a[0]})}Object.defineProperty(b,"__esModule",{value:!0});b.when=c;b.getAbsMid=
function(a,b,c){return b.toAbsMid?b.toAbsMid(a):c.id.replace(/\/[^\/]*$/gi,"/")+a}})},"esri/core/throttle":function(){define(["require","exports"],function(g,b){function e(b,a,d,e){var c=null,h=1E3;"number"===typeof a?(h=a,e=d):(c=a,h=d);var f=0,g,q=function(){f=0;b.apply(e,g)};a=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c&&c.apply(e,a);g=a;h?f||(f=setTimeout(q,h)):q()};a.remove=function(){f&&(clearTimeout(f),f=0)};a.forceUpdate=function(){f&&(clearTimeout(f),q())};a.hasPendingUpdates=
function(){return!!f};return a}Object.defineProperty(b,"__esModule",{value:!0});b.throttle=e;b.default=e})},"esri/views/2d/layers/support/util":function(){define(["require","exports","../../../../core/kebabDictionary"],function(g,b,e){Object.defineProperty(b,"__esModule",{value:!0});var c=e({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});b.toJSONGeometryType=function(a){return c.toJSON(a)}})},
"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/paramHelper ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ../../../layers/support/TileInfo ../../../tasks/support/Query ../engine/DOMContainer ./LayerView2D ./features/controllers ./features/tileRenderers ./support/FeatureLayerProxy ../tiling/TileInfoView ../tiling/TileStrategy ../../layers/RefreshableLayerView".split(" "),function(g,
b,e,c,a,d,r,p,h,f,m,q,n,t,u,v,w,x,l,y,z,A){function B(a){return a&&a.highlight}var C=q.ensureType(t);return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._pipelineIsUpdating=!0;b.container=new u;return b}e(b,a);b.prototype.destroy=function(){this._proxy.destroy()};b.prototype.initialize=function(){var a=this,b=this._tileInfo=n.create({spatialReference:this.view.spatialReference,size:512});this._tileInfoView=new y(b);this._tileStrategy=new z({cachePolicy:"purge",acquireTile:function(b){return a._acquireTile(b)},
releaseTile:function(b){return a._releaseTile(b)},tileInfoView:this._tileInfoView});this._proxy=new l.default({layer:this.layer,tileInfo:b,client:{executeProcessing:function(b){var k=a.layer.processing;return k?(b=k.process(b.featureSet,b.query,k.options))?b:h.reject(new p("FeatureLayer","invalid processing.process() method, returns nothing")):b.featureSet},setUpdating:function(b){a._pipelineIsUpdating=b;a.notifyChange("updating")}}});this.addResolvingPromise(h.all([w.getControllerConfiguration(this.layer),
this._proxy.when()]).then(function(a){return a[1].configure({controller:a[0]})}))};Object.defineProperty(b.prototype,"numFeatures",{get:function(){var a=0;this.attached?this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:0}):0;return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderingConfigHash",{get:function(){if(!this.layer)return null;var a=this.layer,b=a.renderer;return JSON.stringify({definitionExpression:a.definitionExpression,
historicMoment:a.historicMoment,outFields:a.outFields.slice().sort(),renderer:b})},enumerable:!0,configurable:!0});b.prototype.highlight=function(a,b){var k=this,c;a instanceof d?c=[a.getAttribute(this.layer.objectIdField)]:"number"===typeof a?c=[a]:r.isCollection(a)?c=a.map(function(a){return a&&a.getAttribute(k.layer.objectIdField)}).toArray():Array.isArray(a)&&0<a.length&&(c="number"===typeof a[0]?a:a.map(function(a){return a&&a.getAttribute(k.layer.objectIdField)}));return(c=c.filter(function(a){return null!=
a}))&&c.length&&B(this.tileRenderer)?this.tileRenderer.highlight(c):{remove:function(){}}};b.prototype.hitTest=function(a,b){var k=this;return this.suspended||!this.tileRenderer?h.resolve(null):this.tileRenderer.hitTest(a,b).then(function(a){return 0===a.length?null:k._proxy.queryFeatures(new t({objectIds:a,outSpatialReference:k.view.spatialReference,returnGeometry:!0})).then(function(a){a=a[0];a.layer=k.layer;a.sourceLayer=k.layer;a.geometry&&(a.geometry.spatialReference=k.view.spatialReference);
return a})})};b.prototype.queryFeatures=function(a){var b=this;return this._proxy.queryFeatures(this._cleanUpQuery(a)).then(function(a){a.forEach(function(a){a.layer=b.layer;a.sourceLayer=b.layer});return a})};b.prototype.queryObjectIds=function(a){return this._proxy.queryObjectIds(this._cleanUpQuery(a))};b.prototype.queryFeatureCount=function(a){return this._proxy.queryFeatureCount(this._cleanUpQuery(a))};b.prototype.queryExtent=function(a){return this._proxy.queryExtent(this._cleanUpQuery(a))};
b.prototype.update=function(a){this.attached&&this._tileStrategy&&this.tileRenderer&&(this._tileStrategy.update(a),this._proxy.setViewState(a.state),this.notifyChange("numFeatures"),this.notifyChange("updating"))};b.prototype.attach=function(){var a=this;this.handles.add(f.init(this,"renderingConfigHash",function(){var b=a._tileRendererPromise=x.createOrReuseTileRenderer(a.tileRenderer,a.layer.renderer,{layerView:a,tileInfoView:a._tileInfoView,layer:a.layer,highlightOptions:a.view.highlightOptions}).then(function(c){a._tileRendererPromise===
b&&(a._tileRendererPromise=null,a.tileRenderer!==c&&(a.tileRenderer&&a.tileRenderer.uninstall(a.container),(a.tileRenderer=a._proxy.client.tileRenderer=c)&&c.install(a.container)),c=c.getProcessorConfiguration(),a.tileRenderer.needsReconfiguration(c)?(a.tileRenderer.applyConfiguration(c),a._proxy.configure({processor:c}),a.requestUpdate()):a.tileRenderer.applyConfiguration(c))},function(){return a._tileRendererPromise=null})}),this)};b.prototype.detach=function(){this.container.removeAllChildren();
this.handles.remove(this);this._tileRendererPromise=null;this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)};b.prototype.moveStart=function(){this.requestUpdate()};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.moveEnd=function(){this.requestUpdate()};b.prototype.doRefresh=function(){this._proxy.refresh()};b.prototype.isUpdating=function(){return null==this.tileRenderer||
this._pipelineIsUpdating||this.tileRenderer.updating};b.prototype._cleanUpQuery=function(a){a=a?C(a):new t;a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};b.prototype._acquireTile=function(a){var b=this,c=this.tileRenderer.acquireTile(a);c.once("attach",function(){b.requestUpdate()});this._proxy.registerTile(a);return c};b.prototype._releaseTile=function(a){this._proxy.unregisterTile(a.key);this.tileRenderer.releaseTile(a)};c([m.property()],b.prototype,"numFeatures",
null);c([m.property({dependsOn:["layer.renderer","layer.outFields","layer.definitionExpression","layer.historicMoment"]})],b.prototype,"renderingConfigHash",null);c([m.property()],b.prototype,"tileRenderer",void 0);c([m.property({dependsOn:["tileRenderer.updating"]})],b.prototype,"updating",void 0);return b=c([m.subclass("esri.views.2d.layers.AutoFeatureLayerView2D")],b)}(m.declared(v,A))});