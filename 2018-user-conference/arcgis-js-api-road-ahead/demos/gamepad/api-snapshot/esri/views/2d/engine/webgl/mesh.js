// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix/mat2d ../../../../core/libs/gl-matrix/vec2 ../../../../core/libs/libtess/libtess ./color ./enums ./lineMeshUtil ./MeshData ./number ./TileClipper ./Utils ./visualVariablesUtils".split(" "),function(P,Q,Ba,R,Ca,ea,S,g,T,Da,wb,Wa,a,xb,Xa,yb){function Ya(r,p,c,d,l,g,q){d=c.slice(d,l);c=r.length/(q.length+1);g=Ca(d,g,2);l=g.length;if(0>=l)return 0;for(var n=0;n<d.length;)r.push(a.i1616to32(d[n++],
d[n++])),r.push.apply(r,q);for(r=0;r<l;)p.push(g[r++]+c,g[r++]+c,g[r++]+c)}Object.defineProperty(Q,"__esModule",{value:!0});var zb=3.14159265359/180,d=S.create(),q=ea.create(),l=[],V=[],t,Ab=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new g.GluTesselator;this.glu.gluTessCallback(g.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_END,
this._endcallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));this.glu.gluTessProperty(g.gluEnum.GLU_TESS_WINDING_RULE,g.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,c){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=
this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=c};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};a.prototype.addVertex=function(a,c){this.glu.gluTessVertex(a,c)};a.prototype._vertexCallback=function(a,c){c[c.length]=a[0];c[c.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=
0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){};a.prototype._combinecallback=function(a,
c,d){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(a){};return a}();P=Ba("esri-featurelayer-webgl");var Za="libtess"===(P&&P.tesselator||"libtess"),x;Q.createTextMesh=function(a,d,c,g,l,q,t){return null};Q.createMesh=function(g,p,c,fa,P,Q,U,n,f,$a){switch(P){case Da.WGLGeometryType.MARKER:var r=new Wa,W,X,ga,ha,ab=0,bb=0,L,B,C,D,ia,M=p.heatmapInfo;if(M){var cb=Math.round(p.heatmapInfo.radius);X=W=0;ha=ga=cb;L=[1,1,1,1];B=[0,0,0,0];D=C=cb;ia=0}else{var ja=fa.spriteMosaicItem;W=Math.round(ja.rect.x/
4);X=Math.round(ja.rect.y/4);ga=W+Math.round(ja.rect.width/4);ha=X+Math.round(ja.rect.height/4);var ab=Math.round(U*R.pt2px(f.xoffset|0)),bb=Math.round(U*R.pt2px(f.yoffset|0)),Ba=f.color?f.color:[0,0,0,0];L=Xa.isPictureSymbol(f)?[255,255,255,255]:T.copyAndPremultiply(Ba);C=Math.round(U*R.pt2px(f.width||f.size));D=Math.round(U*R.pt2px(f.height||f.size));f.outline?(B=null!=f.outline.color?T.copyAndPremultiply(f.outline.color):[0,0,0,0],ia=null!=f.outline.width?Math.round(R.pt2px(f.outline.width)):0):
(B=[0,0,0,0],ia=0)}ea.identity(q);f.angle&&ea.rotate(q,q,zb*f.angle);ea.translate(q,q,new Float32Array([-ab,-bb]));var b=[],ka=a.i8888to32(L[0],L[1],L[2],L[3]),la=a.i8888to32(B[0],B[1],B[2],B[3]),ma=a.i8888to32(C,D,ia,0),na=a.numTo32(g),db=0,eb=0,fb=0,gb=0,Y=0,Z=c.vvColor||c.vvOpacity||c.vvRotation||c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeFieldStops||c.vvSizeUnitValue;if(Z){var y=p.vvFields,oa=y.rotation?p.getValue(n,y.rotation):0,pa=y.opacity?p.getValue(n,y.opacity):0,qa=y.color?p.getValue(n,
y.color):0,N=y.size&&!c.vvSizeScaleStops?p.getValue(n,y.size):0;c.vvSizeUnitValue&&(N=yb.getVisualVariableSizeValueRepresentationRatio(N,p.vvRanges.size.unitValue.valueRepresentation));if(null===N||isNaN(N))N=NaN;if(null===oa||isNaN(oa))oa=NaN;if(null===qa||isNaN(qa))qa=NaN;if(null===pa||isNaN(pa))pa=NaN;db=a.toUint32(N);eb=a.toUint32(pa);fb=a.toUint32(oa);gb=a.toUint32(qa)}var ra=[db,gb,eb,fb];M&&(Y=a.toUint32(p.heatmapInfo.getIntensity(n)));var E=n.centroid||n.geometry,F;switch(Q){case "esriGeometryPoint":F=
[[E.x,E.y]];break;case "esriGeometryMultipoint":F=E.points;break;case "esriGeometryPolyline":F=E.paths[0];break;case "esriGeometryPolygon":F=n.centroid?[[E.x,E.y]]:E.rings[0]}for(var z=0,G,Ea=0,Fa=0,H=Array(4*F.length),sa=0;sa<F.length;sa++){var hb=F[sa],ib=hb[0],jb=hb[1],ta=a.i1616to32(ib+Ea,jb+Fa),Ea=Ea+ib,Fa=Fa+jb;d.set([-.5*C,-.5*D]);S.transformMat2d(d,d,q);b.push(ta);b.push(a.i8888to32(d[0],d[1],W,X));b.push(na);b.push(ka);b.push(la);b.push(ma);Z?b.push.apply(b,ra):M&&b.push(Y);d.set([.5*C,-.5*
D]);S.transformMat2d(d,d,q);b.push(ta);b.push(a.i8888to32(d[0],d[1],ga,X));b.push(na);b.push(ka);b.push(la);b.push(ma);Z?b.push.apply(b,ra):M&&b.push(Y);d.set([-.5*C,.5*D]);S.transformMat2d(d,d,q);b.push(ta);b.push(a.i8888to32(d[0],d[1],W,ha));b.push(na);b.push(ka);b.push(la);b.push(ma);Z?b.push.apply(b,ra):M&&b.push(Y);d.set([.5*C,.5*D]);S.transformMat2d(d,d,q);b.push(ta);b.push(a.i8888to32(d[0],d[1],ga,ha));b.push(na);b.push(ka);b.push(la);b.push(ma);Z?b.push.apply(b,ra):M&&b.push(Y);G=6*sa;H[G+
0]=z+0;H[G+1]=z+1;H[G+2]=z+2;H[G+3]=z+1;H[G+4]=z+3;H[G+5]=z+2;z+=4}r.update({geometry:b},z,H);return r;case Da.WGLGeometryType.FILL:var Ga;a:{var ua=null!=fa?fa.spriteMosaicItem:null,Ha=n.geometry,kb=Xa.isPictureSymbol(f),lb;lb=kb?T.premultiplyAlphaUint32(T.white):f.color?T.premultiplyAlphaUint32(f.color):0;var Ca=c.vvColor||c.vvOpacity,mb=new Wa,Ia=0,Ja=0,Ka=0,La=0;if(ua)var nb=ua.rect,ob=nb.x,pb=nb.y,Bb=ua.width,Cb=ua.height,Ia=ob+1,Ja=pb+1,Ka=ob+1+Bb,La=pb+1+Cb;var Db=kb&&f.width&&f.height?a.i8888to32(a.nextHighestPowerOfTwo(f.width),
a.nextHighestPowerOfTwo(f.height),0,0):a.i8888to32(a.nextHighestPowerOfTwo(Ka-Ia),a.nextHighestPowerOfTwo(La-Ja),0,0),aa=[a.numTo32(g),lb,a.i1616to32(Ia,Ja),a.i1616to32(Ka,La),Db];if(Ca){var va=p.vvFields,wa=va.opacity?p.getValue(n,va.opacity):0,xa=va.color?p.getValue(n,va.color):0;if($a||null===xa||isNaN(xa))xa=NaN;if($a||null===wa||isNaN(wa))wa=NaN;aa.push(a.toUint32(xa),a.toUint32(wa))}for(var A=!1,Ma=0,qb=Ha.rings;Ma<qb.length;Ma++){var e=qb[Ma],ba=e.length;if(!(3>ba)){var ca=e[0][0],da=e[0][1];
if(-8>ca||520<ca||-8>da||520<da){A=!0;break}for(var h=1;h<ba;++h)if(ca+=e[h][0],da+=e[h][1],-8>ca||520<ca||-8>da||520<da){A=!0;break}if(A)break}}var O,m,k;if(A){t||(t=new xb.TileClipper(0,0,0,1,8),t.setExtent(512));t.reset(3);for(var Na=0,rb=Ha.rings;Na<rb.length;Na++)if(e=rb[Na],ba=e.length,!(3>ba)){m=e[0][0];k=e[0][1];t.moveTo(m,k);for(h=1;h<ba;++h)m+=e[h][0],k+=e[h][1],t.lineTo(m,k);t.close()}O={rings:t.result(!Za)};if(!O.rings||0===O.rings.length){Ga=null;break a}}else O=Ha;var I=[],ya=[],u,v;
if(Za){x||(x=new Ab);x.beginPolygon(l,ya);for(var Oa=0,sb=O.rings;Oa<sb.length;Oa++)if(e=sb[Oa],!(3>e.length)){x.beginContour();u=v=0;A?(m=e[0].x,k=e[0].y):(Pa=e[0],m=Pa[0],k=Pa[1]);var tb=[m,k,0];x.addVertex(tb,tb);for(h=1;h<e.length-1;h++){A?(m=e[h].x,k=e[h].y):(Qa=e[h],u=Qa[0],v=Qa[1],m+=u,k+=v);var ub=[m,k,0];x.addVertex(ub,ub)}x.endContour()}x.endPolygon();for(var za=0;za<l.length;za+=2)I.push(a.i1616to32(l[za],l[za+1])),I.push.apply(I,aa)}else{for(var J=0,w=0,Ra=void 0,Sa=void 0,Ta=0,vb=O.rings;Ta<
vb.length;Ta++){var e=vb[Ta],K=w;A?(m=e[0].x,k=e[0].y):(Ua=e[0],m=Ua[0],k=Ua[1]);l[w++]=m;l[w++]=k;var Aa=0;u=v=0;for(h=1;h<e.length;++h)A?(Ra=e[h].x,Sa=e[h].y,u=Ra-m,v=Sa-k,Aa-=u*(k+k+v),m=Ra,k=Sa):(Va=e[h],u=Va[0],v=Va[1],Aa-=u*(k+k+v),m+=u,k+=v),l[w++]=m,l[w++]=k;0<Aa?(0<K-J&&(Ya(I,ya,l,J,K,V,aa),J=K),V.length=0):0>Aa?0<K-J?V.push(.5*(K-J)):w=K:w=K}0<w-J&&Ya(I,ya,l,J,w,V,aa)}l.length=V.length=0;mb.update({geometry:I},I.length/(aa.length+1),ya);Ga=mb;break a;var Pa,Qa,Ua,Va}return Ga;case Da.WGLGeometryType.LINE:return wb.createLineMeshData(g,
p,c,fa,U,n,f)}return null}});