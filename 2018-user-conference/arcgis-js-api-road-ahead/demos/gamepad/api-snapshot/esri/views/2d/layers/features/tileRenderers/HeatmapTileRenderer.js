// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../renderers ../../../../../core/Accessor ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/diffUtils ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapContainer ../../../engine/BitmapTile ../../../engine/Canvas2DContainer ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(d,
g,m,h,k,n,p,f,q,r,t,l,u,v,w){Object.defineProperty(g,"__esModule",{value:!0});d=function(d){function b(a){a=d.call(this)||this;a._canvas=new u;a._bitmaps=new t;a._canvas.addChild(a._bitmaps);return a}m(b,d);Object.defineProperty(b.prototype,"gradient",{get:function(){return r.generateGradient(this.configuration.renderer)},enumerable:!0,configurable:!0});b.prototype.createTile=function(a){var c=l.default.pool.acquire();c.key.set(a);this.tileInfoView.getTileCoords(c,a);c.resolution=this.tileInfoView.getTileResolution(a);
c.height=c.width=512;return c};b.prototype.applyConfiguration=function(a){this.configuration=a;a=a.renderer;var c=a.minPixelIntensity,b=a.maxPixelIntensity,d=this.gradient;this.tiles.forEach(function(a){if(a=a.source)a.minPixelIntensity=c,a.maxPixelIntensity=b,a.gradient=d})};b.prototype.getProcessorConfiguration=function(){var a=this.layer;return{type:"heatmap",renderer:a.renderer.toJSON(),definitionExpression:a.definitionExpression,outFields:a.outFields,gdbVersion:a.gdbVersion,historicMoment:a.historicMoment&&
a.historicMoment.getTime()}};b.prototype.hitTest=function(a,c){return p.resolve([])};b.prototype.highlight=function(a){return{remove:function(){}}};b.prototype.install=function(a){a.addChild(this._canvas)};b.prototype.uninstall=function(a){a.removeChild(this._canvas)};b.prototype.needsReconfiguration=function(a){var c=this.configuration&&k.fromJSON(this.configuration.renderer)||null;a=a&&k.fromJSON(a.renderer)||null;c=q.diff(c,a);if(!c)return!1;switch(c.type){case "complete":return!0;case "partial":for(var b in c.diff)if("colorStops"!==
b&&"minPixelIntensity"!==b&&"maxPixelIntensity"!==b)return!0}return!1};b.prototype.disposeTile=function(a){this._bitmaps.removeChild(a);l.default.pool.release(a)};b.prototype.supportsRenderer=function(a){return"heatmap"===a.type};b.prototype.onTileData=function(a){var c=this.tiles.get(a.tileKey);if(a=a.intensityInfo){var b=this.configuration.renderer,d=b.minPixelIntensity,b=b.maxPixelIntensity;if(c.source)c.source.intensities=a.matrix;else{var e=w.default.pool.acquire();e.intensities=a.matrix;e.minPixelIntensity=
d;e.maxPixelIntensity=b;e.gradient=this.gradient;c.source=e;c.source.x=c.x;c.source.y=c.y;this._bitmaps.addChild(c);this.requestUpdate()}}else this._bitmaps.addChild(c),this.requestUpdate()};b.prototype.onTileError=function(a){console.error(a)};h([f.property({readOnly:!0,dependsOn:["configuration"]})],b.prototype,"gradient",null);return b=h([f.subclass()],b)}(f.declared(n,v.default));g.default=d});