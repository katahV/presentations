// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix/mat2d ../../../../../../core/libs/gl-matrix/vec2 ../../color ../../definitions ../../enums ../../number ../../WGLDisplayRecord ./WGLMeshTemplate".split(" "),function(t,y,B,C,p,x,u,z,D,v,r,E,F){Object.defineProperty(y,"__esModule",{value:!0});var A=C.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate");t=function(t){function c(e,
a,b,n,d,h,l,m,f,w,c){var k=t.call(this)||this;k.geometryType=v.WGLGeometryType.MARKER;var g=u.create(),q=x.create();x.translate(q,q,new Float32Array([b,-n]));d&&x.rotate(q,q,3.14159265359/180*d);k._materialStore=e;k.vvFlags=a;k.materialId=e.createSpriteMaterial(c,k.geometryType,a);k.fillColor=h;k.outlineColor=f;k.xOffset=b;k.yOffset=n;k.sizeOutlineWidth=r.i8888to32(l,m,w,0);e=Math.round(c.rect.x/4);a=Math.round(c.rect.y/4);b=e+Math.round(c.rect.width/4);c=a+Math.round(c.rect.height/4);g.set([-.5*
l,-.5*m]);u.transformMat2d(g,g,q);k.offsetAndTexUpperLeft=r.i8888to32(g[0],g[1],e,a);g.set([.5*l,-.5*m]);u.transformMat2d(g,g,q);k.offsetAndTexUpperRight=r.i8888to32(g[0],g[1],b,a);g.set([-.5*l,.5*m]);u.transformMat2d(g,g,q);k.offsetAndTexBottomLeft=r.i8888to32(g[0],g[1],e,c);g.set([.5*l,.5*m]);u.transformMat2d(g,g,q);k.offsetAndTexBottomRight=r.i8888to32(g[0],g[1],b,c);return k}B(c,t);c.fromPictureMarker=function(e,a,b,n,d){var h=Math.round(d*p.pt2px(b.width)),l=Math.round(d*p.pt2px(b.height)),m=
D.PICTURE_FILL_COLOR,f=n.sdf?.5:1,w=Math.round(f*d*p.pt2px(b.xoffset||0));d=Math.round(f*d*p.pt2px(b.yoffset||0));return new c(e,a,w,d,b.angle,m,h,l,0,0,n)};c.fromSimpleMarker=function(e,a,b,n,d){var h=z.premultiplyAlphaRGBA(b.color),l=Math.round(d*p.pt2px(b.size)),m=Math.round(.5*d*p.pt2px(b.xoffset||0));d=Math.round(.5*d*p.pt2px(b.yoffset||0));var f=b.outline,w=(f&&f.color&&z.premultiplyAlphaRGBA(f.color))|0,f=(f&&f.width&&Math.round(p.pt2px(f.width)))|0;return new c(e,a,m,d,b.angle,h,l,l,w,f,n)};
c.prototype.writeMesh=function(e,a,b,c,d,h,l){h=this._materialStore.get(this.materialId);var m=a.indexVector;a=a.get("geometry");var f=new E(c,this.geometryType,this.materialId),n=this._getOffset(a,h);e.push(f);f.vertexFrom=n;f.indexFrom=m.length;switch(b){case "esriGeometryPoint":b=d.geometry;e=b.x;b=b.y;this._writeVertices(f,a,c,this._getPos(e,b),h,l);this._writeIndices(f,m,n);break;case "esriGeometryPolyline":this._writeMany(f,m,a,n,c,d.geometry.paths[0],h,l);break;case "esriGeometryPolygon":(b=
d.centroid)?(e=b.x,b=b.y,this._writeVertices(f,a,c,this._getPos(e,b),h,l),this._writeIndices(f,m,n)):A.error("Tried to render polygon geometries as markers, but found no centroid!");break;case "esriGeometryMultipoint":this._writeMany(f,m,a,n,c,d.geometry.points,h,l);break;default:A.error("Unable to handle geometryType: "+b)}};c.prototype._getPos=function(e,a){return r.i1616to32(e,a)};c.prototype._writeMany=function(e,a,b,c,d,h,l,m){for(var f=0,n=0,p=0,k=0;k<h.length;k++){var g=h[k],q=g[0],g=g[1];
this._writeVertices(e,b,d,this._getPos(q+f,g+n),l,m);this._writeIndices(e,a,c+p);f+=q;n+=g;p+=4}};c.prototype._getOffset=function(e,a){a=a.materialKeyInfo.hasVV()?10:6;return e.length/a};c.prototype._writeVertices=function(e,a,b,c,d,h){a.push(c);a.push(this.offsetAndTexUpperLeft);a.push(b);a.push(this.fillColor);a.push(this.outlineColor);a.push(this.sizeOutlineWidth);this._writeVV(a,h,d);a.push(c);a.push(this.offsetAndTexUpperRight);a.push(b);a.push(this.fillColor);a.push(this.outlineColor);a.push(this.sizeOutlineWidth);
this._writeVV(a,h,d);a.push(c);a.push(this.offsetAndTexBottomLeft);a.push(b);a.push(this.fillColor);a.push(this.outlineColor);a.push(this.sizeOutlineWidth);this._writeVV(a,h,d);a.push(c);a.push(this.offsetAndTexBottomRight);a.push(b);a.push(this.fillColor);a.push(this.outlineColor);a.push(this.sizeOutlineWidth);this._writeVV(a,h,d);e.vertexCount+=4};c.prototype._writeVV=function(c,a,b){b.materialKeyInfo.hasVV()&&(c.push(a[v.VVType.SIZE]),c.push(a[v.VVType.COLOR]),c.push(a[v.VVType.OPACITY]),c.push(a[v.VVType.ROTATION]))};
c.prototype._writeIndices=function(c,a,b){a.push(b+0);a.push(b+1);a.push(b+2);a.push(b+1);a.push(b+3);a.push(b+2);c.indexCount+=6};return c}(F.default);y.default=t});