// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/io-query dojo/_base/lang ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../renderers/support/jsonUtils ../../../symbols/support/gfxUtils ../../../symbols/support/symbolPreview ../../../symbols/support/symbolUtils ./colorRampUtils ./sizeRampUtils".split(" "),
function(w,f,a,e,b,c,m,p,g,t,v,z,y,u,l,h,d,k,n,x,A,D,E,q,C){function B(a){return"esri.renderers.SimpleRenderer"===a.declaredClass}function F(a){return"esri.renderers.ClassBreaksRenderer"===a.declaredClass}function I(a){return"esri.renderers.UniqueValueRenderer"===a.declaredClass}function J(a){return"esri.renderers.PointCloudClassBreaksRenderer"===a.declaredClass}function K(a){return"esri.renderers.PointCloudStretchRenderer"===a.declaredClass}function L(a){return"esri.renderers.PointCloudUniqueValueRenderer"===
a.declaredClass}var G=l.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),M=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,H=new g.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}});return function(l){function g(a){a=l.call(this,a)||this;a._handles=new y;a._hasColorRamp=!1;a._hasOpacityRamp=!1;a._hasSizeRamp=!1;a._legendResponse={};a._webStyleSymbolCache=new Map;a.children=new z;a.layer=null;a.legendElements=[];a.parent=null;a.scale=null;a.title=null;return a}a(g,l);g.prototype.initialize=
function(){var a=this,b=function(){return a.notifyChange("ready")};this._handles.add([d.on(this,"children","change",function(r){var c=r.removed,h=a._handles;r.added.map(function(a){var r="activeLayerInfo-ready-watcher-"+a.layer.uid;h.add(d.init(a,"ready",b),r)});c.forEach(function(a){return h.remove(a.layer.uid)});b()})])};g.prototype.destroy=function(){this._handles.destroy();this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(g.prototype,"ready",{get:function(){return null===
this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isScaleDriven",{get:function(){var a=this,b=this.layer;if(null===b)return!1;if(b.renderer){var d=b.get("renderer.valueExpression");return M.test(d)?!0:(b=b.get("renderer.visualVariables"))&&b.some(function(r){return a._isScaleDrivenSizeVariable(r)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"version",{get:function(){return this._get("version")+
1},enumerable:!0,configurable:!0});g.prototype.buildLegendElementsForFeatureCollections=function(a){var r=this;this.legendElements=[];a.forEach(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)r._buildRendererLegendElements(a.renderer,a.title,"append");else if(a.featureSet&&a.featureSet.features.length){var b=a.layerDefinition;(b=(b=b&&b.drawingInfo)&&x.fromJSON(b.renderer))?r._buildRendererLegendElements(b,a.name,"append"):G.warn("drawingInfo not available!")}})};g.prototype.buildLegendElementsForRenderer=
function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};g.prototype.buildLegendElementsForTools=function(){var a=this,b=this.layer;"esri.layers.WMTSLayer"===b.declaredClass?this._constructLegendElementsForWMTSlayer():"esri.layers.WMSLayer"===b.declaredClass?this._constructLegendElementsForWMSSublayers():"esri.layers.MapImageLayer"===b.declaredClass?this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(r){a.legendElements=
[];r.forEach(function(r){if("esri.layers.ImageryLayer"===a.layer.declaredClass){var d=b.watch("renderingRule, bandIds",function(){a._legendResponse["default"]=null;a.buildLegendElementsForTools()});a._handles.add(d,"imageryLayers-watcher")}(r=a._generateSymbolTableElementForLegendLayer(r))&&r.infos.length&&a.legendElements.push(r);a.notifyChange("ready")});a.notifyChange("ready")}).catch(function(a){G.warn("Request to server for legend has failed!",a)}))};g.prototype._isGroupActive=function(){var a=
this.children;return a.length?a.some(function(a){return a.ready}):!1};g.prototype._isScaleDrivenSizeVariable=function(a){if(a&&"size"!==a.type)return!1;var b=a.minSize,r=a.maxSize;return"object"===typeof b&&b?this._isScaleDrivenSizeVariable(b):"object"===typeof r&&r?this._isScaleDrivenSizeVariable(r):!!a.expression||M.test(a.valueExpression)};g.prototype._buildRendererLegendElements=function(a,b,d){var r=this;this._getRendererLegendElements(a,b).then(function(a){"append"===d?Array.prototype.push.apply(r.legendElements,
a):r.legendElements=a;r.notifyChange("ready")}).catch(function(a){G.warn("error while building legend for layer!",a)})};g.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var a=this.layer,b=a.activeLayer;this._handles.add(d.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(b.styleId&&b.styles){var c=null;b.styles.some(function(a){if(b.styleId===a.id)return c=
a.legendUrl,!0});c&&(this.legendElements=[{type:"symbol-table",title:b.title,infos:[{src:c,opacity:a.opacity}]}])}this.notifyChange("ready")};g.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var a=this.layer,b=null;if(a.customParameters||a.customLayerParameters)b=u.clone(a.customParameters||{}),c.mixin(b,a.customLayerParameters||{});this._handles.add(d.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),
"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,b);this.notifyChange("ready")};g.prototype._generateLegendElementsForWMSSublayers=function(a,b){var r=this,d=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");a.forEach(function(a){var c=a.watch("title, visible, legendEnabled",function(){return r._constructLegendElementsForWMSSublayers()});r._handles.add(c,"wms-sublayers-watcher");
a.visible&&a.legendEnabled&&(a=r._generateSymbolTableElementForWMSSublayer(a,b))&&a.infos.length&&d.unshift(a)});return d};g.prototype._generateSymbolTableElementForWMSSublayer=function(a,b){return!a.legendUrl&&a.sublayers?(b=this._generateLegendElementsForWMSSublayers(a.sublayers,b).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:b}):this._generateSymbolTableElementForLegendUrl(a,b)};g.prototype._generateSymbolTableElementForLegendUrl=function(a,d){var r=a.legendUrl;if(r){var c=
{type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};d&&(r+="?"+b.objectToQuery(d));c.infos.push({src:r,opacity:a.layer&&a.layer.opacity});return c}};g.prototype._getLegendLayers=function(a){var b=this,d=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",r=this._legendResponse&&this._legendResponse[d];return r?h.resolve(r):this._legendRequest(a).then(function(a){a=a.layers;return b._legendResponse[d]=a})};g.prototype._legendRequest=function(a){var b=this.layer;a={f:"json",dynamicLayers:a};
"esri.layers.ImageryLayer"===b.declaredClass&&(b.renderingRule&&(a.renderingRule=JSON.stringify(b.renderingRule.toJSON())),b.bandIds&&(a.bandIds=b.bandIds.join()));var d=b.url.replace(/(\/)+$/,"");if(10.01<=b.version){var r=d.indexOf("?"),d=-1<r?d.substring(0,r)+"/legend"+d.substring(r):d+"/legend";b.token&&(d+="?token\x3d"+b.token)}else b=d.toLowerCase().indexOf("/rest/"),b=d.substring(0,b)+d.substring(b+5,d.length),d="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(b)+"\x26returnbytes\x3dtrue";
return p(d,{query:a,callbackParamName:"callback"}).then(function(a){return a.data})};g.prototype._constructLegendElementsForSublayers=function(){var a=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var b=this.layer,c=new n({layer:b});this._getLegendLayers(c).then(function(r){var c={};r.forEach(function(a){c[a.layerId]=a});a._handles.add(d.watch(b,"sublayers",a._constructLegendElementsForSublayers.bind(a)),"sublayers-watcher");a.legendElements=a._generateLegendElementsForSublayers(b.sublayers,
c,b.opacity);a.notifyChange("ready")}).catch(function(a){G.warn("Request to server for legend has failed!",a)}).then(function(){return c.destroy()});this.notifyChange("ready")};g.prototype._generateLegendElementsForSublayers=function(a,b,d){var r=this,c=[];this._handles.add(a.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");a.forEach(function(a){var h=a.watch("renderer, opacity, title, visible",function(){return r._constructLegendElementsForSublayers()});r._handles.add(h,
"sublayers-watcher");a.visible&&a.legendEnabled&&(h=a&&null!=a.opacity?a.opacity:null,(a=r._generateSymbolTableElementForSublayer(a,b,null!=h?h*d:d))&&a.infos.length&&c.unshift(a))});return c};g.prototype._generateSymbolTableElementForSublayer=function(a,b,d){var r=b[a.id];return!r&&a.sublayers?(b=this._generateLegendElementsForSublayers(a.sublayers,b,d).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:b}):this._generateSymbolTableElementForLegendLayer(r,a,d)};g.prototype._generateSymbolTableElementForLegendLayer=
function(a,b,d){var c=this;if(a){var r=b&&b.renderer,h=b&&b.title||a.layerName;r&&(r=b&&b.title||this._getRendererTitle(r,b))&&(h&&(r.title=h),h=r);h={type:"symbol-table",title:h,infos:[]};a.legendType&&(h.legendType=a.legendType);a.legend&&this._isLegendLayerInScale(a,b)&&(b=b?this._sanitizeLegendForSublayer(a.legend.slice(),b):a.legend,h.infos=b.map(function(b){var r=b.url;if(b.imageData&&0<b.imageData.length)r="data:image/png;base64,"+b.imageData;else if(0!==r.indexOf("http")){var r=c.layer.url+
"/"+a.layerId+"/images/"+r,h=c.layer.token;h&&(r+="?token\x3d"+h)}else return null;return{label:b.label,src:r,opacity:d,width:b.width,height:b.height}}).filter(function(a){return!!a}));return h.infos.length?h:null}};g.prototype._isLegendLayerInScale=function(a,b){b=b||this.layer;var d=null,c=null,r=!0;!b.minScale&&0!==b.minScale||!b.maxScale&&0!==b.maxScale?(0===a.minScale&&b.tileInfo&&(d=b.tileInfo.lods[0].scale),0===a.maxScale&&b.tileInfo&&(c=b.tileInfo.lods[b.tileInfo.lods.length-1].scale)):(d=
Math.min(b.minScale,a.minScale)||b.minScale||a.minScale,c=Math.max(b.maxScale,a.maxScale));if(0<d&&d<this.scale||c>this.scale)r=!1;return r};g.prototype._sanitizeLegendForSublayer=function(a,b){if(10.1>this.layer.version||0===a.length)return a;b=b.renderer;var d=null,c=null;a.some(function(a){return a.values})&&a.some(function(a,b){a.values||(d=b,c=a,c.label||(c.label="others"));return null!=c});b?"unique-value"===b.type?c&&(a.splice(d,1),a.push(c)):"class-breaks"===b.type&&(c&&a.splice(d,1),a.reverse(),
c&&a.push(c)):c&&(a.splice(d,1),a.push(c));return a};g.prototype._getRendererLegendElements=function(a,b){return B(a)||F(a)||I(a)||J(a)||K(a)||L(a)?J(a)||K(a)||L(a)||"esri.renderers.PointCloudRGBRenderer"===a.declaredClass?this._constructPointCloudRendererLegendElements(a,b):this._constructRendererLegendElements(a,b):(G.warn("Renderer not supported!"),h.resolve([]))};g.prototype._getPointCloudRendererTitle=function(a){return a.legendOptions&&a.legendOptions.title||a.field};g.prototype._constructPointCloudRendererLegendElements=
function(a,b){var d=this,c=this.layer.opacity,k=[],r=null,n=null;if(J(a))r={type:"symbol-table",title:b||this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(a){r.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:d._getAppliedCloneSymbol(H,a.color,c)})});else if(K(a)){var n=a.stops,e=null;if(n.length&&(1===n.length&&(e=n[0].color),!e)){var g=n[0].value,m=n[n.length-1].value;null!=g&&null!=m&&(e=q.getColorFromPointCloudStops(g+
(m-g)/2,n))}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(H,e||H.color,c)}]};n={type:"color-ramp",title:b||this._getPointCloudRendererTitle(a),borderColor:A.getStroke(H).color,overlayColor:q.getRampOverlayColor(c),infos:q.getRampStopsForPointCloud(a.stops)}}else L(a)&&(r={type:"symbol-table",title:b||this._getPointCloudRendererTitle(a),infos:[]},a.colorUniqueValueInfos.forEach(function(a){r.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),
symbol:d._getAppliedCloneSymbol(H,a.color,c)})}));r&&r.infos.length&&k.push(r);n&&n.infos.length&&k.push(n);a=k.reduce(function(a,b){return a.concat(b.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return d._getSymbolPreview(a)});return h.eachAlways(a).then(function(){return k})};g.prototype._constructRendererLegendElements=function(a,b){var d=this;return this._loadRenderer(a).then(function(a){d._hasColorRamp=!1;d._hasOpacityRamp=!1;d._hasSizeRamp=!1;var c=d._getVisualVariableLegendElements(a)||
[],k={type:"symbol-table",title:b||d._getRendererTitle(a),infos:[]},r=null;if(I(a)){var n=a.field;a.uniqueValueInfos.forEach(function(a){a.symbol&&k.infos.push({label:a.label||d._getDomainName(n,a.value)||a.value,value:a.value,symbol:a.symbol})})}else F(a)?(r=d._isUnclassedRenderer(a),r&&d._hasSizeRamp||(a.classBreakInfos.forEach(function(a){a.symbol&&k.infos.unshift({label:a.label||(r?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),r&&(k.title=null),d._updateInfosforClassedSizeRenderer(a,
k.infos))):B(a)&&a.symbol&&!d._hasSizeRamp&&k.infos.push({label:a.label,symbol:a.symbol});var q=!1,e=a.defaultLabel,g=a.defaultSymbol;g&&!r&&(k.infos.push({label:e||"others",symbol:g}),q=!0);q||B(a)||r&&!d._hasColorRamp&&!d._hasSizeRamp&&!d._hasOpacityRamp||c.push({type:"symbol-table",infos:[{label:a.defaultLabel,symbol:a.defaultSymbol}]});k.infos.length&&c.unshift(k);var m=d._getSymbolConfig(a.visualVariables),q=c.reduce(function(a,b){return a.concat(b.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return d._getSymbolPreview(a,
m)});a=null;return h.eachAlways(q).then(function(){return c})})};g.prototype._updateInfosforClassedSizeRenderer=function(a,b){var d=a.authoringInfo&&"class-breaks-size"===a.authoringInfo.type,c=a.classBreakInfos.some(function(a){return E.isVolumetricSymbol(a.symbol)});if(d&&c){var h=C.REAL_WORLD_MAX_SIZE;a=a.classBreakInfos.length;var k=(h-C.REAL_WORLD_MIN_SIZE)/(1<a?a-1:a);b.forEach(function(a,b){a.size=h-k*b})}};g.prototype._getSymbolConfig=function(a){var b=!1,d=!1;if(a)for(var c=0;c<a.length&&
(!b||!d);c++){var h=a[c];"size"===h.type&&("height"===h.axis&&(b=!0),"width-and-depth"===h.axis&&(d=!0))}return b&&d?"tall":null};g.prototype._getSymbolPreview=function(a,b){return D.renderPreviewHTML(a.symbol,{size:a.size,opacity:this.layer.opacity,symbolConfig:b}).then(function(b){a.preview=b;return a}).catch(function(){a.preview=null;return a})};g.prototype._loadRenderer=function(a){var b=this,d=[];a=a.clone();var c=this._getMedianColor(a),k=this.layer.opacity;if(F(a)||I(a)){var n=(a.classBreakInfos||
a.uniqueValueInfos).map(function(a){return b._fetchSymbol(a.symbol,c,k).then(function(b){a.symbol=b}).catch(function(){a.symbol=null})});Array.prototype.push.apply(d,n)}d.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:c,k).then(function(d){b._applySymbolToRenderer(a,d,B(a))}).catch(function(){b._applySymbolToRenderer(a,null,B(a))}));return h.eachAlways(d).then(function(){return a})};g.prototype._applySymbolToRenderer=function(a,b,d){d?a.symbol=b:a.defaultSymbol=b};g.prototype._getMedianColor=
function(a){if(!a.visualVariables)return null;var b=v.find(a.visualVariables,function(a){return"color"===a.type});if(!b)return null;var d=null,c=null;if(b.colors)d=b.minDataValue,c=b.maxDataValue;else if(b.stops){if(1===b.stops.length)return b.stops[0].color;d=b.stops[0].value;c=b.stops[b.stops.length-1].value}if(null!=d&&null!=c)return a.getColor(d+(c-d)/2,{colorInfo:b})};g.prototype._fetchSymbol=function(a,b,d){var c=this;if(!a)return h.reject();if("web-style"===a.type){var k=a.portal,k=a.name+
"-"+a.styleName+"-"+a.styleUrl+"-"+(k&&k.url)+"-"+(k&&k.user&&k.user.username),n=this._webStyleSymbolCache;n.has(k)||n.set(k,a.fetchSymbol());return n.get(k).then(function(a){return c._getAppliedCloneSymbol(a,b,d)}).catch(function(){G.warn("Fetching web-style failed!");return h.reject()})}return h.resolve(this._getAppliedCloneSymbol(a,b,d))};g.prototype._getAppliedCloneSymbol=function(a,b,d){if(!a)return a;a=a.clone();var c=-1<a.type.indexOf("3d");b=b&&b.toRgba();c?this._applyColorTo3dSymbol(a,b,
d):(a.color&&(a.color=this._getOpacityAppliedColor(b||a.color.toRgba(),d)),(b=a.outline)&&b.color&&(b.color=this._getOpacityAppliedColor(b.color.toRgba(),d)));return a};g.prototype._applyColorTo3dSymbol=function(a,b,d){var c=this;a.symbolLayers.forEach(function(a){a&&(b&&(a.material||(a.material={}),a.material.color=new m(b)),null!=d&&(a.material&&a.material.color&&(a.material.color=c._getOpacityAppliedColor(a.material.color.toRgba(),d)),a.outline&&a.outline.color&&(a.outline.color=c._getOpacityAppliedColor(a.outline.color.toRgba(),
d))))})};g.prototype._getOpacityAppliedColor=function(a,b){a[3]*=b;return a};g.prototype._getVisualVariableLegendElements=function(a){var b=this,d=a.visualVariables,c=[],h=[],k=[],n=this.layer.opacity;if(!d)return null;d.forEach(function(a){"color"===a.type?c.push(a):"size"===a.type?h.push(a):"opacity"===a.type&&k.push(a)});var d=c.concat(h,k),e,g;0===c.length&&F(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&(e=(e=a.classBreakInfos[0])&&e.symbol);0===c.length&&B(a)&&(e=a.symbol);e&&(-1<e.type.indexOf("3d")?
(e=e.symbolLayers.getItemAt(0),e.get("material.color")&&(g=e.material.color)):e.url||(g=e.color),g&&(g=g.toRgba()));return d.map(function(d){if(!d.legendOptions||!1!==d.legendOptions.showLegend){var c=b._getRampTitle(d,b.layer),h=q.getRampBorderColor(a),k=q.getRampOverlayColor(n),e=null;"color"===d.type?(e={type:"color-ramp",title:c,borderColor:h,overlayColor:k,infos:q.getRampStops(a,d)},b._hasColorRamp||(b._hasColorRamp=!(null==e.infos||!e.infos.length))):"size"===d.type?(e={type:"size-ramp",title:c,
infos:C.getRampStops(a,d,b._getMedianColor(a),b.scale)},b._hasSizeRamp||(b._hasSizeRamp=!(null==e.infos||!e.infos.length))):"opacity"===d.type&&(e={type:"opacity-ramp",title:c,borderColor:h,overlayColor:k,infos:q.getRampStops(a,d,g)},b._hasOpacityRamp||(b._hasOpacityRamp=!(null==e.infos||!e.infos.length)));return e.infos&&e}}).filter(function(a){return!!a})};g.prototype._getDomainName=function(a,b){if(a&&!c.isFunction(a)){var d=this.layer;return(d=(a=d.getField&&d.getField(a))&&d.getFieldDomain?d.getFieldDomain(a.name):
null)&&d.codedValues?d.getName(b):null}return null};g.prototype._getRampTitle=function(a,b){var d=a.field,h=a.normalizationField,k=!1,n=!1,e=!1,q=null,d=c.isFunction(d)?null:d,h=c.isFunction(h)?null:h;if(void 0!==(a.legendOptions&&a.legendOptions.title))q=a.legendOptions.title;else if(a.valueExpressionTitle)q=a.valueExpressionTitle;else{if(b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables)for(a=b.renderer.authoringInfo.visualVariables,q=0;q<a.length;q++){var g=a[q];if("color"===g.type)if("ratio"===
g.style){k=!0;break}else if("percent"===g.style){n=!0;break}else if("percentTotal"===g.style){e=!0;break}}q={field:d&&this._getFieldAlias(d,b),normField:h&&this._getFieldAlias(h,b),ratio:k,ratioPercent:n,ratioPercentTotal:e}}return q};g.prototype._getRendererTitle=function(a,b){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var d=this.layer,h=a.field,k=null,n=null;F(a)&&(k=a.normalizationField,n="percent-of-total"===a.normalizationType);
h=c.isFunction(h)?null:h;k=c.isFunction(k)?null:k;a=null;if(h||k)a={field:b?h:h&&this._getFieldAlias(h,d),normField:b?k:k&&this._getFieldAlias(k,d),normByPct:n};return a};g.prototype._getFieldAlias=function(a,b){var d=b.popupTemplate,d=d&&d.fieldInfos;b=c.isFunction(a)?null:b.getField&&b.getField(a);var h=null;d&&d.some(function(b){if(a===b.fieldName)return h=b,!0});var d=h||b,k=null;d&&(k=h&&h.label||b&&b.alias||d.name||d.fieldName);return k};g.prototype._isUnclassedRenderer=function(a){var b=a.visualVariables,
d=!1;F(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&b&&(d=a.field?b.some(function(b){return!(!b||a.field!==b.field||(a.normalizationField||b.normalizationField)&&a.normalizationField!==b.normalizationField)}):!!b.length);return d};e([k.property()],g.prototype,"children",void 0);e([k.property()],g.prototype,"layer",void 0);e([k.property()],g.prototype,"legendElements",void 0);e([k.property()],g.prototype,"parent",void 0);e([k.property({readOnly:!0})],g.prototype,"ready",null);e([k.property()],
g.prototype,"scale",void 0);e([k.property({dependsOn:["layer.renderer.valueExpression","layer.renderer.visualVariables"],readOnly:!0})],g.prototype,"isScaleDriven",null);e([k.property()],g.prototype,"title",void 0);e([k.property({dependsOn:["ready"],readOnly:!0,value:0})],g.prototype,"version",null);return g=e([k.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],g)}(k.declared(t))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/_base/lang ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),
function(w,f,a,e,b,c,m,p){var g={visible:"visibleSublayers",definitionExpression:"layerDefs",labelsVisible:"hasDynamicLayers",labelingInfo:"hasDynamicLayers",opacity:"hasDynamicLayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};return function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;a.scale=0;return a}a(f,c);Object.defineProperty(f.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});
return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"hasDynamicLayers",{get:function(){return p.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layer",{set:function(a){var b=this;this._get("layer")!==a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=
[a.allSublayers.on("change",function(){return b.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return b.notifyChange(g[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=
a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,b){a[b.id]=b.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"visibleSublayers",{get:function(){var a=this,b=this.layer.sublayers,c=[],e=function(b){var d=a.scale,h=0===b.minScale||d<=b.minScale,n=0===
b.maxScale||d>=b.maxScale;b.visible&&(0===d||h&&n)&&(b.sublayers?b.sublayers.forEach(e):c.unshift(b))};b&&b.forEach(e);return c},enumerable:!0,configurable:!0});f.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:b.mixin(a,{layers:this.layers,layerDefs:this.layerDefs});return a};e([m.property({readOnly:!0,dependsOn:["hasDynamicLayers",
"visibleSublayers"]})],f.prototype,"dynamicLayers",null);e([m.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],f.prototype,"hasDynamicLayers",null);e([m.property()],f.prototype,"layer",null);e([m.property({readOnly:!0,dependsOn:["visibleSublayers"]})],f.prototype,"layers",null);e([m.property({readOnly:!0,dependsOn:["visibleSublayers"]})],f.prototype,"layerDefs",null);e([m.property({type:Number})],f.prototype,"scale",void 0);e([m.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],
f.prototype,"version",null);e([m.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],f.prototype,"visibleSublayers",null);return f=e([m.subclass("esri.layers.mixins.ExportImageParameters")],f)}(m.declared(c))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(w,f,a){function e(a,c){function b(a){var c=a.sublayers;e.unshift(a.id);c&&c.forEach(b)}if(!a||!a.length)return!0;var e=[];c.forEach(b);if(a.length>e.length)return!1;c=0;for(var g=
e.length,f=0;f<a.length;f++){for(var v=a[f].id;c<g&&e[c]!==v;)c++;if(c>=g)return!1}return!0}Object.defineProperty(f,"__esModule",{value:!0});f.isExportDynamic=function(b,c,m){return b.some(function(b){var c=b.source;return!(!c||c.type===a.MAPLAYER&&c.mapLayerId===b.id&&(!c.gdbVersion||c.gdbVersion===m.gdbVersion))||null!=b.renderer||null!=b.labelingInfo||b.hasOwnProperty("opacity")&&null!=b.opacity||b.hasOwnProperty("labelsVisible")&&null!=b.labelsVisible})?!0:!e(b,c)};f.sameStructureAsService=function(a,
c){return c.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reverse().every(function(b,c){return(c=a[c])&&b.id===c.id&&(null==b.sublayers&&null==c.sublayers||null!=b.sublayers&&null!=c.sublayers&&b.sublayers.map(function(a){return a.id}).join(",")===c.sublayers.map(function(a){return a.id}).join(","))})}})},"esri/symbols/support/gfxUtils":function(){define("require exports dojo/_base/lang dojox/gfx/_base ../../Color ../../request ../../core/LRUMap ../../core/promiseUtils ../../core/screenUtils".split(" "),
function(w,f,a,e,b,c,m,p,g){function t(a){if(!a)return null;var b,c=a.constructor,h=g.pt2px(a.width);switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=t(a.outline);break;case "simple-line":a.style!==c.STYLE_NULL&&0!==h&&(b={color:a.color,style:l(a.style),width:h,cap:a.cap,join:a.join===c.JOIN_MITER?g.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(f,"__esModule",{value:!0});var v=w.toUrl("../../symbols/patterns/"),z={left:"start",center:"middle",
right:"end",justify:"start"},y={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},u=new m(1E3);f.getSVGAlign=function(a){return a=(a=a.horizontalAlignment)&&z[a.toLowerCase()]||"middle"};f.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&y[a.toLowerCase()]||"alphabetic"};f.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};f.getFill=function(b){var d=b.style,c=null;if(b){var h=b.constructor;switch(b.type){case "simple-marker":d!==
h.STYLE_CROSS&&d!==h.STYLE_X&&(c=b.color);break;case "simple-fill":d===h.STYLE_SOLID?c=b.color:d!==h.STYLE_NULL&&(c=a.mixin({},e.defaultPattern,{src:v+d+".png",width:8,height:8}));break;case "picture-fill":c=a.mixin({},e.defaultPattern,{src:b.url,width:g.pt2px(b.width)*b.xscale,height:g.pt2px(b.height)*b.yscale,x:g.pt2px(b.xoffset),y:g.pt2px(b.yoffset)});break;case "text":c=b.color}}return c};f.getPatternUrlWithColor=function(a,b){var d=a+"-"+b;return u.has(d)?p.resolve(u.get(d)):c(a,{responseType:"image",
allowImageDataAccess:!0}).then(function(a){a=a.data;var c=a.naturalWidth,k=a.naturalHeight,h=document.createElement("canvas");h.width=c;h.height=k;var n=h.getContext("2d");n.fillStyle=b;n.fillRect(0,0,c,k);n.globalCompositeOperation="destination-in";n.drawImage(a,0,0);a=h.toDataURL();u.set(d,a);return a})};f.getStroke=t;var l=function(){var a={};return function(b){if(a[b])return a[b];var d=b.replace(/-/g,"");return a[b]=d}}();f.defaultThematicColor=new b([128,128,128])})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),
function(w,f,a,e,b,c,m,p,g){var t=f.getObject("dojox.gfx",!0),v=t._base={};t._hasClass=function(a,b){return(a=a.getAttribute("className"))&&0<=(" "+a+" ").indexOf(" "+b+" ")};t._addClass=function(a,b){var d=a.getAttribute("className")||"";(!d||0>(" "+d+" ").indexOf(" "+b+" "))&&a.setAttribute("className",d+(d?" ":"")+b)};t._removeClass=function(a,b){var d=a.getAttribute("className");d&&a.setAttribute("className",d.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),"$1$2"))};v._getFontMeasurements=function(){var a=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},c,h;e("ie")&&(h=b.doc.documentElement.style.fontSize||"",h||(b.doc.documentElement.style.fontSize="100%"));var g=p.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},b.body());for(c in a)g.style.fontSize=c,a[c]=16*Math.round(12*g.offsetHeight/16)/12/1E3;
e("ie")&&(b.doc.documentElement.style.fontSize=h);b.body().removeChild(g);return a};var z=null;v._getCachedFontMeasurements=function(a){if(a||!z)z=v._getFontMeasurements();return z};var y=null,u={};v._getTextBox=function(a,c,h){var d,k,e=arguments.length,n;y||(y=p.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},b.body()));d=y;d.className="";k=d.style;k.borderWidth="0";k.margin="0";k.padding="0";k.outline="0";if(1<e&&c)for(n in c)n in u||(k[n]=c[n]);2<e&&h&&(d.className=
h);d.innerHTML=a;d.getBoundingClientRect?(k=d.getBoundingClientRect(),k={l:k.left,t:k.top,w:k.width||k.right-k.left,h:k.height||k.bottom-k.top}):k=g.getMarginBox(d);d.innerHTML="";return k};v._computeTextLocation=function(a,b,c,h){var d={};switch(a.align){case "end":d.x=a.x-b;break;case "middle":d.x=a.x-b/2;break;default:d.x=a.x}d.y=a.y-c*(h?.75:1);return d};v._computeTextBoundingBox=function(a){if(!t._base._isRendered(a))return{x:0,y:0,width:0,height:0};var b;b=a.getShape();var d=a.getFont()||t.defaultFont;
a=a.getTextWidth();d=t.normalizedLength(d.size);b=v._computeTextLocation(b,a,d,!0);return{x:b.x,y:b.y,width:a,height:d}};v._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==a};var l=0;v._getUniqueId=function(){var a;do a=w._scopeName+"xUnique"+ ++l;while(m.byId(a));return a};var h=e("pointer-events")?"touchAction":null;v._fixMsTouchAction=h?function(a){a.rawNode.style[h]="none"}:function(){};f.mixin(t,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",
points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",
color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var a={};return function(b){var d=
a[b];if(d)return new d;d=a[b]=new Function;d.prototype=t["default"+b];return new d}}(),normalizeColor:function(b){return b instanceof a?b:new a(b)},normalizeParameters:function(a,b){var d;if(b){var c={};for(d in a)d in b&&!(d in c)&&(a[d]=b[d])}return a},makeParameters:function(a,b){var d=null;if(!b)return f.delegate(a);var c={};for(d in a)d in c||(c[d]=f.clone(d in b?b[d]:a[d]));return c},formatNumber:function(a,b){var d=a.toString();if(0<=d.indexOf("e"))d=a.toFixed(4);else{var c=d.indexOf(".");
0<=c&&5<d.length-c&&(d=a.toFixed(4))}return 0>a?d:b?" "+d:d},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family},splitFontString:function(a){var b=t.getDefault("Font");a=a.split(/\s+/);if(!(5>a.length)){b.style=a[0];b.variant=a[1];b.weight=a[2];var d=a[3].indexOf("/");b.size=0>d?a[3]:a[3].substring(0,d);var c=4;0>d&&("/"==a[4]?c=6:"/"==a[4].charAt(0)&&(c=5));c<a.length&&(b.family=a.slice(c).join(" "))}return b},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return t._base._getCachedFontMeasurements()["12pt"]/
12},pt2px:function(a){return a*t.px_in_pt()},px2pt:function(a){return a/t.px_in_pt()},normalizedLength:function(a){if(0===a.length)return 0;if(2<a.length){var b=t.px_in_pt(),c=parseFloat(a);switch(a.slice(-2)){case "px":return c;case "pt":return c*b;case "in":return 72*c*b;case "pc":return 12*c*b;case "mm":return c*t.mm_in_pt*b;case "cm":return c*t.cm_in_pt*b}}return parseFloat(a)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,
equalSources:function(a,b){return a&&b&&a===b},switchTo:function(a){var b="string"==typeof a?t[a]:a;b&&(c.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath EsriPath Surface createSurface fixTarget".split(" "),function(a){t[a]=b[a]}),"string"==typeof a?t.renderer=a:c.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(a){return t.renderer=t[a]&&t[a].Surface===t.Surface?a:null}))}});return t})},"esri/symbols/support/symbolPreview":function(){define(["require",
"exports","./previewSymbol2D","./previewSymbol3D","./previewWebStyleSymbol"],function(w,f,a,e,b){function c(m,p){switch(m.type){case "web-style":return b.previewWebStyleSymbol(m,c,p);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return e.previewSymbol3D(m,p);default:return a.previewSymbol2D(m,p)}}Object.defineProperty(f,"__esModule",{value:!0});f.renderPreviewHTML=c})},"esri/symbols/support/previewSymbol2D":function(){define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ../SimpleMarkerSymbol ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(w,f,a,e,b,c,m,p,g,t){function v(a,b){var c=z.getContext("2d"),h=[];b&&(b.weight&&h.push(b.weight),b.size&&h.push(b.size+"px"),b.family&&h.push(b.family));c.font=h.join(" ");return c.measureText(a).width}Object.defineProperty(f,"__esModule",{value:!0});var z=document.createElement("canvas");f.previewSymbol2D=function(f,u){var l=u&&u.size?c.pt2px(u.size):null,h=u&&u.maxSize?c.pt2px(u.maxSize):null,d=p.getStroke(f),k={shape:null,fill:null,stroke:d};d&&d.width&&(d.width=Math.min(d.width,80));
var n=0,x=0,A=d&&d.width||0,y=!1,E=null;switch(f.type){case "simple-marker":var q=m.defaultProps,d=f.style,x=n=l=Math.min(l||c.pt2px(f.size||q.size),h||120);switch(d){case m.STYLE_CIRCLE:k.shape={type:"circle",cx:0,cy:0,r:.5*l};break;case m.STYLE_CROSS:k.shape={type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[n,.5*x]},{command:"M",values:[.5*n,0]},{command:"L",values:[.5*n,x]},{command:"E",values:[]}]};break;case m.STYLE_DIAMOND:k.shape={type:"path",path:[{command:"M",values:[0,
.5*x]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,.5*x]},{command:"L",values:[.5*n,x]},{command:"Z",values:[]}]};break;case m.STYLE_SQUARE:k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,x]},{command:"L",values:[0,x]},{command:"Z",values:[]}]};break;case m.STYLE_X:k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,x]},{command:"M",values:[n,0]},{command:"L",values:[0,x]},{command:"E",values:[]}]};break;case m.STYLE_PATH:y=
!0,k.shape={type:"path",path:f.path||""}}break;case "simple-line":A=Math.min(l||A,h||80);n=22<A?2*A:40;x=A;d.width=A;A=0;k.shape={type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[n,.5*x]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":k.shape=g.shapes.fill[0];break;case "picture-marker":h=h||120;d=c.pt2px(f.width);q=c.pt2px(f.height);l=Math.min(l||Math.max(d,q),h);q=d/q;d=1>=q?Math.ceil(l*q):l;q=1>=q?l:Math.ceil(l/q);n=d;x=q;E=u.opacity;k.shape={type:"image",
x:-Math.round(d/2),y:-Math.round(q/2),width:d,height:q,src:f.url||""};break;case "text":var d=f.text||"Aa",q=f.font,l=Math.min(l||c.pt2px(q.size),h||120),C=v(d,{weight:q.weight,size:l,family:q.family}),n=(h=/[\uE600-\uE6FF]/.test(d))?l:C,x=l,C=.25*a.normalizedLength((q?l:0).toString());h&&(C+=5);k.shape={type:"text",text:d,x:0,y:C,align:"middle",decoration:f.decoration||q&&q.decoration,rotated:f.rotated,kerning:f.kerning};k.font=q&&{size:l,style:q.style,decoration:q.decoration,weight:q.weight,family:q.family}}if(!k.shape)return b.reject(new e("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var n=(n||22)+2*A,x=(x||22)+2*A,B=p.getFill(f),A=f.color,l=null;B&&"pattern"===B.type&&A&&"picture-fill"!==f.type?l=p.getPatternUrlWithColor(B.src,A.toCss(!0)).then(function(a){B.src=a;k.fill=B;return k}):(k.fill=B,l=b.resolve(k));return l.then(function(a){return t.renderSymbol([[a]],[n,x],{node:u&&u.node,scale:y,opacity:E})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(w,f){Object.defineProperty(f,"__esModule",{value:!0});f.shapes=
{fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",
path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",
path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},
{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};f.getExtrudeSymbolShapes=function(a){a*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+a]},{command:"L",values:[0,22*.7+a-.7*11]},{command:"Z",values:[]}]},
{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+a]},{command:"L",values:[22,a]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};f.getCubeShapes=function(a,e){var b=e?20:a,c=e?4:6,c=b=22>=b?b-.5*c:b-c;e=e?.35*b:.5*b;return[{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[c,
.5*e]},{command:"L",values:[.5*c,e]},{command:"L",values:[0,.5*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*c,e]},{command:"L",values:[.5*c,a]},{command:"L",values:[0,a-.5*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*c,e]},{command:"L",values:[.5*c,a]},{command:"L",values:[c,a-.5*e]},{command:"L",values:[c,.5*e]},{command:"Z",values:[]}]}]};f.getCylinderShapes=function(a,e){var b=e?20:a;e=e?4:6;b=22>=b?b-.5*e:b-
e;e=.5*b;var c=.15*b;a-=c;return[{type:"ellipse",cx:.5*b,cy:a,rx:e,ry:c},{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,a]},{command:"L",values:[b,a]},{command:"L",values:[b,c]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*b,cy:c,rx:e,ry:c}]};f.getConeShapes=function(a,e){var b=e?20:a;e=e?4:6;b=22>=b?b-.5*e:b-e;e=.15*b;var c=b;a-=e;return[{type:"ellipse",cx:.5*b,cy:a,rx:.5*b,ry:e},{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[c,a]},{command:"L",values:[0,
a]},{command:"Z",values:[]}]}]};f.getInvertedConeShapes=function(a){var e=a,e=22>e?e-3:e-6,b=.15*e,c=e;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[.5*c,a-b]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:0,rx:.5*e,ry:b}]};f.getDiamondShapes=function(a){var e=a,e=22>e?e-2:e-4,b=Math.floor(a/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,.5*a-b]},{command:"L",values:[.45*e-b,.5*a+b]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e-b,.5*a+b]},{command:"L",values:[0,.5*a-b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*a-b]},{command:"L",values:[.45*e-b,.5*a+b]},{command:"L",values:[.45*e,a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,a]},{command:"L",values:[e,.5*a-b]},{command:"L",values:[.45*e-b,.5*a+b]},{command:"Z",values:[]}]}]};f.getTetrahedronShapes=function(a){var e=a,e=22>
e?e-1:e-2;return[{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[a,e]},{command:"L",values:[.45*a,.6*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[.45*a,.6*e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[.45*a,.6*e]},{command:"L",values:[a,e]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojo/_base/lang dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/promiseUtils ../../core/sniff".split(" "),
function(w,f,a,e,b,c,m,p,g,t,v){function z(a){return a.map(function(a){return a.command+" "+a.values.join(",")}).join(" ").trim()}function y(c,h,d,k){var g=k&&k.node||document.createElement("div"),m=e.createSurface(g,h,d);null!=k.opacity&&(g.style.opacity=k.opacity.toString());try{c.forEach(function(c){var e=m.createGroup(),g=0;c.forEach(function(a){var b=a.shape,c=a.fill,d=a.stroke;g+=d&&d.width||0;var h=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=z(b.path)),h=e.createShape(b).setFill(c).setStroke(d?
d:{width:0}),"text"===b.type&&h.setFont(a.font))});var q=e.getBoundingBox();c=q.width;var n=q.height,B=-(q.x+c/2),l=-(q.y+n/2),f=m.getDimensions(),B={dx:B+f.width/2,dy:l+f.height/2},l=!1;if(k.scale&&0!==q.width&&0!==q.height){var l=q.width/q.height,p=(h>d?h:d)-2*g,x=1,u=1;isNaN(p)||(1<l?(x=p/q.width,u=p/l/q.height):(u=p/q.height,x=p*l/q.width));e.applyTransform(b.scaleAt(x,u,f.width/2,f.height/2));l=!0}!l&&(c>h||n>d)&&(q=c/h>n/d,c=((q?h:d)-5)/(q?c:n),a.mixin(B,{xx:c,yy:c}));e.applyTransform(B)})}catch(A){return m.clear(),
m.destroy(),null}return g}function u(a,b,c,e){return a?m(a,{responseType:"image",allowImageDataAccess:c}).then(function(a){a=a.data;var d=a.width,h=a.height,k=d/h,g=b;e&&(g=Math.min(g,Math.max(d,h)));return{image:c?a:null,width:1>=k?Math.ceil(g*k):g,height:1>=k?g:Math.ceil(g/k)}}).catch(function(d){if(c)return u(a,b,!1,e);throw d;}):t.reject(new g("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(f,"__esModule",{value:!0});f.renderSymbol=function(a,b,c){var d=Math.ceil(b[0]);
b=Math.ceil(b[1]);return a.some(function(a){return!!a.length})?y(a,d,b,c):null};f.tintImageWithColor=function(a,b,d,e,g){return u(a,b,!!d,g).then(function(h){var k=h.width?h.width:b,g=h.height?h.height:b,m;if(m=h.image)m=d&&"ignore"!==e?"multiply"===e&&255===d.r&&255===d.g&&255===d.b&&1===d.a?!1:!0:!1;if(m){var q=h.image.width,n=h.image.height;(v("edge")||v("ie"))&&/\.svg$/i.test(a)&&(--q,--n);var B,f;B=Math.ceil(k);f=Math.ceil(g);m=document.createElement("canvas");m.width=B;m.height=f;m.style.width=
B+"px";m.style.height=f+"px";m=m.getContext("2d");m.clearRect(0,0,B,f);m.drawImage(h.image,0,0,q,n,0,0,k,g);h=m.getImageData(0,0,k,g);q=[d.r/255,d.g/255,d.b/255,d.a];n=p.toHSV(d);for(B=0;B<h.data.length;B+=4){f=h.data;var l=B,u=q,x=n;switch(e){case "multiply":f[l+0]*=u[0];f[l+1]*=u[1];f[l+2]*=u[2];f[l+3]*=u[3];break;default:var y=p.toHSV({r:f[l+0],g:f[l+1],b:f[l+2]});y.h=x.h;y.s=x.s;y.v=y.v/100*x.v;x=p.toRGB(y);f[l+0]=x.r;f[l+1]=x.g;f[l+2]=x.b;f[l+3]*=u[3]}}m.putImageData(h,0,0);a=m.canvas.toDataURL("image/png")}else(m=
c.id&&c.id.findCredential(a))&&m.token&&(h=-1===a.indexOf("?")?"?":"\x26",a=""+a+h+"token\x3d"+m.token);return{url:a,width:k,height:g}}).catch(function(){return{url:a,width:b,height:b}})}})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(w,f,a){f.switchTo(a);return f})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(w,f,a,e,b){var c=null;a.add("vml",function(a,b,c){c.innerHTML=
'\x3cv:shape adj\x3d"1"/\x3e';a="adj"in c.firstChild;c.innerHTML="";return a});return{load:function(m,p,g){function t(){p(["dojox/gfx/"+v],function(a){w.renderer=v;c=a;g(a)})}if(c&&"force"!=m)g(c);else{var v=b.forceGfxRenderer;m=!v&&(f.isString(b.gfxRenderer)?b.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var z,y;!v&&m.length;)switch(m.shift()){case "svg":"SVGAngle"in e.global&&(v="svg");break;case "vml":a("vml")&&(v="vml");break;case "silverlight":try{a("ie")?(z=new ActiveXObject("AgControl.AgControl"),
z.IsVersionSupported("1.0"))&&(y=!0):navigator.plugins["Silverlight Plug-In"]&&(y=!0)}catch(u){y=!1}finally{z=null}y&&(v="silverlight");break;case "canvas":e.global.CanvasRenderingContext2D&&(v="canvas")}"canvas"===v&&!1!==b.canvasEvents&&(v="canvasWithEvents");b.isDebug&&console.log("gfx renderer \x3d "+v);"svg"==v&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(t):t()}}}})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(w,f){var a=w.matrix={},e={};a._degToRad=
function(a){return e[a]||(e[a]=Math.PI*a/180)};a._radToDeg=function(a){return a/Math.PI*180};a.Matrix2D=function(b){if(b)if("number"==typeof b)this.xx=this.yy=b;else if(b instanceof Array){if(0<b.length){for(var c=a.normalize(b[0]),e=1;e<b.length;++e){var p=c,g=a.normalize(b[e]),c=new a.Matrix2D;c.xx=p.xx*g.xx+p.xy*g.yx;c.xy=p.xx*g.xy+p.xy*g.yy;c.yx=p.yx*g.xx+p.yy*g.yx;c.yy=p.yx*g.xy+p.yy*g.yy;c.dx=p.xx*g.dx+p.xy*g.dy+p.dx;c.dy=p.yx*g.dx+p.yy*g.dy+p.dy}f.mixin(this,c)}}else f.mixin(this,b)};f.extend(a.Matrix2D,
{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});f.mixin(a,{identity:new a.Matrix2D,flipX:new a.Matrix2D({xx:-1}),flipY:new a.Matrix2D({yy:-1}),flipXY:new a.Matrix2D({xx:-1,yy:-1}),translate:function(b,c){return 1<arguments.length?new a.Matrix2D({dx:b,dy:c}):new a.Matrix2D({dx:b.x,dy:b.y})},scale:function(b,c){return 1<arguments.length?new a.Matrix2D({xx:b,yy:c}):"number"==typeof b?new a.Matrix2D({xx:b,yy:b}):new a.Matrix2D({xx:b.x,yy:b.y})},rotate:function(b){var c=Math.cos(b);b=Math.sin(b);return new a.Matrix2D({xx:c,
xy:-b,yx:b,yy:c})},rotateg:function(b){return a.rotate(a._degToRad(b))},skewX:function(b){return new a.Matrix2D({xy:Math.tan(b)})},skewXg:function(b){return a.skewX(a._degToRad(b))},skewY:function(b){return new a.Matrix2D({yx:Math.tan(b)})},skewYg:function(b){return a.skewY(a._degToRad(b))},reflect:function(b,c){1==arguments.length&&(c=b.y,b=b.x);var e=b*b,f=c*c,g=e+f,t=2*b*c/g;return new a.Matrix2D({xx:2*e/g-1,xy:t,yx:t,yy:2*f/g-1})},project:function(b,c){1==arguments.length&&(c=b.y,b=b.x);var e=
b*b,f=c*c,g=e+f,t=b*c/g;return new a.Matrix2D({xx:e/g,xy:t,yx:t,yy:f/g})},normalize:function(b){return b instanceof a.Matrix2D?b:new a.Matrix2D(b)},isIdentity:function(a){return 1==a.xx&&0==a.xy&&0==a.yx&&1==a.yy&&0==a.dx&&0==a.dy},clone:function(b){var c=new a.Matrix2D,e;for(e in b)"number"==typeof b[e]&&"number"==typeof c[e]&&c[e]!=b[e]&&(c[e]=b[e]);return c},invert:function(b){b=a.normalize(b);var c=b.xx*b.yy-b.xy*b.yx;return b=new a.Matrix2D({xx:b.yy/c,xy:-b.xy/c,yx:-b.yx/c,yy:b.xx/c,dx:(b.xy*
b.dy-b.yy*b.dx)/c,dy:(b.yx*b.dx-b.xx*b.dy)/c})},_multiplyPoint:function(a,c,e){return{x:a.xx*c+a.xy*e+a.dx,y:a.yx*c+a.yy*e+a.dy}},multiplyPoint:function(b,c,e){b=a.normalize(b);return"number"==typeof c&&"number"==typeof e?a._multiplyPoint(b,c,e):a._multiplyPoint(b,c.x,c.y)},multiplyRectangle:function(b,c){var e=a.normalize(b);c=c||{x:0,y:0,width:0,height:0};if(a.isIdentity(e))return{x:c.x,y:c.y,width:c.width,height:c.height};b=a.multiplyPoint(e,c.x,c.y);var f=a.multiplyPoint(e,c.x,c.y+c.height),g=
a.multiplyPoint(e,c.x+c.width,c.y);c=a.multiplyPoint(e,c.x+c.width,c.y+c.height);var e=Math.min(b.x,f.x,g.x,c.x),t=Math.min(b.y,f.y,g.y,c.y);return{x:e,y:t,width:Math.max(b.x,f.x,g.x,c.x)-e,height:Math.max(b.y,f.y,g.y,c.y)-t}},multiply:function(b){for(var c=a.normalize(b),e=1;e<arguments.length;++e){var f=c,g=a.normalize(arguments[e]),c=new a.Matrix2D;c.xx=f.xx*g.xx+f.xy*g.yx;c.xy=f.xx*g.xy+f.xy*g.yy;c.yx=f.yx*g.xx+f.yy*g.yx;c.yy=f.yx*g.xy+f.yy*g.yy;c.dx=f.xx*g.dx+f.xy*g.dy+f.dx;c.dy=f.yx*g.dx+f.yy*
g.dy+f.dy}return c},_sandwich:function(b,c,e){return a.multiply(a.translate(c,e),b,a.translate(-c,-e))},scaleAt:function(b,c,e,f){switch(arguments.length){case 4:return a._sandwich(a.scale(b,c),e,f);case 3:return"number"==typeof e?a._sandwich(a.scale(b),c,e):a._sandwich(a.scale(b,c),e.x,e.y)}return a._sandwich(a.scale(b),c.x,c.y)},rotateAt:function(b,c,e){return 2<arguments.length?a._sandwich(a.rotate(b),c,e):a._sandwich(a.rotate(b),c.x,c.y)},rotategAt:function(b,c,e){return 2<arguments.length?a._sandwich(a.rotateg(b),
c,e):a._sandwich(a.rotateg(b),c.x,c.y)},skewXAt:function(b,c,e){return 2<arguments.length?a._sandwich(a.skewX(b),c,e):a._sandwich(a.skewX(b),c.x,c.y)},skewXgAt:function(b,c,e){return 2<arguments.length?a._sandwich(a.skewXg(b),c,e):a._sandwich(a.skewXg(b),c.x,c.y)},skewYAt:function(b,c,e){return 2<arguments.length?a._sandwich(a.skewY(b),c,e):a._sandwich(a.skewY(b),c.x,c.y)},skewYgAt:function(b,c,e){return 2<arguments.length?a._sandwich(a.skewYg(b),c,e):a._sandwich(a.skewYg(b),c.x,c.y)}});w.Matrix2D=
a.Matrix2D;return a})},"esri/core/colorUtils":function(){define([],function(){var w={COEF_RGB2XYZ:[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],COEF_XYZ2RGB:[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],matrixProduct:function(a,e){var b=[],c,f;if(a[0].length!==e.length)throw"dimensions do not match";var p=a.length,g=a[0].length,t=0;for(c=0;c<p;c++){for(f=t=0;f<g;f++)t+=a[c][f]*e[f];b.push(t)}return b},rgb2xyz:function(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=
a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=this.matrixProduct(this.COEF_RGB2XYZ,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}},xyz2rgb:function(a){a=this.matrixProduct(this.COEF_XYZ2RGB,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}},xyz2lab:function(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/
3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}},lab2xyz:function(a){var e=a.l;a=[(e+16)/116+a.a/500,(e+16)/116,(e+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}},lab2lch:function(a){var e=a.l,b=a.a,c=a.b;a=Math.sqrt(b*b+c*c);b=Math.atan2(c,b);b=0<b?b:b+2*Math.PI;return{l:e,c:a,h:b}},lch2lab:function(a){var e=a.c,b=a.h;return{l:a.l,a:e*Math.cos(b),b:e*Math.sin(b)}},rgb2lab:function(a){return this.xyz2lab(this.rgb2xyz(a))},
lab2rgb:function(a){return this.xyz2rgb(this.lab2xyz(a))},rgb2lch:function(a){return this.lab2lch(this.xyz2lab(this.rgb2xyz(a)))},lch2rgb:function(a){return this.xyz2rgb(this.lab2xyz(this.lch2lab(a)))}},f={rgb2hsv:function(a){var e=a.r,b=a.g;a=a.b;var c=Math.max(e,b,a),f=c-Math.min(e,b,a),p;0===f?p=0:c===e?p=(b-a)/f%6:c===b?p=(a-e)/f+2:c===a&&(p=(e-b)/f+4);0>p&&(p+=6);return{h:60*p,s:100*(0===f?0:f/c),v:100/255*c}},hsv2rgb:function(a){var e=a.h/60,b=a.v/100*255;a=a.s/100*b;var c=a*(1-Math.abs(e%2-
1)),f;switch(Math.floor(e)){case 0:f={r:a,g:c,b:0};break;case 1:f={r:c,g:a,b:0};break;case 2:f={r:0,g:a,b:c};break;case 3:f={r:0,g:c,b:a};break;case 4:f={r:c,g:0,b:a};break;case 5:case 6:f={r:a,g:0,b:c}}f.r=Math.round(f.r+b-a);f.g=Math.round(f.g+b-a);f.b=Math.round(f.b+b-a);return f}};return{toRGB:function(a){var e;void 0!==a.r&&void 0!==a.g&&void 0!==a.b?e=a:void 0!==a.l&&void 0!==a.c&&void 0!==a.h?e=w.lch2rgb(a):void 0!==a.l&&void 0!==a.a&&void 0!==a.b?e=w.lab2rgb(a):void 0!==a.x&&void 0!==a.y&&
void 0!==a.z?e=w.xyz2rgb(a):void 0!==a.h&&void 0!==a.s&&void 0!==a.v&&(e=f.hsv2rgb(a));return e},toHSV:function(a){if(void 0!==a.h&&void 0!==a.s&&void 0!==a.v)return a;a=this.toRGB(a);return f.rgb2hsv(a)},toLAB:function(a){return void 0!==a.l&&void 0!==a.a&&void 0!==a.b?a:w.rgb2lab(this.toRGB(a))},toLCH:function(a){return void 0!==a.l&&void 0!==a.c&&void 0!==a.h?a:w.rgb2lch(this.toRGB(a))},toXYZ:function(a){return void 0!==a.x&&void 0!==a.y&&void 0!==a.z?a:w.rgb2xyz(this.toRGB(a))}}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./symbolUtils".split(" "),
function(w,f,a,e,b,c,m,p,g,t,v){function z(a){var b=a.outline,d=a.get("material.color"),d=d&&d.toRgba().toString();if(!b)return"fill"===a.type&&"255,255,255,1"===d?{color:"#bdc3c7",width:.75}:null;a=c.pt2px(b.size)||0;return{color:"rgba("+(null!=b.color?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function y(a,c){var d=c&&c.resource,d=d&&d.href;return a.thumbnail&&a.thumbnail.url?b.resolve(a.thumbnail.url):d&&"object"!==c.type?b.resolve(v.getIconHref(a,c)):a.styleOrigin&&(a.styleOrigin.styleName||
a.styleOrigin.styleUrl)?t.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||D}):b.resolve(D)}function u(a,b){if(!a.material||!a.material.color)return a=Math.min(Math.max(m.defaultThematicColor.r+191.25*b,0),255),[a,a,a,100];for(var c=a.material.color.toRgb(),d=0;3>d;d++)c[d]=Math.min(Math.max(c[d]+191.25*b,0),255);c.push(a.material.color.a);return c}function l(a){return a.outline?z(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}
function h(a,b){if(!a.material)return{};for(var d=a.material.color.toRgb(),e="rgba(",h=0;3>h;h++)e+=Math.min(Math.max(d[h]+191.25*b,0),255)+",";e+=a.material.color.a+");";a=a.size?c.pt2px(a.size):.75;return{color:e,width:Math.min(a,80)}}function d(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function k(a){var b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function n(a,b,c,e){var h=a&&a.type,k="object"===h,
f=[];if("icon"===h)switch(b){case "circle":f.push({shape:{type:"circle",cx:0,cy:0,r:.5*c},fill:u(a,0),stroke:z(a)});break;case "square":f.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[c,c]},{command:"Z",values:[]}]},fill:u(a,0),stroke:z(a)});break;case "cross":f.push({shape:{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[.5*c,c]},{command:"M",values:[0,.5*c]},{command:"L",values:[c,.5*c]},
{command:"E",values:[]}]},stroke:l(a)});break;case "x":f.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,c]},{command:"M",values:[c,0]},{command:"L",values:[0,c]},{command:"E",values:[]}]},stroke:l(a)});break;case "kite":f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[.5*c,0]},{command:"L",values:[c,.5*c]},{command:"L",values:[.5*c,c]},{command:"Z",values:[]}]},fill:u(a,0),stroke:z(a)})}else if(k)switch(b){case "cone":b=u(a,0);a=
u(a,-.6);a=d(b,a,e?20:c);c=p.getConeShapes(c,e);f.push({shape:c[0],fill:a});f.push({shape:c[1],fill:a});break;case "inverted-cone":e=u(a,0);a=u(a,-.6);a=d(e,a,c);c=p.getInvertedConeShapes(c);f.push({shape:c[0],fill:a});f.push({shape:c[1],fill:e});break;case "cube":c=p.getCubeShapes(c,e);f.push({shape:c[0],fill:u(a,0)});f.push({shape:c[1],fill:u(a,-.3)});f.push({shape:c[2],fill:u(a,-.5)});break;case "cylinder":b=u(a,0);h=u(a,-.6);b=d(b,h,e?20:c);c=p.getCylinderShapes(c,e);f.push({shape:c[0],fill:b});
f.push({shape:c[1],fill:b});f.push({shape:c[2],fill:u(a,0)});break;case "diamond":c=p.getDiamondShapes(c);f.push({shape:c[0],fill:u(a,-.3)});f.push({shape:c[1],fill:u(a,0)});f.push({shape:c[2],fill:u(a,-.3)});f.push({shape:c[3],fill:u(a,-.7)});break;case "sphere":e=u(a,0);a=u(a,-.6);a=d(e,a);a.x1=0;a.y1=0;a.x2=.25*c;a.y2=.25*c;f.push({shape:{type:"circle",cx:0,cy:0,r:.5*c},fill:a});break;case "tetrahedron":c=p.getTetrahedronShapes(c),f.push({shape:c[0],fill:u(a,-.3)}),f.push({shape:c[1],fill:u(a,
0)}),f.push({shape:c[2],fill:u(a,-.6)})}return f}function x(a,d){var e=d&&d.size?c.pt2px(d.size):null,h=d&&d.maxSize?c.pt2px(d.maxSize):null,f=d&&d.disableUpsampling,l=a.symbolLayers,q=[],u=0,x=0,m=l.getItemAt(l.length-1),p;m&&"icon"===m.type&&(p=m.size&&c.pt2px(m.size));l.forEach(function(l,m){if("icon"===l.type||"object"===l.type){m="icon"===l.type?l.size&&c.pt2px(l.size):0;var r=e||m?Math.ceil(Math.min(e||m,h||120)):22,A=z(l),t=A?A.width:0;if(l&&l.resource&&l.resource.href)m=y(a,l).then(function(a){var b=
l.get("material.color"),c;c="icon"===l.type?"multiply":"tint";return g.tintImageWithColor(a,r,b,c,f)}).then(function(a){var b=a.width,c=a.height;u=Math.max(u,b+2*t);x=Math.max(x,c+2*t);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),q.unshift(m);else{(A=l.get("resource.primitive"))||(A="icon"===l.type?"circle":"sphere");var C=r;"icon"===l.type&&p&&e&&(C=m/p*r);m=d&&"tall"===d.symbolConfig||("object"===l.type?k(l):!1);u=Math.max(u,m?20:C+2*t);x=Math.max(x,C+2*t);q.unshift(b.resolve(n(l,
A,C,m)))}}});return b.eachAlways(q).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&E.warn("error while building swatchInfo!",a.error)});return g.renderSymbol(b,[u,x],{node:d&&d.node,scale:!1})})}function A(a,d){var e=a.symbolLayers,f=[];a=v.isVolumetricSymbol(a);var k=d&&d.size?c.pt2px(d.size):null,n=(d&&d.maxSize?c.pt2px(d.maxSize):null)||80,l=0,q=0,x;e.forEach(function(a,b){var c=a&&a.type,d="line"===c;if(d||"path"===c){var e=h(a,0),g=e&&e.width||0,c=[];d?(0===
b&&(x=g),a=Math.min(k||g,n),a=0===b?a:k?g/x*a:a,q=Math.max(q,a),l=Math.max(l,22<a?2*a:40),e.width=a,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*q]},{command:"L",values:[l,.5*q]},{command:"E",values:[]}]},stroke:e})):(b=Math.min(k||22,n),e=u(a,0),d=u(a,-.2),a=h(a,-.4),a.width=1,c.push({shape:p.shapes.pathSymbol3DLayer[0],fill:d,stroke:a}),c.push({shape:p.shapes.pathSymbol3DLayer[1],fill:e,stroke:a}),l=q=Math.max(q,b+2));f.push(c)}});return b.resolve(g.renderSymbol(f,[l,q],{node:d&&d.node,
scale:a}))}Object.defineProperty(f,"__esModule",{value:!0});var D=w.toUrl("../../images/Legend/legend3dsymboldefault.png"),E=e.getLogger("esri.symbols.support.previewSymbol3D");f.previewSymbol3D=function(d,e){if(0===d.symbolLayers.length)return b.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var f=null;switch(d.type){case "point-3d":f=x(d,e);break;case "line-3d":f=A(d,e);break;case "polygon-3d":case "mesh-3d":a:{f="mesh-3d"===d.type;d=d.symbolLayers;for(var k=
e&&e.size?c.pt2px(e.size):null,n=e&&e.maxSize?c.pt2px(e.maxSize):null,k=k||22,l=[],q=0,m=0,y=0;y<d.length;y++){var t=d.getItemAt(y),v=t.type,D="fill"===v,C="line"===v,r="extrude"===t.type,v=[];if(f&&!D){f=void 0;break a}var w=p.shapes.fill[0];D?(C=(D=z(t))&&D.width||0,q=Math.max(q,22+C),m=Math.max(m,22+C),v.push({shape:w,fill:u(t,0),stroke:D})):C?(t=(D=h(t,0))&&D.width||0,w={stroke:D,shape:w},q=Math.max(q,22+t),m=Math.max(m,22+t),v.push(w)):r&&(w=h(t,-.4),D=u(t,0),t=u(t,-.2),C=Math.min(k,n||120),
r=p.getExtrudeSymbolShapes(C),w.width=1,v.push({shape:r[0],fill:t,stroke:w}),v.push({shape:r[1],fill:t,stroke:w}),v.push({shape:r[2],fill:D,stroke:w}),t=22*.7+.5*C,q=Math.max(q,22+2*w.width),m=Math.max(m,t+2*w.width));l.push(v)}f=b.resolve(g.renderSymbol(l,[q,m],{node:e&&e.node,scale:!1}))}}return f?f:b.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(w,f,a){Object.defineProperty(f,
"__esModule",{value:!0});f.isVolumetricSymbol=function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};f.getIconHref=function(b,c){c=c.resource.href;return!a("esri-canvas-svg-support")&&b.styleOrigin&&e.test(c)?c.replace(e,"/resource/png/$1.png"):c};var e=/\/resource\/(.*?)\.svg$/})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],function(w,f,a,e){Object.defineProperty(f,
"__esModule",{value:!0});f.previewWebStyleSymbol=function(b,c,f){var m=b.thumbnail&&b.thumbnail.url;return m?a(m,{responseType:"image"}).then(function(a){a=a.data;var b=!/\\.svg$/i.test(a.src)&&f&&f.disableUpsampling,c=Math.max(a.width,a.height),g=f&&null!=f.maxSize?e.pt2px(f.maxSize):120;b&&(g=Math.min(c,g));b=Math.min(g,f&&null!=f.size?e.pt2px(f.size):c);b!==c&&(c=0!==a.width&&0!==a.height?a.width/a.height:1,1<=c?(a.width=b,a.height=b/c):(a.width=b*c,a.height=b));return f&&f.node?(f.node.appendChild(a),
f.node):a}):b.fetchSymbol().then(function(a){return c(a,f)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ../../../core/numberUtils ../../../symbols/support/gfxUtils ./utils".split(" "),function(w,f,a,e,b,c){function m(a,b){var c=b-a;b=[0,.25,.5,.75,1].map(function(b){return Number((a+b*c).toFixed(6))});p(0,4,b);return b}function p(a,b,c){var e=a+(b-a)/2,d=c[0],f=c[1],g=c[2],l=Math.floor(d),u=Math.floor(f),m=Math.floor(g);l===d&&m===g&&u!==f&&
l!==u&&m!==u&&(c[e]=u);a+1!==e&&p(a,e,c);e+1!==b&&p(e,b,c)}function g(b,c){b=t(b,c);var e=b.startIndex,h=b.endIndex;if(e===h)return c[e].color;c=a.blendColors(c[e].color,c[h].color,b.weight);return new a(c)}function t(a,b){var c=0,e=b.length-1;b.some(function(b,f){if(a<b.value)return e=f,!0;c=f;return!1});return{startIndex:c,endIndex:e,weight:(a-b[c].value)/(b[e].value-b[c].value)}}Object.defineProperty(f,"__esModule",{value:!0});var v=[64,64,64],z=[255,255,255];f.getRampBorderColor=function(a){var c=
null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(a=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&a.symbol;return(a=(a=c&&-1===c.type.indexOf("line-symbol")?b.getStroke(c):null)&&a.color)&&0<a.a&&!(240<=a.r&&240<=a.g&&240<=a.b)?a:null};f.getRampOverlayColor=function(b){var c=new a(z);c.a=1-b;return c};f.getRampStops=function(b,f,g){var h=!1,d=[],k=[];if(f.colors||f.opacityValues)d=m(f.minDataValue,f.maxDataValue);else if(f.stops){var n=f.stops,d=
n.map(function(a){return a.value});(h=n.some(function(a){return!!a.label}))&&(k=n.map(function(a){return a.label}))}var l=d[0],n=d[d.length-1];if(null==l&&null==n)return null;var p=n-l;return d.map(function(n,m){var q;if("opacity"===f.type){q=g;void 0===q&&(q=v);q=new a(q);var x=b.getOpacity(n,{opacityInfo:f});null!=x&&(q.a=x)}else q=b.getColor(n,{colorInfo:f});m=h?k[m]:c.getLabelPrefix(m,d.length-1)+e.format(n);return{value:n,color:q,label:m,offset:p?1-(n-l)/p:1}}).reverse()};f.getRampStopsForPointCloud=
function(a){var b=!1,f=[],h=[],f=a.map(function(a){return a.value});(b=a.some(function(a){return!!a.label}))&&(h=a.map(function(a){return a.label}));var d=f[0],k=f[f.length-1];if(null==d&&null==k)return null;var n=k-d;return f.map(function(k,l){var m=g(k,a);l=b?h[l]:c.getLabelPrefix(l,f.length-1)+e.format(k);return{value:k,color:m,label:l,offset:n?1-(k-d)/n:1}}).reverse()};f.getColorFromPointCloudStops=g})},"esri/widgets/Legend/support/utils":function(){define(["require","exports"],function(w,f){Object.defineProperty(f,
"__esModule",{value:!0});f.getLabelPrefix=function(a,e){return 0===a?"\x3c ":a===e?"\x3e ":""}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../symbols ../../../core/numberUtils ../../../symbols/support/symbolUtils ./utils".split(" "),function(w,f,a,e,b,c){function m(a,b){var c=null,e=null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(c=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&c.symbol,e=1<a.length;if(!c||
p(c))return null;c=c.clone();if(b||e)-1<c.type.indexOf("3d")?g(c):(b=c,-1!==b.type.indexOf("line")?b.color=d:(b.color=l,"simple-marker"===b.type&&(b.outline={color:d,width:1.5})));return c}function p(b){if(b)return a.isSymbol3D(b)?b.symbolLayers?b.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==b.type.indexOf("fill")}function g(a){b.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:d}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||
a.resource&&a.resource.href?a.material={color:h}:(a.material={color:l},a.outline={color:d,size:1.5})}))}function t(a,b,c,d){var f=a.getSizeRangeAtScale(b,d),h=f&&v(f);if(f||h){for(var k=h.map(function(a){var c=f.minSize,d=f.maxSize,e=b.minDataValue,h=b.maxDataValue;return a<=c?e:a>=d?h:(a-c)/(d-c)*(h-e)+e}),k=e.round(k),g=1;g<k.length-1;g++){var l=z(a,b,c,k[g],k[g-1],d);l&&(k[g]=l[0],h[g]=l[1])}return k}}function v(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}
function z(a,b,c,d,f,h){var k=y(a,b,c,d,h);f=y(a,b,c,f,h);var g=e.numDigits(d),l=g.fractional,n=g.integer,m=g=null;0<d&&1>d&&(g=Math.pow(10,l),d*=g,n=e.numDigits(d).integer);for(l=n-1;0<=l;l--){var p=Math.pow(10,l),n=Math.floor(d/p)*p,p=Math.ceil(d/p)*p;null!=g&&(n/=g,p/=g);var t=(n+p)/2,t=e.round([n,t,p],{indexes:[1]}),t=t[1],u=y(a,b,c,n,h),x=y(a,b,c,p,h),v=y(a,b,c,t,h),w=e.percentChange(k,u,f,null),A=e.percentChange(k,x,f,null),D=e.percentChange(k,v,f,null),r=20>=w.previous,z=20>=A.previous;r&&
z&&(w.previous<=A.previous?(r=!0,z=!1):(z=!0,r=!1));r?m=[n,u]:z?m=[p,x]:20>=D.previous&&(m=[t,v]);if(m)break}return m}function y(a,b,c,d,e){return a.getSize(d,{sizeInfo:b,scale:e,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})}function u(c,d){c=c.clone();if(a.isSymbol3D(c))b.isVolumetricSymbol(c)||c.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=d)});else if("esri.symbols.SimpleMarkerSymbol"===c.declaredClass)c.size=d;else if("esri.symbols.PictureMarkerSymbol"===c.declaredClass){var e=
c.width,f=c.height;c.height=d;c.width=e/f*d}else"esri.symbols.SimpleLineSymbol"===c.declaredClass?c.width=d:"esri.symbols.TextSymbol"===c.declaredClass&&c.font&&(c.font.size=d);return c}Object.defineProperty(f,"__esModule",{value:!0});f.REAL_WORLD_MAX_SIZE=30;f.REAL_WORLD_MIN_SIZE=12;var l=[255,255,255],h=[200,200,200],d=[128,128,128];f.getRampStops=function(a,d,h,g){var k=d.legendOptions,k=k&&k.customValues,l=m(a,h);h=null!=d.minSize&&null!=d.maxSize;var n=d.stops&&1<d.stops.length,p=!!d.target;
if(l&&(k||h||n&&!p)){var x=b.isVolumetricSymbol(l),v=null,w=null,A=null,w=x&&!n?[d.minDataValue,d.maxDataValue]:k||t(a,d,l,g);!w&&n&&(w=d.stops.map(function(a){return a.value}),(v=d.stops.some(function(a){return!!a.label}))&&(A=d.stops.map(function(a){return a.label})));k=!x||w&&2===w.length;if(!w||!k)return null;var z=[f.REAL_WORLD_MIN_SIZE,f.REAL_WORLD_MAX_SIZE];return w.map(function(b,f){var h=x?z[f]:y(a,d,l,b,g),k=u(l,h);f=v?A[f]:c.getLabelPrefix(f,w.length-1)+e.format(b);return{value:b,symbol:k,
label:f,size:h}}).reverse()}}})},"*noref":1}});
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(w,f,a,e,b,c,m,p,g,t){var v=c.ofType(t),z="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.MapImageLayer esri.layers.MapNotesLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),y=
["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(b){function c(a){a=b.call(this,a)||this;a._handles=new m;a._layerViewByLayerId={};a._layerInfosByLayerViewId={};a._activeLayerInfosByLayerViewId={};a.activeLayerInfos=new v;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.layerInfos=[];a.view=null;return a}a(c,b);c.prototype.initialize=function(){this._handles.add(p.init(this,"view",this._viewHandles),"view")};
c.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});c.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(p.init(this,"state",this._stateHandles),"state")};c.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
c.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};c.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};c.prototype._destroyViewActiveLayerInfo=function(a){this._handles.remove(a);delete this._activeLayerInfosByLayerViewId[a]};c.prototype._watchPropertiesAndAllLayerViews=function(){var a=this.view.allLayerViews;
a.length&&this._refresh();this._handles.add(a.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(p.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};c.prototype._allLayerViewsChangeHandle=function(a){var b=this;a.removed.forEach(function(a){return b._destroyViewActiveLayerInfo(a.uid)});this._refresh()};c.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};c.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};c.prototype._sortActiveLayerInfos=function(a){var b={};this.view.allLayerViews.forEach(function(a,c){return b[a.layer.uid]=c});a.sort(function(a,c){return(b[c.layer.uid]||0)-(b[a.layer.uid]||
0)})};c.prototype._generateLayerViews=function(){var a=[];y.filter(this._filterLayerViews,this).map(this.get,this).filter(function(a){return null!=a}).forEach(this._collectLayerViews("layerViews",a));return a};c.prototype._filterLayerViews=function(a){var b=!this.groundLegendVisible&&"view.groundView.layerViews"===a;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===a||"view.basemapView.referenceLayerViews"===a))&&!b};c.prototype._collectLayerViews=function(a,b){var c=function(d){d&&
d.forEach(function(d){b.push(d);c(d[a])});return b};return c};c.prototype._filterLayerViewsByLayerInfos=function(a){var b=this,c=this.layerInfos;return c&&c.length?c.some(function(c){return b._hasLayerInfo(c,a)}):!0};c.prototype._hasLayerInfo=function(a,b){var c=this._isLayerUIDMatching(a.layer,b.layer.uid);c&&(this._layerInfosByLayerViewId[b.uid]=a);return c};c.prototype._isLayerUIDMatching=function(a,b){return a&&(a.uid===b||this._hasLayerUID(a.layers,b))};c.prototype._hasLayerUID=function(a,b){var c=
this;return a&&a.some(function(a){return c._isLayerUIDMatching(a,b)})};c.prototype._isLayerViewSupported=function(a){return-1<z.indexOf(a.layer.declaredClass)?(this._layerViewByLayerId[a.layer.uid]=a,!0):!1};c.prototype._generateActiveLayerInfo=function(a){var b=this;this._isLayerActive(a)?this._buildActiveLayerInfo(a):(this._handles.remove(a.uid),this._handles.add(p.watch(a,"suspended, layer.legendEnabled",function(){return b._layerActiveHandle(a)}),a.uid))};c.prototype._layerActiveHandle=function(a){this._isLayerActive(a)&&
(this._handles.remove(a.uid),this._buildActiveLayerInfo(a))};c.prototype._isLayerActive=function(a){return!a.suspended&&a.get("layer.legendEnabled")};c.prototype._buildActiveLayerInfo=function(a){var b=this,c=a.layer,e=a.uid,f=this._layerInfosByLayerViewId[e],g=this._activeLayerInfosByLayerViewId[e];g||(g=new t({layer:c,title:f&&void 0!==f.title?f.title:c.title}),this._activeLayerInfosByLayerViewId[e]=g);g.parent||(f=(f=c.parent)&&this._layerViewByLayerId[f.uid],g.parent=f&&this._activeLayerInfosByLayerViewId[f.uid]);
if(!this._handles.has(e)){var f=p.watch(c,"title",function(c){return b._titleHandle(c,g,a)}),h=p.watch(c,"legendEnabled",function(c){return b._legendEnabledHandle(c,g,a)}),c=p.watch(c,"renderer, opacity",function(){return b._constructLegendElements(g,a)}),l=p.watch(a,"suspended",function(c){return b._suspendedHandle(c,g,a)}),m=p.whenTrue(this.view,"stationary",function(){return b._scaleHandle(g,a)});this._handles.add([f,h,c,l,m],e);this._constructLegendElements(g,a)}this._addActiveLayerInfo(g,a)};
c.prototype._titleHandle=function(a,b,c){b.title=a;this._constructLegendElements(b,c)};c.prototype._legendEnabledHandle=function(a,b,c){a?this._addActiveLayerInfo(b,c):this._removeActiveLayerInfo(b)};c.prototype._suspendedHandle=function(a,b,c){a?this._removeActiveLayerInfo(b):this._addActiveLayerInfo(b,c)};c.prototype._scaleHandle=function(a,b){a.scale!==this.view.scale&&a.isScaleDriven&&this._constructLegendElements(a,b)};c.prototype._addActiveLayerInfo=function(a,b){this._isLayerActive(b)&&-1===
this.activeLayerInfos.indexOf(a)&&((b=a.parent,b)?-1===b.children.indexOf(a)&&(b.children.push(a),this._sortActiveLayerInfos(b.children)):(this.activeLayerInfos.add(a),this._sortActiveLayerInfos(this.activeLayerInfos)))};c.prototype._removeActiveLayerInfo=function(a){var b=a.parent;b?(a=b.children.indexOf(a),-1!==a&&b.children.splice(a,1)):this.activeLayerInfos.remove(a)};c.prototype._constructLegendElements=function(a,b){b=b.layer;a.scale=this.view.scale;b.featureCollections?a.buildLegendElementsForFeatureCollections(b.featureCollections):
b.renderer?a.buildLegendElementsForRenderer():b.url&&a.buildLegendElementsForTools()};e([g.property({type:v})],c.prototype,"activeLayerInfos",void 0);e([g.property()],c.prototype,"basemapLegendVisible",void 0);e([g.property()],c.prototype,"groundLegendVisible",void 0);e([g.property()],c.prototype,"layerInfos",void 0);e([g.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);e([g.property()],c.prototype,"view",void 0);return c=e([g.subclass("esri.widgets.Legend.LegendViewModel")],
c)}(g.declared(b))});